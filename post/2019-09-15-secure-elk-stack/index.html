
<!DOCTYPE html>
<html
  lang="en"
  data-figures=""
  
    class="page"
  
  
  >
  <head>
<title>Secure Elk Stack | Che-Chia Chang</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169903302-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-169903302-1');
</script>



<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="2020 It邦幫忙鐵人賽 系列文章
Self-host ELK stack on GCP Secure ELK Stask 監測 Google Compute Engine 上服務的各項數據 監測 Google Kubernetes Engine 的各項數據 是否選擇 ELK 作為解決方案 使用 logstash …" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@chechiachang">
<meta name="twitter:title" content="Secure Elk Stack" />
<meta name="twitter:image" content="https://chechia.net/images/logos/white_logo_dark_background.jpg"/>
<meta property="og:url" content="https://chechia.net/post/2019-09-15-secure-elk-stack/" />
<meta property="og:title" content="Secure Elk Stack" />
<meta property="og:description" content="2020 It邦幫忙鐵人賽 系列文章
Self-host ELK stack on GCP Secure ELK Stask 監測 Google Compute Engine 上服務的各項數據 監測 Google Kubernetes Engine 的各項數據 是否選擇 ELK 作為解決方案 使用 logstash …" />
<meta property="og:image" content="https://chechia.net/images/logos/white_logo_dark_background.jpg" />

<link rel="apple-touch-icon" sizes="180x180" href="https://chechia.net/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://chechia.net/icons/favicon-32x32.png">
<link rel="manifest" href="https://chechia.net/icons/site.webmanifest">

<link rel="canonical" href="https://chechia.net/post/2019-09-15-secure-elk-stack/">



<link rel="preload" href="https://chechia.net/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity = "sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" as="style" crossorigin="anonymous">



<link rel="preload" href="https://chechia.net/en/js/bundle.6703cf5a19523ed401d8d9e012876ed46642e5b6019e567fb9fe7ad6f46ba535d6a1293fe06a8dfd091cf068a6f11fc605273b8b06177a6d0c09579ab0400cf5.js" as="script" integrity=
"sha512-ZwPPWhlSPtQB2NngEodu1GZC5bYBnlZ/uf561vRrpTXWoSk/4GqN/Qkc8Gim8R/GBSc7iwYXem0MCVeasEAM9Q==" crossorigin="anonymous">


<link rel="stylesheet" type="text/css" href="https://chechia.net/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity="sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" crossorigin="anonymous">


  </head>
  <body
    data-code="7"
    data-lines="false"
    id="documentTop"
    data-lang="en"
  >

<header class="nav_header" >
  <nav class="nav"><a href='https://chechia.net/' class="nav_brand nav_item" title="Che-Chia Chang">
  <img src="https://chechia.net/images/fav_79x79.jpg" class="logo" alt="Che-Chia Chang">
  <div class="nav_close">
    <div><svg class="icon">
  <title>open-menu</title>
  <use xlink:href="#open-menu"></use>
</svg>
<svg class="icon">
  <title>closeme</title>
  <use xlink:href="#closeme"></use>
</svg>
</div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://chechia.net/" class="nav_item" title="Home">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://chechia.net/" class="nav_item" title="DevOps">DevOps <img src='https://chechia.net/icons/caret-icon.svg' alt="icon" class="nav_icon"></a>
    <div class="nav_sub">
      <span class="nav_child"></span>
        <a href="https://chechia.net/post/2020-06-14-terraform-infrastructure-as-code" class="nav_child nav_item" title="[Terraform] 從零開始學">[Terraform] 從零開始學</a>
        <a href="https://ithelp.ithome.com.tw/articles/10258904" class="nav_child nav_item" title="[Terraform] 30 天公有雲範例">[Terraform] 30 天公有雲範例</a>
        <a href="https://chechia.net/post/2021-09-01-ithome-ironman-go/" class="nav_child nav_item" title="[Terraform] 2021 iThome 鐵人賽佳作文章">[Terraform] 2021 iThome 鐵人賽佳作文章</a>
    </div>
  </div>
  <div class="nav_parent">
    <a href="https://chechia.net/" class="nav_item" title="iThome 系列文">iThome 系列文 <img src='https://chechia.net/icons/caret-icon.svg' alt="icon" class="nav_icon"></a>
    <div class="nav_sub">
      <span class="nav_child"></span>
        <a href="https://chechia.net/post/2022-09-12-14th-ithome-ironman-iac-aws-workshop-01-introduction/" class="nav_child nav_item" title="2022 14th iThome 鐵人賽參賽WIP">2022 14th iThome 鐵人賽參賽WIP</a>
        <a href="https://chechia.net/post/2021-09-01-ithome-ironman-go/" class="nav_child nav_item" title="2021 13th iThome 鐵人賽佳作文章">2021 13th iThome 鐵人賽佳作文章</a>
        <a href="https://chechia.net/post/2020-09-09-ithome-ironman-challenge/" class="nav_child nav_item" title="2020 12th iThome 鐵人賽佳作文章">2020 12th iThome 鐵人賽佳作文章</a>
        <a href="https://chechia.net/post/2019-09-09-ithome-ironman-challenge/" class="nav_child nav_item" title="2019 11th iThome 鐵人賽優勝文章">2019 11th iThome 鐵人賽優勝文章</a>
    </div>
  </div>
  <div class="nav_parent">
    <a href="https://www.instagram.com/c.c.leather/" class="nav_item" title="Leather Craft">Leather Craft </a>
  </div>
  <div class="nav_parent">
    <a href="https://www.instagram.com/dive.with.cat.coach/" class="nav_item" title="Scuba Diving">Scuba Diving </a>
  </div>
  <div class="nav_parent">
    <a href="https://chechia.net/about/" class="nav_item" title="About">About </a>
  </div>
      
<div class='follow'>
    
    
  <a href="https://www.facebook.com/engineer.from.scratch">
    <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

  </a>
    
    
  <a href="https://github.com/chechiachang">
    <svg class="icon">
  <title>github</title>
  <use xlink:href="#github"></use>
</svg>

  </a>
    
    
  <a href="https://twitter.com/chechiachang">
    <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

  </a>
    
    
  <a href="https://www.linkedin.com/in/che-chia-chang-92194a4a/">
    <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Secure Elk Stack</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <title>calendar</title>
  <use xlink:href="#calendar"></use>
</svg>
</span>
    <span class="post_date">
      Sep 15, 2019</span>
    <span class="post_time"> · 8 min read</span><span>&nbsp;· <a href='https://chechia.net/tags/tls/' title="tls" class="post_tag button button_translucent">tls
        </a><a href='https://chechia.net/tags/elasticsearch/' title="elasticsearch" class="post_tag button button_translucent">elasticsearch
        </a><a href='https://chechia.net/tags/devops/' title="devops" class="post_tag button button_translucent">devops
        </a><a href='https://chechia.net/tags/logstash/' title="logstash" class="post_tag button button_translucent">logstash
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Secure%20Elk%20Stack&url=https%3a%2f%2fchechia.net%2fpost%2f2019-09-15-secure-elk-stack%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fchechia.net%2fpost%2f2019-09-15-secure-elk-stack%2f&t=Secure%20Elk%20Stack" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

    </a>
    <a href="https://chechia.net/post/2019-09-15-secure-elk-stack/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <title>copy</title>
  <use xlink:href="#copy"></use>
</svg>

    </a>
  </div>
  </span>
  </div>

    <div class="post_body"><p><a href="https://ithelp.ithome.com.tw/2020ironman">2020 It邦幫忙鐵人賽</a> 系列文章</p>
<ul>
<li><a href="https://chechia.net/post/2019-09-15-self-host-elk-stack-on-gcp/">Self-host ELK stack on GCP</a></li>
<li><a href="https://chechia.net/post/2019-09-15-secure-elk-stack/">Secure ELK Stask</a></li>
<li><a href="https://chechia.net/post/2019-09-18-monitoring-gce-with-elk/">監測 Google Compute Engine 上服務的各項數據</a></li>
<li><a href="https://chechia.net/post/2019-09-19-monitoring-gke-with-elk/">監測 Google Kubernetes Engine 的各項數據</a></li>
<li><a href="https://chechia.net/post/2019-09-18-elastic-or-not-elastic/">是否選擇 ELK 作為解決方案</a></li>
<li><a href="https://chechia.net/post/2019-09-21-logstash-on-gke/">使用 logstash pipeline 做數據前處理</a></li>
<li>Elasticsearch 日常維護：數據清理，效能調校，永久儲存</li>
<li>Debug ELK stack on GCP</li>
</ul>
<p>對我的文章有興趣，歡迎到我的網站上 <a href="https://chechia.net">https://chechia.net</a> 閱讀其他技術文章，有任何謬誤也請各方大德直接聯繫我，感激不盡。</p>
<p>&ndash;</p>
<p>上篇<a href="https://chechia.net/post/2019-09-15-self-host-elk-stack-on-gcp/">Self-host ELK stack on GCP</a> 介紹了，elk stack 基本的安裝，安裝完獲得一個只支援 http (裸奔)的 elk stack，沒有 https 在公開網路上使用是非常危險的。這篇要來介紹如何做安全性設定。</p>
<p><a href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html">官方的文件在這裡</a>，碎念一下，除非對 ELK 的功能有一定了解，不然這份真的不是很友善。建議從官方文件底下的<a href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/security-getting-started.html">Tutorial: Getting started with security</a> 開始，過程比較不會這麼血尿。</p>
<p>總之為了啟用 authentication &amp; https，這篇要做的事情：</p>
<ul>
<li>enable x-pack &amp; activate basic license</li>
<li>Generate self-signed ca, server certificate, client certificate</li>
<li>Configure Elasticsearch, Kibana, &amp; other components to
<ul>
<li>use server certificate when act as server</li>
<li>use client certificate when connect to an ELK server</li>
</ul>
</li>
</ul>
<hr>
<h1 id="啟用-x-pack">啟用 X-pack</h1>
<p>Elasticsearch 的安全性模組由 x-pack extension 提供，在 <a href="https://www.elastic.co/what-is/open-x-pack">6.3.0 之後的版本</a>，安裝 elasticsearch 的過程中就預設安裝 x-pack。</p>
<p>附上<a href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/get-started-enable-security.html">啟用的官方文件</a></p>
<p>然而，由於舊版的 x-pack 是付費內容，目前的 elasticsearch 安裝完後，elasticsearch.yml 設定預設不啟用 x-pack，也就是說沒看到這篇官方文件的話，很容易就獲得沒有任何 security 功能的 ELK。</p>
<p>雖然目前已經可以使用免費的 basic license 使用 security 功能，還是希望官方可以 default 啟用 security。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ sudo vim /etc/elasticsearch/elasticsearch.yml
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">xpack.security.enabled: true
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">xpack.license.self_generated.type: basic
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">discovery.type: single-node
</span></span></code></pre></div><p>我們這邊啟用 xpack.security，同時將 self-generated license 生出來，我們這邊只使用基本的 basic subscription。若希望啟用更多功能，可以看<a href="https://www.elastic.co/cn/subscriptions">官方subcription 方案介紹</a></p>
<p>另外，如果不同時設定為 single-node 的話，預設會尋找其他elasticsearch node 來組成 cluster，而我們就必須要在所有 node 上啟用 security，這篇只帶大家做一個 single node cluster，簡化步驟。</p>
<p>重啟 elasticsearch ，檢查 log，看啟動時有沒有載入 x-pack</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-v" data-lang="v"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nv">sudo</span> <span class="nv">systemctl</span> <span class="nv">restart</span> <span class="nv">elasticsearch</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err">$</span> <span class="nv">tail</span> <span class="o">-</span><span class="nv">f</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">elasticsearch</span><span class="o">/</span><span class="nv">elasticsearch</span><span class="p">.</span><span class="nv">log</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">49</span><span class="err">,</span><span class="na">467</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nc">NodeEnvironment</span>    <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">using</span> <span class="p">[</span><span class="na">1</span><span class="p">]</span> <span class="nv">data</span> <span class="nv">paths</span><span class="p">,</span> <span class="nv">mounts</span> <span class="p">[[</span><span class="o">/</span><span class="nv">mnt</span><span class="o">/</span><span class="nv">disks</span><span class="o">/</span><span class="nv">elk</span> <span class="p">(</span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">sdb</span><span class="p">)]],</span> <span class="nv">net</span> <span class="nv">usable_space</span> <span class="p">[</span><span class="na">423</span><span class="err">.</span><span class="na">6gb</span><span class="p">],</span> <span class="nv">net</span> <span class="nv">total_space</span> <span class="p">[</span><span class="na">491</span><span class="err">.</span><span class="na">1gb</span><span class="p">],</span> <span class="nv">types</span> <span class="p">[</span><span class="na">ext4</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">49</span><span class="err">,</span><span class="na">474</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nc">NodeEnvironment</span>    <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">heap</span> <span class="nv">size</span> <span class="p">[</span><span class="na">3</span><span class="err">.</span><span class="na">9gb</span><span class="p">],</span> <span class="nv">compressed</span> <span class="nv">ordinary</span> <span class="nv">object</span> <span class="nv">pointers</span> <span class="p">[</span><span class="na">true</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">50</span><span class="err">,</span><span class="na">858</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">n</span><span class="p">.</span><span class="nc">Node</span>               <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">node</span> <span class="nv">name</span> <span class="p">[</span><span class="na">elk</span><span class="p">],</span> <span class="nv">node</span> <span class="nc">ID</span> <span class="p">[</span><span class="na">pC22j9D4R6uiCM7oTc1Fiw</span><span class="p">],</span> <span class="nv">cluster</span> <span class="nv">name</span> <span class="p">[</span><span class="na">elasticsearch</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">50</span><span class="err">,</span><span class="na">866</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">n</span><span class="p">.</span><span class="nc">Node</span>               <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">version</span><span class="p">[</span><span class="mf">7.3.1</span><span class="p">],</span> <span class="nv">pid</span><span class="p">[</span><span class="mi">17189</span><span class="p">],</span> <span class="nv">build</span><span class="p">[</span><span class="nv">default</span><span class="o">/</span><span class="nv">deb</span><span class="o">/</span><span class="mi">4749</span><span class="nv">ba6</span><span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">19</span><span class="nc">T20</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mf">25.651794</span><span class="nc">Z</span><span class="p">],</span> <span class="nc">OS</span><span class="p">[</span><span class="nc">Linux</span><span class="o">/</span><span class="mf">4.15.0</span><span class="o">-</span><span class="mi">1040</span><span class="o">-</span><span class="nv">gcp</span><span class="o">/</span><span class="nv">amd64</span><span class="p">],</span> <span class="nc">JVM</span><span class="p">[</span><span class="nc">Oracle</span> <span class="nc">Corporation</span><span class="o">/</span><span class="nc">OpenJDK</span> <span class="mi">64</span><span class="o">-</span><span class="nc">Bit</span> <span class="nc">Server</span> <span class="nc">VM</span><span class="o">/</span><span class="mf">12.0.2</span><span class="o">/</span><span class="mf">12.0.2</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">50</span><span class="err">,</span><span class="na">878</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">n</span><span class="p">.</span><span class="nc">Node</span>               <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nc">JVM</span> <span class="nv">home</span> <span class="p">[</span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">elasticsearch</span><span class="o">/</span><span class="nv">jdk</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">59</span><span class="err">,</span><span class="na">108</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nc">PluginsService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">loaded</span> <span class="kn">module</span> <span class="p">[</span><span class="na">x</span><span class="err">-</span><span class="na">pack</span><span class="err">-</span><span class="na">ccr</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">59</span><span class="err">,</span><span class="na">109</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nc">PluginsService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">loaded</span> <span class="kn">module</span> <span class="p">[</span><span class="na">x</span><span class="err">-</span><span class="na">pack</span><span class="err">-</span><span class="na">core</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">59</span><span class="err">,</span><span class="na">111</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nc">PluginsService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">loaded</span> <span class="kn">module</span> <span class="p">[</span><span class="na">x</span><span class="err">-</span><span class="na">pack</span><span class="err">-</span><span class="na">logstash</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">59</span><span class="err">,</span><span class="na">113</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nc">PluginsService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">loaded</span> <span class="kn">module</span> <span class="p">[</span><span class="na">x</span><span class="err">-</span><span class="na">pack</span><span class="err">-</span><span class="na">voting</span><span class="err">-</span><span class="na">only</span><span class="err">-</span><span class="na">node</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">59</span><span class="err">,</span><span class="na">114</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nc">PluginsService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">loaded</span> <span class="kn">module</span> <span class="p">[</span><span class="na">x</span><span class="err">-</span><span class="na">pack</span><span class="err">-</span><span class="na">watcher</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">39</span><span class="p">:</span><span class="s">59</span><span class="err">,</span><span class="na">115</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nc">PluginsService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">no</span> <span class="nv">plugins</span> <span class="nv">loaded</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">07</span><span class="err">,</span><span class="na">964</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">x</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nv">a</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nc">FileRolesStore</span><span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">parsed</span> <span class="p">[</span><span class="na">0</span><span class="p">]</span> <span class="nv">roles</span> <span class="nv">from</span> <span class="nv">file</span> <span class="p">[</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">elasticsearch</span><span class="o">/</span><span class="nv">roles</span><span class="p">.</span><span class="nv">yml</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">10</span><span class="err">,</span><span class="na">369</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">x</span><span class="p">.</span><span class="nv">m</span><span class="p">.</span><span class="nv">p</span><span class="p">.</span><span class="nv">l</span><span class="p">.</span><span class="nc">CppLogMessageHandler</span><span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="p">[</span><span class="nv">controller</span><span class="o">/</span><span class="mi">17314</span><span class="p">]</span> <span class="p">[</span><span class="nc">Main</span><span class="p">.</span><span class="nv">cc</span><span class="o">@</span><span class="mi">110</span><span class="p">]</span> <span class="nv">controller</span> <span class="p">(</span><span class="mi">64</span> <span class="nv">bit</span><span class="p">):</span> <span class="nc">Version</span> <span class="mf">7.3.1</span> <span class="p">(</span><span class="nc">Build</span> <span class="mi">1</span><span class="nv">d93901e09ef43</span><span class="p">)</span> <span class="nc">Copyright</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span> <span class="mi">2019</span> <span class="nc">Elasticsearch</span> <span class="nc">BV</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">11</span><span class="err">,</span><span class="na">776</span><span class="p">][</span><span class="nc">DEBUG</span><span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">a</span><span class="p">.</span><span class="nc">ActionModule</span>       <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nc">Using</span> <span class="nc">REST</span> <span class="nv">wrapper</span> <span class="nv">from</span> <span class="nv">plugin</span> <span class="nv">org</span><span class="p">.</span><span class="nv">elasticsearch</span><span class="p">.</span><span class="nv">xpack</span><span class="p">.</span><span class="nv">security</span><span class="p">.</span><span class="nc">Security</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">14</span><span class="err">,</span><span class="na">396</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">d</span><span class="p">.</span><span class="nc">DiscoveryModule</span>    <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">using</span> <span class="nv">discovery</span> <span class="kd">type</span> <span class="p">[</span><span class="na">single</span><span class="err">-</span><span class="na">node</span><span class="p">]</span> <span class="nv">and</span> <span class="nv">seed</span> <span class="nv">hosts</span> <span class="nv">providers</span> <span class="p">[</span><span class="na">settings</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">16</span><span class="err">,</span><span class="na">222</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">n</span><span class="p">.</span><span class="nc">Node</span>               <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">initialized</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">16</span><span class="err">,</span><span class="na">224</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">n</span><span class="p">.</span><span class="nc">Node</span>               <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">starting</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">16</span><span class="err">,</span><span class="na">821</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">t</span><span class="p">.</span><span class="nc">TransportService</span>   <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">publish_address</span> <span class="p">{</span><span class="mf">10.140.0.10</span><span class="p">:</span><span class="mi">9300</span><span class="p">},</span> <span class="nv">bound_addresses</span> <span class="p">{[::]:</span><span class="mi">9300</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">16</span><span class="err">,</span><span class="na">872</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">c</span><span class="p">.</span><span class="nv">c</span><span class="p">.</span><span class="nc">Coordinator</span>      <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">cluster</span> <span class="nc">UUID</span> <span class="p">[</span><span class="na">1CB6_Lt</span><span class="err">-</span><span class="na">TUWEmRoN9SE49w</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">17</span><span class="err">,</span><span class="na">088</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">c</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nc">MasterService</span>    <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">elected</span><span class="o">-</span><span class="k">as</span><span class="o">-</span><span class="nv">master</span> <span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="nv">nodes</span> <span class="nv">joined</span><span class="p">)[{</span><span class="nv">elk</span><span class="p">}{</span><span class="nv">pC22j9D4R6uiCM7oTc1Fiw</span><span class="p">}{</span><span class="nc">Os</span><span class="o">-</span><span class="mi">2</span><span class="nc">FBjgSTOd1G_I3QYwVQ</span><span class="p">}{</span><span class="mf">10.140.0.10</span><span class="p">}{</span><span class="mf">10.140.0.10</span><span class="p">:</span><span class="mi">9300</span><span class="p">}{</span><span class="nv">dim</span><span class="p">}{</span><span class="nv">ml</span><span class="p">.</span><span class="nv">machine_memory</span><span class="o">=</span><span class="mi">7836028928</span><span class="p">,</span> <span class="nv">xpack</span><span class="p">.</span><span class="nv">installed</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="nv">ml</span><span class="p">.</span><span class="nv">max_open_jobs</span><span class="o">=</span><span class="mi">20</span><span class="p">}</span> <span class="nv">elect</span> <span class="nv">leader</span><span class="p">,</span> <span class="nv">_BECOME_MASTER_TASK_</span><span class="p">,</span> <span class="nv">_FINISH_ELECTION_</span><span class="p">],</span> <span class="nv">term</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nv">version</span><span class="p">:</span> <span class="mi">921</span><span class="p">,</span> <span class="nv">reason</span><span class="p">:</span> <span class="nv">master</span> <span class="nv">node</span> <span class="nv">changed</span> <span class="p">{</span><span class="nv">previous</span> <span class="p">[],</span> <span class="nv">current</span> <span class="p">[{</span><span class="nv">elk</span><span class="p">}{</span><span class="nv">pC22j9D4R6uiCM7oTc1Fiw</span><span class="p">}{</span><span class="nc">Os</span><span class="o">-</span><span class="mi">2</span><span class="nc">FBjgSTOd1G_I3QYwVQ</span><span class="p">}{</span><span class="mf">10.140.0.10</span><span class="p">}{</span><span class="mf">10.140.0.10</span><span class="p">:</span><span class="mi">9300</span><span class="p">}{</span><span class="nv">dim</span><span class="p">}{</span><span class="nv">ml</span><span class="p">.</span><span class="nv">machine_memory</span><span class="o">=</span><span class="mi">7836028928</span><span class="p">,</span> <span class="nv">xpack</span><span class="p">.</span><span class="nv">installed</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="nv">ml</span><span class="p">.</span><span class="nv">max_open_jobs</span><span class="o">=</span><span class="mi">20</span><span class="p">}]}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">17</span><span class="err">,</span><span class="na">819</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">c</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nc">ClusterApplierService</span><span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">master</span> <span class="nv">node</span> <span class="nv">changed</span> <span class="p">{</span><span class="nv">previous</span> <span class="p">[],</span> <span class="nv">current</span> <span class="p">[{</span><span class="nv">elk</span><span class="p">}{</span><span class="nv">pC22j9D4R6uiCM7oTc1Fiw</span><span class="p">}{</span><span class="nc">Os</span><span class="o">-</span><span class="mi">2</span><span class="nc">FBjgSTOd1G_I3QYwVQ</span><span class="p">}{</span><span class="mf">10.140.0.10</span><span class="p">}{</span><span class="mf">10.140.0.10</span><span class="p">:</span><span class="mi">9300</span><span class="p">}{</span><span class="nv">dim</span><span class="p">}{</span><span class="nv">ml</span><span class="p">.</span><span class="nv">machine_memory</span><span class="o">=</span><span class="mi">7836028928</span><span class="p">,</span> <span class="nv">xpack</span><span class="p">.</span><span class="nv">installed</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="nv">ml</span><span class="p">.</span><span class="nv">max_open_jobs</span><span class="o">=</span><span class="mi">20</span><span class="p">}]},</span> <span class="nv">term</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nv">version</span><span class="p">:</span> <span class="mi">921</span><span class="p">,</span> <span class="nv">reason</span><span class="p">:</span> <span class="nc">Publication</span><span class="p">{</span><span class="nv">term</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="nv">version</span><span class="o">=</span><span class="mi">921</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">17</span><span class="err">,</span><span class="na">974</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">h</span><span class="p">.</span><span class="nc">AbstractHttpServerTransport</span><span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">publish_address</span> <span class="p">{</span><span class="mf">10.140.0.10</span><span class="p">:</span><span class="mi">9200</span><span class="p">},</span> <span class="nv">bound_addresses</span> <span class="p">{[::]:</span><span class="mi">9200</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">17</span><span class="err">,</span><span class="na">975</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">n</span><span class="p">.</span><span class="nc">Node</span>               <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">started</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">18</span><span class="err">,</span><span class="na">455</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">c</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nc">ClusterSettings</span>  <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">updating</span> <span class="p">[</span><span class="na">xpack</span><span class="err">.</span><span class="na">monitoring</span><span class="err">.</span><span class="na">collection</span><span class="err">.</span><span class="na">enabled</span><span class="p">]</span> <span class="nv">from</span> <span class="p">[</span><span class="na">false</span><span class="p">]</span> <span class="nv">to</span> <span class="p">[</span><span class="na">true</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">22</span><span class="err">,</span><span class="na">555</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">l</span><span class="p">.</span><span class="nc">LicenseService</span>     <span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nv">license</span> <span class="p">[</span><span class="o">************************************</span><span class="p">]</span> <span class="nv">mode</span> <span class="p">[</span><span class="na">basic</span><span class="p">]</span> <span class="o">-</span> <span class="nv">valid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">[</span><span class="na">2019</span><span class="err">-</span><span class="na">09</span><span class="err">-</span><span class="na">16T07</span><span class="p">:</span><span class="s">40</span><span class="p">:</span><span class="s">22</span><span class="err">,</span><span class="na">557</span><span class="p">][</span><span class="nc">INFO</span> <span class="p">][</span><span class="nv">o</span><span class="p">.</span><span class="nv">e</span><span class="p">.</span><span class="nv">x</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nv">s</span><span class="p">.</span><span class="nc">SecurityStatusChangeListener</span><span class="p">]</span> <span class="p">[</span><span class="nv">elk</span><span class="p">]</span> <span class="nc">Active</span> <span class="nv">license</span> <span class="k">is</span> <span class="nv">now</span> <span class="p">[</span><span class="na">BASIC</span><span class="p">];</span> <span class="nc">Security</span> <span class="k">is</span> <span class="nv">enabled</span>
</span></span></code></pre></div><h1 id="enable-user-authentication">Enable user authentication</h1>
<p>啟用 security 之前，我們直接連入 Kibana http://10.140.0.10:5601 ，不用任何使用者登入，便可以完整使用 Kibana 功能（包含 admin 管理介面）。</p>
<p>啟用 security 後，便需要使用帳號密碼登入。在這邊先用工具把使用者密碼產生出來。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl"># 互動式
</span></span><span class="line"><span class="ln">2</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"># 自動產生
</span></span><span class="line"><span class="ln">5</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto
</span></span></code></pre></div><p>密碼生出來後，就把帳號密碼收好，等等會用到。之後初次登入也是使用這些密碼。</p>
<h1 id="configure-passwords-on-client-side">Configure passwords on client-side</h1>
<p>由於已經啟用 authentication，其他 ELK 元件 (Kibana, logstash, filebeat, apm-server,&hellip;) 連入 Elasticsearch 也都會需要各自的帳號密碼驗證。</p>
<p>以 Kibana 為例，可以直接在 kibana.yml 中直接設定帳號密碼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ sudo vim /etc/kibana/kibana.yml
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">elasticsearch.hosts: [&#34;http://localhost:9200&#34;]
</span></span><span class="line"><span class="ln">4</span><span class="cl">xpack.security.enabled: true
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">elasticsearch.username: &#34;kibana&#34;
</span></span><span class="line"><span class="ln">7</span><span class="cl">elasticsearch.password: &#34;***********&#34;
</span></span></code></pre></div><p>當然，這邊就是明碼的，看了不太安全。</p>
<p>或是使用 keystore 把 built-in user 的密碼加密，存在 kibana 的 keystore 裡面，重啟 kibana 時便會載入。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">/usr/share/kibana/bin/kibana-keystore create
</span></span><span class="line"><span class="ln">2</span><span class="cl">/usr/share/kibana/bin/kibana-keystore add elasticsearch.username
</span></span><span class="line"><span class="ln">3</span><span class="cl">/usr/share/kibana/bin/kibana-keystore add elasticsearch.password
</span></span></code></pre></div><p>如果有啟用 Filebeat 功能，beat 元件連入 elasticsearch 一樣需要設定</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">/usr/share/apm-server/bin/filebeat keystore create
</span></span><span class="line"><span class="ln">2</span><span class="cl">/usr/share/apm-server/bin/filebeat add elasticsearch.username
</span></span><span class="line"><span class="ln">3</span><span class="cl">/usr/share/apm-server/bin/filebeat add elasticsearch.password
</span></span></code></pre></div><p>如果有啟用 application performance monitoring(APM) 功能，apm-server 元件連入 elasticsearch 一樣需要設定</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">/usr/share/apm-server/bin/apm-server keystore create
</span></span><span class="line"><span class="ln">2</span><span class="cl">/usr/share/apm-server/bin/apm-server add elasticsearch.username
</span></span><span class="line"><span class="ln">3</span><span class="cl">/usr/share/apm-server/bin/apm-server add elasticsearch.password
</span></span></code></pre></div><hr>
<h1 id="encrypting-communications">Encrypting Communications</h1>
<p>上面加了 username/password authentication，但如果沒 https/tls 基本上還是裸奔。接下來要處理連線加密。</p>
<p><a href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/encrypting-internode-communications.html">官方 tutorial</a></p>
<p>一堆官方文件，我們先跳過XD</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html">elasticsearch security</a></li>
<li><a href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/ssl-tls.html">elastic stack ssl tls</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/configuring-tls.html#configuring-tls">elasticsearch configuring tls</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/certutil.html">certutil</a></li>
</ul>
<h1 id="分析一下需求跟規格">分析一下需求跟規格</h1>
<p>我們需要為每一個 node 生一組 node certificate，使用 node certificate 產生 client certificates 提供給其他 client，連入時會驗證 client 是否為 authenticated user。</p>
<p>針對目前這個 single-node ELK stack，我們可能有幾種選擇</p>
<ul>
<li>簽署一個 localhost，當然這個只能在 localhost 上的客戶端元件使用，別的 node 無法用這個連入</li>
<li>簽署一個 public DNS elk.chechiachang.com，可以在公開網路上使用，別人也可以使用這個DNS嘗試連入</li>
<li>簽署一個私有網域的 DNS，例如在 GCP 上可以使用<a href="https://cloud.google.com/compute/docs/internal-dns?hl=zh-tw">內部dns服務</a>
<ul>
<li>長這樣 elk.asia-east1-b.c.chechiachang.internal</li>
<li>[INSTANCE_NAME].[ZONE].c.[PROJECT_ID].internal</li>
</ul>
</li>
<li>有需要也可以一份 server certificate 中簽署複數個 site</li>
</ul>
<p>我們這邊選擇使用內部 dns，elk.asia-east1-b-c-chechaichang.internal，讓這個 single-node elk 只能透過內部網路存取。</p>
<ul>
<li>elasticsearch: elk.asia-east1-b.c.chechaichang.internal:9200</li>
<li>kibana: elk.asia-east1-b.c.chechaichang.internal:5601</li>
<li>外部要連近來 kibana，我們使用 vpn 服務連進私有網路</li>
</ul>
<p>如果想使用外部 dns，讓 elk stack 在公開網路可以使用，ex. elk.chechiachang.com，可以</p>
<ul>
<li>GCP 的 load balancer掛進來，用 GCP 的 certificate manager 自動管理 certificate</li>
<li>或是在 node 上開一個 nginx server，再把 certificate 用 certbot 生出來</li>
</ul>
<h1 id="generate-certificates">Generate certificates</h1>
<p>先把 X.509 digital certificate 的 certificate authority(CA) 生出來。我們可以設定密碼保護這個檔案</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">mkdir -p /etc/elasticsearch/config
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"># CA generated with Elastic tool
</span></span><span class="line"><span class="ln">4</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-certutil ca \
</span></span><span class="line"><span class="ln">5</span><span class="cl">  -out /etc/elasticsearch/config/elastic-stack-ca.p12
</span></span></code></pre></div><p>生出來是 PKCS#12 格式的 keystore，包含：</p>
<ul>
<li>CA 的 public certificate</li>
<li>CA 的基本資訊</li>
<li>簽署其他 node certificates 使用的私鑰(private key)</li>
</ul>
<p>用 openssl 工具看一下內容，如果有密碼這邊要用密碼解鎖</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ openssl pkcs12 -in /etc/elasticsearch/config/elastic-stack-ca.p12 -info -nokeys
</span></span></code></pre></div><p>附帶說明，X.509 有多種檔案格式</p>
<ul>
<li>.pem</li>
<li>.cer, .crt, .der</li>
<li>.p12</li>
<li>.p7b, .p7c</li>
<li>&hellip;</li>
</ul>
<p>另外檔案格式可以有其他用途，也就是說裡面裝的不一定是 X.509 憑證。裡面的內容也不同。</p>
<p>ELK 設定的過程中，由於不是所有的 ELK component 都支援使用 .p12 檔案，我們在設定過程中會互相專換，或是混用多種檔案格式。</p>
<h1 id="generate-certificate">Generate certificate</h1>
<p>&laquo;&laquo;&laquo;&lt; HEAD</p>
<p>我們用 elastic-stack-ca.p12 這組 keystore裡面的 CA 與 private key，為 elk.asia-east1-b.c.chechiachang.internal 簽一個 p12 keystore，裡面有</p>
<ul>
<li>node certificate</li>
<li>node key</li>
<li>CA certificate</li>
</ul>
<p>這邊只產生一組 server certificate 給 single-node cluster 的 node-1</p>
<p>=======</p>
<p>我們用 elastic-stack-ca.p12 這組 keystore裡面的 CA 與 private key，為 elk.asia-east1-b.c.chechiachang.internal 簽一個 p12 keystore，裡面有</p>
<ul>
<li>node certificate</li>
<li>node key</li>
<li>CA certificate</li>
</ul>
<p>這邊只產生一組 server certificate 給 single-node cluster 的 node-1</p>
<p>如果 cluster 中有多個 elasticsearch，為每個 node 產生 certificate 時都要使用同樣 CA 來簽署，讓 server 信任這組 CA。</p>
<p>使用 elasticsearch-certutil 簡化簽署過程，從產生 CA ，到使用 CA 簽署 certificate。另外，再產生 certificate 中使用 Subject Alternative Name(SAN)，並輸入 ip 與 dns。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl"># certificate for site: private dns with Elastic CA
</span></span><span class="line"><span class="ln">2</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-certutil cert \
</span></span><span class="line"><span class="ln">3</span><span class="cl">  --ca /etc/elasticsearch/config/elastic-stack-ca.p12 \
</span></span><span class="line"><span class="ln">4</span><span class="cl">  --name elk.asia-east1-b.c.chechaichang.internal \
</span></span><span class="line"><span class="ln">5</span><span class="cl">  --dns elk.asia-east1-b.c.chechaichang.internal \
</span></span><span class="line"><span class="ln">6</span><span class="cl">  --ip 10.140.0.10 \
</span></span><span class="line"><span class="ln">7</span><span class="cl">  -out /etc/elasticsearch/config/node-1.p12
</span></span></code></pre></div><p>用 openssl 看一下內容，如果有密碼這邊要用密碼解鎖</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -info -nokeys
</span></span></code></pre></div><p>server 用這個 certificate ，啟用 ssl。</p>
<p>client 使用這個 certificate 產生出來的 client.cer 與 client.key 與 server 連線，server 才接受客戶端是安全的。</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>25f5ab795b9e698333a36fde7ecf23a8ba9d4595
記得把所有權還給 elasticsearch 的使用者，避免 permission denied</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl"># Change owner to fix read permission
</span></span><span class="line"><span class="ln">2</span><span class="cl">chown -R elasticsearch:elasticsearch /etc/elasticsearch/config
</span></span></code></pre></div><p>有密碼記得也要用 keystore 把密碼加密後喂給 elasticsearch</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password
</span></span><span class="line"><span class="ln">2</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password
</span></span></code></pre></div><p>關於 X.509 Certifcate 之後有空我們來聊一下</p>
<h1 id="更新-elasticsearch-設定">更新 elasticsearch 設定</h1>
<p>Certificates 都生完了，接下來更改 elasticsearch 的參數，在 transport layer 啟用 ssl。啟用 security 後，在 transport layer 啟動 ssl 是必須的。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ sudo vim /etc/elasticsearch/elasticsearch.yml
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">xpack.security.enabled: true
</span></span><span class="line"><span class="ln">4</span><span class="cl">xpack.security.transport.ssl.enabled: true
</span></span><span class="line"><span class="ln">5</span><span class="cl"># use certificate. full will verify dns and ip
</span></span><span class="line"><span class="ln">6</span><span class="cl">xpack.security.transport.ssl.verification_mode: certificate
</span></span><span class="line"><span class="ln">7</span><span class="cl">xpack.security.transport.ssl.keystore.path: /etc/elasticsearch/config/node-1.p12
</span></span><span class="line"><span class="ln">8</span><span class="cl">xpack.security.transport.ssl.truststore.path: /etc/elasticsearch/config/node-1.p12
</span></span></code></pre></div><p>啟用 security 與 transport layer 的 ssl，然後指定 keystore路徑，讓 server 執行 client authentication
由於這筆 p12 帶有 CA certificate 作為 trusted certificate entry，所以也可以順便當作 trustore，讓 client 信任這個 CA</p>
<p>security 這邊提供了 server side (elasticsearch) 在檢查客戶端連線時的檢查模式(vertification mode)，<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#ssl-tls-settings">文件有說明</a>，可以設定</p>
<ul>
<li>certificate: 檢查 certificate 加密是否有效</li>
<li>full: 簽 node certificate 時可以指定 ip dns，啟用會檢查來源 node ip dns 是否也正確</li>
</ul>
<p>(Optional) HTTP layer 啟動 ssl</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">vim /etc/elasticsearch/elasticsearch.yml
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">xpack.security.http.ssl.enabled: true
</span></span><span class="line"><span class="ln">4</span><span class="cl">xpack.security.http.ssl.keystore.path: /etc/elasticsearch/config/node-1.p12
</span></span><span class="line"><span class="ln">5</span><span class="cl">xpack.security.http.ssl.truststore.path: /etc/elasticsearch/config/node-1.p12
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password
</span></span><span class="line"><span class="ln">8</span><span class="cl">/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.truststore.secure_password
</span></span></code></pre></div><p>重啟 elasticsearch，看一下 log</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">sudo systemctl restart elasticsearch
</span></span><span class="line"><span class="ln">2</span><span class="cl">tail -f /var/log/elasticsearch/elasticsearch.log
</span></span></code></pre></div><p>然後你就發現，原來 kibana 連入 的 http 連線，不斷被 server 這端拒絕。所以以下要來設定 kibana</p>
<hr>
<h1 id="kibana">Kibana</h1>
<ul>
<li><a href="https://www.elastic.co/guide/en/kibana/7.3/using-kibana-with-security.html">using kibana with security</a></li>
<li><a href="https://www.elastic.co/guide/en/kibana/7.3/configuring-tls.html">kibana configuring tls</a></li>
</ul>
<p>使用剛剛簽的 server certificate，從裡面 parse 出 client-ca.cer，還有 client.cer 與 client.key</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">mkdir -p /etc/kibana/config
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">$ openssl pkcs12 --help
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Usage: pkcs12 [options]
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">Valid options are:
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"> -chain              Add certificate chain
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"> -nokeys             Don&#39;t output private keys
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"> -nocerts            Don&#39;t output certificates
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"> -clcerts            Only output client certificates
</span></span><span class="line"><span class="ln">10</span><span class="cl"> -cacerts            Only output CA certificates
</span></span><span class="line"><span class="ln">11</span><span class="cl"> -info               Print info about PKCS#12 structure
</span></span><span class="line"><span class="ln">12</span><span class="cl"> -nodes              Don&#39;t encrypt private keys
</span></span><span class="line"><span class="ln">13</span><span class="cl"> -in infile          Input filename
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"># no certs, no descript
</span></span><span class="line"><span class="ln">16</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &gt; /etc/kibana/config/client.key
</span></span><span class="line"><span class="ln">17</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &gt; /etc/kibana/config/client.cer
</span></span><span class="line"><span class="ln">18</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &gt; /etc/kibana/config/client-ca.cer
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">sudo chown -R kibana:kibana /etc/kibana/config/
</span></span></code></pre></div><p>更改 kibana 連入 elasticsearch 的連線設定</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">sudo vim /etc/kigana/kibana.yml
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">elasticsearch.hosts: [&#34;https://elk.asia-east1-b.c.chechaichang.internal:9200&#34;]
</span></span><span class="line"><span class="ln">4</span><span class="cl">xpack.security.enabled: true
</span></span><span class="line"><span class="ln">5</span><span class="cl">elasticsearch.ssl.certificate: /etc/kibana/config/client.cer
</span></span><span class="line"><span class="ln">6</span><span class="cl">elasticsearch.ssl.key: /etc/kibana/config/client.key
</span></span><span class="line"><span class="ln">7</span><span class="cl">elasticsearch.ssl.certificateAuthorities: [ &#34;/etc/kibana/config/client-ca.cer&#34; ]
</span></span><span class="line"><span class="ln">8</span><span class="cl">elasticsearch.ssl.verificationMode: full
</span></span></code></pre></div><ul>
<li>指定 ssl.certificate, ssl.key 做連線 elasticsearch server 時的 user authentication</li>
<li>由於我們是 self-signed CA，所以需要讓客戶端信任這個我們自簽的 CA</li>
</ul>
<p>注意這邊 elasticsearch.hosts 我們已經從 http://localhost 換成 https 的內部 dns，原有的 localhost 已經無法使用（如果 elasicsearch 有 enforce https 的話）</p>
<p>重啟 Kibana，看一下 log</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">sudo systemctl restart kibana
</span></span><span class="line"><span class="ln">2</span><span class="cl">journalctl -fu kibana
</span></span></code></pre></div><p>如果沒有一直噴 ssl certificate error 的話，恭喜你成功了</p>
<p>然而，除了 kibana 以外，我們還有其他的 client 需要連入 elasticsearch</p>
<ul>
<li>把上述步驟在 apm-server, filebeat, 其他的 beat 上也設定</li>
<li>如果在 k8s 上，要把 cer, key 等檔案用 volume 掛進去
&laquo;&laquo;&laquo;&lt; HEAD</li>
</ul>
<p>Kibana 本身也有 server 的功能，讓其他 client 連入。例如讓 filebeat 自動將 document tempalte 匯入 kibana，我們也需要設定</p>
<ul>
<li>kibana server certificate</li>
<li>filebeat client to kibana server</li>
</ul>
<p>=======</p>
<p>Kibana 本身也有 server 的功能，讓其他 client 連入。例如讓 filebeat 自動將 document tempalte 匯入 kibana，我們也需要設定</p>
<ul>
<li>kibana server certificate</li>
<li>filebeat client to kibana server</li>
</ul>
<p>就是他們彼此互打，都要有 ca, key, cert</p>
<h3 id="但基本上的設定都一樣下面可以不用看下去了xd">但基本上的設定都一樣，下面可以不用看下去了XD</h3>
<p>如果有用到再查文件就好，這邊直接小結</p>
<ul>
<li>設定 security 前要先想號自己的需求，如何連入，安全性設定到哪邊</li>
<li>使用 utility 自簽 CA，然後產生 server certificate</li>
<li>使用 server certificate 再 parse 出 ca-certificate, client cers, key</li>
</ul>
<hr>
<h1 id="kibana-作為-server">kibana 作為 server</h1>
<p>工作路徑可能是這樣： app(apm-client library) -&gt; apm-server -&gt; kibana -&gt; elasticsearch</p>
<ul>
<li>kibana 連入 elasticsearch時， kibana 是 client 吃 elasticsearch 的憑證</li>
<li>apm-server 連入 kibana時，kibana 是 server，apm-server 吃 kibana 的憑證</li>
</ul>
<p>首先更改 kibana 設定</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ sudo vim /etc/kibana/kibana.yml
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">server.ssl.enabled: true
</span></span><span class="line"><span class="ln">4</span><span class="cl">server.ssl.certificate: /etc/kibana/config/client.cer
</span></span><span class="line"><span class="ln">5</span><span class="cl">server.ssl.key: /etc/kibana/config/client.key
</span></span></code></pre></div><p>重啟 kibana</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">journalctl -fu kibana
</span></span></code></pre></div><h1 id="apm-server">Apm-server</h1>
<p><a href="https://www.elastic.co/guide/en/apm/server/7.3/securing-apm-server.html">https://www.elastic.co/guide/en/apm/server/7.3/securing-apm-server.html</a></p>
<p>應用端的 apm-client (ex. apm-python-client)，連入 apm-server</p>
<ul>
<li>在 http 的狀況下，雖然有使用 secret-token，但還是裸奔</li>
<li>在 https 的狀況下，要把 certificates，然後餵給應用端的client library</li>
</ul>
<p>更改 apm-server 的設定</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">sudo vim /etc/apm-server/apm-server.yml
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">host: &#34;0.0.0.0:8200&#34;
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  secret_token: &lt;設定一組夠安全的 token&gt;
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  rum:
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    enabled: true
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">kibana:
</span></span><span class="line"><span class="ln">10</span><span class="cl">  protocol: &#34;https&#34;
</span></span><span class="line"><span class="ln">11</span><span class="cl">  ssl.enabled: true
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">output.kibana:
</span></span><span class="line"><span class="ln">14</span><span class="cl">  enable: false # can only have 1 output
</span></span><span class="line"><span class="ln">15</span><span class="cl">output.elasticsearch:
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">monitoring.elasticsearch:
</span></span><span class="line"><span class="ln">18</span><span class="cl">  protocol: &#34;https&#34;
</span></span><span class="line"><span class="ln">19</span><span class="cl">  username: &#34;elastic&#34;
</span></span><span class="line"><span class="ln">20</span><span class="cl">  password: &#34;*******************&#34;
</span></span><span class="line"><span class="ln">21</span><span class="cl">  hosts: [&#34;elk.asia-east1-b.c.checahichang.internal:9200&#34;]
</span></span><span class="line"><span class="ln">22</span><span class="cl">  ssl.enabled: true
</span></span><span class="line"><span class="ln">23</span><span class="cl">  ssl.verification_mode: full
</span></span><span class="line"><span class="ln">24</span><span class="cl">  ssl.certificate_authorities: [&#34;/etc/apm-server/config/client-ca.cer&#34;]
</span></span><span class="line"><span class="ln">25</span><span class="cl">  ssl.certificate: &#34;/etc/apm-server/config/client.cer&#34;
</span></span><span class="line"><span class="ln">26</span><span class="cl">  ssl.key: &#34;/etc/apm-server/config/client.key&#34;
</span></span></code></pre></div><p>重啟 apm-server</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">systemctl restart apm-server
</span></span><span class="line"><span class="ln">2</span><span class="cl">journalctl -fu apm-server
</span></span></code></pre></div><h1 id="apm-library">APM library</h1>
<p>應用端的設定就需要依據 library 的實做設定，例如 flask-apmagent-python</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">ELASTIC_APM_SERVER_CERT=/etc/elk/certificates/client.cer
</span></span></code></pre></div><p><a href="https://www.elastic.co/guide/en/apm/agent/python/current/configuration.html#config-server-cert">apm agent python config server cert</a></p>
<h1 id="filebeat">filebeat</h1>
<p>記得我們在 node 上有安裝 Self-monitoring filebeat，elasticsearch 改成 ssl 這邊當然也連不盡去了，再做同樣操作</p>
<p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html">https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">sudo apt-get install filebeat
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">mkdir -p /etc/filebeat/config
</span></span><span class="line"><span class="ln">4</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &gt; /etc/filebeat/config/client.key
</span></span><span class="line"><span class="ln">5</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &gt; /etc/filebeat/config/client.cer
</span></span><span class="line"><span class="ln">6</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &gt; /etc/filebeat/config/client-ca.cer
</span></span></code></pre></div><p>Restart filebeat</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">systemctl restart filebeat
</span></span><span class="line"><span class="ln">2</span><span class="cl">journalctl -fu filebeat
</span></span></code></pre></div><hr>
<h1 id="如果你的應用在-kubernetes-上">如果你的應用在 kubernetes 上</h1>
<p>可以使用下面方法拿到 client.cer ，然後用 secret 塞進 k8s，在用 volume from secrets，掛給監測應用的 filebeat</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">mkdir -p /etc/beats/config
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &gt; /etc/beats/config/client.key
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &gt; /etc/beats/config/client.cer
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &gt; /etc/beats/config/client-ca.cer
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">gcloud compute scp elk:/etc/beats/config/* .
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"> client-ca.cer
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"> client.cer
</span></span><span class="line"><span class="ln">10</span><span class="cl"> client.key
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">kubectl -n elk create secret generic elk-client-certificates \
</span></span><span class="line"><span class="ln">13</span><span class="cl">  --from-file=client-ca.cer=client-ca.cer \
</span></span><span class="line"><span class="ln">14</span><span class="cl">  --from-file=client.cer=client.cer \
</span></span><span class="line"><span class="ln">15</span><span class="cl">  --from-file=client.key=client.key
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">kubectl apply -f elk/gke/filebeat/
</span></span></code></pre></div>
    </div>
<div class="post_comments">
  
  
  
</div>




  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <br>
    

        <h2>Che-Chia Chang</h2>
      <div class="author_bio">
        DevOps, SRE, Kubernetes admin.
      </div>
      <a href='https://chechia.net/about/' class="button mt-1" role="button" title='Read More'>Read More</a>

    
    
    <h2 class="mt-4">Featured Posts</h2>
    <ul>
      <li>
        <a href="https://chechia.net/post/2022-09-20-14th-ithome-ironman-iac-aws-workshop-07-reset-iam-user/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop 07 Reset Iam User">14th Ithome Ironman Iac Aws Workshop 07 Reset Iam User</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-20-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop 06 Provision Iam Group Policy">14th Ithome Ironman Iac Aws Workshop 06 Provision Iam Group Policy</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-19-14th-ithome-ironman-iac-aws-workshop-05-provision-iam-user/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop 05 Provision Iam User">14th Ithome Ironman Iac Aws Workshop 05 Provision Iam User</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-18-14th-ithome-ironman-iac-aws-workshop-04-aws-multi-account-structure/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop 04 AWS Multi-Accounts Structure">14th Ithome Ironman Iac Aws Workshop 04 AWS Multi-Accounts Structure</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-16-14th-ithome-ironman-iac-aws-workshop-03-provision-aws-account/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop-03 Provision Child AWS Accounts">14th Ithome Ironman Iac Aws Workshop-03 Provision Child AWS Accounts</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-15-14th-ithome-ironman-iac-aws-workshop-02-aws-account-structure/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop-02 AWS Account Struture">14th Ithome Ironman Iac Aws Workshop-02 AWS Account Struture</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-12-14th-ithome-ironman-iac-aws-workshop-01-introduction/" class="nav-link" title="14th iThome ironman-01 IaC best practice workshop on aws">14th iThome ironman-01 IaC best practice workshop on aws</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-06-09-ithome-devopsday-2022-proposal-introduce-policy-as-code-for-terraform-/" class="nav-link" title="IThome 2022 DevOpsDay Introducing policy as code for terraform">IThome 2022 DevOpsDay Introducing policy as code for terraform</a>
      </li>
    </ul>
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://chechia.net/categories/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">44</span>
        </a>
        
        <a href='https://chechia.net/categories/terraform/' class="post_tag button button_translucent" title="terraform">
          TERRAFORM
          <span class="button_tally">15</span>
        </a>
        
        <a href='https://chechia.net/categories/kafka/' class="post_tag button button_translucent" title="kafka">
          KAFKA
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/categories/prometheus/' class="post_tag button button_translucent" title="prometheus">
          PROMETHEUS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/categories/redis/' class="post_tag button button_translucent" title="redis">
          REDIS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/categories/elasticsearch/' class="post_tag button button_translucent" title="elasticsearch">
          ELASTICSEARCH
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://chechia.net/categories/cert-manager/' class="post_tag button button_translucent" title="cert-manager">
          CERT-MANAGER
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://chechia.net/categories/technology/' class="post_tag button button_translucent" title="technology">
          TECHNOLOGY
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://chechia.net/categories/blockchain/' class="post_tag button button_translucent" title="blockchain">
          BLOCKCHAIN
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/crd/' class="post_tag button button_translucent" title="crd">
          CRD
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/logstash/' class="post_tag button button_translucent" title="logstash">
          LOGSTASH
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/murmur/' class="post_tag button button_translucent" title="murmur">
          MURMUR
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/nginx/' class="post_tag button button_translucent" title="nginx">
          NGINX
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/certificate/' class="post_tag button button_translucent" title="certificate">
          CERTIFICATE
          <span class="button_tally">1</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Categories</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://chechia.net/categories/blockchain/' class=" post_tag button button_translucent" data-position=2 title="blockchain">BLOCKCHAIN<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/cert-manager/' class=" post_tag button button_translucent" data-position=3 title="cert-manager">CERT-MANAGER<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/categories/certificate/' class=" post_tag button button_translucent" data-position=1 title="certificate">CERTIFICATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/crd/' class=" post_tag button button_translucent" data-position=2 title="crd">CRD<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/devops/' class=" post_tag button button_translucent" data-position=1 title="devops">DEVOPS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/distributed-system/' class=" post_tag button button_translucent" data-position=1 title="distributed-system">DISTRIBUTED-SYSTEM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/elasticsearch/' class=" post_tag button button_translucent" data-position=4 title="elasticsearch">ELASTICSEARCH<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://chechia.net/categories/golang/' class=" post_tag button button_translucent" data-position=1 title="golang">GOLANG<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/istio/' class=" post_tag button button_translucent" data-position=1 title="istio">ISTIO<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/jenkins/' class=" post_tag button button_translucent" data-position=1 title="jenkins">JENKINS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/kafka/' class=" post_tag button button_translucent" data-position=7 title="kafka">KAFKA<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/categories/kubernetes/' class=" post_tag button button_translucent" data-position=44 title="kubernetes">KUBERNETES<span class="button_tally">44</span>
            </a>
            
            
            <a href='https://chechia.net/categories/logstash/' class=" post_tag button button_translucent" data-position=2 title="logstash">LOGSTASH<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/murmur/' class=" post_tag button button_translucent" data-position=2 title="murmur">MURMUR<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/nginx/' class=" post_tag button button_translucent" data-position=2 title="nginx">NGINX<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/prometheus/' class=" post_tag button button_translucent" data-position=5 title="prometheus">PROMETHEUS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/categories/redis/' class=" post_tag button button_translucent" data-position=5 title="redis">REDIS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/categories/technology/' class=" post_tag button button_translucent" data-position=3 title="technology">TECHNOLOGY<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/categories/terraform/' class=" post_tag button button_translucent" data-position=15 title="terraform">TERRAFORM<span class="button_tally">15</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://chechia.net/tags/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">50</span>
        </a>
        
        <a href='https://chechia.net/tags/ithome/' class="post_tag button button_translucent" title="ithome">
          ITHOME
          <span class="button_tally">20</span>
        </a>
        
        <a href='https://chechia.net/tags/terraform/' class="post_tag button button_translucent" title="terraform">
          TERRAFORM
          <span class="button_tally">18</span>
        </a>
        
        <a href='https://chechia.net/tags/devops/' class="post_tag button button_translucent" title="devops">
          DEVOPS
          <span class="button_tally">11</span>
        </a>
        
        <a href='https://chechia.net/tags/gcp/' class="post_tag button button_translucent" title="gcp">
          GCP
          <span class="button_tally">10</span>
        </a>
        
        <a href='https://chechia.net/tags/kafka/' class="post_tag button button_translucent" title="kafka">
          KAFKA
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://chechia.net/tags/aws/' class="post_tag button button_translucent" title="aws">
          AWS
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/tags/iac/' class="post_tag button button_translucent" title="iac">
          IAC
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/tags/preemptible/' class="post_tag button button_translucent" title="preemptible">
          PREEMPTIBLE
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/tags/spot-instance/' class="post_tag button button_translucent" title="spot-instance">
          SPOT-INSTANCE
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/tags/redis/' class="post_tag button button_translucent" title="redis">
          REDIS
          <span class="button_tally">6</span>
        </a>
        
        <a href='https://chechia.net/tags/elasticsearch/' class="post_tag button button_translucent" title="elasticsearch">
          ELASTICSEARCH
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/tags/logstash/' class="post_tag button button_translucent" title="logstash">
          LOGSTASH
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/tags/prometheus/' class="post_tag button button_translucent" title="prometheus">
          PROMETHEUS
          <span class="button_tally">5</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Tags</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://chechia.net/tags/atomic-swap/' class=" post_tag button button_translucent" data-position=1 title="atomic-swap">ATOMIC-SWAP<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/aws/' class=" post_tag button button_translucent" data-position=7 title="aws">AWS<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/tags/bep3/' class=" post_tag button button_translucent" data-position=1 title="bep3">BEP3<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/binance/' class=" post_tag button button_translucent" data-position=1 title="binance">BINANCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/blockchain/' class=" post_tag button button_translucent" data-position=2 title="blockchain">BLOCKCHAIN<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/borg/' class=" post_tag button button_translucent" data-position=2 title="borg">BORG<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/cd/' class=" post_tag button button_translucent" data-position=1 title="cd">CD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/cert-manager/' class=" post_tag button button_translucent" data-position=4 title="cert-manager">CERT-MANAGER<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://chechia.net/tags/certificate/' class=" post_tag button button_translucent" data-position=1 title="certificate">CERTIFICATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ci/' class=" post_tag button button_translucent" data-position=1 title="ci">CI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/container/' class=" post_tag button button_translucent" data-position=1 title="container">CONTAINER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/crd/' class=" post_tag button button_translucent" data-position=3 title="crd">CRD<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/cri/' class=" post_tag button button_translucent" data-position=1 title="cri">CRI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/devops/' class=" post_tag button button_translucent" data-position=11 title="devops">DEVOPS<span class="button_tally">11</span>
            </a>
            
            
            <a href='https://chechia.net/tags/distributed-system/' class=" post_tag button button_translucent" data-position=1 title="distributed-system">DISTRIBUTED-SYSTEM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/docker/' class=" post_tag button button_translucent" data-position=1 title="docker">DOCKER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/elasticsearch/' class=" post_tag button button_translucent" data-position=5 title="elasticsearch">ELASTICSEARCH<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/tags/elk/' class=" post_tag button button_translucent" data-position=1 title="elk">ELK<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/erc-20/' class=" post_tag button button_translucent" data-position=1 title="erc-20">ERC-20<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ethereum/' class=" post_tag button button_translucent" data-position=1 title="ethereum">ETHEREUM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/filebeat/' class=" post_tag button button_translucent" data-position=1 title="filebeat">FILEBEAT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/fluentd/' class=" post_tag button button_translucent" data-position=1 title="fluentd">FLUENTD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/gcp/' class=" post_tag button button_translucent" data-position=10 title="gcp">GCP<span class="button_tally">10</span>
            </a>
            
            
            <a href='https://chechia.net/tags/golang/' class=" post_tag button button_translucent" data-position=1 title="golang">GOLANG<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/google/' class=" post_tag button button_translucent" data-position=2 title="google">GOOGLE<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/haproxy/' class=" post_tag button button_translucent" data-position=3 title="haproxy">HAPROXY<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/iac/' class=" post_tag button button_translucent" data-position=7 title="iac">IAC<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ibm-q-experience/' class=" post_tag button button_translucent" data-position=1 title="ibm-q-experience">IBM-Q-EXPERIENCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/index/' class=" post_tag button button_translucent" data-position=1 title="index">INDEX<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ingress/' class=" post_tag button button_translucent" data-position=2 title="ingress">INGRESS<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/istio/' class=" post_tag button button_translucent" data-position=1 title="istio">ISTIO<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ithome/' class=" post_tag button button_translucent" data-position=20 title="ithome">ITHOME<span class="button_tally">20</span>
            </a>
            
            
            <a href='https://chechia.net/tags/jenkins/' class=" post_tag button button_translucent" data-position=1 title="jenkins">JENKINS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/kafka/' class=" post_tag button button_translucent" data-position=9 title="kafka">KAFKA<span class="button_tally">9</span>
            </a>
            
            
            <a href='https://chechia.net/tags/kubernetes/' class=" post_tag button button_translucent" data-position=50 title="kubernetes">KUBERNETES<span class="button_tally">50</span>
            </a>
            
            
            <a href='https://chechia.net/tags/lecture/' class=" post_tag button button_translucent" data-position=1 title="lecture">LECTURE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/logstash/' class=" post_tag button button_translucent" data-position=5 title="logstash">LOGSTASH<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/tags/mit/' class=" post_tag button button_translucent" data-position=1 title="mit">MIT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/nginx/' class=" post_tag button button_translucent" data-position=3 title="nginx">NGINX<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/pac/' class=" post_tag button button_translucent" data-position=1 title="pac">PAC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/preemptible/' class=" post_tag button button_translucent" data-position=7 title="preemptible">PREEMPTIBLE<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/tags/prometheus/' class=" post_tag button button_translucent" data-position=5 title="prometheus">PROMETHEUS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/tags/quantum-computing/' class=" post_tag button button_translucent" data-position=1 title="quantum-computing">QUANTUM-COMPUTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/redis/' class=" post_tag button button_translucent" data-position=6 title="redis">REDIS<span class="button_tally">6</span>
            </a>
            
            
            <a href='https://chechia.net/tags/spot-instance/' class=" post_tag button button_translucent" data-position=7 title="spot-instance">SPOT-INSTANCE<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/tags/terraform/' class=" post_tag button button_translucent" data-position=18 title="terraform">TERRAFORM<span class="button_tally">18</span>
            </a>
            
            
            <a href='https://chechia.net/tags/tls/' class=" post_tag button button_translucent" data-position=3 title="tls">TLS<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/tutorial/' class=" post_tag button button_translucent" data-position=1 title="tutorial">TUTORIAL<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/vault/' class=" post_tag button button_translucent" data-position=1 title="vault">VAULT<span class="button_tally">1</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord">
    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
  </symbol>
</svg>


<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://chechia.net/icons/apple-touch-icon.png' class="icon icon_2 transparent" alt="Che-Chia Chang">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;CHE-CHIA CHANG. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <title>to-top</title>
  <use xlink:href="#to-top"></use>
</svg>

</a>

  </div>
</footer>

<script type="text/javascript" src="https://chechia.net/en/js/bundle.6703cf5a19523ed401d8d9e012876ed46642e5b6019e567fb9fe7ad6f46ba535d6a1293fe06a8dfd091cf068a6f11fc605273b8b06177a6d0c09579ab0400cf5.js" integrity="sha512-ZwPPWhlSPtQB2NngEodu1GZC5bYBnlZ/uf561vRrpTXWoSk/4GqN/Qkc8Gim8R/GBSc7iwYXem0MCVeasEAM9Q==" crossorigin="anonymous"></script>
  </body>
</html>
