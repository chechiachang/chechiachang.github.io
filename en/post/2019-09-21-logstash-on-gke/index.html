<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: October 18, 2024 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.7" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.f6689966c0a10712f95f034011917db0.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  






<script async src="https://www.googletagmanager.com/gtag/js?id=G-QYR8JCDGM9"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'G-QYR8JCDGM9', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>




<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NSBJFRS');
</script>





















  
  
  






  <meta name="author" content="Che-Chia Chang" />





  

<meta name="description" content="2020 It邦幫忙鐵人賽 系列文章
Self-host ELK stack on GCP Secure ELK Stask 監測 Google Compute Engine 上服務的各項數據 監測 Google Kubernetes Engine 的各項數據 是否選擇 ELK 作為解決方案 使用 logstash pipeline 做數據前處理 Elasticsearch 日常維護：數據清理，效能調校，永久儲存 Debug ELK stack on GCP 作為範例的 ELK 的版本是當前的 stable release 7." />



  <link rel="alternate" hreflang="zh-hant" href="https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/" />

<link rel="alternate" hreflang="en-us" href="https://chechia.net/en/post/2019-09-21-logstash-on-gke/" />
<link rel="canonical" href="https://chechia.net/en/post/2019-09-21-logstash-on-gke/" />



  <link rel="manifest" href="/en/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  
  






<meta property="twitter:card" content="summary" />

  <meta property="twitter:site" content="@chechiachang" />
  <meta property="twitter:creator" content="@chechiachang" />
<meta property="twitter:image" content="https://chechia.net/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png" />



  

<meta property="og:type" content="article" />
<meta property="og:site_name" content="Che-Chia Chang" />
<meta property="og:url" content="https://chechia.net/en/post/2019-09-21-logstash-on-gke/" />
<meta property="og:title" content="Logstash on GKE | Che-Chia Chang" />
<meta property="og:description" content="2020 It邦幫忙鐵人賽 系列文章
Self-host ELK stack on GCP Secure ELK Stask 監測 Google Compute Engine 上服務的各項數據 監測 Google Kubernetes Engine 的各項數據 是否選擇 ELK 作為解決方案 使用 logstash pipeline 做數據前處理 Elasticsearch 日常維護：數據清理，效能調校，永久儲存 Debug ELK stack on GCP 作為範例的 ELK 的版本是當前的 stable release 7." /><meta property="og:image" content="https://chechia.net/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2019-09-21T15:22:23&#43;08:00"
    />
  
  
    <meta property="article:modified_time" content="2023-09-11T22:33:54&#43;08:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chechia.net/en/post/2019-09-21-logstash-on-gke/"
  },
  "headline": "Logstash on GKE",
  
  "datePublished": "2019-09-21T15:22:23+08:00",
  "dateModified": "2023-09-11T22:33:54+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Che-Chia Chang"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "chechia-net",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chechia.net/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "2020 It邦幫忙鐵人賽 系列文章\nSelf-host ELK stack on GCP Secure ELK Stask 監測 Google Compute Engine 上服務的各項數據 監測 Google Kubernetes Engine 的各項數據 是否選擇 ELK 作為解決方案 使用 logstash pipeline 做數據前處理 Elasticsearch 日常維護：數據清理，效能調校，永久儲存 Debug ELK stack on GCP 作為範例的 ELK 的版本是當前的 stable release 7."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>Logstash on GKE | Che-Chia Chang</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="cb81847665ce4fb1036e4f4760a2ff02" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.9e4214442a7711d35691acd58f6f6361.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/en/">Che-Chia Chang</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/en/">Che-Chia Chang</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#talks"><span>Talks</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#projects"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://www.instagram.com/c.c.leather/" target="_blank" rel="noopener"><span>Leather</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://www.instagram.com/dive.with.cat.coach/" target="_blank" rel="noopener"><span>Scuba</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://mvp.microsoft.com/zh-TW/mvp/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5" target="_blank" rel="noopener"><span>MVP</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://github.com/chechiachang" data-toggle="tooltip" data-placement="bottom" title="Check my Github" target="_blank" rel="noopener" aria-label="Check my Github">
                <i class="fab fa-github" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://www.facebook.com/engineer.from.scratch" data-toggle="tooltip" data-placement="bottom" title="Follow me on facebook" target="_blank" rel="noopener" aria-label="Follow me on facebook">
                <i class="fab fa-facebook" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        
        <li class="nav-item dropdown i18n-dropdown">
          <a href="#" class="nav-link " data-toggle="dropdown"
             aria-haspopup="true" aria-label="Languages">
            <i class="fas fa-globe mr-1" aria-hidden="true"></i></a>
          <div class="dropdown-menu">
            <div class="dropdown-item dropdown-item-active">
              <span>English</span>
            </div>
            
            <a class="dropdown-item" href="https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/">
              <span>中文 (繁體)</span>
            </a>
            
          </div>
        </li>
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  













  

  
  
  
<div class="article-container pt-3">
  <h1>Logstash on GKE</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Sep 11, 2023
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/en/category/kubernetes/">kubernetes</a>, <a href="/en/category/elasticsearch/">elasticsearch</a></span>
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <p><a href="https://ithelp.ithome.com.tw/2020ironman" target="_blank" rel="noopener">2020 It邦幫忙鐵人賽</a> 系列文章</p>
<ul>
<li><a href="https://chechia.net/en/post/2019-09-15-self-host-elk-stack-on-gcp/">Self-host ELK stack on GCP</a></li>
<li><a href="https://chechia.net/en/post/2019-09-15-secure-elk-stack/">Secure ELK Stask</a></li>
<li><a href="https://chechia.net/en/post/2019-09-18-monitoring-gce-with-elk/">監測 Google Compute Engine 上服務的各項數據</a></li>
<li><a href="https://chechia.net/en/post/2019-09-19-monitoring-gke-with-elk/">監測 Google Kubernetes Engine 的各項數據</a></li>
<li><a href="https://chechia.net/en/post/2019-09-18-elastic-or-not-elastic/">是否選擇 ELK 作為解決方案</a></li>
<li><a href="https://chechia.net/en/post/2019-09-21-logstash-on-gke/">使用 logstash pipeline 做數據前處理</a></li>
<li>Elasticsearch 日常維護：數據清理，效能調校，永久儲存</li>
<li>Debug ELK stack on GCP</li>
</ul>
<p>作為範例的 ELK 的版本是當前的 stable release 7.3.1。</p>
<p>由於我比較熟悉 GCP / GKE 的服務，這篇的操作過程都會以 GCP 平台作為範例，不過操作過程大體上是跨平台通用的。</p>
<hr>
<h1 id="摘要">摘要</h1>
<ul>
<li>簡介 logstash</li>
<li>將 logstash 部屬到 kubernetes 上</li>
<li>設定 logstash pipeline 處理 nginx access log</li>
</ul>
<h1 id="介紹-logstash">介紹 Logstash</h1>
<p>Logstash 是開元的資料處理引擎，可以動態的將輸入的資料做大量的處裡。原先的目的是處理 log ，但目前以不限於處理 log ，各種 ELK beat 或是其他來源的不同監測數據，都能處理。</p>
<p>Logastash 內部的功能也大多模組化，因此可以組裝不同的 plugin，來快速處理不同來源資料。</p>
<p>基本上常見的資料來源，logstash 都能夠處理，並且有寫好的 plugin 可以直接使用，細節請見<a href="https://www.elastic.co/guide/en/logstash/current/introduction.html" target="_blank" rel="noopener">logstash 官方文件</a></p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="https://www.elastic.co/guide/en/logstash/current/static/images/logstash.png" alt="官方架構圖" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h1 id="後送資料庫與最終儲存庫">後送資料庫與最終儲存庫</h1>
<p>在開始架設 logstash 要先考慮 pipeline 處理過後送的資料庫，<a href="https://www.elastic.co/guide/en/logstash/current/introduction.html#_choose_your_stash" target="_blank" rel="noopener">可使用的資料庫非常多</a>，這邊會展示的有：</p>
<ul>
<li>ELK Stack 標準配備送到 Elasticsearch
<ul>
<li>存放會時常查詢的熱資料，只存放一段時間前的資料</li>
<li>太舊的資料自動 Rollout</li>
</ul>
</li>
<li>最終 archieving 的資料庫，這邊使用 GCP 的 Big Query
<ul>
<li>存放查找次數少，但非常大量的歷史紀錄。</li>
</ul>
</li>
</ul>
<p>Elasticsearch 在前幾篇已經架設好，<a href="https://cloud.google.com/bigquery/docs/?hl=zh-tw" target="_blank" rel="noopener">GCP Big Query</a> 的設定也事先開好。</p>
<h1 id="部屬-logstash">部屬 Logstash</h1>
<p>kubernetes resource 的 yaml 請參考 <a href="https://github.com/chechiachang/elk-kubernetes/tree/master/logstash" target="_blank" rel="noopener">我的 github elk-kubernetes</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl apply -f config-configmap.yaml
</span></span><span class="line"><span class="cl">kubectl apply -f pipelines-configmap.yam
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl apply -f deployment.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl apply -f service.yaml
</span></span></code></pre></div><p>放上去的 resource</p>
<ul>
<li>config-configmap:
<ul>
<li>Logstash 服務本身啟動的設定參數</li>
</ul>
</li>
<li>pipelines-configmap:
<ul>
<li>Logstash 的 pipelines 設定檔案</li>
</ul>
</li>
<li>Lostagh Deployment
<ul>
<li>Logastash 的服務 instance</li>
<li>可以動態 scaling，也就是會有複數 Logstash instance 做負載均衡</li>
</ul>
</li>
<li>Logstash service
<ul>
<li>可透過 kubernetes 內部的 kube-dns 服務</li>
<li>集群內的 filebeat 可以直接透過 logstash.default.svc.chechiachang-cluster.local 的 dns 連線 logstash</li>
<li>集群內的網路，直接使用 http（當然使用 https 也是可以，相關步驟請見前幾篇文章）</li>
</ul>
</li>
</ul>
<p>簡單講一下 kubernetes service 的負載均衡，關於 <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">kubernetes service 細節這篇附上文件</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl get services
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)    AGE
</span></span><span class="line"><span class="cl">logstash          ClusterIP      10.15.254.47    &lt;none&gt;          5044/TCP   182d
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl get endpoints
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME              ENDPOINTS                                                          AGE
</span></span><span class="line"><span class="cl">logstash          10.12.0.132:5044,10.12.10.162:5044,10.12.9.167:5044 + 12 more...   182d
</span></span></code></pre></div><ul>
<li>在 Kubernetes 內部每個 Pod 都能看到 logstash, logstash.default.svc.chechiachang-cluster.local 這兩個 dns</li>
<li>DNS 直接指向複數的 logstash endpoints， 每一個 ip 都是 kubernetes 內部配置的一個 Pod 的 IP，開啟 5044 的 logstash port</li>
<li>Service 的 load balance 機制視 service 設定，細節可以看<a href="https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies" target="_blank" rel="noopener">這邊</a></li>
</ul>
<p>講到最白，就是 filebeat LOGSTASH URL 設定為 http://logstash 就會打到其中一台 logstash</p>
<p>更改 filebeat configmap</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl edit configmap filebeat-configmap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Disable output to elasticsearch
</span></span><span class="line"><span class="cl">output.elasticsearch:
</span></span><span class="line"><span class="cl">  enabled: false
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Output to logstash
</span></span><span class="line"><span class="cl">output.logstash:
</span></span><span class="line"><span class="cl">  hosts: [&#34;logstash:5044&#34;]
</span></span><span class="line"><span class="cl">  protocol: &#34;http&#34;
</span></span><span class="line"><span class="cl">  username: &#34;elastic&#34;
</span></span><span class="line"><span class="cl">  password: 
</span></span></code></pre></div><h1 id="設定-logstash">設定 logstash</h1>
<p>這邊要先說，logstash 也支援 <a href="https://www.elastic.co/guide/en/logstash/7.3/configuring-centralized-pipelines.html" target="_blank" rel="noopener">centralized configuration</a>，如果你的 logstash 不是跑在 Kubernetes 上，沒辦法配置一套 configmap 就應用到全部的 instance，記的一定要使用。</p>
<p>Logastash 的運行設定 logstash.yml，這邊我們沒有做設定，都是預設值，有需求可以自行更改</p>
<p>當然之後要調整 batch size 或是 queue, cache 等等效能調校，也是來這邊改，改完 configmap ，rolling update logstash 就可以。</p>
<p>這邊主要是來講 pipeline 設定。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl describe configmap pipelines-configmap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: ConfigMap
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: logstash-pipelines
</span></span><span class="line"><span class="cl">  namespace: elk
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    k8s-app: logstash
</span></span><span class="line"><span class="cl">data:
</span></span><span class="line"><span class="cl">  # Nginx Template
</span></span><span class="line"><span class="cl">  # https://www.elastic.co/guide/en/logstash/7.3/logstash-config-for-filebeat-modules.html#parsing-nginx
</span></span><span class="line"><span class="cl">  nginx.conf: |
</span></span><span class="line"><span class="cl">  ...
</span></span></code></pre></div><p>Configmap 裡面只有一個 pipeline，就是 <code>nginx.conf</code>，我們這邊就只有一條，這邊一段一段看</p>
<h3 id="input">Input</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">input {
</span></span><span class="line"><span class="cl">  beats {
</span></span><span class="line"><span class="cl">    # The lisening port of logstash
</span></span><span class="line"><span class="cl">    port =&gt; 5044
</span></span><span class="line"><span class="cl">    host =&gt; &#34;0.0.0.0&#34;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>設定 Input 來源，是 beat 從 5044 進來</p>
<h3 id="filter">Filter</h3>
<p>接下來一大段是 filter，每個 filter 中間的 block 都是一個 plugin，logstash 支援非常多有趣的 plugin ，處理不同來源的工作，<a href="https://www.elastic.co/guide/en/logstash/7.3/filter-plugins.html" target="_blank" rel="noopener">細節請看這篇</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">filter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Ignore data from other source in case filebeat input is incorrectly configured.</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">[</span><span class="n">kubernetes</span><span class="p">][</span><span class="n">container</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;nginx-ingress-controller&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Parse message with grok</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Use grok debugger in kibana -&gt; dev_tools -&gt; grok_debugger</span>
</span></span><span class="line"><span class="cl">    <span class="n">grok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&#34;message&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;%{IPORHOST:[nginx][access][remote_ip]} - \[%{IPORHOST:[nginx][access][remote_ip_list]}\] - %{DATA:[nginx][access][user_name]} \[%{HTTPDATE:[nginx][access][time]}\] </span><span class="se">\&#34;</span><span class="s2">%{WORD:[nginx][access][method]} %{DATA:[nginx][access][request_url]} HTTP/%{NUMBER:[nginx][access][http_version]}</span><span class="se">\&#34;</span><span class="s2"> %{NUMBER:[nginx][access][response_code]} %{NUMBER:[nginx][access][body_sent][bytes]} </span><span class="se">\&#34;</span><span class="s2">%{DATA:[nginx][access][referrer]}</span><span class="se">\&#34;</span><span class="s2"> </span><span class="se">\&#34;</span><span class="s2">%{DATA:[nginx][access][agent]}</span><span class="se">\&#34;</span><span class="s2"> %{NUMBER:[nginx][access][request_length]} %{NUMBER:[nginx][access][request_time]} \[%{DATA:[nginx][access][proxy_upstream_name]}\] %{DATA:[nginx][access][upstream_addr]} %{NUMBER:[nginx][access][upstream_response_length]} %{NUMBER:[nginx][access][upstream_response_time]} %{NUMBER:[nginx][access][upstream_status]} %{DATA:[nginx][access][req_id]}&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Match url parameters if has params</span>
</span></span><span class="line"><span class="cl">    <span class="n">grok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&#34;[nginx][access][request_url]&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;%{DATA:[nginx][access][url]}\?%{DATA:[nginx][access][url_params]}&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove and add fields</span>
</span></span><span class="line"><span class="cl">    <span class="n">mutate</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][request_url]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">add_field</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&#34;read_timestamp&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;%{@timestamp}&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Add fileset.module:nginx to fit nginx dashboard</span>
</span></span><span class="line"><span class="cl">      <span class="n">add_field</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&#34;[fileset][module]&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;nginx&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">add_field</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&#34;[fileset][name]&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;access&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Parse date string into timestamp</span>
</span></span><span class="line"><span class="cl">    <span class="n">date</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s2">&#34;[nginx][access][time]&#34;</span><span class="p">,</span> <span class="s2">&#34;dd/MMM/YYYY:H:m:s Z&#34;</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][time]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Split url_parameters with &amp;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># /api?uuid=123&amp;query=456 </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># become </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># nginx.access.url_params.uuid=123 nginx.access.url_params.query=456</span>
</span></span><span class="line"><span class="cl">    <span class="n">kv</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">source</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][url_params]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">field_split</span> <span class="o">=&gt;</span> <span class="s2">&#34;&amp;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Parse useragent</span>
</span></span><span class="line"><span class="cl">    <span class="n">useragent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">source</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][agent]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">target</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][user_agent]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][agent]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Search remote_ip with GeoIP database, output geoip information for map drawing</span>
</span></span><span class="line"><span class="cl">    <span class="n">geoip</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">source</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][remote_ip]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">target</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][geoip]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#fields =&gt; [&#34;country_name&#34;,&#34;city_name&#34;,&#34;real_region_name&#34;,&#34;latitude&#34;,&#34;longitude&#34;,&#34;ip&#34;,&#34;location&#34;]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ==============</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove message to reduce data</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ==============</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">[</span><span class="n">nginx</span><span class="p">][</span><span class="n">access</span><span class="p">][</span><span class="n">url</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">mutate</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># source:/var/lib/docker/containers/6e608bfc0a437c038a1dbdf2e3d28619648b58a1d1ac58635f8178fc5f871109/6e608bfc0a437c038a1dbdf2e3d28619648b58a1d1ac58635f8178fc5f871109-json.log</span>
</span></span><span class="line"><span class="cl">        <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[source]&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Origin message</span>
</span></span><span class="line"><span class="cl">        <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[message]&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#add_field =&gt; { &#34;[nginx][access][message]&#34; =&gt; &#34;[message]&#34;}</span>
</span></span><span class="line"><span class="cl">        <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][message]&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># url_params:client_id=1d5ffd378296c154d3e32e5890d6f4eb&amp;timestamp=1546849955&amp;nonce=9a52e3e6283f2a9263e5301b6724e2c0d723def860c4724c9121470152a42318</span>
</span></span><span class="line"><span class="cl">        <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="s2">&#34;[nginx][access][url_params]&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="c1"># nginx-ingress-controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1"># filter</span>
</span></span></code></pre></div><h3 id="grok">Grok</h3>
<p><a href="https://www.elastic.co/guide/en/logstash/7.3/plugins-filters-grok.html" target="_blank" rel="noopener">Grok 本身的文件</a>又是一大段，個人建議各路大德，如果要使用，請直接搜尋人家配置好的設定，不要自己寫</p>
<p>真的要寫的話要善用工具</p>
<ul>
<li>Kibana Grok Debugger <code>YOUR_KIBANA_HOST/app/kibana#/dev_tools/grokdebugger</code></li>
<li>或是不知名大德貢獻<a href="https://grokdebug.herokuapp.com/" target="_blank" rel="noopener">線上 Debugger</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">grok {
</span></span><span class="line"><span class="cl">  match =&gt; { &#34;message&#34; =&gt; &#34;%{IPORHOST:[nginx][access][remote_ip]} - \[%{IPORHOST:[nginx][access][remote_ip_list]}\] - %{DATA:[nginx][access][user_name]} \[%{HTTPDATE:[nginx][access][time]}\] \&#34;%{WORD:[nginx][access][method]} %{DATA:[nginx][access][request_url]} HTTP/%{NUMBER:[nginx][access][http_version]}\&#34; %{NUMBER:[nginx][access][response_code]} %{NUMBER:[nginx][access][body_sent][bytes]} \&#34;%{DATA:[nginx][access][referrer]}\&#34; \&#34;%{DATA:[nginx][access][agent]}\&#34; %{NUMBER:[nginx][access][request_length]} %{NUMBER:[nginx][access][request_time]} \[%{DATA:[nginx][access][proxy_upstream_name]}\] %{DATA:[nginx][access][upstream_addr]} %{NUMBER:[nginx][access][upstream_response_length]} %{NUMBER:[nginx][access][upstream_response_time]} %{NUMBER:[nginx][access][upstream_status]} %{DATA:[nginx][access][req_id]}&#34; }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>其實就是 nginx 的 access log</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1.2.3.4 - [1.2.3.4] - - [21/Sep/2019:07:21:21 +0000] &#34;GET /v1/core/api/list?type=queued&amp;timestamp=1569050481&amp;nonce=d1e80e00381e0ba6e42d4601912befcf03fbf291748e77b178230c19cd1fdbe2 HTTP/1.1&#34; 200 3 &#34;-&#34; &#34;python-requests/2.18.4&#34; 425 0.031 [default-chechiachang-server-80] 10.12.10.124:8003 3 0.031 200 f43db228afe66da67b2c7417d0ad2c04
</span></span></code></pre></div><p>預設的 log 送件來，格式是 text，經過 pattern matching 後變成 json-like format，也就是可以從資料結構取得 <code>.nginx.access.remote_ip</code> 這樣的欄位，讓原本的 access log 從 text 變成可以查找的內容。</p>
<p>原本的 text 送進 elasticsearch 當然也可以查找，但就會在 text 裡面做全文檢索，功能很侷限，效率很差。</p>
<h3 id="output">Output</h3>
<p>logstash 支援的 output 以及設定<a href="https://www.elastic.co/guide/en/logstash/7.3/output-plugins.html" target="_blank" rel="noopener">在這邊</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">output {
</span></span><span class="line"><span class="cl">  elasticsearch {
</span></span><span class="line"><span class="cl">    hosts =&gt; [&#34;https://${ELASTICSEARCH_HOST}:${ELASTICSEARCH_PORT}&#34;]
</span></span><span class="line"><span class="cl">    user =&gt; &#34;${ELASTICSEARCH_USERNAME}&#34;
</span></span><span class="line"><span class="cl">    password =&gt; &#34;${ELASTICSEARCH_PASSWORD}&#34;
</span></span><span class="line"><span class="cl">    index =&gt; &#34;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&#34;
</span></span><span class="line"><span class="cl">    manage_template =&gt; false
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Elasticsearch 的配置很單純</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">output {
</span></span><span class="line"><span class="cl">  google_bigquery {
</span></span><span class="line"><span class="cl">    project_id =&gt; ${GCP_PROJECT_ID}
</span></span><span class="line"><span class="cl">    dataset =&gt; ${GCP_BIG_QUERY_DATASET_NAME}
</span></span><span class="line"><span class="cl">    csv_schema =&gt; &#34;path:STRING,status:INTEGER,score:FLOAT&#34;
</span></span><span class="line"><span class="cl">    json_key_file =&gt; ${GCP_JSON_KEY_FILE_PATH}
</span></span><span class="line"><span class="cl">    error_directory =&gt; &#34;/tmp/bigquery-errors&#34;
</span></span><span class="line"><span class="cl">    date_pattern =&gt; &#34;%Y-%m-%dT%H:00&#34;
</span></span><span class="line"><span class="cl">    flush_interval_secs =&gt; 30
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>其中的變數，我們全都用環境變數，在 deployment.yaml 配置，啟動 logstash pods 時代入</p>
<p><code>GCP_JSON_KEY_FILE_PATH</code> 這邊要配置一隻 GCP 的服務帳號金鑰，一個有 Big Query 寫入權限的 service account，把 json 使用 kubernetes secret 放到集群上，然後在 pod 上使用 volume from secret 掛載進來。
<code>csv_schema =&gt; &quot;path:STRING,status:INTEGER,score:FLOAT&quot;</code> 這邊要配置之後會存入 Big Query 的 csv 結構</p>
<h1 id="小結">小結</h1>
<ul>
<li>部屬 Logstash deployment 到 kubernetes 上</li>
<li>設定 pipeline，超多 plugin，族繁不及備載</li>
<li>Grok 配置</li>
<li>Big Query output 配置</li>
</ul>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/en/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2019/">鐵人賽2019</a>
  
  <a class="badge badge-light" href="/en/tag/elasticsearch/">elasticsearch</a>
  
  <a class="badge badge-light" href="/en/tag/devops/">devops</a>
  
  <a class="badge badge-light" href="/en/tag/logstash/">logstash</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fchechia.net%2Fen%2Fpost%2F2019-09-21-logstash-on-gke%2F&amp;text=Logstash&#43;on&#43;GKE" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fchechia.net%2Fen%2Fpost%2F2019-09-21-logstash-on-gke%2F&amp;t=Logstash&#43;on&#43;GKE" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Logstash%20on%20GKE&amp;body=https%3A%2F%2Fchechia.net%2Fen%2Fpost%2F2019-09-21-logstash-on-gke%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fchechia.net%2Fen%2Fpost%2F2019-09-21-logstash-on-gke%2F&amp;title=Logstash&#43;on&#43;GKE" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=Logstash&#43;on&#43;GKE%20https%3A%2F%2Fchechia.net%2Fen%2Fpost%2F2019-09-21-logstash-on-gke%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fchechia.net%2Fen%2Fpost%2F2019-09-21-logstash-on-gke%2F&amp;title=Logstash&#43;on&#43;GKE" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      <a href="https://chechia.net/"><img class="avatar mr-3 avatar-circle" src="https://s.gravatar.com/avatar/e56eaaf62e2112055827c197b938d620?s=200" alt="Che-Chia Chang"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://chechia.net/">Che-Chia Chang</a></h5>
      <h6 class="card-subtitle">Site Reliability Engineer</h6>
      <p class="card-text">My research interests include Site Reliability Engineering, DevOps, Container and Kubernetes.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/chechiachang" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/chechiachang" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.facebook.com/engineer.from.scratch" target="_blank" rel="noopener">
        <i class="fab fa-facebook"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/che-chia-chang-92194a4a/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/en/uploads/resume.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2024 Me. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> — the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  

















<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.7a0c53d11be409aa2bde72889a671bd9.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.9137013a66774049159934c29c3f0205.js" type="module"></script>


















</body>
</html>
