<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>devops | Che-Chia Chang</title>
    <link>https://chechia.net/zh-hant/tag/devops/</link>
      <atom:link href="https://chechia.net/zh-hant/tag/devops/index.xml" rel="self" type="application/rss+xml" />
    <description>devops</description>
    <generator>Hugo Blox Builder (https://hugoblox.com)</generator><language>zh-Hant</language><lastBuildDate>Thu, 05 Jun 2025 12:45:00 +0000</lastBuildDate>
    <image>
      <url>https://chechia.net/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png</url>
      <title>devops</title>
      <link>https://chechia.net/zh-hant/tag/devops/</link>
    </image>
    
    <item>
      <title>Workshop: RAGæ‰“é€ ä¼æ¥­AIçŸ¥è­˜åº«ï¼šæŠŠä¸€ç”²å­åŠŸåŠ›å‚³çµ¦æ–°äºº</title>
      <link>https://chechia.net/zh-hant/talk/workshop-rag%E6%89%93%E9%80%A0%E4%BC%81%E6%A5%ADai%E7%9F%A5%E8%AD%98%E5%BA%AB%E6%8A%8A%E4%B8%80%E7%94%B2%E5%AD%90%E5%8A%9F%E5%8A%9B%E5%82%B3%E7%B5%A6%E6%96%B0%E4%BA%BA/</link>
      <pubDate>Thu, 05 Jun 2025 12:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/workshop-rag%E6%89%93%E9%80%A0%E4%BC%81%E6%A5%ADai%E7%9F%A5%E8%AD%98%E5%BA%AB%E6%8A%8A%E4%B8%80%E7%94%B2%E5%AD%90%E5%8A%9F%E5%8A%9B%E5%82%B3%E7%B5%A6%E6%96%B0%E4%BA%BA/</guid>
      <description>&lt;hr&gt;
&lt;h1 id=&#34;rag-workshop-è¡Œå‰é€šçŸ¥&#34;&gt;RAG workshop è¡Œå‰é€šçŸ¥&lt;/h1&gt;
&lt;p&gt;æœ¬æ¬¡ workshop ä»¥ hands-on çš„æ–¹å¼é€²è¡Œï¼Œç´¯ç©æ“ä½œç¶“é©—ç‚ºä¸»ï¼Œè¬›è§£èˆ‡èªªæ˜ç‚ºè¼”ã€‚è§€å¿µå…§å®¹æœ‰æº–å‚™æ•™æï¼Œéœ€è¦åƒèˆ‡è€…è‡ªè¡Œé–±è®€ã€‚è¬›å¸«æœƒå…è²»æä¾›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Azure OpenAI models API key (gpt-4.1, gpt-4.1-mini, text-embedding-3, text-embedding-ada-002&amp;hellip;)&lt;/li&gt;
&lt;li&gt;Azure VM ä¾›åŒå­¸é ç«¯æ“ä½œä½¿ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;---æŠ•å½±ç‰‡èˆ‡æ•™æhttpschechianetzh-hantslides2025-06-05-devops-rag-internal-ai---&#34;&gt;&amp;ndash;&amp;gt; &lt;a href=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ•å½±ç‰‡èˆ‡æ•™æ&lt;/a&gt; &amp;lt;&amp;ndash;&lt;/h1&gt;
&lt;hr&gt;
&lt;h3 id=&#34;workshop-åŸºæœ¬éœ€æ±‚&#34;&gt;Workshop åŸºæœ¬éœ€æ±‚&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„é›»è…¦ï¼Œå¯ä»¥ä¸Šç¶²&lt;/li&gt;
&lt;li&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦ï¼Œåœ¨ docker å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;é¸é …2: ä½¿ç”¨è‡ªå·±çš„é›»è…¦ï¼Œé ç«¯é€£ç·šè¬›å¸«æä¾›çš„ VMï¼Œåœ¨VM ä¸­å•Ÿå‹• docker é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ docker&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ python èˆ‡ jupyter notebook&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ chatgpt.com å”åŠ©é™¤éŒ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é¸é …1-ä½¿ç”¨è‡ªå·±çš„é›»è…¦&#34;&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦&lt;/h3&gt;
&lt;p&gt;åœ¨ workshop é–‹å§‹å‰ï¼Œåœ¨è‡ªå·±çš„é›»è…¦ä¸Š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£ docker&lt;/li&gt;
&lt;li&gt;git clone github repository&lt;/li&gt;
&lt;li&gt;å•Ÿå‹• docker é–‹ç™¼ç’°å¢ƒï¼Œä¸‹è¼‰ docker images&lt;/li&gt;
&lt;li&gt;é–‹å•Ÿç€è¦½å™¨ï¼Œé€£ç·šåˆ° Jupyter Notebookï¼Œtoken &lt;code&gt;workshop1234!&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ Jupyter Notebook ä¸­ï¼Œå®‰è£æ‰€éœ€çš„ Python å¥—ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/chechiachang/rag-workshop.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; rag-workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it notebook pip install pandas openai qdrant_client tqdm tenacity wget tenacity unstructured markdown ragas sacrebleu langchain_qdrant langchain-openai langchain_openai langchain_community tiktoken
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;é¸é …2-ä½¿ç”¨é ç«¯-vm&#34;&gt;é¸é …2: ä½¿ç”¨é ç«¯ VM&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å»ºè­°ä½¿ç”¨å€‹äººé›»è…¦ï¼Œç•¢ç«Ÿå…è²» VM åé¡ç¾å ´æœ‰é™&lt;/li&gt;
&lt;li&gt;éœ€è¦æœ‰è‡ªå·±çš„é›»è…¦ï¼Œæœ‰ç©©å®šçš„ç¶²è·¯ï¼Œå¯ä»¥é€£ç·šåˆ°é ç«¯ VM&lt;/li&gt;
&lt;li&gt;éœ€è¦è¨»å†Š tunnel å·¥å…·ï¼ˆæ²’æœ‰æ¥­é…ï¼‰&lt;a href=&#34;https://dashboard.ngrok.com/login&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ngrok&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ç™»å…¥ Login -&amp;gt; å·¦æ‰‹é‚Š Identity &amp;amp; Access -&amp;gt; Authtokens -&amp;gt; Add Tunnel authtoken -&amp;gt; è¨˜åœ¨å®‰å…¨çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://pinggy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pinggy&lt;/a&gt;ï¼Œä½†å…è²»æœ‰é™æ™‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æŠ•å½±ç‰‡èˆ‡æ•™ææœƒæ”¾åœ¨ç¶²ç«™ä¸Š&#34;&gt;æŠ•å½±ç‰‡èˆ‡æ•™ææœƒæ”¾åœ¨ç¶²ç«™ä¸Š&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½•å­˜å– VM ä¹Ÿæœƒæ”¾åœ¨æ•¨å½±ç‰‡è£¡&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;rag-workshop-è¡Œå‰é€šçŸ¥å®Œå¤§å®¶ç•¶å¤©ç¾å ´è¦‹&#34;&gt;RAG workshop è¡Œå‰é€šçŸ¥å®Œï¼Œå¤§å®¶ç•¶å¤©ç¾å ´è¦‹&lt;/h2&gt;
&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;é–‹ç™¼åœ˜éšŠéœ€è¦å°‡ç¶“é©—èˆ‡çŸ¥è­˜ï¼Œé€éæ–‡ä»¶åŒ–çš„æ–¹å¼ä¿å­˜ä¸‹ä¾†ï¼Œä»¥ä¾¿æœªä¾†æŸ¥è©¢èˆ‡å­¸ç¿’ã€‚ç„¶è€Œï¼Œä¼æ¥­å…§éƒ¨æ–‡ä»¶å¾€å¾€åˆ†æ•£æ–¼ Confluenceã€Google Driveã€Notion ç­‰å¹³å°ï¼Œå‚³çµ±é—œéµå­—æœå°‹é›£ä»¥å¿«é€Ÿç²å–æº–ç¢ºè³‡è¨Šï¼Œå°è‡´æºé€šæˆæœ¬é«˜ã€é–‹ç™¼æµç¨‹å—é˜»ã€‚åˆæˆ–æ˜¯ï¼Œç•¶é–‹ç™¼åœ˜éšŠéœ€è¦æŸ¥è©¢ç‰¹å®šçŸ¥è­˜æ™‚ï¼Œå¾€å¾€éœ€è¦é€é Slackã€Email ç­‰æ–¹å¼è©¢å•åŒäº‹ï¼Œé€™æ¨£çš„æºé€šæˆæœ¬ä¸åƒ…æµªè²»æ™‚é–“ï¼Œä¹Ÿå®¹æ˜“é€ æˆè³‡è¨Šä¸å°ç¨±ã€‚&lt;/p&gt;
&lt;p&gt;å­¸å“¡å°‡å­¸æœƒå¦‚ä½•åˆ©ç”¨ RAG æŠ€è¡“ï¼Œçµåˆ OpenAIã€LangChainã€Qdrant å‘é‡æ•¸æ“šåº«ï¼Œæ§‹å»ºä¼æ¥­å…§éƒ¨æ–‡æª”çš„æ™ºèƒ½çŸ¥è­˜åº«ï¼Œä¸¦èƒ½è¨­è¨ˆèˆ‡å¯¦ä½œä¸€å€‹åŸºæ–¼è‡ªç„¶èªè¨€è™•ç†ï¼ˆNLPï¼‰çš„æŸ¥è©¢ç³»çµ±ï¼Œä¾†æå‡é–‹ç™¼åœ˜éšŠçš„æ•ˆç‡èˆ‡çŸ¥è­˜ç®¡ç†èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»€éº¼æ˜¯ RAGï¼Ÿ
&lt;ul&gt;
&lt;li&gt;ä»‹ç´¹ RAGï¼ˆRetrieval-Augmented Generationï¼‰æŠ€è¡“å¦‚ä½•çµåˆæª¢ç´¢èˆ‡ç”Ÿæˆæå‡å•ç­”æº–ç¢ºæ€§ã€‚&lt;/li&gt;
&lt;li&gt;ç‚ºä»€éº¼ä¼æ¥­éœ€è¦æ™ºèƒ½çŸ¥è­˜åº«ï¼Ÿ&lt;/li&gt;
&lt;li&gt;RAG çš„æ‡‰ç”¨å ´æ™¯ï¼šçŸ¥è­˜åº«å»ºç«‹ã€é–‹ç™¼æ”¯æ´ã€æŠ€è¡“æ±ºç­–ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Python èˆ‡ OpenAIï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ OpenAI API æ¶æ§‹èˆ‡èªè¨€æ¨¡å‹ï¼Œå¿«é€Ÿæ§‹å»ºç”Ÿæˆæ¨¡å‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;LangChainï¼šä»‹ç´¹ LangChain æ¡†æ¶å¦‚ä½•ç°¡åŒ– RAG å¯¦ç¾&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ©ç”¨ LangChain æ•´åˆå¤šç¨®æ•¸æ“šæºèˆ‡ç”Ÿæˆæ¨¡å‹&lt;/li&gt;
&lt;li&gt;Qdrant å‘é‡æ•¸æ“šåº«ï¼š
&lt;ul&gt;
&lt;li&gt;å‘é‡æ•¸æ“šåº«çš„æ¦‚å¿µèˆ‡ä½œç”¨&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ©ç”¨ Qdrant å„²å­˜èˆ‡æª¢ç´¢å…§éƒ¨æ–‡æª”çš„åµŒå…¥å‘é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ§‹å»º RAG ç³»çµ±ï¼šå¯¦ä½œæ­¥é©Ÿèˆ‡æ¼”ç¤º
&lt;ul&gt;
&lt;li&gt;æ•¸æ“šé è™•ç†èˆ‡æ–‡æª”è½‰æ›&lt;/li&gt;
&lt;li&gt;å°‡è™•ç†å¾Œçš„æ–‡æœ¬è½‰æ›ç‚ºå‘é‡è¡¨ç¤ºï¼ˆembeddingï¼‰&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ Qdrant å‘é‡æ•¸æ“šåº«å„²å­˜é€™äº›åµŒå…¥ä¸¦åŸ·è¡Œæª¢ç´¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ LangChain çµåˆ OpenAI æ¨¡å‹èˆ‡ Qdrantï¼Œè£½ä½œè‡ªå‹•åŒ–å•ç­”ç³»çµ±&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;target-group&#34;&gt;Target group&lt;/h1&gt;
&lt;p&gt;æœ¬æ¬¡å·¥ä½œåŠæœƒæä¾›åƒèˆ‡è€…ä¸€å€‹ç°¡å–®çš„ç’°å¢ƒï¼Œè®“åƒèˆ‡è€…å¯ä»¥é€éé ç«¯æ“ä½œä¾†å¯¦ä½œåŸºæœ¬ RAG AI Agentã€‚åƒèˆ‡è€…å¿…å‚™å€‹äººç­†é›»ï¼Œé€é SSH æ“æ§é ç«¯æ©Ÿå™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¿…å‚™çŸ¥è­˜ï¼šLinux æ“ä½œåŸºæœ¬çŸ¥è­˜ï¼ŒDocker æ“ä½œåŸºæœ¬çŸ¥è­˜ï¼Œæœƒä½¿ç”¨ SSH é€£ç·š / Bash / dockerã€‚&lt;/p&gt;
&lt;p&gt;å·¥ä½œåŠçµæŸå¾Œï¼Œå­¸å“¡å°‡èƒ½å¤ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç†è§£ä¸¦å¯¦ä½œ RAG æŠ€è¡“ï¼Œå°‡å…§éƒ¨æ–‡æª”è½‰åŒ–ç‚ºæ™ºèƒ½çŸ¥è­˜åº«&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Pythonã€LangChain å’Œ OpenAI æ§‹å»ºåŸºæ–¼æª¢ç´¢çš„å•ç­”ç³»çµ±&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ Qdrant å‘é‡æ•¸æ“šåº«é€²è¡Œé«˜æ•ˆæª¢ç´¢ï¼Œæå‡é–‹ç™¼æµç¨‹ä¸­çš„çŸ¥è­˜ç®¡ç†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;é€™æ¨£çš„å·¥ä½œåŠçµæ§‹èƒ½å¤ å¹³è¡¡ç†è«–èˆ‡å¯¦è¸ï¼Œä¸¦ç‚ºå­¸å“¡æä¾›å¯¦éš›å‹•æ‰‹æ“ä½œçš„æ©Ÿæœƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Chang æ˜¯ä¸€åå°ˆæ³¨æ–¼å¾Œç«¯é–‹ç™¼ã€é–‹ç™¼ç¶­é‹ã€å®¹å™¨åŒ–æ‡‰ç”¨åŠ Kubernetes é–‹ç™¼èˆ‡ç®¡ç†çš„æŠ€è¡“å°ˆå®¶ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ Microsoft æœ€æœ‰åƒ¹å€¼å°ˆæ¥­äººå£«ï¼ˆMVPï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ´»èºæ–¼å°ç£æŠ€è¡“ç¤¾ç¾¤ï¼Œç¶“å¸¸åœ¨ CNTUGã€DevOps Taipeiã€GDG Taipeiã€Golang Taipei Meetup ç­‰ç¤¾ç¾¤åˆ†äº« DevOpsã€SREã€Kubernetes åŠé›²ç«¯é‹ç®—ç›¸é—œæŠ€è¡“ã€‚è‡´åŠ›æ–¼æ¨å‹•é–‹ç™¼èˆ‡ç¶­é‹çš„æœ€ä½³å¯¦è¸ï¼Œä¸¦ç†±è¡·æ–¼ç ”ç©¶èˆ‡æ‡‰ç”¨æœ€æ–°çš„é›²ç«¯èˆ‡ AI æŠ€è¡“ã€‚&lt;/p&gt;
&lt;p&gt;å€‹äººéƒ¨è½æ ¼ï¼šhttps://chechia.net&lt;/p&gt;
&lt;p&gt;Che-Chia Chang is a technology expert specializing in backend development, DevOps, site reliability engineering (SRE), containerized applications, and Kubernetes development and management. He is also recognized as a Microsoft Most Valuable Professional (MVP).&lt;/p&gt;
&lt;p&gt;Actively engaged in the Taiwanese tech community, he frequently shares insights on DevOps, SRE, Kubernetes, and cloud computing at CNTUG, DevOps Taipei, GDG Taipei, and Golang Taipei Meetup. Passionate about promoting best practices in development and operations, he continuously explores and applies the latest advancements in cloud and AI technologies.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2024 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2024 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2023 DevOpsDay&lt;/li&gt;
&lt;li&gt;2023 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Workshop: RAGæ‰“é€ ä¼æ¥­AIçŸ¥è­˜åº«ï¼šæŠŠä¸€ç”²å­åŠŸåŠ›å‚³çµ¦æ–°äºº</title>
      <link>https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/</link>
      <pubDate>Sun, 01 Jun 2025 00:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/</guid>
      <description>&lt;h3 id=&#34;rag-workshop-è¡Œå‰é€šçŸ¥åŸºæœ¬éœ€æ±‚&#34;&gt;RAG workshop è¡Œå‰é€šçŸ¥ï¼šåŸºæœ¬éœ€æ±‚&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç•¶å¤©å¸¶è‡ªå·±çš„é›»è…¦ã€‚ç•¶å¤©å»ºè­°è‡ªå‚™æ‰‹æ©Ÿç¶²è·¯&lt;/li&gt;
&lt;li&gt;é¸é …1: ç”¨é›»è…¦åœ¨ docker é‹è¡Œé–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;é¸é …2: ç”¨é›»è…¦é ç«¯é€£ç·šè¬›å¸«æä¾›çš„ VMï¼Œåœ¨é ç«¯VM ä¸­é‹è¡Œ docker é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ docker&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ python èˆ‡ jupyter notebook&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h5 id=&#34;é¸é …1-ä½¿ç”¨è‡ªå·±çš„é›»è…¦-&#34;&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦ ğŸ’»&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ workshop é–‹å§‹å‰ï¼Œåœ¨è‡ªå·±çš„é›»è…¦ä¸Š
&lt;ol&gt;
&lt;li&gt;å®‰è£ &lt;a href=&#34;https://docs.docker.com/get-started/get-docker/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;docker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;git clone æ•™æ&lt;/li&gt;
&lt;li&gt;å•Ÿå‹• docker é–‹ç™¼ç’°å¢ƒï¼Œä¸‹è¼‰ docker images&lt;/li&gt;
&lt;li&gt;å®‰è£æ‰€éœ€çš„ Python å¥—ä»¶&lt;/li&gt;
&lt;li&gt;é–‹å•Ÿç€è¦½å™¨ï¼Œé€£ç·šåˆ°&lt;a href=&#34;http://localhost:8888&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8888&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/chechiachang/rag-workshop.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; rag-workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it notebook pip install pandas openai qdrant_client tqdm tenacity wget tenacity unstructured markdown ragas sacrebleu langchain_qdrant langchain-openai langchain_openai langchain_community tiktoken ipywidgets
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ç™»å…¥token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;workshop1234!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h5 id=&#34;é¸é …2-ä½¿ç”¨é ç«¯-vm&#34;&gt;é¸é …2: ä½¿ç”¨é ç«¯ VM&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„é›»è…¦ï¼Œç•¶å¤©å»ºè­°è‡ªå‚™æ‰‹æ©Ÿç¶²è·¯ï¼Œé€£ç·šåˆ°é ç«¯ VM&lt;/li&gt;
&lt;li&gt;æå‰è¨»å†Š tunnel å·¥å…·ï¼ˆæ²’æœ‰æ¥­é…ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dashboard.ngrok.com/login&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ngrok&lt;/a&gt; ç™»å…¥ Login -&amp;gt; å·¦æ‰‹é‚Š Identity &amp;amp; Access -&amp;gt; Authtokens -&amp;gt; Add Tunnel authtoken -&amp;gt; è¨˜åœ¨å®‰å…¨çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://pinggy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pinggy&lt;/a&gt;ï¼Œä½†å…è²»æœ‰é™æ™‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å»ºè­°&#34;&gt;å»ºè­°&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å„ªå…ˆä½¿ç”¨å€‹äººé›»è…¦ã€‚æœƒç›¡é‡æä¾›å…è²» VM åé¡ï¼Œä½†ä¾åƒèˆ‡äººæ•¸ä¸ä¿è­‰ç¾å ´æœ‰&lt;/li&gt;
&lt;li&gt;åœ¨å®¶å…ˆè©¦è·‘ä¸€éï¼ŒæŠŠ docker image è·Ÿ pip å¥—ä»¶éƒ½ä¸‹è¼‰å¥½ï¼Œç¾å ´è¦è¼‰å¾ˆä¹…&lt;/li&gt;
&lt;li&gt;è©¦å®Œå¾Œè¨˜å¾—é—œæ‰ ngrokï¼Œä»¥å…ç”¨å®Œæ¯æœˆçš„å…è²»é¡åº¦&lt;/li&gt;
&lt;li&gt;äº‹å…ˆçœ‹å®Œå…§å®¹è¦ºå¾—å¤ªç°¡å–®å¯ä»¥ä¸ç”¨ä¾†ï¼Œä½†æ­¡è¿æœƒå¾Œæ‰¾æˆ‘èŠå¤©ï¼¸ï¼¤&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æŠ•å½±ç‰‡èˆ‡æ•™æèˆ‡å®Œæ•´ç¨‹å¼ç¢¼æ”¾åœ¨ç¶²ç«™ä¸Š&#34;&gt;æŠ•å½±ç‰‡èˆ‡æ•™æèˆ‡å®Œæ•´ç¨‹å¼ç¢¼æ”¾åœ¨ç¶²ç«™ä¸Š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ğŸ“ &lt;a href=&#34;https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/zh-hant/slides/2025-06-05-devops-rag-internal-ai/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github æŠ•å½±ç‰‡åŸå§‹ç¢¼èˆ‡è¬›ç¨¿&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id=&#34;ä»¥ä¸‹æ˜¯-rag-workshop-ç•¶å¤©å…§å®¹&#34;&gt;ä»¥ä¸‹æ˜¯ RAG Workshop ç•¶å¤©å…§å®¹&lt;/h5&gt;
&lt;p&gt;å¯ä»¥å…ˆçœ‹ï¼Œä¹Ÿå¯ä»¥ç•¶å¤©å†çœ‹&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://media.tenor.com/aRF-Uwyl0p8AAAAM/frozen2.gif&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop&#34;&gt;RAG Workshop&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é—œæ–¼æˆ‘&#34;&gt;é—œæ–¼æˆ‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Che Chia Chang&lt;/li&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.cake.me/companies/maicoin/jobs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å€‹äººéƒ¨è½æ ¼&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; æŠ•å½±ç‰‡è¬›ç¨¿ï¼Œéµäººè³½ (Terraform / Vault æ‰‹æŠŠæ‰‹å…¥é–€ / Etcd Workshop)&lt;/li&gt;
&lt;li&gt;ğŸ“ &lt;a href=&#34;https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/zh-hant/slides/2025-06-05-devops-rag-internal-ai/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šå¤©çš„æŠ•å½±ç‰‡åŸå§‹ç¢¼èˆ‡è¬›ç¨¿&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;10min - &lt;strong&gt;ç’°å¢ƒè¨­å®šï¼šç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è¨­å®šå¥½é–‹ç™¼ç’°å¢ƒ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;10min - ç‚ºä»€éº¼éœ€è¦ RAGï¼ˆRetrieval-Augmented Generationï¼‰&lt;/li&gt;
&lt;li&gt;10min - Notebook 2 Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;10min - Notebook 3 Embedding Search&lt;/li&gt;
&lt;li&gt;10min - Notebook 4 DIY&lt;/li&gt;
&lt;li&gt;10min - Notebook 5 Evaluation&lt;/li&gt;
&lt;li&gt;10min - Notebook 6 k8s RAG QA&lt;/li&gt;
&lt;li&gt;20min - DIY + Q&amp;amp;A&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h5 id=&#34;é¸é …1-ä½¿ç”¨è‡ªå·±çš„é›»è…¦&#34;&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰åœ¨å®¶å…ˆè©¦è·‘ä¸€éï¼Œæ‡‰è©²å¯ä»¥åœ¨æœ¬åœ°å­˜å– Notebook &lt;a href=&#34;http://localhost:8888&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8888&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åˆ° &lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt; å–å¾— OpenAI Key&lt;/li&gt;
&lt;li&gt;å¯ä»¥è©¦è‘—è·‘ notebook 2-5&lt;/li&gt;
&lt;li&gt;å¿˜è¨˜æ€éº¼å•Ÿå‹•ï¼Œå¯ä»¥å›åˆ°æŠ•å½±ç‰‡æœ€é–‹å§‹&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;notebook token: workshop1234!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AZURE_OPENAI_API_KEY=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AZURE_OPENAI_ENDPOINT=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h5 id=&#34;é¸é …2-ä½¿ç”¨é ç«¯-vm-1&#34;&gt;é¸é …2: ä½¿ç”¨é ç«¯ VM&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;è‡³&lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt; é ˜å–ä¸€å° VM ä¸¦ç°½å&lt;/li&gt;
&lt;li&gt;googel sheet å·¦é‚Š urlï¼Œé–‹å•Ÿ bastion é€£ç·š&lt;/li&gt;
&lt;li&gt;Protocol: SSHï¼Œport 22ï¼Œauthentication type: password&lt;/li&gt;
&lt;li&gt;å¸³è™Ÿå¯†ç¢¼åœ¨&lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_8aa3d767b665df4f846c9f4ea3bf4e4f.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_03c55b28d75c2ab6499830cbb3b9c46e.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_8aa3d767b665df4f846c9f4ea3bf4e4f.webp&#34;
               width=&#34;359&#34;
               height=&#34;599&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h5 id=&#34;é¸é …2-ä½¿ç”¨-ngrok-é€£ç·šåˆ°-jupyter-notebook&#34;&gt;é¸é …2: ä½¿ç”¨ ngrok é€£ç·šåˆ° jupyter notebook&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;é€²å…¥ VM å¾Œï¼Œä¿®æ”¹ä¸‹é¢ ngrok authtokenã€‚æŒ‡ä»¤ä¸€è¡Œä¸€è¡Œè²¼ä¸Šï¼ˆå³éµï¼‰åˆ° bastion ä¸­åŸ·è¡Œ&lt;/li&gt;
&lt;li&gt;é€é &lt;a href=&#34;https://4d11-52-230-24-207.ngrok-free.app/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://4d11-52-230-24-207.ngrok-free.app/&lt;/a&gt; å°±å¯ä»¥ä½¿ç”¨ notebook (æ¯å€‹äººä¸ä¸€æ¨£)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd rag-workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NGROK_AUTHTOKEN=&amp;lt;æ”¹æˆä½ çš„token&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sed -i &amp;#34;s/your-token/$NGROK_AUTHTOKEN/&amp;#34; docker-compose.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs ngrok
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=2025-06-02T06:17:41+0000 lvl=info msg=&amp;#34;started tunnel&amp;#34; obj=tunnels name=command_line addr=http://notebook:8888 url=https://4d11-52-230-24-207.ngrok-free.app
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;ä»¥ä¸Šæ˜¯-workshop-ç’°å¢ƒè¨­å®š&#34;&gt;ä»¥ä¸Šæ˜¯ Workshop ç’°å¢ƒè¨­å®š&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å¾Œé¢ä¸Šèª²éƒ½é€éé€™å€‹ç¶²å€æ“ä½œ&lt;/li&gt;
&lt;li&gt;é‚„æ²’æœ‰çœ‹åˆ° jupyter notebook çš„äººï¼Œè«‹èˆ‰æ‰‹&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://miro.medium.com/v2/resize:fit:996/1*ByWkrjbyWmC9W_uWjI1qrw.gif&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹-1&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç’°å¢ƒè¨­å®šï¼šç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è¨­å®šå¥½é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‚ºä»€éº¼éœ€è¦ RAGï¼ˆRetrieval-Augmented Generationï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;Embedding Search&lt;/li&gt;
&lt;li&gt;DIY&lt;/li&gt;
&lt;li&gt;Evaluation&lt;/li&gt;
&lt;li&gt;å¯¦éš›æ‡‰ç”¨: ä»¥ k8s official docs ç‚ºä¾‹&lt;/li&gt;
&lt;li&gt;DIY + Q&amp;amp;A&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä»€éº¼æ˜¯-rag&#34;&gt;ä»€éº¼æ˜¯ RAG&lt;/h3&gt;
&lt;h5 id=&#34;ragretrieval-augmented-generation-æª¢ç´¢å¢å¼·ç”Ÿæˆçµåˆæª¢ç´¢ç³»çµ±èˆ‡ç”Ÿæˆå¼æ¨¡å‹å¦‚-gptçš„è‡ªç„¶èªè¨€è™•ç†æ¶æ§‹åœ¨ç”Ÿæˆç­”æ¡ˆæ™‚å¼•ç”¨å¤–éƒ¨çŸ¥è­˜ä½¿æ¨¡å‹å›ç­”æ›´æº–ç¢ºä¸”å…·äº‹å¯¦æ ¹æ“š&#34;&gt;RAGï¼ˆRetrieval-Augmented Generation æª¢ç´¢å¢å¼·ç”Ÿæˆï¼‰çµåˆæª¢ç´¢ç³»çµ±èˆ‡ç”Ÿæˆå¼æ¨¡å‹ï¼ˆå¦‚ GPTï¼‰çš„è‡ªç„¶èªè¨€è™•ç†æ¶æ§‹ï¼Œåœ¨ç”Ÿæˆç­”æ¡ˆæ™‚å¼•ç”¨å¤–éƒ¨çŸ¥è­˜ï¼Œä½¿æ¨¡å‹å›ç­”æ›´æº–ç¢ºä¸”å…·äº‹å¯¦æ ¹æ“š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Retrievalï¼ˆæª¢ç´¢ï¼‰ï¼š&lt;/strong&gt; å¾ä¸€å€‹å¤–éƒ¨çŸ¥è­˜åº«ï¼ˆå¦‚æ–‡ä»¶ã€å‘é‡è³‡æ–™åº«ç­‰ï¼‰ä¸­æ‰¾åˆ°èˆ‡å•é¡Œç›¸é—œçš„è³‡è¨Šã€‚é€šå¸¸æœƒç”¨èªæ„å‘é‡ï¼ˆembeddingsï¼‰åšç›¸ä¼¼åº¦æœå°‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Generationï¼ˆç”Ÿæˆï¼‰ï¼š&lt;/strong&gt; æŠŠæª¢ç´¢åˆ°çš„å…§å®¹èˆ‡ä½¿ç”¨è€…å•é¡Œä¸€èµ·ä¸Ÿçµ¦ LLMï¼ˆå¦‚ GPTã€Claude ç­‰ï¼‰å»ç”Ÿæˆç­”æ¡ˆã€‚ç”Ÿæˆçš„å…§å®¹æœƒæ›´å…·äº‹å¯¦æ ¹æ“šï¼Œä¸¦èƒ½å¼•ç”¨å…·é«”è³‡æ–™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://cookbook.openai.com/images/llamaindex_rag_overview.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cookbook.openai.com/images/llamaindex_rag_overview.png&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cookbook.openai.com/images/llamaindex_rag_overview.png&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;çŸ¥è­˜ç²å–æ•ˆç‡åœ¨-devops-çš„é›£é¡Œ&#34;&gt;çŸ¥è­˜ç²å–æ•ˆç‡åœ¨ DevOps çš„é›£é¡Œ&lt;/h3&gt;
&lt;p&gt;åœ¨å¿«é€Ÿè®Šå‹•ã€è³‡è¨Šåˆ†æ•£çš„ç’°å¢ƒä¸­ï¼Œé›£ä»¥å³æ™‚å–å¾—éœ€è¦çš„çŸ¥è­˜ã€‚ã€Œæœ‰ä½†æ‰¾ä¸åˆ°ã€çœ‹ä¸æ‡‚ã€ç”¨ä¸èµ·ä¾†ã€&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çŸ¥è­˜åˆ†æ•£åœ¨å¤šå€‹ç³»çµ±ã€æ ¼å¼èˆ‡å·¥å…·ä¸­&lt;/li&gt;
&lt;li&gt;çŸ¥è­˜å¤šç‚ºã€Œéœæ…‹æ–‡ä»¶ã€ï¼Œé›£ä»¥äº’å‹•å•ç­”ï¼Œèˆ‰ä¾‹ï¼Œæˆ–æ˜¯æ›å¥è©±èªª&lt;/li&gt;
&lt;li&gt;éš±æ€§çŸ¥è­˜æœªè¢«ç³»çµ±åŒ–å„²å­˜(ä¾‹å¦‚ï¼šå£é ­å‚³æ‰¿ã€slack è¨è«–ã€æœƒè­°ç´€éŒ„ç­‰)&lt;/li&gt;
&lt;li&gt;æŸ¥è©¢æµç¨‹èˆ‡é–‹ç™¼æµç¨‹è„«ç¯€&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æƒ…å¢ƒæ–°äººå·¥ç¨‹å¸«è¦å¦‚ä½•åˆ°-k8s-doc-æŸ¥åˆ°æƒ³è¦çš„å…§å®¹&#34;&gt;æƒ…å¢ƒï¼šæ–°äººå·¥ç¨‹å¸«è¦å¦‚ä½•åˆ° k8s doc æŸ¥åˆ°æƒ³è¦çš„å…§å®¹ï¼Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰å•é¡Œå» google / stack overflow&lt;/li&gt;
&lt;li&gt;éœ€è¦æœå°‹å¼•æ“(k8s doc æœ‰æä¾›ï¼Œä½†å…§éƒ¨æ–‡ä»¶ç³»çµ±ä¸ä¸€å®šæœ‰)&lt;/li&gt;
&lt;li&gt;éœ€è¦é—œéµå­—(æ–°äººæ€éº¼çŸ¥é“è¦æŸ¥ Dynamic Persistent Volume Resizing)&lt;/li&gt;
&lt;li&gt;å”åŠ©ç†è§£ï¼ˆèˆ‰ä¾‹ï¼Œæ›å¥è©±èªªï¼‰&lt;/li&gt;
&lt;li&gt;è·¨èªè¨€é–€æª»&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  k8s doc æœ‰æä¾›é—œéµå­—æœå°‹ï¼Œé€™å€‹æœå°‹åŠŸèƒ½æ˜¯æ€éº¼åšçš„ï¼Ÿ
Programmable Search Engineï¼ˆPSEï¼‰https://developers.google.com/custom-search/docs/tutorial/introduction
Fulltext Search Engine ä¾‹å¦‚ elasticsearch ä½¿ç”¨ Lucene
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://www.wackybuttons.com/designcodes/0/110/1100986.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_ba0bedbef430605582db8405bbadfdf2.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_cbca56289ea87ea85283ee75ee320f80.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_ba0bedbef430605582db8405bbadfdf2.webp&#34;
               width=&#34;760&#34;
               height=&#34;408&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/search/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/search/&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æƒ…å¢ƒsenior-å·¥ç¨‹å¸«è¦å¦‚ä½•åˆ†äº«çŸ¥è­˜&#34;&gt;æƒ…å¢ƒï¼šSenior å·¥ç¨‹å¸«è¦å¦‚ä½•åˆ†äº«çŸ¥è­˜ï¼Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ã€æˆ‘æœ‰å¯«ä¸€ç¯‡æ–‡ä»¶åœ¨æŸå€‹åœ°æ–¹ï¼Œä½ æ‰¾ä¸€ä¸‹ã€&lt;/li&gt;
&lt;li&gt;ã€æˆ‘å¿˜è¨˜å»å¹´ç‚ºä»€éº¼é€™æ¨£åšäº†ã€&lt;/li&gt;
&lt;li&gt;ã€æˆ‘å» Slack ä¸Šæ‰¾ä¸€ä¸‹ã€&lt;/li&gt;
&lt;li&gt;ã€ä½ è¦ä¸è¦å…ˆå»å• ChatGPTï¼Ÿã€&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ih1.redbubble.net/image.4690208405.0033/st,small,507x507-pad,600x600,f8f8f8.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æˆ‘å€‘ä¸æ˜¯æ‡¶ï¼Œè€Œæ˜¯ç¾åœ¨è¦è§£ç­”è¨±å¤šåŸºæœ¬å•é¡Œï¼ŒLLM å›ç­”å¾—æ¯”äººå¥½
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-è®“-devops-æ›´æ™ºæ…§çš„å³æ™‚åæ‡‰&#34;&gt;RAG è®“ DevOps æ›´æ™ºæ…§çš„å³æ™‚åæ‡‰&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æå‡çŸ¥è­˜ç²å–æ•ˆç‡: å…§éƒ¨æ–‡æª”çŸ¥è­˜AIåŠ©æ‰‹&lt;/li&gt;
&lt;li&gt;çŸ¥è­˜ç•™å­˜èˆ‡æ–°äºº Onboarding&lt;/li&gt;
&lt;li&gt;åŠ é€Ÿæ•…éšœæ’æŸ¥: æ ¹æ“šéŒ¯èª¤è¨Šæ¯è‡ªå‹•å¾ Runbook ä¸­æª¢ç´¢è™•ç†æ–¹å¼&lt;/li&gt;
&lt;li&gt;å„ªåŒ–æµç¨‹è‡ªå‹•åŒ–èˆ‡æå‡æ±ºç­–å“è³ª: é€šè¨Šè»Ÿé«”å°è©± botï¼Œè‡ªå‹•ç”Ÿæˆå»ºè­°&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;DevOps AI Copilot ä¸æ‡‰è©²åƒåœ–æ›¸é¤¨å®ˆé–€å“¡ç­‰äººä¾†å€Ÿæ›¸ï¼Œ
è€Œæ‡‰è©²åƒå°èˆªç³»çµ±ï¼Œåœ¨ä½ é–‹è»Šæ™‚ä¸»å‹•å‘Šè¨´ä½ ï¼šå‰æ–¹æœ‰å½é“ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;RAG + Context-Aware Knowledge Copilot&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  åŸºæœ¬ä¸Šæˆ‘å€‘æœŸå¾…çš„è§£æ±ºæ–¹æ¡ˆæ˜¯é€™æ¨£
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-vs-å…¶ä»–å·¥å…·&#34;&gt;RAG vs å…¶ä»–å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦å·¥å…·æå‡çŸ¥è­˜ç²å–æ•ˆç‡ï¼Œå¦‚ä½•é¸æ“‡ RAG æˆ–æ˜¯å…¶ä»– non-LLM å·¥å…·ï¼Ÿä¾‹å¦‚ search engine / fulltext search engine / search algorithm&lt;/li&gt;
&lt;li&gt;ç‰¹å®šä»»å‹™çš„æ•ˆèƒ½æ˜¯å¦å„ªæ–¼äººé¡&lt;/li&gt;
&lt;li&gt;å“ªè£¡é©åˆç”¨ RAGï¼Œå“ªè£¡é©åˆç”¨ non-LLM å·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  ä¾‹å¦‚
google search engine ä½†ç•¶ç„¶æˆ‘å€‘ä¸çŸ¥é“ä»–èƒŒå¾Œçš„å¯¦ä½œ
elasticsearch / lucene / fulltext search engine
GNU grep çš„ Boyerâ€“Moore string-search algorithm
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_8715252ce2925f2b574cec4bb2d0a84d.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_5705bdacf67afc9f8d81663d6d7fea49.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_8715252ce2925f2b574cec4bb2d0a84d.webp&#34;
               width=&#34;760&#34;
               height=&#34;481&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  é©åˆç”¨ RAG çš„æƒ…å¢ƒï¼šå®¢æœå•ç­”ã€æŠ€è¡“æœå°‹ã€çŸ¥è­˜å‹ Chatbotã€å…§éƒ¨çŸ¥è­˜å°èˆªã€‚
é©åˆç”¨å‚³çµ±ç¨‹å¼çš„æƒ…å¢ƒï¼šé‡‘æµæ§åˆ¶ã€æµç¨‹å¼•æ“ã€å¸³å‹™ç³»çµ±ã€å®‰å…¨æ§åˆ¶ã€‚
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æœ‰äº†å¤§èªè¨€æ¨¡å‹å¾Œ&#34;&gt;æœ‰äº†å¤§èªè¨€æ¨¡å‹å¾Œ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å» google -&amp;gt; å…ˆå• chatgptï¼Œåˆæ­¥å•ç­”ç†è§£å•é¡Œï¼Œæ‰¾åˆ°é—œéµå­—&lt;/li&gt;
&lt;li&gt;éœ€è¦æœå°‹å¼•æ“ -&amp;gt; chatgpt æ•´åˆï¼Œç›´æ¥ä¸Šç¶²æœå°‹&lt;/li&gt;
&lt;li&gt;éœ€è¦é—œéµå­— -&amp;gt; chatgpt å¹«ä½ æ‰¾åˆ°é—œéµå­—&lt;/li&gt;
&lt;li&gt;å”åŠ©ç†è§£ -&amp;gt; chatgpt èˆ‰ä¾‹ï¼Œæ›å¥è©±èªª&lt;/li&gt;
&lt;li&gt;è·¨èªè¨€é–€æª» -&amp;gt; chatgpt ç¿»è­¯&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  chatgpt æœƒç”¨é€šé †çš„èªè¨€å›ç­”å•é¡Œï¼ˆå„ªæ–¼å¹³å‡å·¥ç¨‹å¸«ï¼‰
&lt;/aside&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;chatgpt æœƒç”¨é€šé †çš„èªè¨€ï¼Œå¿«é€Ÿï¼ˆæ•¸ç§’å…§ï¼‰ä¸Šç¶²æœå°‹ï¼Œå›ç­”å•é¡Œ&lt;/li&gt;
&lt;li&gt;éç¨‹ä¸­ä¸å­å…¶ç…©åœ°å•ç­”ï¼Œæ›å¥è©±èªª&lt;/li&gt;
&lt;li&gt;å›ç­”çš„æ ¼å¼é«˜åº¦å®¢è£½åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id=&#34;llm-ä¸å…·å‚™å°ˆæ¥­çŸ¥è­˜ç¼ºä¹å…§å®¹æ ¹æ“šæ™‚å®¹æ˜“ç”¢ç”Ÿå¹»è¦ºhallucination&#34;&gt;LLM ä¸å…·å‚™å°ˆæ¥­çŸ¥è­˜ã€‚ç¼ºä¹å…§å®¹æ ¹æ“šæ™‚ï¼Œå®¹æ˜“ç”¢ç”Ÿå¹»è¦º(hallucination)&lt;/h5&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_9fe73f5f2b5339e829b4fd9ff27bd59e.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_b69728d4bdba428622aca425a98eed1e.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_9fe73f5f2b5339e829b4fd9ff27bd59e.webp&#34;
               width=&#34;500&#34;
               height=&#34;500&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  LLMï¼ˆå¤§å‹èªè¨€æ¨¡å‹ï¼‰æœ¬èº«ä¸¦ä¸å…·å‚™äº‹å¯¦çŸ¥è­˜ï¼Œè€Œæ˜¯ä¾è³´è¨“ç·´æ™‚çš„èªæ–™èˆ‡æç¤ºè¼¸å…¥ä¾†ç”Ÿæˆå›ç­”ã€‚ç•¶ç¼ºä¹æ˜ç¢ºä¸Šä¸‹æ–‡æˆ–å…§å®¹æ ¹æ“šæ™‚ï¼ŒLLM å®¹æ˜“å‡ºç¾ã€Œå¹»è¦ºã€ç¾è±¡ï¼Œå³ç”Ÿæˆçœ‹ä¼¼åˆç†ä½†å¯¦éš›ä¸æ­£ç¢ºçš„è³‡è¨Šã€‚å°ˆæ¥­é ˜åŸŸå•é¡Œè‹¥æœªæä¾›æº–ç¢ºè³‡æ–™æ”¯æ’ï¼Œä¹Ÿå®¹æ˜“å°è‡´éŒ¯èª¤å›ç­”ã€‚
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹-2&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç’°å¢ƒè¨­å®šï¼šç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è¨­å®šå¥½é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;ç‚ºä»€éº¼éœ€è¦ RAGï¼ˆRetrieval-Augmented Generationï¼‰
&lt;ol&gt;
&lt;li&gt;RAG åœ¨ã€Œæ–‡ä»¶æª¢ç´¢èˆ‡æç¤ºã€ä¸Šå„ªæ–¼äººé¡&lt;/li&gt;
&lt;li&gt;LLM è£œå¼·å·¥ç¨‹å¸«çš„èªè¨€èƒ½åŠ›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Embedding Search&lt;/li&gt;
&lt;li&gt;DIY&lt;/li&gt;
&lt;li&gt;Evaluation&lt;/li&gt;
&lt;li&gt;k8s RAG QA.ipynb&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹-3&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è·‘ä¸€å¥—RAGèµ·ä¾†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Evaluation&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;k8s RAG QA.ipynb&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¦‚ä½•è©•ä¼°-rag-ç³»çµ±çš„å“è³ª&#34;&gt;å¦‚ä½•è©•ä¼° RAG ç³»çµ±çš„å“è³ª?&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;äººäººéƒ½æœƒä¸‹ promptï¼Œä½†æ˜¯èª°çš„ prompt æ›´å¥½ï¼Ÿæˆ–æ˜¯æ²’å·®åˆ¥ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é¸æ“‡ vector store çš„ chunking ç­–ç•¥ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å“ªå€‹ retriever æ›´å¥½ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¦å¦‚ä½•æŒçºŒæ”¹å–„ RAG ç³»çµ±ï¼Ÿä¸‹å€‹è¿­ä»£çš„æ”¹å–„æ–¹å‘æ˜¯ä»€éº¼ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ˜¯å¦ç¬¦åˆ production criteriaï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è©•ä¼°ç¢ºä¿å›ç­”å“è³ªå¯é æ€§èˆ‡å¯æ§æ€§&#34;&gt;è©•ä¼°ï¼šç¢ºä¿å›ç­”å“è³ªå¯é æ€§èˆ‡å¯æ§æ€§&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¿è­‰æ­£ç¢ºæ€§ï¼šæª¢ç´¢å‡ºçš„è³‡è¨Šæ˜¯æ­£ç¢ºçš„ï¼Œç”Ÿæˆçš„ç­”æ¡ˆå¿ å¯¦æ–¼åŸå§‹ context&lt;/li&gt;
&lt;li&gt;é™ä½å¹»è¦ºé¢¨éšªï¼šå³ä½¿æœ‰è³‡æ–™ï¼ŒLLM ä»å¯èƒ½äº‚ç·¨&lt;/li&gt;
&lt;li&gt;æ¸¬é‡ç³»çµ±å“è³ª&lt;/li&gt;
&lt;li&gt;æ”¹å–„ä¾æ“šï¼šå¹«åŠ©é©—è­‰Chunking ç­–ç•¥ï¼ŒPrompt è¨­è¨ˆï¼ŒRetriever æ¨¡å‹èª¿æ•´&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–ç›£æ§ï¼šå“è³ªè¿½è¹¤ã€å•é¡Œå®šä½ï¼Œå»ºç«‹é¡ä¼¼ APM çš„ QA æŒ‡æ¨™&lt;/li&gt;
&lt;li&gt;å° Stakeholder å±•ç¤ºæˆæ•ˆï¼šå¯è¦–åŒ–èˆ‡é‡åŒ–æŒ‡æ¨™ï¼Œæœ‰åŠ©æºé€šèˆ‡è³‡æºæŠ•å…¥&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;è©•ä¼°æ–¹å¼å»ºè­°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Retrievalï¼šRecall@K, MRR, nDCG&lt;/li&gt;
&lt;li&gt;Generationï¼šROUGE, BERTScore, GPTScore&lt;/li&gt;
&lt;li&gt;Faithfulnessï¼šä¾æ“šä¾†æºè³‡æ–™ç”Ÿæˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;äººå·¥æ¨™è¨»ï¼šç›¸é—œæ€§ã€æ­£ç¢ºæ€§ã€å¹«åŠ©ç¨‹åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-æ‡‰ç”¨-ä»¥-k8s-official-docs-ç‚ºä¾‹&#34;&gt;RAG æ‡‰ç”¨: ä»¥ k8s official docs ç‚ºä¾‹&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç¸½çµ&#34;&gt;ç¸½çµ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç‚ºä»€éº¼éœ€è¦ RAG&lt;/li&gt;
&lt;li&gt;Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;Embedding Search&lt;/li&gt;
&lt;li&gt;DIY&lt;/li&gt;
&lt;li&gt;Evaluation&lt;/li&gt;
&lt;li&gt;k8s RAG QA&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h5 id=&#34;ç”±è¡·åœ°æ„Ÿè¬ç‚º-workshop-æä¾›å”åŠ©çš„å¤¥ä¼´&#34;&gt;ç”±è¡·åœ°æ„Ÿè¬ç‚º workshop æä¾›å”åŠ©çš„å¤¥ä¼´!&lt;/h5&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/pymia&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mia // Huai-Wen Chang&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/hunkue&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hunkue&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;maicoin-we-are-hiring&#34;&gt;MaiCoin: We are Hiring!!&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236558674/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior Site Reliability Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236555801&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior Data Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236555811&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior IT Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236556713&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Blockchain Engineer (Wallet Team)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236558714&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior Backend Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236523560/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Micro Service Software Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236559632&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cyber Security Engineer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;diy--qa--å»ºè­°&#34;&gt;DIY + Q&amp;amp;A + å»ºè­°&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹æ¬¡æœƒæ”¹ç”¨ Colab&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>IThome 2022 DevOpsDay Introducing policy as code for terraform</title>
      <link>https://chechia.net/zh-hant/post/2022-06-09-ithome-devopsday-2022-proposal-introduce-policy-as-code-for-terraform-/</link>
      <pubDate>Thu, 09 Jun 2022 01:04:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-06-09-ithome-devopsday-2022-proposal-introduce-policy-as-code-for-terraform-/</guid>
      <description>&lt;h3 id=&#34;titleq&#34;&gt;Titleq&lt;/h3&gt;
&lt;p&gt;å¾é›¶å°å…¥ Policy as Code åˆ° terraform ç”˜è‹¦è«‡ - Introducing policy as code for terraform&lt;/p&gt;
&lt;h3 id=&#34;presentation&#34;&gt;Presentation&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1yawazO1B_sP5Yiav-XLGJXW3ZS2JTV0wGuJwhrUKQ3A/edit?usp=sharing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Slides&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;p&gt;Terraform æ˜¯ä¸€å€‹å¾ˆæ£’çš„ Infrastructure as Code çš„å·¥å…·ï¼Œèƒ½å¤ ä»¥ç¾ä»£çš„è»Ÿé«”å·¥ç¨‹æµç¨‹ä¾†ç©©å®šçš„å»ºæ§‹ infrastructureï¼Œä¸¦éš¨è‘—éœ€æ±‚è®Šæ›´è‡ªå‹•åŒ–è¿­ä»£ï¼Œå°‡æ–°çš„ feature å®‰å…¨åœ°æ›´æ–°åˆ°æ—¢æœ‰çš„ infrastructure ä¸Šã€‚åªè¦æ˜¯ Infrastructure æœ‰é—œçš„å•é¡Œï¼Œæˆ‘ä¸€å¾‹æ¨è–¦ Terraformã€‚&lt;/p&gt;
&lt;p&gt;é€™ä¹Ÿæ„å‘³ Terraform çš„å“è³ªå°±ç­‰æ–¼ infrastructure çš„å“è³ªï¼Œå¥½çš„ terraform å¸¶ä½ ä¸Šå¤©å ‚ï¼Œä¸å¥½çš„ terraform å…¨ team ç«è‘¬å ´ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Infrastructure æœ‰å¤ªå¤šè³‡å®‰çš„è€ƒé‡ï¼Œæ–°çš„é¢¨éšªä¸æ–·è¢«æª¢æŸ¥å‡ºä¾†ï¼Œé€£å¸¶è¦ä¸æ–·çš„ patch terraform code ä¾†é¿å…æ½›åœ¨çš„è³‡å®‰é¢¨éšª&lt;/li&gt;
&lt;li&gt;Infrastructure æœƒä¸æ–·åœ°æ›´æ–°ï¼Œä¾‹å¦‚å…¬æœ‰é›²çš„ api ä¸æ–·æ›´æ–°ï¼Œå»å¹´çš„ code å·²ç¶“è·Ÿä¸ä¸Šä»Šå¹´çš„æœ€ä½³å¯¦è¸äº†&lt;/li&gt;
&lt;li&gt;å¥½çš„å·¥ç¨‹å¸«å¯«å‡ºçš„ terraform code å±Œæ‰“èœé³¥å·¥ç¨‹å¸«ï¼Œè¦å¦‚ä½•è®“åœ˜éšŠä¾å¾ªæ›´å¥½çš„å¯¦è¸ï¼Œé¿å…å¯«å‡ºçˆ› code
ç¶­è­· code æœ‰ clean code / best practiceï¼ŒTerraform ä¹Ÿæœ‰ clean code èˆ‡ best practiceï¼Œå·¥ç¨‹å¸«è¦å¦‚ä½•å·¥å…·ä¾†è¼”åŠ©ï¼Œæ˜¯ Policy as Code çš„ä¸€å¤§èª²é¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ¼”è¬›èšç„¦æ–¼å¯¦éš›ç¶“é©—ï¼Œå¾ä¸€å¤§å † terraform modules é–‹å§‹ï¼Œæ²’æœ‰ Policy as Codeï¼Œåˆ°ä¸€æ­¥æ­¥è©•ä¼°ã€å°å…¥ã€å¯¦ä½œã€æ”¹é€²èˆ‡è¿­ä»£ï¼Œé€æ¼¸çš„æå‡åœ˜éšŠ Terraform code å“è³ªï¼Œæå‡ infrastructure äº¤ä»˜å“è³ªï¼Œä¸¦é¿å…åˆ°æœªä¾†æ½›åœ¨çš„é¢¨éšªã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›çš„ Terraform ç‰ˆæœ¬ç‚ºå¾ 0.12, 0.13, ä¸€è·¯æ¨é€² 1.0+ã€‚&lt;/p&gt;
&lt;h3 id=&#34;content&#34;&gt;Content&lt;/h3&gt;
&lt;p&gt;å¾é›¶å°å…¥ Policy as Code åˆ° terraform ç”˜è‹¦è«‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ Terraform èˆ‡ Policy as Code&lt;/li&gt;
&lt;li&gt;ç•¶ä½ æ‰‹ä¸Šæœ‰æ•¸ä¸å®Œçš„ terraform modulesï¼Œç®¡ç† terraform å“è³ªæ˜¯å€‹å¤§å•é¡Œ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç®¡ç† Terraform
&lt;ul&gt;
&lt;li&gt;è‡ªå‹•åŒ–: æ”¹è®Šå¾ Jenkins pipeline é–‹å§‹ï¼Œgitflow æ”¹é€²ï¼Œpre-commit hook&lt;/li&gt;
&lt;li&gt;Policy as Code æ ¡é©—&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å·¥å…·é‡åŒ– terraform code å“è³ª&lt;/li&gt;
&lt;li&gt;å®Œæ•´å°å…¥ Policy as Code&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°çµ: ç© infra å¿…ç”¨ terraformï¼Œç© terraform å¿…åš policy as code&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;about-me&#34;&gt;About me&lt;/h3&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2018 Ithome Cloud Summit
2018 Ithome Kubernetes Summit
2019 Ithome Cloud Summit
2020 Ithome Cloud Summit
2020/12/18	Cloud Native Taiwan å¹´æœ«èšæœƒ
2020/8/17	DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform
2021 Ithome Cloud Summit
2022 Ithome Cloud Summit
2022 COSCUP&lt;/p&gt;
&lt;h3 id=&#34;suggested-audience&#34;&gt;Suggested Audience&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¨è–¦æœ‰ Terraform ä½¿ç”¨ç¶“é©—ï¼Œç‰¹åˆ¥æ˜¯å…¬æœ‰é›²ç¶“é©—ï¼Œå° Policy as Code æœ‰èˆˆè¶£çš„äºº&lt;/li&gt;
&lt;li&gt;æƒ³è¦å¯«å‡º Terraform clean code çš„äºº&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2022 05 21 COSCUP Operating Time Series Database in K8s</title>
      <link>https://chechia.net/zh-hant/post/2022-05-21-coscup-proposal-operating-time-series-database-in-k8s/</link>
      <pubDate>Sat, 21 May 2022 01:04:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-05-21-coscup-proposal-operating-time-series-database-in-k8s/</guid>
      <description>&lt;h3 id=&#34;titleq&#34;&gt;Titleq&lt;/h3&gt;
&lt;p&gt;åœ¨ k8s ä¸Šè·‘ time series database ç”˜è‹¦è«‡ - Operating Time Series Database in K8s&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1PZryGImYRALMJfbEMuf_jPd2P-qzIwDmVd5DgXSuqq0/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Slides&lt;/a&gt;
Youtube live record: &lt;a href=&#34;https://youtu.be/YexUnVOZC8M?t=9421&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://youtu.be/YexUnVOZC8M?t=9421&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;p&gt;Influxdb ç‚ºå¸‚å æœ€é«˜çš„ time series DBMS ä¹‹ä¸€ï¼Œä½¿ç”¨ä¸Šèˆ‡ RDBMS æœ‰ä¸åŒå„ªåŠ£å‹¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¶­é‹æ–¹é¢ï¼Œdatabase æœ‰è¨±å¤šç›¸ä¼¼éœ€æ±‚ï¼šç©©å®šæ€§ã€é«˜å¯ç”¨æ€§ã€å‚™ä»½ã€é‚„åŸã€è³‡æºç®¡ç†ã€èª¿åº¦ã€ç½é›£å¾©åŸ&amp;hellip;ç­‰ã€‚ç¤¾ç¾¤å¸¸è½åˆ°æœ‰äººå•ï¼šå¯ä¸å¯ä»¥åœ¨ K8s ä¸Šè·‘ databaseã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¼”è¬›æœƒåˆ†äº«åœ¨ k8s ä¸­ç¶­é‹ï¼Œå¯¦å‹™ä¸Šæ‰€é‡åˆ°çš„å•é¡Œï¼Œæä¾›ä¸€äº›æ€è€ƒæ–¹å‘ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›çš„ influxdb ç‰ˆæœ¬ç‚º Influxdb OSS / enterprise 1.9+&lt;/p&gt;
&lt;p&gt;InfluxDB is one the the most popular time series database management system (DBMS) and is a powerful platform when dealing with time series data.&lt;/p&gt;
&lt;p&gt;DBMSs, including RDBMS, have many similar requirements on aspect of infrastructure operation. They all require stability, high availability, backup and restore utilities, cpu / memory resource management, disaster recovery&amp;hellip;etc. People often ask about that whether is it ok to run DBMS in kubernetes cluster or not. This lecture try to provide some points from our experiences dealing with real-world issues.&lt;/p&gt;
&lt;p&gt;The version of InfluxDB discussed in the lecture is InfluxDB OSS / Enterprise 1.9+&lt;/p&gt;
&lt;h3 id=&#34;content&#34;&gt;Content&lt;/h3&gt;
&lt;p&gt;åœ¨ k8s ä¸Šè·‘ time series database ç”˜è‹¦è«‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ Influxdbï¼Œtime series èˆ‡ RDBMS çš„å·®ç•°&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ time series çš„å¹¾å€‹æƒ…å¢ƒ:&lt;/li&gt;
&lt;li&gt;åœ¨ k8s ä¸Šè·‘ DB
&lt;ul&gt;
&lt;li&gt;ç©©å®šæ€§ Availabilityã€HA (enterprise)ã€faillure recovery&lt;/li&gt;
&lt;li&gt;è³‡æºç®¡ç† OOMKilledã€cpu throttlingã€OutOfDisk&lt;/li&gt;
&lt;li&gt;DB management: data migrationã€backup &amp;amp; restoreã€data retention&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°çµ: ä½ è©²ä¸è©²ç”¨ cloud service / VM / åœ¨ K8s ä¸Šè·‘ database&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Operating Time Series Database in K8s&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A brief introduction about InfluxDB and the differences with RDBMS&lt;/li&gt;
&lt;li&gt;Some scenario to use a time series database (other than RDBMS)&lt;/li&gt;
&lt;li&gt;Operate InfluxDB in K8s
&lt;ul&gt;
&lt;li&gt;Stability, availability, disaster recovery&lt;/li&gt;
&lt;li&gt;Resource management, OOMKilled, cpu throttling, out of disk&lt;/li&gt;
&lt;li&gt;DB management: data migration, retention, rotation, backup &amp;amp; restore&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;summary: whether or not to run a database in k8s&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;about-me&#34;&gt;About me&lt;/h3&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2018 Ithome Cloud Summit
2018 Ithome Kubernetes Summit
2019 Ithome Cloud Summit
2020 Ithome Cloud Summit
2020/12/18	Cloud Native Taiwan å¹´æœ«èšæœƒ
2020/8/17	DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform
2021 Ithome Cloud Summit&lt;/p&gt;
&lt;h3 id=&#34;suggested-audience&#34;&gt;Suggested Audience&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¨è–¦æœ‰ k8s ä½¿ç”¨ç¶“é©—çš„å¾æ¥­äººå“¡ï¼Œå° k8s æœ‰ä¸Šæ‰‹ç¶“é©—&lt;/li&gt;
&lt;li&gt;å•å¯ä¸å¯ä»¥åœ¨ k8s ä¸Šé¢è·‘ database çš„äºº&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code Transcript</title>
      <link>https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/</link>
      <pubDate>Mon, 15 Jun 2020 10:58:56 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å„ä½å¥½&lt;/p&gt;
&lt;h1 id=&#34;about-this-presentation&#34;&gt;About this presentation&lt;/h1&gt;
&lt;p&gt;é–‹å§‹ä¹‹å‰ï¼Œå…ˆåˆ†äº«ä¸€äº›è³‡æº&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ•å½±ç‰‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¬›ç¨¿&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¨‹å¼ç¢¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground/blob/master/SOP.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOP ç¯„æœ¬&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Facebook ç²‰å°ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éƒ½æ”¾åœ¨é€™è£¡ï¼Œå› ç‚ºæœ‰é™„é€å­—ç¨¿ï¼Œæ‰€ä»¥å¦‚æœå¾ˆå¿™çš„æœ‹å‹ï¼Œæƒäº† QR code å°±å¯ä»¥å›å®¶è‡ªå·±çœ‹äº†ï¼Œä¸ç”¨å®¢æ°£ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œæœ‰èˆˆè¶£åœ¨è¿½é€™ç³»åˆ—æ–‡ç« çš„ï¼Œå¯ä»¥å¹«æˆ‘ facebook ç²‰å°ˆæŒ‰å€‹è®šè·Ÿè¿½è¹¤ï¼Œæ¯å‘¨æ–°æ–‡ç« å‡ºä¾†ï¼Œæœƒæ¨æ’­é€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ç« åœ¨ chechia.net ä¸Šï¼Œæ–°æ–‡ç« é€šçŸ¥é  facebook ç²‰å°ˆé€™æ¨£ã€‚ä¹Ÿå¯ä»¥åªè¿½è¹¤ä¸æŒ‰è®šã€‚æˆ‘è‡ªå·±çœ‹åˆ¥äººæŠ€è¡“ blog ä¹Ÿå¾ˆå¸¸é€™æ¨£(XD&lt;/p&gt;
&lt;h2 id=&#34;éœ€æ±‚&#34;&gt;éœ€æ±‚&lt;/h2&gt;
&lt;p&gt;å¥½ï¼Œä»Šå¤©ä¾†è¬›å¾—é€™å€‹ Terraform&lt;/p&gt;
&lt;p&gt;æˆ‘æœƒå¯¦éš›åˆ†äº«æˆ‘å€‘å…¬å¸ç‚ºé›²åœ˜éšŠå°å…¥çš„ç¶“é©—ï¼Œå‰åŠéƒ¨æœƒæœ‰é»åƒè³¼ç‰©é »é“çš„å»£å‘Š&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹çš„å°è©±æ˜¯ä¸æ˜¯å¸¸å‡ºç¾åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;ä»¥ä¸‹é€™æ®µå°è©±å¾ˆè€³ç†Ÿ&#34;&gt;ä»¥ä¸‹é€™æ®µå°è©±å¾ˆè€³ç†Ÿï¼Ÿ&lt;/h1&gt;
&lt;p&gt;ã€Œæ˜¯èª°æ”¹äº†é€™å€‹è¨­å®šï¼Ÿã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;by é€±ä¸€ä¸Šç­çš„ DevOps èˆ‡é€±å…­å€¼ç­çš„ç¶­é‹åœ˜éšŠ&lt;/li&gt;
&lt;li&gt;å°å•Ÿç”¨çš„ç’°å¢ƒçš„æŒæ¡å¦‚ä½•&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒçš„è®Šæ›´èƒ½å¦æ°¸ä¹…ä¿å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ã€Œé€™å€‹ç’°å¢ƒæ€éº¼å°‘ä¸€å€‹è¨­å®šï¼Ÿã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¶²ç«™å™´éŒ¯å¾Œï¼Œæ•´å€‹åœ˜éšŠä¸€æ­¥æ­¥é‡æ¸…å•é¡Œï¼Œä¸æ˜¯ codeï¼Œä¸æ˜¯è®Šæ•¸configï¼Œæ˜¯ infra æœ‰ä¸€å€‹å°åœ°æ–¹æ²’è¨­å®š&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒè¤‡é›œï¼Œä»¥æˆ‘å€‘çš„ä¾‹å­æ˜¯è¤‡é›œå¾—å¤šé›²ç¶²è·¯ï¼Œå¸¸å‡ºé€™ç¨®å•é¡Œ&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒè¨­å®šçš„é™¤éŒ¯å¾ˆè²»æ™‚&lt;/li&gt;
&lt;li&gt;å®Œå…¨å¯ä»¥é¿å…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ã€Œæœƒå‹•å°±å¥½ï¼Œæ²’äº‹ä¸è¦æ”¹ç’°å¢ƒï¼ˆæŠ–ï¼‰ã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Legacy site&lt;/li&gt;
&lt;li&gt;èª¿æ•´ production ç’°å¢ƒæ˜¯å¦æœ‰ä¿¡å¿ƒ&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘çœ‹ä¸æ…£ç„¡äººæ•´ç†çš„èˆŠæ¶æ§‹ï¼Œå°å…¥ terraform å¾Œï¼Œï¼ˆå¾ˆä¸è¦å‘½çš„ï¼‰æŠŠ production site æ¬éä¸€é&lt;/li&gt;
&lt;li&gt;æˆ‘æœ‰åæˆçš„ä¿¡å¿ƒè·Ÿä½ èªªæ–°èˆŠå…©å€‹ site å®Œå…¨ä¸€æ¨£&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;our-stories&#34;&gt;Our stories&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘æ˜¯æ€è¯ç§‘æŠ€(ï¼¸ï¼¤)&lt;/li&gt;
&lt;li&gt;é–‹ç™¼åœ˜éšŠå¤§æ¦‚ 100+ å€‹å·¦å³&lt;/li&gt;
&lt;li&gt;å°ˆæ¡ˆå¾ˆå¤šï¼Œè€Œä¸”è€é—†å¾ˆå–œæ­¡é–‹æ–°å°ˆæ¡ˆæ¸¬è©¦å•†æ¥­æ¨¡å‹&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒä¹Ÿè¶Šé–‹è¶Šå¤šï¼Œå¤§å¤§å°å°å¹¾ç™¾å° vmï¼Œå¹¾åå€‹è³‡æ–™åº«ï¼Œéƒ½æ˜¯ä¸åŒå°ˆæ¡ˆåœ¨è·‘ï¼Œè¦æ¨¡å¤§æ¦‚é€™æ¨£&lt;/li&gt;
&lt;li&gt;æ¯é€±éƒ½æœ‰æ–°ç’°å¢ƒè¦äº¤ä»˜&lt;/li&gt;
&lt;li&gt;äº¤æ¥ç¼ºå£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å€‘å…¬å¸æ±è¥¿å¤šï¼Œä½†æ±è¥¿å¤šä¸æ˜¯å•é¡Œï¼Œå•é¡Œæ˜¯ä»€éº¼å‘¢?&lt;/p&gt;
&lt;h1 id=&#34;å•é¡Œ&#34;&gt;å•é¡Œ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ‰‹å‹•éƒ¨å±¬æœ¬ä¾†ä¸æ˜¯å•é¡Œï¼Œä½†æ¼¸æ¼¸æˆç‚ºå•é¡Œ
&lt;ul&gt;
&lt;li&gt;é–‹ infrastructure çš„æ–¹æ³•ï¼Œè·Ÿè‘— SOP ä¸Šå» GCP GUI ä»‹é¢ï¼Œé»ä¸€é»ï¼Œå¡«ä¸€å¡«ã€‚å…¬æœ‰é›²é–‹æ©Ÿå™¨å¾ˆæ–¹ä¾¿ã€‚&lt;/li&gt;
&lt;li&gt;å¯æ˜¯ä¸åŒäººé–‹çš„ç’°å¢ƒæ¼¸æ¼¸å‡ºç¾ä¸€äº›ä¸åŒï¼Œå¯èƒ½å·®ä¸€å€‹è¨­å®šã€ä¸€å€‹åƒæ•¸ã€æˆ–æ˜¯å‘½åè¦å‰‡å·®ä¸€é»ã€‚é€™äº›ç´°ç¯€çš„ä¸åŒï¼Œå·®ä¸€å€‹ config æœ‰æ™‚å€™å°±æœƒé›·åˆ°äººã€‚ã€Œé€™æ©Ÿå™¨èª°å»ºçš„é˜¿ï¼Œæ ¹æœ¬æœ‰å•é¡Œå•Šã€ï¼Œè€Œä¸”é€™ç¨®é›·å¾ˆå¤šæ™‚å€™éƒ½æ˜¯è·‘ä¸‹å»å‡ºäº‹äº†ï¼Œæ‰ç™¼ç¾ã€Œé˜¿é åŸä¾†è¨­å®šä¸ä¸€æ¨£ã€&lt;/li&gt;
&lt;li&gt;å‘½åå·®ä¸€é»ä¸å½±éŸ¿åŠŸèƒ½ï¼Œä½†çœ‹ä¹…äº†å°±å¾ˆç…©ï¼Œã€Œé˜¿å°±å°ä¸é½Šé˜¿ã€ï¼Œæœ‰å¼·è¿«ç—‡å°±å¾ˆç—›è‹¦ã€‚ç„¶å¾Œä½ ç¶­é‹çš„è‡ªå‹•åŒ–è…³æœ¬å°±çˆ†æ‰ï¼Œå‘½åå·®ä¸€å€‹å­—ï¼Œregex å°±è¦å¤§æ”¹ã€‚çªç„¶å¢åŠ ç¶­é‹æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”Ÿç”¢ç’°å¢ƒå¤§å®¶éƒ½ä¸å¤ªæ•¢å‹•ã€‚æ¶æ§‹èª¿æ•´å¾ˆæ²’ä¿¡å¿ƒ
&lt;ul&gt;
&lt;li&gt;èª°çŸ¥é“ç•¶åˆç’°å¢ƒè¨­å®šäº†é‚£äº›æ±è¥¿ï¼Œé–‹æ©Ÿå™¨çš„äººé›¢è·äº†ï¼Œä¹Ÿä¸çŸ¥é“ä»–ç‚ºå•¥è¨­å®šï¼Œã€Œä½ çŸ¥é“ä»–ç•¶åˆç‚ºä»€éº¼è¦è¨­å®šé€™å€‹å—?ã€ï¼Œä½ å•æˆ‘æˆ‘æ˜¯è¦å»æ“²èŒ­å–”ã€‚
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘é€™ä¸€å­£æŠŠæ‰€æœ‰ç¾æœ‰ç’°å¢ƒéƒ½æ¬åˆ°æ–°çš„æ¶æ§‹ä¸Šï¼Œå› ç‚ºæˆ‘å€‘å°èˆŠæ¶æ§‹ä¸çˆ½å¾ˆä¹…äº†(XD)ï¼Œé€™å€‹èƒ½åšåˆ°ç•¶ç„¶æœ‰ä½œæ³•ï¼Œå¾Œé¢ç´°è¬›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰å¯¦éš›éœ€æ±‚æ‰æ‰¾è§£æ±ºæ–¹æ¡ˆï¼Œæ²’æœ‰éœ€æ±‚å°±ä¸ç”¨è¡å‹•å°å…¥æ–°æŠ€è¡“ï¼Œå°å…¥éç¨‹ä¸­é‚„æ˜¯è »ç´¯çš„&lt;/p&gt;
&lt;h1 id=&#34;éœ€æ±‚-1&#34;&gt;éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;å¾ç¶­é‹çš„è§’åº¦ï¼Œéœ€æ±‚å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æå‡ç©©å®šåº¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;infra äº¤ä»˜æ¨™æº–åŒ–&lt;/li&gt;
&lt;li&gt;äº¤ä»˜è‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦ç’°å¢ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;infra æäº¤è¦èƒ½å¤  review&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æå‡æ•ˆç‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è€é—†è¦çš„ã€‚è¶…å¿«éƒ¨å±¬ï¼Œè…³æœ¬è·‘ä¸‹å»è¦å¿«ï¼Œé‚„è¦æ›´å¿«&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¬¡è¦ç›®æ¨™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆæœ¬ï¼Œæ•ˆèƒ½æœ€ä½³åŒ–ï¼Œå¸Œæœ›èƒ½åœ¨æ•´ç†éç¨‹ä¸­ï¼Œæ‰¾åˆ°æœ€é©åˆçš„å¯è¡Œæ¶æ§‹&lt;/li&gt;
&lt;li&gt;æ–°äººå¥½ä¸Šæ‰‹ï¼ŒJunior åŒäº‹ä¹Ÿèƒ½ã€Œå®‰å…¨ã€çš„æ“ä½œï¼Œçœ‹åˆ°é€™å€‹å®‰å…¨å…©å€‹å­—äº†å—? å®‰å…¨ç¬¬ä¸€ï¼Œåœ¨è¨“ç·´æ–°çš„ op æ™‚è¦æ³¨æ„å®‰å…¨ï¼Œä¸ç„¶ä»–ä¸Šå» GUI é»ä¸€é»ï¼Œä¸€å€‹æ‰‹èµ·åˆ€è½ DB å°±ä¸è¦‹äº†ï¼Œæ•´å€‹ç¶­é‹åœ˜éšŠä¸€å‘¨ä¸ç”¨ç¡è¦ºã€‚å®‰å…¨ç¬¬ä¸€å¼ã€‚&lt;/li&gt;
&lt;li&gt;æ¬Šé™æ§ç®¡ï¼ŒIAM ä¹Ÿç”¨ terraform ç®¡ç†ï¼Œæ¬Šé™ç®¡ç†äººå¤šæ‰‹é›œè¶Šç”¨è¶Šäº‚ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ IaCï¼Œä¸€è¦½ç„¡éº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;programatical-approach-for-infra&#34;&gt;Programatical approach for infra&lt;/h1&gt;
&lt;p&gt;å•Šä¸å°±æ˜¯ Infrastructure as code XD&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å…¥å‰ï¼Œå¤§å®¶éƒ½æœ‰è½éï¼Œå¤§å®¶éƒ½è¦ºå¾—å¾ˆæƒ³å°å…¥ï¼Œä½†æ²’äººæœ‰ç¶“é©—ï¼Œæ¯å€‹äººéƒ½è¶…æ€•ï¼Œä½†åˆä¸çŸ¥é“åœ¨æ€•ä¸‰å°&lt;/li&gt;
&lt;li&gt;é€™è¡¨æ˜äº†ä¸€ä»¶äº‹ï¼Œå¤§å®¶éƒ½çŸ¥é“è¦åšå°çš„äº‹æƒ…ï¼Œä½†ä¸æ˜¯æ¯å€‹äººéƒ½èƒ½æ”¹è®Šç¾æ³ï¼Œè®“åœ˜éšŠå°å‘å°çš„äº‹æƒ…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¨ˆç•«&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¢ºå®šéœ€æ±‚&lt;/li&gt;
&lt;li&gt;é–‹å§‹ survey&lt;/li&gt;
&lt;li&gt;ã€Œå°å¿ƒã€å°å…¥&lt;/li&gt;
&lt;li&gt;æœ‰ç¶“é©—é ˜é ­ç¾Šå¾ˆæ£’ï¼Œä½†ä¸æ˜¯å¿…é ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æŠ€è¡“ç´°ç¯€&#34;&gt;æŠ€è¡“ç´°ç¯€&lt;/h2&gt;
&lt;p&gt;å…ˆç°¡å–®è¬›ä¸€ä¸‹ IaC (Yeah çµ‚æ–¼è¦è¬›æŠ€è¡“äº†)&lt;/p&gt;
&lt;h1 id=&#34;iac&#34;&gt;IaC&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢éƒ½è¬›æ¦‚å¿µè·Ÿå¿ƒæ³•ï¼Œç¾åœ¨å¯¦éš›è¬›ç”¨åˆ°çš„æŠ€è¡“ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯ Infrastructure as Codeï¼Œé€™å€‹æ¦‚å¿µå¾ˆä¹…äº†ï¼Œä½†å°å…¥çš„å…¬å¸å¥½åƒä¸æ˜¯é‚£éº¼å¤šã€‚æ‰€ä»¥æˆ‘ä»Šå¤©è¦ä¾†å‚³æ•™ï¼Œæ´—è…¦å¤§å®¶(XDï¼Œè·Ÿä½ æ¨è–¦é€™å€‹é…æ–¹ä¿è­‰å¿«åˆæœ‰æ•ˆ(XD)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡å–®ä¾†èªªå°±æ˜¯ç”¨ç¨‹å¼ä¾†æ“ä½œ infrastructureï¼Œä»Šå¤©ä¸»è¬›çš„ terraform æ˜¯ IaC å·¥å…·ä¸­çš„ä¸€å€‹&lt;/li&gt;
&lt;li&gt;IaC å·¥å…·å¯ä»¥æ˜¯å®£å‘Šå¼ï¼Œæˆ–æ˜¯å‘½ä»¤å¼ï¼Œæˆ–æ˜¯å…©ç¨®éƒ½æ”¯æ´
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹æ˜¯æˆ‘å‘Šè¨´ä½ çµæœï¼Œæ­¥é©Ÿæˆ‘ä¸ç®¡ï¼Œè«‹ä½ å¹«æˆ‘ç”Ÿå‡ºé€™æ¨£çš„çµæœã€‚&lt;/li&gt;
&lt;li&gt;ä¸€å€‹æ˜¯æˆ‘å‘Šè¨´ä½ æ­¥é©Ÿï¼Œä½ ä¸€æ­¥ä¸€æ­¥å¹«æˆ‘åšå®Œï¼Œå°±æœƒå¾—åˆ°æˆ‘è¦çš„çµæœ&lt;/li&gt;
&lt;li&gt;terraform æ˜¯å®£å‘Šå¼ï¼Œèªªæ˜é‚è¼¯è·Ÿçµæœï¼Œä¾‹å¦‚æˆ‘è¦ 1 2 3 å°æ©Ÿå™¨ï¼Œterraform è‡ªå·±å»å¹«æˆ‘æ‰“ Google API é€™æ¨£ï¼ŒæŠŠæ©Ÿå™¨ç”Ÿå‡ºä¾†&lt;/li&gt;
&lt;li&gt;ansible æ˜¯å‘½ä»¤å¼ï¼Œæˆ‘æŠŠæ­¥é©Ÿå¯«æˆä¸€å †å‘½ä»¤è…³æœ¬ playbook ï¼Œansible å¹«æˆ‘ç…§è‘—è·‘ä¸‹å»ï¼Œç†è«–ä¸Šè·‘å®Œå¾Œæˆ‘çš„æ©Ÿå™¨ä¹Ÿæº–å‚™å¥½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;terraform&#34;&gt;Terraform&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å®˜ç¶²åœ¨é€™é‚Šï¼Œè‡ªå·±çœ‹ &lt;a href=&#34;https://www.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å®£å‘Šå¼çš„ Iac å·¥å…·&lt;/li&gt;
&lt;li&gt;å–®ä¸€èªæ³•æè¿°å„å®¶ API&lt;/li&gt;
&lt;li&gt;é€é provider è½‰æ› tf æˆç‚º API call&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;terraform-core-workflow&#34;&gt;Terraform Core Workflow&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/guides/core-workflow.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/guides/core-workflow.html&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Write æ’°å¯«æœŸå¾…ç‹€æ…‹ tf file&lt;/li&gt;
&lt;li&gt;plan è¨ˆç•«è©¦ç®—çµæœ&lt;/li&gt;
&lt;li&gt;apply ç”¨æœŸå¾…ç‹€æ…‹å»æ›´æ–°é ç«¯
&lt;ul&gt;
&lt;li&gt;tf fileï¼Œå°±æ˜¯å®£å‘Šå¼çš„è¡¨é” infra ï¼Œæè¿°æœŸå¾…çš„infraé•·é€™æ¨£ï¼Œex. tf file è£¡æœ‰é€™äº›æ©Ÿå™¨ 1 2 3 å°é€™æ¨£
&lt;ul&gt;
&lt;li&gt;resource ä¸€å€‹ä¸€å€‹ç‰©ä»¶æè¿°ï¼Œå¾Œé¢å¯èƒ½æ˜¯å°æ˜  provider çš„ API Endpoint (ex. GCP GKE API)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;remote resourcesï¼Œæ˜¯çœŸå¯¦å­˜åœ¨é ç«¯çš„æ©Ÿå™¨ï¼Œä¾‹å¦‚ GCP é›²ç«¯å¯¦éš›ä¸Šåªæœ‰ 1 2 å…©å°é€™æ¨£ã€‚&lt;/li&gt;
&lt;li&gt;terraform diff tf vs remoteï¼Œç®—å‡º planï¼Œå°‘çš„ç”Ÿå‡ºä¾†ï¼Œå¤šçš„ä¸Šå»ç æ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;demo-1&#34;&gt;Demo 1&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;(empty project)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;add my-gce.tf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git diff&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;state&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;check GUI remote&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;existing my-gce&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;remove my-gce.tf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plan&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€™é‚Šä¸ apply æˆ‘ demo é‚„è¦ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šé€™æ¨£æœ‰ç†è§£ terraform çš„åŸºæœ¬æµç¨‹å—ï¼Ÿç·¨å¯«ï¼Œè¨ˆç•«ï¼Œapply ä¸‰æ­¥é©Ÿ
å¾ˆå–®ç´”
ç„¶å¾Œè¬›ä¸€é»ç´°ç¯€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;state&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;remove (out of scope)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plan -&amp;gt; addd&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apply (deplicated ID)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mv state (Danger)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;rename state with the same ID -&amp;gt; destroy and recreate (Danger)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;state&#34;&gt;State&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;terraform ç¶“æ‰‹(apply) éçš„ resource æœƒç´å…¥ state (scope)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸åœ¨ scope è£¡çš„ resource ä¸æœƒç´å…¥ planï¼Œä¸æœƒè¢« destroyï¼Œä½†å¯èƒ½æœƒ create duplicated ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;terraform å…è¨±ç›´æ¥æ“ä½œ state&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;import&lt;/li&gt;
&lt;li&gt;remove&lt;/li&gt;
&lt;li&gt;ä½†æˆ‘ä¸å…è¨±XD&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„æ˜¯ diff state å–”ï¼Œæ‰€ä»¥æ¯æ¬¡ plan æ™‚å€™æœƒè‡ªå‹• refresh state&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;state åˆæ˜¯ä»€éº¼? remote æ˜¯ä¸€å€‹å‹•æ…‹ç’°å¢ƒï¼Œå¯èƒ½æœƒå¤šæœƒå°‘ï¼Œé€™æ¨£æ²’è¾¦æ³• diffï¼Œstate æ˜¯æŠŠæˆ‘åŸ·è¡Œç•¶ä¸‹ï¼Œé ç«¯ç›¸é—œè³‡æºçš„ç‹€æ…‹å¿«ç…§å­˜èµ·ä¾†ï¼Œç„¶å¾Œæ ¹æ“šé€™å€‹ snapshop å» diff&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apply åªæ˜¯æ‹¿ä½ çš„æœŸå¾…å» diff stateï¼Œterraform å¹«ä½ ç®—å‡ºä¾†å·®å¤šå°‘ï¼Œä¾‹å¦‚æˆ‘å€‘é€™é‚Šå°±æ˜¯é ç«¯å°‘ä¸€å°ã€‚terraform é€é provider å»çŸ¥é“ï¼Œå–”é€™ä¸€å°è¦å»æ‰“é‚£äº› GCP APIï¼ŒæŠŠé€™å°ç”Ÿå‡ºä¾†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Stateï¼Œæ˜¯æ ¸å¿ƒæ¦‚å¿µï¼Œæˆ‘ç•¶åˆè‡ªå·±å¡è§€å¿µæ˜¯å¡é€™é‚Šï¼Œæ‰€ä»¥æˆ‘ç‰¹åˆ¥æ‹‰å‡ºä¾†è¬›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›²ç«¯ç©ºè•©è•©ï¼Œrefresh state ä¹Ÿæ˜¯ç©ºçš„ï¼Œtf file å¤šåŠ ä¸€å€‹ VMï¼Œplan è¦ºå¾—è¦ create&lt;/li&gt;
&lt;li&gt;é›²ç«¯æœ‰æ±è¥¿ï¼Œrefresh state æœªå¿…æœƒ refresh åˆ°
&lt;ul&gt;
&lt;li&gt;ç›¸åŒ ID çš„è³‡æºä¹‹å‰ import åœ¨ state ä¸­ï¼Œrefresh stateï¼Œtf file æ²’æ±è¥¿ï¼Œplan è¦ºå¾—è¦ destroy&lt;/li&gt;
&lt;li&gt;ç›¸åŒ ID çš„è³‡æºä¸åœ¨ state ä¸­ï¼Œé€™äº› resource ä¸åœ¨ç•¶å‰ state çš„ scopor ä¸­ï¼Œrefresh state æ˜¯ç©ºçš„ï¼Œtf file æ²’æ±è¥¿ï¼Œplan è¦ºå¾—æ²’å¢æ²’æ¸›&lt;/li&gt;
&lt;li&gt;ç›¸åŒ ID çš„è³‡æºä¸åœ¨ state ä¸­ï¼Œé€™äº› resource ä¸åœ¨ç•¶å‰ state çš„ scopor ä¸­ï¼Œrefresh state æ˜¯ç©ºçš„ï¼Œtf file æœ‰ç›¸åŒ ID çš„è³‡æºï¼Œplan è¦ºå¾—è¦ createï¼Œä½†å¯¦éš› applyï¼ŒAPI error é ç«¯å·²ç¶“æœ‰ç›¸åŒ ID çš„è³‡æºå­˜åœ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Write -&amp;gt; Plan -&amp;gt; Apply&lt;/li&gt;
&lt;li&gt;State&lt;/li&gt;
&lt;li&gt;å¤§å®¶éƒ½æœƒ terraform æƒ¹&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;åˆæ­¥ä½¿ç”¨æ„Ÿæƒ³&#34;&gt;åˆæ­¥ä½¿ç”¨æ„Ÿæƒ³&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;IaC åœ°ç«¯è·Ÿé›²ç«¯éƒ½èƒ½åšï¼Œä½†é›²ç«¯åšèµ·ä¾†æ•ˆæœè¶…ç´šå¥½
&lt;ul&gt;
&lt;li&gt;å®Œå…¨å±•ç¾é›²ç«¯é‹ç®—çš„ç‰¹æ€§ï¼Œè¿…é€Ÿã€å½ˆæ€§ã€éš¨ç”¨éš¨å«ï¼Œèª¿åº¦å¤§é‡çš„è™›æ“¬åŒ–è³‡æº&lt;/li&gt;
&lt;li&gt;æ–°å¢æ±è¥¿å¾ˆå¿«ï¼Œä¸è¦çš„è³‡æºï¼Œè¦åˆªæ‰ä¹Ÿå¾ˆå¿«
&lt;ul&gt;
&lt;li&gt;ä¸å°å¿ƒåˆªéŒ¯ä¹Ÿå¾ˆå¿«(å¤§èª¤)ï¼Œæ‰€ä»¥æˆ‘èªªæ–°äººä¸€å€‹æ‰‹èµ·åˆ€è½å…¬å¸æ•´å€‹é›²å¼„ä¸è¦‹ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼Œã€Œå•Šæˆ‘çš„é›²å‹’ã€ã€Œè¢« terraform ç äº†ã€ã€‚ä¸è¦ç¬‘ï¼Œé‚£å€‹æ–°äººå°±æ˜¯æˆ‘ï¼Œæˆ‘è‡ªå·±å‰›å­¸çš„æ™‚å€™å°±æœ‰æŠŠæ•´å€‹ db è®Šä¸è¦‹éï¼Œå·®é»ä¸€åˆ°è·å°±å¼•å’è¾­è·(XDã€‚ç”¨é€™äº›æŠ€è¡“é‚„æ˜¯æœ‰å¾ˆå¤šå®‰å…¨è¦æ³¨æ„ï¼Œç¨å¾Œæœƒç´°è¬›æ³¨æ„çš„å®‰å…¨äº‹é …ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½ä¹‹ï¼ŒIac å°±æ˜¯ç”¨ç¨‹å¼åŒ–çš„èªæ³•ï¼Œç²¾æº–çš„æè¿°é›²ç«¯çš„ç‹€æ…‹æˆ–æ˜¯æ­¥é©Ÿï¼Œå®Œå…¨æ²’æœ‰æ¨¡ç³Šçš„åœ°å¸¶ã€‚å¸¶ä¾†çš„å¥½è™•ï¼Œé™ä½ç¶­é‹çš„éŒ¯èª¤é¢¨éšªï¼ŒåŠ å¿«ç¶­é‹æ•ˆç‡ï¼Œæœ€ä½³åŒ–ç¯€çœæˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ–°æ‰‹-state-çš„é›·&#34;&gt;æ–°æ‰‹ state çš„é›·&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¤šäººå”ä½œï¼ŒåŒæ™‚è®Šæ›´ state æœƒé€ æˆä¸å¯é æœŸçš„éŒ¯èª¤
&lt;ul&gt;
&lt;li&gt;é¿å…ç›´æ¥æ“ä½œ state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;state å¯èƒ½æœ‰ sensitive è³‡æ–™&lt;/li&gt;
&lt;li&gt;æ¨è–¦ä½¿ç”¨å¤–éƒ¨å¸¶æœ‰ lock çš„ state storage&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å°å…¥&#34;&gt;å°å…¥&lt;/h2&gt;
&lt;h1 id=&#34;å°å…¥å·¥å…·ä¹‹å¾Œ&#34;&gt;å°å…¥å·¥å…·ä¹‹å¾Œ&lt;/h1&gt;
&lt;p&gt;æ–°å·¥å…·å°å…¥æ™‚è¦åšå¥½é¢¨éšªè©•ä¼°ï¼Œæ¯å€‹äººéƒ½æ˜¯ç¬¬ä¸€æ¬¡ç”¨ terraform ï¼Œç”¨èµ·ä¾†å¾ˆå¿«å¾ˆçˆ½çš„åŒæ™‚ä¹Ÿè¦ä¸æ–·å®£å°å®‰å…¨æ¦‚å¿µï¼Œé›·åœ¨å“ªè£¡å‘åœ¨å“ªè£¡ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ terraform çš„é¢¨éšª&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“ DELET API è¶…å¿«ï¼Œç èµ·ä¾†å¾ˆæ–¹ä¾¿ï¼Œä½†å¾ˆå¤šæ™‚å€™æ–¹ä¾¿ = å±éšªã€‚çœ¼çœ‹å°æ˜ä¸€å€‹æ‰‹èµ·åˆ€è½ï¼Œè«‡ç¬‘é–“ï¼Œå…¬æœ‰é›²ç°é£›ç…™æ»…(XDï¼Œé€šé€šè®Šä¸è¦‹ã€‚ç¾åœ¨åœ¨è¬›æ•…äº‹å¾ˆé–‹å¿ƒï¼Œå¯¦éš›ç™¼ç”Ÿçš„è©±å¤§å®¶éƒ½ç¬‘ä¸å‡ºä¾†ï¼Œå…¨å…¬å¸ RD éƒ½è·‘ä¾†ç¶­é‹éƒ¨é–€æ’éšŠç›¯è‘—ä½ çœ‹ï¼Œå°±ç®—ä¿®å¥½ä¹Ÿè¦æ‡²è™•ã€‚å£“åŠ›è¶…å¤§ã€‚ä½†å°æ˜ç éŒ¯æ±è¥¿ä¸æ˜¯å°æ˜çš„éŒ¯ï¼Œæ˜¯å¤§ç’°å¢ƒçš„éŒ¯æ˜¯ SOP çš„éŒ¯(XDã€‚èªçœŸçš„ï¼Œåœ˜éšŠæ²’æœ‰æä¾› SOPï¼Œæ–°äººç éŒ¯æ±è¥¿ç•¶ç„¶æ˜¯åœ˜éšŠè² è²¬ã€‚æ‰€ä»¥æˆ‘å€‘ SOP ç¬¬ä¸€è¡Œå°±å¯«å¾—å¾ˆæ¸…æ¥šã€‚&lt;/li&gt;
&lt;li&gt;çœ‹è¦‹ destroy å°±é›™æ‰‹é›¢é–‹éµç›¤ï¼Œç›´æ¥æ±‚æ•‘ï¼Œé€™æ¨£é‚„èƒ½å‡ºäº‹å—&lt;/li&gt;
&lt;li&gt;å†ä¾†ï¼Œçµ¦äºˆç‰¹æ®Šçš„ IAM æ¬Šé™ï¼Œä¾‹å¦‚åªèƒ½æ–°å¢ä¸èƒ½åˆªé™¤çš„æ¬Šé™&lt;/li&gt;
&lt;li&gt;é€²ä¸€æ­¥å°å…¥ git-flowï¼Œpushã€reviewã€PRï¼Œè®“ä»–é€£çŠ¯éŒ¯çš„æ©Ÿæœƒéƒ½æ²’æœ‰&lt;/li&gt;
&lt;li&gt;æ ¹æœ¬é‚„æ˜¯è¦çµ¦äºˆæ–°äººè¶³å¤ çš„è¨“ç·´ï¼Œç„¶å¾ŒåŒæ™‚ä¿éšœå…¬å¸å®‰å…¨ã€‚
&lt;ul&gt;
&lt;li&gt;çµ¦æ–°äººéå¤§æ¬Šé™ç éŒ¯æ±è¥¿ï¼Œæˆ–æ˜¯å·¥ä½œæµç¨‹ä¸€å †å‘ï¼Œæ ¹æœ¬æ˜¯åœ¨èª˜å°æ–°äººçŠ¯éŒ¯ï¼Œåœ˜éšŠçš„è³‡æ·±æˆå“¡è¦æª¢è¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é€æ¼¸å°å…¥&#34;&gt;é€æ¼¸å°å…¥&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å°å…¥çš„éç¨‹ä¸æ–·æª¢è¨è·Ÿä¿®æ”¹ï¼Œæœ€å¾Œæ‰¾å‡ºé©åˆæˆ‘å€‘å…¬å¸çš„æµç¨‹&lt;/li&gt;
&lt;li&gt;æª¢è¨é€æ˜ï¼Œæœ‰éŒ¯å°±ä¿® SOPï¼Œä¿®å·¥ä½œæµç¨‹ã€‚è®“ä½ çš„å·¥ä½œæµç¨‹è·Ÿå·¥ä½œç’°å¢ƒï¼Œå›ºè‹¥é‡‘æ¹¯ï¼Œæˆå“¡å¾ˆé›£åœ¨è£¡é¢çŠ¯éŒ¯ï¼Œé€™æ‰æ˜¯ DevOps åœ¨åšé€™çš„äº‹ã€‚&lt;/li&gt;
&lt;li&gt;å®˜æ–¹å»ºè­°çš„æœ€ä½³å¯¦ä½œ &lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è‡³æ–¼æˆ‘å€‘æ˜¯å¦‚ä½•é€æ¼¸å°å…¥ IaC åˆ°å…¬å¸çš„é–‹ç™¼æµç¨‹ä¸­ï¼Ÿå…·é«”çš„å°å…¥æ­¥é©Ÿå¦‚ä¸‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;introduction-iac&#34;&gt;Introduction: IaC&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;èˆŠæ¶æ§‹ä¿å­˜ã€‚å…ˆæŠŠé›²ç«¯ä¸Šå·²ç¶“æœ‰çš„æ©Ÿå™¨ï¼Œterraform è£¡é¢å«è³‡æºï¼Œimport æˆä»£ç¢¼&lt;/li&gt;
&lt;li&gt;æª¢æŸ¥èˆŠæ¶æ§‹ã€‚æ‰€æœ‰è¨­å®šéƒ½è®Šæˆä»£ç¢¼äº†ï¼Œè·Ÿä½ çœ‹ç¨‹å¼ç¢¼ä¸€æ¨£ï¼Œä¸€æ‹å…©çªçœ¼æ²’æœ‰ä»»ä½•æ¨¡ç¨œå…©å¯ã€‚æ•´ç†éç¨‹ä¸­æ‰¾å‡ºåˆç†è·Ÿä¸åˆç†çš„è¨­å®šã€‚æœ‰å¯èƒ½æœƒç™¼ç¾ä¸€äº›é›·ï¼Œåªæ˜¯é‚„æ²’çˆ†ç‚¸ï¼Œä¹Ÿè¶æ©Ÿä¿®ä¸€ä¿®ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œï¼Œä¾ç…§é€™äº›ç¾è¡Œçš„è³‡æºï¼Œå»æ•´ç†ä¸€ä»½é©åˆå…¬å¸çš„ç’°å¢ƒç¯„æœ¬ï¼Œä¹‹å¾Œæ‰€æœ‰çš„æ–°ç’°å¢ƒéƒ½é€™é€™å€‹ç¯„æœ¬éƒ¨å±¬ï¼Œç¢ºå®šæ–°çš„ç’°å¢ƒéƒ½æœ‰åˆç†çš„è¦åŠƒã€‚&lt;/li&gt;
&lt;li&gt;åˆ°æ­¤ï¼Œæ‰€æœ‰æ–°ç’°å¢ƒéƒ½æ˜¯åŒä¸€ä»½ç¯„æœ¬ç”Ÿå‡ºä¾†çš„ï¼Œç’°å¢ƒå·²ç¶“æ¨™æº–åŒ–äº†ã€‚ä¸æœƒå†æœ‰é›¶ç¢çš„å°éŒ¯èª¤ã€‚è½èµ·ä¾†è¶…è®šï¼Œä½†æœ‰æ™‚å€™å‡ºéŒ¯å°±æ˜¯ä¸€èµ·å…¨éŒ¯ï¼Œè¶…æ…˜(XDã€‚ç•¶ç„¶æœ‰éŒ¯å°±ä¿®ç¯„æœ¬ï¼Œä¿® SOPã€‚åŒæ¨£çš„éŒ¯æ°¸ä¸å†çŠ¯ï¼Œä¸ç”¨å†ä¿®ç¬¬äºŒæ¬¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;introduction-git-flow&#34;&gt;Introduction: Git-flow&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ç„¶å¾Œï¼Œå°å…¥ç‰ˆæœ¬æ§ç®¡ï¼Œæ•´åˆ git-flow çš„é–‹ç™¼æµç¨‹ã€‚å¯« SOPï¼Œä¹‹å¾Œæ‰€æœ‰è®Šæ›´éƒ½è¦&lt;/li&gt;
&lt;li&gt;å…ˆæŠŠ master å°èµ·ä¾†ï¼Œæ‰€æœ‰äººéƒ½ä¸å‡†ç›´æ¥æ”¹æ¶æ§‹&lt;/li&gt;
&lt;li&gt;é–‹æ–° branchï¼Œcommit&lt;/li&gt;
&lt;li&gt;é–‹ PR å¤§å®¶ reviewï¼Œå¤§å®¶éƒ½çœ‹éäº†å¼ï¼Œå† merge é€²å»ï¼Œé€™æ¨£æœ‰éŒ¯å°±ä¸æ˜¯ä¸€å€‹äººçš„é‹è€Œæ˜¯å¤§å®¶ä¸€èµ·èƒŒé‹(XDã€‚ä¸æ˜¯æ‹‰ï¼Œreview èƒ½å¤§å¹…é™ä½éŒ¯èª¤ï¼Œåˆ†äº«åœ˜éšŠç¶“é©—åŠ é€Ÿæ–°äººè¨“ç·´ï¼Œä¸¦ä¸”è®“æ‰€æœ‰äºº on the same pageï¼Œä¸æœƒå†æœ‰ã€Œé˜¿é é€™æ©Ÿå™¨èª°é–‹çš„ã€æœ‰äººä¸çŸ¥æƒ…çš„äº‹æƒ…ã€‚&lt;/li&gt;
&lt;li&gt;æ°¸é åªä½¿ç”¨ master ä¾†éƒ¨å±¬é›²ç«¯è³‡æºï¼Œä¹Ÿæ˜¯ç¢ºå®šæ‰€æœ‰æ¶æ§‹éƒ½ç¶“éå¤šäºº reviewã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;introduction-pipeline-automation&#34;&gt;Introduction: Pipeline Automation&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;æœ€å¾Œï¼Œæ•´åˆ CICDï¼Œè®“æ¶æ§‹çš„éƒ¨å±¬å®Œå…¨è‡ªå‹•åŒ–ã€‚æŠŠäººå·¥é™åˆ°æœ€ä½ï¼ŒåŒæ™‚ä¹ŸæŠŠäººå·¥éŒ¯èª¤çš„æ©Ÿç‡é™åˆ°æœ€ä½ï¼Œç•¶ç„¶é€™å€‹ä¹Ÿæ˜¯æ²’éŒ¯éƒ½æ²’éŒ¯ï¼Œè¦éŒ¯ä¸€èµ·éŒ¯çš„ç‹€æ…‹(XDï¼Œä½¿ç”¨æ™‚é‚„æ˜¯è¦æ³¨æ„ã€‚ä½†å¦‚æœåŸ·è¡Œçš„å¾ˆç©©å®šçš„è©±ï¼Œè‡ªå‹•åŒ–çµ•å°æ˜¯å€¼å¾—æŠ•è³‡çš„ã€‚å› ç‚ºç¾åœ¨æŠŠæ¶æ§‹ç•¶ä½œç”¢å“åšï¼Œéƒ¨å±¬å®Œè¦æ¸¬è©¦åŠŸèƒ½ï¼Œç¶²è·¯è¨­å®šæ˜¯å¦æ­£ç¢ºï¼Œç›£æ§æ˜¯å¦å®Œæ•´ï¼Œproxy æ˜¯ä¸æ˜¯è¦æ‰“çœ‹çœ‹ã€‚é€™äº›éƒ½æ•´åˆé€² infra è‡ªå‹• pipelineã€‚éƒ¨å±¬å®Œå°±æ˜¯æ¸¬è©¦ï¼Œç„¶å¾Œäº¤ä»˜çµ¦å…¶ä»–åœ˜éšŠã€‚&lt;/li&gt;
&lt;li&gt;ä¹‹å¾Œå°±æ˜¯ä¸æ–·èª¿æ•´ SOPï¼Œè·Ÿ CI/CD pipelineã€‚æŠŠç¶­é‹æ­¥é©Ÿè½‰æˆç¨‹å¼ç¶­è­·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çŠ¯éŒ¯éä¸€æ¬¡ï¼Œæ°¸ä¸å†çŠ¯ã€‚é€™å€‹å°æ–¼é•·æœŸåœ˜éšŠç¶“ç‡Ÿéå¸¸é‡è¦ï¼Œè®“ç¶“é©—è·ŸçŸ¥è­˜ç´¯ç©ï¼Œåœ˜éšŠè³ªé‡æ‰æœƒæˆé•·ã€‚IaC åœ¨é€™é»å¹«åŠ©å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;demo-2&#34;&gt;Demo 2&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;NAME=terraform-devops make gke redis sql&lt;/li&gt;
&lt;li&gt;module&lt;/li&gt;
&lt;li&gt;git commit&lt;/li&gt;
&lt;li&gt;Review on github&lt;/li&gt;
&lt;li&gt;Merge request&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;repo&#34;&gt;Repo&lt;/h1&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨çš„åŸç¢¼éƒ½é–‹æºåœ¨ github ä¸Šï¼Œå› ç‚ºæ˜¯çœŸçš„æ‹¿ä¾†å°å…¥æˆ‘å€‘å…¬å¸çš„æ¶æ§‹ï¼Œä¿è­‰å¯ä»¥ç”¨ã€‚é˜¿ä¸èƒ½ç”¨çš„è©±ï¼Œå¹«æˆ‘ç™¼ issue çµ¦æˆ‘ï¼Œæˆ–æ˜¯ä½ äººæ›´å¥½ç™¼å€‹ PR çµ¦æˆ‘éƒ½å¯ä»¥(XDã€‚æŠŠ repo æ‹‰ä¸‹ä¾†ï¼Œé€™é‚Šæœ‰ gcp / azure / awsï¼Œé›–ç„¶æœ‰ä¸‰å€‹ä½†æˆ‘å€‘å…¬å¸ä¸»è¦æ˜¯ç”¨ gcpï¼Œå‰©ä¸‹å…©å€‹æˆ‘è‡ªå·±åšèˆˆè¶£çš„ã€‚è£¡é¢ templates è·Ÿ modules ï¼Œä½†ä½ ä¸ç”¨ç®¡ï¼Œæˆ‘ makefile éƒ½å¯«å¥½äº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘é€™é‚Šè¦æ–°å¢ä¸€å€‹ kubernetes é›†ç¾¤&lt;/li&gt;
&lt;li&gt;æˆ‘ç›´æ¥é€²ä¾†æˆ‘çš„å°ˆæ¡ˆï¼Œ NAME=my-new-k8s make gkeï¼Œæ±è¥¿å°±ç”Ÿå‡ºä¾†ï¼Œå…·é«”åšçš„äº‹æƒ…å°±æ˜¯æ–°å¢å…©å€‹ç¨‹å¼å€å¡Šï¼Œæ¯å€‹å€å¡Šæè¿°ä¸€å€‹æ©Ÿå™¨&lt;/li&gt;
&lt;li&gt;git diff çœ‹å¤šäº†ä»€éº¼ï¼Œé€™é‚Šå¤šä¸€å€‹ k8s è·Ÿå¤šä¸€å€‹ node-pool&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œæˆ‘ planï¼Œè®“ terraform é æ¸¬ä¸€ä¸‹è©¦è·‘çµæœï¼Œæˆ‘å€‘ä¾æ“šçµæœå¥½å¥½ reviewï¼Œä¾‹å¦‚é€™é‚Š 2 to add 0 to destroy æˆ‘çš„æƒ³åƒæ˜¯ä¸æ˜¯çœŸçš„è·Ÿ terraform è¨ˆç•«ä¸€æ¨£ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œ terraform applyï¼Œé€™é‚Šè¦çœ‹æ¸…æ¥šï¼Œæˆ‘å€‘æ˜¯ 2 to add 0 to destroyï¼Œå¦‚æœçœ‹åˆ°æœ‰ destroy å°±è¦é›™æ‰‹é›¢é–‹éµç›¤ï¼Œå¤§å®¶ä¸è¦è¡å‹•ï¼Œçœ‹æ¸…æ¥šï¼Œå› ç‚ºå¥¹çœŸçš„æœƒä¸Šå»æŠŠæ±è¥¿ç æ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;P.S. å°ˆæ¡ˆå¯ä»¥æŒ‰ç…§å…¬å¸éœ€æ±‚åˆ†ï¼Œè³‡æºå¤ªå¤šå¤ªæ“ å°±æ‹†åˆ†æˆå¹¾å€‹è³‡æ–™å¤¾å¥½ç®¡ç†ï¼Œç„¶å¾Œåˆ†æ¬Šè²¬ç®¡ç†ï¼Œä¾‹å¦‚é¤¨ iam çš„ã€ç®¡ç¶²è·¯ã€ç®¡æ‡‰ç”¨æ©Ÿå™¨çš„å¯ä»¥åˆ†é–‹ä¾†&lt;/p&gt;
&lt;h1 id=&#34;git-flow&#34;&gt;Git-flow&lt;/h1&gt;
&lt;p&gt;ç„¶å¾Œå› ç‚ºæˆ‘å¾Œé¢æœƒè¬› git-flow å·¥ä½œæµç¨‹æ•´åˆï¼Œæ‰€ä»¥æˆ‘é †ä¾¿åšå®Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°çš„è®Šæ›´ commit ï¼Œplan ä½†æ˜¯é‚„æ²’ applyã€‚æˆ‘è¦æ±‚æ‰€æœ‰æ–°çš„ commit æ¨ä¸Šå»&lt;/li&gt;
&lt;li&gt;ç™¼ PRï¼Œå…¶ä»–åœ˜éšŠæˆå“¡ä¾†å¹«æˆ‘ reviewã€‚PR ç”¨çš„ template ï¼Œæè¿°ä¸€ä¸‹æ–°æ¶æ§‹çš„ç›®çš„ï¼Œè®Šæ›´çš„åœ°æ–¹ï¼Œæœ‰æ²’æœ‰é›·ï¼Œç„¶å¾Œå¹¾å€‹ checklist æª¢æŸ¥&lt;/li&gt;
&lt;li&gt;å…¶ä»–éšŠå“¡ review éƒ½ lgtm æ‰ merge å› master&lt;/li&gt;
&lt;li&gt;apply æ°¸é åœ¨æœ€æ–°çš„ master ä¸Š applyï¼Œç¢ºä¿æ‰€æœ‰æ¨åˆ°é›²ç«¯çš„æ¶æ§‹éƒ½æ˜¯å¤šäºº review éçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰ review æ‰æœ‰å“è³ªå¯è¨€ï¼Œcode éƒ½è¦ reviewï¼Œinfra è‡ªç„¶ä¹Ÿéœ€è¦ reviewã€‚IaC + git-flow æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;demo-2-1&#34;&gt;Demo 2&lt;/h1&gt;
&lt;h1 id=&#34;å·¥å…·--æµç¨‹&#34;&gt;å·¥å…· + æµç¨‹&lt;/h1&gt;
&lt;p&gt;å°å…¥çš„æˆåŠŸèˆ‡å¦ï¼Œä¸æ˜¯æœ€ä½³å¯¦è¸ï¼Œè€Œæ˜¯å„å€‹éšæ®µï¼Œéƒ½çµ¦äºˆåœ˜éšŠé©åˆçš„æŒ‘æˆ°èˆ‡å”åŠ©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Git-flow SOP ç¯„ä¾‹
&lt;ul&gt;
&lt;li&gt;ä¸­æ–‡ç‰ˆï¼Œè¶…é•·ï¼Œä¸Šé¢æ“ä½œéäº†ï¼Œé€™é‚Šä¸ç´°è¬›ï¼Œå¤§å®¶è‡ªå·±ä¸Šå»çœ‹&lt;/li&gt;
&lt;li&gt;ä½†å¦‚æœåœ˜éšŠæ˜¯ç¬¬ä¸€æ¬¡å°å…¥ terraformï¼Œæˆ‘å¼·çƒˆå»ºè­°è¦æœ‰é¡ä¼¼çš„æ±è¥¿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Provide template&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;demo æ™‚ä¸æ˜¯æœ‰ makefileï¼Œmakefile è£¡é¢å¯«çš„å°è…³æœ¬è·Ÿæœ¬èº« IaC æ²’æœ‰é—œä¿‚ï¼Œæä¾›ä¸€äº›è€Œå¤–çš„å°è…³æœ¬è¼”åŠ©ï¼Œå¯ä»¥é€²ä¸€æ­¥é™ä½äººå·¥æ“ä½œï¼Œæå‡æ•ˆç‡ï¼Œåˆå¢åŠ å®‰å…¨ã€‚å·¥å…·ä¸ä¸€å®šå®Œå…¨é©åˆåœ˜éšŠå§ï¼Œé€™æ™‚å€™å°±éœ€è¦è£œè¶³åœ˜éšŠæ–‡åŒ–è·Ÿå·¥å…·é–“çš„è½å·®ï¼Œæ½¤æ»‘ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å†èªªä¸€æ¬¡ï¼Œæ–°äººåšéŒ¯ï¼Œä¸æ˜¯ä»–åšéŒ¯ï¼Œè€Œæ˜¯åœ˜éšŠæ²’æœ‰æä¾›ä»–è¶³å¤ çš„å”åŠ©ã€‚å¦‚ä½•è®“æ–°äººä¹Ÿèƒ½æœ‰é«˜ç”¢å‡ºåŒæ™‚åˆé¡§åŠå®‰å…¨ï¼Œè³‡æ·±å·¥ç¨‹å¸«æ˜¯é€™é‚Šåœ¨è³‡æ·±ã€‚æä¾›ä¸€äº›ä¸€ç”¨æ€§å·¥å…·æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Terraform module&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆæ˜¯ä¸€å€‹ terraform çš„åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªï¼ŒGKE ä¹Ÿè¨±å®šç¾©äº† 2 å€‹å­ç‰©ä»¶(ex. Clusterï¼ŒNode-pool)ï¼Œç¸½å…±æœ‰ 30 å€‹åƒæ•¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ å…¶å¯¦ä¸éœ€è¦é‚£éº¼å¤šåƒæ•¸ XD&lt;/li&gt;
&lt;li&gt;å»ºç«‹ä¸€å€‹ my-gke-moduleï¼Œä¸€å€‹ç‰©ä»¶ï¼Œ5 å€‹å¿…å¡«åƒæ•¸ï¼Œ5 å€‹æœ‰é è¨­å€¼çš„é¸å¡«åƒæ•¸&lt;/li&gt;
&lt;li&gt;ä¹Ÿè¨±å¯«éŒ¯çš„æ©Ÿæœƒåªå‰© 5 å€‹ï¼Œä¹Ÿè¨±å·¥æ™‚åªéœ€è¦ 5/30&lt;/li&gt;
&lt;li&gt;éœ€æ±‚è®Šæ›´å°±æ”¹ moduleï¼Œè®“ä½ çš„æ“ä½œç‰©ä»¶æœ¬èº«å°±æ˜¯ç¬¦åˆå¯¦éš›éœ€æ±‚çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;èƒ½æ‰‹å‹•æ”¹çš„åœ°æ–¹å°±æ˜¯èƒ½çŠ¯éŒ¯çš„åœ°æ–¹ï¼Œé»‘ç®±å°è£å¯ä»¥ä¿è­·æ•´é«”æ¶æ§‹ï¼Œä¸¦æé«˜æ˜“ç”¨æ€§&lt;/p&gt;
&lt;h2 id=&#34;é›œé …&#34;&gt;é›œé …&lt;/h2&gt;
&lt;h1 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸Šé¢æ˜¯ IaC åœ¨æˆ‘å€‘å…¬å¸çš„æµç¨‹&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘é¸ terraformã„¨&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ç”¨ terraform ä»¥å¤–çš„å·¥å…·ï¼Œå¯ä»¥åƒè€ƒæµç¨‹ï¼Œä¹Ÿè¨±æ®Šé€”åŒæ­¸&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/intro/vs/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/intro/vs/index.html&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å„ªç¼ºé»&#34;&gt;å„ªç¼ºé»&lt;/h1&gt;
&lt;p&gt;å¥½ï¼Œè·Ÿåœ˜éšŠä¸€æ­¥ä¸€æ­¥æºé€šæ”¹é€²ï¼ŒèŠ±äº†ä¸€å…©å€‹æœˆï¼ŒæˆåŠŸå°å…¥ã€‚æ˜¯å¦æœ‰è§£æ±ºç•¶åˆçš„å•é¡Œï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™ä½äººå·¥æ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…äººå·¥å¤±èª¤&lt;/li&gt;
&lt;li&gt;infra äº¤ä»˜æ¨™æº–åŒ–ï¼Œæ²’æœ‰å¥‡æ€ªçš„è¨­å®šï¼Œå†ä¹Ÿæ²’æœ‰ã€Œå•Šæˆ‘æ©Ÿå™¨é–‹éŒ¯äº†ã€é€™å›äº‹&lt;/li&gt;
&lt;li&gt;å¿«ï¼ŒçœŸä½å¿«ã€‚é–‹ä¸€å€‹æ©Ÿå™¨å°±æ˜¯æˆ‘å‰›å‰› demo é€™æ¨£ï¼Œè€Œä¸”ä¿è­‰æœƒå‹•ã€‚é€™æ¨£é–‹å‡ºä¾†çš„æ©Ÿå™¨ï¼Œå°å¥¹è¶…æœ‰ä¿¡å¿ƒï¼Œè¦è¤‡è£½å®Œå…¨ä¸€æ¨¡ä¸€æ¨£çš„ç’°å¢ƒä¹Ÿè¶…æœ‰ä¿¡å¿ƒã€‚å¦‚æœå†åŠ ä¸Šè‡ªå‹•åŒ–æ¸¬è©¦å°±æ›´æ•¢ä¿è­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æº–ç¢º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§å®¶éƒ½ review éï¼Œæ¯”è¼ƒä¸æœƒæœ‰ã€Œå•Šæˆ‘ç•¶æ™‚æ²’æƒ³åˆ°ã€çš„ç‹€æ³ï¼Œinfra å‡ºé€™ç¨®è¬è¬æ²’æƒ³åˆ°çš„å•é¡Œï¼Œå¾ˆæœ‰æ©Ÿç‡è¦å¹¹æ‰é‡ä¾†ã€‚èœé³¥è·Ÿè‘— review ï¼Œè©¦è‘—ç™¼ PRï¼Œé€™æ¨£æ–°äººè¨“ç·´æ‰æœƒæœ‰æ•ˆç‡ï¼Œä»–ä¹‹å¾Œæ‰èƒ½è‡ªå·±æ“ä½œï¼Œè³‡æ·±å·¥ç¨‹å¸«åªè¦ review å°±å¥½ã€‚è¦çµ¦æ–°äººè¶³å¤ çš„è¨“ç·´ï¼Œåˆè¦é¡§æ…®å®‰å…¨ï¼Œ review èŠ±çš„æ™‚é–“éå¸¸å€¼å¾—ã€‚&lt;/li&gt;
&lt;li&gt;ä¿è­‰é–‹ç™¼ã€æ¸¬è©¦ã€stagingã€production ç’°å¢ƒé•·çš„ä¸€æ¨¡ä¸€æ¨£ã€‚terraform ç¨‹å¼ä¿è­‰çš„ä¸æ˜¯æˆ‘ä¿è­‰çš„(XD)ã€‚ä½†ä»–çš„ä¿è­‰æ˜¯æœ‰æ ¹æ“šçš„ï¼Œè®“åœ˜éšŠå¾é–‹ç™¼åˆ°ä¸Šé™ä¿é‡ç›¸åŒç’°å¢ƒã€‚ã€Œé˜¿åœ¨æˆ‘çš„æ©Ÿå™¨ä¸Šæœƒè·‘æ€éº¼ä¸Š production å°±å£æ‰ã€ä¸å¥½æ„æ€æ²’é€™å›äº‹ï¼Œå£æ‰å°±æ˜¯ä½ æ‰£å¯«éŒ¯(å…‡ã€‚èªçœŸåœ°èªªï¼Œæ’é™¤ä¸€äº› infra çš„å•é¡Œï¼Œå¯ä»¥å¤§å¹…å¢åŠ é™¤éŒ¯çš„æ•ˆç‡ï¼Œåªè¦æª¢æŸ¥é‚„æ²’è‡ªå‹•åŒ–çš„åœ°æ–¹å°±å¥½ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–æ¸¬è©¦ï¼Œæ‰£è¦æ¸¬è©¦ç’°å¢ƒä¹Ÿè¦æ¸¬è©¦ï¼Œé€™é‚Šç›´æ¥æ•´é€²å»ï¼Œç’°å¢ƒäº¤å‡ºå»ä¿è­‰æ˜¯å¥½çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿç”¢ç’°å¢ƒè®Šå‹•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºå·²ç¶“è½‰æˆç¨‹å¼ç¢¼ï¼Œè¦æœ‰ä»€éº¼æ”¹å‹•éƒ½å¾ˆç²¾ç¢ºï¼Œå¤§å®¶ä¹Ÿæ¯”è¼ƒæ•¢å‹•ç’°å¢ƒï¼Œç‰¹åˆ¥æ˜¯ production ç’°å¢ƒã€‚å†ä¾†å› ç‚ºä¿ç•™æ‰€æœ‰ç’°å¢ƒç”¢ç”Ÿçš„ç¨‹å¼ç¢¼ï¼Œè¦è¤‡è£½ç’°å¢ƒä¹Ÿå¾ˆå®¹æ˜“ï¼Œè€Œä¸”æœ‰ä¿¡å¿ƒä¿è­‰ä¸€æ¨£ã€‚æˆ‘å€‘å°±æŠŠå°±æ¶æ§‹çš„ production è¤‡è£½ï¼Œç„¶å¾Œæ¬å®¶ã€‚å®‰å…¨ä¸‹åº„æ²’å‡ºäº‹ã€‚å¾Œé¢å°±æ¬ä¸Šç™®ï¼Œæ•´å€‹å…¬å¸æœå‹™å¤§æ¬å®¶ï¼Œæ¬æˆåœ˜éšŠç†æƒ³çš„æ¶æ§‹ã€‚æ¬å®¶å·²ç¶“ä¸Šç·šçš„æœå‹™ï¼Œé€™å€‹éœ€è¦å¤šå°‘ä¿¡å¿ƒè·Ÿå‹‡æ°£ä½ å€‘çŸ¥é“å—ï¼Œç¶­é‹çœŸçš„æ˜¯æ„›èˆ‡å‹‡æ°£çš„å†’éšªã€‚æ–°æ¶æ§‹æˆ‘å€‘ä¹Ÿå¾ˆæ»¿æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªå‹•åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå‹•åŒ–å°±æ˜¯è®“ä½ ç”¨é›¶å€çš„æ™‚é–“åšåå€çš„äº‹æƒ…å˜›ã€‚è½èµ·ä¾†æ€ªæ€ªçš„è›‹æ˜¯æ˜¯çœŸçš„ã€‚&lt;/li&gt;
&lt;li&gt;å› ç‚ºæˆ‘å€‘ç›®æ¨™æ˜¯ç¶­é‹èººè‘—ä¸Šç­å˜›(XD)ï¼Œæˆ‘å€‘æ‰èƒ½æŠŠæ™‚é–“æ‹¿å»åšæ”¹é€²ï¼Œä¸ç„¶ä»¥å…‰æ˜¯é–‹æ©Ÿå™¨ï¼Œæ¸¬è©¦ç’°å¢ƒå¯ç”¨æ€§ï¼Œç¶­é‹å°±é£½äº†ï¼Œæ ¹æœ¬æ²’æ™‚é–“æ”¹é€²è·Ÿæå‡ã€‚é€™æ¨£å°å…¬å¸é•·æœŸéå¸¸ä¸å¥½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯è®€æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GUI æ²’è¾¦æ³•æ‰“ comment é˜¿ï¼Œèª°çŸ¥é“é€™å€‹æ©Ÿå™¨ç•¶åˆç‚ºä»€æ˜¯é€™å€‹è¨­å®šã€‚IaC å¾Œåˆ°è™•éƒ½å¯ä»¥å¯« commentï¼Œæ€•ä½ ä¸å¯«è€Œå·²ã€‚ç„¶å¾Œ code çš„è¡¨é”æ€§é‚„æ˜¯å¾ˆå¼·å¤§ï¼Œæ¯”èµ· GUIï¼Œè³‡æ·±å·¥ç¨‹å¸«å¯ä»¥æŠŠæ¡æ•´å€‹å…¬å¸çš„æ¶æ§‹ç‹€æ³ï¼Œæ¯”èµ·å»é›²å¹³å°ä¸‹ä¸€å †æœç´¢ï¼Œæ‰‹å‹•æ¯”å°ï¼Œç¨‹å¼ç¢¼çš„å¯ç¶­è­·æ€§çœŸçš„è¶…é«˜ã€‚è€Œ GCP å·²ç¶“æ˜¯ GUI åšå¾—å¾ˆå¥½çš„å…¬æœ‰é›²äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™ä½äººå·¥ï¼Œå¿«é€Ÿï¼Œæº–ç¢ºï¼Œè‡ªå‹•åŒ–ï¼Œæœ‰ä¿¡å¿ƒ&lt;/p&gt;
&lt;h2 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h2&gt;
&lt;p&gt;é‚„æœ‰ç©ºæˆ‘å€‘å†ä¾†è¬› terraform çš„ç´°ç¯€&lt;/p&gt;
&lt;p&gt;æœ‰äº‹æ­¡è¿é€éç²‰å°ˆç§æ•²ï¼Œå› ç‚ºæˆ‘ä¹Ÿéœ€è¦äººè¨è«–&lt;/p&gt;
&lt;h2 id=&#34;é‚„æœ‰æ™‚é–“å†èŠ&#34;&gt;é‚„æœ‰æ™‚é–“å†èŠ&lt;/h2&gt;
&lt;h1 id=&#34;terraform-1&#34;&gt;terraform&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;validate æ—¢ç„¶æ˜¯ codeï¼Œé€™é‚Šå¹«ä½ åš lintã€èªæ³•æª¢æ¸¬ã€type checkï¼Œéæ¿¾ç¬¬ä¸€å±¤éŒ¯èª¤&lt;/li&gt;
&lt;li&gt;import å¯ä»¥æŠŠé ç«¯çš„è³‡æºåŒ¯å…¥æˆ stateï¼Œä¸€å€‹é»è®š follow è¿½è¹¤çš„æ¦‚å¿µ(XD)ï¼Œä¸æ˜¯æ‰€æœ‰çš„é ç«¯è³‡æºéƒ½éœ€è¦è¿½è¹¤åˆ° stateï¼Œæˆ‘å€‘åªéœ€è¦åœ¨å°çš„ scope è£¡é¢é—œæ³¨éœ€è¦çš„æ©Ÿå™¨&lt;/li&gt;
&lt;li&gt;module å¯ä»¥è‡ªç”±æ’°å¯«ï¼ŒæŠŠæœ‰ç›¸ä¾æ€§çš„è³‡æºæ‰“åŒ…ï¼Œä¾ç…§åœ˜éšŠä½¿ç”¨ç¿’æ…£èª¿æ•´ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;cloud å¯ä»¥ç®¡ç† stateï¼Œterraform cloud å¹«ä½ ç¶­è­·å…¨åŸŸåŒä¸€ä»½ stateï¼Œæœ‰äººåœ¨ä½¿ç”¨æ™‚æœƒ lock stateï¼Œé¿å…å¤šäººåŒæ™‚ä¿®æ”¹ï¼Œæ‰“äº‚ API é€ æˆè³‡æºéŒ¯èª¤&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;state-conflicts&#34;&gt;state conflicts&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰å¤šä»½ stateï¼Œä½ é›»è…¦ä¸Šä¸€ä»½ local stateï¼Œæˆ‘é›»è…¦ä¸Šä¸€ä»½ local stateï¼Œå…¶å¯¦æœƒé€ æˆè¡çª&lt;/li&gt;
&lt;li&gt;æ›´æ€•åŒæ™‚å¤šäººæ†¶èµ· applyï¼ŒGCP API ç›´æ¥è¢«æ‰“äº‚ï¼Œæœƒæœ‰ä¸å¯é æœŸçš„éŒ¯èª¤&lt;/li&gt;
&lt;li&gt;è§£æ³•æ˜¯ä½¿ç”¨ terraform remote backendï¼Œä¸è¦ç”¨ local stateï¼Œä½¿ç”¨ DB ã€storage æˆ–æ˜¯ terraform cloudï¼Œé€éä¸€éš» lock ä¾†ä¿è­‰ synchronized state&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é–“æ¥ç†è§£-api&#34;&gt;é–“æ¥ç†è§£ API&lt;/h1&gt;
&lt;p&gt;ex.  GCP Load Balancer&lt;/p&gt;
&lt;p&gt;é€™å€‹è¬›ä¸‹å»å°±å¤ªå¤šäº†ï¼ŒåŸºæœ¬ä¸Šé€éçˆ¬ terraform google provider çš„æ–‡ä»¶ï¼Œç„¶å¾Œå»æ¯”å°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºå»é» GUI å…¶å¯¦æ„Ÿå—ä¸åˆ° GCP API çš„èª¿ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ terraform è½‰å¯«è³‡æºæ™‚å€™å°±å¾ˆæœ‰æ„Ÿï¼Œæ‰“é€™å€‹ API è·Ÿæ‰“é€™å€‹ APIï¼Œtf æª”æ¡ˆä¸Šå…¶å¯¦çœ‹å¾—å‡ºä¾†ã€‚&lt;/li&gt;
&lt;li&gt;é€²ä¸€æ­¥å»æŸ¥ï¼Œæ‰ç™¼ç¾ GCP Load Balancer å…§ç¶²æˆ–å¤–ç¶²ã€http æˆ– tcpã€å…¨çƒæˆ–å€åŸŸï¼Œä½¿ç”¨çš„ Load Balancer è¡Œç‚ºä¸ä¸€æ¨£ï¼Œå› ç‚ºåº•ä¸‹çš„å¯¦ä½œä¸ä¸€æ¨£ã€‚ä½†ä¹‹å‰ä½¿ç”¨ GUI æ™‚å…¶å¯¦ä¸æœƒå»æƒ³ç‚ºå•¥è¨­å®šä¸ä¸€æ¨£ï¼Œä½¿ç”¨ terraform å°±æœƒè¢«è¿«å»äº†è§£ï¼Œå¼·è¿«å­¸ç¿’XDã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åƒåœ¾è©±&#34;&gt;åƒåœ¾è©±&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æœ€ä½³å¯¦è¸ä¸æ˜¯å•é¡Œ ï¼Œå¦‚ä½•å°å…¥æ‰æ˜¯å•é¡Œ&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä¸ç”¨èººè‘—ä¸Šç­ï¼Œä½†æ˜¯ä¸èƒ½è·ªè‘—ä¸Šç­&lt;/li&gt;
&lt;li&gt;é¡˜æ„å¤šå¹¾å€‹äººä¾†çœ‹æˆ‘ç²‰å°ˆæ¯”è¼ƒå¯¦åœ¨&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¾é›¶é–‹å§‹çš„ Infrastructure as Code: Terraform - 01</title>
      <link>https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/</link>
      <pubDate>Sun, 14 Jun 2020 16:46:09 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;outlline&#34;&gt;Outlline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;our story: issues, steps, &amp;amp; results&lt;/li&gt;
&lt;li&gt;basics IaC, terraform&lt;/li&gt;
&lt;li&gt;benefits&lt;/li&gt;
&lt;li&gt;risks and å‘&lt;/li&gt;
&lt;li&gt;to be or not to be&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;experience oriented&lt;/p&gt;
&lt;h1 id=&#34;our-stories&#34;&gt;Our stories&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;100+ devs, many teams&lt;/li&gt;
&lt;li&gt;25+ projects&lt;/li&gt;
&lt;li&gt;50+ GKEs&lt;/li&gt;
&lt;li&gt;80+ SQLs&lt;/li&gt;
&lt;li&gt;IAMs, redis, VPCs, load-balancers, &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;issues&#34;&gt;Issues&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Ops manually create resources through GUI by SOP.&lt;/li&gt;
&lt;li&gt;We have many isolated, separeated resources, VPCs. It&amp;rsquo;s our culture, and we (devops) want to change.&lt;/li&gt;
&lt;li&gt;Some projects have short life-cycle. Rapid resources created &amp;amp; destroy.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;our-user-story&#34;&gt;Our user story&lt;/h1&gt;
&lt;p&gt;As a devops,
I would like to introduce terraform (IaC)
so that I can&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;review all existing resources&lt;/li&gt;
&lt;li&gt;minimize error from manual operation&lt;/li&gt;
&lt;li&gt;ASAP!!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As a devops,
I would like to fully enforce terraform (IaC)
so that I can&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;minimize efforts to operate infra&lt;/li&gt;
&lt;li&gt;delegate infra operations to junior team members&lt;/li&gt;
&lt;li&gt;minimize IAM privilges&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;import existing resources&lt;/li&gt;
&lt;li&gt;review existing resources code&lt;/li&gt;
&lt;li&gt;plan best practice resource templates&lt;/li&gt;
&lt;li&gt;create new resources with templates&lt;/li&gt;
&lt;li&gt;introduce git workflow, plan, commit, PR, and review&lt;/li&gt;
&lt;li&gt;add wrapper handler&lt;/li&gt;
&lt;li&gt;automation pipeline&lt;/li&gt;
&lt;li&gt;repeat 2-4&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;iac&#34;&gt;IaC&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Programatic way to operate infra&lt;/li&gt;
&lt;li&gt;declarative (functional) vs. imperative (procedural)&lt;/li&gt;
&lt;li&gt;Perfect for public cloud, cloud native, virtualized resources&lt;/li&gt;
&lt;li&gt;Benefits: cost (reduction), speed (faster execution) and risk (remove errors and security violations)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;terraform&#34;&gt;Terraform&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Declarative (functional) IaC&lt;/li&gt;
&lt;li&gt;Invoke API delegation&lt;/li&gt;
&lt;li&gt;State management&lt;/li&gt;
&lt;li&gt;providers: azure / aws / gcp /alicloud / &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;demo&#34;&gt;Demo&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terraform-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;scope&#34;&gt;Scope&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Compute Instances&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Databases&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IAM&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Networking&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Load Balancer&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;expected-benefits&#34;&gt;Expected benefits&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Minimize manual operation.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zero manual operation error&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Standarized infra. Infra as a (stable) product.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;fast, really fast to duplicate envs&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Infra workflow with infra review&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Easy to create identical dev, staging, prod envs&lt;/li&gt;
&lt;li&gt;Reviewed infra. Better workflow. Code needs reviews, so do infra.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fully automized infra pipeline.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;other-benefits&#34;&gt;Other Benefits&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Don&amp;rsquo;t afraid to change prod sites anymore
&lt;ul&gt;
&lt;li&gt;We made a massive infra migration in this quater!!&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Better readability to GUI. Allow comment everywhere.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;risks&#34;&gt;Risks&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Incorrect usage could cause massive destruction.
&lt;ul&gt;
&lt;li&gt;å¦‚æœçœ‹è¦‹ destroy çš„æç¤ºï¼Œè«‹é›™æ‰‹é›¢é–‹éµç›¤ã€‚ ~ first line in our SOP&lt;/li&gt;
&lt;li&gt;If see &amp;ldquo;destroy&amp;rdquo;, cancel operation &amp;amp; call for help.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;State management&lt;/li&gt;
&lt;li&gt;A little latency between infra version and terraform provider version&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;reduce-risks&#34;&gt;Reduce Risks&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Sufficient understanding to infra &amp;amp; terraform&lt;/li&gt;
&lt;li&gt;Sufficient training to juniors&lt;/li&gt;
&lt;li&gt;Minimize IAM privilege: remove update / delete permissions&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;git-flow&#34;&gt;Git-flow&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground/blob/master/SOP.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Our SOP&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;edit tf&lt;/li&gt;
&lt;li&gt;push new branch commit&lt;/li&gt;
&lt;li&gt;PR, review &amp;amp; discussion&lt;/li&gt;
&lt;li&gt;merge &amp;amp; apply&lt;/li&gt;
&lt;li&gt;revert to previous tag if necessary&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;utility-provide-template&#34;&gt;(Utility) Provide template&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;wrap resources for
&lt;ul&gt;
&lt;li&gt;better accesibility&lt;/li&gt;
&lt;li&gt;lower operation risks&lt;/li&gt;
&lt;li&gt;uniform naming convention&lt;/li&gt;
&lt;li&gt;best practice&lt;/li&gt;
&lt;li&gt;suggested default value&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;about-introducing-new-tool&#34;&gt;About introducing new tool&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;The hardest part is always people
&lt;ul&gt;
&lt;li&gt;Focus on critical issues (ç—›é») instead of tool itself. &amp;ldquo;We introduce tool to solve&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Put result into statistics &amp;ldquo;The outage due to misconfig is reduced by&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;overall-my-iac-experience-is-great&#34;&gt;Overall, my IaC experience is GREAT!&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;IaC to automation.&lt;/li&gt;
&lt;li&gt;Comment (for infra) is important. You have to write doc anyway. Why not put in IaC?&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;Full transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;Presentation file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/post/terraform-infrastructure-as-code/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Source Code on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; &amp;lt;- full contents&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;Like it if you really like it :)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;appendixi-more-about-terraform&#34;&gt;Appendix.I more about terraform&lt;/h1&gt;
&lt;p&gt;terraform validate
terraform import
terraform module
terraform cloud &amp;amp; state management&lt;/p&gt;
&lt;h1 id=&#34;appendixi-understand-state-conflict&#34;&gt;Appendix.I understand State conflict&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Shared but synced&lt;/li&gt;
&lt;li&gt;watch out for state conflicts when colaborating
&lt;ul&gt;
&lt;li&gt;state diff. could cause terraform mis-plan&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Solution: synced state lock
&lt;ul&gt;
&lt;li&gt;Colatorative edit (git branch &amp;amp; PR), synchronized terraform plan &amp;amp; apply&lt;/li&gt;
&lt;li&gt;or better: automation&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;appendixii-understand-resources-from-api-aspect&#34;&gt;Appendix.II understand resources from API aspect&lt;/h1&gt;
&lt;p&gt;GCP Load Balancer&lt;/p&gt;
&lt;h3 id=&#34;gcp-load-balancing&#34;&gt;GCP Load Balancing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;understand resources from API aspect&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;how terraform work with GCP API&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;internal&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;regional
&lt;ul&gt;
&lt;li&gt;pass-through: tcp / udp   -&amp;gt; internal TCP/UDP&lt;/li&gt;
&lt;li&gt;proxy: http / https       -&amp;gt; internal HTTP(S)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;external&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;regional
&lt;ul&gt;
&lt;li&gt;pass-through: tcp / udp   -&amp;gt; tcp/udp network&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;global / effective regional
&lt;ul&gt;
&lt;li&gt;proxy
&lt;ul&gt;
&lt;li&gt;tcp                     -&amp;gt; TCP Proxy&lt;/li&gt;
&lt;li&gt;ssl                     -&amp;gt; SSL Proxy&lt;/li&gt;
&lt;li&gt;http / https            -&amp;gt; External HTTP(S)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;terraform-resource&#34;&gt;Terraform Resource&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;forwarding_rule&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;forwarding_rule: tcp &amp;amp; http&lt;/li&gt;
&lt;li&gt;global_forwarding_rule: only http&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;backend_service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;backend_service
&lt;ul&gt;
&lt;li&gt;health_check&lt;/li&gt;
&lt;li&gt;http_health_check&lt;/li&gt;
&lt;li&gt;https_health_check&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;region_backend_service
&lt;ul&gt;
&lt;li&gt;region_health_check&lt;/li&gt;
&lt;li&gt;region_http_health_check&lt;/li&gt;
&lt;li&gt;region_https_health_check&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;some-ways-to-do-iac&#34;&gt;Some ways to do IaC&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Cloud Formation&lt;/li&gt;
&lt;li&gt;bash script with API / client&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¼•è¨€-infrastructure-as-code&#34;&gt;å¼•è¨€ Infrastructure as Code&lt;/h1&gt;
&lt;p&gt;å¾å­—é¢ä¸Šè§£é‡‹ï¼ŒIaC å°±æ˜¯ç”¨ç¨‹å¼ç¢¼æè¿° infrastructureã€‚é‚£ç‚ºä½•æœƒå‡ºç¾é€™å€‹æ¦‚å¿µï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸ IaC æ˜¯ä»€éº¼ç‹€æ³ï¼Ÿæˆ‘å€‘é‚„æ˜¯å¯ä»¥é€é GUI æˆ–æ˜¯ API æ“ä½œã€‚éš¨å«éš¨ç”¨&lt;/p&gt;
&lt;p&gt;é›²ç«¯é‹ç®—é¢¨è¡Œï¼Œå·¥ç¨‹å¸«å¯ä»¥å¾ˆåœ¨ GUI ä»‹é¢ä¸Šï¼Œå¾ˆè¼•æ˜“çš„éƒ¨ç½²è³‡æ–™ä¸­å¿ƒçš„æ¶æ§‹ã€‚è¼¸å…¥åŸºæœ¬è³‡è¨Šï¼Œæ»‘é¼ é»å€‹ä¸€å…©ä¸‹ï¼Œå°±å¯ä»¥åœ¨é ç«¯å•Ÿç”¨é‹ç®—æ©Ÿå™¨ï¼Œå•Ÿç”¨è³‡æ–™åº«ï¼Œè¨­ç½®è™›æ“¬ç¶²è·¯èˆ‡è·¯ç”±ï¼Œå¹¾åˆ†é˜å°±å¯ä»¥å®Œæˆæ¶è¨­æœå‹™çš„åŸºç¤å»ºè¨­(infrastructure)ï¼Œé–‹å§‹é‹è¡Œæœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œéš¨è‘—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›²å¹³å°æä¾›æ›´å¤šæ–°çš„ï¼ˆè¤‡é›œçš„ï¼‰æœå‹™
&lt;ul&gt;
&lt;li&gt;æœå‹™å½¼æ­¤å¯èƒ½æ˜¯æœ‰ç›¸ä¾æ€§ï¼ˆdependencyï¼‰ï¼Œæœå‹™éœ€è¦ä»°è³´å…¶ä»–æœå‹™&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯å‹•æ…‹è€¦åˆï¼Œæ›´æ”¹æœå‹™æœƒé€£å‹•å…¶ä»–æœå‹™ï¼Œä¸€é«®å‹•å…¨èº«&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éœ€è¦ç¸å¯†çš„å­˜å–æ§ç®¡ï¼ˆaccess controlï¼‰
&lt;ul&gt;
&lt;li&gt;é˜²ç«ç‰†ï¼Œè·¯ç”±è¦å‰‡&lt;/li&gt;
&lt;li&gt;é›²å¹³å°ä¸Šï¼Œåœ˜éšŠæˆå“¡çš„å­˜å–æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°ˆæ¡ˆçš„è¦æ¨¡èˆ‡è¤‡é›œåº¦å¢åŠ 
&lt;ul&gt;
&lt;li&gt;å¤šç’°å¢ƒçš„éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;å¤šå€‹å‚™æ´å‰¯æœ¬è¨­å®š&lt;/li&gt;
&lt;li&gt;å¤§é‡æ©Ÿå™¨å½¢æˆçš„é›†ç¾¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;iac-çš„å¯¦éš›éœ€æ±‚&#34;&gt;IaC çš„å¯¦éš›éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸‹é€™äº›å°è©±æ˜¯ä¸æ˜¯å¾ˆè€³ç†Ÿï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;iac-çš„å¯¦éš›éœ€æ±‚-1&#34;&gt;IaC çš„å¯¦éš›éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;æ²’æœ‰éœ€æ±‚ï¼Œå°±ä¸éœ€è¦æ‰¾å°‹æ–°çš„è§£æ±ºæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æœ‰çœ‹ä¸Šé¢ç›®éŒ„çš„æœ‹å‹ï¼Œæ‡‰è©²çŸ¥é“é€™ç³»åˆ—æ–‡ç« çš„å¾Œé¢ï¼Œæˆ‘æœƒå¯¦éš›åˆ†äº«æ–¼å…¬å¸å…§éƒ¨å°å…¥ Terraform èˆ‡ IaC æ–¹æ³•çš„éç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å„ä½è®€è€…æœƒæ‰¾åˆ°é€™ç¯‡æ–‡ï¼Œå¤§æ¦‚éƒ½æ˜¯å› ç‚ºå¯¦éš›æœå°‹äº† Terraform æˆ–æ˜¯ IaC çš„é—œéµå­—æ‰æ‰¾åˆ°é€™ç¯‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰éœ€æ±‚ï¼Œè‡ªå·±å› ç‚ºè¦ºå¾—æœ‰è¶£è€Œæ‹‰ä¸‹ä¾†ç ”ç©¶ï¼Œ&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰æ˜ç¢ºéœ€æ±‚ï¼Œå°±è²¿ç„¶å°å…¥
ç„¡è¬‚å¢åŠ äº‚åº¦&lt;/p&gt;
&lt;h1 id=&#34;iac-çš„å¯¦ç¾å·¥å…·&#34;&gt;IaC çš„å¯¦ç¾å·¥å…·&lt;/h1&gt;
&lt;h1 id=&#34;ç‚ºä½•é¸æ“‡-terraform&#34;&gt;ç‚ºä½•é¸æ“‡ Terraform&lt;/h1&gt;
&lt;h1 id=&#34;å»ºè­°&#34;&gt;å»ºè­°&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœä¸ç†Ÿï¼Œå¾ import ç¾æœ‰æœ€å¥½çš„è³‡æºé–‹å§‹ã€‚æŠŠ 70 åˆ†ä¿ä½ï¼Œå†å‘ 80 90 é‚é€²ã€‚&lt;/li&gt;
&lt;li&gt;å–„ç”¨ module å°è£ï¼Œåªéœ²å‡ºæœƒç”¨åˆ°çš„åƒæ•¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Cert Manager Complete Workflow</title>
      <link>https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/</link>
      <pubDate>Sat, 12 Oct 2019 17:41:25 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;recap&#34;&gt;Recap&lt;/h1&gt;
&lt;p&gt;æ˜¨å¤©æˆ‘å€‘å¯¦éš›ä½¿ç”¨ cert-managerï¼Œç‚º nginx ingress controller ç”¢ç”Ÿ certificatesï¼Œéç¨‹ä¸­æˆ‘å€‘åšäº†å¹¾ä»¶äº‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­ç½® Let&amp;rsquo;s Encript prod site çš„ Issuer&lt;/li&gt;
&lt;li&gt;è¨­ç½® certificates.certmanager.k8s.io è³‡æºä¾†å®šç¾© certificate çš„å–å¾—æ–¹å¼&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯åœ¨ ingress ä¸­é…ç½® tlsï¼Œè®“ cert-manager è‡ªå‹•é€é ingress-shim ç”¢ç”Ÿ certifcates.cert-managerï¼Œä¸¦ä¸”ç”¢ç”Ÿ certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯ä½¿ç”¨ cert-manager ç”¢ç”Ÿ certificate çš„åŸºæœ¬æ“ä½œï¼Œå‰©ä¸‹çš„æ˜¯ç”± cert-manager å®Œæˆã€‚å¯¦éš›ä¸Š cert-manager åœ¨ç”¢ç”Ÿå‡º certificate ä¹‹å‰é‚„åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œæˆ‘å€‘ä»Šå¤©å°±è©³ç´°èµ°éå®Œæ•´æµç¨‹ï¼Œè—‰æ­¤äº†è§£ cert-manager é…åˆ issuing certificate çš„æµç¨‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è€…è¨­ç½® Issuer&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è€…è¨­å®š certificate -&amp;gt; cert-manager æ ¹æ“š certificate -&amp;gt; ç”¢ç”Ÿ certificate&lt;/p&gt;
&lt;h1 id=&#34;certificaterequests&#34;&gt;CertificateRequests&lt;/h1&gt;
&lt;p&gt;certificaterequests.certmanager æ˜¯ cert-manager ç”¢ç”Ÿ certificate éç¨‹ä¸­æœƒä½¿ç”¨çš„è³‡æºï¼Œä¸æ˜¯è¨­è¨ˆä¾†è®“äººé¡æ“ä½œçš„è³‡æºã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ cert-manager ç›£æ¸¬åˆ° certificate ç”¢ç”Ÿå¾Œï¼Œæœƒç”¢ç”Ÿ certificaterequests.certmanager.k8s.io è³‡æºï¼Œä¾†å‘ issuer request certificateï¼Œé€™å€‹éç¨‹èˆ‡ä½¿ç”¨å…¶ä»–å®¢æˆ¶ç«¯ (ex. certbot) ä¾†å‘ 3rd party CA server request certificate æ™‚çš„å…§å®¹ç›¸åŒï¼Œåªæ˜¯é€™é‚Šæˆ‘å€‘ä½¿ç”¨ kubernetes resource ä¾†å®šç¾©ã€‚&lt;/p&gt;
&lt;p&gt;åŒ…å«çš„ certificate requestï¼Œæœƒä»¥ pem encoded çš„å½¢å¼ï¼Œå†è®Šæˆ base64 encoded å­˜æ”¾åœ¨ resource ä¸­ã€‚é€™å€‹ pem key ä¹Ÿæœƒå¾åˆ°é æ–¹çš„ CA sercer (Let&amp;rsquo;s Encrypt prod) ä¾† request certificate&lt;/p&gt;
&lt;p&gt;å¦‚æœ issuance æˆåŠŸï¼Œcertificaterequest è³‡æºæ‡‰è©²æœƒè¢« cert-manager åƒæ‰ï¼Œä¸æœƒè¢«äººé¡çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å€‹ certificaterequests.certmanager å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: cert-manager.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: CertificateRequest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: my-ca-cr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  csr: LS0tLS1CRUdJTiBDRVJUSUZJQ0FUR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ..................................
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  LQo=
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  isCA: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  duraton: 90d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: ca-issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # We can reference ClusterIssuers by changing the kind here.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # The default value is Issuer (i.e. a locally namespaced Issuer)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    group: cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ certificaterequests.certmanager æœƒè®“ cert-manager å˜—è©¦å‘ Issuer (lets-encrypt-prod) request certificateã€‚&lt;/p&gt;
&lt;h1 id=&#34;order&#34;&gt;Order&lt;/h1&gt;
&lt;p&gt;orders.certmanager.k8s.io è¢« ACME çš„ Issuer ä½¿ç”¨ï¼Œç”¨ä¾†ç®¡ç† signed TLD certificate çš„ ACME orderï¼Œé€™å€‹ resource ä¹Ÿæ˜¯ cert-manager è‡ªè¡Œç”¢ç”Ÿç®¡ç†çš„ resourceï¼Œä¸éœ€è¦äººé¡ä¾†æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ä¸€å€‹ certificates.certmanager ç”¢ç”Ÿï¼Œä¸”éœ€è¦ä½¿å‹‡ ACME isser æ™‚ï¼Œcertmanager æœƒç”¢ç”Ÿ orders.certmanager ï¼Œä¾†å–å¾— certificateã€‚&lt;/p&gt;
&lt;h1 id=&#34;challenges&#34;&gt;Challenges&lt;/h1&gt;
&lt;p&gt;challenges.certmanager è³‡æºæ˜¯ ACME Issuer ç®¡ç† issuing lifecycle æ™‚ï¼Œç”¨ä¾†å®Œæˆå–®ä¸€å€‹ DNS name/identifier authorization æ™‚æ‰€ä½¿ç”¨çš„ã€‚ç”¨ä¾†ç¢ºå®š issue certiticate çš„å®¢æˆ¶ç«¯çœŸçš„æ˜¯ DNS name çš„æ“æœ‰è€…ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ cert-manager ç”¢ç”Ÿ order æ™‚ï¼Œorder controller æ¥åˆ° order ï¼Œå°±æœƒç‚ºæ¯ä¸€å€‹éœ€è¦ DNS certificate çš„ DNSname ï¼Œç”¢ç”Ÿ challenges.certmanagerã€‚&lt;/p&gt;
&lt;p&gt;é€™æ®µä¹Ÿæ˜¯ order controller è‡ªå‹•ç”¢ç”Ÿï¼Œä¸¦ä¸éœ€è¦ä½¿ç”¨è€…åƒèˆ‡ã€‚&lt;/p&gt;
&lt;h1 id=&#34;acme-certificate-issuing&#34;&gt;ACME certificate issuing&lt;/h1&gt;
&lt;p&gt;user -&amp;gt; è¨­å®šå¥½ issuers.certmanager&lt;/p&gt;
&lt;p&gt;user -&amp;gt; ç”¢ç”Ÿ certificates.certmanager -&amp;gt; é¸æ“‡ Issuer -&amp;gt;&lt;/p&gt;
&lt;p&gt;cert-manager -&amp;gt; ç”¢ç”Ÿ certificaterequest -&amp;gt;&lt;/p&gt;
&lt;p&gt;cert-manager æ ¹æ“š certiticfates.certmanager ç”¢ç”Ÿ orders.certmanager -&amp;gt;&lt;/p&gt;
&lt;p&gt;order controller æ ¹æ“š order ï¼Œä¸¦ä¸”è·Ÿæ¯ä¸€å€‹ DNS name targetï¼Œç”¢ç”Ÿä¸€å€‹ challenges.certmanager&lt;/p&gt;
&lt;p&gt;challenges.certmanager ç”¢ç”Ÿå¾Œï¼Œæœƒé–‹å•Ÿé€™å€‹ DNS name challenge çš„ lifecycle&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;challenges ç‹€æ…‹ç‚º queued for processingï¼Œåœ¨ä½‡åˆ—ä¸­ç­‰å¾…ï¼Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²’æœ‰åˆ¥çš„ chellenges åœ¨é€²è¡Œï¼Œchallenges ç‹€æ…‹è®Šæˆ scheduledï¼Œé€™æ¨£å¯ä»¥é¿å…å¤šå€‹ DNS challenge åŒæ™‚ç™¼ç”Ÿï¼Œæˆ–æ˜¯ç›¸åŒåç¨±çš„ DNS challenge é‡è¤‡&lt;/li&gt;
&lt;li&gt;challenges èˆ‡é ç«¯çš„ ACME server &amp;lsquo;synced&amp;rsquo; ç•¶å‰çš„ç‹€æ…‹ï¼Œæ˜¯å¦ valid
&lt;ul&gt;
&lt;li&gt;å¦‚æœ ACME å›æ‡‰é€™å€‹ DNS name çš„ challenge é‚„æ˜¯æœ‰æ•ˆçš„ï¼Œå‰‡ç›´æ¥æŠŠ challenges çš„ç‹€æ…‹æ”¹æˆ validï¼Œç„¶å¾Œç§»å‡ºæ’ç¨‹ä½‡åˆ—ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ challenges ç‹€æ…‹ä»ç„¶ç‚º pendingï¼Œchallenge controller æœƒä¾ç…§è¨­å®š present é€™å€‹ challengeï¼Œä½¿ç”¨ HTTP01 æˆ–æ˜¯ DNS01ï¼Œchallenges è¢«æ¨™è¨˜ç‚º presented&lt;/li&gt;
&lt;li&gt;challenges å…ˆåŸ·è¡Œ self checkï¼Œç¢ºå®š challenge ç‹€æ…‹å·²ç¶“å‚³æ’­çµ¦ dns serversï¼Œå¦‚æœ self check å¤±æ•—ï¼Œå‰‡æœƒä¾ç…§ interval retry&lt;/li&gt;
&lt;li&gt;ACME authorization é—œè¯åˆ° challenge&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;cert-manager è™•ç† &amp;lsquo;scheduled&amp;rsquo; challenges.certmanager -&amp;gt; ACME challenge&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cert Manager How It Work</title>
      <link>https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/</link>
      <pubDate>Fri, 11 Oct 2019 11:24:34 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»Šå¤©æˆ‘å€‘ä¾†å¯¦éš›ä½¿ç”¨ cert-managerï¼Œç‚º nginx ingress controller ç”¢ç”Ÿ certificates with ACME Issuer&lt;/p&gt;
&lt;h1 id=&#34;ca-terminology&#34;&gt;CA Terminology&lt;/h1&gt;
&lt;p&gt;å…ˆæŠŠå¯¦éš›åŸ·è¡Œ CA ç°½ç™¼çš„åè©å®šç¾©ä¸€ä¸‹ï¼Œä»¥å…è·Ÿ cert-manager çš„è³‡æºææ··&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Certificate: æ†‘è­‰ï¼Œx509 certificateï¼Œcert-manager è‡ªå‹•ç®¡ç†çš„ç›®æ¨™ï¼Œé€é let&amp;rsquo;s encript å–å¾—çš„ x509 certificates&lt;/li&gt;
&lt;li&gt;CA (Certificate Authority): issue signed certificate çš„æ©Ÿæ§‹&lt;/li&gt;
&lt;li&gt;issue: é ’ç™¼ï¼ŒæŒ‡ CA ç”¢ç”Ÿ certificate èˆ‡ key (ä»Šå¤©çš„ç¯„ä¾‹æ ¼å¼æ˜¯ .crt èˆ‡ .key)&lt;/li&gt;
&lt;li&gt;Sign vs self-signed: ç°½æ ¸ï¼Œè‡ªå·±ç°½æ ¸ï¼Œä½¿ç”¨ä¿¡ä»»çš„ CA issue certificateï¼Œæˆ–æ˜¯ä½¿ç”¨è‡ªå·±ç”¢ç”Ÿçš„ CA self-signï¼Œç„¶å¾ŒæŠŠ CA åŠ åˆ°å¯ä»¥è¢«ä¿¡ä»»çš„ CA æ¸…å–®ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let&amp;rsquo;s Encript CA issues signed certificates&lt;/p&gt;
&lt;p&gt;Kubernetes in-cluster CA issues self-signed certificates&lt;/p&gt;
&lt;p&gt;cert-manager çš„ CRD è³‡æºï¼Œä½¿ç”¨ä¾†æè¿° cert-manager å¦‚ä½•åŸ·è¡Œä¸Šè¿°æ“ä½œï¼ŒCRD åº•ä¸‹éƒ½æœƒåŠ ä¸Š ``*.certmanager.k8s.io` æ–¹ä¾¿è¾¨è­˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;è¨­å®š-issuer&#34;&gt;è¨­å®š Issuer&lt;/h1&gt;
&lt;p&gt;Issuer è¦æ€éº¼ç¿»æˆä¸­æ–‡XDï¼Œæ†‘è­‰é ’ç™¼æ©Ÿæ§‹ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹åœ¨é–‹å§‹ç°½ç™¼ certificates å‰ï¼Œè¦å…ˆå®šç¾© issuers.certmanager.k8s.io ï¼Œä»£è¡¨ä¸€å€‹èƒ½ç°½ç™¼ certificate CAï¼Œä¾‹å¦‚ Let&amp;rsquo;s Encriptï¼Œæˆ–æ˜¯ kubernetes å…§éƒ¨ä¹Ÿæœ‰å…§éƒ¨ä½¿ç”¨çš„æ†‘è­‰ç°½ç™¼ï¼Œæ”¾åœ¨ secrets ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é€™äº› Issuer æœƒè®“ certificates.certmanager.k8s.i8o ä½¿ç”¨ï¼Œå®šç¾©å¦‚ä½•å–å¾— certificate æ™‚ï¼Œé¸æ“‡ Issuerã€‚&lt;/p&gt;
&lt;p&gt;cert-manager ä¸Šå¯ä»¥å®šç¾©å–®ä¸€ namespace çš„ issuers.certmanager èˆ‡é›†ç¾¤éƒ½å¯ä½¿ç”¨çš„ clusterissuers.certmanager&lt;/p&gt;
&lt;p&gt;cert-manager æœ‰æ”¯æ´å¹¾ç¨®çš„ issuer type&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CA: ä½¿ç”¨ x509 keypair ç”¢ç”Ÿcertificateï¼Œå­˜åœ¨ kubernetes secret&lt;/li&gt;
&lt;li&gt;Self signed: è‡ªç°½ certificate&lt;/li&gt;
&lt;li&gt;ACME: å¾ ACME (ex. Let&amp;rsquo;s Encrypt) server å–å¾— ceritificate&lt;/li&gt;
&lt;li&gt;Vault: å¾ Vault PKI backend é ’ç™¼ certificate&lt;/li&gt;
&lt;li&gt;Venafi: Venafi Cloud&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;certificate&#34;&gt;Certificate&lt;/h1&gt;
&lt;p&gt;æœ‰äº†ç°½ç™¼æ†‘è­‰çš„å–®ä½ï¼Œæ¥ä¸‹ä¾†è¦å®šç¾©å¦‚ä½•å–å¾— certificateã€‚certificates.certmanager.k8s.io æ˜¯ CRDï¼Œç”¨ä¾†å‘Šè¨´ cert-manager è¦å¦‚ä½•å–å¾— certificate&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.cert-manager.io/en/latest/reference/certificates.html#certificates&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;certifcates.certmanager.k8s.io&lt;/a&gt; æä¾›äº†ç°¡å–®ç¯„ä¾‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: cert-manager.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: acme-crt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  secretName: acme-crt-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  duration: 90d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  renewBefore: 30d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  dnsNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - bar.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  acme:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    config:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - http01:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ingressClass: nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      domains:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - bar.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # We can reference ClusterIssuers by changing the kind here.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # The default value is Issuer (i.e. a locally namespaced Issuer)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢é€™å€‹ certificate.certmanger å‘Šè¨´ cert-manager&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å° foo.example.com èˆ‡ bar.example.com å…©å€‹ domainsc&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ letsencript-prd Issuer å»å–å¾— certificate key pair&lt;/li&gt;
&lt;li&gt;æˆåŠŸå¾ŒæŠŠ ceritifcate èˆ‡ key å­˜åœ¨ secret/acme-crt-secret ä¸­(ä»¥ tls.key, tls.crt çš„å½¢å¼)&lt;/li&gt;
&lt;li&gt;èˆ‡ certificate.certmanager éƒ½æ”¾åœ¨ç›¸åŒ namespace ä¸­ï¼Œç”¢ç”Ÿ certificate.certmanager çš„æ™‚å€™è¦æ³¨æ„æ‰ä¸æœƒæ‰¾ä¸åˆ° secret&lt;/li&gt;
&lt;li&gt;é€™é‚ŠæŒ‡å®šäº† certificate çš„æœ‰æ•ˆæœŸé–“èˆ‡ renew æ™‚é–“ (é è¨­å€¼)ï¼Œæœ‰éœ€è¦å¯ä»¥æ›´æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é…åˆ-ingress-è¨­ç½®-tls&#34;&gt;é…åˆ Ingress è¨­ç½® tls&lt;/h1&gt;
&lt;p&gt;æœ‰ä¸Šè¿°çš„è¨­å®šï¼Œæ¥ä¸‹ä¾†å¯ä»¥è«‹æ±‚ tls certificate&lt;/p&gt;
&lt;p&gt;è¨˜å¾—æˆ‘å€‘ä¸Šç¯‡ Nginx Ingress Controller æåˆ°çš„ ingreess è¨­å®šå—ï¼Ÿé€™é‚Šæº–å‚™äº†ä¸€å€‹é©åˆé…åˆ nginx ingress ä½¿ç”¨çš„ tls è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/ingress.class: &amp;#34;nginx&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    cert-manager.io/issuer: &amp;#34;letsencrypt-prod&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tls:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - hosts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    secretName: my-nginx-ingrss-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  rules:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - host: foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    http:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      paths:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - path: /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        backend:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          serviceName: chechiachang-backend
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          servicePort: 80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ ingress apply å¾Œï¼Œå°±æœƒæ ¹æ“š spec.tls çš„ hosts è¨­å®šï¼Œè‡ªå‹•ç”¢ç”Ÿä¸€å€‹ certificate.certmanager è³‡æºï¼Œä¸¦åœ¨é€™å€‹è³‡æºä½¿ç”¨ letsencryp-prodã€‚&lt;/p&gt;
&lt;p&gt;ä¸ç”¨æˆ‘å€‘æ‰‹å‹• apply æ–°çš„ ceritificateï¼Œé€™é‚Šæ˜¯ cert-manager ä½¿ç”¨äº† annotation ä¾†è§¸ç™¼ &lt;a href=&#34;https://docs.cert-manager.io/en/latest/tasks/issuing-certificates/ingress-shim.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress-shim&lt;/a&gt;ï¼Œç°¡å–®ä¾†èªªï¼Œç•¶ ingress ä¸Šæœ‰ä½¿ç”¨ cert-manager.io çš„ annotation æ™‚ï¼Œcert-manager å°±æœƒæ ¹æ“š ingress è¨­å®šå…§å®¹ï¼ŒæŠ½å‡º spec.tls èˆ‡ isuer annotationï¼Œä¾†ç”¢ç”ŸåŒåçš„ certificates.certmanagerï¼Œé€™å€‹ certificateas.certmanager æœƒè§¸ç™¼æ¥ä¸‹çš„ certificate é ’ç™¼éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åªè¦éƒ¨ç½² Issuer èˆ‡ Ingress å°±å¯ä»¥è‡ªå‹•ç”¢ç”Ÿ certificateã€‚ç•¶ç„¶ï¼Œå¸Œæœ›æ‰‹å‹• apply certificates.certmanager ä¹Ÿæ˜¯è¡Œå¾—é€šã€‚&lt;/p&gt;
&lt;p&gt;æŠŠç”¢ç”Ÿäº† certificate.certmanager æ‹‰å‡ºä¾†çœ‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe certificate my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name:         my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Namespace:    default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; API Version:  cert-manager.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Kind:         Certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Cluster Name:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Creation Timestamp:  2019-10-10T17:58:37Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Generation:          0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Owner References:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     API Version:           extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Block Owner Deletion:  true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Controller:            true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Kind:                  Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Name:                  my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Resource Version:        9295
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Dns Names:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     example.your-domain.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Issuer Ref:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Kind:       Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Name:       letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Secret Name:  my-nginx-ingress-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Status:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Acme:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Order:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       URL:  https://acme-prod-v02.api.letsencrypt.org/acme/order/7374163/13665676
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Conditions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Last Transition Time:  2019-10-10T18:05:57Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Message:               Certificate issued successfully
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Reason:                CertIssued
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Status:                True
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Type:                  Ready
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Events:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Type     Reason          Age                From          Message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----     ------          ----               ----          -------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   CreateOrder     1d                 cert-manager  Created new ACME order, attempting validation...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   DomainVerified  1d                 cert-manager  Domain &amp;#34;foo.example.com&amp;#34; verified with &amp;#34;http-01&amp;#34; validation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   IssueCert       1d                 cert-manager  Issuing certificate...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   CertObtained    1d                 cert-manager  Obtained certificate from ACME server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   CertIssued      1d                 cert-manager  Certificate issued Successfully
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŠŠ certificate å¾ secret æ’ˆå‡ºä¾†çœ‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl describe secret my-nginx-ingress-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name:         my-nginx-ingress-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Namespace:    default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Labels:       cert-manager.io/certificate-name=my-nginx-ingrsss-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Annotations:  cert-manager.io/alt-names=foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              cert-manager.io/common-name=foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              cert-manager.io/issuer-kind=Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              cert-manager.io/issuer-name=letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Type:  kubernetes.io/tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;====
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tls.crt:  3566 bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tls.key:  1675 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æ­¤ä¾¿å¯ä»¥é€é ingress è¨­å®š nginx ä½¿ç”¨ https&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£ *.certmanager.k8s.io CRD å®šç¾©èˆ‡æ„ç¾©&lt;/li&gt;
&lt;li&gt;è¨­å®š Issuer èˆ‡ certificate&lt;/li&gt;
&lt;li&gt;é€é ingress-shim ç›´æ¥éƒ¨ç½² ingress ä¾†ç”¢ç”Ÿ certificate&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Cert Manager Deployment on Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/</link>
      <pubDate>Thu, 10 Oct 2019 16:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Cert-manager Introduction&lt;/li&gt;
&lt;li&gt;Deploy cert-manager&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç°¡ä»‹-cert-manager&#34;&gt;ç°¡ä»‹ cert-manager&lt;/h1&gt;
&lt;p&gt;TLS certificate ç®¡ç†å¾ˆé‡è¦ï¼Œä½†åœ¨ kubernetes ä¸Šç®¡ç† TLS certificates å¾ˆéº»ç…©ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å¾€æˆ‘å€‘ä½¿ç”¨ &lt;a href=&#34;https://letsencrypt.org/zh-tw/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; æä¾›çš„å…è²»è‡ªå‹•åŒ–æ†‘è­‰é ’ç™¼ï¼Œæ­é… &lt;a href=&#34;https://github.com/jetstack/kube-lego&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-lego&lt;/a&gt; ä¾†è‡ªå‹•è™•ç† certificate issuingï¼Œç„¶è€Œéš¨è‘— kube-lego å·²ä¸å†æ›´æ–°å¾Œï¼Œå®˜æ–¹å»ºè­°æ”¹ä½¿ç”¨ &lt;a href=&#34;https://github.com/jetstack/cert-manager/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cert-manager&lt;/a&gt; ä¾†é€²è¡Œ kubernetes ä¸Šçš„æ†‘è­‰è‡ªå‹•åŒ–ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;cert-manager æ˜¯ kubernetes åŸç”Ÿçš„æ†‘è­‰ç®¡ç† controllerã€‚æ˜¯çš„ä»–çš„æ ¸å¿ƒä¹Ÿæ˜¯ä¸€å€‹ controllerï¼Œé€é kubernetes object å®šç¾© desired stateï¼Œç›£æ§é›†ç¾¤ä¸Šçš„å¯¦éš›ç‹€æ…‹ï¼Œç„¶å¾Œæ ¹æ“š resource object ç”¢ç”Ÿæ†‘è­‰ã€‚cert-manager åšå¹¾ä»¶äº‹æƒ…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ kubernetes ä¸Š ä½¿ç”¨ CRD (Customized Resource Definition) ä¾†å®šç¾© certificate issuing çš„ desired state&lt;/li&gt;
&lt;li&gt;å‘ let&amp;rsquo;s encrypt å–å¾—å…¬é–‹çš„æ†‘è­‰&lt;/li&gt;
&lt;li&gt;åœ¨ kubernetes ä¸Šè‡ªå‹•æª¢æŸ¥æ†‘è­‰çš„æœ‰æ•ˆæœŸé™ï¼Œä¸¦è‡ªå‹•åœ¨æœ‰æ•ˆæ™‚é™å…§ renew certificateã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å®‰è£&#34;&gt;å®‰è£&lt;/h1&gt;
&lt;p&gt;å®˜æ–¹æ–‡ä»¶æœ‰æä¾› &lt;a href=&#34;https://docs.cert-manager.io/en/latest/getting-started/install/kubernetes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è©³ç´°æ­¥é©Ÿ&lt;/a&gt; å¯ä»¥ç›´æ¥ä½¿ç”¨ release çš„ yaml éƒ¨å±¬ï¼Œä¹Ÿå¯ä»¥é€é helmã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-yaml-éƒ¨å±¬&#34;&gt;ä½¿ç”¨ yaml éƒ¨å±¬&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Create a namespace to run cert-manager in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Disable resource validation on the cert-manager namespace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace cert-manager certmanager.k8s.io/disable-validation=true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é–‹ä¸€å€‹ç¨ç«‹çš„ namespace ä¾†ç®¡ç† cert-manager resources&lt;/p&gt;
&lt;p&gt;å–æ¶ˆ namespcae ä¸­çš„ kubernetes validating webhookã€‚ç”±æ–¼ cert-manager æœ¬èº«å°±æœƒä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ValidatingWebhookConfiguration&lt;/a&gt; ä¾†ç‚º cert-manager å®šç¾©çš„ Issuer, Certificate resource åš validatingã€‚ç„¶è€Œé€™æœƒé€ æˆ cert-manager èˆ‡ webhook çš„å¾ªç’°ä¾è³´ (circling dependency)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Install the CustomResourceDefinitions and cert-manager itself
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.10.1/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Install the CustomResourceDefinitions and cert-manager itself
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.10.1/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ yaml è£¡é¢é‚„æœ‰å¹¾å€‹å…ƒä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cluster Role-bindings&lt;/li&gt;
&lt;li&gt;CustomResourceDefinition
&lt;ul&gt;
&lt;li&gt;certificaterequests.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;certificates.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;challenges.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;clusterissuers.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;issuers.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;orders.certmanager.k8s.io&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›å…ƒä»¶çš„ç´°ç¯€ï¼Œç•™å¾…é‹ä½œåŸç†åˆ†ææ™‚å†è©³è§£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;helm-deployment&#34;&gt;helm deployment&lt;/h3&gt;
&lt;p&gt;é€™é‚Šä¹Ÿé™„ä¸Šä½¿ç”¨ helm å®‰è£çš„æ­¥é©Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install the CustomResourceDefinition resources separately&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/jetstack/cert-manager/release-0.10/deploy/manifests/00-crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Create the namespace for cert-manager&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Label the cert-manager namespace to disable resource validation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace cert-manager certmanager.k8s.io/disable-validation&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Add the Jetstack Helm repository&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add jetstack https://charts.jetstack.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Update your local Helm chart repository cache&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install the cert-manager Helm chart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --name cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --version v0.10.1 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  jetstack/cert-managerNAMESPACE&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨å±¬å®Œæª¢æŸ¥ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --namespace cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager-5c6866597-zw7kh               1/1     Running   0          2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager-cainjector-577f6d9fd7-tr77l   1/1     Running   0          2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager-webhook-787858fcdb-nlzsq      1/1     Running   0          2m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šéƒ¨å±¬å®Œï¼Œæœƒç²å¾—å®Œæ•´çš„ cert-manager èˆ‡ cert-manager CRDï¼Œä½† certificate çš„ desired state object é‚„æ²’éƒ¨å±¬ã€‚ä¹Ÿå°±æ˜¯é—œæ–¼æˆ‘å€‘è¦å¦‚ä½• issue certificate çš„ç›¸é—œæè¿°ï¼Œéƒ½é‚„æ²’æœ‰ deployï¼Œ cert-manager è‡ªç„¶ä¸æœƒå·¥ä½œã€‚é—œæ–¼ issuing resources configurationï¼Œæˆ‘å€‘ä¸‹æ¬¡å†èŠã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Logstash on GKE</title>
      <link>https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/</link>
      <pubDate>Sat, 21 Sep 2019 15:22:23 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ logstash&lt;/li&gt;
&lt;li&gt;å°‡ logstash éƒ¨å±¬åˆ° kubernetes ä¸Š&lt;/li&gt;
&lt;li&gt;è¨­å®š logstash pipeline è™•ç† nginx access log&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä»‹ç´¹-logstash&#34;&gt;ä»‹ç´¹ Logstash&lt;/h1&gt;
&lt;p&gt;Logstash æ˜¯é–‹å…ƒçš„è³‡æ–™è™•ç†å¼•æ“ï¼Œå¯ä»¥å‹•æ…‹çš„å°‡è¼¸å…¥çš„è³‡æ–™åšå¤§é‡çš„è™•è£¡ã€‚åŸå…ˆçš„ç›®çš„æ˜¯è™•ç† log ï¼Œä½†ç›®å‰ä»¥ä¸é™æ–¼è™•ç† log ï¼Œå„ç¨® ELK beat æˆ–æ˜¯å…¶ä»–ä¾†æºçš„ä¸åŒç›£æ¸¬æ•¸æ“šï¼Œéƒ½èƒ½è™•ç†ã€‚&lt;/p&gt;
&lt;p&gt;Logastash å…§éƒ¨çš„åŠŸèƒ½ä¹Ÿå¤§å¤šæ¨¡çµ„åŒ–ï¼Œå› æ­¤å¯ä»¥çµ„è£ä¸åŒçš„ pluginï¼Œä¾†å¿«é€Ÿè™•ç†ä¸åŒä¾†æºè³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šå¸¸è¦‹çš„è³‡æ–™ä¾†æºï¼Œlogstash éƒ½èƒ½å¤ è™•ç†ï¼Œä¸¦ä¸”æœ‰å¯«å¥½çš„ plugin å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç´°ç¯€è«‹è¦‹&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/current/introduction.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;logstash å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://www.elastic.co/guide/en/logstash/current/static/images/logstash.png&#34; alt=&#34;å®˜æ–¹æ¶æ§‹åœ–&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h1 id=&#34;å¾Œé€è³‡æ–™åº«èˆ‡æœ€çµ‚å„²å­˜åº«&#34;&gt;å¾Œé€è³‡æ–™åº«èˆ‡æœ€çµ‚å„²å­˜åº«&lt;/h1&gt;
&lt;p&gt;åœ¨é–‹å§‹æ¶è¨­ logstash è¦å…ˆè€ƒæ…® pipeline è™•ç†éå¾Œé€çš„è³‡æ–™åº«ï¼Œ&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/current/introduction.html#_choose_your_stash&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯ä½¿ç”¨çš„è³‡æ–™åº«éå¸¸å¤š&lt;/a&gt;ï¼Œé€™é‚Šæœƒå±•ç¤ºçš„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack æ¨™æº–é…å‚™é€åˆ° Elasticsearch
&lt;ul&gt;
&lt;li&gt;å­˜æ”¾æœƒæ™‚å¸¸æŸ¥è©¢çš„ç†±è³‡æ–™ï¼Œåªå­˜æ”¾ä¸€æ®µæ™‚é–“å‰çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;å¤ªèˆŠçš„è³‡æ–™è‡ªå‹• Rollout&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€çµ‚ archieving çš„è³‡æ–™åº«ï¼Œé€™é‚Šä½¿ç”¨ GCP çš„ Big Query
&lt;ul&gt;
&lt;li&gt;å­˜æ”¾æŸ¥æ‰¾æ¬¡æ•¸å°‘ï¼Œä½†éå¸¸å¤§é‡çš„æ­·å²ç´€éŒ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Elasticsearch åœ¨å‰å¹¾ç¯‡å·²ç¶“æ¶è¨­å¥½ï¼Œ&lt;a href=&#34;https://cloud.google.com/bigquery/docs/?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Big Query&lt;/a&gt; çš„è¨­å®šä¹Ÿäº‹å…ˆé–‹å¥½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;éƒ¨å±¬-logstash&#34;&gt;éƒ¨å±¬ Logstash&lt;/h1&gt;
&lt;p&gt;kubernetes resource çš„ yaml è«‹åƒè€ƒ &lt;a href=&#34;https://github.com/chechiachang/elk-kubernetes/tree/master/logstash&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ github elk-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f config-configmap.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f pipelines-configmap.yam
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”¾ä¸Šå»çš„ resource&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;config-configmap:
&lt;ul&gt;
&lt;li&gt;Logstash æœå‹™æœ¬èº«å•Ÿå‹•çš„è¨­å®šåƒæ•¸&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;pipelines-configmap:
&lt;ul&gt;
&lt;li&gt;Logstash çš„ pipelines è¨­å®šæª”æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Lostagh Deployment
&lt;ul&gt;
&lt;li&gt;Logastash çš„æœå‹™ instance&lt;/li&gt;
&lt;li&gt;å¯ä»¥å‹•æ…‹ scalingï¼Œä¹Ÿå°±æ˜¯æœƒæœ‰è¤‡æ•¸ Logstash instance åšè² è¼‰å‡è¡¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Logstash service
&lt;ul&gt;
&lt;li&gt;å¯é€é kubernetes å…§éƒ¨çš„ kube-dns æœå‹™&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å…§çš„ filebeat å¯ä»¥ç›´æ¥é€é logstash.default.svc.chechiachang-cluster.local çš„ dns é€£ç·š logstash&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å…§çš„ç¶²è·¯ï¼Œç›´æ¥ä½¿ç”¨ httpï¼ˆç•¶ç„¶ä½¿ç”¨ https ä¹Ÿæ˜¯å¯ä»¥ï¼Œç›¸é—œæ­¥é©Ÿè«‹è¦‹å‰å¹¾ç¯‡æ–‡ç« ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç°¡å–®è¬›ä¸€ä¸‹ kubernetes service çš„è² è¼‰å‡è¡¡ï¼Œé—œæ–¼ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes service ç´°ç¯€é€™ç¯‡é™„ä¸Šæ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get services
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;logstash          ClusterIP      10.15.254.47    &amp;lt;none&amp;gt;          5044/TCP   182d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get endpoints
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME              ENDPOINTS                                                          AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;logstash          10.12.0.132:5044,10.12.10.162:5044,10.12.9.167:5044 + 12 more...   182d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes å…§éƒ¨æ¯å€‹ Pod éƒ½èƒ½çœ‹åˆ° logstash, logstash.default.svc.chechiachang-cluster.local é€™å…©å€‹ dns&lt;/li&gt;
&lt;li&gt;DNS ç›´æ¥æŒ‡å‘è¤‡æ•¸çš„ logstash endpointsï¼Œ æ¯ä¸€å€‹ ip éƒ½æ˜¯ kubernetes å…§éƒ¨é…ç½®çš„ä¸€å€‹ Pod çš„ IPï¼Œé–‹å•Ÿ 5044 çš„ logstash port&lt;/li&gt;
&lt;li&gt;Service çš„ load balance æ©Ÿåˆ¶è¦– service è¨­å®šï¼Œç´°ç¯€å¯ä»¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€™é‚Š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¬›åˆ°æœ€ç™½ï¼Œå°±æ˜¯ filebeat LOGSTASH URL è¨­å®šç‚º http://logstash å°±æœƒæ‰“åˆ°å…¶ä¸­ä¸€å° logstash&lt;/p&gt;
&lt;p&gt;æ›´æ”¹ filebeat configmap&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl edit configmap filebeat-configmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Disable output to elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Output to logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.logstash:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: [&amp;#34;logstash:5044&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;http&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è¨­å®š-logstash&#34;&gt;è¨­å®š logstash&lt;/h1&gt;
&lt;p&gt;é€™é‚Šè¦å…ˆèªªï¼Œlogstash ä¹Ÿæ”¯æ´ &lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/configuring-centralized-pipelines.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;centralized configuration&lt;/a&gt;ï¼Œå¦‚æœä½ çš„ logstash ä¸æ˜¯è·‘åœ¨ Kubernetes ä¸Šï¼Œæ²’è¾¦æ³•é…ç½®ä¸€å¥— configmap å°±æ‡‰ç”¨åˆ°å…¨éƒ¨çš„ instanceï¼Œè¨˜çš„ä¸€å®šè¦ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Logastash çš„é‹è¡Œè¨­å®š logstash.ymlï¼Œé€™é‚Šæˆ‘å€‘æ²’æœ‰åšè¨­å®šï¼Œéƒ½æ˜¯é è¨­å€¼ï¼Œæœ‰éœ€æ±‚å¯ä»¥è‡ªè¡Œæ›´æ”¹&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶ä¹‹å¾Œè¦èª¿æ•´ batch size æˆ–æ˜¯ queue, cache ç­‰ç­‰æ•ˆèƒ½èª¿æ ¡ï¼Œä¹Ÿæ˜¯ä¾†é€™é‚Šæ”¹ï¼Œæ”¹å®Œ configmap ï¼Œrolling update logstash å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä¸»è¦æ˜¯ä¾†è¬› pipeline è¨­å®šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl describe configmap pipelines-configmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: ConfigMap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: logstash-pipelines
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  labels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    k8s-app: logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;data:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Nginx Template
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # https://www.elastic.co/guide/en/logstash/7.3/logstash-config-for-filebeat-modules.html#parsing-nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  nginx.conf: |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Configmap è£¡é¢åªæœ‰ä¸€å€‹ pipelineï¼Œå°±æ˜¯ &lt;code&gt;nginx.conf&lt;/code&gt;ï¼Œæˆ‘å€‘é€™é‚Šå°±åªæœ‰ä¸€æ¢ï¼Œé€™é‚Šä¸€æ®µä¸€æ®µçœ‹&lt;/p&gt;
&lt;h3 id=&#34;input&#34;&gt;Input&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;input {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  beats {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # The lisening port of logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    port =&amp;gt; 5044
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    host =&amp;gt; &amp;#34;0.0.0.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨­å®š Input ä¾†æºï¼Œæ˜¯ beat å¾ 5044 é€²ä¾†&lt;/p&gt;
&lt;h3 id=&#34;filter&#34;&gt;Filter&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹ä¾†ä¸€å¤§æ®µæ˜¯ filterï¼Œæ¯å€‹ filter ä¸­é–“çš„ block éƒ½æ˜¯ä¸€å€‹ pluginï¼Œlogstash æ”¯æ´éå¸¸å¤šæœ‰è¶£çš„ plugin ï¼Œè™•ç†ä¸åŒä¾†æºçš„å·¥ä½œï¼Œ&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/filter-plugins.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç´°ç¯€è«‹çœ‹é€™ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filter {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Ignore data from other source in case filebeat input is incorrectly configured.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  if [kubernetes][container][name] == &amp;#34;nginx-ingress-controller&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Parse message with grok
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Use grok debugger in kibana -&amp;gt; dev_tools -&amp;gt; grok_debugger
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    grok {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      match =&amp;gt; { &amp;#34;message&amp;#34; =&amp;gt; &amp;#34;%{IPORHOST:[nginx][access][remote_ip]} - \[%{IPORHOST:[nginx][access][remote_ip_list]}\] - %{DATA:[nginx][access][user_name]} \[%{HTTPDATE:[nginx][access][time]}\] \&amp;#34;%{WORD:[nginx][access][method]} %{DATA:[nginx][access][request_url]} HTTP/%{NUMBER:[nginx][access][http_version]}\&amp;#34; %{NUMBER:[nginx][access][response_code]} %{NUMBER:[nginx][access][body_sent][bytes]} \&amp;#34;%{DATA:[nginx][access][referrer]}\&amp;#34; \&amp;#34;%{DATA:[nginx][access][agent]}\&amp;#34; %{NUMBER:[nginx][access][request_length]} %{NUMBER:[nginx][access][request_time]} \[%{DATA:[nginx][access][proxy_upstream_name]}\] %{DATA:[nginx][access][upstream_addr]} %{NUMBER:[nginx][access][upstream_response_length]} %{NUMBER:[nginx][access][upstream_response_time]} %{NUMBER:[nginx][access][upstream_status]} %{DATA:[nginx][access][req_id]}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Match url parameters if has params
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    grok {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      match =&amp;gt; { &amp;#34;[nginx][access][request_url]&amp;#34; =&amp;gt; &amp;#34;%{DATA:[nginx][access][url]}\?%{DATA:[nginx][access][url_params]}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Remove and add fields
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    mutate {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      remove_field =&amp;gt; &amp;#34;[nginx][access][request_url]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      add_field =&amp;gt; { &amp;#34;read_timestamp&amp;#34; =&amp;gt; &amp;#34;%{@timestamp}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      # Add fileset.module:nginx to fit nginx dashboard
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      add_field =&amp;gt; { &amp;#34;[fileset][module]&amp;#34; =&amp;gt; &amp;#34;nginx&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      add_field =&amp;gt; { &amp;#34;[fileset][name]&amp;#34; =&amp;gt; &amp;#34;access&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Parse date string into timestamp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    date {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      match =&amp;gt; [ &amp;#34;[nginx][access][time]&amp;#34;, &amp;#34;dd/MMM/YYYY:H:m:s Z&amp;#34; ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      remove_field =&amp;gt; &amp;#34;[nginx][access][time]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Split url_parameters with &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # /api?uuid=123&amp;amp;query=456 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # become 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # nginx.access.url_params.uuid=123 nginx.access.url_params.query=456
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kv {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source =&amp;gt; &amp;#34;[nginx][access][url_params]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      field_split =&amp;gt; &amp;#34;&amp;amp;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Parse useragent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    useragent {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source =&amp;gt; &amp;#34;[nginx][access][agent]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      target =&amp;gt; &amp;#34;[nginx][access][user_agent]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      remove_field =&amp;gt; &amp;#34;[nginx][access][agent]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Search remote_ip with GeoIP database, output geoip information for map drawing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    geoip {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source =&amp;gt; &amp;#34;[nginx][access][remote_ip]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      target =&amp;gt; &amp;#34;[nginx][access][geoip]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      #fields =&amp;gt; [&amp;#34;country_name&amp;#34;,&amp;#34;city_name&amp;#34;,&amp;#34;real_region_name&amp;#34;,&amp;#34;latitude&amp;#34;,&amp;#34;longitude&amp;#34;,&amp;#34;ip&amp;#34;,&amp;#34;location&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # ==============
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Remove message to reduce data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # ==============
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    if [nginx][access][url] {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      mutate {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # source:/var/lib/docker/containers/6e608bfc0a437c038a1dbdf2e3d28619648b58a1d1ac58635f8178fc5f871109/6e608bfc0a437c038a1dbdf2e3d28619648b58a1d1ac58635f8178fc5f871109-json.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[source]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # Origin message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[message]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        #add_field =&amp;gt; { &amp;#34;[nginx][access][message]&amp;#34; =&amp;gt; &amp;#34;[message]&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[nginx][access][message]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # url_params:client_id=1d5ffd378296c154d3e32e5890d6f4eb&amp;amp;timestamp=1546849955&amp;amp;nonce=9a52e3e6283f2a9263e5301b6724e2c0d723def860c4724c9121470152a42318
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[nginx][access][url_params]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  } # nginx-ingress-controller
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;} # filter
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;grok&#34;&gt;Grok&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/plugins-filters-grok.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grok æœ¬èº«çš„æ–‡ä»¶&lt;/a&gt;åˆæ˜¯ä¸€å¤§æ®µï¼Œå€‹äººå»ºè­°å„è·¯å¤§å¾·ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œè«‹ç›´æ¥æœå°‹äººå®¶é…ç½®å¥½çš„è¨­å®šï¼Œä¸è¦è‡ªå·±å¯«&lt;/p&gt;
&lt;p&gt;çœŸçš„è¦å¯«çš„è©±è¦å–„ç”¨å·¥å…·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kibana Grok Debugger &lt;code&gt;YOUR_KIBANA_HOST/app/kibana#/dev_tools/grokdebugger&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯ä¸çŸ¥åå¤§å¾·è²¢ç»&lt;a href=&#34;https://grokdebug.herokuapp.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç·šä¸Š Debugger&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grok {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  match =&amp;gt; { &amp;#34;message&amp;#34; =&amp;gt; &amp;#34;%{IPORHOST:[nginx][access][remote_ip]} - \[%{IPORHOST:[nginx][access][remote_ip_list]}\] - %{DATA:[nginx][access][user_name]} \[%{HTTPDATE:[nginx][access][time]}\] \&amp;#34;%{WORD:[nginx][access][method]} %{DATA:[nginx][access][request_url]} HTTP/%{NUMBER:[nginx][access][http_version]}\&amp;#34; %{NUMBER:[nginx][access][response_code]} %{NUMBER:[nginx][access][body_sent][bytes]} \&amp;#34;%{DATA:[nginx][access][referrer]}\&amp;#34; \&amp;#34;%{DATA:[nginx][access][agent]}\&amp;#34; %{NUMBER:[nginx][access][request_length]} %{NUMBER:[nginx][access][request_time]} \[%{DATA:[nginx][access][proxy_upstream_name]}\] %{DATA:[nginx][access][upstream_addr]} %{NUMBER:[nginx][access][upstream_response_length]} %{NUMBER:[nginx][access][upstream_response_time]} %{NUMBER:[nginx][access][upstream_status]} %{DATA:[nginx][access][req_id]}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶å¯¦å°±æ˜¯ nginx çš„ access log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1.2.3.4 - [1.2.3.4] - - [21/Sep/2019:07:21:21 +0000] &amp;#34;GET /v1/core/api/list?type=queued&amp;amp;timestamp=1569050481&amp;amp;nonce=d1e80e00381e0ba6e42d4601912befcf03fbf291748e77b178230c19cd1fdbe2 HTTP/1.1&amp;#34; 200 3 &amp;#34;-&amp;#34; &amp;#34;python-requests/2.18.4&amp;#34; 425 0.031 [default-chechiachang-server-80] 10.12.10.124:8003 3 0.031 200 f43db228afe66da67b2c7417d0ad2c04
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é è¨­çš„ log é€ä»¶ä¾†ï¼Œæ ¼å¼æ˜¯ textï¼Œç¶“é pattern matching å¾Œè®Šæˆ json-like formatï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾è³‡æ–™çµæ§‹å–å¾— &lt;code&gt;.nginx.access.remote_ip&lt;/code&gt; é€™æ¨£çš„æ¬„ä½ï¼Œè®“åŸæœ¬çš„ access log å¾ text è®Šæˆå¯ä»¥æŸ¥æ‰¾çš„å…§å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åŸæœ¬çš„ text é€é€² elasticsearch ç•¶ç„¶ä¹Ÿå¯ä»¥æŸ¥æ‰¾ï¼Œä½†å°±æœƒåœ¨ text è£¡é¢åšå…¨æ–‡æª¢ç´¢ï¼ŒåŠŸèƒ½å¾ˆä¾·é™ï¼Œæ•ˆç‡å¾ˆå·®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;output&#34;&gt;Output&lt;/h3&gt;
&lt;p&gt;logstash æ”¯æ´çš„ output ä»¥åŠè¨­å®š&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/output-plugins.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨é€™é‚Š&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  elasticsearch {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    hosts =&amp;gt; [&amp;#34;https://${ELASTICSEARCH_HOST}:${ELASTICSEARCH_PORT}&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    user =&amp;gt; &amp;#34;${ELASTICSEARCH_USERNAME}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    password =&amp;gt; &amp;#34;${ELASTICSEARCH_PASSWORD}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    index =&amp;gt; &amp;#34;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    manage_template =&amp;gt; false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Elasticsearch çš„é…ç½®å¾ˆå–®ç´”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  google_bigquery {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    project_id =&amp;gt; ${GCP_PROJECT_ID}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    dataset =&amp;gt; ${GCP_BIG_QUERY_DATASET_NAME}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    csv_schema =&amp;gt; &amp;#34;path:STRING,status:INTEGER,score:FLOAT&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    json_key_file =&amp;gt; ${GCP_JSON_KEY_FILE_PATH}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    error_directory =&amp;gt; &amp;#34;/tmp/bigquery-errors&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    date_pattern =&amp;gt; &amp;#34;%Y-%m-%dT%H:00&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    flush_interval_secs =&amp;gt; 30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­çš„è®Šæ•¸ï¼Œæˆ‘å€‘å…¨éƒ½ç”¨ç’°å¢ƒè®Šæ•¸ï¼Œåœ¨ deployment.yaml é…ç½®ï¼Œå•Ÿå‹• logstash pods æ™‚ä»£å…¥&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GCP_JSON_KEY_FILE_PATH&lt;/code&gt; é€™é‚Šè¦é…ç½®ä¸€éš» GCP çš„æœå‹™å¸³è™Ÿé‡‘é‘°ï¼Œä¸€å€‹æœ‰ Big Query å¯«å…¥æ¬Šé™çš„ service accountï¼ŒæŠŠ json ä½¿ç”¨ kubernetes secret æ”¾åˆ°é›†ç¾¤ä¸Šï¼Œç„¶å¾Œåœ¨ pod ä¸Šä½¿ç”¨ volume from secret æ›è¼‰é€²ä¾†ã€‚
&lt;code&gt;csv_schema =&amp;gt; &amp;quot;path:STRING,status:INTEGER,score:FLOAT&amp;quot;&lt;/code&gt; é€™é‚Šè¦é…ç½®ä¹‹å¾Œæœƒå­˜å…¥ Big Query çš„ csv çµæ§‹&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;éƒ¨å±¬ Logstash deployment åˆ° kubernetes ä¸Š&lt;/li&gt;
&lt;li&gt;è¨­å®š pipelineï¼Œè¶…å¤š pluginï¼Œæ—ç¹ä¸åŠå‚™è¼‰&lt;/li&gt;
&lt;li&gt;Grok é…ç½®&lt;/li&gt;
&lt;li&gt;Big Query output é…ç½®&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Monitoring GCE With ELK</title>
      <link>https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/</link>
      <pubDate>Wed, 18 Sep 2019 19:10:50 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ELK çš„ beats æ˜¯è¼•é‡ç´šçš„ç³»çµ±ç›£æ¸¬æ”¶é›†å™¨ï¼Œbeats æ”¶é›†åˆ°çš„ data ç¶“é mapping å¯ä»¥é€åˆ° Elasticsearch å¾Œï¼Œé€²è¡Œå½ˆæ€§çš„æœå°‹æ¯”å°ã€‚&lt;/p&gt;
&lt;p&gt;beat æœ‰è¨±å¤šç¨®é¡ï¼Œä¾æ“šæ”¶é›†çš„ data å€åˆ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Auditbeat: Audit data&lt;/li&gt;
&lt;li&gt;Filebeat: Log files&lt;/li&gt;
&lt;li&gt;Functionbeat: Cloud data&lt;/li&gt;
&lt;li&gt;Heartbeat: Availability&lt;/li&gt;
&lt;li&gt;Journalbeat: Systemd journals&lt;/li&gt;
&lt;li&gt;Metricbeat: Metrics&lt;/li&gt;
&lt;li&gt;Packetbeat: Network traffic&lt;/li&gt;
&lt;li&gt;Winlogbeat: Windows event logs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šå…ˆä»¥ filebeat ç‚ºä¾‹ï¼Œåœ¨ GCE ä¸Šæ”¶é›†åœ“ç«¯æœå‹™ç¯€é»ä¸Šçš„æœå‹™æ—¥èªŒèˆ‡ç³»çµ±æ—¥èªŒï¼Œä¸¦åœ¨ ELK ä¸­å‘ˆç¾ã€‚&lt;/p&gt;
&lt;h1 id=&#34;installation&#34;&gt;Installation&lt;/h1&gt;
&lt;p&gt;å®‰è£åŠ filebeat å®‰å…¨æ€§è¨­å®šçš„æ­¥é©Ÿï¼Œåœ¨é€™ç¯‡&lt;a href=&#34;&#34;&gt;Secure ELK Stack&lt;/a&gt; ä¸­å·²ç¶“èªªæ˜ã€‚é€™é‚ŠæŒ‡é™„ä¸Šé€£çµï¼Œä»¥åŠ&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-getting-started.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt; æä¾›åƒè€ƒã€‚&lt;/p&gt;
&lt;h1 id=&#34;configuration&#34;&gt;Configuration&lt;/h1&gt;
&lt;p&gt;é€™é‚Šè«‡å¹¾å€‹ä½¿ç”¨æ–¹é¢çš„è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œapt å®‰è£çš„ filebeat é è¨­çš„ /etc/filebeat/filebeat.yml ä¸å¤ å®Œæ•´ï¼Œæˆ‘å€‘å…ˆåˆ° github æŠŠå°æ‡‰ç‰ˆæœ¬çš„å®Œæ•´è¼‰ä¸‹ä¾†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://raw.githubusercontent.com/elastic/beats/master/filebeat/filebeat.reference.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mv filebeat.reference.yml /etc/filebeat/filebeat.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;beats-central-management&#34;&gt;Beats central management&lt;/h1&gt;
&lt;p&gt;beats é€éæ‰‹å‹•æ›´æ”¹ config éƒ½å¯ä»¥ç›´æ¥è¨­å®šï¼Œä½†é€™é‚Šä¸æ¨è–¦åœ¨æ­¤è¨­å®šï¼Œç†ç”±æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç³»çµ±ä¸­é€šå¸¸æœƒæœ‰å¤§é‡çš„ filebeatï¼Œæ¯å€‹éƒ½è¦è¨­å®šï¼Œæ•¸é‡å¤šæ™‚æ ¹æœ¬ä¸å¯èƒ½&lt;/li&gt;
&lt;li&gt;æ›´æ”¹è¨­å®šæ™‚ï¼Œå¦‚æœä¸ä¸€èµ·æ›´æ”¹ï¼Œæœƒé€ æˆè³‡æ–™æ ¼å¼ä¸çµ±ä¸€ï¼Œä¹‹å¾Œæ¸…ç†ä¹Ÿå¾ˆéº»ç…©&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨è–¦çš„æ–¹å¼æ˜¯é€é Kibana å°æ‰€æœ‰ filebeat åšé›†ä¸­å¼çš„çš„ç®¡ç†é…ç½®ï¼Œåªè¦åˆå§‹è¨­å®šé€£ä¸Š kibanaï¼Œå‰©ä¸‹çš„éƒ½é€é kibana è¨­å®šã€‚&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/configuration-central-management.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶åœ¨æ­¤&lt;/a&gt;ï¼Œæˆ‘å€‘æœ‰ç©ºæœ‰å¯ä»¥åˆ†ç¯‡è«‡é€™å€‹ä¸»é¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸éé€™é‚Šé‚„æ˜¯å¾…å¤§å®¶éä¸€ä¸‹å¹¾å€‹é‡è¦çš„è¨­å®šã€‚ç•¢ç«Ÿè¦åœ¨ kibana ä¸Šé…ç½®ï¼Œfilebeat çš„è¨­å®šæ¦‚å¿µé‚„æ˜¯è¦æœ‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;modules&#34;&gt;modules&lt;/h3&gt;
&lt;p&gt;filebeat æœ‰è¨±å¤š&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¨¡çµ„&lt;/a&gt;ï¼Œè£¡é¢å·²ç¶“åŒ…å«è¨±å¤šé è¨­çš„ template ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ default çš„è¨­å®šå»ç³»çµ±é è¨­çš„è·¯å¾‘æŠ“å–æª”æ¡ˆï¼Œä¸¦ä¸”å…ˆé€²ä¸€æ­¥è™•ç†ï¼Œæ¸›å°‘æˆ‘å€‘è¼¸å‡ºåˆ° logstash é‚„è¦å†åš pipeline é è™•ç†ï¼Œéå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚é€™å€‹ system module æœƒè™•ç†ç³»çµ±é è¨­çš„ log è·¯å¾‘ï¼Œåªè¦é–‹å•Ÿ module ï¼Œå°±æœƒè‡ªå‹•è™•ç†å°æ‡‰çš„ inputã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  syslog:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‰©ä¸‹çš„å°±æ˜¯ç…§éœ€æ±‚å•Ÿç”¨ module ï¼Œä¸¦ä¸”çµ¦äºˆå°æ‡‰çš„ inputã€‚&lt;/p&gt;
&lt;p&gt;ELK ç‚ºè‡ªå·±çš„æœå‹™è¨­å®šäº†ä¸å°‘ module ï¼Œç›´æ¥å•Ÿç”¨å°±å¯ä»¥ç²å–é€™å”æœå‹™å…ƒä»¶é‹è¡Œçš„ log èˆ‡ç›£æ¸¬æ•¸å€¼ã€‚é€™ä¹Ÿæ˜¯ self-monitoring ç›£æ¸¬æ•¸æ“šçš„ä¸»è¦ä¾†æºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;input&#34;&gt;input&lt;/h3&gt;
&lt;p&gt;filebeat æ”¯æ´è¤‡æ•¸ inputsï¼Œæ¯å€‹ input æœƒå•Ÿå‹•ä¸€å€‹æ”¶é›†å™¨ï¼Œè€Œ filebeat æ”¶é›†ç›®æ¨™æ˜¯ log æª”æ¡ˆã€‚åŸºæœ¬ä¸Šå¯ä»¥ç°¡å–®ç†è§£ç‚º filebeat å»è®€å–é€™äº› log æª”æ¡ˆï¼Œä¸¦ä¸”åœ¨ç³»çµ±ä¸Šç´€éŒ„è®€å–çš„é€²åº¦ï¼Œåµæ¸¬åˆ° log æœ‰å¢åŠ ï¼Œè®Šç¹¼çºŒè®€å–æ–°çš„ logã€‚&lt;/p&gt;
&lt;p&gt;filebeat å…·é«”çš„å·¥ä½œæ©Ÿåˆ¶ï¼Œå¯ä»¥çœ‹é€™ç¯‡&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/how-filebeat-works.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How Filebeat works?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€™ç¯‡æ–‡ä»¶ä¹Ÿæåˆ° filebeat æ˜¯ç¢ºä¿è‡³å°‘ä¸€æ¬¡(at-least-once delivery)çš„æ•¸æ“šè®€å–ï¼Œä½¿ç”¨æ™‚è¦ç‰¹åˆ¥æ³¨æ„é‡è¤‡ç²å–çš„å¯èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæŠŠ input åŠ ä¸Š ubuntu é è¨­çš„ log è·¯å¾‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat.inputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- type: log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  paths:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - /var/log/*.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šæ³¨æ„ input æ”¯æ´å¤šç¨® typeï¼Œåƒç…§å®Œæ•´è¨­å®šæª”æ¡ˆçš„èªªæ˜é…åˆè‡ªå·±çš„éœ€æ±‚ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;processor&#34;&gt;Processor&lt;/h3&gt;
&lt;p&gt;åœ¨ filebeat ç«¯å…ˆé€²è¡Œè³‡æ–™çš„ç¬¬ä¸€å±¤è™•ç†ï¼Œå¯ä»¥å¤§å¹…è¬›å°‘ä¸å¿…è¦çš„è³‡æ–™ï¼Œé™ä½æª”æ¡ˆå‚³è¼¸ï¼Œä»¥åŠå° elasticsearch server çš„è² æ“”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;output&#34;&gt;output&lt;/h3&gt;
&lt;p&gt;output ä¹Ÿæ˜¯ filebeat ååˆ†é‡è¦çš„ä¸€ç’°ï¼Œå¥½çš„ filebeat output è¨­å®šï¼Œå¯ä»¥å¤§å¹…é™ä½æ•´é«” ELK stack çš„è² æ“”ã€‚å£çš„è¨­å®šä¹Ÿæœƒç›´æ¥å¡çˆ† ELK staskã€‚&lt;/p&gt;
&lt;p&gt;output.elasticsearch: ç›´æ¥å‘å¾Œé€é€² elasticsearch
output.logstash: å…ˆå‘å¾Œé€åˆ° logstash&lt;/p&gt;
&lt;p&gt;é€™é‚Šéå¸¸æ¨è–¦å¤§å®¶ï¼Œæ‰€æœ‰çš„ beat å¾€å¾Œé€é€² elasticsearch ä¹‹å‰éƒ½å…ˆéä¸€å±¤ logstashï¼Œå°±ç®—ä½ çš„ logstash å…§éƒ¨å®Œå…¨ä¸æ›´æ”¹ dataï¼Œæ²’æœ‰ pipeline mutationï¼Œé‚„æ˜¯ä¸è¦çœé€™ä¸€å±¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;beat çš„æ•¸é‡æœƒéš¨æ‡‰ç”¨æ„ˆä¾†è¶Šå¤šè€Œç·šæ€§å¢åŠ ï¼Œelasticsearch å¾ˆé›£ç·šæ€§ scaleï¼Œæˆ–æ˜¯ scale æˆæœ¬å¾ˆå¤§&lt;/li&gt;
&lt;li&gt;filebeat æ²’æœ‰å¥½å¥½èª¿æ ¡çš„è©±ï¼Œå°æ–¼è¼¸å‡ºç«¯çš„ç¶²è·¯è² æ“”å¾ˆå¤§ï¼Œä¸åƒ…ä½”ç”¨å¤§é‡é€£ç·šï¼Œå‚³è¼¸æª”æ¡ˆçš„å¤§å°ä¹Ÿå¾ˆå¤§ã€‚&lt;/li&gt;
&lt;li&gt;logstash çš„ queue èˆ‡å¾Œé€çš„ batch æ©Ÿåˆ¶æ¯” filebeat å¥½ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;filebeat æ˜¯æ”¶ log çš„ï¼Œé€šå¸¸ log çˆ†ç‚¸çš„æ™‚å€™ï¼Œæ˜¯æ‡‰ç”¨å‡ºå•é¡Œçš„æ™‚å€™ï¼Œé€™æ™‚å€™éœ€è¦ log äº¤å‰æ¯”å°ï¼Œç™¼ç¾ elasticsearch æµé‡ä¹Ÿçˆ†è¡ï¼Œåæ‡‰å¾ˆæ‡‰ç”¨&lt;/li&gt;
&lt;li&gt;logstash é€éä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥å¾ˆè¼•æ˜“çš„ scaleï¼Œç”±æ–¼ pipeline æœ¬èº«å¯ä»¥åˆ†æ•£æ˜¯å¹³è¡Œè™•ç†ï¼Œscale logstash ä¸¦ä¸æœƒå½±éŸ¿è³‡æ–™æœ€çµ‚ç‹€æ…‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;load-balance&#34;&gt;load balance&lt;/h3&gt;
&lt;p&gt;æœ‰ç¶²å‹ç•™è¨€è©¢å• logstash å‰é¢çš„ load balance å¦‚ä½•è™•ç†æ¯”è¼ƒå¥½ï¼Œæˆ‘é€™é‚Šä¹Ÿé †ä¾¿é™„ä¸Šã€‚ä¸åªæ˜¯ logstash ï¼Œæ‰€æœ‰è‡ªèº«ç„¡ç‹€æ…‹(stateless) çš„æœå‹™éƒ½å¯ä»¥ç…§é€™æ¨£å» scaleã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ kubernetes ä¸Šå¾ˆå¥½è™•ç†ï¼Œä½¿ç”¨ k8s é è¨­çš„ service å°±è¼•æ˜“ä½œåˆ°ç°¡æ˜“çš„ load balance&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­ç½®è¤‡æ•¸ logstash instances&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ kubernetes å…§éƒ¨ç¶²è·¯ service å¯¦ç¾ load balancingã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ GCE ä¸Šå¯¦ç¾çš„è©±ï¼Œæˆ‘èªªå¯¦è©±æ²’å¯¦ä½œéï¼Œæ‰€ä»¥ä»¥ä¸‹æ˜¯éµç›¤å¯¦ç¾XDã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/load-balancing.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt; å»ºè­°ä½¿ç”¨ beats ç«¯è¨­å®šå¤šå€‹ logstash url ä¾†åš load balancingã€‚&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä¸æ˜¯å¾ˆå–œæ­¡ beat å»é…ç½®å¤šå€‹ logstash url çš„ä½œæ³•ï¼šbeat è¦æ„ŸçŸ¥ logstash æ•¸é‡è·Ÿ url ï¼Œå¢åŠ æ¸›å°‘ logstash instance é‚„è¦æ›´æ”¹ beats é…ç½®ï¼Œç”¢ç”Ÿé…ç½®çš„ä¾è³´è·Ÿè€¦åˆã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¥½æ˜¯åœ¨ logstash å‰éä¸€å±¤ HAproxy æˆ–æ˜¯é›²ç«¯æœå‹™çš„ Load balancerï¼ˆex. GCP https/tcp load balancerï¼‰ï¼Œbeat ç›´æ¥é€é€² load balance çš„ç«¯é»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;autodiscover&#34;&gt;autodiscover&lt;/h1&gt;
&lt;p&gt;å¦‚æœæœ‰ä½¿ç”¨ container ï¼Œä¾‹å¦‚ docker æˆ– kubernetesï¼Œç”±æ–¼ container å…§çš„ log åœ¨ä¸»æ©Ÿä¸Šçš„ä½ç½®æ˜¯å‹•æ…‹è·¯å¾‘ï¼Œé€™é‚Šå¯ä»¥ä½¿ç”¨ autodiscover å»å°‹æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ kubernetes ä¸Šé¢çš„è¨­å®šï¼Œä¹‹å¾Œæœƒå¦é–‹ä¸€å¤©è¨è«–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;dashboard&#34;&gt;dashboard&lt;/h1&gt;
&lt;p&gt;kibana é è¨­æ˜¯ç©ºçš„ï¼Œæ²’æœ‰é å…ˆè¼‰å…¥ dashboardï¼Œä½†æˆ‘å€‘æœƒå¸Œæœ›è³‡æ–™é€é€²å»ï¼Œå°±æœ‰è¨­å®šå¥½çš„ dashboard ï¼Œåœ–åƒåŒ–æŠŠè³‡æ–™å‘ˆç¾å‡ºä¾†ã€‚é€™éƒ¨ä»½éœ€è¦å¾ beat é€™é‚Šå‘ kibana å¯«å…¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„éƒ¨ä»½è¨­å®šå¥½ kibana çš„é€£ç·šè³‡æ–™ï¼Œæ²’æœ‰è¨­å®šçš„è©± beat å•Ÿå‹•æœƒè­¦å‘Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setup.dashboards.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€èµ·ä¸­å°±æœƒæª¢æŸ¥ kibana æ˜¯å¦æœ‰åŒ¯å…¥ dashboardï¼Œæ²’æœ‰çš„è©±å°±åŒ¯å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿæœƒä¸€ä½µåŒ¯å…¥ modules çš„ dashboardï¼Œä¾‹å¦‚å¦‚æœæœ‰å•Ÿç”¨ nginx module è™•ç† nginx çš„ access logï¼Œnginx module æœƒè™•ç† request source ip ï¼Œä¸¦é€é geoip database, å°‡ ip è½‰æœƒæˆç¶“ç·¯åº¦åº§æ¨™ã€‚é€™æ™‚å¦‚æœåœ¨ kibana ä¸Šæœ‰åŒ¯å…¥ nginx dashboardï¼Œå°±å¯ä»¥çœ‹åˆ°åœ–åƒåŒ–çš„å…¨çƒ request åˆ†ä½ˆåœ–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å–å¾—å®Œæ•´ filebeat è¨­å®šæª”æ¡ˆä¸¦è¨­å®š filebeat&lt;/li&gt;
&lt;li&gt;ç›¡é‡é€é beat central management ä¾†ç®¡ç† beat çš„è¨­å®šæª”&lt;/li&gt;
&lt;li&gt;å•Ÿç”¨å°æ‡‰ module ä¾†æ›´å„ªé›…çš„è™•ç† log&lt;/li&gt;
&lt;li&gt;å¾Œé€åˆ° elasticsearch å‰çš„è³‡æ–™éƒ½å¿…é ˆç¶“éç²¾ç´°çš„è™•ç†ï¼Œé€é€²å»å¾Œå°±ä¸å¥½åˆªæ”¹äº†&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ELK or Not ELK</title>
      <link>https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/</link>
      <pubDate>Wed, 18 Sep 2019 18:51:40 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ‰æ¿å‹å•åˆ°ï¼Œè¦å¦‚ä½•é¸æ“‡è¦ä¸è¦ç”¨ ELKï¼Œå…¶å¯¦ä¹Ÿé€™æ˜¯æ•´ç¯‡ ELK çš„åˆè¡·ã€‚é€™é‚Šåˆ†äº«ä¸€ä¸‹ ELK èˆ‡å…¶ä»–é¸æ“‡ï¼Œä»¥åŠé¸æ“‡è§£æ±ºæ–¹æ¡ˆæ‡‰è©²è€ƒæ…®çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…¶ä»–å¸¸ç”¨çš„æœå‹™&#34;&gt;å…¶ä»–å¸¸ç”¨çš„æœå‹™&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus&lt;/a&gt;: é–‹æºçš„ time series metrics æ”¶é›†ç³»çµ±&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/stackdriver/?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stackdriver&lt;/a&gt;: GCP çš„ log èˆ‡ metrics å¹³å°&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/cloud/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Elastic Cloud&lt;/a&gt;: ELK çš„ Sass&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/post/self-host-elk-stack-on-gcp/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Self-hosted ELK&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ–æ˜¯ä¾ç…§éœ€æ±‚æ··æ­ï¼Œå„å€‹æœå‹™ä½¿ç”¨çš„å„å±¤å¥—ä»¶æ˜¯å¯ä»¥ç›¸å®¹ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ GKE ä¸Šä¸ç”¨ beat å¯ä»¥ç”¨ fluentd&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Prometheus -&amp;gt; Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ELK -&amp;gt; Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fluentd -&amp;gt; Prometheus
&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sass vs cloud self-hosted vs on-premised&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Metrics: ELK vs Prometheus vs Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Logging: ELK vs Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å–æ¨åŸå‰‡&#34;&gt;å–æ¨åŸå‰‡&lt;/h1&gt;
&lt;p&gt;å„å€‹æ–¹æ³•éƒ½å„æœ‰åˆ©å¼Šï¼Œå®Œå…¨å–æ±ºæ–¼éœ€æ±‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·²çŸ¥æ¢ä»¶é™åˆ¶ï¼Œä¾‹å¦‚å®‰å…¨æ€§è€ƒé‡å°±æ˜¯è¦æ”¾åœ¨ç§æœ‰ç¶²è·¯é˜²ç«ç‰†å…§ï¼Œæˆ–æ˜¯é ç®—&lt;/li&gt;
&lt;li&gt;è³‡æ–™è®€å–æ–¹å¼ï¼Œæœ‰æ²’æœ‰è¦äº¤å‰æ¯”å°æ”¶é›†çš„è³‡æ–™ï¼Œé‚„æ˜¯å–®ç´”ä¾ç…§æ™‚é–“åºæŸ¥è©¢&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯è³‡æ–™é‡éå¸¸å¤§ï¼Œæ‡‰ç”¨æ•¸é‡éå¸¸å¤š&lt;/li&gt;
&lt;li&gt;ç¶­è­·çš„åœ˜éšŠï¼Œæœ‰æ²’æœ‰æƒ³ï¼Œæˆ–æœ‰æ²’æœ‰èƒ½åŠ›è‡ªå·±é¤Š self-host æœå‹™&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;sass-vs-self-hosted-vs-on-premised&#34;&gt;Sass vs Self-hosted vs On-premised&lt;/h1&gt;
&lt;p&gt;Sass: æŒ‡çš„æ˜¯ç›´æ¥ç”¨ Elasitc Cloudï¼Œæˆ–æ˜¯ç›´æ¥ä½¿ç”¨å…¬æœ‰é›²çš„æœå‹™(ex. åœ¨ GCP ä¸Šä½¿ç”¨ stackdriver)&lt;/p&gt;
&lt;p&gt;Cloud Self-hosted: åœ¨å…¬æœ‰é›²ä¸Šä½¿ç”¨ ELK&lt;/p&gt;
&lt;p&gt;On-Premised: è‡ªå·±åœ¨æ©Ÿæˆ¿æ­è¨­&lt;/p&gt;
&lt;h3 id=&#34;å®‰å…¨æ€§&#34;&gt;å®‰å…¨æ€§&lt;/h3&gt;
&lt;p&gt;çœ‹å…¬å¸çš„å®‰å…¨æ”¿ç­–ï¼Œå…è¨±å°‡æ—¥èªŒåŠç›£æ§æ•¸æ“šï¼Œé€åˆ°ç§æœ‰ç¶²è·¯ä»¥å¤–çš„åœ°æ–¹å—ï¼Ÿå¦‚æœåœ¨é˜²ç«ç‰†å…§ï¼Œæä¸å¥½ port æ ¹æœ¬å°±ä¸é–‹çµ¦ä½ ï¼Œæ ¹æœ¬ä¸ç”¨è€ƒæ…®ä½¿ç”¨å¤–éƒ¨æœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;è¦çŸ¥é“æœå‹™çš„ log å…¶å¯¦å¯ä»¥çœ‹å‡ºå¾ˆå¤šæ±è¥¿ï¼å¦‚æœæœ‰ç‰¹åˆ¥åšè³‡æ–™åˆ†æï¼Œæ•æ„Ÿçš„è³‡æ–™ï¼Œé‡‘æµç›¸é—œæ•¸æ“šï¼Œé€šå¸¸ä¸æœƒæƒ³è¦å€’åˆ°ç¬¬ä¸‰æ–¹æœå‹™å¹³å°ã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½æœ‰åšé‡‘æµçš„ï¼Œå…‰æ˜¯å®‰å…¨æ€§é€™é»ï¼Œå°±å¿…é ˆé¸æ“‡è‡ªæ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆæœ¬&#34;&gt;æˆæœ¬&lt;/h3&gt;
&lt;p&gt;é‡‘éŒ¢æˆæœ¬ + ç¶­è­·æˆæœ¬&lt;/p&gt;
&lt;p&gt;é‡‘éŒ¢æˆæœ¬å°±çœ‹å„å€‹æœå‹™çš„è¨ˆè²»æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/products/elasticsearch/service/pricing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Elastic Cloud Pricing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Self-hosted ELK &amp;amp; Prometheusï¼šæ©Ÿå™¨æˆæœ¬&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²æœå‹™(ex. &lt;a href=&#34;https://cloud.google.com/stackdriver/pricing?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Stackdriver&lt;/a&gt;): ç”¨é‡è¨ˆè²»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¶­è­·æˆæœ¬: å·¥ç¨‹å¸«çš„æœˆè–ª * æ¯å€‹æœˆè¦èŠ±åœ¨ç¶­è­·æœå‹™çš„å·¥æ™‚æ¯”ä¾‹&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ Sass ä»£ç®¡çš„æœå‹™ï¼Œæœƒé™ä½ç¶­è­·æˆæœ¬ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åšåˆ°ç¶²é é»ä¸€é»å°±å¯ä»¥ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå…¬å¸æœ‰å®Œæ•´çš„ç¶­è­·åœ˜éšŠï¼Œæœ‰æ©Ÿæˆ¿ï¼Œæœå‹™çš„ä½¿ç”¨é‡ä¹Ÿå¾ˆå¤§ï¼Œç•¶ç„¶ self-hosted æ˜¯æ¯”è¼ƒçœã€‚
ä¸­å°å‹ä¼æ¥­ä»¥åŠæ–°å‰µï¼Œæœå‹™åœ¨å…¬æœ‰é›²ä¸Šçš„ï¼Œç›´æ¥ä½¿ç”¨Sass æœå‹™å¾€å¾€æ¯”è¼ƒç¯€çœæˆæœ¬ï¼Œæœå‹™ç›´æ¥ç”± Sass ç¶­è­·ï¼Œç¯€çœå¾ˆå¤šæ©Ÿå™¨ä¸Šç®¡ç†è·Ÿæ—¥å¸¸ç¶­è­·ã€‚&lt;/p&gt;
&lt;p&gt;é¿å…è¿·æ€ï¼Œè²·å¤–éƒ¨æœå‹™çš„å¸³å–®æ˜¯é¡¯æ€§çš„ï¼Œå ±å¸³æ™‚çœ‹å¾—åˆ°ï¼Œè€Œå·¥ç¨‹å¸«ç¶­è­·çš„æ™‚é–“æˆæœ¬æ˜¯éš±æ€§çš„ã€‚self-host å¯èƒ½çœä¸‹ Sass è²»ç”¨ï¼Œä½†å·¥ç¨‹å› ç‚ºåˆ†äº†æ™‚é–“å»ç¶­è­·ï¼Œè€Œå½±éŸ¿é€²åº¦ã€‚é€™éƒ¨åˆ†å°±çœ‹åœ˜éšŠå¦‚ä½•å–æ¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ˜“ç”¨æ€§&#34;&gt;æ˜“ç”¨æ€§&lt;/h3&gt;
&lt;p&gt;å¦‚æœæ‡‰ç”¨éƒ½è·‘åœ¨å…¬æœ‰é›²ä¸Šï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨é›²å¹³å°æä¾›çš„ç›£æ¸¬æœå‹™ï¼Œä½¿ç”¨ä¾¿åˆ©ï¼Œè€Œä¸”æ•´åˆåº¦é«˜ã€‚ex  GCP ä¸Šï¼Œè¦å•Ÿç”¨ Stackdriver æ˜¯éå¸¸è¼•é¬†çš„äº‹æƒ…ï¼Œåªæ˜¯æ”¹ä¸€å…©å€‹é¸é …ï¼Œå°±å¯ä»¥é–‹å•Ÿ / é—œé–‰ logging èˆ‡ metrics&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ On-premised è‡ªå®¶æ©Ÿæˆ¿ï¼Œä¹Ÿè¨± self-hosted æœƒæ›´ç‚ºé©åˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¢è£½åŒ–ç¨‹åº¦&#34;&gt;å®¢è£½åŒ–ç¨‹åº¦&lt;/h3&gt;
&lt;p&gt;åœ¨å¤§å¤šæ•¸æ™‚å€™ï¼Œæ²’æœ‰éœ€è¦æ›´æ”¹åˆ°æœå‹™çš„æ ¸å¿ƒè¨­å®šï¼Œéƒ½å¯ä»¥ä¸å¯å¾‹å®¢è£½åŒ–ç¨‹åº¦ï¼Œç›´æ¥ä½¿ç”¨ Sass çš„è¨­å®šï¼Œå°±èƒ½æ»¿è¶³å¤§éƒ¨åˆ†éœ€æ±‚ã€‚å¯ä»¥ç­‰æœ‰æœ‰æ˜ç¢ºéœ€æ±‚å¾Œå†è€ƒæ…®é€™ä¸€é»ã€‚çŸ­æœŸå…§æ²’æœ‰ç‰¹æ®Šéœ€æ±‚å°±å¯ä»¥å¾ç°¡ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨GKE åˆ° Stackdriver çš„è©±ï¼Œå°ä¸»æ©Ÿæœ¬èº«çš„æ©Ÿå™¨æ˜¯æ²’æœ‰æ§åˆ¶æ¬Šçš„ï¼ŒåŸ·è¡Œçš„ pipeline ä¹Ÿä¸å¤ªèƒ½æ›´æ”¹
Elastic Cloud æœ‰æä¾›ä¸Šå‚³ elasticsearch config æª”æ¡ˆçš„ä»‹é¢ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ›´æ”¹ server é‹è¡Œçš„åƒæ•¸è¨­å®š
Self-Hosted é™¤äº†ä¸Šè¿°çš„è¨­å®šï¼Œé‚„å¯ä»¥ä¾ç…§éœ€æ±‚æ›´æ”¹ ELK / prometheus æœå‹™ï¼Œåœ¨å¯¦é«”æ©Ÿå™¨ä¸Šçš„ topologyï¼Œcpu è¨˜æ†¶é«”çš„è³‡æºé…ç½®ï¼Œå„²å­˜ç©ºé–“é…ç½®ç­‰ï¼Œå¯ä»¥æœ€å¤§åŒ–æ©Ÿå™¨çš„æ•ˆèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;scalability&#34;&gt;Scalability&lt;/h3&gt;
&lt;p&gt;è³‡æ–™æµé‡å¤§ï¼Œå„²å­˜ç©ºé–“æ¶ˆè€—å¤šï¼Œæœå‹™è² æ“”å¤§ï¼Œå¯èƒ½å°±æœƒéœ€è¦æ“´å±•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å€‹æ˜¯è³‡æ–™é‡çš„æ“´å±•ã€‚ä¸€å€‹æ˜¯ç‚ºäº†æ‡‰ä»˜æœå‹™çš„è² æ“”ï¼Œå° ELK æœå‹™å…ƒä»¶åšæ°´å¹³æ“´å±•ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† elasticsearch ä»¥çˆ²çš„å…ƒä»¶ï¼Œä¾‹å¦‚ kibanaï¼Œapm-server, beats éƒ½å¯ä»¥é€é kubernetes è¼•æ˜“çš„æ“´å±•ï¼Œå”¯æœ‰ elasticsearch ï¼Œç”±æ–¼åˆç‰½æ‰¯ä¸Šè¿°è³‡æ–™é‡çš„æ“´å±•ï¼Œä»¥åŠåˆ†ä½ˆï¼Œé‚„æœ‰å‰¯æœ¬ç®¡ç†ï¼Œindex æœ¬èº«çš„ lifecycle ç®¡ç†ã€‚Elasticsearch çš„ scaling è¨­å®šä¸Šæ˜¯è »è¤‡é›œçš„ï¼Œä¹Ÿæœ‰å¾ˆå¤šå·¥è¦åšã€‚index çš„ shards / replicas è¨­å®šéƒ½è¦æ³¨æ„åˆ°ã€‚å¦å‰‡ä¸€è·¯ scale ä¸Šå»ï¼Œé›†ç¾¤å¤§çš„æ™‚å€™å½¼æ­¤ sharding sync çš„æ•ˆèƒ½æ¶ˆè€—æ˜¯å¦æœƒå¤ªé‡ã€‚&lt;/p&gt;
&lt;p&gt;Stackdriver å¾ä½¿ç”¨è€…çš„è§’åº¦ï¼Œæ˜¯ä¸å­˜åœ¨æœå‹™ç¯€é»çš„æ“´å±•å•é¡Œï¼Œç¯€é»çš„ç¶­è­·å…¨éƒ½çµ¦ Sass ç®¡ç†ã€‚è³‡æ–™é‡çš„æ“´å±•å•é¡Œä¹Ÿä¸å¤§ï¼Œåªè¦æ•´ç†è³‡æ–™ pipelineï¼Œè®“æœ€å¾Œå„²å­˜çš„è³‡æ–™å®¹æ˜“è¢«æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;h1 id=&#34;timeseries-vs-non-timeseriese&#34;&gt;Timeseries vs non-timeseriese&lt;/h1&gt;
&lt;p&gt;Prometheus &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/storage/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ˜¯è‡ªå¸¶ time series database&lt;/a&gt;ï¼Œstackdriver ä¹Ÿæ˜¯ time series çš„å„²å­˜ã€‚ELK çš„ elasticsearch æ˜¯å…¨æ–‡æœç´¢å¼•æ“ï¼Œç”¨äº† timestamp åšåˆ†ææ‰€ä»¥å¯ä»¥åšåˆ° time series çš„è³‡æ–™ç´€éŒ„èˆ‡åˆ†æã€‚é€™é»åœ¨æœ¬è³ªä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…‰åªè™•ç† time series dataï¼ŒPrometheus çš„ query æ•ˆèƒ½æ˜¯æ¯” elasticsearch å¥½å¾ˆå¤š&lt;/li&gt;
&lt;li&gt;Elasticsearch æœ‰å¤§é‡çš„ index ç¶­è­·ï¼Œéœ€è¦è¼ƒå¤šç³»çµ±è³‡æºè™•ç†ï¼Œåœ¨æ²’æœ‰ query å£“åŠ›çš„æƒ…å½¢ä¸‹æœƒæœ‰ç³»çµ±è‡ªå‹•ç¶­è­·çš„æ•ˆèƒ½æ¶ˆè€—&lt;/li&gt;
&lt;li&gt;ELK çš„è³‡æ–™ä¸éœ€è¦é å…ˆå»ºæ¨¡ï¼Œå°±å¯ä»¥åšåˆ°éå¸¸å½ˆæ€§çš„æœå°‹æŸ¥æ‰¾ã€‚Stackdriver çš„è©±ï¼Œç„¡æ³•ç”¨æœªå»ºæ¨¡çš„è³‡æ–™æ¬„ä½äº¤å‰æŸ¥æ‰¾ã€‚
&lt;ul&gt;
&lt;li&gt;Log æ”¶é›†æ–¹é¢
&lt;ul&gt;
&lt;li&gt;Elasticsearch ä¸­çš„è³‡æ–™æ¬„ä½é€é tempalte åŒ¯å…¥å¾Œï¼Œéƒ½æ˜¯æœ‰åš index ï¼Œæ‰€ä»¥äº¤å‰æŸ¥æ‰¾ï¼Œä¾‹å¦‚å¯ä»¥å¾ log text ä¸­åŒ…å«ç‰¹å®šå­—ä¸²çš„ç´€éŒ„ï¼Œåœ¨åš aggregate ç®—å‡ºå…¶ä»–æ¬„ä½çš„è³‡æ–™åˆ†ä½ˆã€‚æœƒæ¯”è¼ƒæ…¢ï¼Œä½†æ˜¯æ˜¯åšå¾—åˆ°çš„å…¨æ–‡æœç´¢&lt;/li&gt;
&lt;li&gt;Stackdriver å¯ä»¥åšåŸºæœ¬çš„ filter ï¼Œä¾‹å¦‚ filter æŸå€‹æ¬„ä½ï¼Œä½†ä¸èƒ½åšå¤ªè¤‡é›œçš„äº¤å‰æ¯”å°ï¼Œä¹Ÿä¸èƒ½é‡å° text å…§å®¹ä½œäº¤äº’æŸ¥æ‰¾ï¼Œéœ€è¦æ›å‡ºä¾†å¦å¤–è™•ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Metrics æ”¶é›†æ–¹é¢
&lt;ul&gt;
&lt;li&gt;(åŒä¸Š) Elasticsearch å¯ä»¥ç”¨å…¨æ–‡æœç´¢ï¼Œåšåˆ°å¾ˆè¤‡é›œçš„äº¤å‰æ¯”å°ï¼Œä¾‹å¦‚ï¼šå¾ metrics æ•¸å€¼ï¼Œè¨ˆç®—åœ¨æ™‚é–“ç¯„åœçš„åˆ†ä½ˆæƒ…å½¢(cpu è¶…é 50% è½åœ¨ä¸€å¤© 24 å°æ™‚ï¼Œå„å€‹å°æ™‚çš„æ¬¡æ•¸)&lt;/li&gt;
&lt;li&gt;Stackdriver åªèƒ½åšåŸºæœ¬çš„ time series æŸ¥æ‰¾ï¼Œç„¶å¾Œé€éé å…ˆå®šç¾©å¥½çš„ field filter è³‡æ–™ï¼Œå†å„è‡ªåœ–åƒåŒ–ã€‚&lt;/li&gt;
&lt;li&gt;Prometheus ä¹Ÿæ˜¯å¿…é ˆä¾ç…§ time series æŸ¥æ‰¾ï¼Œèªæ³•ä¸Šå½ˆæ€§æ¯” stackdriver å¤šå¾ˆå¤šï¼Œä½†ä¾æ¨£ä¸èƒ½æœå°‹æ²’æœ‰ index çš„æ¬„ä½&lt;/li&gt;
&lt;li&gt;é€™é‚Šè¦æ›¿åˆ¥æï¼Œé›–ç„¶ Elasticsearch èƒ½ç”¨å…¨æ–‡æœç´¢è¼•æ˜“åœ°åšåˆ°è¤‡é›œçš„æŸ¥è©¢èªæ³•ï¼Œä½†ä»¥ metrics ä¾†èªªï¼Œå…¶å¯¦æ²’æœ‰å¤ªå¤šè·³è„« time series æŸ¥æ‰¾çš„éœ€æ±‚ã€‚èƒ½åšåˆ°ï¼Œä½†æœ‰æ²’æœ‰å¿…è¦é€™æ¨£åšï¼Œå¯ä»¥æ‰“å€‹å•è™Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å€‹äººå¿ƒå¾—ï¼Œå¦‚æœé©—è­‰å…¨æ–°çš„ business modelï¼Œæˆ–æ˜¯é‚„ä¸ç¢ºå®šçš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ ELK åšå„ç¨®è¤‡é›œçš„æŸ¥è©¢&lt;/p&gt;
&lt;p&gt;å¦‚æœéœ€æ±‚æ˜ç¢ºï¼Œæ”¶é€²ä¾†çš„ log è™•ç†æµç¨‹éƒ½å¾ˆæ˜ç¢ºï¼Œä¹Ÿè¨±ä¸ç”¨ä½¿ç”¨ ELKã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è«–ç³»çµ±è³‡æº CP å€¼ä»¥åŠæ•ˆèƒ½ï¼Œtime series çš„ db éƒ½æœƒæ¯” Elasticsearch å¥½ä¸Šä¸å°‘ã€‚&lt;/li&gt;
&lt;li&gt;Elasticsearch ä¸­ä¹Ÿä¸å¤ªé©åˆä¸€ç›´å­˜æ”¾å¤§é‡çš„è³‡æ–™åœ¨ hot å¯å¯«å¯è®€ç‹€æ…‹ï¼Œç¹ªå¸Œå¥½å¾ˆå¤šç³»çµ±è³‡æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…¶ä»–æœå‹™&#34;&gt;å…¶ä»–æœå‹™&lt;/h1&gt;
&lt;p&gt;Elastic æœ‰å‡ºè¨±å¤šä¸åŒçš„å¢å€¼æœå‹™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Application Performance Monitoring(APM)&lt;/li&gt;
&lt;li&gt;Realtime User Monitoring(RUM)&lt;/li&gt;
&lt;li&gt;Machine Learning(ELK ML)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œ ELK ä»¥å¤–ä¹Ÿéƒ½æœ‰ä¸åŒçš„è§£æ±ºæ–¹æ¡ˆï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCP ä¹Ÿå‡ºäº†è‡ªå·±çš„ APM Sass&lt;/li&gt;
&lt;li&gt;Google Analytics(GA) ä¸åƒ…èƒ½åšå¤šæ¨£çš„å‰ç«¯ä½¿ç”¨è€…è¡Œç‚ºåˆ†æï¼Œé‚„èƒ½æ•´åˆ Google æ”¶é›†åˆ°çš„ä½¿ç”¨è€…è¡Œç‚ºï¼Œåšæ›´å¤šç¶­åº¦çš„åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›¸è¼ƒä¹‹ä¸‹ ELK åœ¨é€™å¡Šå…¶å¯¦æ²’æœ‰ç‰¹åˆ¥å„ªå‹¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;elastic-cloud&#34;&gt;Elastic Cloud&lt;/h1&gt;
&lt;p&gt;æˆ‘é€™é‚Šè¦ç‰¹åˆ¥èªª Elastic Cloud vs ELK&lt;/p&gt;
&lt;p&gt;Elatic Cloud çš„é‹è¡Œæ–¹å¼ï¼Œæ˜¯ä»£ç‚ºå‘å…¬èˆ‡æ©å¹³å°(aaws, gcp,&amp;hellip;)ï¼Œå¸¶å®¢æˆ¶å‘å¹³å°ç§Ÿç”¨æ©Ÿå™¨ï¼Œç„¶å¾ŒæŠŠ ELK æœå‹™éƒ¨ç½²åˆ°ç§Ÿç”¨çš„æ©Ÿå™¨ä¸Šã€‚ç”¨æˆ¶é€™é‚Šç„¡æ³•ç›´æ¥å­˜å–æ©Ÿå™¨ï¼Œåªèƒ½é€é ELK ä»‹é¢æˆ–æ˜¯ Kibana , API é€²å…¥ ELKã€‚Elastic Cloud æœƒç›£æ§ç„¡èª¤ç¯€é»çš„ç‹€æ³ï¼Œä¸¦åšåˆ°ä¸€å®šç¨‹åº¦çš„ä»£ç®¡ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚ŠæŒ‡çš„ä¸€å®šç¨‹åº¦çš„ä»£ç®¡ï¼Œæ˜¯ Elastic Cloud åªæ˜¯ä»£ç‚ºéƒ¨ç½²æœå‹™ï¼Œç›£æ§ã€‚æœ‰æ•…éšœæ™‚ä¸¦ä¸è² è²¬æ’é™¤ï¼Œå¦‚æœ ELK æ•…éšœï¼Œç°¡å–®çš„å•é¡Œï¼ˆex. è¨˜æ†¶é«”è³‡æºä¸è¶³ï¼‰æœƒä»£ç‚ºé‡é–‹æ©Ÿå™¨ï¼Œä½†å¦‚æœæ˜¯è¤‡é›œçš„å•é¡Œï¼Œé‚„æ˜¯è¦ç”¨æˆ¶è‡ªå·±è™•ç†ï¼ä½†æ˜¯ç”¨æˆ¶åˆæ²’æœ‰ä¸»æ©Ÿç¯€é»çš„ç›´æ¥å­˜å–æ¬Šé™ï¼Œæ‰€ä»¥å¯èƒ½æœƒé€ æˆæœå‹™å¡ä½ç„¡æ³•å•Ÿå‹•ï¼Œåªèƒ½é€é Elastic Cloud çš„ç®¡ç†ä»‹é¢å˜—è©¦ä¿®å¾©ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æœå‹™é™¤äº†æŠŠæœå‹™éƒ½æ¶è¨­å®Œä»¥å¤–ï¼Œé‚„æ˜¯éœ€è¦å®šæœŸè¦èŠ±æ™‚é–“è™•ç† performance tuningï¼Œè¨­å®šå®šæœŸæ¸…ç†è·Ÿç¶­è­·ã€‚åŒ…æ‹¬ kafka, redis, mongoDB, cassandra, SQLs&amp;hellip;éƒ½æ˜¯ä¸€æ¨£ï¼Œæ¶æ§‹è¶Šè¤‡é›œï¼Œæ•ˆèƒ½è¦æ±‚è¶Šé«˜ï¼Œé€™éƒ¨åˆ†çš„å·¥éƒ½æœƒæ›´å¤šã€‚å¦‚æœå…¬å¸æœ‰ DBAï¼Œæˆ–æ˜¯å°ˆè·ç¶­è­·å·¥ç¨‹å¸«ï¼Œé‚£æ­å–œå°±ä¸ç”¨ç…©æƒ±ã€‚&lt;/p&gt;
&lt;p&gt;Elasticsearch server ç›®å‰ç”¨èµ·ä¾†ï¼Œç®—æ˜¯æ˜¯æ•¸æœå‹™ä¸­ï¼Œç¶­è­·ä¸ŠæœƒèŠ±æ¯”è¼ƒå¤šæ™‚é–“çš„æœå‹™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºå¼•æ“æœ¬èº«è¨­è¨ˆçš„æ¶æ§‹ï¼Œä¸¦ä¸æ˜¯å¾ˆå¤šäººéƒ½ç†Ÿæ‚‰ã€‚åœ¨ä½¿ç”¨ELKåŒæ™‚ï¼Œå°ELKåº•å±¤å¼•æ“çš„é‹ä½œæµç¨‹æœ‰å¤šç†Ÿæ‚‰ï¼Œæœƒç›´æ¥å½±éŸ¿ç©©å®šæ€§è·Ÿè·‘å‡ºä¾†çš„æ•ˆèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¥½å¥½è™•ç†è¨­è¨ˆè³‡æ–™çš„å„²å­˜ï¼Œå¦‚æœä½¿ç”¨ä¸Šæ²’è™•ç†å¥½ï¼Œæœƒç›´æ¥è®“æ•´å€‹ELK æ›æ‰ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œç”¢å“æœ¬èº«çš„ç¶­è­·ä»‹é¢ï¼Œç›®å‰åªæ˜¯åœ¨å ªç”¨ï¼Œè¨±å¤šé‡è¦çš„åŠŸèƒ½ä¹Ÿé‚„åœ¨é–‹ç™¼ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå…¬å¸æœ‰äººæœƒç®¡ ELKï¼Œå€‹äººå»ºè­°æ˜¯å¯ä»¥ self-host&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¼„æ¸…æ¥šéœ€æ±‚ï¼Œå¦‚æœæ²’æœ‰ç‰¹æ®Šéœ€æ±‚å¯ä»¥èµ° general solution&lt;/li&gt;
&lt;li&gt;Sass vs Self-hosted vs On-premised&lt;/li&gt;
&lt;li&gt;Time series vs non time series&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Secure Elk Stack</title>
      <link>https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/</link>
      <pubDate>Sun, 15 Sep 2019 23:00:33 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;p&gt;ä¸Šç¯‡&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt; ä»‹ç´¹äº†ï¼Œelk stack åŸºæœ¬çš„å®‰è£ï¼Œå®‰è£å®Œç²å¾—ä¸€å€‹åªæ”¯æ´ http (è£¸å¥”)çš„ elk stackï¼Œæ²’æœ‰ https åœ¨å…¬é–‹ç¶²è·¯ä¸Šä½¿ç”¨æ˜¯éå¸¸å±éšªçš„ã€‚é€™ç¯‡è¦ä¾†ä»‹ç´¹å¦‚ä½•åšå®‰å…¨æ€§è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹çš„æ–‡ä»¶åœ¨é€™è£¡&lt;/a&gt;ï¼Œç¢å¿µä¸€ä¸‹ï¼Œé™¤éå° ELK çš„åŠŸèƒ½æœ‰ä¸€å®šäº†è§£ï¼Œä¸ç„¶é€™ä»½çœŸçš„ä¸æ˜¯å¾ˆå‹å–„ã€‚å»ºè­°å¾å®˜æ–¹æ–‡ä»¶åº•ä¸‹çš„&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/security-getting-started.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tutorial: Getting started with security&lt;/a&gt; é–‹å§‹ï¼Œéç¨‹æ¯”è¼ƒä¸æœƒé€™éº¼è¡€å°¿ã€‚&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹ç‚ºäº†å•Ÿç”¨ authentication &amp;amp; httpsï¼Œé€™ç¯‡è¦åšçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;enable x-pack &amp;amp; activate basic license&lt;/li&gt;
&lt;li&gt;Generate self-signed ca, server certificate, client certificate&lt;/li&gt;
&lt;li&gt;Configure Elasticsearch, Kibana, &amp;amp; other components to
&lt;ul&gt;
&lt;li&gt;use server certificate when act as server&lt;/li&gt;
&lt;li&gt;use client certificate when connect to an ELK server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;å•Ÿç”¨-x-pack&#34;&gt;å•Ÿç”¨ X-pack&lt;/h1&gt;
&lt;p&gt;Elasticsearch çš„å®‰å…¨æ€§æ¨¡çµ„ç”± x-pack extension æä¾›ï¼Œåœ¨ &lt;a href=&#34;https://www.elastic.co/what-is/open-x-pack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;6.3.0 ä¹‹å¾Œçš„ç‰ˆæœ¬&lt;/a&gt;ï¼Œå®‰è£ elasticsearch çš„éç¨‹ä¸­å°±é è¨­å®‰è£ x-packã€‚&lt;/p&gt;
&lt;p&gt;é™„ä¸Š&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/get-started-enable-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•Ÿç”¨çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œç”±æ–¼èˆŠç‰ˆçš„ x-pack æ˜¯ä»˜è²»å…§å®¹ï¼Œç›®å‰çš„ elasticsearch å®‰è£å®Œå¾Œï¼Œelasticsearch.yml è¨­å®šé è¨­ä¸å•Ÿç”¨ x-packï¼Œä¹Ÿå°±æ˜¯èªªæ²’çœ‹åˆ°é€™ç¯‡å®˜æ–¹æ–‡ä»¶çš„è©±ï¼Œå¾ˆå®¹æ˜“å°±ç²å¾—æ²’æœ‰ä»»ä½• security åŠŸèƒ½çš„ ELKã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶ç›®å‰å·²ç¶“å¯ä»¥ä½¿ç”¨å…è²»çš„ basic license ä½¿ç”¨ security åŠŸèƒ½ï¼Œé‚„æ˜¯å¸Œæœ›å®˜æ–¹å¯ä»¥ default å•Ÿç”¨ securityã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.license.self_generated.type: basic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery.type: single-node
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å€‘é€™é‚Šå•Ÿç”¨ xpack.securityï¼ŒåŒæ™‚å°‡ self-generated license ç”Ÿå‡ºä¾†ï¼Œæˆ‘å€‘é€™é‚Šåªä½¿ç”¨åŸºæœ¬çš„ basic subscriptionã€‚è‹¥å¸Œæœ›å•Ÿç”¨æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥çœ‹&lt;a href=&#34;https://www.elastic.co/cn/subscriptions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹subcription æ–¹æ¡ˆä»‹ç´¹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœä¸åŒæ™‚è¨­å®šç‚º single-node çš„è©±ï¼Œé è¨­æœƒå°‹æ‰¾å…¶ä»–elasticsearch node ä¾†çµ„æˆ clusterï¼Œè€Œæˆ‘å€‘å°±å¿…é ˆè¦åœ¨æ‰€æœ‰ node ä¸Šå•Ÿç”¨ securityï¼Œé€™ç¯‡åªå¸¶å¤§å®¶åšä¸€å€‹ single node clusterï¼Œç°¡åŒ–æ­¥é©Ÿã€‚&lt;/p&gt;
&lt;p&gt;é‡å•Ÿ elasticsearch ï¼Œæª¢æŸ¥ logï¼Œçœ‹å•Ÿå‹•æ™‚æœ‰æ²’æœ‰è¼‰å…¥ x-pack&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tail -f /var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:49,467][INFO ][o.e.e.NodeEnvironment    ] [elk] using [1] data paths, mounts [[/mnt/disks/elk (/dev/sdb)]], net usable_space [423.6gb], net total_space [491.1gb], types [ext4]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:49,474][INFO ][o.e.e.NodeEnvironment    ] [elk] heap size [3.9gb], compressed ordinary object pointers [true]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:50,858][INFO ][o.e.n.Node               ] [elk] node name [elk], node ID [pC22j9D4R6uiCM7oTc1Fiw], cluster name [elasticsearch]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:50,866][INFO ][o.e.n.Node               ] [elk] version[7.3.1], pid[17189], build[default/deb/4749ba6/2019-08-19T20:19:25.651794Z], OS[Linux/4.15.0-1040-gcp/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/12.0.2/12.0.2+10]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:50,878][INFO ][o.e.n.Node               ] [elk] JVM home [/usr/share/elasticsearch/jdk]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,108][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-ccr]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,109][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-core]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,111][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-logstash]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,113][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-voting-only-node]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,114][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-watcher]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,115][INFO ][o.e.p.PluginsService     ] [elk] no plugins loaded
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:07,964][INFO ][o.e.x.s.a.s.FileRolesStore] [elk] parsed [0] roles from file [/etc/elasticsearch/roles.yml]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:10,369][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [elk] [controller/17314] [Main.cc@110] controller (64 bit): Version 7.3.1 (Build 1d93901e09ef43) Copyright (c) 2019 Elasticsearch BV
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:11,776][DEBUG][o.e.a.ActionModule       ] [elk] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:14,396][INFO ][o.e.d.DiscoveryModule    ] [elk] using discovery type [single-node] and seed hosts providers [settings]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,222][INFO ][o.e.n.Node               ] [elk] initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,224][INFO ][o.e.n.Node               ] [elk] starting ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,821][INFO ][o.e.t.TransportService   ] [elk] publish_address {10.140.0.10:9300}, bound_addresses {[::]:9300}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,872][INFO ][o.e.c.c.Coordinator      ] [elk] cluster UUID [1CB6_Lt-TUWEmRoN9SE49w]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,088][INFO ][o.e.c.s.MasterService    ] [elk] elected-as-master ([1] nodes joined)[{elk}{pC22j9D4R6uiCM7oTc1Fiw}{Os-2FBjgSTOd1G_I3QYwVQ}{10.140.0.10}{10.140.0.10:9300}{dim}{ml.machine_memory=7836028928, xpack.installed=true, ml.max_open_jobs=20} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 9, version: 921, reason: master node changed {previous [], current [{elk}{pC22j9D4R6uiCM7oTc1Fiw}{Os-2FBjgSTOd1G_I3QYwVQ}{10.140.0.10}{10.140.0.10:9300}{dim}{ml.machine_memory=7836028928, xpack.installed=true, ml.max_open_jobs=20}]}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,819][INFO ][o.e.c.s.ClusterApplierService] [elk] master node changed {previous [], current [{elk}{pC22j9D4R6uiCM7oTc1Fiw}{Os-2FBjgSTOd1G_I3QYwVQ}{10.140.0.10}{10.140.0.10:9300}{dim}{ml.machine_memory=7836028928, xpack.installed=true, ml.max_open_jobs=20}]}, term: 9, version: 921, reason: Publication{term=9, version=921}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,974][INFO ][o.e.h.AbstractHttpServerTransport] [elk] publish_address {10.140.0.10:9200}, bound_addresses {[::]:9200}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,975][INFO ][o.e.n.Node               ] [elk] started
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:18,455][INFO ][o.e.c.s.ClusterSettings  ] [elk] updating [xpack.monitoring.collection.enabled] from [false] to [true]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:22,555][INFO ][o.e.l.LicenseService     ] [elk] license [************************************] mode [basic] - valid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:22,557][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [elk] Active license is now [BASIC]; Security is enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;enable-user-authentication&#34;&gt;Enable user authentication&lt;/h1&gt;
&lt;p&gt;å•Ÿç”¨ security ä¹‹å‰ï¼Œæˆ‘å€‘ç›´æ¥é€£å…¥ Kibana http://10.140.0.10:5601 ï¼Œä¸ç”¨ä»»ä½•ä½¿ç”¨è€…ç™»å…¥ï¼Œä¾¿å¯ä»¥å®Œæ•´ä½¿ç”¨ Kibana åŠŸèƒ½ï¼ˆåŒ…å« admin ç®¡ç†ä»‹é¢ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å•Ÿç”¨ security å¾Œï¼Œä¾¿éœ€è¦ä½¿ç”¨å¸³è™Ÿå¯†ç¢¼ç™»å…¥ã€‚åœ¨é€™é‚Šå…ˆç”¨å·¥å…·æŠŠä½¿ç”¨è€…å¯†ç¢¼ç”¢ç”Ÿå‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# äº’å‹•å¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# è‡ªå‹•ç”¢ç”Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯†ç¢¼ç”Ÿå‡ºä¾†å¾Œï¼Œå°±æŠŠå¸³è™Ÿå¯†ç¢¼æ”¶å¥½ï¼Œç­‰ç­‰æœƒç”¨åˆ°ã€‚ä¹‹å¾Œåˆæ¬¡ç™»å…¥ä¹Ÿæ˜¯ä½¿ç”¨é€™äº›å¯†ç¢¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;configure-passwords-on-client-side&#34;&gt;Configure passwords on client-side&lt;/h1&gt;
&lt;p&gt;ç”±æ–¼å·²ç¶“å•Ÿç”¨ authenticationï¼Œå…¶ä»– ELK å…ƒä»¶ (Kibana, logstash, filebeat, apm-server,&amp;hellip;) é€£å…¥ Elasticsearch ä¹Ÿéƒ½æœƒéœ€è¦å„è‡ªçš„å¸³è™Ÿå¯†ç¢¼é©—è­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ Kibana ç‚ºä¾‹ï¼Œå¯ä»¥ç›´æ¥åœ¨ kibana.yml ä¸­ç›´æ¥è¨­å®šå¸³è™Ÿå¯†ç¢¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/kibana/kibana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.hosts: [&amp;#34;http://localhost:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.username: &amp;#34;kibana&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.password: &amp;#34;***********&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç•¶ç„¶ï¼Œé€™é‚Šå°±æ˜¯æ˜ç¢¼çš„ï¼Œçœ‹äº†ä¸å¤ªå®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–æ˜¯ä½¿ç”¨ keystore æŠŠ built-in user çš„å¯†ç¢¼åŠ å¯†ï¼Œå­˜åœ¨ kibana çš„ keystore è£¡é¢ï¼Œé‡å•Ÿ kibana æ™‚ä¾¿æœƒè¼‰å…¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/kibana/bin/kibana-keystore create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/kibana/bin/kibana-keystore add elasticsearch.username
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/kibana/bin/kibana-keystore add elasticsearch.password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å•Ÿç”¨ Filebeat åŠŸèƒ½ï¼Œbeat å…ƒä»¶é€£å…¥ elasticsearch ä¸€æ¨£éœ€è¦è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/filebeat keystore create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/filebeat add elasticsearch.username
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/filebeat add elasticsearch.password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å•Ÿç”¨ application performance monitoring(APM) åŠŸèƒ½ï¼Œapm-server å…ƒä»¶é€£å…¥ elasticsearch ä¸€æ¨£éœ€è¦è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/apm-server keystore create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/apm-server add elasticsearch.username
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/apm-server add elasticsearch.password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;encrypting-communications&#34;&gt;Encrypting Communications&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢åŠ äº† username/password authenticationï¼Œä½†å¦‚æœæ²’ https/tls åŸºæœ¬ä¸Šé‚„æ˜¯è£¸å¥”ã€‚æ¥ä¸‹ä¾†è¦è™•ç†é€£ç·šåŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/encrypting-internode-communications.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹ tutorial&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å †å®˜æ–¹æ–‡ä»¶ï¼Œæˆ‘å€‘å…ˆè·³éXD&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;elasticsearch security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/ssl-tls.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;elastic stack ssl tls&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.3/configuring-tls.html#configuring-tls&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;elasticsearch configuring tls&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.3/certutil.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;certutil&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åˆ†æä¸€ä¸‹éœ€æ±‚è·Ÿè¦æ ¼&#34;&gt;åˆ†æä¸€ä¸‹éœ€æ±‚è·Ÿè¦æ ¼&lt;/h1&gt;
&lt;p&gt;æˆ‘å€‘éœ€è¦ç‚ºæ¯ä¸€å€‹ node ç”Ÿä¸€çµ„ node certificateï¼Œä½¿ç”¨ node certificate ç”¢ç”Ÿ client certificates æä¾›çµ¦å…¶ä»– clientï¼Œé€£å…¥æ™‚æœƒé©—è­‰ client æ˜¯å¦ç‚º authenticated userã€‚&lt;/p&gt;
&lt;p&gt;é‡å°ç›®å‰é€™å€‹ single-node ELK stackï¼Œæˆ‘å€‘å¯èƒ½æœ‰å¹¾ç¨®é¸æ“‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°½ç½²ä¸€å€‹ localhostï¼Œç•¶ç„¶é€™å€‹åªèƒ½åœ¨ localhost ä¸Šçš„å®¢æˆ¶ç«¯å…ƒä»¶ä½¿ç”¨ï¼Œåˆ¥çš„ node ç„¡æ³•ç”¨é€™å€‹é€£å…¥&lt;/li&gt;
&lt;li&gt;ç°½ç½²ä¸€å€‹ public DNS elk.chechiachang.comï¼Œå¯ä»¥åœ¨å…¬é–‹ç¶²è·¯ä¸Šä½¿ç”¨ï¼Œåˆ¥äººä¹Ÿå¯ä»¥ä½¿ç”¨é€™å€‹DNSå˜—è©¦é€£å…¥&lt;/li&gt;
&lt;li&gt;ç°½ç½²ä¸€å€‹ç§æœ‰ç¶²åŸŸçš„ DNSï¼Œä¾‹å¦‚åœ¨ GCP ä¸Šå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://cloud.google.com/compute/docs/internal-dns?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…§éƒ¨dnsæœå‹™&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;é•·é€™æ¨£ elk.asia-east1-b.c.chechiachang.internal&lt;/li&gt;
&lt;li&gt;[INSTANCE_NAME].[ZONE].c.[PROJECT_ID].internal&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ‰éœ€è¦ä¹Ÿå¯ä»¥ä¸€ä»½ server certificate ä¸­ç°½ç½²è¤‡æ•¸å€‹ site&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šé¸æ“‡ä½¿ç”¨å…§éƒ¨ dnsï¼Œelk.asia-east1-b-c-chechaichang.internalï¼Œè®“é€™å€‹ single-node elk åªèƒ½é€éå…§éƒ¨ç¶²è·¯å­˜å–ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;elasticsearch: elk.asia-east1-b.c.chechaichang.internal:9200&lt;/li&gt;
&lt;li&gt;kibana: elk.asia-east1-b.c.chechaichang.internal:5601&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨è¦é€£è¿‘ä¾† kibanaï¼Œæˆ‘å€‘ä½¿ç”¨ vpn æœå‹™é€£é€²ç§æœ‰ç¶²è·¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæƒ³ä½¿ç”¨å¤–éƒ¨ dnsï¼Œè®“ elk stack åœ¨å…¬é–‹ç¶²è·¯å¯ä»¥ä½¿ç”¨ï¼Œex. elk.chechiachang.comï¼Œå¯ä»¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCP çš„ load balanceræ›é€²ä¾†ï¼Œç”¨ GCP çš„ certificate manager è‡ªå‹•ç®¡ç† certificate&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯åœ¨ node ä¸Šé–‹ä¸€å€‹ nginx serverï¼Œå†æŠŠ certificate ç”¨ certbot ç”Ÿå‡ºä¾†&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;generate-certificates&#34;&gt;Generate certificates&lt;/h1&gt;
&lt;p&gt;å…ˆæŠŠ X.509 digital certificate çš„ certificate authority(CA) ç”Ÿå‡ºä¾†ã€‚æˆ‘å€‘å¯ä»¥è¨­å®šå¯†ç¢¼ä¿è­·é€™å€‹æª”æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/elasticsearch/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# CA generated with Elastic tool
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-certutil ca \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -out /etc/elasticsearch/config/elastic-stack-ca.p12
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”Ÿå‡ºä¾†æ˜¯ PKCS#12 æ ¼å¼çš„ keystoreï¼ŒåŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CA çš„ public certificate&lt;/li&gt;
&lt;li&gt;CA çš„åŸºæœ¬è³‡è¨Š&lt;/li&gt;
&lt;li&gt;ç°½ç½²å…¶ä»– node certificates ä½¿ç”¨çš„ç§é‘°(private key)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨ openssl å·¥å…·çœ‹ä¸€ä¸‹å…§å®¹ï¼Œå¦‚æœæœ‰å¯†ç¢¼é€™é‚Šè¦ç”¨å¯†ç¢¼è§£é–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 -in /etc/elasticsearch/config/elastic-stack-ca.p12 -info -nokeys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™„å¸¶èªªæ˜ï¼ŒX.509 æœ‰å¤šç¨®æª”æ¡ˆæ ¼å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.pem&lt;/li&gt;
&lt;li&gt;.cer, .crt, .der&lt;/li&gt;
&lt;li&gt;.p12&lt;/li&gt;
&lt;li&gt;.p7b, .p7c&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–æª”æ¡ˆæ ¼å¼å¯ä»¥æœ‰å…¶ä»–ç”¨é€”ï¼Œä¹Ÿå°±æ˜¯èªªè£¡é¢è£çš„ä¸ä¸€å®šæ˜¯ X.509 æ†‘è­‰ã€‚è£¡é¢çš„å…§å®¹ä¹Ÿä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ELK è¨­å®šçš„éç¨‹ä¸­ï¼Œç”±æ–¼ä¸æ˜¯æ‰€æœ‰çš„ ELK component éƒ½æ”¯æ´ä½¿ç”¨ .p12 æª”æ¡ˆï¼Œæˆ‘å€‘åœ¨è¨­å®šéç¨‹ä¸­æœƒäº’ç›¸å°ˆæ›ï¼Œæˆ–æ˜¯æ··ç”¨å¤šç¨®æª”æ¡ˆæ ¼å¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;generate-certificate&#34;&gt;Generate certificate&lt;/h1&gt;
&lt;p&gt;&amp;laquo;&amp;laquo;&amp;laquo;&amp;lt; HEAD&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ç”¨ elastic-stack-ca.p12 é€™çµ„ keystoreè£¡é¢çš„ CA èˆ‡ private keyï¼Œç‚º elk.asia-east1-b.c.chechiachang.internal ç°½ä¸€å€‹ p12 keystoreï¼Œè£¡é¢æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node certificate&lt;/li&gt;
&lt;li&gt;node key&lt;/li&gt;
&lt;li&gt;CA certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šåªç”¢ç”Ÿä¸€çµ„ server certificate çµ¦ single-node cluster çš„ node-1&lt;/p&gt;
&lt;p&gt;=======&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ç”¨ elastic-stack-ca.p12 é€™çµ„ keystoreè£¡é¢çš„ CA èˆ‡ private keyï¼Œç‚º elk.asia-east1-b.c.chechiachang.internal ç°½ä¸€å€‹ p12 keystoreï¼Œè£¡é¢æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node certificate&lt;/li&gt;
&lt;li&gt;node key&lt;/li&gt;
&lt;li&gt;CA certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šåªç”¢ç”Ÿä¸€çµ„ server certificate çµ¦ single-node cluster çš„ node-1&lt;/p&gt;
&lt;p&gt;å¦‚æœ cluster ä¸­æœ‰å¤šå€‹ elasticsearchï¼Œç‚ºæ¯å€‹ node ç”¢ç”Ÿ certificate æ™‚éƒ½è¦ä½¿ç”¨åŒæ¨£ CA ä¾†ç°½ç½²ï¼Œè®“ server ä¿¡ä»»é€™çµ„ CAã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ elasticsearch-certutil ç°¡åŒ–ç°½ç½²éç¨‹ï¼Œå¾ç”¢ç”Ÿ CA ï¼Œåˆ°ä½¿ç”¨ CA ç°½ç½² certificateã€‚å¦å¤–ï¼Œå†ç”¢ç”Ÿ certificate ä¸­ä½¿ç”¨ Subject Alternative Name(SAN)ï¼Œä¸¦è¼¸å…¥ ip èˆ‡ dnsã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# certificate for site: private dns with Elastic CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-certutil cert \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --ca /etc/elasticsearch/config/elastic-stack-ca.p12 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --name elk.asia-east1-b.c.chechaichang.internal \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --dns elk.asia-east1-b.c.chechaichang.internal \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --ip 10.140.0.10 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -out /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”¨ openssl çœ‹ä¸€ä¸‹å…§å®¹ï¼Œå¦‚æœæœ‰å¯†ç¢¼é€™é‚Šè¦ç”¨å¯†ç¢¼è§£é–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -info -nokeys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;server ç”¨é€™å€‹ certificate ï¼Œå•Ÿç”¨ sslã€‚&lt;/p&gt;
&lt;p&gt;client ä½¿ç”¨é€™å€‹ certificate ç”¢ç”Ÿå‡ºä¾†çš„ client.cer èˆ‡ client.key èˆ‡ server é€£ç·šï¼Œserver æ‰æ¥å—å®¢æˆ¶ç«¯æ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;25f5ab795b9e698333a36fde7ecf23a8ba9d4595
è¨˜å¾—æŠŠæ‰€æœ‰æ¬Šé‚„çµ¦ elasticsearch çš„ä½¿ç”¨è€…ï¼Œé¿å… permission denied&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Change owner to fix read permission
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown -R elasticsearch:elasticsearch /etc/elasticsearch/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰å¯†ç¢¼è¨˜å¾—ä¹Ÿè¦ç”¨ keystore æŠŠå¯†ç¢¼åŠ å¯†å¾Œå–‚çµ¦ elasticsearch&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é—œæ–¼ X.509 Certifcate ä¹‹å¾Œæœ‰ç©ºæˆ‘å€‘ä¾†èŠä¸€ä¸‹&lt;/p&gt;
&lt;h1 id=&#34;æ›´æ–°-elasticsearch-è¨­å®š&#34;&gt;æ›´æ–° elasticsearch è¨­å®š&lt;/h1&gt;
&lt;p&gt;Certificates éƒ½ç”Ÿå®Œäº†ï¼Œæ¥ä¸‹ä¾†æ›´æ”¹ elasticsearch çš„åƒæ•¸ï¼Œåœ¨ transport layer å•Ÿç”¨ sslã€‚å•Ÿç”¨ security å¾Œï¼Œåœ¨ transport layer å•Ÿå‹• ssl æ˜¯å¿…é ˆçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# use certificate. full will verify dns and ip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.verification_mode: certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.keystore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.truststore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿç”¨ security èˆ‡ transport layer çš„ sslï¼Œç„¶å¾ŒæŒ‡å®š keystoreè·¯å¾‘ï¼Œè®“ server åŸ·è¡Œ client authentication
ç”±æ–¼é€™ç­† p12 å¸¶æœ‰ CA certificate ä½œç‚º trusted certificate entryï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é †ä¾¿ç•¶ä½œ trustoreï¼Œè®“ client ä¿¡ä»»é€™å€‹ CA&lt;/p&gt;
&lt;p&gt;security é€™é‚Šæä¾›äº† server side (elasticsearch) åœ¨æª¢æŸ¥å®¢æˆ¶ç«¯é€£ç·šæ™‚çš„æª¢æŸ¥æ¨¡å¼(vertification mode)ï¼Œ&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#ssl-tls-settings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶æœ‰èªªæ˜&lt;/a&gt;ï¼Œå¯ä»¥è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;certificate: æª¢æŸ¥ certificate åŠ å¯†æ˜¯å¦æœ‰æ•ˆ&lt;/li&gt;
&lt;li&gt;full: ç°½ node certificate æ™‚å¯ä»¥æŒ‡å®š ip dnsï¼Œå•Ÿç”¨æœƒæª¢æŸ¥ä¾†æº node ip dns æ˜¯å¦ä¹Ÿæ­£ç¢º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(Optional) HTTP layer å•Ÿå‹• ssl&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.http.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.http.ssl.keystore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.http.ssl.truststore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.truststore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å•Ÿ elasticsearchï¼Œçœ‹ä¸€ä¸‹ log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tail -f /var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œä½ å°±ç™¼ç¾ï¼ŒåŸä¾† kibana é€£å…¥ çš„ http é€£ç·šï¼Œä¸æ–·è¢« server é€™ç«¯æ‹’çµ•ã€‚æ‰€ä»¥ä»¥ä¸‹è¦ä¾†è¨­å®š kibana&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;kibana&#34;&gt;Kibana&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/kibana/7.3/using-kibana-with-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;using kibana with security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/kibana/7.3/configuring-tls.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kibana configuring tls&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨å‰›å‰›ç°½çš„ server certificateï¼Œå¾è£¡é¢ parse å‡º client-ca.cerï¼Œé‚„æœ‰ client.cer èˆ‡ client.key&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/kibana/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: pkcs12 [options]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Valid options are:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -chain              Add certificate chain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -nokeys             Don&amp;#39;t output private keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -nocerts            Don&amp;#39;t output certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -clcerts            Only output client certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -cacerts            Only output CA certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -info               Print info about PKCS#12 structure
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -nodes              Don&amp;#39;t encrypt private keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -in infile          Input filename
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# no certs, no descript
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &amp;gt; /etc/kibana/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &amp;gt; /etc/kibana/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &amp;gt; /etc/kibana/config/client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo chown -R kibana:kibana /etc/kibana/config/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›´æ”¹ kibana é€£å…¥ elasticsearch çš„é€£ç·šè¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/kigana/kibana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.hosts: [&amp;#34;https://elk.asia-east1-b.c.chechaichang.internal:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.certificate: /etc/kibana/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.key: /etc/kibana/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.certificateAuthorities: [ &amp;#34;/etc/kibana/config/client-ca.cer&amp;#34; ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.verificationMode: full
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æŒ‡å®š ssl.certificate, ssl.key åšé€£ç·š elasticsearch server æ™‚çš„ user authentication&lt;/li&gt;
&lt;li&gt;ç”±æ–¼æˆ‘å€‘æ˜¯ self-signed CAï¼Œæ‰€ä»¥éœ€è¦è®“å®¢æˆ¶ç«¯ä¿¡ä»»é€™å€‹æˆ‘å€‘è‡ªç°½çš„ CA&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„é€™é‚Š elasticsearch.hosts æˆ‘å€‘å·²ç¶“å¾ http://localhost æ›æˆ https çš„å…§éƒ¨ dnsï¼ŒåŸæœ‰çš„ localhost å·²ç¶“ç„¡æ³•ä½¿ç”¨ï¼ˆå¦‚æœ elasicsearch æœ‰ enforce https çš„è©±ï¼‰&lt;/p&gt;
&lt;p&gt;é‡å•Ÿ Kibanaï¼Œçœ‹ä¸€ä¸‹ log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ²’æœ‰ä¸€ç›´å™´ ssl certificate error çš„è©±ï¼Œæ­å–œä½ æˆåŠŸäº†&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œé™¤äº† kibana ä»¥å¤–ï¼Œæˆ‘å€‘é‚„æœ‰å…¶ä»–çš„ client éœ€è¦é€£å…¥ elasticsearch&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠŠä¸Šè¿°æ­¥é©Ÿåœ¨ apm-server, filebeat, å…¶ä»–çš„ beat ä¸Šä¹Ÿè¨­å®š&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ k8s ä¸Šï¼Œè¦æŠŠ cer, key ç­‰æª”æ¡ˆç”¨ volume æ›é€²å»
&amp;laquo;&amp;laquo;&amp;laquo;&amp;lt; HEAD&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kibana æœ¬èº«ä¹Ÿæœ‰ server çš„åŠŸèƒ½ï¼Œè®“å…¶ä»– client é€£å…¥ã€‚ä¾‹å¦‚è®“ filebeat è‡ªå‹•å°‡ document tempalte åŒ¯å…¥ kibanaï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kibana server certificate&lt;/li&gt;
&lt;li&gt;filebeat client to kibana server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;=======&lt;/p&gt;
&lt;p&gt;Kibana æœ¬èº«ä¹Ÿæœ‰ server çš„åŠŸèƒ½ï¼Œè®“å…¶ä»– client é€£å…¥ã€‚ä¾‹å¦‚è®“ filebeat è‡ªå‹•å°‡ document tempalte åŒ¯å…¥ kibanaï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kibana server certificate&lt;/li&gt;
&lt;li&gt;filebeat client to kibana server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°±æ˜¯ä»–å€‘å½¼æ­¤äº’æ‰“ï¼Œéƒ½è¦æœ‰ ca, key, cert&lt;/p&gt;
&lt;h3 id=&#34;ä½†åŸºæœ¬ä¸Šçš„è¨­å®šéƒ½ä¸€æ¨£ä¸‹é¢å¯ä»¥ä¸ç”¨çœ‹ä¸‹å»äº†xd&#34;&gt;ä½†åŸºæœ¬ä¸Šçš„è¨­å®šéƒ½ä¸€æ¨£ï¼Œä¸‹é¢å¯ä»¥ä¸ç”¨çœ‹ä¸‹å»äº†XD&lt;/h3&gt;
&lt;p&gt;å¦‚æœæœ‰ç”¨åˆ°å†æŸ¥æ–‡ä»¶å°±å¥½ï¼Œé€™é‚Šç›´æ¥å°çµ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®š security å‰è¦å…ˆæƒ³è™Ÿè‡ªå·±çš„éœ€æ±‚ï¼Œå¦‚ä½•é€£å…¥ï¼Œå®‰å…¨æ€§è¨­å®šåˆ°å“ªé‚Š&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ utility è‡ªç°½ CAï¼Œç„¶å¾Œç”¢ç”Ÿ server certificate&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ server certificate å† parse å‡º ca-certificate, client cers, key&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;kibana-ä½œç‚º-server&#34;&gt;kibana ä½œç‚º server&lt;/h1&gt;
&lt;p&gt;å·¥ä½œè·¯å¾‘å¯èƒ½æ˜¯é€™æ¨£ï¼š app(apm-client library) -&amp;gt; apm-server -&amp;gt; kibana -&amp;gt; elasticsearch&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kibana é€£å…¥ elasticsearchæ™‚ï¼Œ kibana æ˜¯ client åƒ elasticsearch çš„æ†‘è­‰&lt;/li&gt;
&lt;li&gt;apm-server é€£å…¥ kibanaæ™‚ï¼Œkibana æ˜¯ serverï¼Œapm-server åƒ kibana çš„æ†‘è­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆæ›´æ”¹ kibana è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/kibana/kibana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.ssl.certificate: /etc/kibana/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.ssl.key: /etc/kibana/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å•Ÿ kibana&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;apm-server&#34;&gt;Apm-server&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/apm/server/7.3/securing-apm-server.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.elastic.co/guide/en/apm/server/7.3/securing-apm-server.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‡‰ç”¨ç«¯çš„ apm-client (ex. apm-python-client)ï¼Œé€£å…¥ apm-server&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ http çš„ç‹€æ³ä¸‹ï¼Œé›–ç„¶æœ‰ä½¿ç”¨ secret-tokenï¼Œä½†é‚„æ˜¯è£¸å¥”&lt;/li&gt;
&lt;li&gt;åœ¨ https çš„ç‹€æ³ä¸‹ï¼Œè¦æŠŠ certificatesï¼Œç„¶å¾Œé¤µçµ¦æ‡‰ç”¨ç«¯çš„client library&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´æ”¹ apm-server çš„è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/apm-server/apm-server.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;host: &amp;#34;0.0.0.0:8200&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  secret_token: &amp;lt;è¨­å®šä¸€çµ„å¤ å®‰å…¨çš„ token&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  rum:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kibana:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;https&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.kibana:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enable: false # can only have 1 output
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;monitoring.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;https&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: &amp;#34;*******************&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: [&amp;#34;elk.asia-east1-b.c.checahichang.internal:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.verification_mode: full
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.certificate_authorities: [&amp;#34;/etc/apm-server/config/client-ca.cer&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.certificate: &amp;#34;/etc/apm-server/config/client.cer&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.key: &amp;#34;/etc/apm-server/config/client.key&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å•Ÿ apm-server&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl restart apm-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu apm-server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;apm-library&#34;&gt;APM library&lt;/h1&gt;
&lt;p&gt;æ‡‰ç”¨ç«¯çš„è¨­å®šå°±éœ€è¦ä¾æ“š library çš„å¯¦åšè¨­å®šï¼Œä¾‹å¦‚ flask-apmagent-python&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ELASTIC_APM_SERVER_CERT=/etc/elk/certificates/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/apm/agent/python/current/configuration.html#config-server-cert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;apm agent python config server cert&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;filebeat&#34;&gt;filebeat&lt;/h1&gt;
&lt;p&gt;è¨˜å¾—æˆ‘å€‘åœ¨ node ä¸Šæœ‰å®‰è£ Self-monitoring filebeatï¼Œelasticsearch æ”¹æˆ ssl é€™é‚Šç•¶ç„¶ä¹Ÿé€£ä¸ç›¡å»äº†ï¼Œå†åšåŒæ¨£æ“ä½œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install filebeat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/filebeat/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &amp;gt; /etc/filebeat/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &amp;gt; /etc/filebeat/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &amp;gt; /etc/filebeat/config/client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Restart filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl restart filebeat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu filebeat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;å¦‚æœä½ çš„æ‡‰ç”¨åœ¨-kubernetes-ä¸Š&#34;&gt;å¦‚æœä½ çš„æ‡‰ç”¨åœ¨ kubernetes ä¸Š&lt;/h1&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•æ‹¿åˆ° client.cer ï¼Œç„¶å¾Œç”¨ secret å¡é€² k8sï¼Œåœ¨ç”¨ volume from secretsï¼Œæ›çµ¦ç›£æ¸¬æ‡‰ç”¨çš„ filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/beats/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &amp;gt; /etc/beats/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &amp;gt; /etc/beats/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &amp;gt; /etc/beats/config/client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud compute scp elk:/etc/beats/config/* .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n elk create secret generic elk-client-certificates \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=client-ca.cer=client-ca.cer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=client.cer=client.cer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=client.key=client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f elk/gke/filebeat/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Self-host ELK stack - Installation</title>
      <link>https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/</link>
      <pubDate>Sun, 15 Sep 2019 11:43:03 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;h1 id=&#34;ç°¡ä»‹-elk-stack&#34;&gt;ç°¡ä»‹ ELK stack&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹èªªæ˜æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;elk-çš„å…ƒä»¶&#34;&gt;ELK çš„å…ƒä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Elasticsearch: åŸºæ–¼ Lucene çš„åˆ†æ•£å¼å…¨æ–‡æœç´¢å¼•æ“&lt;/li&gt;
&lt;li&gt;Logstash: æ•¸æ“šè™•ç† pipeline&lt;/li&gt;
&lt;li&gt;Kibana: ELK stack çš„ç®¡ç†å¾Œå°èˆ‡æ•¸æ“šè¦–è¦ºåŒ–å·¥å…·&lt;/li&gt;
&lt;li&gt;Beats: è¼•é‡ç´šçš„æ‡‰ç”¨ç«¯æ•¸æ“šæ”¶é›†å™¨ï¼Œæœƒå¾è¢«ç›£æ§ç«¯æ”¶é›† log èˆ‡ç›£æ§æ•¸æ“š(metrics)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;elk-çš„å·¥ä½œæµç¨‹&#34;&gt;ELK çš„å·¥ä½œæµç¨‹&lt;/h3&gt;
&lt;p&gt;beats -&amp;gt; (logstash) -&amp;gt; elasticsearch -&amp;gt; kibana&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°‡ beats æ”¾åœ¨æ‡‰ç”¨ç«¯çš„ä¸»æ©Ÿä¸Šï¼Œæˆ–æ˜¯åœ¨å®¹å™¨åŒ–ç’°å¢ƒç¨®ä½œç‚º sidecarï¼Œè·Ÿæ‡‰ç”¨æ”¾åœ¨ä¸€èµ·&lt;/li&gt;
&lt;li&gt;è¨­å®š beats å¾æŒ‡å®šçš„è·¯å¾‘æ”¶é›† log èˆ‡ metrics&lt;/li&gt;
&lt;li&gt;è¨­å®š beats å‘å¾Œè¼¸å‡ºçš„é ç«¯ç›®æ¨™&lt;/li&gt;
&lt;li&gt;(Optional) beats è¼¸å‡ºåˆ° logstash ï¼Œå…ˆé€²è¡Œæ•¸æ“šçš„è®Šæ›´ã€æ ¼å¼æ•´ç†ï¼Œåœ¨å¾Œé€åˆ° elasticsearch&lt;/li&gt;
&lt;li&gt;beats å‘å¾Œè¼¸å‡ºåˆ° elasticsearchï¼Œå„²å­˜æ•¸æ“šæ–‡ä»¶(document)ï¼Œä¸¦ä¾ç…§æ¨£å¼(template)èˆ‡ç´¢å¼•(index)å„²å­˜ï¼Œä¾¿å¯åœ¨ elasticsearch ä¸Šå…¨æ–‡æœç´¢æ•¸æ“š&lt;/li&gt;
&lt;li&gt;é€é Kibanaï¼Œå°‡ elasticsearch ä¸Šçš„ log é¡¯ç¤º&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å®˜æ–¹ä¸æ˜¯æœ‰å‡ºæ–‡ä»¶å—&#34;&gt;å®˜æ–¹ä¸æ˜¯æœ‰å‡ºæ–‡ä»¶å—&lt;/h1&gt;
&lt;p&gt;Elastic å®˜æ–¹æº–å‚™äº†å¤§é‡çš„æ–‡ä»¶ï¼Œç†è«–ä¸Šè¦è·Ÿè‘—æ–‡ä»¶ä¸€æ­¥ä¸€æ­¥æ¶è¨­é€™æ•´å¥—å·¥å…·æ‡‰è©²æ˜¯ååˆ†å®¹æ˜“ã€‚ç„¶è€Œå¯¦éš›ç…§è‘—åšå»é‡ä¸Šå¾ˆå¤šå›°é›£ã€‚ç”±æ–¼ç¼ºä¹ get-started çš„ç¯„ä¾‹æ–‡ä»¶ï¼Œä¸ç†Ÿæ‚‰ ELK è¨­å®šçš„ä½¿ç”¨è€…ï¼Œå¸¸å¸¸éœ€è¦åœä¸‹ä¾†é™¤éŒ¯ï¼Œç”šè‡³å› ç‚ºæ¼æ‰æŸå€‹æ­¥é©Ÿï¼Œè€Œéœ€è¦å›é ­é‡åšä¸€éã€‚&lt;/p&gt;
&lt;p&gt;èªªç©¿äº†æœ¬ç¯‡çš„æŠ€è¡“å«é‡ä¸é«˜ï¼Œå°±åªæ˜¯ä¸€å€‹è¸©é›·éç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Lets get our hands dirty.&lt;/p&gt;
&lt;h1 id=&#34;warning&#34;&gt;WARNING&lt;/h1&gt;
&lt;p&gt;é€™ç¯‡å®‰è£éç¨‹æ²’æœ‰åšå®‰å…¨æ€§è¨­å®šï¼Œç”±æ–¼ ELK stack çš„å®‰å…¨æ€§åŠŸèƒ½æ¨¡çµ„ï¼Œåœ¨&lt;a href=&#34;https://www.elastic.co/what-is/open-x-pack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v6.3.0 ä»¥å‰çš„ç‰ˆæœ¬æ˜¯ä¸åŒ…å«å®‰å…¨æ€§æ¨¡çµ„çš„&lt;/a&gt;ï¼Œå®˜æ–¹çš„å®‰è£èªªæ˜æ–‡ä»¶å°‡å®‰å…¨æ€§è¨­å®šå¦æˆä¸€ç¯‡ã€‚æˆ‘ç¬¬ä¸€æ¬¡å®‰è£ï¼Œå…¨éƒ¨å®‰è£å®Œå¾Œï¼Œæ‰ç™¼ç¾è£é ­æ²’æœ‰ä»»ä½•å®‰å…¨æ€§è¨­å®šï¼ŒåŒ…å«å¸³è™Ÿå¯†ç¢¼ç™»å…¥ã€api secret tokenã€https/tls é€šé€šæ²’æœ‰ï¼Œæ•´çµ„ elk è£¸å¥”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘é€™é‚Šåˆ†é–‹çš„ç›®çš„ï¼Œä¸æ˜¯è®“å¤§å®¶éƒ½è·Ÿæˆ‘ä¸€æ¨£è¢«é›·(XD)ï¼Œè€Œæ˜¯å› ç‚º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦èµ·ä¸€ç¯‡å°å®‰å…¨æ€§è¨­å®šå¤šåŠ èªªæ˜&lt;/li&gt;
&lt;li&gt;åœ¨å®‰å…¨çš„å…§ç¶²ä¸­ï¼Œæ²’æœ‰å®‰å…¨æ€§è¨­å®šï¼Œå¯ä»¥å¤§å¹…åŠ é€Ÿé–‹ç™¼èˆ‡é™¤éŒ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é›–ç„¶æ²’æœ‰å®‰å…¨æ€§è¨­å®šï¼Œä½†ä»ç„¶æœ‰å®Œæ•´çš„åŠŸèƒ½ï¼Œå¦‚æœåªæ˜¯åœ¨æ¸¬è©¦ç’°å¢ƒï¼Œæˆ–æ˜¯æƒ³è¦è©•ä¼°è©¦ç”¨ self-hosted ELKï¼Œé€™ç¯‡çš„èªªæ˜å·²è¶³å¤ ã€‚ä½†åƒè¬ä¸è¦ç”¨é€™ç¯‡ä¸Š public network æˆ–æ˜¯ç”¨åœ¨ production ç’°å¢ƒå–”ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå¸Œæœ›ç¬¬ä¸€æ¬¡å®‰è£å°±æœ‰å®Œæ•´çš„ security è¨­å®šï¼Œè«‹ç­‰å¾…ä¸‹ç¯‡ &lt;a href=&#34;#secure-elk-stack&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;è¨è«–éœ€æ±‚èˆ‡è¦æ ¼&#34;&gt;è¨è«–éœ€æ±‚èˆ‡è¦æ ¼&lt;/h1&gt;
&lt;p&gt;é€™é‚Šåªæ˜¯å¸¶å¤§å®¶éä¸€ä¸‹åŸºç¤å®‰è£æµç¨‹ï¼Œæˆ‘å€‘åœ¨ç§æœ‰ç¶²è·¯ä¸­æ­å»ºä¸€å° standalone çš„ ELK stackï¼Œé€šé€šæ”¾åœ¨ä¸€å°ç¯€é»(node)ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elk-node-standalone 10.140.0.10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;app-node-1          10.140.0.11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...                 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ¬æ©Ÿçš„ ELK stack å…ƒä»¶ï¼Œå½¼æ­¤é€é localhost é€£ç·š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Elasticsearch:  localhost:9200&lt;/li&gt;
&lt;li&gt;Kibana:         localhost:5601&lt;/li&gt;
&lt;li&gt;Apm-server:     localhost:8200&lt;/li&gt;
&lt;li&gt;Self Monitoring Services&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç§æœ‰ç¶²è·¯ä¸­çš„å¤–éƒ¨æœå‹™é€é 10.140.0.10&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;beats å¾å…¶ä»– node è¼¸å‡ºåˆ° Elasticsearch: 10.140.0.10:9200&lt;/li&gt;
&lt;li&gt;beats å¾å…¶ä»– node è¼¸å‡ºåˆ° Apm-server:    10.140.0.10:8200&lt;/li&gt;
&lt;li&gt;åœ¨å…§éƒ¨ç¶²è·¯ä¸­ é€é browser å­˜å– Kibana:  10.140.0.10:5601&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;standalone çš„å¥½è™•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–¹ä¾¿ (å†æ¬¡å¼·èª¿é€™ç¯‡åªæ˜¯ç¤ºç¯„ï¼Œå¯¦å‹™ä¸Šä¸è¦è²ªä¸€æ™‚æ–¹ä¾¿ï¼Œç¶­é‹å´©æ½°)&lt;/li&gt;
&lt;li&gt;æœ€ç°¡åŒ–è¨­å®šï¼ŒELK æœ‰éå¸¸å¤§é‡çš„è¨­å®šå¯ä»¥èª¿æ•´ï¼Œé€™ç¯‡ç°¡åŒ–äº†å¤§éƒ¨åˆ†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Standaloneå¯èƒ½é€ æˆçš„å•é¡Œ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;No High Availablity: æ²’æœ‰ä»»ä½•å®¹éŒ¯å‚™æ´å¯ä»¥ failoverï¼Œé€™å°æ›å°±å…¨æ›&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨æœå‹™å¤šçš„è©±ï¼Œå¾ˆå®¹æ˜“å°±è¶…é node ä¸Šå°æ–¼ç¶²è·¯å­˜å–çš„é™åˆ¶ï¼Œé€ æˆ tcp drop æˆ– delayã€‚éœ€è¦èª¿æ•´ ulimit ä¾†å¢åŠ ç¶²è·¯ï¼Œç•¶ç„¶é€™åœ¨é›²ç«¯ä¸Šæœƒçµ¦ç¶­é‹å¸¶ä¾†æ›´å¤šéº»ç…©ï¼Œä¸æ˜¯ä¸€å€‹å¥½è§£æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¦æœ‰ production ready çš„ ELK&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HA é–‹èµ·ä¾†&lt;/li&gt;
&lt;li&gt;æŠŠæœå‹™åˆ†æ•£åˆ°ä¸åŒ node ä¸Š, æ–¹ä¾¿ä¹‹å¾Œ scale out å¤šé–‹å¹¾å°
&lt;ul&gt;
&lt;li&gt;elasticsearch-1, elasticsearch-2, elasticsearch-3&amp;hellip;&lt;/li&gt;
&lt;li&gt;kibana-1&lt;/li&gt;
&lt;li&gt;apm-server-1, apm-server-2, &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‡‰ç”¨åœ¨å·²ç¶“å®¹å™¨åŒ–, é€™äº›æœå‹™å…ƒä»¶ä¹Ÿå¯ä»¥ä¸Š Kubernetes åšå®¹å™¨è‡ªå‹•åŒ–ï¼Œé€™å€‹éƒ¨ä»½è »å¥½ç©ï¼Œå¦‚æœæœ‰æ™‚é–“æˆ‘å€‘ä¾†èŠé€™ç¯‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸»æ©Ÿè¨­å®š&#34;&gt;ä¸»æ©Ÿè¨­å®š&lt;/h1&gt;
&lt;p&gt;Elasticsearch å„²å­˜æ•¸æ“šæœƒä½”ç”¨ä¸å°‘ç¡¬ç¢Ÿç©ºé–“ï¼Œæˆ‘å€‹äººçš„ç¿’æ…£æ˜¯åªè¦æœ‰é¡å¤–å ç”¨å„²å­˜ç©ºé–“ï¼Œéƒ½è¦å¦å¤–æ›è¼‰ç¡¬ç¢Ÿï¼Œä¸è¦å ç”¨ rootï¼Œæ‰€ä»¥é€™é‚Šæœƒéœ€è¦å¦å¤–æ›è¼‰ç¡¬ç¢Ÿã€‚&lt;/p&gt;
&lt;p&gt;GCP ä¸Šä½¿ç”¨ Google Compote Engine çš„æœ‹å‹ï¼Œå¯ä»¥ç…§ &lt;a href=&#34;https://cloud.google.com/compute/docs/disks/add-persistent-disk?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google å®˜æ–¹æ“ä½œæ­¥é©Ÿæ“ä½œ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®Œæˆå¾Œæ¥è¿‘é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ df -h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ df --human-readable
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Filesystem      Size  Used Avail Use% Mounted on
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/sda1       9.6G  8.9G  682M  93% /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/sdb        492G   63G  429G  13% /mnt/disks/elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /mnt/disks/elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/mnt/disks/elk/apm-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/mnt/disks/elk/kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡³æ–¼éœ€è¦å¤šå°‘å®¹é‡ï¼Œå–æ±ºæ”¶é›†æ•¸æ“šçš„æ•¸é‡ï¼Œè½å·®éå¸¸å¤§ï¼Œå¯ä»¥å…ˆä¸Šå€‹ 100Gb ï¼Œè©¦è·‘ä¸€æ®µæ™‚é–“ï¼Œå†è¦–æƒ…æ³ scale storage diskã€‚&lt;/p&gt;
&lt;h1 id=&#34;é–‹é˜²ç«ç‰†&#34;&gt;é–‹é˜²ç«ç‰†&lt;/h1&gt;
&lt;p&gt;éœ€è¦é–‹æ”¾ 10.140.0.10 é€™å°æ©Ÿå™¨çš„å¹¾å€‹ port&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;elasticsearch           :9200   ä¾†æºåªé–‹æ”¾ç§æœ‰ç¶²è·¯å…¶ä»– ip 10.140.0.0/9&lt;/li&gt;
&lt;li&gt;apm-server              :8200   (åŒä¸Š)&lt;/li&gt;
&lt;li&gt;kibana                  :5601   (åŒä¸Š)ï¼Œå¦‚æœæƒ³å¾å¤–éƒ¨é€é browseré–‹ï¼Œéœ€è¦ whitelist ip&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GCP ä¸Šæœ‰ default çš„é˜²ç«ç‰†å…è¨±è¦å‰‡ï¼Œç§æœ‰ç¶²è·¯å¯ä»¥å½¼æ­¤é€£ç·š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;default-allow-internal: :all    :10.140.0.0/9   tcp:0-65535&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;install-elasticsearch&#34;&gt;Install Elasticsearch&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.3/install-elasticsearch.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Install Elasticsearch å®˜æ–¹æ–‡ä»¶ 7.3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç›´æ¥åœ¨ ubuntu 18.04 ä¸Šä½¿ç”¨ apt ä½œç‚ºå®‰è£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install apt-transport-https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;add-apt-repository &amp;#34;deb https://artifacts.elastic.co/packages/7.x/apt stable main&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£å®Œå¾Œè·¯å¾‘é•·é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/elasticsearch/jvm.options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Utility
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰éœ€è¦ä¹Ÿå¯ä»¥è¤‡å¯«è¨­å®šæª”ï¼ŒæŠŠ log ä¹Ÿç§»åˆ° /mnt/disks/elk/elasticsearch/logs&lt;/p&gt;
&lt;h3 id=&#34;æœå‹™æ§åˆ¶&#34;&gt;æœå‹™æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;é€é systemd ç®¡ç†ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ systemctl æ§åˆ¶ï¼Œ
ç”¨æˆ¶ elasticsearch:elasticsearchï¼Œæ“ä½œæ™‚æœƒéœ€è¦ sudo æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨å•Ÿå‹•å‰è¦å…ˆèª¿æ•´æ•¸æ“šå„²å­˜è·¯å¾‘ï¼Œä¸¦æŠŠæ¬Šé™ç§»è½‰çµ¦ä½¿ç”¨è€…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown elasticsearch:elasticsearch /mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è¨­å®šæª”æ¡ˆ&#34;&gt;è¨­å®šæª”æ¡ˆ&lt;/h3&gt;
&lt;p&gt;ELK æä¾›äº†è¨±å¤šå¯è¨­å®šèª¿æ•´çš„è¨­å®š,ä½†é¾å¤§çš„è¨­å®šæª”æ¡ˆä¹Ÿååˆ†é›£ä¸Šæ‰‹ã€‚æˆ‘å€‘é€™é‚Šå…ˆç°¡å–®æ›´æ”¹ä»¥ä¸‹è¨­å®šæª”æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Change Network
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;network.host: 0.0.0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Change data path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path.data: /mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim /etc/elasticsearch/jvm-options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Adjust heap to 4G
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xms4g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xmx4g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Enable xpack.security
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery.seed_hosts: [&amp;#34;10.140.0.10&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery.type: &amp;#34;single-node&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.license.self_generated.type: basic
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;6.3.0 å¾Œçš„ç‰ˆæœ¬å·²ç¶“é™„ä¸Šå®‰å…¨æ€§æ¨¡çµ„ xpackï¼Œé€™é‚Šé †ä¾¿é–‹èµ·ä¾†ã€‚é—œæ–¼ xpack çš„å®‰å…¨æ€§è¨­å®šï¼Œé€™é‚Šå…ˆç•¥éä¸æã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å•Ÿç”¨ xpack ï¼Œå¯ä»¥è®“æˆ‘å€‘é€é elasticsearch é™„å¸¶çš„å·¥å…·ï¼Œç”¢ç”Ÿä½¿ç”¨è€…èˆ‡å¸³è™Ÿå¯†ç¢¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Keep your passwords safe
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾ŒæŠŠå•Ÿå‹• Elasticsearch&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl enable elasticsearch.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl start elasticsearch.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl status elasticsearch.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹ä¸€ä¸‹ logï¼Œç¢ºå®šæœå‹™æœ‰åœ¨æ­£å¸¸å·¥ä½œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tail -f /var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ node ä¸Šè©¦æ‰“ Elasticsearch API&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl localhost:9200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;name&amp;#34; : &amp;#34;elk&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;cluster_name&amp;#34; : &amp;#34;elasticsearch&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;cluster_uuid&amp;#34; : &amp;#34;uiMZe7VETo-H6JLFLF4SZg&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;version&amp;#34; : {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;number&amp;#34; : &amp;#34;7.3.1&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_flavor&amp;#34; : &amp;#34;default&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_type&amp;#34; : &amp;#34;deb&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_hash&amp;#34; : &amp;#34;4749ba6&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_date&amp;#34; : &amp;#34;2019-08-19T20:19:25.651794Z&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_snapshot&amp;#34; : false,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;lucene_version&amp;#34; : &amp;#34;8.1.0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;minimum_wire_compatibility_version&amp;#34; : &amp;#34;6.8.0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;minimum_index_compatibility_version&amp;#34; : &amp;#34;6.0.0-beta1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;tagline&amp;#34; : &amp;#34;You Know, for Search&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;kibana&#34;&gt;Kibana&lt;/h1&gt;
&lt;p&gt;æœ‰äº†æ­£å¸¸å·¥ä½œçš„ Elasticsearchï¼Œæ¥ä¸‹ä¾†è¦å®‰è£ kibanaï¼Œç”±æ–¼ apt repository å·²ç¶“åŒ¯å…¥ï¼Œé€™é‚Šç›´æ¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€æ¨£å¿«é€Ÿè¨­å®šä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ vim /etc/kibana/kinana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# change server.host from localhost to 0.0.0.0 to allow outside requests
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.host: &amp;#34;0.0.0.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add elasticsearch password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.username: &amp;#34;kibana&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.password:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl enable kibana.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl start kibana.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl status kibana.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æª¢æŸ¥ log ä¸¦è©¦æ‰“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl status kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl localhost:5601
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€éå…§ç¶² ip ä¹Ÿå¯ä»¥ç”¨ browser å­˜å–
ä½¿ç”¨ elastic é€™çµ„å¸³è™Ÿå¯†ç¢¼ç™»å…¥ï¼Œå¯ä»¥æœ‰ç®¡ç†å“¡æ¬Šé™
å¯ä»¥æª¢è¦–ä¸€ä¸‹ kibana çš„é é¢ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦ç³»çµ±åŠŸèƒ½éƒ½ä¸Šå¸¸ä¸Šç·š
http://10.140.0.10/app/monitoring#&lt;/p&gt;
&lt;h1 id=&#34;filebeat&#34;&gt;Filebeat&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯ ELK æœ€åŸºæœ¬æ¶æ§‹: elasticsearch å¼•æ“èˆ‡å‰ç«¯è¦–è¦ºåŒ–ç®¡ç†å·¥å…· Kibanaã€‚ç•¶ç„¶ç¾åœ¨é€²å» kibana æ˜¯æ²’æœ‰æ•¸æ“šçš„ï¼Œæ‰€ä»¥æˆ‘å€‘ç¾åœ¨ä¾†å®‰è£ç¬¬ä¸€å€‹ beatï¼Œæ”¶é›†ç¬¬ä¸€ç­†æ•¸æ“šã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½æœƒè¦ºå¾—å¥‡æ€ª: æˆ‘ç¾åœ¨æ²’æœ‰ä»»ä½•éœ€è¦ç›£æ§çš„æ‡‰ç”¨ï¼Œå»å“ªæ”¶é›†æ•¸æ“š?&lt;/p&gt;
&lt;p&gt;ELK æä¾›çš„è‡ªæˆ‘ç›£æ¸¬ (self-monitoring) çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åœ¨ node ä¸Šéƒ¨å±¬ filebeat ä¸¦å•Ÿç”¨ modulesï¼Œä¾¿å¯ä»¥æŠŠé€™å° node ä¸Šçš„ elasticsearch é‹è¡Œçš„ç‹€æ³ï¼ŒåŒ…å«cpu ç‹€æ³ã€è¨˜æ†¶é«”ç”¨é‡ã€å„²å­˜ç©ºé–“ç”¨é‡ã€å®‰å…¨æ€§å‘Šè­¦ã€&amp;hellip;éƒ½åšç‚ºæ•¸æ“šï¼Œå‚³åˆ° elasticsearch ä¸­ï¼Œä¸¦åœ¨ Kibana monitoring é é¢è£½åœ–é¡¯ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä¹Ÿå‰›å¥½åšç‚ºæˆ‘å€‘ ELK stack çš„ç¬¬ä¸€ç­†æ•¸æ“šæ”¶é›†ã€‚&lt;/p&gt;
&lt;p&gt;WARNING: é€™é‚Šä¸€æ¨£è¦æé†’ï¼Œ production ç’°å¢ƒå¤šåŠæœƒä½¿ç”¨å¦å¤–ä¸€çµ„çš„ elasticsearch ä¾†ç›£æ§ä¸»è¦çš„é€™çµ„ elastic stackï¼Œä»¥ç¶­æŒ elk stack çš„ç©©å®šæ€§ï¼Œæ‰ä¸æœƒè‡ªå·± monitoring è‡ªå·±ï¼Œçµæœ elastic æ›äº†ï¼Œmetrics è·ŸéŒ¯èª¤è¨Šæ¯éƒ½çœ‹ä¸åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-installation.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹å®‰è£æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install filebeat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é è¨­çš„ filebeat.yml è¨­å®šæª”æ¡ˆä¸æ˜¯å®Œæ•´çš„ï¼Œè«‹åˆ°å®˜ç¶²ä¸‹è¼‰å®Œæ•´ç‰ˆï¼Œä½†å®˜ç¶²æ²’çµ¦æª”æ¡ˆé€£çµ(æ…˜)ï¼Œåªæœ‰ç¶²é ç‰ˆ &lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä¸Š github æŠŠå¥¹è¼‰ä¸‹ä¾†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ wget https://raw.githubusercontent.com/elastic/beats/v7.3.1/filebeat/filebeat.reference.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo mv filebeat-reference-y
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/filebeat/filebeat.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Enable elasticsearch module and kibana module to process metrics of localhost elasticsearch &amp;amp; kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat.modules:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Server log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  server:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # All logs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  log:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# The name will be added to metadata
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;name: filebeat-elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fields:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  env: elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add additional cloud_metadata since we&amp;#39;re on GCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;processors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- add_cloud_metadata: ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Output to elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: [&amp;#34;localhost:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;http&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Configure kibana with filebeat: add template, dashboards, etc...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setup.kibana:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  host: &amp;#34;localhost:5601&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;http&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿå‹• filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl start filebeat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹ä¸€ä¸‹ logï¼Œfilebeat æœƒé–‹å§‹æ”¶é›† elasticsearch çš„ log èˆ‡ metricsï¼Œå¯ä»¥åœ¨ log ä¸Šçœ‹åˆ°æ”¶é›†çš„ç‹€æ³ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo journalctl -fu filebeat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sep 15 06:28:50 elk filebeat[9143]: 2019-09-15T06:28:50.176Z        INFO        [monitoring]        log/log.go:145        Non-zero metrics in the last 30s        {&amp;#34;monitoring&amp;#34;: {&amp;#34;metrics&amp;#34;: {&amp;#34;beat&amp;#34;:{&amp;#34;cpu&amp;#34;:{&amp;#34;system&amp;#34;:{&amp;#34;ticks&amp;#34;:1670860,&amp;#34;time&amp;#34;:{&amp;#34;ms&amp;#34;:66}},&amp;#34;total&amp;#34;:{&amp;#34;ticks&amp;#34;:6964660,&amp;#34;time&amp;#34;:{&amp;#34;ms&amp;#34;:336},&amp;#34;value&amp;#34;:6964660},&amp;#34;user&amp;#34;:{&amp;#34;ticks&amp;#34;:5293800,&amp;#34;time&amp;#34;:{&amp;#34;ms&amp;#34;:270}}},&amp;#34;handles&amp;#34;:{&amp;#34;limit&amp;#34;:{&amp;#34;hard&amp;#34;:4096,&amp;#34;soft&amp;#34;:1024},&amp;#34;open&amp;#34;:11},&amp;#34;info&amp;#34;:{&amp;#34;ephemeral_id&amp;#34;:&amp;#34;62fd4bfa-1949-4356-9615-338ca6a95075&amp;#34;,&amp;#34;uptime&amp;#34;:{&amp;#34;ms&amp;#34;:786150373}},&amp;#34;memstats&amp;#34;:{&amp;#34;gc_next&amp;#34;:7681520,&amp;#34;memory_alloc&amp;#34;:4672576,&amp;#34;memory_total&amp;#34;:457564560376,&amp;#34;rss&amp;#34;:-32768},&amp;#34;runtime&amp;#34;:{&amp;#34;goroutines&amp;#34;:98}},&amp;#34;filebeat&amp;#34;:{&amp;#34;events&amp;#34;:{&amp;#34;active&amp;#34;:-29,&amp;#34;added&amp;#34;:1026,&amp;#34;done&amp;#34;:1055},&amp;#34;harvester&amp;#34;:{&amp;#34;open_files&amp;#34;:4,&amp;#34;running&amp;#34;:4}},&amp;#34;libbeat&amp;#34;:{&amp;#34;config&amp;#34;:{&amp;#34;module&amp;#34;:{&amp;#34;running&amp;#34;:0}},&amp;#34;output&amp;#34;:{&amp;#34;events&amp;#34;:{&amp;#34;acked&amp;#34;:1055,&amp;#34;active&amp;#34;:-50,&amp;#34;batches&amp;#34;:34,&amp;#34;total&amp;#34;:1005},&amp;#34;read&amp;#34;:{&amp;#34;bytes&amp;#34;:248606},&amp;#34;write&amp;#34;:{&amp;#34;bytes&amp;#34;:945393}},&amp;#34;pipeline&amp;#34;:{&amp;#34;clients&amp;#34;:9,&amp;#34;events&amp;#34;:{&amp;#34;active&amp;#34;:32,&amp;#34;published&amp;#34;:1026,&amp;#34;total&amp;#34;:1026},&amp;#34;queue&amp;#34;:{&amp;#34;acked&amp;#34;:1055}}},&amp;#34;registrar&amp;#34;:{&amp;#34;states&amp;#34;:{&amp;#34;current&amp;#34;:34,&amp;#34;update&amp;#34;:1055},&amp;#34;writes&amp;#34;:{&amp;#34;success&amp;#34;:35,&amp;#34;total&amp;#34;:35}},&amp;#34;system&amp;#34;:{&amp;#34;load&amp;#34;:{&amp;#34;1&amp;#34;:1.49,&amp;#34;15&amp;#34;:0.94,&amp;#34;5&amp;#34;:1.15,&amp;#34;norm&amp;#34;:{&amp;#34;1&amp;#34;:0.745,&amp;#34;15&amp;#34;:0.47,&amp;#34;5&amp;#34;:0.575}}}}}}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ•¸æ“šéƒ½æœ‰é€å‡ºï¼Œå°±å¯ä»¥å›åˆ° kibana çš„é é¢ï¼Œçœ‹ä¸€ä¸‹ç›®å‰é€™å€‹ elasticsearch é›†ç¾¤ï¼Œæœ‰é–‹å•Ÿ monitoring åŠŸèƒ½çš„å…ƒä»¶å€‘ï¼Œæ˜¯å¦éƒ½æœ‰æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;http://10.140.0.10/app/monitoring#&lt;/p&gt;
&lt;p&gt;é é¢é•·å¾—åƒé€™æ¨£&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;elk/kibana-monitoring.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;100%&#34; height=&#34;100%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;p&gt;Standalone cluster ä¸­çš„ filebeatï¼Œæ˜¯é‚„æœªè·Ÿ elasticsearch é…å°å®Œæˆçš„æ•¸æ“šï¼Œæœƒé¡¯ç¤ºåœ¨å¦å¤–ä¸€å€‹é›†ç¾¤ä¸­ï¼Œé…å°å®Œå¾Œæœƒæ­¸åˆ° elk cluster ä¸­ï¼Œå°±æ˜¯æˆ‘å€‘çš„ä¸»è¦ clusterã€‚&lt;/p&gt;
&lt;p&gt;é»é€²å»å¯ä»¥çœ‹å„å€‹å…ƒä»¶çš„æœå‹™æƒ…å½¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡å–®æ€è€ƒ self-host ELK stack æ­å»ºçš„æ¶æ§‹&lt;/li&gt;
&lt;li&gt;åœ¨å–®ä¸€ node ä¸Šå®‰è£æœ€ç°¡æ˜“çš„ elastic stack&lt;/li&gt;
&lt;li&gt;è¨­å®šå…ƒä»¶çš„ output ä½ç½®&lt;/li&gt;
&lt;li&gt;è¨­å®š self-monitoring&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­å–œå„ä½ç²å¾—ä¸€å€‹è£¸å¥”ä½†æ˜¯åŠŸèƒ½å®Œæ•´çš„ ELK, æˆ‘å€‘ä¸‹ç¯‡å†å‘å®‰å…¨æ€§é‚é€²ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
