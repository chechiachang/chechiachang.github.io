<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Che-Chia Chang</title>
    <link>https://chechia.net/zh-hant/</link>
      <atom:link href="https://chechia.net/zh-hant/index.xml" rel="self" type="application/rss+xml" />
    <description>Che-Chia Chang</description>
    <generator>Hugo Blox Builder (https://hugoblox.com)</generator><language>zh-Hant</language><lastBuildDate>Mon, 24 Oct 2022 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://chechia.net/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png</url>
      <title>Che-Chia Chang</title>
      <link>https://chechia.net/zh-hant/</link>
    </image>
    
    <item>
      <title>Workshop: RAGæ‰“é€ ä¼æ¥­AIçŸ¥è­˜åº«ï¼šæŠŠä¸€ç”²å­åŠŸåŠ›å‚³çµ¦æ–°äºº</title>
      <link>https://chechia.net/zh-hant/talk/workshop-rag%E6%89%93%E9%80%A0%E4%BC%81%E6%A5%ADai%E7%9F%A5%E8%AD%98%E5%BA%AB%E6%8A%8A%E4%B8%80%E7%94%B2%E5%AD%90%E5%8A%9F%E5%8A%9B%E5%82%B3%E7%B5%A6%E6%96%B0%E4%BA%BA/</link>
      <pubDate>Thu, 05 Jun 2025 12:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/workshop-rag%E6%89%93%E9%80%A0%E4%BC%81%E6%A5%ADai%E7%9F%A5%E8%AD%98%E5%BA%AB%E6%8A%8A%E4%B8%80%E7%94%B2%E5%AD%90%E5%8A%9F%E5%8A%9B%E5%82%B3%E7%B5%A6%E6%96%B0%E4%BA%BA/</guid>
      <description>&lt;hr&gt;
&lt;h1 id=&#34;rag-workshop-è¡Œå‰é€šçŸ¥&#34;&gt;RAG workshop è¡Œå‰é€šçŸ¥&lt;/h1&gt;
&lt;p&gt;æœ¬æ¬¡ workshop ä»¥ hands-on çš„æ–¹å¼é€²è¡Œï¼Œç´¯ç©æ“ä½œç¶“é©—ç‚ºä¸»ï¼Œè¬›è§£èˆ‡èªªæ˜ç‚ºè¼”ã€‚è§€å¿µå…§å®¹æœ‰æº–å‚™æ•™æï¼Œéœ€è¦åƒèˆ‡è€…è‡ªè¡Œé–±è®€ã€‚è¬›å¸«æœƒå…è²»æä¾›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Azure OpenAI models API key (gpt-4.1, gpt-4.1-mini, text-embedding-3, text-embedding-ada-002&amp;hellip;)&lt;/li&gt;
&lt;li&gt;Azure VM ä¾›åŒå­¸é ç«¯æ“ä½œä½¿ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;---æŠ•å½±ç‰‡èˆ‡æ•™æhttpschechianetzh-hantslides2025-06-05-devops-rag-internal-ai---&#34;&gt;&amp;ndash;&amp;gt; &lt;a href=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ•å½±ç‰‡èˆ‡æ•™æ&lt;/a&gt; &amp;lt;&amp;ndash;&lt;/h1&gt;
&lt;hr&gt;
&lt;h3 id=&#34;workshop-åŸºæœ¬éœ€æ±‚&#34;&gt;Workshop åŸºæœ¬éœ€æ±‚&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„é›»è…¦ï¼Œå¯ä»¥ä¸Šç¶²&lt;/li&gt;
&lt;li&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦ï¼Œåœ¨ docker å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;é¸é …2: ä½¿ç”¨è‡ªå·±çš„é›»è…¦ï¼Œé ç«¯é€£ç·šè¬›å¸«æä¾›çš„ VMï¼Œåœ¨VM ä¸­å•Ÿå‹• docker é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ docker&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ python èˆ‡ jupyter notebook&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ chatgpt.com å”åŠ©é™¤éŒ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é¸é …1-ä½¿ç”¨è‡ªå·±çš„é›»è…¦&#34;&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦&lt;/h3&gt;
&lt;p&gt;åœ¨ workshop é–‹å§‹å‰ï¼Œåœ¨è‡ªå·±çš„é›»è…¦ä¸Š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£ docker&lt;/li&gt;
&lt;li&gt;git clone github repository&lt;/li&gt;
&lt;li&gt;å•Ÿå‹• docker é–‹ç™¼ç’°å¢ƒï¼Œä¸‹è¼‰ docker images&lt;/li&gt;
&lt;li&gt;é–‹å•Ÿç€è¦½å™¨ï¼Œé€£ç·šåˆ° Jupyter Notebookï¼Œtoken &lt;code&gt;workshop1234!&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ Jupyter Notebook ä¸­ï¼Œå®‰è£æ‰€éœ€çš„ Python å¥—ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/chechiachang/rag-workshop.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; rag-workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it notebook pip install pandas openai qdrant_client tqdm tenacity wget tenacity unstructured markdown ragas sacrebleu langchain_qdrant langchain-openai langchain_openai langchain_community tiktoken
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;é¸é …2-ä½¿ç”¨é ç«¯-vm&#34;&gt;é¸é …2: ä½¿ç”¨é ç«¯ VM&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å»ºè­°ä½¿ç”¨å€‹äººé›»è…¦ï¼Œç•¢ç«Ÿå…è²» VM åé¡ç¾å ´æœ‰é™&lt;/li&gt;
&lt;li&gt;éœ€è¦æœ‰è‡ªå·±çš„é›»è…¦ï¼Œæœ‰ç©©å®šçš„ç¶²è·¯ï¼Œå¯ä»¥é€£ç·šåˆ°é ç«¯ VM&lt;/li&gt;
&lt;li&gt;éœ€è¦è¨»å†Š tunnel å·¥å…·ï¼ˆæ²’æœ‰æ¥­é…ï¼‰&lt;a href=&#34;https://dashboard.ngrok.com/login&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ngrok&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ç™»å…¥ Login -&amp;gt; å·¦æ‰‹é‚Š Identity &amp;amp; Access -&amp;gt; Authtokens -&amp;gt; Add Tunnel authtoken -&amp;gt; è¨˜åœ¨å®‰å…¨çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://pinggy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pinggy&lt;/a&gt;ï¼Œä½†å…è²»æœ‰é™æ™‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æŠ•å½±ç‰‡èˆ‡æ•™ææœƒæ”¾åœ¨ç¶²ç«™ä¸Š&#34;&gt;æŠ•å½±ç‰‡èˆ‡æ•™ææœƒæ”¾åœ¨ç¶²ç«™ä¸Š&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½•å­˜å– VM ä¹Ÿæœƒæ”¾åœ¨æ•¨å½±ç‰‡è£¡&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;rag-workshop-è¡Œå‰é€šçŸ¥å®Œå¤§å®¶ç•¶å¤©ç¾å ´è¦‹&#34;&gt;RAG workshop è¡Œå‰é€šçŸ¥å®Œï¼Œå¤§å®¶ç•¶å¤©ç¾å ´è¦‹&lt;/h2&gt;
&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;é–‹ç™¼åœ˜éšŠéœ€è¦å°‡ç¶“é©—èˆ‡çŸ¥è­˜ï¼Œé€éæ–‡ä»¶åŒ–çš„æ–¹å¼ä¿å­˜ä¸‹ä¾†ï¼Œä»¥ä¾¿æœªä¾†æŸ¥è©¢èˆ‡å­¸ç¿’ã€‚ç„¶è€Œï¼Œä¼æ¥­å…§éƒ¨æ–‡ä»¶å¾€å¾€åˆ†æ•£æ–¼ Confluenceã€Google Driveã€Notion ç­‰å¹³å°ï¼Œå‚³çµ±é—œéµå­—æœå°‹é›£ä»¥å¿«é€Ÿç²å–æº–ç¢ºè³‡è¨Šï¼Œå°è‡´æºé€šæˆæœ¬é«˜ã€é–‹ç™¼æµç¨‹å—é˜»ã€‚åˆæˆ–æ˜¯ï¼Œç•¶é–‹ç™¼åœ˜éšŠéœ€è¦æŸ¥è©¢ç‰¹å®šçŸ¥è­˜æ™‚ï¼Œå¾€å¾€éœ€è¦é€é Slackã€Email ç­‰æ–¹å¼è©¢å•åŒäº‹ï¼Œé€™æ¨£çš„æºé€šæˆæœ¬ä¸åƒ…æµªè²»æ™‚é–“ï¼Œä¹Ÿå®¹æ˜“é€ æˆè³‡è¨Šä¸å°ç¨±ã€‚&lt;/p&gt;
&lt;p&gt;å­¸å“¡å°‡å­¸æœƒå¦‚ä½•åˆ©ç”¨ RAG æŠ€è¡“ï¼Œçµåˆ OpenAIã€LangChainã€Qdrant å‘é‡æ•¸æ“šåº«ï¼Œæ§‹å»ºä¼æ¥­å…§éƒ¨æ–‡æª”çš„æ™ºèƒ½çŸ¥è­˜åº«ï¼Œä¸¦èƒ½è¨­è¨ˆèˆ‡å¯¦ä½œä¸€å€‹åŸºæ–¼è‡ªç„¶èªè¨€è™•ç†ï¼ˆNLPï¼‰çš„æŸ¥è©¢ç³»çµ±ï¼Œä¾†æå‡é–‹ç™¼åœ˜éšŠçš„æ•ˆç‡èˆ‡çŸ¥è­˜ç®¡ç†èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»€éº¼æ˜¯ RAGï¼Ÿ
&lt;ul&gt;
&lt;li&gt;ä»‹ç´¹ RAGï¼ˆRetrieval-Augmented Generationï¼‰æŠ€è¡“å¦‚ä½•çµåˆæª¢ç´¢èˆ‡ç”Ÿæˆæå‡å•ç­”æº–ç¢ºæ€§ã€‚&lt;/li&gt;
&lt;li&gt;ç‚ºä»€éº¼ä¼æ¥­éœ€è¦æ™ºèƒ½çŸ¥è­˜åº«ï¼Ÿ&lt;/li&gt;
&lt;li&gt;RAG çš„æ‡‰ç”¨å ´æ™¯ï¼šçŸ¥è­˜åº«å»ºç«‹ã€é–‹ç™¼æ”¯æ´ã€æŠ€è¡“æ±ºç­–ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Python èˆ‡ OpenAIï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ OpenAI API æ¶æ§‹èˆ‡èªè¨€æ¨¡å‹ï¼Œå¿«é€Ÿæ§‹å»ºç”Ÿæˆæ¨¡å‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;LangChainï¼šä»‹ç´¹ LangChain æ¡†æ¶å¦‚ä½•ç°¡åŒ– RAG å¯¦ç¾&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ©ç”¨ LangChain æ•´åˆå¤šç¨®æ•¸æ“šæºèˆ‡ç”Ÿæˆæ¨¡å‹&lt;/li&gt;
&lt;li&gt;Qdrant å‘é‡æ•¸æ“šåº«ï¼š
&lt;ul&gt;
&lt;li&gt;å‘é‡æ•¸æ“šåº«çš„æ¦‚å¿µèˆ‡ä½œç”¨&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ©ç”¨ Qdrant å„²å­˜èˆ‡æª¢ç´¢å…§éƒ¨æ–‡æª”çš„åµŒå…¥å‘é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ§‹å»º RAG ç³»çµ±ï¼šå¯¦ä½œæ­¥é©Ÿèˆ‡æ¼”ç¤º
&lt;ul&gt;
&lt;li&gt;æ•¸æ“šé è™•ç†èˆ‡æ–‡æª”è½‰æ›&lt;/li&gt;
&lt;li&gt;å°‡è™•ç†å¾Œçš„æ–‡æœ¬è½‰æ›ç‚ºå‘é‡è¡¨ç¤ºï¼ˆembeddingï¼‰&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ Qdrant å‘é‡æ•¸æ“šåº«å„²å­˜é€™äº›åµŒå…¥ä¸¦åŸ·è¡Œæª¢ç´¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ LangChain çµåˆ OpenAI æ¨¡å‹èˆ‡ Qdrantï¼Œè£½ä½œè‡ªå‹•åŒ–å•ç­”ç³»çµ±&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;target-group&#34;&gt;Target group&lt;/h1&gt;
&lt;p&gt;æœ¬æ¬¡å·¥ä½œåŠæœƒæä¾›åƒèˆ‡è€…ä¸€å€‹ç°¡å–®çš„ç’°å¢ƒï¼Œè®“åƒèˆ‡è€…å¯ä»¥é€éé ç«¯æ“ä½œä¾†å¯¦ä½œåŸºæœ¬ RAG AI Agentã€‚åƒèˆ‡è€…å¿…å‚™å€‹äººç­†é›»ï¼Œé€é SSH æ“æ§é ç«¯æ©Ÿå™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¿…å‚™çŸ¥è­˜ï¼šLinux æ“ä½œåŸºæœ¬çŸ¥è­˜ï¼ŒDocker æ“ä½œåŸºæœ¬çŸ¥è­˜ï¼Œæœƒä½¿ç”¨ SSH é€£ç·š / Bash / dockerã€‚&lt;/p&gt;
&lt;p&gt;å·¥ä½œåŠçµæŸå¾Œï¼Œå­¸å“¡å°‡èƒ½å¤ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç†è§£ä¸¦å¯¦ä½œ RAG æŠ€è¡“ï¼Œå°‡å…§éƒ¨æ–‡æª”è½‰åŒ–ç‚ºæ™ºèƒ½çŸ¥è­˜åº«&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Pythonã€LangChain å’Œ OpenAI æ§‹å»ºåŸºæ–¼æª¢ç´¢çš„å•ç­”ç³»çµ±&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ Qdrant å‘é‡æ•¸æ“šåº«é€²è¡Œé«˜æ•ˆæª¢ç´¢ï¼Œæå‡é–‹ç™¼æµç¨‹ä¸­çš„çŸ¥è­˜ç®¡ç†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;é€™æ¨£çš„å·¥ä½œåŠçµæ§‹èƒ½å¤ å¹³è¡¡ç†è«–èˆ‡å¯¦è¸ï¼Œä¸¦ç‚ºå­¸å“¡æä¾›å¯¦éš›å‹•æ‰‹æ“ä½œçš„æ©Ÿæœƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Chang æ˜¯ä¸€åå°ˆæ³¨æ–¼å¾Œç«¯é–‹ç™¼ã€é–‹ç™¼ç¶­é‹ã€å®¹å™¨åŒ–æ‡‰ç”¨åŠ Kubernetes é–‹ç™¼èˆ‡ç®¡ç†çš„æŠ€è¡“å°ˆå®¶ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ Microsoft æœ€æœ‰åƒ¹å€¼å°ˆæ¥­äººå£«ï¼ˆMVPï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ´»èºæ–¼å°ç£æŠ€è¡“ç¤¾ç¾¤ï¼Œç¶“å¸¸åœ¨ CNTUGã€DevOps Taipeiã€GDG Taipeiã€Golang Taipei Meetup ç­‰ç¤¾ç¾¤åˆ†äº« DevOpsã€SREã€Kubernetes åŠé›²ç«¯é‹ç®—ç›¸é—œæŠ€è¡“ã€‚è‡´åŠ›æ–¼æ¨å‹•é–‹ç™¼èˆ‡ç¶­é‹çš„æœ€ä½³å¯¦è¸ï¼Œä¸¦ç†±è¡·æ–¼ç ”ç©¶èˆ‡æ‡‰ç”¨æœ€æ–°çš„é›²ç«¯èˆ‡ AI æŠ€è¡“ã€‚&lt;/p&gt;
&lt;p&gt;å€‹äººéƒ¨è½æ ¼ï¼šhttps://chechia.net&lt;/p&gt;
&lt;p&gt;Che-Chia Chang is a technology expert specializing in backend development, DevOps, site reliability engineering (SRE), containerized applications, and Kubernetes development and management. He is also recognized as a Microsoft Most Valuable Professional (MVP).&lt;/p&gt;
&lt;p&gt;Actively engaged in the Taiwanese tech community, he frequently shares insights on DevOps, SRE, Kubernetes, and cloud computing at CNTUG, DevOps Taipei, GDG Taipei, and Golang Taipei Meetup. Passionate about promoting best practices in development and operations, he continuously explores and applies the latest advancements in cloud and AI technologies.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2024 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2024 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2023 DevOpsDay&lt;/li&gt;
&lt;li&gt;2023 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Workshop: RAGæ‰“é€ ä¼æ¥­AIçŸ¥è­˜åº«ï¼šæŠŠä¸€ç”²å­åŠŸåŠ›å‚³çµ¦æ–°äºº</title>
      <link>https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/</link>
      <pubDate>Sun, 01 Jun 2025 00:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/</guid>
      <description>&lt;h3 id=&#34;rag-workshop-è¡Œå‰é€šçŸ¥åŸºæœ¬éœ€æ±‚&#34;&gt;RAG workshop è¡Œå‰é€šçŸ¥ï¼šåŸºæœ¬éœ€æ±‚&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç•¶å¤©å¸¶è‡ªå·±çš„é›»è…¦ã€‚ç•¶å¤©å»ºè­°è‡ªå‚™æ‰‹æ©Ÿç¶²è·¯&lt;/li&gt;
&lt;li&gt;é¸é …1: ç”¨é›»è…¦åœ¨ docker é‹è¡Œé–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;é¸é …2: ç”¨é›»è…¦é ç«¯é€£ç·šè¬›å¸«æä¾›çš„ VMï¼Œåœ¨é ç«¯VM ä¸­é‹è¡Œ docker é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ docker&lt;/li&gt;
&lt;li&gt;æœƒä½¿ç”¨ python èˆ‡ jupyter notebook&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h5 id=&#34;é¸é …1-ä½¿ç”¨è‡ªå·±çš„é›»è…¦-&#34;&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦ ğŸ’»&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ workshop é–‹å§‹å‰ï¼Œåœ¨è‡ªå·±çš„é›»è…¦ä¸Š
&lt;ol&gt;
&lt;li&gt;å®‰è£ &lt;a href=&#34;https://docs.docker.com/get-started/get-docker/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;docker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;git clone æ•™æ&lt;/li&gt;
&lt;li&gt;å•Ÿå‹• docker é–‹ç™¼ç’°å¢ƒï¼Œä¸‹è¼‰ docker images&lt;/li&gt;
&lt;li&gt;å®‰è£æ‰€éœ€çš„ Python å¥—ä»¶&lt;/li&gt;
&lt;li&gt;é–‹å•Ÿç€è¦½å™¨ï¼Œé€£ç·šåˆ°&lt;a href=&#34;http://localhost:8888&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8888&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/chechiachang/rag-workshop.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; rag-workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it notebook pip install pandas openai qdrant_client tqdm tenacity wget tenacity unstructured markdown ragas sacrebleu langchain_qdrant langchain-openai langchain_openai langchain_community tiktoken ipywidgets
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ç™»å…¥token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;workshop1234!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h5 id=&#34;é¸é …2-ä½¿ç”¨é ç«¯-vm&#34;&gt;é¸é …2: ä½¿ç”¨é ç«¯ VM&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„é›»è…¦ï¼Œç•¶å¤©å»ºè­°è‡ªå‚™æ‰‹æ©Ÿç¶²è·¯ï¼Œé€£ç·šåˆ°é ç«¯ VM&lt;/li&gt;
&lt;li&gt;æå‰è¨»å†Š tunnel å·¥å…·ï¼ˆæ²’æœ‰æ¥­é…ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dashboard.ngrok.com/login&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ngrok&lt;/a&gt; ç™»å…¥ Login -&amp;gt; å·¦æ‰‹é‚Š Identity &amp;amp; Access -&amp;gt; Authtokens -&amp;gt; Add Tunnel authtoken -&amp;gt; è¨˜åœ¨å®‰å…¨çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://pinggy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pinggy&lt;/a&gt;ï¼Œä½†å…è²»æœ‰é™æ™‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å»ºè­°&#34;&gt;å»ºè­°&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å„ªå…ˆä½¿ç”¨å€‹äººé›»è…¦ã€‚æœƒç›¡é‡æä¾›å…è²» VM åé¡ï¼Œä½†ä¾åƒèˆ‡äººæ•¸ä¸ä¿è­‰ç¾å ´æœ‰&lt;/li&gt;
&lt;li&gt;åœ¨å®¶å…ˆè©¦è·‘ä¸€éï¼ŒæŠŠ docker image è·Ÿ pip å¥—ä»¶éƒ½ä¸‹è¼‰å¥½ï¼Œç¾å ´è¦è¼‰å¾ˆä¹…&lt;/li&gt;
&lt;li&gt;è©¦å®Œå¾Œè¨˜å¾—é—œæ‰ ngrokï¼Œä»¥å…ç”¨å®Œæ¯æœˆçš„å…è²»é¡åº¦&lt;/li&gt;
&lt;li&gt;äº‹å…ˆçœ‹å®Œå…§å®¹è¦ºå¾—å¤ªç°¡å–®å¯ä»¥ä¸ç”¨ä¾†ï¼Œä½†æ­¡è¿æœƒå¾Œæ‰¾æˆ‘èŠå¤©ï¼¸ï¼¤&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æŠ•å½±ç‰‡èˆ‡æ•™æèˆ‡å®Œæ•´ç¨‹å¼ç¢¼æ”¾åœ¨ç¶²ç«™ä¸Š&#34;&gt;æŠ•å½±ç‰‡èˆ‡æ•™æèˆ‡å®Œæ•´ç¨‹å¼ç¢¼æ”¾åœ¨ç¶²ç«™ä¸Š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ğŸ“ &lt;a href=&#34;https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/zh-hant/slides/2025-06-05-devops-rag-internal-ai/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github æŠ•å½±ç‰‡åŸå§‹ç¢¼èˆ‡è¬›ç¨¿&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id=&#34;ä»¥ä¸‹æ˜¯-rag-workshop-ç•¶å¤©å…§å®¹&#34;&gt;ä»¥ä¸‹æ˜¯ RAG Workshop ç•¶å¤©å…§å®¹&lt;/h5&gt;
&lt;p&gt;å¯ä»¥å…ˆçœ‹ï¼Œä¹Ÿå¯ä»¥ç•¶å¤©å†çœ‹&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://media.tenor.com/aRF-Uwyl0p8AAAAM/frozen2.gif&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop&#34;&gt;RAG Workshop&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é—œæ–¼æˆ‘&#34;&gt;é—œæ–¼æˆ‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Che Chia Chang&lt;/li&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.cake.me/companies/maicoin/jobs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å€‹äººéƒ¨è½æ ¼&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; æŠ•å½±ç‰‡è¬›ç¨¿ï¼Œéµäººè³½ (Terraform / Vault æ‰‹æŠŠæ‰‹å…¥é–€ / Etcd Workshop)&lt;/li&gt;
&lt;li&gt;ğŸ“ &lt;a href=&#34;https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/zh-hant/slides/2025-06-05-devops-rag-internal-ai/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šå¤©çš„æŠ•å½±ç‰‡åŸå§‹ç¢¼èˆ‡è¬›ç¨¿&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;10min - &lt;strong&gt;ç’°å¢ƒè¨­å®šï¼šç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è¨­å®šå¥½é–‹ç™¼ç’°å¢ƒ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;10min - ç‚ºä»€éº¼éœ€è¦ RAGï¼ˆRetrieval-Augmented Generationï¼‰&lt;/li&gt;
&lt;li&gt;10min - Notebook 2 Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;10min - Notebook 3 Embedding Search&lt;/li&gt;
&lt;li&gt;10min - Notebook 4 DIY&lt;/li&gt;
&lt;li&gt;10min - Notebook 5 Evaluation&lt;/li&gt;
&lt;li&gt;10min - Notebook 6 k8s RAG QA&lt;/li&gt;
&lt;li&gt;20min - DIY + Q&amp;amp;A&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h5 id=&#34;é¸é …1-ä½¿ç”¨è‡ªå·±çš„é›»è…¦&#34;&gt;é¸é …1: ä½¿ç”¨è‡ªå·±çš„é›»è…¦&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰åœ¨å®¶å…ˆè©¦è·‘ä¸€éï¼Œæ‡‰è©²å¯ä»¥åœ¨æœ¬åœ°å­˜å– Notebook &lt;a href=&#34;http://localhost:8888&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8888&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åˆ° &lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt; å–å¾— OpenAI Key&lt;/li&gt;
&lt;li&gt;å¯ä»¥è©¦è‘—è·‘ notebook 2-5&lt;/li&gt;
&lt;li&gt;å¿˜è¨˜æ€éº¼å•Ÿå‹•ï¼Œå¯ä»¥å›åˆ°æŠ•å½±ç‰‡æœ€é–‹å§‹&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;notebook token: workshop1234!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AZURE_OPENAI_API_KEY=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AZURE_OPENAI_ENDPOINT=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h5 id=&#34;é¸é …2-ä½¿ç”¨é ç«¯-vm-1&#34;&gt;é¸é …2: ä½¿ç”¨é ç«¯ VM&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;è‡³&lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt; é ˜å–ä¸€å° VM ä¸¦ç°½å&lt;/li&gt;
&lt;li&gt;googel sheet å·¦é‚Š urlï¼Œé–‹å•Ÿ bastion é€£ç·š&lt;/li&gt;
&lt;li&gt;Protocol: SSHï¼Œport 22ï¼Œauthentication type: password&lt;/li&gt;
&lt;li&gt;å¸³è™Ÿå¯†ç¢¼åœ¨&lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_8aa3d767b665df4f846c9f4ea3bf4e4f.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_03c55b28d75c2ab6499830cbb3b9c46e.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/azure-bastion_hud0b002e70f9988d619375cc2291231bb_27220_8aa3d767b665df4f846c9f4ea3bf4e4f.webp&#34;
               width=&#34;359&#34;
               height=&#34;599&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h5 id=&#34;é¸é …2-ä½¿ç”¨-ngrok-é€£ç·šåˆ°-jupyter-notebook&#34;&gt;é¸é …2: ä½¿ç”¨ ngrok é€£ç·šåˆ° jupyter notebook&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;é€²å…¥ VM å¾Œï¼Œä¿®æ”¹ä¸‹é¢ ngrok authtokenã€‚æŒ‡ä»¤ä¸€è¡Œä¸€è¡Œè²¼ä¸Šï¼ˆå³éµï¼‰åˆ° bastion ä¸­åŸ·è¡Œ&lt;/li&gt;
&lt;li&gt;é€é &lt;a href=&#34;https://4d11-52-230-24-207.ngrok-free.app/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://4d11-52-230-24-207.ngrok-free.app/&lt;/a&gt; å°±å¯ä»¥ä½¿ç”¨ notebook (æ¯å€‹äººä¸ä¸€æ¨£)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd rag-workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NGROK_AUTHTOKEN=&amp;lt;æ”¹æˆä½ çš„token&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sed -i &amp;#34;s/your-token/$NGROK_AUTHTOKEN/&amp;#34; docker-compose.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs ngrok
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=2025-06-02T06:17:41+0000 lvl=info msg=&amp;#34;started tunnel&amp;#34; obj=tunnels name=command_line addr=http://notebook:8888 url=https://4d11-52-230-24-207.ngrok-free.app
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;ä»¥ä¸Šæ˜¯-workshop-ç’°å¢ƒè¨­å®š&#34;&gt;ä»¥ä¸Šæ˜¯ Workshop ç’°å¢ƒè¨­å®š&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å¾Œé¢ä¸Šèª²éƒ½é€éé€™å€‹ç¶²å€æ“ä½œ&lt;/li&gt;
&lt;li&gt;é‚„æ²’æœ‰çœ‹åˆ° jupyter notebook çš„äººï¼Œè«‹èˆ‰æ‰‹&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://miro.medium.com/v2/resize:fit:996/1*ByWkrjbyWmC9W_uWjI1qrw.gif&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹-1&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç’°å¢ƒè¨­å®šï¼šç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è¨­å®šå¥½é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‚ºä»€éº¼éœ€è¦ RAGï¼ˆRetrieval-Augmented Generationï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;Embedding Search&lt;/li&gt;
&lt;li&gt;DIY&lt;/li&gt;
&lt;li&gt;Evaluation&lt;/li&gt;
&lt;li&gt;å¯¦éš›æ‡‰ç”¨: ä»¥ k8s official docs ç‚ºä¾‹&lt;/li&gt;
&lt;li&gt;DIY + Q&amp;amp;A&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä»€éº¼æ˜¯-rag&#34;&gt;ä»€éº¼æ˜¯ RAG&lt;/h3&gt;
&lt;h5 id=&#34;ragretrieval-augmented-generation-æª¢ç´¢å¢å¼·ç”Ÿæˆçµåˆæª¢ç´¢ç³»çµ±èˆ‡ç”Ÿæˆå¼æ¨¡å‹å¦‚-gptçš„è‡ªç„¶èªè¨€è™•ç†æ¶æ§‹åœ¨ç”Ÿæˆç­”æ¡ˆæ™‚å¼•ç”¨å¤–éƒ¨çŸ¥è­˜ä½¿æ¨¡å‹å›ç­”æ›´æº–ç¢ºä¸”å…·äº‹å¯¦æ ¹æ“š&#34;&gt;RAGï¼ˆRetrieval-Augmented Generation æª¢ç´¢å¢å¼·ç”Ÿæˆï¼‰çµåˆæª¢ç´¢ç³»çµ±èˆ‡ç”Ÿæˆå¼æ¨¡å‹ï¼ˆå¦‚ GPTï¼‰çš„è‡ªç„¶èªè¨€è™•ç†æ¶æ§‹ï¼Œåœ¨ç”Ÿæˆç­”æ¡ˆæ™‚å¼•ç”¨å¤–éƒ¨çŸ¥è­˜ï¼Œä½¿æ¨¡å‹å›ç­”æ›´æº–ç¢ºä¸”å…·äº‹å¯¦æ ¹æ“š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Retrievalï¼ˆæª¢ç´¢ï¼‰ï¼š&lt;/strong&gt; å¾ä¸€å€‹å¤–éƒ¨çŸ¥è­˜åº«ï¼ˆå¦‚æ–‡ä»¶ã€å‘é‡è³‡æ–™åº«ç­‰ï¼‰ä¸­æ‰¾åˆ°èˆ‡å•é¡Œç›¸é—œçš„è³‡è¨Šã€‚é€šå¸¸æœƒç”¨èªæ„å‘é‡ï¼ˆembeddingsï¼‰åšç›¸ä¼¼åº¦æœå°‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Generationï¼ˆç”Ÿæˆï¼‰ï¼š&lt;/strong&gt; æŠŠæª¢ç´¢åˆ°çš„å…§å®¹èˆ‡ä½¿ç”¨è€…å•é¡Œä¸€èµ·ä¸Ÿçµ¦ LLMï¼ˆå¦‚ GPTã€Claude ç­‰ï¼‰å»ç”Ÿæˆç­”æ¡ˆã€‚ç”Ÿæˆçš„å…§å®¹æœƒæ›´å…·äº‹å¯¦æ ¹æ“šï¼Œä¸¦èƒ½å¼•ç”¨å…·é«”è³‡æ–™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://cookbook.openai.com/images/llamaindex_rag_overview.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cookbook.openai.com/images/llamaindex_rag_overview.png&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cookbook.openai.com/images/llamaindex_rag_overview.png&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;çŸ¥è­˜ç²å–æ•ˆç‡åœ¨-devops-çš„é›£é¡Œ&#34;&gt;çŸ¥è­˜ç²å–æ•ˆç‡åœ¨ DevOps çš„é›£é¡Œ&lt;/h3&gt;
&lt;p&gt;åœ¨å¿«é€Ÿè®Šå‹•ã€è³‡è¨Šåˆ†æ•£çš„ç’°å¢ƒä¸­ï¼Œé›£ä»¥å³æ™‚å–å¾—éœ€è¦çš„çŸ¥è­˜ã€‚ã€Œæœ‰ä½†æ‰¾ä¸åˆ°ã€çœ‹ä¸æ‡‚ã€ç”¨ä¸èµ·ä¾†ã€&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çŸ¥è­˜åˆ†æ•£åœ¨å¤šå€‹ç³»çµ±ã€æ ¼å¼èˆ‡å·¥å…·ä¸­&lt;/li&gt;
&lt;li&gt;çŸ¥è­˜å¤šç‚ºã€Œéœæ…‹æ–‡ä»¶ã€ï¼Œé›£ä»¥äº’å‹•å•ç­”ï¼Œèˆ‰ä¾‹ï¼Œæˆ–æ˜¯æ›å¥è©±èªª&lt;/li&gt;
&lt;li&gt;éš±æ€§çŸ¥è­˜æœªè¢«ç³»çµ±åŒ–å„²å­˜(ä¾‹å¦‚ï¼šå£é ­å‚³æ‰¿ã€slack è¨è«–ã€æœƒè­°ç´€éŒ„ç­‰)&lt;/li&gt;
&lt;li&gt;æŸ¥è©¢æµç¨‹èˆ‡é–‹ç™¼æµç¨‹è„«ç¯€&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æƒ…å¢ƒæ–°äººå·¥ç¨‹å¸«è¦å¦‚ä½•åˆ°-k8s-doc-æŸ¥åˆ°æƒ³è¦çš„å…§å®¹&#34;&gt;æƒ…å¢ƒï¼šæ–°äººå·¥ç¨‹å¸«è¦å¦‚ä½•åˆ° k8s doc æŸ¥åˆ°æƒ³è¦çš„å…§å®¹ï¼Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰å•é¡Œå» google / stack overflow&lt;/li&gt;
&lt;li&gt;éœ€è¦æœå°‹å¼•æ“(k8s doc æœ‰æä¾›ï¼Œä½†å…§éƒ¨æ–‡ä»¶ç³»çµ±ä¸ä¸€å®šæœ‰)&lt;/li&gt;
&lt;li&gt;éœ€è¦é—œéµå­—(æ–°äººæ€éº¼çŸ¥é“è¦æŸ¥ Dynamic Persistent Volume Resizing)&lt;/li&gt;
&lt;li&gt;å”åŠ©ç†è§£ï¼ˆèˆ‰ä¾‹ï¼Œæ›å¥è©±èªªï¼‰&lt;/li&gt;
&lt;li&gt;è·¨èªè¨€é–€æª»&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  k8s doc æœ‰æä¾›é—œéµå­—æœå°‹ï¼Œé€™å€‹æœå°‹åŠŸèƒ½æ˜¯æ€éº¼åšçš„ï¼Ÿ
Programmable Search Engineï¼ˆPSEï¼‰https://developers.google.com/custom-search/docs/tutorial/introduction
Fulltext Search Engine ä¾‹å¦‚ elasticsearch ä½¿ç”¨ Lucene
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://www.wackybuttons.com/designcodes/0/110/1100986.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_ba0bedbef430605582db8405bbadfdf2.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_cbca56289ea87ea85283ee75ee320f80.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/search-in-k8s-official-doc_hu5ebc2a73ee3c44bde0730bde6bf194dd_99993_ba0bedbef430605582db8405bbadfdf2.webp&#34;
               width=&#34;760&#34;
               height=&#34;408&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/search/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/search/&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æƒ…å¢ƒsenior-å·¥ç¨‹å¸«è¦å¦‚ä½•åˆ†äº«çŸ¥è­˜&#34;&gt;æƒ…å¢ƒï¼šSenior å·¥ç¨‹å¸«è¦å¦‚ä½•åˆ†äº«çŸ¥è­˜ï¼Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ã€æˆ‘æœ‰å¯«ä¸€ç¯‡æ–‡ä»¶åœ¨æŸå€‹åœ°æ–¹ï¼Œä½ æ‰¾ä¸€ä¸‹ã€&lt;/li&gt;
&lt;li&gt;ã€æˆ‘å¿˜è¨˜å»å¹´ç‚ºä»€éº¼é€™æ¨£åšäº†ã€&lt;/li&gt;
&lt;li&gt;ã€æˆ‘å» Slack ä¸Šæ‰¾ä¸€ä¸‹ã€&lt;/li&gt;
&lt;li&gt;ã€ä½ è¦ä¸è¦å…ˆå»å• ChatGPTï¼Ÿã€&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ih1.redbubble.net/image.4690208405.0033/st,small,507x507-pad,600x600,f8f8f8.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æˆ‘å€‘ä¸æ˜¯æ‡¶ï¼Œè€Œæ˜¯ç¾åœ¨è¦è§£ç­”è¨±å¤šåŸºæœ¬å•é¡Œï¼ŒLLM å›ç­”å¾—æ¯”äººå¥½
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-è®“-devops-æ›´æ™ºæ…§çš„å³æ™‚åæ‡‰&#34;&gt;RAG è®“ DevOps æ›´æ™ºæ…§çš„å³æ™‚åæ‡‰&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æå‡çŸ¥è­˜ç²å–æ•ˆç‡: å…§éƒ¨æ–‡æª”çŸ¥è­˜AIåŠ©æ‰‹&lt;/li&gt;
&lt;li&gt;çŸ¥è­˜ç•™å­˜èˆ‡æ–°äºº Onboarding&lt;/li&gt;
&lt;li&gt;åŠ é€Ÿæ•…éšœæ’æŸ¥: æ ¹æ“šéŒ¯èª¤è¨Šæ¯è‡ªå‹•å¾ Runbook ä¸­æª¢ç´¢è™•ç†æ–¹å¼&lt;/li&gt;
&lt;li&gt;å„ªåŒ–æµç¨‹è‡ªå‹•åŒ–èˆ‡æå‡æ±ºç­–å“è³ª: é€šè¨Šè»Ÿé«”å°è©± botï¼Œè‡ªå‹•ç”Ÿæˆå»ºè­°&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;DevOps AI Copilot ä¸æ‡‰è©²åƒåœ–æ›¸é¤¨å®ˆé–€å“¡ç­‰äººä¾†å€Ÿæ›¸ï¼Œ
è€Œæ‡‰è©²åƒå°èˆªç³»çµ±ï¼Œåœ¨ä½ é–‹è»Šæ™‚ä¸»å‹•å‘Šè¨´ä½ ï¼šå‰æ–¹æœ‰å½é“ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;RAG + Context-Aware Knowledge Copilot&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  åŸºæœ¬ä¸Šæˆ‘å€‘æœŸå¾…çš„è§£æ±ºæ–¹æ¡ˆæ˜¯é€™æ¨£
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-vs-å…¶ä»–å·¥å…·&#34;&gt;RAG vs å…¶ä»–å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦å·¥å…·æå‡çŸ¥è­˜ç²å–æ•ˆç‡ï¼Œå¦‚ä½•é¸æ“‡ RAG æˆ–æ˜¯å…¶ä»– non-LLM å·¥å…·ï¼Ÿä¾‹å¦‚ search engine / fulltext search engine / search algorithm&lt;/li&gt;
&lt;li&gt;ç‰¹å®šä»»å‹™çš„æ•ˆèƒ½æ˜¯å¦å„ªæ–¼äººé¡&lt;/li&gt;
&lt;li&gt;å“ªè£¡é©åˆç”¨ RAGï¼Œå“ªè£¡é©åˆç”¨ non-LLM å·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  ä¾‹å¦‚
google search engine ä½†ç•¶ç„¶æˆ‘å€‘ä¸çŸ¥é“ä»–èƒŒå¾Œçš„å¯¦ä½œ
elasticsearch / lucene / fulltext search engine
GNU grep çš„ Boyerâ€“Moore string-search algorithm
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_8715252ce2925f2b574cec4bb2d0a84d.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_5705bdacf67afc9f8d81663d6d7fea49.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/rag-vs-code_hu9f4f7a7594cbcf741f81ea0e7ee1d93e_174431_8715252ce2925f2b574cec4bb2d0a84d.webp&#34;
               width=&#34;760&#34;
               height=&#34;481&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  é©åˆç”¨ RAG çš„æƒ…å¢ƒï¼šå®¢æœå•ç­”ã€æŠ€è¡“æœå°‹ã€çŸ¥è­˜å‹ Chatbotã€å…§éƒ¨çŸ¥è­˜å°èˆªã€‚
é©åˆç”¨å‚³çµ±ç¨‹å¼çš„æƒ…å¢ƒï¼šé‡‘æµæ§åˆ¶ã€æµç¨‹å¼•æ“ã€å¸³å‹™ç³»çµ±ã€å®‰å…¨æ§åˆ¶ã€‚
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æœ‰äº†å¤§èªè¨€æ¨¡å‹å¾Œ&#34;&gt;æœ‰äº†å¤§èªè¨€æ¨¡å‹å¾Œ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å» google -&amp;gt; å…ˆå• chatgptï¼Œåˆæ­¥å•ç­”ç†è§£å•é¡Œï¼Œæ‰¾åˆ°é—œéµå­—&lt;/li&gt;
&lt;li&gt;éœ€è¦æœå°‹å¼•æ“ -&amp;gt; chatgpt æ•´åˆï¼Œç›´æ¥ä¸Šç¶²æœå°‹&lt;/li&gt;
&lt;li&gt;éœ€è¦é—œéµå­— -&amp;gt; chatgpt å¹«ä½ æ‰¾åˆ°é—œéµå­—&lt;/li&gt;
&lt;li&gt;å”åŠ©ç†è§£ -&amp;gt; chatgpt èˆ‰ä¾‹ï¼Œæ›å¥è©±èªª&lt;/li&gt;
&lt;li&gt;è·¨èªè¨€é–€æª» -&amp;gt; chatgpt ç¿»è­¯&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  chatgpt æœƒç”¨é€šé †çš„èªè¨€å›ç­”å•é¡Œï¼ˆå„ªæ–¼å¹³å‡å·¥ç¨‹å¸«ï¼‰
&lt;/aside&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;chatgpt æœƒç”¨é€šé †çš„èªè¨€ï¼Œå¿«é€Ÿï¼ˆæ•¸ç§’å…§ï¼‰ä¸Šç¶²æœå°‹ï¼Œå›ç­”å•é¡Œ&lt;/li&gt;
&lt;li&gt;éç¨‹ä¸­ä¸å­å…¶ç…©åœ°å•ç­”ï¼Œæ›å¥è©±èªª&lt;/li&gt;
&lt;li&gt;å›ç­”çš„æ ¼å¼é«˜åº¦å®¢è£½åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id=&#34;llm-ä¸å…·å‚™å°ˆæ¥­çŸ¥è­˜ç¼ºä¹å…§å®¹æ ¹æ“šæ™‚å®¹æ˜“ç”¢ç”Ÿå¹»è¦ºhallucination&#34;&gt;LLM ä¸å…·å‚™å°ˆæ¥­çŸ¥è­˜ã€‚ç¼ºä¹å…§å®¹æ ¹æ“šæ™‚ï¼Œå®¹æ˜“ç”¢ç”Ÿå¹»è¦º(hallucination)&lt;/h5&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_9fe73f5f2b5339e829b4fd9ff27bd59e.webp 400w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_b69728d4bdba428622aca425a98eed1e.webp 760w,
               /zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2025-06-05-devops-rag-internal-ai/llm-hallucination_hu42174c29bc98b9089191b47b3864fba5_212700_9fe73f5f2b5339e829b4fd9ff27bd59e.webp&#34;
               width=&#34;500&#34;
               height=&#34;500&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  LLMï¼ˆå¤§å‹èªè¨€æ¨¡å‹ï¼‰æœ¬èº«ä¸¦ä¸å…·å‚™äº‹å¯¦çŸ¥è­˜ï¼Œè€Œæ˜¯ä¾è³´è¨“ç·´æ™‚çš„èªæ–™èˆ‡æç¤ºè¼¸å…¥ä¾†ç”Ÿæˆå›ç­”ã€‚ç•¶ç¼ºä¹æ˜ç¢ºä¸Šä¸‹æ–‡æˆ–å…§å®¹æ ¹æ“šæ™‚ï¼ŒLLM å®¹æ˜“å‡ºç¾ã€Œå¹»è¦ºã€ç¾è±¡ï¼Œå³ç”Ÿæˆçœ‹ä¼¼åˆç†ä½†å¯¦éš›ä¸æ­£ç¢ºçš„è³‡è¨Šã€‚å°ˆæ¥­é ˜åŸŸå•é¡Œè‹¥æœªæä¾›æº–ç¢ºè³‡æ–™æ”¯æ’ï¼Œä¹Ÿå®¹æ˜“å°è‡´éŒ¯èª¤å›ç­”ã€‚
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹-2&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç’°å¢ƒè¨­å®šï¼šç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è¨­å®šå¥½é–‹ç™¼ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;ç‚ºä»€éº¼éœ€è¦ RAGï¼ˆRetrieval-Augmented Generationï¼‰
&lt;ol&gt;
&lt;li&gt;RAG åœ¨ã€Œæ–‡ä»¶æª¢ç´¢èˆ‡æç¤ºã€ä¸Šå„ªæ–¼äººé¡&lt;/li&gt;
&lt;li&gt;LLM è£œå¼·å·¥ç¨‹å¸«çš„èªè¨€èƒ½åŠ›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Embedding Search&lt;/li&gt;
&lt;li&gt;DIY&lt;/li&gt;
&lt;li&gt;Evaluation&lt;/li&gt;
&lt;li&gt;k8s RAG QA.ipynb&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-workshop-æµç¨‹-3&#34;&gt;RAG Workshop æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç¢ºå®šåƒèˆ‡è€…éƒ½æœ‰è·‘ä¸€å¥—RAGèµ·ä¾†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Evaluation&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;k8s RAG QA.ipynb&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¦‚ä½•è©•ä¼°-rag-ç³»çµ±çš„å“è³ª&#34;&gt;å¦‚ä½•è©•ä¼° RAG ç³»çµ±çš„å“è³ª?&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;äººäººéƒ½æœƒä¸‹ promptï¼Œä½†æ˜¯èª°çš„ prompt æ›´å¥½ï¼Ÿæˆ–æ˜¯æ²’å·®åˆ¥ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é¸æ“‡ vector store çš„ chunking ç­–ç•¥ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å“ªå€‹ retriever æ›´å¥½ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¦å¦‚ä½•æŒçºŒæ”¹å–„ RAG ç³»çµ±ï¼Ÿä¸‹å€‹è¿­ä»£çš„æ”¹å–„æ–¹å‘æ˜¯ä»€éº¼ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ˜¯å¦ç¬¦åˆ production criteriaï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è©•ä¼°ç¢ºä¿å›ç­”å“è³ªå¯é æ€§èˆ‡å¯æ§æ€§&#34;&gt;è©•ä¼°ï¼šç¢ºä¿å›ç­”å“è³ªå¯é æ€§èˆ‡å¯æ§æ€§&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¿è­‰æ­£ç¢ºæ€§ï¼šæª¢ç´¢å‡ºçš„è³‡è¨Šæ˜¯æ­£ç¢ºçš„ï¼Œç”Ÿæˆçš„ç­”æ¡ˆå¿ å¯¦æ–¼åŸå§‹ context&lt;/li&gt;
&lt;li&gt;é™ä½å¹»è¦ºé¢¨éšªï¼šå³ä½¿æœ‰è³‡æ–™ï¼ŒLLM ä»å¯èƒ½äº‚ç·¨&lt;/li&gt;
&lt;li&gt;æ¸¬é‡ç³»çµ±å“è³ª&lt;/li&gt;
&lt;li&gt;æ”¹å–„ä¾æ“šï¼šå¹«åŠ©é©—è­‰Chunking ç­–ç•¥ï¼ŒPrompt è¨­è¨ˆï¼ŒRetriever æ¨¡å‹èª¿æ•´&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–ç›£æ§ï¼šå“è³ªè¿½è¹¤ã€å•é¡Œå®šä½ï¼Œå»ºç«‹é¡ä¼¼ APM çš„ QA æŒ‡æ¨™&lt;/li&gt;
&lt;li&gt;å° Stakeholder å±•ç¤ºæˆæ•ˆï¼šå¯è¦–åŒ–èˆ‡é‡åŒ–æŒ‡æ¨™ï¼Œæœ‰åŠ©æºé€šèˆ‡è³‡æºæŠ•å…¥&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;è©•ä¼°æ–¹å¼å»ºè­°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Retrievalï¼šRecall@K, MRR, nDCG&lt;/li&gt;
&lt;li&gt;Generationï¼šROUGE, BERTScore, GPTScore&lt;/li&gt;
&lt;li&gt;Faithfulnessï¼šä¾æ“šä¾†æºè³‡æ–™ç”Ÿæˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;äººå·¥æ¨™è¨»ï¼šç›¸é—œæ€§ã€æ­£ç¢ºæ€§ã€å¹«åŠ©ç¨‹åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;rag-æ‡‰ç”¨-ä»¥-k8s-official-docs-ç‚ºä¾‹&#34;&gt;RAG æ‡‰ç”¨: ä»¥ k8s official docs ç‚ºä¾‹&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç¸½çµ&#34;&gt;ç¸½çµ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç‚ºä»€éº¼éœ€è¦ RAG&lt;/li&gt;
&lt;li&gt;Embedding èˆ‡å‘é‡æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;Embedding Search&lt;/li&gt;
&lt;li&gt;DIY&lt;/li&gt;
&lt;li&gt;Evaluation&lt;/li&gt;
&lt;li&gt;k8s RAG QA&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h5 id=&#34;ç”±è¡·åœ°æ„Ÿè¬ç‚º-workshop-æä¾›å”åŠ©çš„å¤¥ä¼´&#34;&gt;ç”±è¡·åœ°æ„Ÿè¬ç‚º workshop æä¾›å”åŠ©çš„å¤¥ä¼´!&lt;/h5&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/pymia&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mia // Huai-Wen Chang&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/hunkue&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hunkue&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;maicoin-we-are-hiring&#34;&gt;MaiCoin: We are Hiring!!&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236558674/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior Site Reliability Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236555801&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior Data Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236555811&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior IT Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236556713&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Blockchain Engineer (Wallet Team)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236558714&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Senior Backend Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236523560/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Micro Service Software Engineer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/jobs/view/4236559632&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cyber Security Engineer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;diy--qa--å»ºè­°&#34;&gt;DIY + Q&amp;amp;A + å»ºè­°&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹æ¬¡æœƒæ”¹ç”¨ Colab&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Summit: Get started with Etcd &amp; Kubernetes</title>
      <link>https://chechia.net/zh-hant/talk/kubernetes-summit-get-started-with-etcd-kubernetes/</link>
      <pubDate>Wed, 23 Oct 2024 13:20:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/kubernetes-summit-get-started-with-etcd-kubernetes/</guid>
      <description>&lt;h1 id=&#34;å·¥ä½œåŠå…§å®¹&#34;&gt;å·¥ä½œåŠå…§å®¹&lt;/h1&gt;
&lt;p&gt;å…©å€‹å ´æ¬¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2024-10-23T13:20-14:50 @ 603+604&lt;/li&gt;
&lt;li&gt;2024-10-24T13:20-14:50 @ 605&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;get-started&#34;&gt;Get Started&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;è«‹é»æ“Šæœ¬é ä¸Šæ–¹æŠ•å½±ç‰‡é€£çµ&lt;/li&gt;
&lt;li&gt;Git clone æœ¬æ¬¡ workshop è³‡æº &lt;a href=&#34;https://github.com/chechiachang/etcd-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/etcd-playground&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ´»å‹•ç•¶å¤©ç¾å ´ï¼Œæœƒæä¾›ä¸€å° Linux VM åšä½¿ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h1 id=&#34;workshop&#34;&gt;Workshop&lt;/h1&gt;
&lt;p&gt;Get started with Etcd &amp;amp; Kubernetes / æ‰‹æŠŠæ‰‹æ­å»º Etcd èˆ‡ K8s&lt;/p&gt;
&lt;h3 id=&#34;outline&#34;&gt;Outline&lt;/h3&gt;
&lt;p&gt;Etcd æ˜¯ Kubernetes çš„é‡è¦å…ƒä»¶ä¹‹ä¸€ï¼Œæœ¬æ¬¡å·¥ä½œåŠå°‡å¸¶é ˜è§€çœ¾åˆæ¢ Etcdï¼ŒåŒ…å«å®‰è£ï¼Œè¨­å®šï¼Œä»¥åŠæ“ä½œã€‚ä¸¦è—‰ç”±æœ¬åœ°çš„ Etcd ä¾†æ¶è¨­ä¸€å€‹æœ€ç°¡å–®çš„ Kubernetes Clusterã€‚&lt;/p&gt;
&lt;p&gt;é è¨ˆå…§å®¹ï¼šç’°å¢ƒè¨­å®šï¼ŒEtcd è¨­å®šèˆ‡éƒ¨ç½²ï¼ŒEtcd åŸºç¤æ“ä½œï¼Œéƒ¨ç½² kube-apiserver / kube-controller-manager / kube-schedulerï¼Œä½¿ç”¨ kubectl æ“ä½œ Kubernetes Clusterã€‚è®“åƒèˆ‡è€…é€éæœ¬æ¬¡å·¥ä½œåŠï¼Œå¯ä»¥æœ‰æ“ä½œ k8s control plane çš„ç¶“é©—ï¼Œæ›´äº†è§£ Etcd çš„åŸºæœ¬æ“ä½œï¼Œä»¥åŠäº†è§£ Kubernetes çš„åŸºæœ¬æ¶æ§‹ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆè¦åŠƒä¸­ï¼‰æœ¬æ¬¡å·¥ä½œåŠæœƒæä¾›åƒèˆ‡è€…ä¸€å€‹ç°¡å–®çš„ç’°å¢ƒï¼Œè®“åƒèˆ‡è€…å¯ä»¥é€éé ç«¯æ“ä½œä¾†äº†è§£ Etcd çš„åŸºæœ¬æ“ä½œã€‚åƒèˆ‡è€…å¿…å‚™å€‹äººç­†é›»ï¼Œé€é SSH æ“æ§é ç«¯æ©Ÿå™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¿…å‚™çŸ¥è­˜ï¼šLinux æ“ä½œåŸºæœ¬çŸ¥è­˜ï¼ŒDocker æ“ä½œåŸºæœ¬çŸ¥è­˜ï¼Œæœƒä½¿ç”¨ SSH é€£ç·š / Bash / dockerã€‚
å·¥ä½œåŠæ™‚é–“ä¸å¤šï¼Œç¾å ´ä¸æœƒç´°è¬›æ¦‚å¿µå•é¡Œï¼Œåƒèˆ‡è€…éœ€è¦äº‹å‰é ç¿’åŸºæœ¬æ¦‚å¿µ &lt;a href=&#34;https://etcd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/&lt;/a&gt; èˆ‡ &lt;a href=&#34;http://play.etcd.io/play&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://play.etcd.io/play&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2024 Cloud Summit&lt;/li&gt;
&lt;li&gt;2024 SRE Conference&lt;/li&gt;
&lt;li&gt;2023 DevOpsDay Taipei&lt;/li&gt;
&lt;li&gt;2023 Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Summit: Upgrade A VM Based Cluster</title>
      <link>https://chechia.net/zh-hant/talk/kubernetes-summit-upgrade-a-vm-based-cluster/</link>
      <pubDate>Wed, 23 Oct 2024 13:20:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/kubernetes-summit-upgrade-a-vm-based-cluster/</guid>
      <description>&lt;h1 id=&#34;presentation&#34;&gt;Presentation&lt;/h1&gt;
&lt;p&gt;Upgrade A VM Based Clustermin&lt;/p&gt;
&lt;h3 id=&#34;target-group-æ”¶ç©«&#34;&gt;Target group æ”¶ç©«&lt;/h3&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›æœƒè¬›è§£å‡ç´šæ“ä½œï¼Œä½†ä¸ä¾·é™åœ¨å…·é«”æ­¥é©Ÿï¼Œè€Œæ˜¯å¸Œæœ›èƒ½è¬›è§£æ›´å¤š k8s æ¶æ§‹èˆ‡è¨­è¨ˆï¼Œè®“è§€çœ¾æœ‰ä»¥ä¸‹æ”¶ç©«ï¼šå¦‚ä½•å‡ç´š Kubernetes Cluster çš„ç‰ˆæœ¬ï¼Œå‡ç´šæ™‚æ‡‰è€ƒé‡çš„äº‹é …æœ‰å“ªäº›ï¼Œæœ‰ä»€éº¼å·¥å…·å¯ä»¥å”åŠ©å‡ç´šæµç¨‹ï¼Œé€éå‡ç´šæ›´äº†è§£ Kubernetes çš„æ¶æ§‹&lt;/p&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2024 Cloud Summit&lt;/li&gt;
&lt;li&gt;2024 SRE Conference&lt;/li&gt;
&lt;li&gt;2023 DevOpsDay Taipei&lt;/li&gt;
&lt;li&gt;2023 Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Hashicorp: managed database credentials with Hashicorp Vault</title>
      <link>https://chechia.net/zh-hant/talk/hashicorp-managed-database-credentials-with-hashicorp-vault/</link>
      <pubDate>Wed, 28 Aug 2024 11:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/hashicorp-managed-database-credentials-with-hashicorp-vault/</guid>
      <description>&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;è³‡æ–™åº«ç®¡ç†æ˜¯ä¸€å€‹å¾ˆå¤§çš„è­°é¡Œï¼šå¦‚ä½•ç®¡ç†è³‡æ–™åº«çš„å¸³è™Ÿå¯†ç¢¼ï¼Œå¦‚ä½•ç²¾ç¢ºçš„ç”¨æˆ¶è¨­å®šæ¬Šé™ï¼Œå‚³éå¯†ç¢¼çµ¦ç”¨æˆ¶ï¼Œä¸¦è‡ªå‹•åŒ–å®šæœŸæ›´æ–°å¯†ç¢¼ã€‚æœ¬å ´æ¼”è¬›å°‡åˆ†äº«å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ç®¡ç†è³‡æ–™åº«çš„å¸³è™Ÿå¯†ç¢¼ï¼Œä¸¦é€é AWS IAM Role èˆ‡ Kubernetes Service Account é€²è¡Œé©—è­‰ï¼Œå¦‚ä½•å®‰å…¨çš„å‚³éå¯†ç¢¼ï¼Œä¸¦å®‰å…¨åœ°é€£ç·šåˆ°è³‡æ–™åº«&lt;/p&gt;
&lt;p&gt;æ¶µè“‹ä»¥ä¸‹å…§å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;database å¸³è™Ÿå¯†ç¢¼ç®¡ç†çš„é›£é¡Œ&lt;/li&gt;
&lt;li&gt;ç°¡ä»‹ Vault èˆ‡ database secret engine&lt;/li&gt;
&lt;li&gt;åœ¨ vault ä¸­è¨­å®š database secret engine&lt;/li&gt;
&lt;li&gt;vault åœ¨éœ€è¦æ™‚è‡ªå‹•ç”¢ç”Ÿè³‡æ–™åº«å¸³è™Ÿå¯†ç¢¼&lt;/li&gt;
&lt;li&gt;vault é€éå®‰å…¨ä¾†æºèªè­‰ app èº«ä»½(ä½¿ç”¨ k8s service account èˆ‡ public cloud èªè­‰(aws iam role))&lt;/li&gt;
&lt;li&gt;å®Œæˆ app é€£ç·šè‡³ database çš„å·¥ä½œé€±æœŸ&lt;/li&gt;
&lt;li&gt;monitoring / auditï¼švault audit log + prometheus / grafana dashboard / alert manager&lt;/li&gt;
&lt;li&gt;ç¯„ä¾‹ï¼šå¦‚ä½•ä½¿ç”¨ terraform è¨­å®š vault èˆ‡ database secret engine&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;target-group&#34;&gt;Target group&lt;/h1&gt;
&lt;p&gt;æœ‰è³‡æ–™åº«ç®¡ç†éœ€æ±‚çš„å·¥ç¨‹å¸«ï¼Œæƒ³è¦å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ç®¡ç†è³‡æ–™åº«çš„å¸³è™Ÿå¯†ç¢¼ï¼Œä¸¦é€é AWS IAM Role èˆ‡ Kubernetes Service Account é€²è¡Œé©—è­‰ï¼Œå¦‚ä½•å®‰å…¨çš„å‚³éå¯†ç¢¼ï¼Œä¸¦å®‰å…¨åœ°é€£ç·šåˆ°è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2023 DevOpsDay&lt;/li&gt;
&lt;li&gt;2023 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Hashicorp: managed database credentials with Hashicorp Vault</title>
      <link>https://chechia.net/zh-hant/slides/2024-08-28-hashicorp-vault-database/</link>
      <pubDate>Tue, 20 Aug 2024 11:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2024-08-28-hashicorp-vault-database/</guid>
      <description>
&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;onepiece.png&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  æŠ•å½±ç‰‡è·Ÿè¬›ç¨¿æˆ‘éƒ½æ”¾åœ¨æˆ‘çš„ç¶²ç«™ä¸Šï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒ
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;Vault: Managed Database Credentials&lt;/p&gt;
&lt;p&gt;with Hashicorp Vault&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Che Chia Chang&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;About Me&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Che Chia Chang&lt;/li&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.linkedin.com/company/maicoin/jobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /media/mvp_huc01bc5a7b3b6fc804f96fcdc92de363e_32781_d6d605938b7a1c7fce3c5b400c9fc5d1.webp 400w,
               /media/mvp_huc01bc5a7b3b6fc804f96fcdc92de363e_32781_ad9bd2dee793a0109cd1099b629c6ffc.webp 760w,
               /media/mvp_huc01bc5a7b3b6fc804f96fcdc92de363e_32781_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/media/mvp_huc01bc5a7b3b6fc804f96fcdc92de363e_32781_d6d605938b7a1c7fce3c5b400c9fc5d1.webp&#34;
               width=&#34;20%&#34;
               height=&#34;20%&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;p&gt;ç›¸é—œè³‡æº&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/vault-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Demo ç¯„ä¾‹ç¨‹å¼ç¢¼ https://github.com/chechiachang/vault-playground&lt;/a&gt; &lt;strong&gt;Demo ç”¨é€”ï¼Œè«‹å……åˆ†ç†è§£å¾Œå†ä½¿ç”¨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/talk/hashicorp-managed-database-credentials-with-hashicorp-vault/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šæ—¥æŠ•å½±ç‰‡èˆ‡è¬›ç¨¿èˆ‡å…¶ä»–è³‡æº chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/talk/hashicorp-vault-on-aws-k8s-%E9%9B%B2%E7%AB%AF%E5%9C%B0%E7%AB%AF%E9%80%9A%E5%90%83%E7%9A%84%E7%A7%81%E9%91%B0%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2023 Vault é›²ç«¯çš„ç«¯é€šåƒçš„ç§é‘°ç®¡ç†å¹³å°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/4057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾é›¶é–‹å§‹å­¸Terraformæ‰‹æŠŠæ‰‹å…¥é–€&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å¤§ç¶±&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DB å¸³è™Ÿå¯†ç¢¼ç®¡ç†çš„é›£é¡Œ&lt;/li&gt;
&lt;li&gt;Vault DB &lt;strong&gt;secret engine&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Demo 1 éœ€è¦æ™‚è‡ªå‹•ç”¢ç”Ÿè³‡æ–™åº«å¸³è™Ÿå¯†ç¢¼&lt;/li&gt;
&lt;li&gt;Vault &lt;strong&gt;auth method&lt;/strong&gt; ç¬¬ä¸‰æ–¹èªè­‰èº«ä»½&lt;/li&gt;
&lt;li&gt;Demo 2 github login and auth&lt;/li&gt;
&lt;li&gt;ç¨‹å¼åŒ–æ¬Šé™ç®¡ç†èˆ‡ç¨½æŸ¥&lt;/li&gt;
&lt;li&gt;Demo 3 &lt;strong&gt;terraform&lt;/strong&gt; è¨­å®š vault èˆ‡ DB secret engine&lt;/li&gt;
&lt;li&gt;(çœ‹æ™‚é–“) monitoring / audit&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;DB å¸³è™Ÿå¯†ç¢¼ç®¡ç†çš„é›£é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èªè­‰(Authentication)
&lt;ul&gt;
&lt;li&gt;å¯†ç¢¼ä¿ç®¡èˆ‡æš´éœ²&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æˆæ¬Š(Authorization)&lt;/li&gt;
&lt;li&gt;å¯†ç¢¼æ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;èªè­‰å¯ä»¥æ›´å¥½
æˆæ¬Šå¯ä»¥æ›´å½ˆæ€§æ–¹ä¾¿
å¯†ç¢¼æ›´æ–°å¯ä»¥æ›´é »ç¹
å¯†ç¢¼æš´éœ²é¢¨éšªå¯ä»¥è¢«å‹•æ§åˆ¶&lt;/p&gt;
&lt;p&gt;é‡è¦ç¨‹åº¦ç¬¬ä¸€è€ƒé‡æ˜¯è³‡è¨Šå®‰å…¨
ç¬¬äºŒæ˜¯ç®¡ç†æ–¹ä¾¿åº¦ï¼Œæœ‰æ²’æœ‰ utility å¯ä»¥å¹«æˆ‘å€‘ç®¡ç†&lt;/p&gt;
&lt;p&gt;åº•ä¸‹é€éä¸€å€‹ user story ä¾†èªªæ˜é€™äº›é›£é¡Œ&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;Authentication èªè­‰&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;you are who you say you are&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Authorization æˆæ¬Š&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;you are allowed to do what you are trying to do&lt;/p&gt;
&lt;/blockquote&gt;
&lt;aside class=&#34;notes&#34;&gt;
  åè©è§£é‡‹
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;User Story&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹appï¼Œç‚ºappè¨­å®šäº†ä¸€å€‹è³‡æ–™åº«&lt;/li&gt;
&lt;li&gt;è³‡æ–™åº«å­˜æ”¾appè³‡æ–™ï¼Œåªæœ‰appèƒ½å­˜å–è³‡æ–™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;strong&gt;å¸³è™Ÿå¯†ç¢¼&lt;/strong&gt;èªè­‰ï¼Œappå¯ä»¥å­˜å–è³‡æ–™åº«&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;app(username=app, password) &amp;gt; DB&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DB &amp;gt; hi, app!&lt;/strong&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å¸‚é¢ä¸Šæœ‰å¾ˆå¤šè³‡æ–™åº«ï¼Œéƒ½æ˜¯ä½¿ç”¨å¸³è™Ÿå¯†ç¢¼ä¾†èªè­‰appçš„èº«ä»½
ç”¢ç”Ÿç¬¬ä¸€å€‹é›£é¡Œï¼Œå°±æ˜¯å¸³è™Ÿå¯†ç¢¼çš„å­˜æ”¾èˆ‡ç®¡ç†
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/èªè­‰&lt;/p&gt;
&lt;p&gt;å°æ–¼è³‡æ–™åº«ä¾†èªªï¼Œ&lt;strong&gt;username=app&lt;/strong&gt;çš„äººï¼Œå°±æ˜¯app&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰å¸³è™Ÿå¯†ç¢¼æ˜¯å¦å°±ç›¸ä¿¡ä»–æ˜¯appï¼Ÿ&lt;/li&gt;
&lt;li&gt;æœ‰æ²’æœ‰è³¬è™Ÿå¯†ç¢¼ä»¥å¤–çš„æ–¹å¼ç¢ºèªappçš„èº«ä»½ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  ç„¶è€Œé€™è·Ÿæˆ‘å€‘çš„ user story é‚„æ˜¯æœ‰è½å·®
å…¶ä¸­ä¹Ÿéš±è—è³‡å®‰é¢¨éšª
æˆ‘å€‘å¾ˆç¿’æ…£ä½¿ç”¨å¸³è™Ÿå¯†ç¢¼ä¾†èªè­‰èº«ä»½ï¼Œä½†æ˜¯éš¨è‘—æ™‚ä»£æ¼”é€²ï¼Œé§­å®¢æœ‰æ›´å¤šæ–¹æ³•å–å¾—å¸³è™Ÿå¯†ç¢¼
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/èªè­‰/å¯†ç¢¼ä¿ç®¡èˆ‡æš´éœ²&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dba éœ€è¦é–‹ç™¼dbï¼Œæ‰‹ä¸Šæœ‰adminå¸³è™Ÿå¯†ç¢¼&lt;/li&gt;
&lt;li&gt;è³‡å®‰é¢¨éšª
&lt;ul&gt;
&lt;li&gt;é–‹ç™¼æ©Ÿå™¨å®‰è£æƒ¡æ„è»Ÿé«”/å´éŒ„å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;å¸³è™Ÿå¯†ç¢¼è¢«ç«Šå–&lt;/li&gt;
&lt;li&gt;å“¡å·¥åˆ†é–‹ç§äººèˆ‡å…¬å¸é›»è…¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  é§­å®¢å°‡é–‹æºçš„å·¥å…·ä¿®æ”¹ï¼Œå¢åŠ å¾Œé–€ï¼Œç„¶å¾Œ release çµ¦ admin
å¤ éç¤¾äº¤å·¥ç¨‹ï¼Œè®“ admin ä¸çŸ¥ä¸è¦ºå®‰è£äº†æƒ¡æ„è»Ÿé«”
å¾ˆé–‹å¿ƒæ‹¿ä¾†ç”¨ï¼Œä½†æ˜¯é€™å€‹å·¥å…·å´éŒ„äº† admin çš„å¸³è™Ÿå¯†ç¢¼
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/èªè­‰/å¯†ç¢¼æš´éœ²&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´åš´è¬¹çš„èº«ä»½ç¢ºèªï¼Œæ›´é›£è¢«ç ´è§£
&lt;ul&gt;
&lt;li&gt;ex Client Certificate Authentication&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®‰å…¨çš„å­˜æ”¾å¯†ç¢¼ï¼Œé¿å…å¯†ç¢¼æš´éœ²&lt;/li&gt;
&lt;li&gt;æ›´å¥½çš„åšæ³•
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦å­˜æ”¾å¯†ç¢¼ï¼Œå»èƒ½ä½¿ç”¨å¯†ç¢¼??&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;æ”¾åœ¨ Vault è£¡é¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ä»¥å¾€æˆ‘å€‘æ²’æœ‰æ›´å¥½çš„æ–¹å¼ä¾†ç¢ºèªappçš„èº«ä»½ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨å¸³è™Ÿå¯†ç¢¼
é‡å°å¯†ç¢¼å¼·åº¦ï¼Œç¾åœ¨æœ‰æ›´å¥½çš„æ–¹å¼ä¾†ç¢ºèªappçš„èº«ä»½ï¼Œä¾‹å¦‚ Client Certificate Authentication
æä¾›æ›´åš´è¬¹çš„èº«ä»½ç¢ºèªï¼Œç¾åœ¨è¨±å¤šè³‡æ–™åº«éƒ½æ”¯æ´ tlsï¼Œå¯ä»¥é€étlsä¾†ç¢ºèªappçš„èº«ä»½
å®Œæ•´çš„èªè­‰ï¼Œå…¬æ­£çš„ ca ç°½ç™¼ï¼Œcerts å¾ˆé›£è¢«æš´åŠ›ç ´è§£&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘è¦é¢å°çš„æ˜¯å¦å¤–ä¸€å±¤çš„é¢¨éšªï¼Œå°±æ˜¯å¯†ç¢¼æš´éœ²
å°±ç®—ä½ æ‰‹ä¸Šæ˜¯æœ‰ä¸€å€‹å¾ˆå¼·çš„å¯†ç¢¼ï¼Œä½†æ˜¯ä½ çš„é–‹ç™¼æ©Ÿå™¨è¢«é§­ï¼Œå¯†ç¢¼å°±è¢«ç«Šå–äº†
dba æ‰‹ä¸Šæœ‰å­˜ admin å¸³è™Ÿå¯†ç¢¼çš„
æœ‰ç”¨å¯†ç¢¼ç®¡ç†å™¨ 1password ï¼Œæœ‰æ¯”è¼ƒå¥½ï¼Œå› ç‚ºä»–å¹«ä½ åšåŠ å¯†èˆ‡å„²å­˜ï¼Œä½†ä¹Ÿä¸èƒ½æœŸå¾… 1password æ°¸ä¸è¢«é§­
å¦‚æœä½ æ‰‹ä¸Šçš„å¯†ç¢¼é‡è¦ç¨‹åº¦éå¸¸é«˜ï¼Œé«˜éå¯†ç¢¼å·¥å…·å¯ä»¥æ‰¿æ“”çš„é¢¨éšªï¼Œé‚£ä½ å°±è¦è€ƒæ…®ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼ä¾†ç®¡ç†å¯†ç¢¼&lt;/p&gt;
&lt;p&gt;æœ‰æ²’æœ‰å¯èƒ½ dba/sre æ‰‹ä¸Šä¸è¦æœ‰å¸³è™Ÿå¯†ç¢¼ï¼Œè€Œæ˜¯ç”±å…§ç¶²çš„ vault ä¾†ç®¡ç†å¸³è™Ÿå¯†ç¢¼&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/databases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vault DB secret engine&lt;/a&gt;&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /media/vault/secret-database-flow_hucf0bd76ccd01fc5e85e88f0f3b42ba2d_27443_35a1884aeacb35c29264a054e10ce68f.webp 400w,
               /media/vault/secret-database-flow_hucf0bd76ccd01fc5e85e88f0f3b42ba2d_27443_a23c35c2ae98acc4f9cadfe7fd6beb09.webp 760w,
               /media/vault/secret-database-flow_hucf0bd76ccd01fc5e85e88f0f3b42ba2d_27443_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/media/vault/secret-database-flow_hucf0bd76ccd01fc5e85e88f0f3b42ba2d_27443_35a1884aeacb35c29264a054e10ce68f.webp&#34;
               width=&#34;90%&#34;
               height=&#34;90%&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/databases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vault DB secret engine&lt;/a&gt;&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://www.datocms-assets.com/2885/1576778435-vault-db.png?fit=max&amp;amp;q=80&amp;amp;w=2000&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;90%&#34; height=&#34;90%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/databases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vault DB secret engine&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦æ™‚è‡ªå‹•ç”¢ç”ŸDBä½¿ç”¨è€…å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;çŸ­æ•ˆæœŸä½¿ç”¨è€…èˆ‡å¯†ç¢¼ ex 1hr&lt;/li&gt;
&lt;li&gt;ä¸å»¶å±•è‡ªå‹•åˆ°æœŸï¼Œåˆªé™¤ä½¿ç”¨è€…&lt;/li&gt;
&lt;li&gt;æœªå®Œæˆå·¥ä½œå¯ä»¥è‡ªå‹•å»¶å±•&lt;/li&gt;
&lt;li&gt;appå¯ä»¥ä¸€ç›´å–å¾—æ–°ä½¿ç”¨è€…èˆ‡å¯†ç¢¼&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;User Story (v2)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªæœ‰ vault æœ‰ admin å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;user éœ€è¦æ™‚ï¼Œvault å‹•æ…‹ç”¢ç”Ÿ&lt;strong&gt;çŸ­æ•ˆæœŸä½¿ç”¨è€…èˆ‡å¯†ç¢¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ•ˆæœŸåˆ°è‡ªå‹•åˆªé™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ vault library ç¨‹å¼åŒ–é€£ç·š db
&lt;ul&gt;
&lt;li&gt;ä¸åœ¨é–‹ç™¼æ©Ÿå™¨ä¸Šå­˜å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;ä¸æ‰‹å‹•è¼¸å…¥å¯†ç¢¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;Vault DB secret engine æ”¯æ´ï¼Œæ²’æ”¯æ´å¯ä»¥è‡ªå·±å¯« plugin&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /media/vault/vault-secrets-databases_hud58a0e525517570057b3257917594d7a_260292_b88115a14e6e31ec40a3cf86015e92cd.webp 400w,
               /media/vault/vault-secrets-databases_hud58a0e525517570057b3257917594d7a_260292_ea64439a37fc602255503ad4101d0742.webp 760w,
               /media/vault/vault-secrets-databases_hud58a0e525517570057b3257917594d7a_260292_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/media/vault/vault-secrets-databases_hud58a0e525517570057b3257917594d7a_260292_b88115a14e6e31ec40a3cf86015e92cd.webp&#34;
               width=&#34;90%&#34;
               height=&#34;90%&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;p&gt;Demo 1: Vault DB secret engine&lt;/p&gt;
&lt;p&gt;Setup&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:chechiachang/vault-playground.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd vault-playground/deploy/04-docker-and-db/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker-compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it 04-docker-and-db-mariadb_1-1 bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it 04-docker-and-db-vault_1-1 sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apk update &amp;amp;&amp;amp; apk add mysql-client
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mysql -h mariadb_1 -u root -p
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;Demo 1: Vault DB secret engine&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// Connect to docker vault
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;export VAULT_ADDR=http://127.0.0.1:8200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// Configure secret engine database (terraform)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd usage/03-terraform-lives
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;Demo 1: Vault DB secret engine&lt;/p&gt;
&lt;p&gt;Use database secret engine&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// root configure (already done by terraform)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault list localhost_mariadb/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault read localhost_mariadb/config/localhost_mariadb 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault list localhost_mariadb/roles
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault read localhost_mariadb/roles/database_admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy read dba
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// create token for dba (will automatically done in Demo 2)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token create -policy=dba -display-name=dba \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -ttl=1h -use-limit=5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;Demo 1: Vault DB secret engine&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// auth as dba
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault read localhost_mariadb/creds/database_admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mysql --sql -h localhost -u &amp;lt;username&amp;gt; -p
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// do dba things
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;show databases;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;select user from mysql.user;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;exit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;è§£æ±ºå­˜æ”¾èˆ‡å–ç”¨ï¼Œå›åˆ°é›£é¡Œ/èªè­‰&lt;/p&gt;
&lt;p&gt;å°æ–¼è³‡æ–™åº«ä¾†èªªï¼Œ&lt;strong&gt;username=app&lt;/strong&gt;çš„äººï¼Œå°±æ˜¯app&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰å¸³è™Ÿå¯†ç¢¼æ˜¯å¦å°±ç›¸ä¿¡ä»–æ˜¯appï¼Ÿ&lt;/li&gt;
&lt;li&gt;æœ‰æ²’æœ‰è³¬è™Ÿå¯†ç¢¼ä»¥å¤–çš„æ–¹å¼ç¢ºèªappçš„èº«ä»½ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;Vault çš„è§£æ±ºæ–¹æ¡ˆ&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /media/vault/vault-identity-based-security_hu402a17fe06332c2e538a5d7636449ecf_286984_5179beccc62b906442cf3110172671f2.webp 400w,
               /media/vault/vault-identity-based-security_hu402a17fe06332c2e538a5d7636449ecf_286984_68081a16f8fb054125c67b67c563be91.webp 760w,
               /media/vault/vault-identity-based-security_hu402a17fe06332c2e538a5d7636449ecf_286984_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/media/vault/vault-identity-based-security_hu402a17fe06332c2e538a5d7636449ecf_286984_5179beccc62b906442cf3110172671f2.webp&#34;
               width=&#34;90%&#34;
               height=&#34;90%&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/èªè­‰/Vault &lt;strong&gt;Auth method&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Vault ä»°è³´å¤–éƒ¨å¯ä¿¡ç¬¬ä¸‰æ–¹(trusted authority)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;user/app é€éç¬¬ä¸‰æ–¹å‹•æ…‹å–å¾—åˆæ³•çš„èº«ä»½&lt;/li&gt;
&lt;li&gt;aws / azure / gcp iam role / github / saml / LDAP &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é–‹ç™¼æ©Ÿå™¨ä¸Šæ²’æœ‰å¯†ç¢¼ï¼Œå°±ä¸æœƒå› ç‚ºæ©Ÿå™¨è¢«é§­/å´éŒ„ï¼Œé€ æˆå¯†ç¢¼æ´©æ¼&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  Vault ä»°è³´å¤–éƒ¨å¯ä¿¡ç¬¬ä¸‰æ–¹(trusted authority)
æŠŠlocalé–‹ç™¼æ©Ÿå™¨è¢«é§­çš„é¢¨éšªï¼Œè½‰ç§»åˆ°å…¶ä»–æ›´å®‰å…¨çš„åœ°æ–¹
aws / azure / gcp iam role / github / saml
å…§ç¶²çš„Vault
LDAP
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/èªè­‰/Vault Auth method/AWS&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IAM auth method&lt;/li&gt;
&lt;li&gt;EC2 auth method
&lt;ul&gt;
&lt;li&gt;é€é AWS API å»ç¢ºèªèº«ä»½&lt;/li&gt;
&lt;li&gt;ç™»å…¥çš„ aws user / åˆæ³•çš„ iam role&lt;/li&gt;
&lt;li&gt;vault é€é aws api å»æ ¸å°èº«ä»½&lt;/li&gt;
&lt;li&gt;æ ¸å°æ­£ç¢ºï¼Œvault æä¾›çŸ­æœŸ database credential çµ¦ user / app&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/aws&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;app è·‘åœ¨ Ec2 ä¸Šï¼Œä½¿ç”¨ Ec2 åšèªè­‰&lt;/a&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-08-28-hashicorp-vault-database/aws-auth-method_hu1b1088a0ba6f2509d5f251f49d805b90_161953_7ff24fbb2d3a1787febad7191f4de8ba.webp 400w,
               /zh-hant/slides/2024-08-28-hashicorp-vault-database/aws-auth-method_hu1b1088a0ba6f2509d5f251f49d805b90_161953_b34a552ce4f4dfc84d2e66a752b4b84e.webp 760w,
               /zh-hant/slides/2024-08-28-hashicorp-vault-database/aws-auth-method_hu1b1088a0ba6f2509d5f251f49d805b90_161953_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-08-28-hashicorp-vault-database/aws-auth-method_hu1b1088a0ba6f2509d5f251f49d805b90_161953_7ff24fbb2d3a1787febad7191f4de8ba.webp&#34;
               width=&#34;90%&#34;
               height=&#34;90%&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;EC2 auth method
å¦‚æœä½ æœ‰ä½¿ç”¨ aws ec2ï¼Œå¯ä»¥é€é aws api ä¾†å–å¾— iam role / ec2 metadata&lt;/p&gt;
&lt;p&gt;ç”±æ–¼ database æœ¬èº«çš„èªè­‰æ©Ÿåˆ¶æœ‰é™ï¼Œæˆ‘å€‘å¯ä»¥é€é vault ä¾†ç®¡ç†å¸³è™Ÿå¯†ç¢¼
å°‡ç™»å…¥çš„è³‡å®‰ç®¡ç†äº¤çµ¦æ›´åš´è¬¹çš„ç¬¬ä¸‰æ–¹&lt;/p&gt;
&lt;p&gt;aws login æ¯”å–®ç´” mysql login å®‰å…¨ï¼Œå› ç‚ºå¤šäº†æ›´å¤šèªè­‰æª¢æŸ¥
access key / password / MFA
ip ä¾†æºæª¢æŸ¥
ratelimit
DDOS protection
æœ‰å•é¡Œæ™‚æœƒæœ‰ audit log&lt;/p&gt;
&lt;p&gt;auth method æ··æ­
å¯ä»¥é¢å°ä¸åŒçš„è³‡å®‰é¢¨éšª&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://www.hashicorp.com/blog/dynamic-database-credentials-with-vault-and-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;app è·‘åœ¨ Kubernetes ä¸Šï¼Œä½¿ç”¨ Service Account åšèªè­‰&lt;/a&gt;&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://www.datocms-assets.com/2885/1578078487-screen-shot-2020-01-03-at-19-07-14.png?fit=max&amp;amp;q=80&amp;amp;w=2000&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;90%&#34; height=&#34;90%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨ Vault auth methodï¼Œä¿¡ä»»ç¬¬ä¸‰æ–¹å–å¾—èº«ä»½
å¾é›™æ–¹æŸ¥æ ¸ï¼Œè®Šæˆä¸‰æ–¹æŸ¥æ ¸&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ‰æ”¯æ´çš„ auth methodï¼Œå¯ä»¥è‡ªå·±æ­é…&lt;/a&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-08-28-hashicorp-vault-database/auth-methods_hu66061cce719dc6d5d1ccf40fb31e1212_513352_8db173cd34745c666206ef66a8a4b3e4.webp 400w,
               /zh-hant/slides/2024-08-28-hashicorp-vault-database/auth-methods_hu66061cce719dc6d5d1ccf40fb31e1212_513352_8f1549438652c6fc209b8b5e6cd78328.webp 760w,
               /zh-hant/slides/2024-08-28-hashicorp-vault-database/auth-methods_hu66061cce719dc6d5d1ccf40fb31e1212_513352_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-08-28-hashicorp-vault-database/auth-methods_hu66061cce719dc6d5d1ccf40fb31e1212_513352_8db173cd34745c666206ef66a8a4b3e4.webp&#34;
               width=&#34;90%&#34;
               height=&#34;90%&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;ul&gt;
&lt;li&gt;user auth method
&lt;ul&gt;
&lt;li&gt;aws/gcp/azure iam role, github, saml, LDAP&lt;/li&gt;
&lt;li&gt;Login MFA&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;appä½¿ç”¨auth methodèªè­‰
&lt;ul&gt;
&lt;li&gt;aws/gcp/azure iam role (ec2 role)&lt;/li&gt;
&lt;li&gt;kubernetes api server (pod service account)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;User Story (v3)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªåšä¸€æ¬¡ï¼šVault è¨­å®š DB secret engine&lt;/li&gt;
&lt;li&gt;user æœ¬æ©Ÿä¸å­˜æ”¾ DB å¸³è™Ÿå¯†ç¢¼&lt;/li&gt;
&lt;li&gt;user/app é€é Vault auth method
&lt;ul&gt;
&lt;li&gt;user aws iam role&lt;/li&gt;
&lt;li&gt;app k8s service account&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;user/appå¯ä»¥å­˜å–vaultä¸­çš„dbå¸³è™Ÿå¯†ç¢¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;app &amp;gt; trusted authority&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;app &amp;lt; (identity) &amp;lt; trusted authority&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;app &amp;gt; (identity) &amp;gt; vault &amp;gt; trusted authority&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;app &amp;lt; (DB credential) &amp;lt; vault&lt;/strong&gt;&amp;gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;Demo 2: Auth method&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/github&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/auth/github&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// root 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy read sre
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault list auth/github-chechia-net/map/users
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault read auth/github-chechia-net/map/users/chechiachang
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault list auth/github-chechia-net/map/teams
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault read auth/github-chechia-net/map/teams/sre
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth help github-chechia-net
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// user (github login)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login -method=github -path=github-chechia-net token=$TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault read localhost_mariadb/creds/database_admin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;Demo 2: Auth method&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/aws&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/auth/aws&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// User login Public Cloud
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec dev -- vault login -method=aws -path=aws=sre
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud ... vault login -method=gcp -path=gcp=sre
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;az login ... vault login -method=azure -path=azure=sre
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// app login k8s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›£é¡Œ/èªè­‰/Vault Auth method/Kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;app &amp;gt; sa -&amp;gt; k8s api server -&amp;gt; vault -&amp;gt; DB&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&#34;https://developer.hashicorp.com/vault/docs/platform/k8s/injector&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s vault injector&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;app è·‘åœ¨ Podï¼ŒPod å–å¾— k8s service account çŸ­æœŸ jwt token&lt;/li&gt;
&lt;li&gt;app é€é jwt token çµ¦ vault è²ç¨±è‡ªå·±æ˜¯ app
&lt;ul&gt;
&lt;li&gt;vault ä½¿ç”¨ jwt token èˆ‡ k8s api server æ ¸å° pod service account&lt;/li&gt;
&lt;li&gt;k8s æ ¸å°æˆåŠŸï¼Œvault èªç‚º app æ˜¯ k8s ä¸­çš„ app&lt;/li&gt;
&lt;li&gt;vault æä¾›çŸ­æœŸ database credential çµ¦ app&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;app ä½¿ç”¨çŸ­æœŸ database credential å­˜å–è³‡æ–™åº«&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/èªè­‰/Vault Auth method/å°çµ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°å­˜æ”¾ password çš„é¢¨éšª&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰å…¬æœ‰é›²ï¼Œå­˜æ”¾é›²ç«¯æœå‹™
&lt;ul&gt;
&lt;li&gt;é€šéæª¢é©—ä¸”åˆè¦çš„å®‰å…¨ç³»çµ±&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åœ°ç«¯ï¼Œä½¿ç”¨ vault ä¾†ç®¡ç†å¸³è™Ÿå¯†ç¢¼
&lt;ul&gt;
&lt;li&gt;å­˜æ”¾ admin&lt;/li&gt;
&lt;li&gt;å‹•æ…‹ç”¢ç”Ÿ db user&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æœ€å®¹æ˜“è¢«é§­çš„ï¼Œä¸æ˜¯åœ°ç«¯ç¶²è·¯è¢«æ‰“ç©¿ï¼Œè€Œæ˜¯ admin çš„é–‹ç™¼æ©Ÿå™¨å­˜æ”¾å¸³è™Ÿå¯†ç¢¼ï¼Œè¢«é‡£é­šè¢«å´éŒ„è¢«ç«Šå–
ç”¨äº†å¾ˆå¥½çš„é˜²ç«ç‰†ï¼Œä½†æ˜¯ admin çš„é–‹ç™¼æ©Ÿå™¨å­˜æ”¾å¸³è™Ÿå¯†ç¢¼ï¼Œæˆ–æ˜¯ 1password
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;User Story (v?)&lt;/p&gt;
&lt;p&gt;éœ€æ±‚æœƒä¸€ç›´æ”¹è®Š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;app å­˜å–è³‡æ–™ï¼Œè®Šæˆ&lt;/li&gt;
&lt;li&gt;app + admin + metabase ä¸åŒæ¬Šé™&lt;/li&gt;
&lt;/ol&gt;
&lt;aside class=&#34;notes&#34;&gt;
  éœ€æ±‚æœƒä¸€ç›´æ”¹è®Šï¼Œç›®å‰ç®¡ç†æ–¹å¼æœ‰è¶³å¤ çš„å½ˆæ€§å»é¢å°éœ€æ±‚çš„æ”¹è®Šå—ï¼Ÿ
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/æˆæ¬Š&lt;/p&gt;
&lt;p&gt;MySQL ç‚ºä¾‹ï¼Œä½¿ç”¨ sql ç®¡ç†æˆæ¬Š&lt;/p&gt;
&lt;p&gt;user based access control&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;grant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mydb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;%&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;grant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mydb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;%&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;grant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mydb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metabase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;%&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;role based access control&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;myrole&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;grant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mydb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;myrole&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;grant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;myrole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;%&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/æˆæ¬Š/Scale up&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scale upï¼Œ100 å€‹ user x 100 å€‹ database&lt;/li&gt;
&lt;li&gt;æ¬Šé™è®Šæ›´é›£ review&lt;/li&gt;
&lt;li&gt;è®Šæ›´æˆæ¬Šçš„admin useræ¬ŠåŠ›å¾ˆå¤§ï¼Œå¦‚ä½•å­˜æ”¾ç®¡ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  100 å€‹ userï¼Œå°±è¦ä¸‹ 100 æ¬¡ sql grant role
100 å€‹ databaseï¼Œå°±è¦ä¸‹ x100 æ¬¡ sql grant role
æœ‰äººé›¢è·å†é€²ä¾†ä¸‹ sql
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/æˆæ¬Š/Scale up&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-hcl&#34; data-lang=&#34;hcl&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;mysql_role&amp;#34; &amp;#34;myrole&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  for_each&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;roles&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  name&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;each&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;mysql_grant&amp;#34; &amp;#34;developer&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  for_each&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;roles&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  role&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;each&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  database&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;each&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;database&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  privileges&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;each&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;privilleges&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SELECT&amp;#34;, &amp;#34;UPDATE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  SQL ä¹Ÿå¯ä»¥å¯« loopï¼Œä¹Ÿå¯ä»¥å¯« unit test
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/æˆæ¬Š/PR Review&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Terraform ç®¡ç† MySQL æˆæ¬Š&lt;/li&gt;
&lt;li&gt;Terraform æœ‰æ¯”è¼ƒå¥½å—ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;ç¨‹å¼åŒ–è¨­å®š&lt;/li&gt;
&lt;li&gt;Reviewable / Testable code&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è«‹è¦‹&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/4057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾é›¶é–‹å§‹å­¸Terraformæ‰‹æŠŠæ‰‹å…¥é–€&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é€é terraform ä¾†ç®¡ç†è³‡æ–™åº«çš„æˆæ¬Šï¼Œå¯ä»¥è®“æˆ‘å€‘æ›´æ–¹ä¾¿çš„ç®¡ç†æˆæ¬Š&lt;/p&gt;
&lt;p&gt;æŠŠ mysql admin username/password æ”¾åœ¨é›²ç«¯ ex. aws secret managerï¼Œé€é terraform ä¾†å–å¾—å¸³è™Ÿå¯†ç¢¼&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;é›£é¡Œ/æˆæ¬Š/Automation&lt;/p&gt;
&lt;p&gt;Vault ç®¡ç†æˆæ¬Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Or Vault + Terraformï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;database_admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;database_readonly
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;database_write
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy read database_write
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &amp;#34;chechia-net-myapp/database/database&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  capabilities = [&amp;#34;create&amp;#34;, &amp;#34;read&amp;#34;, &amp;#34;update&amp;#34;, &amp;#34;patch&amp;#34;, &amp;#34;delete&amp;#34;, &amp;#34;list&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  å¾ˆé‡è¦æ‰€ä»¥å†èªªä¸€æ¬¡
å¦‚æœä½ æœ‰ç”¨é›²ç«¯æœå‹™ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨é›²ç«¯æœå‹™ä¾†ç®¡ç†å¸³è™Ÿå¯†ç¢¼
å¦‚æœä½ æ˜¯åœ°ç«¯ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ vault ä¾†ç®¡ç†å¸³è™Ÿå¯†ç¢¼
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;Demo 3: Terraform è¨­å®š Vault èˆ‡ DB secret engine&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// destroy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd vault-playground/usage/03-terraform-lives
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt destroy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd vault-playground/deploy/04-docker-and-db/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker-compose down
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// create new
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker-compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd vault-playground/usage/03-terraform-lives
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;Demo 3: Terraform è¨­å®š Vault èˆ‡ DB secret engine&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹å¼åŒ–æ¬Šé™æ§ç®¡
&lt;ul&gt;
&lt;li&gt;ä¸€éµè¨­å®šç’°å¢ƒ
&lt;ul&gt;
&lt;li&gt;CI/CD æ¸¬è©¦
&lt;ul&gt;
&lt;li&gt;fmt, lint, unit test&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;PR Review&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Automation planï¼Œapply
&lt;ul&gt;
&lt;li&gt;é¿å…äººå·¥æ“ä½œçš„å¤±èª¤èˆ‡é¢¨éšª&lt;/li&gt;
&lt;li&gt;DBA ä¸ç”¨å¯†ç¢¼æˆ– loginï¼Œå› ç‚ºæ ¹æœ¬ä¸é€£ prod DB&lt;/li&gt;
&lt;li&gt;incident ä¸€éµ roll back&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  sql ä¹Ÿéƒ½èƒ½åšï¼Œä¹Ÿéƒ½æœ‰å·¥å…·åœ¨åšï¼Œåªæ˜¯èªè¨€çš„æ€§è³ªå°è‡´é€™ä»¶äº‹å¥½ä¸å¥½åš
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;ç¸½çµ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Vault DB secret engine
&lt;ul&gt;
&lt;li&gt;ç®¡ç†è³‡æ–™åº«å¸³è™Ÿå¯†ç¢¼&lt;/li&gt;
&lt;li&gt;å‹•æ…‹ç”¢ç”Ÿ db user&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Vault auth method
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸‰æ–¹èªè­‰èº«ä»½&lt;/li&gt;
&lt;li&gt;Github / AWS IAM Role / Kubernetes Service Account&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Vault + Terraform
&lt;ul&gt;
&lt;li&gt;ç¨‹å¼åŒ–æ¬Šé™æ§ç®¡&lt;/li&gt;
&lt;li&gt;PR Review&lt;/li&gt;
&lt;li&gt;Automation planï¼Œapply&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h3&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Summit: Get started with etcd &amp; Kubernetes</title>
      <link>https://chechia.net/zh-hant/slides/2024-10-24-etcd-workshop/</link>
      <pubDate>Mon, 05 Aug 2024 00:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2024-10-24-etcd-workshop/</guid>
      <description>&lt;h3 id=&#34;etcd-workshop&#34;&gt;etcd Workshop&lt;/h3&gt;
&lt;h5 id=&#34;æœ¬æ¬¡-workshop-ä»¥-hands-on-çš„æ–¹å¼é€²è¡Œç´¯ç©æ“ä½œç¶“é©—ç‚ºä¸»è¬›è§£èˆ‡èªªæ˜ç‚ºè¼”è§€å¿µå…§å®¹æœ‰æº–å‚™æ•™æéœ€è¦åƒèˆ‡è€…è‡ªè¡Œé–±è®€&#34;&gt;æœ¬æ¬¡ workshop ä»¥ hands-on çš„æ–¹å¼é€²è¡Œï¼Œç´¯ç©æ“ä½œç¶“é©—ç‚ºä¸»ï¼Œè¬›è§£èˆ‡èªªæ˜ç‚ºè¼”ã€‚è§€å¿µå…§å®¹æœ‰æº–å‚™æ•™æï¼Œéœ€è¦åƒèˆ‡è€…è‡ªè¡Œé–±è®€&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;docker å•Ÿå‹• etcd&lt;/li&gt;
&lt;li&gt;etcdctl å­˜å– etcd&lt;/li&gt;
&lt;li&gt;docker å•Ÿå‹• etcd cluster&lt;/li&gt;
&lt;li&gt;docker å•Ÿå‹• k8s control plane&lt;/li&gt;
&lt;li&gt;kubectl å­˜å– k8s control plane&lt;/li&gt;
&lt;li&gt;ç¶­é‹ k8s æ‰€éœ€çš„ etcd operation&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;åƒèˆ‡è€…éœ€è¦ä¸€å°é›»è…¦å¯ä»¥ä¸Šç¶²èƒ½å¤ é»æ»‘é¼ å³éµ&#34;&gt;åƒèˆ‡è€…éœ€è¦ä¸€å°é›»è…¦ï¼Œå¯ä»¥ä¸Šç¶²ï¼Œèƒ½å¤ é»æ»‘é¼ å³éµ&lt;/h5&gt;
&lt;hr&gt;
&lt;h3 id=&#34;etcd-workshop-1&#34;&gt;etcd Workshop&lt;/h3&gt;
&lt;h3 id=&#34;æ‰‹æŠŠæ‰‹æ­å»º-etcd-èˆ‡-k8s-å·¥ä½œåŠ&#34;&gt;æ‰‹æŠŠæ‰‹æ­å»º etcd èˆ‡ K8s å·¥ä½œåŠ&lt;/h3&gt;
&lt;p&gt;Che Chia Chang
&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é—œæ–¼æˆ‘&#34;&gt;é—œæ–¼æˆ‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Che Chia Chang&lt;/li&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.cake.me/companies/maicoin/jobs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å€‹äººéƒ¨è½æ ¼&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;presentation and speaker notes&lt;/li&gt;
&lt;li&gt;éµäººè³½ (Terraform / Vault æ‰‹æŠŠæ‰‹å…¥é–€)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;were-hiring&#34;&gt;We&amp;rsquo;re hiring!&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cake.me/companies/maicoin/jobs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.cake.me/companies/maicoin/jobs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-10-24-etcd-workshop/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_9da35ea5399dd4b247c69c19f4c75987.webp 400w,
               /zh-hant/slides/2024-10-24-etcd-workshop/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_55917817014d7ac627b45f9c4a791867.webp 760w,
               /zh-hant/slides/2024-10-24-etcd-workshop/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-10-24-etcd-workshop/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_9da35ea5399dd4b247c69c19f4c75987.webp&#34;
               width=&#34;400&#34;
               height=&#34;400&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¤§ç¶±&#34;&gt;å¤§ç¶±&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;docker å•Ÿå‹• etcd&lt;/li&gt;
&lt;li&gt;etcdctl å­˜å– etcd&lt;/li&gt;
&lt;li&gt;docker å•Ÿå‹• etcd cluster&lt;/li&gt;
&lt;li&gt;docker å•Ÿå‹• k8s control plane&lt;/li&gt;
&lt;li&gt;ç¶­é‹ k8s æ‰€éœ€çš„ etcd operation&lt;/li&gt;
&lt;li&gt;(Optional) æ­å»º Worker Node&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¦‚ä½•é€²è¡Œ-workshop&#34;&gt;å¦‚ä½•é€²è¡Œ workshop&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¬›å¸«æœƒåœ¨å°ä¸Šå¸¶é ­å½±ç‰‡çš„å…§å®¹&lt;/li&gt;
&lt;li&gt;åƒèˆ‡è€…åœ¨è‡ªå·±çš„æ©Ÿå™¨ä¸Šæ“ä½œ&lt;/li&gt;
&lt;li&gt;åƒèˆ‡è€…å¯ä»¥è·Ÿå°ä¸Šçš„é€²åº¦ï¼Œä¹Ÿå¯ä»¥è¶…å‰é€²åº¦å‘å¾Œæ“ä½œ&lt;/li&gt;
&lt;li&gt;é€²åº¦è½å¾Œä¸å¤ªæœƒå½±éŸ¿å¾ŒçºŒæ“ä½œï¼Œä¸å¿…æ“”å¿ƒ&lt;/li&gt;
&lt;li&gt;åŠ åˆ†é¡Œæ˜¯é‡è¦ï¼Œä½†æ²’æ™‚é–“æ–¼ä»Šæ—¥å®Œæˆçš„å…§å®¹ï¼Œè«‹è‡ªè¡Œåƒè€ƒ&lt;/li&gt;
&lt;li&gt;æœ‰å¾ˆå¤šå•é¡Œä¹Ÿå¾ˆæ­£å¸¸ï¼Œç”¢ç”Ÿç–‘å•ä¹Ÿæ˜¯å·¥ä½œåŠçš„ç›®çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¦‚ä½•å­˜å–é ç«¯vm&#34;&gt;å¦‚ä½•å­˜å–é ç«¯VM&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;è‡³&lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt; é ˜å–ä¸€å° VM ä¸¦ç°½å&lt;/li&gt;
&lt;li&gt;å¾è¬›å¸«å–å¾—ä½¿ç”¨è€…åç¨±èˆ‡å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç€è¦½å™¨ï¼Œé€é url é€£ç·šè‡³ä½ çš„ VMï¼Œè¼¸å…¥ä½¿ç”¨è€…åç¨±èˆ‡å¯†ç¢¼ç™»å…¥&lt;/li&gt;
&lt;li&gt;Protocol: SSHï¼Œport 22ï¼Œauthentication type: password&lt;/li&gt;
&lt;li&gt;ä¸‹è¼‰æ•™æï¼ˆæ»‘é¼ è¤‡è£½åº•ä¸‹æŒ‡ä»¤ï¼Œæ»‘é¼ å³éµå°±èƒ½è²¼åˆ° terminal ä¸­ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/chechiachang/etcd-playground.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;å›å®¶å¦‚ä½•è‡ªå»º-workshop-ç’°å¢ƒ&#34;&gt;å›å®¶å¦‚ä½•è‡ªå»º workshop ç’°å¢ƒ&lt;/h3&gt;
&lt;p&gt;workshop æä¾›çš„æ©Ÿå™¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ubuntu&lt;/li&gt;
&lt;li&gt;å®‰è£é€™äº›æ±è¥¿ &lt;a href=&#34;https://github.com/chechiachang/terraform-azure/blob/main/templates/cloud_config/workshop.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/chechiachang/terraform-azure&lt;/a&gt;
mac å®‰è£ä»¥ä¸‹å·¥å…·&lt;/li&gt;
&lt;li&gt;docker &lt;a href=&#34;https://docs.docker.com/desktop/install/mac-install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.docker.com/desktop/install/mac-install/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å®‰è£ &lt;a href=&#34;https://jqlang.github.io/jq/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;jq&lt;/a&gt; èˆ‡ &lt;a href=&#34;https://github.com/mikefarah/yq/releases/tag/v4.44.3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;yq&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å›å®¶å¦‚ä½•è‡ªå»º-workshop-ç’°å¢ƒ-1&#34;&gt;å›å®¶å¦‚ä½•è‡ªå»º workshop ç’°å¢ƒ&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;VERSION=v4.44.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;BINARY=yq_darwin_amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://github.com/mikefarah/yq/releases/download/${VERSION}/${BINARY} -O yq
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod +x yq
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mv yq /usr/bin/yq
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-å•Ÿå‹•ä¸€å°-etcd&#34;&gt;etcd åŸºç¤æ“ä½œ: å•Ÿå‹•ä¸€å° etcd&lt;/h3&gt;
&lt;p&gt;ä¸€è¡Œä¸€è¡ŒåŸ·è¡Œåº•ä¸‹æŒ‡ä»¤ï¼Œä¾†å•Ÿå‹•ä¸€å° etcd&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd etcd-playground
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd 00-prerequsites/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat docker-compose.yaml 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs -f etcd-0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¡ä½æ™‚ ctrl + c to exit&lt;/p&gt;
&lt;p&gt;åªé ˜æ‰“ä¸€åŠå¯ä»¥æŒ‰ tab auto complete&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-etcdctl&#34;&gt;etcd åŸºç¤æ“ä½œ: etcdctl&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/tutorials/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/tutorials/&lt;/a&gt; ä¸­çš„å¹¾å€‹ç¯„ä¾‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reading from etcd&lt;/li&gt;
&lt;li&gt;Writing to etcd&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get foo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put foo &amp;#34;Hello World&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get foo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-etcdctl-1&#34;&gt;etcd åŸºç¤æ“ä½œ: etcdctl&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/tutorials/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/tutorials/&lt;/a&gt; ä¸­çš„å¹¾å€‹ç¯„ä¾‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to get keys by prefix&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get --prefix &amp;#34;&amp;#34; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get &amp;#34;&amp;#34; --prefix --keys-only
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put foo2 2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put foo5 5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put foo4 4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put foo3 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get foo --prefix --keys-only
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get foo --prefix --keys-only --sort-by=KEY --limit=5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get foo --prefix --keys-only --sort-by=MODIFY --limit=5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-etcdctl-2&#34;&gt;etcd åŸºç¤æ“ä½œ: etcdctl&lt;/h3&gt;
&lt;p&gt;è«‹å˜—è©¦æ“ä½œ &lt;a href=&#34;https://etcd.io/docs/v3.5/tutorials/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/tutorials/&lt;/a&gt; ä¸­çš„å¹¾å€‹ç¯„ä¾‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to delete keys&lt;/li&gt;
&lt;li&gt;How to watch keys&lt;/li&gt;
&lt;li&gt;How to check Cluster status&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl del foo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put k1 value1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put k2 value2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl del --prefix k
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-é‡å•Ÿ-etcd&#34;&gt;etcd åŸºç¤æ“ä½œ: é‡å•Ÿ etcd&lt;/h3&gt;
&lt;p&gt;é€éä»¥ä¸‹ command é‡å•Ÿ etcd&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;docker ps&lt;/code&gt; ç¢ºèª etcd æ˜¯å¦é‚„åœ¨é‹è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose down
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-quiz&#34;&gt;etcd åŸºç¤æ“ä½œ: Quiz&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;é‡å•Ÿ etcd å¾Œï¼Œæ˜¯å¦é‚„èƒ½è®€å–åˆ° foo çš„å€¼ï¼Ÿç‚ºä»€éº¼ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è«‹ç”¨50å€‹å­—ï¼Œæè¿°ä½ ç›®å‰è¦ºå¾— etcd æ˜¯ä»€éº¼ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;æŠŠç­”æ¡ˆå¡«åˆ° &lt;a href=&#34;https://workshop.chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workshop.chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸æ˜¯è€ƒè©¦ï¼Œéš¨æ„ç™¼æ®ï¼Œé‡é»åœ¨ä¿ƒé€²å¤§å®¶æ€è€ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl put foo bar
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose down
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get foo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-åŸºç¤æ“ä½œ-answer&#34;&gt;etcd åŸºç¤æ“ä½œ: Answer&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æœ¬ workshop çš„ docker-compose.yml ä¸­ï¼Œetcd çš„è³‡æ–™æ˜¯å­˜æ”¾åœ¨æœ¬åœ°çš„ etcd0 è³‡æ–™å¤¾ä¸­ï¼Œå› æ­¤é‡å•Ÿå¾Œï¼Œè³‡æ–™ä¸æœƒéºå¤±ã€‚é€éä»¥ä¸‹æŒ‡ä»¤å¯ä»¥æ¸…é™¤ etcd0 è³‡æ–™å¤¾ä¸­çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/learning/why/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/learning/why/&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd 00-prerequsites/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo ls etcd0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo ls etcd0/member
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose down --volumes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo rm -rf etcd0/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# æ–°çš„ etcd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls etcd0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;é–±è®€è³‡æ–™&#34;&gt;é–±è®€è³‡æ–™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/learning/why/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/learning/why/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/etcd-playground/blob/main/00-prerequsites/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/etcd-playground/blob/main/00-prerequsites/README.md&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†authentication&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†ï¼šauthentication&lt;/h3&gt;
&lt;p&gt;å•Ÿç”¨ etcd çš„ authentication&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ userA ç™»å…¥ etcd&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ userA å¯«å…¥è³‡æ–™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ userB è®€å–è³‡æ–™&lt;/li&gt;
&lt;li&gt;é—œé–‰åŒ¿åå­˜å–&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/op-guide/authentication/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/op-guide/authentication/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;å¡ä½ä¹ƒå…µå®¶å¸¸äº‹å¤§ä¿ è«‹é‡æ–°ä¾†éå³å¯&#34;&gt;å¡ä½ä¹ƒå…µå®¶å¸¸äº‹ï¼Œå¤§ä¿ è«‹é‡æ–°ä¾†éå³å¯&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose down --volumes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo rm -rf etcd0/*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†authentication-1&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†ï¼šauthentication&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å¯èƒ½æœƒç”¨åˆ°çš„ cmd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl role add
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl role grant-permission
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl user add
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl user list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl auth status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl auth enable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-clusters-ç§»é™¤èˆŠçš„-etcd&#34;&gt;etcd Clusters: ç§»é™¤èˆŠçš„ etcd&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆé—œé–‰ 01-prerequsites çš„ etcd&lt;/li&gt;
&lt;li&gt;é€é &lt;code&gt;--volumes&lt;/code&gt; åˆªé™¤ docker volume&lt;/li&gt;
&lt;li&gt;åˆªé™¤ etcd local volume è³‡æ–™å¤¾&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose down --volumes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo rm -rf etcd0/*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-clusters-å•Ÿå‹•å¤šå°-etcd&#34;&gt;etcd Clusters: å•Ÿå‹•å¤šå° etcd&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd ../
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd 01-cluster/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat docker-compose.yaml 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-clusters-æª¢è¦–ç‹€æ…‹&#34;&gt;etcd Clusters: æª¢è¦–ç‹€æ…‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é è¨­ etcdctl æœƒé€£ç·šåˆ° &amp;ndash;endpoints=[127.0.0.1:2379]&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &amp;ndash;endpoints æŒ‡å®šè¦é€£ç·šåˆ°çš„ etcd&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ export ETCDCTL_ENDPOINTS æŒ‡å®šè¦é€£ç·šåˆ°çš„ etcd&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --endpoints &amp;#34;http://127.0.0.1:2379,http://127.0.0.1:2380&amp;#34; endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --endpoints &amp;#34;http://127.0.0.1:2379,http://127.0.0.1:2380,http://127.0.0.1:2381&amp;#34; endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;export ETCDCTL_ENDPOINTS=&amp;#34;http://127.0.0.1:2379,http://127.0.0.1:2380,http://127.0.0.1:2381&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --endpoints $ETCDCTL_ENDPOINTS endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-clusters-æª¢è¦–ç‹€æ…‹-1&#34;&gt;etcd Clusters: æª¢è¦–ç‹€æ…‹&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/tutorials/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/tutorials/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to check Cluster status&lt;/li&gt;
&lt;li&gt;é€é &lt;code&gt;--help&lt;/code&gt; æª¢æŸ¥æ¯å€‹æ¬„ä½çš„æ„ç¾©&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint status --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint health
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint health --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint hashkv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl endpoint hashkv --help
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-clusters-æ“ä½œ-member&#34;&gt;etcd Clusters: æ“ä½œ Member&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;member æ˜¯ etcd cluster ä¸­çš„ä¸€å€‹ç¯€é»&lt;/li&gt;
&lt;li&gt;leader æ˜¯ etcd cluster ä¸­çš„ä¸€å€‹ member&lt;/li&gt;
&lt;li&gt;é€é &lt;code&gt;move-leader&lt;/code&gt; æŒ‡ä»¤ï¼Œå¯ä»¥äº¤æ¥ leader&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --write-out=table endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it etcd-1 etcdctl move-leader 88d11e2649dad027
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --write-out=table endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;etcd-clusters-member&#34;&gt;etcd Clusters: Member&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/tutorials/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/tutorials/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to Add and Remove Members&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;ç§»é™¤ä¸€å€‹ memberï¼Œname: etcd-3 id: c3697a4fd7a20dcd&lt;/li&gt;
&lt;li&gt;æ·»åŠ å›ä¾†&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#replacing-a-failed-etcd-member&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#replacing-a-failed-etcd-member&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member remove
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member remove c3697a4fd7a20dcd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member add c3697a4fd7a20dcd --peer-urls=&amp;#34;http://etcd-3:2380&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo rm -rf etcd3/member
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker start etcd-3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;é–±è®€è³‡æ–™-1&#34;&gt;é–±è®€è³‡æ–™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/faq/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/faq/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/learning/design-learner/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/learning/design-learner/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/learning/persistent-storage-files/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/learning/persistent-storage-files/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†authentication-2&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†ï¼šauthentication&lt;/h3&gt;
&lt;p&gt;å•Ÿç”¨ etcd cluster çš„ tlsï¼Œä¸¦è®“ etcdcetl é€é tls é€£ç·š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/op-guide/clustering/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/op-guide/clustering/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é—œé–‰æœå‹™&lt;/li&gt;
&lt;li&gt;ç”¢ç”Ÿ ca èˆ‡ certs&lt;/li&gt;
&lt;li&gt;é…ç½®åˆ° etcd* è³‡æ–™å¤¾ä¸­&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ 01-cluster/docker-compose.yaml&lt;/li&gt;
&lt;li&gt;docker compose é‡å•Ÿæœå‹™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;k8s-æ­å»º-k8s-control-plane&#34;&gt;K8s: æ­å»º K8s Control Plane&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç¢ºå®š etcd cluster éƒ½æ­£å¸¸é‹è¡Œ
&lt;ul&gt;
&lt;li&gt;è£¡é¢æ²’æœ‰è³‡æ–™ï¼Œæœ‰çš„è©±å¯ä»¥åˆªé™¤ï¼Œå•Ÿå‹•æ–°çš„ etcd&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€é docker å•Ÿå‹• K8s Control Plane
&lt;ul&gt;
&lt;li&gt;kube-apiserver&lt;/li&gt;
&lt;li&gt;kube-controller-manager&lt;/li&gt;
&lt;li&gt;kube-scheduler&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps -a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get &amp;#34;&amp;#34; --prefix --keys-only
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-æ­å»º-k8s-control-plane-1&#34;&gt;K8s: æ­å»º K8s Control Plane&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é€éåº•ä¸‹æŒ‡ä»¤ï¼Œå•Ÿå‹• k8s control plane
&lt;ul&gt;
&lt;li&gt;é€™æ˜¯ä¸€å€‹æ¥µåº¦ç°¡åŒ–çš„ k8s control plane&lt;/li&gt;
&lt;li&gt;æ­£å¼ç’°å¢ƒä¸æœƒé•·é€™æ¨£&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd 02-control-panel
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd certs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./generate.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd ../
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat docker-compose.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs kube-apiserver
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs kube-controller-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs kube-scheduler
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/overview/components/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;k8s-kubectl&#34;&gt;K8s: kubectl&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é€é etcdctl æª¢æŸ¥ç›®å‰çš„ etcd è³‡æ–™å…§å®¹&lt;/li&gt;
&lt;li&gt;kubectl æ˜¯ Kubernetes çš„ CLI å·¥å…·ï¼Œå¯ä»¥é€é kubectl å­˜å– k8s control plane&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get &amp;#34;&amp;#34; --prefix --keys-only
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig=certs/admin.kubeconfig cluster-info
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig=certs/admin.kubeconfig get all -A
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-data-in-etcd&#34;&gt;K8s: data in etcd&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ etcdctl å­˜å– k8s çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;jq&lt;/li&gt;
&lt;li&gt;yq&lt;/li&gt;
&lt;li&gt;é¸å¹¾å€‹ &lt;code&gt;/registry&lt;/code&gt; çš„ keyï¼Œæ¢ç´¢æ›´å¤š k8s å…§å®¹&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get &amp;#34;/&amp;#34; --prefix --keys-only --sort-by=KEY
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get /registry/namespaces/default -w json | jq
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get /registry/namespaces/default -w json | yq -P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-data-in-etcd-1&#34;&gt;K8s: data in etcd&lt;/h3&gt;
&lt;p&gt;k8s é‹è¡Œæ™‚ï¼Œæœƒå°‡è³‡æ–™å­˜æ”¾åœ¨ etcd ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€é kubectl create namespace workshop å‰µå»ºä¸€å€‹ namespace&lt;/li&gt;
&lt;li&gt;é€é etcdctl å­˜å– workshop namespace çš„è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get &amp;#34;/registry/namespaces&amp;#34; --prefix --keys-only --sort-by=KEY
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig=certs/admin.kubeconfig create namespace workshop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl get /registry/namespaces/workshop -w json | yq -P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-the-hard-way&#34;&gt;K8s: the hard way&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/master&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kelseyhightower/kubernetes-the-hard-way&lt;/a&gt; æ˜¯ä¸€å€‹å¾ˆæ£’çš„å­¸ç¿’è³‡æºï¼Œå¯ä»¥è®“ä½ äº†è§£åˆ° Kubernetes çš„æ¯å€‹ç´°ç¯€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€™æ¬¡é‡é»åœ¨æ–¼ etcdï¼Œæˆ‘å€‘åªæ“ä½œåˆ° etcd çš„éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;k8s çš„éƒ¨åˆ†ï¼Œåœ¨æ–¼ k8s è·Ÿ etcd çš„äº’å‹•&lt;/li&gt;
&lt;li&gt;æœ‰åŠŸèƒ½çš„ k8s é‚„éœ€è¦éƒ¨ç½² node&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;k8s-generatesh&#34;&gt;K8s: ./generate.sh&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/etcd-playground/blob/main/02-control-panel/certs/generate.sh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;certs/generate.sh&lt;/a&gt; æœ‰é™„ä¸Šå°æ‡‰çš„ k8s-the-hard-way çš„èªªæ˜æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ca èˆ‡ certs æ˜¯éƒ¨ç½² k8s control plane çš„å¿…è¦æª”æ¡ˆ&lt;/li&gt;
&lt;li&gt;éå¸¸èŠ±æ™‚é–“ï¼Œæœ¬ workshop æœƒç›´æ¥ä½¿ç”¨è…³æœ¬ç”¢ç”Ÿ&lt;/li&gt;
&lt;li&gt;åŠ åˆ†é¡Œï¼šé¼“å‹µå¤§å®¶è‡ªå·±æ“ä½œéä¸€æ¬¡ certs çš„ç”¢ç”Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vi certs/generate.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls certs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-èªè­˜-control-plane-components&#34;&gt;K8s: èªè­˜ control plane components&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/overview/components/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls apiserver
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls controller-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls scheduler
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-etcd-operations-for-k8s&#34;&gt;K8s: etcd operations for k8s&lt;/h3&gt;
&lt;p&gt;k8s å®˜æ–¹æ–‡ä»¶ä¸­ï¼Œå¾ç¶­é‹ k8s è§’åº¦ï¼Œè¬›è¿°å¦‚ä½•ç¶­é‹ etcd&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#securing-etcd-clusters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Securing etcd Clusters&lt;/a&gt; æ”¾åœ¨åŠ åˆ†é¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;k8s-etcd-backup-and-restore&#34;&gt;K8s: etcd backup and restore&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;backing-up-an-etcd-cluster&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;etcdctl ç¢ºå®š leader èˆ‡ raft index&lt;/li&gt;
&lt;li&gt;å‘ leader node ç™¼é€ snapshot request&lt;/li&gt;
&lt;li&gt;è¼¸å‡ºåˆ° /etcd_data/snapshot.dbï¼Œæœƒé¡¯ç¤ºåœ¨ etcd1 è³‡æ–™å¤¾ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --write-out=table endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it etcd-1 etcdctl snapshot save /etcd_data/snapshot.db
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls etcd1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;k8s-etcd-backup-and-restore-1&#34;&gt;K8s: etcd backup and restore&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#restoring-an-etcd-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;restoring-an-etcd-cluster&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœæ­¢ k8s control plane (apiserver)&lt;/li&gt;
&lt;li&gt;è¤‡è£½ snapshot.db åˆ° etcd2 èˆ‡ etcd3 è³‡æ–™å¤¾ä¸­&lt;/li&gt;
&lt;li&gt;å°æ¯ä¸€å€‹ etcd member åŸ·è¡Œ restore&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯é‡å° leader åŸ·è¡Œ restore&lt;/li&gt;
&lt;li&gt;è§€å¯Ÿ raft index çš„è®ŠåŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker stop kube-apiserver
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp etcd1/snapshot.db etcd2/snapshot.db
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp etcd1/snapshot.db etcd3/snapshot.db
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it etcd-1 etcdctl snapshot restore /etcd_data/snapshot.db
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it etcd-2 etcdctl snapshot restore /etcd_data/snapshot.db
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec -it etcd-3 etcdctl snapshot restore /etcd_data/snapshot.db
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl --write-out=table endpoint status
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†å¢åŠ -etcd-member&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†ï¼šå¢åŠ  etcd member&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#scaling-out-etcd-clusters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;scaling-out-etcd-clusters&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹ 01-cluster/docker-compose.yaml&lt;/li&gt;
&lt;li&gt;èª¿æ•´åº•ä¸‹ comment ä¸­çš„éƒ¨åˆ†ï¼Œä¿®æ”¹ ? çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;å¢åŠ å…©å° etcd member åˆ° cluster ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å¯èƒ½æœƒç”¨åˆ°çš„ cmd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member add &amp;lt;id&amp;gt; --peer-urls=
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etcdctl member list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†è‡ªå·±åš-ca-and-tls-certs&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†ï¼šè‡ªå·±åš ca and tls certs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä½¿ç”¨ generate.sh ç”¢ç”Ÿ certsï¼Œæ‹‰èµ· k8s control plane&lt;/li&gt;
&lt;li&gt;é–±è®€ generate.sh çš„ comment éƒ¨åˆ†ç¶²é é€£çµ&lt;/li&gt;
&lt;li&gt;å°‡ generate.sh çš„å…§å®¹ï¼Œåˆ° terminal ä¸­ä¸€æ®µä¸€æ®µ copy paste åŸ·è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†-å¢åŠ -apiserver&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†: å¢åŠ  apiserver&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ”¹ 02-control-panel/docker-compose.yaml&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹åº•ä¸‹ comment ä¸­çš„éƒ¨åˆ† kube-apiserver-1 çš„éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ docker compose up å•Ÿå‹•æœå‹™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ kubectl å­˜å– kube-apiserver-1
&lt;ul&gt;
&lt;li&gt;éœ€è¦ä¿®æ”¹ generate.shï¼Œèª¿æ•´ certs/admin.kubeconfig&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†-æ­å»º-k8s-node&#34;&gt;åŠ åˆ†é¡Œç‚ºè‡ªå·±åŠ åˆ†: æ­å»º K8s Node&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kelseyhightower/kubernetes-the-hard-way/blob/master/docs/09-bootstrapping-kubernetes-workers.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kelseyhightower/kubernetes-the-hard-way/blob/master/docs/09-bootstrapping-kubernetes-workers.md&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åƒè€ƒè³‡æ–™&#34;&gt;åƒè€ƒè³‡æ–™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;etcd
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/learning/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/learning/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://play.etcd.io/play&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://play.etcd.io/play&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;kubernetes
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/overview/components/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸­æ–‡ &lt;a href=&#34;https://kubernetes.feisky.xyz/concepts/components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.feisky.xyz/concepts/components/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kelseyhightower/kubernetes-the-hard-way&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kelseyhightower/kubernetes-the-hard-way&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Summit: Upgrade A VM Based Cluster</title>
      <link>https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/</link>
      <pubDate>Sun, 04 Aug 2024 12:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/</guid>
      <description>&lt;h3 id=&#34;upgrade-a-vm-based-cluster&#34;&gt;Upgrade A VM Based Cluster&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Che Chia Chang&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é—œæ–¼æˆ‘&#34;&gt;é—œæ–¼æˆ‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Che Chia Chang&lt;/li&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.cake.me/companies/maicoin/jobs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æŠ•å½±ç‰‡èˆ‡è¬›ç¨¿éƒ½åœ¨ &lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/talk/kubernetes-summit-get-started-with-etcd-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Etcd Workshop&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éµäººè³½ (Terraform / Vault æ‰‹æŠŠæ‰‹å…¥é–€)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä»Šå¤©çš„ä¸»é¡Œ&#34;&gt;ä»Šå¤©çš„ä¸»é¡Œ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç‚ºä½•è¦ AWS è‡ªæ¶ K8s&lt;/li&gt;
&lt;li&gt;å‡ç´šäº‹å‰é–±è®€æ–‡ä»¶èˆ‡è¦åŠƒ&lt;/li&gt;
&lt;li&gt;éœ€è¦å‡ç´šçš„å…ƒä»¶&lt;/li&gt;
&lt;li&gt;å¯¦éš›å‡ç´šçš„æ­¥é©Ÿ&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ– k8s å‡ç´š&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä»Šå¤©çš„ç›®çš„&#34;&gt;ä»Šå¤©çš„ç›®çš„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;çµ±æ•´æ•£è½çš„è³‡è¨Š&lt;/li&gt;
&lt;li&gt;å‡ç´šéœ€è¦è€ƒæ…®çš„äº‹æƒ…&lt;/li&gt;
&lt;li&gt;å¯èƒ½å“ªäº›åœ°æ–¹æœ‰é›·ï¼Œå°è‡´å‡ç´šå‡ºéŒ¯&lt;/li&gt;
&lt;li&gt;ç”¢ç”Ÿè‡ªå·±åœ˜éšŠçš„å‡ç´š SOP&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;èƒŒæ™¯ä»€éº¼æ˜¯-vm-based-cluster&#34;&gt;èƒŒæ™¯ï¼šä»€éº¼æ˜¯ VM-based Cluster&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Managed Kubernetes Service (GKE, EKS, AKS)
&lt;ul&gt;
&lt;li&gt;å…¬æœ‰é›²è¨—ç®¡ control planeï¼Œé€éé›²æä¾›çš„ä»‹é¢æ§åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;self-hosted Kubernetes
&lt;ul&gt;
&lt;li&gt;cloud formation template ec2 node&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://docs.aws.amazon.com/images/whitepapers/latest/overview-deployment-options/images/image6.png&#34; alt=&#34;Self-hosted K8s&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä»€éº¼æ˜¯-vm-based-cluster&#34;&gt;ä»€éº¼æ˜¯ VM-based Cluster&lt;/h3&gt;
&lt;p&gt;å…¬æœ‰é›²åªæä¾› VMï¼Œè‡ªå·±ç”¨å…¶å®ƒå·¥å…·æ­ K8s Components&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kubeadm, kops, kubespray / docker, containerd, cri-o / container or systemd / &amp;hellip;&lt;/li&gt;
&lt;li&gt;è‡ªå·±ç®¡ç† control planeï¼ŒåŒ…å« etcd, apiserver, controller-manager, scheduler&lt;/li&gt;
&lt;li&gt;ä¾éœ€æ±‚é¸ç”¨å…¬æœ‰é›²æä¾›çš„æ¶æ§‹ï¼Œex VPC, ELB, EBS, S3, RDS, IAM, Route53, CloudWatch, CloudTrail&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Self-hosted control plane&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/self-hosted-k8s_hu426d0c2559fd3fd4ffe742ab5f7664a0_303564_eb8f55efbce8d718a4ef759ab3132d6a.webp 400w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/self-hosted-k8s_hu426d0c2559fd3fd4ffe742ab5f7664a0_303564_6e1c278b9cf5a58db30db69224462074.webp 760w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/self-hosted-k8s_hu426d0c2559fd3fd4ffe742ab5f7664a0_303564_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/self-hosted-k8s_hu426d0c2559fd3fd4ffe742ab5f7664a0_303564_eb8f55efbce8d718a4ef759ab3132d6a.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ‰€ä»¥ç‚ºä½•è¦åœ¨awsä¸Šè‡ªæ¶-k8s&#34;&gt;æ‰€ä»¥ç‚ºä½•è¦åœ¨AWSä¸Šè‡ªæ¶ K8sï¼Ÿ&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å› ç‚º-2016-å¹´çš„æ™‚å€™æ²’æœ‰-eks&#34;&gt;å› ç‚º 2016 å¹´çš„æ™‚å€™æ²’æœ‰ eks&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;2015--å¹´æœ‰å¾ˆå¤š-self-hosted-k8s-è§£æ±ºæ–¹æ¡ˆ&#34;&gt;2015- å¹´æœ‰å¾ˆå¤š self-hosted k8s è§£æ±ºæ–¹æ¡ˆ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;2014/10/15 kubernetes v0.4 &lt;a href=&#34;https://github.com/kubernetes/kubernetes/releases/tag/v0.4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2014/11/04 &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/release-notes-archive#november_4_2014&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GKE release for 0.4.2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ç•¶æ™‚æœ‰å¾ˆå¤šè§£æ±ºæ–¹æ¡ˆå†æä¾› self-hosted k8sï¼ŒåŸºæ–¼é€™äº›æ–¹æ¡ˆï¼Œç”¢ç”Ÿ VM-based k8s
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/getamis/vishwakarma&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/getamis/vishwakarma&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;2017/10/24 &lt;a href=&#34;https://azure.microsoft.com/en-us/blog/introducing-azure-container-service-aks-managed-kubernetes-and-azure-container-registry-geo-replication/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AKS generally available&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2018/06/05 &lt;a href=&#34;https://aws.amazon.com/blogs/aws/amazon-eks-now-generally-available/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EKS generally available&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;self-hosted-control-plane&#34;&gt;Self-hosted control plane&lt;/h3&gt;
&lt;p&gt;self-hosted control plane å…¶å¯¦ä¸é›£ï¼Œé‚£æ™‚æœ‰å¾ˆå¤šæˆç†Ÿçš„è§£æ±ºæ–¹æ¡ˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/talk/kubernetes-summit-get-started-with-etcd-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s summit Etcd Workshop&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é™ä½æœå‹™å•†ä¾è³´&lt;/li&gt;
&lt;li&gt;å¯ä»¥è·¨é›²ï¼Œè·¨åœ°ç«¯ï¼Œæ··åˆé›²&lt;/li&gt;
&lt;li&gt;è‡ªè¨‚åŒ–ï¼Œæ› VM disk imageï¼ŒCNIï¼ŒCSIï¼ŒIngress Controller&lt;/li&gt;
&lt;li&gt;æˆæœ¬æ§åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;self-hosted-control-plane-å£è™•&#34;&gt;Self-hosted control plane: å£è™•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åœ˜éšŠå¤šåšä¸€äº›äº‹æƒ…&lt;/li&gt;
&lt;li&gt;å·¥ç¨‹å¸«å€‹äººå¯ä»¥(å¿…é ˆ)å­¸åˆ°å¾ˆå¤šæ±è¥¿&lt;/li&gt;
&lt;li&gt;cloud managed k8s è¶Šåšè¶Šå¥½ï¼Œè‡ªå·±æ¶çš„ç†ç”±è¶Šä¾†è¶Šå°‘&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;self-hosted-å¤šäº†è¦å‡ç´šçš„æ±è¥¿&#34;&gt;Self-hosted å¤šäº†è¦å‡ç´šçš„æ±è¥¿&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;VM: based image / package / CVEs (ä¸åœ¨ä»Šå¤©çš„ç¯„åœ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/#manual-deployments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s doc å»ºè­°çš„å‡ç´šé †åº&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Etcd Cluster&lt;/li&gt;
&lt;li&gt;Control Plane
&lt;ul&gt;
&lt;li&gt;apiserver&lt;/li&gt;
&lt;li&gt;controller manager&lt;/li&gt;
&lt;li&gt;scheduler&lt;/li&gt;
&lt;li&gt;cloud controller manager&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; alt=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¯¦éš›ä¾†çœ‹å‡ç´šçš„æ­¥é©Ÿ&#34;&gt;å¯¦éš›ä¾†çœ‹å‡ç´šçš„æ­¥é©Ÿ&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¯¦éš›å‡ç´šçš„é †åº&#34;&gt;å¯¦éš›å‡ç´šçš„é †åº&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç ”ç©¶æ±ºå®šå‡ç‰ˆç›®æ¨™
&lt;ul&gt;
&lt;li&gt;å¿…è®€ K8s CHANGELOG / Urgent Upgrade Notes&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æª¢æŸ¥ app çš„ç‰ˆæœ¬ä¾è³´ (i.e å‡ k8s æœƒå£çš„ app)
&lt;ul&gt;
&lt;li&gt;K8s resource API Deprecated&lt;/li&gt;
&lt;li&gt;App Controllers&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Etcd Cluster&lt;/li&gt;
&lt;li&gt;Apiserver
&lt;ul&gt;
&lt;li&gt;Controller Manager&lt;/li&gt;
&lt;li&gt;Scheduler&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Node (kubelet, kube-proxy, CNI agent)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;äº‹å‰ç ”ç©¶è·Ÿè¦åŠƒ&#34;&gt;äº‹å‰ç ”ç©¶è·Ÿè¦åŠƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç¢ºèªç›®å‰ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;ç›®æ¨™ç‰ˆæœ¬
&lt;ul&gt;
&lt;li&gt;å‡ç‰ˆçš„ç›®çš„ï¼š(feature, EOL, &amp;hellip;)&lt;/li&gt;
&lt;li&gt;å…ƒä»¶å½¼æ­¤ç›¸å®¹çš„ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;æ¯å€‹å°ç‰ˆè™Ÿ Release Cycle ~ 4 months&lt;/li&gt;
&lt;li&gt;æœ‰é‡ç–Šæ™‚é–“ï¼Œæ‰€ä»¥å¤§æ¦‚æ˜¯ 3 å€‹æœˆå‡ºä¸€ç‰ˆæ–°çš„&lt;/li&gt;
&lt;li&gt;path release ~ 8 months&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;k8s-release-cycle--4-months&#34;&gt;K8s Release Cycle ~ 4 months&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/releases/release-cycle.jpg&#34; alt=&#34;https://kubernetes.io/images/releases/release-cycle.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŠ ä¸Š ~ 8 months patch release&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/releases/release-lifecycle.jpg&#34; alt=&#34;https://kubernetes.io/images/releases/release-lifecycle.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¤šä¹…å‡ç´šä¸€æ¬¡-k8s&#34;&gt;å¤šä¹…å‡ç´šä¸€æ¬¡ k8s&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¯å­£æ›´æ–°ä¸€æ¬¡
&lt;ul&gt;
&lt;li&gt;è·Ÿ featureï¼Œæ¯æ¬¡å‡ N+1 ç‰ˆ&lt;/li&gt;
&lt;li&gt;è·Ÿ EOLï¼Œæ¯æ¬¡å‡ N+1 ç‰ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¯å¹´æ›´ï¼Œç¶­æŒåœ¨ EOL å‰ï¼Œæ¯æ¬¡å‡ N+3 ç‰ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å‡ç´šè®Šæˆ-routine&#34;&gt;å‡ç´šè®Šæˆ routine&lt;/h3&gt;
&lt;p&gt;æ›´æ–° k8s ä¹Ÿä¸æ˜¯çŸ­çŸ­å¹¾å¤©çš„å·¥ä½œï¼Œè¦æœ‰æ™‚é–“è¦åŠƒï¼Œæ¸¬è©¦ï¼Œæª¢æŸ¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™¤äº†ç‰ˆæœ¬ä¸åŒï¼Œæ¯æ¬¡è¦åšçš„æµç¨‹é¡ä¼¼&lt;/li&gt;
&lt;li&gt;èˆ‡å…¶æ˜¯ä¸€å€‹ task æ›´åƒæ˜¯ä¸€å€‹ routine çš„å·¥ä½œ&lt;/li&gt;
&lt;li&gt;é‡é»è®Šæˆä¸æ˜¯å¤šä¹…æ›´æ–°ä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;è€Œæ˜¯å¹¾ç„¶éœ€è¦å¸¸åšï¼Œè©²å¦‚ä½•&lt;strong&gt;æœ‰æ•ˆç‡(è‡ªå‹•åŒ–)çš„å®Œæˆå‡ç´š&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¿…è®€æ–‡ä»¶-k8s-changelog&#34;&gt;å¿…è®€æ–‡ä»¶ K8s CHANGELOG&lt;/h3&gt;
&lt;p&gt;Urgent Upgrade Notes (No, really, you MUST read this before you upgrade)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.31.md#urgent-upgrade-notes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CHANGELOG-1.31.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æœ€å°‘è¦çœ‹ Urgent Upgrade Notes è·Ÿ action required&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä¸çœ‹-changelog-çœŸçš„ä¸è¡Œå—&#34;&gt;ä¸çœ‹ CHANGELOG çœŸçš„ä¸è¡Œå—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¯ä»¥ï¼Œæµç¨‹æœƒè®Šæˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;k8s å‡ç´šä¸Šå»&lt;/li&gt;
&lt;li&gt;ç™¼ç¾æœ‰æ±è¥¿å£æ‰ï¼Œé–‹å§‹ debug&lt;/li&gt;
&lt;li&gt;ä¸€è·¯å¾ app, infra, k8s resource, æŸ¥åˆ° k8s ä¸Šçš„å•é¡Œ&lt;/li&gt;
&lt;li&gt;æœ€å¾Œé‚„æ˜¯çœ‹äº† CHANGELOG&lt;/li&gt;
&lt;li&gt;ä½ ä»¥å¾Œå°±æœƒä¹–ä¹–çš„æŠŠ CHANGELOG çœ‹å®Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å‡ç´šäº‹å‰ç ”ç©¶è·Ÿè¦åŠƒ&#34;&gt;å‡ç´šäº‹å‰ç ”ç©¶è·Ÿè¦åŠƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£ k8s release lifecycle&lt;/li&gt;
&lt;li&gt;ä¾æ“šåœ˜éšŠæ”¿ç­–ï¼Œè¨­å®šæ›´æ–°é€±æœŸ&lt;/li&gt;
&lt;li&gt;äº†è§£ç›®å‰ç‰ˆæœ¬èˆ‡ç›®æ¨™ç‰ˆæœ¬çš„å·®ç•°&lt;/li&gt;
&lt;li&gt;ä¸Šè¿°å·¥ä½œè½‰ç‚ºé€±æœŸæ€§çš„å¸¸æ…‹å·¥ä½œ&lt;/li&gt;
&lt;li&gt;åŠ é€Ÿå‡ç´šçš„é€Ÿåº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;éœ€è¦å‡ç´šçš„-k8s-components&#34;&gt;éœ€è¦å‡ç´šçš„ K8s Components&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; alt=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;etcd-upgrade-å®˜æ–¹æ–‡ä»¶&#34;&gt;Etcd Upgrade å®˜æ–¹æ–‡ä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åˆ†æ•£å¼ key-value store
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ zero downtime rolling upgrade&lt;/li&gt;
&lt;li&gt;å¯ä»¥ zero downtime rolling downgrade&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;etcd-upgrade-æ­¥é©Ÿ&#34;&gt;Etcd Upgrade æ­¥é©Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/upgrades/upgrade_3_5/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/upgrades/upgrade_3_5/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;etcd åœ¨ minor version å‡ç´šæ™‚ï¼Œå¯ä»¥ zero downtime rolling upgrade&lt;/li&gt;
&lt;li&gt;ç¶­æŒ etcd cluster quorum&lt;/li&gt;
&lt;li&gt;delete then add member (ç¶­æŒ quorum å…ˆæ¸›å¾Œå¢ï¼‰&lt;/li&gt;
&lt;li&gt;ä¿ç•™ etcd data èˆ‡ endpoint ipï¼Œé–‹å›å¾Œç›´æ¥ä¸Šç·š&lt;/li&gt;
&lt;li&gt;åªéœ€ sync delete -&amp;gt; add ä¸­é–“çš„è³‡æ–™å·®&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;terraform-for-iac&#34;&gt;terraform for IaC&lt;/h3&gt;
&lt;p&gt;è¦æ›çš„ etcd VM å¯ä»¥æ‹†è§£æˆ terraform module&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VM -&amp;gt; EC2&lt;/li&gt;
&lt;li&gt;base os -&amp;gt; AMI&lt;/li&gt;
&lt;li&gt;data disk (etcd data) -&amp;gt; EBS&lt;/li&gt;
&lt;li&gt;ip (etcd endpoint) -&amp;gt; ENI&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;etcd binary -&amp;gt; S3&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;etcd config / flags -&amp;gt; launch template / cloud init&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;terraform-gitflow&#34;&gt;terraform gitflow&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;PR æ”¹ binary etcd:v3.4.34 -&amp;gt; etcd:v3.5.4&lt;/li&gt;
&lt;li&gt;PR review -&amp;gt; è‡ªå‹• trigger terraform plan&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PR merge&lt;/strong&gt; -&amp;gt; è‡ªå‹• apply dev / stag&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–åŸ·è¡Œæ¸¬è©¦&lt;/li&gt;
&lt;li&gt;Monitoring ç›£æ¸¬ä¸€ç›´éƒ½åœ¨&lt;/li&gt;
&lt;li&gt;æœ‰å•é¡Œ: revert PR è‡ªå‹• rollback&lt;/li&gt;
&lt;li&gt;æ²’å•é¡Œ: &lt;strong&gt;äººå·¥ç¢ºèªä¸Šè¿°æ­¥é©Ÿï¼Œé–‹å‡º prod PR&lt;/strong&gt; -&amp;gt; è‡ªå‹• apply prod&lt;/li&gt;
&lt;li&gt;æœ‰å•é¡Œ: revert PR è‡ªå‹• rollback&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id=&#34;å¾å°ˆæ³¨å®Œæˆå‡ç´šè®Šæˆå°ˆæ³¨åœ¨è‡ªå‹•åŒ–æµç¨‹&#34;&gt;å¾å°ˆæ³¨å®Œæˆå‡ç´šï¼Œè®Šæˆå°ˆæ³¨åœ¨è‡ªå‹•åŒ–æµç¨‹&lt;/h5&gt;
&lt;p&gt;å…¶ä»– k8s å…ƒä»¶çš„ç®¡ç†ä¹Ÿæ˜¯åŒæ¨£æ–¹å¼ï¼Œå°‡äººå·¥é™åˆ°æœ€ä½&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;etcd-upgrade-è©²æ³¨æ„&#34;&gt;Etcd Upgrade è©²æ³¨æ„&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://etcd.io/docs/v3.5/op-guide/failures/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://etcd.io/docs/v3.5/op-guide/failures/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Majority of members are unreachable&lt;/li&gt;
&lt;li&gt;Network partition&lt;/li&gt;
&lt;li&gt;éµå®ˆ SOP å…ˆæ¸›å¾Œå¢&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;kube-apiserver&#34;&gt;kube-apiserver&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; alt=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;apiserver-doc&#34;&gt;apiserver doc&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/#manual-deployments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/#manual-deployments&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå‡ç´š kubectl&lt;/li&gt;
&lt;li&gt;apiserver å°ç‰ˆè™Ÿ rolling upgrade zero downtime&lt;/li&gt;
&lt;li&gt;å¦‚æœå»ºç«‹ k8s æ™‚æœ‰ç”¨å·¥å…·/å¹³å°ï¼Œex kubeadm, kops, kubesprayï¼Œæœƒæœ‰å°æ‡‰çš„å‡ç´šæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;terraform ç›´æ¥æ›´æ› apiserver ç¯€é»&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;supported-version-skew&#34;&gt;Supported Version Skew&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/releases/version-skew-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/releases/version-skew-policy/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kube-apiserver å½¼æ­¤æœ€å¤šå·® 1 å€‹å°ç‰ˆè™Ÿ
&lt;ul&gt;
&lt;li&gt;1.30 å‡ 1.31 éç¨‹å¯ä»¥ç„¡ç—›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;controller manager, scheduler, cloud controller manager
&lt;ul&gt;
&lt;li&gt;(vs apiserver) æœ€å¤šå·® 1 å€‹å°ç‰ˆè™Ÿ&lt;/li&gt;
&lt;li&gt;å‡ç´š apiserver å¾Œï¼Œè·Ÿè‘—å‡ç´šåŒæ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;kubelet, kube-proxy
&lt;ul&gt;
&lt;li&gt;(vs apiserver) æœ€å¤šå·® 3 å€‹å°ç‰ˆè™Ÿ&lt;/li&gt;
&lt;li&gt;apiserver 1.30 å‡ 1.31 æ™‚ï¼Œnode 1.28, 1.29, 1.30 å¯ä»¥ç„¡ç—›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;api-deprecated&#34;&gt;api deprecated&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/using-api/deprecation-guide/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deprecated API Migration Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/using-api/deprecation-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deprecation policy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä½¿ç”¨å·¥å…·æƒæ-k8s-resource&#34;&gt;ä½¿ç”¨å·¥å…·æƒæ k8s resource&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•ç¢ºèª app çš„ k8s resource æœ‰æ²’æœ‰ä½¿ç”¨åˆ° deprecated API&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/doitintl/kube-no-trouble&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/doitintl/kube-no-trouble&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŠ å…¥åˆ°å‡ç´šæµç¨‹ï¼Œè‡ªå‹•åŒ–
&lt;ul&gt;
&lt;li&gt;ï¼ˆæ²’å‡ç´šçš„æ™‚å€™ï¼‰é€±æœŸæ€§çš„æƒæ&lt;/li&gt;
&lt;li&gt;app é–‹ç™¼çš„ CI æ‡‰è©²å°å…¥ &lt;code&gt;lint --kube-version&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰ app ä½¿ç”¨åˆ° deprecated APIï¼Œé€šçŸ¥ app owner ææ—©æ›´æ–°&lt;/li&gt;
&lt;li&gt;å‡ç´šå‰å†æƒæä¸€æ¬¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;kube-no-trouble&#34;&gt;kube-no-trouble&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/kube-no-trouble_huae4424a7ba0c58768cc463bb0b5fb679_352975_5f8ff898c063224b5b8bd4b5d3a8e711.webp 400w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/kube-no-trouble_huae4424a7ba0c58768cc463bb0b5fb679_352975_a0b87251be297a9a21bc74efd5176e4f.webp 760w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/kube-no-trouble_huae4424a7ba0c58768cc463bb0b5fb679_352975_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/kube-no-trouble_huae4424a7ba0c58768cc463bb0b5fb679_352975_5f8ff898c063224b5b8bd4b5d3a8e711.webp&#34;
               width=&#34;760&#34;
               height=&#34;451&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç”¢ç”Ÿæ–°ç‰ˆ-apiserver-vm&#34;&gt;ç”¢ç”Ÿæ–°ç‰ˆ apiserver VM&lt;/h3&gt;
&lt;p&gt;è¦æ›çš„ apiserver VM&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VM -&amp;gt; EC2&lt;/li&gt;
&lt;li&gt;base os -&amp;gt; AMI&lt;/li&gt;
&lt;li&gt;Auto Scaling Group + Load balancer&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°apiserver binary&lt;/strong&gt; -&amp;gt; S3 launch template / cloud formation&lt;/li&gt;
&lt;li&gt;apiserver config / flags -&amp;gt; launch template / cloud init&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç§»é™¤èˆŠç‰ˆ-apiserver-graceful-shutdown&#34;&gt;ç§»é™¤èˆŠç‰ˆ apiserver graceful shutdown&lt;/h3&gt;
&lt;p&gt;load balancer -&amp;gt; auto scaling group -&amp;gt; EC2 instance&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€é load balancer çš„è¨­å®šï¼Œç¢ºä¿ apiserver æœ‰è¶³å¤ çš„æ™‚é–“é›¢ç·š
&lt;ul&gt;
&lt;li&gt;request éƒ½å·²è™•ç†å®Œ&lt;/li&gt;
&lt;li&gt;load balancer é—œé–‰é€£å…¥&lt;/li&gt;
&lt;li&gt;ç­‰å¾… graceful periodï¼Œç¢ºèªæ²’æœ‰ request&lt;/li&gt;
&lt;li&gt;é—œé–‰æœå‹™ï¼Œé—œé–‰ EC2 instance&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç›£æ¸¬ apiserver çš„ metricsï¼ŒéŒ¯èª¤ç‡æé«˜è‡ªå‹•å‘Šè­¦&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;scheduler-and-controller-manager&#34;&gt;scheduler and controller manager&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯ master VM (api-server, scheduler, controller manager, cloud controller manager)
&lt;ul&gt;
&lt;li&gt;ä¸€èµ·å‡ç´š&lt;/li&gt;
&lt;li&gt;ä¸€èµ·å»ºç«‹æ–°ç‰ˆ VM&lt;/li&gt;
&lt;li&gt;ä¸€èµ·ç§»é™¤èˆŠç‰ˆ VM&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯å…¶ä»–æ–¹å¼ applyï¼Œä¾ç…§å°æ‡‰çš„å‡ç´šæŒ‡ä»¤&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä¾è³´-k8s-api-çš„-app&#34;&gt;ä¾è³´ k8s api çš„ app&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/architecture/controller/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/architecture/controller/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è¨±å¤š controller æœƒéœ€è¦ä¾è³´ç‰¹å®šçš„ k8s api
&lt;ul&gt;
&lt;li&gt;é€²è€Œä¾è³´ç‰¹å®šç‰ˆæœ¬çš„ k8s&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœƒæ‰“ k8s api çš„ app
&lt;ul&gt;
&lt;li&gt;è‡ªå®¶å¯«çš„ app æœ‰ç”¨ k8s &lt;a href=&#34;https://github.com/kubernetes/client-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;client-go&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;app-å‡ç´šæª¢æŸ¥&#34;&gt;app å‡ç´šæª¢æŸ¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æƒæ k8s resource ä½¿ç”¨çš„ api version å¤§éƒ¨åˆ†æƒå¾—å‡ºä¾†&lt;/li&gt;
&lt;li&gt;å„ controller çš„æ–‡ä»¶æ‰æœƒæè¿°ç‚ºä½•æœ‰ç‰ˆæœ¬ä¾è³´
&lt;ul&gt;
&lt;li&gt;ä»¥åŠå¦‚ä½•å‡ç´š app controller åˆ°æ–°ç‰ˆçš„ k8s api&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ˜éšŠæ‡‰ç¶­è­·&lt;strong&gt;ä¾è³´ k8s api çš„æœå‹™åˆ—è¡¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æˆ–æ˜¯ä½¿ç”¨å·¥å…· or script å¿«é€Ÿåˆ—å‡º cluster å…§éƒ¨çš„æœå‹™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.nginx.com/nginx-ingress-controller/technical-specifications/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.nginx.com/nginx-ingress-controller/technical-specifications/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller_hucf9b38e708dc650dbc3b047c0d0220b8_521288_3369f589e454621284e1b163a93cee54.webp 400w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller_hucf9b38e708dc650dbc3b047c0d0220b8_521288_19bbcde2d15f9dfcd645bda783e6b053.webp 760w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller_hucf9b38e708dc650dbc3b047c0d0220b8_521288_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller_hucf9b38e708dc650dbc3b047c0d0220b8_521288_3369f589e454621284e1b163a93cee54.webp&#34;
               width=&#34;760&#34;
               height=&#34;372&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.nginx.com/nginx-ingress-controller/technical-specifications/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.nginx.com/nginx-ingress-controller/technical-specifications/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller-support-version_hufbac6fd8436dc2c38d9f2e682a695f69_247330_65c4a048be66873d995726b0b6cb1534.webp 400w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller-support-version_hufbac6fd8436dc2c38d9f2e682a695f69_247330_c10047e257b9ad72be0e9309ef297c93.webp 760w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller-support-version_hufbac6fd8436dc2c38d9f2e682a695f69_247330_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/nginx-ingress-controller-support-version_hufbac6fd8436dc2c38d9f2e682a695f69_247330_65c4a048be66873d995726b0b6cb1534.webp&#34;
               width=&#34;760&#34;
               height=&#34;674&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµk8s-control-plane-å‡ç´š&#34;&gt;å°çµï¼šk8s control plane å‡ç´š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;etcd&lt;/li&gt;
&lt;li&gt;changelog&lt;/li&gt;
&lt;li&gt;apiserver
&lt;ul&gt;
&lt;li&gt;api deprecation&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;scheduler, controller manager&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;node-å‡ç´š&#34;&gt;Node å‡ç´š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;kubelet, kube-proxy å‡ç´šæœ¬èº«ä¸æ˜¯å•é¡Œ&lt;/li&gt;
&lt;li&gt;éœ€è¦æ¬ç§» worklaod&lt;/li&gt;
&lt;li&gt;æœ‰æ²’æœ‰ worklaod ä¾è³´ k8s api (ex. &lt;a href=&#34;https://github.com/kubernetes/client-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;client-go&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰çš„è©±æ‡‰è©²æ”¶éŒ„ä¸Šå‡ç´šçš„æœå‹™åˆ—è¡¨ï¼Œæ¯æ¬¡å‡ç´šéƒ½éœ€è¦æª¢æŸ¥&lt;/li&gt;
&lt;li&gt;æœ‰ç›´æ¥èˆ‡ k8s api äº’å‹•çš„ appï¼Œå¼·çƒˆå»ºè­°è¦å¯« unit test&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;node-å‡ç´šç°¡å–®ä¾†èªªæ˜¯å»ºæ–°æ‹†èˆŠ&#34;&gt;Node å‡ç´šç°¡å–®ä¾†èªªæ˜¯å»ºæ–°æ‹†èˆŠ&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; alt=&#34;https://kubernetes.io/images/docs/components-of-kubernetes.svg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;node-å‡ç´šéœ€è¦æ¬ç§»-worklaod&#34;&gt;Node å‡ç´šéœ€è¦æ¬ç§» worklaod&lt;/h3&gt;
&lt;p&gt;é–‹æ–°çš„ nodeï¼ŒèˆŠçš„ node ä¸Šçš„ workload éœ€è¦è½‰ç§»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æº–å‚™ç©º node&lt;/li&gt;
&lt;li&gt;èˆŠ node æ‰“ä¸Š node taintï¼Œé¿å… worklaod è·‘ä¸Šå»&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾åº&lt;/strong&gt;é‡å•Ÿ workload
&lt;ul&gt;
&lt;li&gt;app å½¼æ­¤å¯èƒ½æœƒæœ‰ä¾è³´é—œä¿‚ï¼Œi.e. é‡å•Ÿ a æ™‚ b æœƒå™´éŒ¯&lt;/li&gt;
&lt;li&gt;ex. backend + in-k8s redis&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯ä¾ç…§ node drain node&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;workload-retry&#34;&gt;Workload retry&lt;/h3&gt;
&lt;p&gt;app è¦å¯¦ä½œ auto retryï¼Œä¾†è™•ç†æš«æ™‚æ–·ç·šèˆ‡é”åˆ° auto recovery&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å•Ÿ workload å¯èƒ½é€ æˆå¤§é‡çš„é‡å•Ÿ&lt;/li&gt;
&lt;li&gt;åŒæ™‚å¤§é‡ connect + retry æœ‰å¯èƒ½æœƒæ‰“å£è¢«ä¾è³´çš„æœå‹™
&lt;ul&gt;
&lt;li&gt;ex. backend + in-k8s redisï¼Œå¤§é‡çš„ backend pod åŒæ™‚é‡å•Ÿï¼Œæœƒæ‰“å£ redis&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥é‚„è¦å¯¦ä½œ retry delay, timeout backoff&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¦‚ä½•é‡å•Ÿæœ‰ä¾è³´çš„-workload&#34;&gt;å¦‚ä½•é‡å•Ÿæœ‰ä¾è³´çš„ Workload&lt;/h3&gt;
&lt;p&gt;ä¾æ“šåœ˜éšŠçš„ç›®æ¨™è€Œå®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ex ç›®æ¨™æ˜¯æœ€å°‘æ•´é«”é‡å•Ÿæ¬¡æ•¸&lt;/li&gt;
&lt;li&gt;å…ˆé‡å•Ÿè¢«ä¾è³´çš„æœå‹™ ex. redis&lt;/li&gt;
&lt;li&gt;åœ¨é‡å•Ÿä¾è³´çš„æœå‹™ ex. backend&lt;/li&gt;
&lt;li&gt;è€ƒé©—æœå‹™çš„ replication æ•¸é‡æ˜¯å¦è¶³å¤ ï¼Œèƒ½å¦æ”¯æ’å¤§é‡é‡å•Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;ä¾åºé‡å•Ÿ-workloadæ‡‰è©²è®Šæˆè‡ªå‹•åŒ–çš„è…³æœ¬&#34;&gt;ä¾åºé‡å•Ÿ workloadï¼Œæ‡‰è©²è®Šæˆè‡ªå‹•åŒ–çš„è…³æœ¬&lt;/h5&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é©—è­‰&#34;&gt;é©—è­‰&lt;/h3&gt;
&lt;p&gt;Workload è½‰ç§»åˆ°æ–°ç‰ˆæœ¬ï¼Œæ¸¬è©¦ worklaod æ˜¯å¦æ­£å¸¸é‹ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å° worklaod æœ‰è¨­å®š monitoring èˆ‡ metrics&lt;/li&gt;
&lt;li&gt;ex. cpu, memory å‡ç´šå¾Œå¢åŠ å¤ªå¤šï¼Œæˆ–æ˜¯ç”¨çš„å¤ªå°‘&lt;/li&gt;
&lt;li&gt;ex. api åœ¨é‡å•Ÿéç¨‹ä¸­å™´ 5xxï¼Œ5xx çš„æ¬¡æ•¸ç•°å¸¸å¢åŠ ï¼Œè‡ªå‹• alert&lt;/li&gt;
&lt;li&gt;ex. api, websocket éŒ¯èª¤æ¯”ä¾‹å¢åŠ &lt;/li&gt;
&lt;li&gt;ex. non 2xx çš„ access log é‡å¢åŠ &lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;èˆ‡å…¶èªªæ˜¯æ¸¬è©¦æ›´åƒæ˜¯æŠŠæŒçºŒç›£æ§åšå€‹æ›´å®Œæ•´&#34;&gt;èˆ‡å…¶èªªæ˜¯æ¸¬è©¦ï¼Œæ›´åƒæ˜¯æŠŠæŒçºŒç›£æ§åšå€‹æ›´å®Œæ•´&lt;/h5&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å‡ç´šå¾Œè·¨ç’°å¢ƒæ¸¬è©¦&#34;&gt;å‡ç´šå¾Œè·¨ç’°å¢ƒæ¸¬è©¦&lt;/h3&gt;
&lt;p&gt;åœ¨æ¸¬è©¦ç’°å¢ƒå°å…¥æ›´å¤šæ¸¬è©¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chaos engineering åœ¨å¹³æ™‚å°±æŒçºŒæ³¨å…¥ errorï¼Œæ ¹æ“š scenario è¨­å®š k8s çš„åæ‡‰
&lt;ul&gt;
&lt;li&gt;ex. chaos monkey, chaos mesh&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;load testing æ¸¬è©¦ app åœ¨æ–°ç‰ˆæœ¬ k8s ä¸Šçš„æ•ˆèƒ½
&lt;ul&gt;
&lt;li&gt;ex. &lt;a href=&#34;https://github.com/grafana/k6&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/grafana/k6&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éå»çš„ incident çš„æ¸¬è©¦ script&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;ä¸æ˜¯ç‚ºäº†å‡ç´šå°å…¥é€™äº›æ¸¬è©¦è€Œæ˜¯å› ç‚ºæœ‰äº†é€™äº›æ¸¬è©¦è®“å‡ç´šæ›´æœ‰ä¿¡å¿ƒ&#34;&gt;ä¸æ˜¯ç‚ºäº†å‡ç´šå°å…¥é€™äº›æ¸¬è©¦ï¼Œè€Œæ˜¯å› ç‚ºæœ‰äº†é€™äº›æ¸¬è©¦ï¼Œè®“å‡ç´šæ›´æœ‰ä¿¡å¿ƒ&lt;/h5&gt;
&lt;hr&gt;
&lt;h5 id=&#34;k8s-å‡ç´šæœ‰å•é¡Œä¸æ˜¯æœ‰å•é¡Œ&#34;&gt;K8s å‡ç´šæœ‰å•é¡Œï¼Œä¸æ˜¯æœ‰å•é¡Œ&lt;/h5&gt;
&lt;h5 id=&#34;å¤ªæ™šç™¼ç¾æ‰æ˜¯å•é¡Œ&#34;&gt;å¤ªæ™šç™¼ç¾æ‰æ˜¯å•é¡Œ&lt;/h5&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¥½çš„ç›£æ¸¬æ˜¯å‡ç´šçš„ä¿è­·å‚˜&#34;&gt;å¥½çš„ç›£æ¸¬æ˜¯å‡ç´šçš„ä¿è­·å‚˜&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;æ€éº¼çŸ¥é“ k8s å‡ç´šæœ‰æ²’æœ‰å£ï¼Ÿç”¨ kubectl æ‰“çœ‹çœ‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;while true; do
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubectl get pods -n kube-system; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sleep 2;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;done
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;ç›£æ¸¬&#34;&gt;ç›£æ¸¬&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢çš„å„å€‹æ­¥é©Ÿéƒ½ä»°è³´ç›£æ¸¬è‡ªå‹•å‘Šè­¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ƒä»¶å£äº†ï¼Œè¦æœ‰ç›£æ¸¬ç´€éŒ„&lt;/li&gt;
&lt;li&gt;é‡è¦å…ƒä»¶å£äº†ï¼Œè¦ä¸»å‹•å‘Šè­¦&lt;/li&gt;
&lt;li&gt;æ²’å£ä½†æ˜¯æœ‰ç•°å¸¸è®Šå‹•ï¼Œè¦ä¸»å‹•å‘Šè­¦&lt;/li&gt;
&lt;li&gt;å‡ºéŒ¯æ²’ç›£æ¸¬åˆ°ï¼Œè£œä¸Šç›£æ¸¬è·Ÿæ¸¬è©¦ï¼Œå†ä¾†ä¸€æ¬¡ï¼Œç´¯ç©æ–°ç‰ˆæœ¬çš„ä¿¡å¿ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç›£æ¸¬åƒè€ƒå·¥å…·&#34;&gt;ç›£æ¸¬åƒè€ƒå·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/prometheus-operator/prometheus-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus-operator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;prometheus&lt;/li&gt;
&lt;li&gt;grafana&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/dashboards&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-mixin&lt;/a&gt; alert, rule, dashboards
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://samber.github.io/awesome-prometheus-alerts/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://samber.github.io/awesome-prometheus-alerts/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é¡˜æ™¯è‡ªå‹•åŒ–-k8s-å‡ç´š&#34;&gt;é¡˜æ™¯ï¼šè‡ªå‹•åŒ– k8s å‡ç´š&lt;/h3&gt;
&lt;p&gt;ä»Šå¤©è¨è«–çš„æ­¥é©Ÿï¼Œæœ‰å“ªäº›å¯ä»¥é€²ä¸€æ­¥å†è‡ªå‹•åŒ–çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çœ‹ CHANGELOGï¼Œé¸å®šç›®æ¨™ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;æƒææœå‹™ k8s api version&lt;/li&gt;
&lt;li&gt;æ’ç¨‹å‡ç´šçš„æ™‚é–“&lt;/li&gt;
&lt;li&gt;å‡ç´š etcd&lt;/li&gt;
&lt;li&gt;å‡ç´š kube-apiserver, scheduler, controller manager&lt;/li&gt;
&lt;li&gt;å‡ç´š node&lt;/li&gt;
&lt;li&gt;é·ç§» workload&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;were-hiring&#34;&gt;We&amp;rsquo;re hiring!&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cake.me/companies/maicoin/jobs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.cake.me/companies/maicoin/jobs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_9da35ea5399dd4b247c69c19f4c75987.webp 400w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_55917817014d7ac627b45f9c4a791867.webp 760w,
               /zh-hant/slides/2024-10-23-upgrade-k8s-cluster/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2024-10-23-upgrade-k8s-cluster/we-re-hiring_hu7224f98eba3fbc175440ef1f6bf665c9_15949_9da35ea5399dd4b247c69c19f4c75987.webp&#34;
               width=&#34;400&#34;
               height=&#34;400&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åƒè€ƒè³‡æ–™&#34;&gt;åƒè€ƒè³‡æ–™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Overview: Official doc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Cloud Summit: Cloud Infrastructure Saving Engineering  é›²ç«¯çœéŒ¢å·¥ç¨‹</title>
      <link>https://chechia.net/zh-hant/talk/cloud-summit-cloud-infrastructure-saving-engineering-%E9%9B%B2%E7%AB%AF%E7%9C%81%E9%8C%A2%E5%B7%A5%E7%A8%8B/</link>
      <pubDate>Wed, 03 Jul 2024 12:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/cloud-summit-cloud-infrastructure-saving-engineering-%E9%9B%B2%E7%AB%AF%E7%9C%81%E9%8C%A2%E5%B7%A5%E7%A8%8B/</guid>
      <description>&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;Title: SRE Conference: Cloud Infrastructure Saving Engineering é›²ç«¯çœéŒ¢å·¥ç¨‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ AWS èˆ‡ Kubernetes å°±æ˜¯è¦èŠ±éŒ¢ï¼Œå¦‚ä½•çœéŒ¢ï¼Ÿ
åˆç†çš„è¨­å®šè³‡æºï¼Œä¸åƒ…çœéŒ¢ï¼Œé‚„æå‡æ•´é«”æœå‹™ç©©å®šåº¦ï¼Ÿ
æ—¢æœ‰æœå‹™å·²ç¶“å­˜åœ¨ï¼Œå¦‚ä½•é€æ­¥æ”¹è®Šï¼Œé™ä½æˆæœ¬ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›ä»¥å¯¦å‹™çš„ç¯„ä¾‹ï¼Œåˆ†äº«å¹¾å€‹ç¯€çœé›²ç«¯é–‹éŠ·çš„æ–¹æ³•ï¼ŒåŒ…å«ï¼šå°å…¥ spot instanceï¼Œæˆæœ¬è¨ˆç®—èˆ‡é æ¸¬å·¥å…·ï¼Œå‹•æ…‹è³‡æºèª¿æ•´HPAèˆ‡VPAï¼Œsaving plan&amp;hellip;ï¼Œä¸¦åˆ†äº«å¦‚ä½•æ”¹è®Šæ–‡åŒ–ï¼Œæé«˜åœ˜éšŠçš„æˆæœ¬æ„è­˜ï¼Œå¯¦éš›çš„é™ä½é–‹éŠ·&lt;/p&gt;
&lt;h1 id=&#34;target-group&#34;&gt;Target group&lt;/h1&gt;
&lt;p&gt;AWS &amp;amp; Kubernetes User who want to decrease overall cost of infrastructure&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å…¥å·¥å…·ï¼šæœ‰å“ªäº›å·¥å…·å¯ä»¥ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;åˆ†æç¾æ³ï¼šç²¾ç®—å„åœ˜éšŠèˆ‡å„å°ˆæ¡ˆæˆæœ¬&lt;/li&gt;
&lt;li&gt;æ”¹è®Šç¾æ³ï¼šå¾æ—¢æœ‰çš„æ¶æ§‹ä¸­ï¼Œæ‰¾å°‹å¯ä»¥ç¯€çœæˆæœ¬çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;æ”¹å–„æµç¨‹ï¼šæœ‰æ•ˆç‡çš„ç¶­æŒçœéŒ¢ workflow&lt;/li&gt;
&lt;li&gt;æ”¹è®Šæ–‡åŒ–ï¼šæŒçºŒæ€§ä½ç¶­æŒæ–°æœå‹™èˆ‡èˆŠæœå‹™çš„åˆç†æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Chang æ˜¯ä¸€åå°ˆæ³¨æ–¼å¾Œç«¯é–‹ç™¼ã€é–‹ç™¼ç¶­é‹ã€å®¹å™¨åŒ–æ‡‰ç”¨åŠ Kubernetes é–‹ç™¼èˆ‡ç®¡ç†çš„æŠ€è¡“å°ˆå®¶ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ Microsoft æœ€æœ‰åƒ¹å€¼å°ˆæ¥­äººå£«ï¼ˆMVPï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ´»èºæ–¼å°ç£æŠ€è¡“ç¤¾ç¾¤ï¼Œç¶“å¸¸åœ¨ CNTUGã€DevOps Taipeiã€GDG Taipeiã€Golang Taipei Meetup ç­‰ç¤¾ç¾¤åˆ†äº« DevOpsã€SREã€Kubernetes åŠé›²ç«¯é‹ç®—ç›¸é—œæŠ€è¡“ã€‚è‡´åŠ›æ–¼æ¨å‹•é–‹ç™¼èˆ‡ç¶­é‹çš„æœ€ä½³å¯¦è¸ï¼Œä¸¦ç†±è¡·æ–¼ç ”ç©¶èˆ‡æ‡‰ç”¨æœ€æ–°çš„é›²ç«¯èˆ‡ AI æŠ€è¡“ã€‚&lt;/p&gt;
&lt;p&gt;å€‹äººéƒ¨è½æ ¼ï¼šhttps://chechia.net&lt;/p&gt;
&lt;p&gt;Che-Chia Chang is a technology expert specializing in backend development, DevOps, site reliability engineering (SRE), containerized applications, and Kubernetes development and management. He is also recognized as a Microsoft Most Valuable Professional (MVP).&lt;/p&gt;
&lt;p&gt;Actively engaged in the Taiwanese tech community, he frequently shares insights on DevOps, SRE, Kubernetes, and cloud computing at CNTUG, DevOps Taipei, GDG Taipei, and Golang Taipei Meetup. Passionate about promoting best practices in development and operations, he continuously explores and applies the latest advancements in cloud and AI technologies.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2023 DevOpsDay&lt;/li&gt;
&lt;li&gt;2023 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Cloud Summit: Cloud Infrastructure Saving Engineering  é›²ç«¯çœéŒ¢å·¥ç¨‹</title>
      <link>https://chechia.net/zh-hant/slides/2024-07-03-saving-money-on-cloud-k8s/</link>
      <pubDate>Mon, 01 Jul 2024 12:45:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2024-07-03-saving-money-on-cloud-k8s/</guid>
      <description>
&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;onepiece.png&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  æŠ•å½±ç‰‡è·Ÿè¬›ç¨¿æˆ‘éƒ½æ”¾åœ¨æˆ‘çš„ç¶²ç«™ä¸Šï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒ
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é›²ç«¯k8sçœéŒ¢å·¥ç¨‹&#34;&gt;é›²ç«¯K8sçœéŒ¢å·¥ç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Che Chia Chang&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å…©å€‹é—œéµå­—ï¼šé›²ç«¯ / k8s
å¦‚æœä½ æœ‰åœ¨ä½¿ç”¨å…¬æœ‰é›²ï¼Œè€Œä¸”æœ‰åœ¨è·‘ k8sï¼Œä½ æ˜¯é€™ç¯‡æ¼”è¬›çš„æœ€ä¸»è¦å°è±¡
å¦‚æœä½ æ˜¯ç§æœ‰é›² k8sï¼Œæˆ–æ˜¯å…¶ä»–çš„é›²ç«¯æœå‹™ï¼Œæœ‰ä¸€äº›ç›¸é€šçš„æ¦‚å¿µï¼Œæœƒæœ‰ä¸€äº›åƒè€ƒåƒ¹å€¼
å¦‚æœä½ æ˜¯åœ°ç«¯çš„æ©Ÿå™¨ï¼Œé›–ç„¶æ¦‚å¿µç›¸åŒï¼Œä½†æˆæœ¬æ§åˆ¶çš„åšæ³•å®Œå…¨æ˜¯å¦å¤–ä¸€å€‹æ•…äº‹ï¼Œä½ å¯ä»¥ç•¶åˆä¼‘æ™‚é–“çš„æ•…äº‹è½è½çœ‹
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é—œæ–¼æˆ‘&#34;&gt;é—œæ–¼æˆ‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Che Chia Chang&lt;/li&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.linkedin.com/company/maicoin/jobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å€‹äººéƒ¨è½æ ¼&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;presentation and speaker notes&lt;/li&gt;
&lt;li&gt;éµäººè³½ (Terraform / Vault æ‰‹æŠŠæ‰‹å…¥é–€)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¤§ç¶±&#34;&gt;å¤§ç¶±&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…¬æœ‰é›²çš„è²»ç”¨&lt;/li&gt;
&lt;li&gt;ç¯€çœç®—åŠ›æˆæœ¬&lt;/li&gt;
&lt;li&gt;ç›£æ§æ˜¯æˆæœ¬æ§ç®¡çš„åŸºç¤&lt;/li&gt;
&lt;li&gt;å°å…¥æˆæœ¬åˆ†æèˆ‡é æ¸¬å·¥å…·&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–è³‡æºä½¿ç”¨å»ºè­°&lt;/li&gt;
&lt;li&gt;Saving Plan/Committed Usage&lt;/li&gt;
&lt;li&gt;Spot Instance èˆ‡å¾®æœå‹™&lt;/li&gt;
&lt;li&gt;Autoscaling: HPA / VPA&lt;/li&gt;
&lt;li&gt;Q&amp;amp;A&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é€™æ˜¯æˆ‘å€‘ä»Šå¤©çš„å¤§ç¶±&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘æœƒå…ˆè¬›ä¸€ä¸‹åœ¨å…¬æœ‰é›²ä¸Šçš„æˆæœ¬
ç„¶å¾Œè¬›ä¸€ä¸‹ k8s çš„é‹ç®—è³‡æºç®¡ç†
æ¥è‘—è¬›ä¸€ä¸‹ç›£æ§ï¼Œç‚ºä½•æˆæœ¬æ§ç®¡çš„åŸºç¤æ˜¯ç›£æ§
å¦‚ä½•ä½¿ç”¨å·¥å…·æˆæœ¬åˆ†æï¼Œæœªä¾†æˆæœ¬é æ¸¬
ç„¶å¾Œä½¿ç”¨å·¥å…·å»ºè­°åˆé©çš„è³‡æº
æœ€å¾Œè¬›å¯¦å‹™ä¸Šè¦å¦‚ä½•é™ä½æˆæœ¬ï¼Œä¾‹å¦‚ saving plan / spot instance / HPA / VPAï¼Œä¾ç…§åŸ·è¡Œçš„é›£åº¦æ’åºï¼Œæœ‰æ™‚é–“çš„è©±ä¹Ÿæœƒè¬›å¦‚ä½•å¾ç„¡åˆ°æœ‰é–‹å§‹é€²è¡Œ&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å‹•æ©Ÿ&#34;&gt;å‹•æ©Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…¬å¸å¸Œæœ›è³ºéŒ¢ï¼Œç¯€çœæˆæœ¬&lt;/li&gt;
&lt;li&gt;åœ˜éšŠå¸Œæœ›æ§åˆ¶æˆæœ¬&lt;/li&gt;
&lt;li&gt;å€‹äººç”¢ç”Ÿ Credit èˆ‡åœ˜éšŠ Impact&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  åœ˜éšŠè€Œè¨€ï¼Œæˆæœ¬æ§åˆ¶æ˜¯ä¸€å€‹å¾ˆé‡è¦çš„è­°é¡Œï¼Œå› ç‚ºæˆæœ¬æ§åˆ¶æ˜¯ä¸€å€‹å¾ˆç›´æ¥çš„å½±éŸ¿å…¬å¸ç²åˆ©çš„æ–¹å¼
å€‹äººï¼Œå¦‚æœç‚ºå…¬å¸ç¯€çœè¶…éå€‹äººçš„è–ªæ°´ï¼Œé‚£å…¬å¸è˜ç”¨ä½ å°±æ˜¯æ·¨è³º
ç¯€çœå…¬å¸é›²ç«¯æˆæœ¬ 50% è·æ¶¯ä¸Šå±¥æ­·å¾ˆå¥½çœ‹
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å…¬æœ‰é›²çš„è²»ç”¨&#34;&gt;å…¬æœ‰é›²çš„è²»ç”¨&lt;/h3&gt;
&lt;p&gt;æ‰“é–‹å…¬æœ‰é›²çš„ billing&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®—åŠ›æˆæœ¬ Compute Resource (cpu, memory)&lt;/li&gt;
&lt;li&gt;å„²å­˜æˆæœ¬ Storage (Disk, EBS, S3&amp;hellip;)&lt;/li&gt;
&lt;li&gt;ç¶²è·¯ Networking&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æœ‰åœ¨ä½¿ç”¨å…¬æœ‰é›²çš„äººï¼ŒæŠŠå…¬æœ‰é›²çš„ billing å¸³å–®æ‰“é–‹ä¾†çœ‹ï¼Œå¯èƒ½çœ‹åˆ°çš„å¤§æ¦‚æ˜¯é€™å¹¾å€‹é …ç›®
ç•¶ç„¶å› ç‚ºä¸åŒåœ˜éšŠçš„æœå‹™ä¸åŒï¼Œå¯èƒ½æœƒæœ‰ä¸€äº›å‡ºå…¥ï¼Œä½†å¦‚æœä½ çš„å…¬å¸çš„ç”¢å“æ˜¯ web serviceï¼Œæ‡‰è©²æœƒæœ‰é€™å¹¾å€‹é …ç›®
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä»Šå¤©åªæœƒè¬›é€™å€‹ç®—åŠ›æˆæœ¬&#34;&gt;ä»Šå¤©åªæœƒè¬›é€™å€‹ç®—åŠ›æˆæœ¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç®—åŠ›æˆæœ¬ Compute Resource (cpu, memory)&lt;/li&gt;
&lt;li&gt;ä»Šå¤©åªæœƒè¬›é€™å€‹&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;Storage ä¸å¤ªå¥½èªªçœå°±çœï¼Œå› ç‚ºä½ çš„è³‡æ–™é‡å°±åœ¨é‚£é‚Šï¼Œæ”¾ä¸ä¸‹å°±æ˜¯è¦å†è²·ï¼Œæ‰€ä»¥ storage çš„æˆæœ¬æ§åˆ¶ï¼Œå¯èƒ½æ˜¯åœ¨è³‡æ–™çš„ä½¿ç”¨ä¸Šï¼Œä¾‹å¦‚è³‡æ–™çš„å£“ç¸®ï¼Œæˆ–æ˜¯è³‡æ–™çš„å‚™ä»½ï¼Œæˆ–æ˜¯è³‡æ–™çš„å­˜å–æ–¹å¼ï¼Œé€™äº›æ˜¯å¦å¤–ä¸€å€‹æ•…äº‹
ä½¿ç”¨å…¬æœ‰é›²çš„æœå‹™ï¼ŒåŸºæœ¬ä¸Š storage éƒ½æ˜¯ä¾æ“šä½¿ç”¨çš„å¤§å°è¨ˆåƒ¹ï¼Œè€Œä¸”éœ€å¤šæœå‹™éƒ½å¯ä»¥å‹•æ…‹å¢é•·ï¼Œä¾‹å¦‚å‹•æ…‹å¢åŠ  disk&lt;/p&gt;
&lt;p&gt;Storage / Database / Networking é€™å¹¾å€‹é …ç›®ï¼Œæˆ‘å€‘ä¸‹é›†å†ä¾†è«‡&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç®—åŠ›æˆæœ¬&#34;&gt;ç®—åŠ›æˆæœ¬&lt;/h3&gt;
&lt;p&gt;ç¶²é æœå‹™çš„å¾®æœå‹™ç³»çµ±ï¼Œéƒ½éœ€è¦ç®—åŠ›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;api server&lt;/li&gt;
&lt;li&gt;cronjob&lt;/li&gt;
&lt;li&gt;business logic job&lt;/li&gt;
&lt;li&gt;database
å¦‚éœ€ç¯€çœï¼Œä¹Ÿå¯ä»¥å¾é€™è£¡ä¸‹æ‰‹&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚æœä½ è·Ÿæ•ç¤¾ä¸€æ¨£æ˜¯ web serviceï¼Œé‚£éº¼ cpu / memory å¯èƒ½æ˜¯ä½ æœ€å¤§çš„ä¸€ç­†æˆæœ¬&lt;/p&gt;
&lt;p&gt;ä½ éœ€è¦è¶³å¤ é‹ç®—èƒ½åŠ› serve å®¢æˆ¶ï¼Œä¸ç®¡æ˜¯æ”¯æŒç”¨æˆ¶çš„requestï¼Œé€²è¡Œå•†æ¥­é‚è¼¯çš„é‹ç®—ï¼Œç„¶å¾ŒæŠŠé‹ç®—å®Œæˆçš„ç‹€æ…‹å›å‚³çµ¦å®¢æˆ¶ï¼Œæˆ–æ˜¯å­˜åœ¨è³‡æ–™åº«ä¸­ï¼Œæ¯ä¸€å€‹å‹•ä½œéƒ½éœ€è¦ç®—åŠ›&lt;/p&gt;
&lt;p&gt;è¶³å¤ çš„ cpu è·Ÿ memoryï¼Œä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè€Œæ˜¯è¶³å¤ ï¼Œä¸æœƒæµªè²»ï¼Œä¹Ÿä¸æœƒå› ç‚ºä¸è¶³è€Œå½±éŸ¿æœå‹™å“è³ª
æˆ‘å€‘è¦çœéŒ¢ï¼Œå°±è¦å¾é€™è£¡ä¸‹æ‰‹&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°‹æ‰¾å¤šé¤˜çš„ç®—åŠ›&#34;&gt;å°‹æ‰¾å¤šé¤˜çš„ç®—åŠ›&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å·²æœ‰è¶³å¤ çš„ cpu / memoryï¼Œå¤šçµ¦ä¹Ÿä¸æœƒå¢åŠ æœå‹™å“è³ªçš„å¤šé¤˜ç®—åŠ›&lt;/li&gt;
&lt;li&gt;å¤šå°‘æ‰æ˜¯å¤ ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ¸›å»å¤šå°‘ cpu / memoryï¼Œä¾ç„¶ä¸æ”¹è®Šæœå‹™å“è³ª&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¤šå°‘æ‰æ˜¯å¤ ï¼Ÿé€™æ˜¯ä¸€å€‹è¤‡é›œçš„å•é¡Œï¼Œå¯¦å‹™ä¸Šé€šå¸¸ä½¿ç”¨ SLA / SLO ä¾†è¡¡é‡æœå‹™å“è³ªï¼Œç„¶å¾Œæ ¹æ“šæœå‹™å“è³ªçš„è¦æ±‚ï¼Œä¾†è¨­å®š cpu / memory çš„é…é¡&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©è¦åšçš„æ˜¯æˆæœ¬å„ªåŒ–ï¼Œç™½è©±çš„èªªæ˜¯é™ä½ cpu / memory çš„è¨­å®šé…é¡ï¼Œä½†æ˜¯æˆ‘å€‘ä¸èƒ½é™ä½åˆ°å½±éŸ¿æœå‹™å“è³ª
ç”šè‡³é€€ä¸€ç™¾æ­¥ï¼Œé˜²å®ˆæ€§çš„ä¾†èªªï¼Œæˆ‘å€‘ä¸å¸Œæœ›å› ç‚ºé™ä½ cpu / memory çš„è¨­å®šé…é¡ï¼Œç‚ºäº†çœéŒ¢è€Œå°è‡´è² é¢çš„çµæœï¼Œç”šè‡³ç‚ºæœå‹™çš„ç©©å®šåº¦èƒŒé‹ã€‚&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç¶­æŒslo&#34;&gt;ç¶­æŒSLO&lt;/h3&gt;
&lt;p&gt;ä»¥ç¶­æŒå„å€‹æœå‹™å…ƒä»¶çš„ SLOç‚ºå‰æï¼Œé™ä½ cpu / memory ä½¿ç”¨é‡&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ç¶­æŒå€‹å€‹æœå‹™å…ƒä»¶çš„ SLO
æ˜¯ä¸€å€‹å¾ˆå¥½çš„æŒ‡æ¨™ï¼Œå¦‚æœä½ çš„æœå‹™æ˜¯ 99.9% çš„ SLAï¼Œé‚£éº¼ä½ çš„æœå‹™å°±è¦ä¿è­‰ 99.9% çš„æ™‚é–“éƒ½æ˜¯æ­£å¸¸é‹ä½œçš„ï¼Œé‚£éº¼ä½ çš„ cpu / memory å°±è¦è¶³å¤ æ”¯æŒé€™å€‹ SLA&lt;/p&gt;
&lt;p&gt;è«‡ SLO ä¹‹å‰ï¼Œä½ è¦å…ˆçŸ¥é“ä½ çš„æœå‹™çš„ SLA æ˜¯å¤šå°‘ï¼Œä½ è¦å…ˆçŸ¥é“ç•¶å‰çš„ç‹€æ…‹æ˜¯å¤šå°‘
é€™å€‹åœ¨ç¨å¾Œçš„ monitoring æœƒæåˆ°ï¼Œç‚ºä»€éº¼ç›£æ§æ˜¯æˆæœ¬ç®¡ç†çš„åŸºç¤&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åŸºæ–¼-slo-çš„æˆæœ¬èª¿é™&#34;&gt;åŸºæ–¼ SLO çš„æˆæœ¬èª¿é™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è² è¼‰ç©©å®šçš„å…ƒä»¶ï¼Œå¯ä»¥æŠ“éå» 30d çš„ p99 cpu time æˆ– p99 memory usage + buffer&lt;/li&gt;
&lt;li&gt;è² è¼‰ä¸ç©©å®šçš„å…ƒä»¶ï¼Œä¾‹å¦‚ cpu usage èˆ‡å—æ´»èºç”¨æˆ¶æ•¸é‡æ­£æ¯”ï¼Œéœ€è¦æ­é… HPA æ°´å¹³æ‹“å±•&lt;/li&gt;
&lt;li&gt;è² è¼‰ä¸ç©©å®šçš„å…ƒä»¶ï¼Œä½†åˆä¸èƒ½æ°´å¹³æ‹“å±•ï¼Œä¾‹å¦‚ stateful serviceï¼Œå¯ä»¥è€ƒæ…® VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  è² è¼‰ç©©å®šçš„å…ƒä»¶ï¼Œå›ºå®šåƒå¤šå°‘ cpu / memoryï¼Œä»–çš„é™„è¼‰ä¸å¤ªå®¹æ˜“éš¨å¤–éƒ¨å› ç´ æ³¢å‹•çš„æœå‹™ï¼Œå¯ä»¥æŠ“éå» 30d çš„ p99 cpu time æˆ– p99 memory usage + bufferï¼Œç„¶å¾Œé™ä½ cpu / memory çš„è¨­å®šé…é¡
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµæˆæœ¬æ§ç®¡çš„åŸºæœ¬æ¦‚å¿µ&#34;&gt;å°çµï¼šæˆæœ¬æ§ç®¡çš„åŸºæœ¬æ¦‚å¿µ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å°‹æ‰¾æœå‹™ä¸­å¤šé¤˜ç®—åŠ›&lt;/li&gt;
&lt;li&gt;ä»¥ç¶­æŒ SLO ç‚ºå‰æ&lt;/li&gt;
&lt;li&gt;é™ä½ cpu / memory ä½¿ç”¨é‡&lt;/li&gt;
&lt;li&gt;ä¾æ“šå…ƒä»¶è² è¼‰ç‰¹æ€§ï¼Œé¸æ“‡é©ç•¶çš„èª¿é™æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;k8s-cpu--memory-managementhttpskubernetesiodocsconceptsconfigurationmanage-resources-containers&#34;&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s cpu / memory management&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;k8s å¦‚ä½•ç®¡ç† workload çš„ cpu èˆ‡ memory&lt;/li&gt;
&lt;li&gt;èª¿é™å¤šå°‘æœƒå½±éŸ¿æœå‹™å“è³ª&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é€™è£¡é¢å†è¬›ä¸€ä¸‹ k8s å¦‚ä½•ç®¡ç† cpu / memory&lt;/p&gt;
&lt;p&gt;é€™é‚Šçš„é‡é»æ˜¯ï¼Œæ€éº¼æ¨£çš„èª¿æ•´æœƒå½±éŸ¿åˆ°æœå‹™å“è³ªï¼Œé‚£æˆ‘å€‘åšæˆæœ¬æ§åˆ¶çš„æ™‚å€™ï¼Œå°±ä¸è¦å»è¸©åˆ°é€™å€‹åº•ç·š&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;how-k8s-manage-cpu--memoryhttpskubernetesiodocsconceptsconfigurationmanage-resources-containershow-pods-with-resource-limits-are-run&#34;&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#how-pods-with-resource-limits-are-run&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How k8s manage cpu / memory&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;scheduler ä¾æ“š cpu / memory request èª¿åº¦ pod&lt;/li&gt;
&lt;li&gt;container runtime è¨­å®š cgroup
&lt;ul&gt;
&lt;li&gt;cpu ä½¿ç”¨é‡ä¾æ“š request ä½” node æ¯”ä¾‹åˆ†é…&lt;/li&gt;
&lt;li&gt;æ§åˆ¶ cpu ç”¨é‡ä¸è¶…é limit&lt;/li&gt;
&lt;li&gt;memory ä½¿ç”¨ limitï¼Œè¶…é limit æœƒè¢« oomkillï¼Œä¸¦ä¾æ“šè¨­å®šé‡å•Ÿ&lt;/li&gt;
&lt;li&gt;ç•¶å‰ node memory ä¸è¶³æ™‚ï¼Œæœƒä¾æ“š pod request Evict pod&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æ–‡ä»¶è¬›å¾—å¾ˆæ¸…æ¥š
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä¸Šé¢éƒ½æ˜¯æ¦‚å¿µåº•ä¸‹é€²å¯¦ä½œ&#34;&gt;ä¸Šé¢éƒ½æ˜¯æ¦‚å¿µï¼Œåº•ä¸‹é€²å¯¦ä½œ&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;monitoring-ç›£æ§æ˜¯æˆæœ¬æ§ç®¡çš„åŸºç¤&#34;&gt;Monitoring ç›£æ§æ˜¯æˆæœ¬æ§ç®¡çš„åŸºç¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç›£æ¸¬æ˜¯æˆæœ¬æ§ç®¡çš„åŸºç¤&lt;/li&gt;
&lt;li&gt;æ²’æœ‰ç›£æ¸¬å°±æ²’æœ‰ p99 cpu time / memory usageï¼Œä¹Ÿæ²’æœ‰ SLI/SLO&lt;/li&gt;
&lt;li&gt;æ²’æœ‰æª¢æ¸¬ä¸‹åšæˆæœ¬ç²¾ç°¡ï¼Œæœƒç¢°å£æœå‹™&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²’æœ‰ç›£æ¸¬å…ˆè£œæª¢æ¸¬&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚æœæ²’æœ‰ monitoringï¼Œä¸Šé¢çš„å…©å¤§å‰æéƒ½ä¸å­˜åœ¨
ç›®å‰çš„ cpu / memory usageï¼Œruntime utilization çš„è³‡æ–™
ç›®å‰SLOï¼Œèª¿é™ä¹‹å¾Œæ–°çš„SLO&lt;/p&gt;
&lt;p&gt;æ²’æœ‰æª¢æ¸¬ä¸‹ï¼Œé‚„æ˜¯å¯ä»¥åšæˆæœ¬ç²¾ç°¡
ç„¶è€Œè¦é¦¬å…’å¥½åˆè¦è€Œä¸åƒè‰ï¼Œä»Šå¤©å¦‚æœæŠŠ cpu / memory é™ä¸‹ä¾†ï¼Œæœ‰å¯èƒ½æœƒé¤“åˆ°æœå‹™
cpu throttling / memory oomkillï¼Œé€™äº›éƒ½æ˜¯å¯èƒ½ç™¼ç”Ÿçš„äº‹æƒ…
æœƒç¢°å£æœå‹™&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;grafana-dashboard.png&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;ç›£æ¸¬èª¿æ•´å‰è¨­å®šç›®æ¨™åŸºæº–ç·š&#34;&gt;ç›£æ¸¬ï¼šèª¿æ•´å‰è¨­å®šç›®æ¨™åŸºæº–ç·š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šç¯€çœç›®æ¨™ï¼šex. éå» 3 å€‹æœˆçš„ p99 è³‡æºç”¨é‡
&lt;ul&gt;
&lt;li&gt;99% çš„æ™‚é–“ï¼Œmemory ä½¿ç”¨é‡éƒ½åœ¨é€™æ¢ç·šä»¥ä¸‹&lt;/li&gt;
&lt;li&gt;99% çš„æ™‚é–“ï¼Œcpu throttling åœ¨é€™æ¢ç·šä»¥ä¸‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤šé¤˜çš„ç®—åŠ› = (åˆ†é…çš„ resource - p99)&lt;/li&gt;
&lt;li&gt;é‚£å¦‚æœæˆ‘å€‘æŠŠ cpu / memory é™ä½åˆ° p99 / p99.9 æœå‹™å“è³ªæœƒå—åˆ°å½±éŸ¿å—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;åšä¹‹å‰è¦èƒ½è©•ä¼°åšå®Œå¤§æ¦‚èƒ½çœå¤šå°‘
ä¾‹å¦‚è©•ä¼°å®Œå¾Œ&lt;/p&gt;
&lt;p&gt;å¦‚æœè©•ä¼°å®Œç™¼ç¾çœä¸äº†ä»€éº¼éŒ¢ï¼Œé‚£ç•¶ç„¶åœ˜éšŠå°±ä¸ä¸€å®šè¦åšé€™ä»¶äº‹&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;grafana-cpu-dashboard.png&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;ç›£æ¸¬-èª¿æ•´å¾Œ&#34;&gt;ç›£æ¸¬: èª¿æ•´å¾Œ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è³‡æºç”¨é‡æ˜¯å¦æœ‰è®ŠåŒ–&lt;/li&gt;
&lt;li&gt;ç¢ºå®šæ²’æœ‰æ”¹å£æ±è¥¿ï¼Œæœ‰å£è¦æœ‰åŠæ™‚çš„ alert&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½è¡¨ç¾ï¼šæœ‰å¯èƒ½æ²’å£ï¼Œä½†æ˜¯è®Šå¾ˆæ…¢&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚æœä½ æ”¹å£äº†ï¼ŒåŠæ™‚çš„ alert æœƒæ•‘ä½ ä¸€å‘½&lt;/p&gt;
&lt;p&gt;performance ç›£æ¸¬å¾ˆé‡è¦&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦ç›£æ¸¬å·¥å…·&#34;&gt;æ¨è–¦ç›£æ¸¬å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;prometheus.png&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¤§å®¶éƒ½çŸ¥é“ prometheus æ˜¯ä»€éº¼å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;çŸ¥é“çš„äººè«‹èˆ‰å€‹æ‰‹
ä¸çŸ¥é“çš„æˆ‘å¾ˆç°¡å–®èªªä¸€ä¸‹&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘æƒ³è¦çŸ¥é“ä¸€å€‹ pod æœƒéœ€è¦èŠ±å¤šå°‘ cpu / memoryï¼Œä½ å°±æŠŠå®ƒè·‘èµ·ä¾†ï¼Œç„¶å¾Œå»ç´€éŒ„è·‘èµ·ä¾†çš„ pod ç”¨äº†å¤šå°‘ cpu / memoryï¼Œç„¶å¾Œæ ¹æ“šæ™‚é–“çµ±è¨ˆï¼Œä½ å°±å¯ä»¥æ‹‰å‡ºä¸€å¼µåœ–ï¼Œçœ‹åˆ°é€™å€‹ pod ç”¨äº†å¤šå°‘ cpu / memory
ä½ çš„ kubelet / cadvisor / container runtime æœƒçŸ¥é“ä½ çš„ container çš„ cpu / memory ä½¿ç”¨é‡ï¼ŒåŒ…å« request &amp;amp; limit ç„¶å¾Œæ˜¯å¦æœ‰ throttling æˆ–æ˜¯ oomkillï¼Œé€™äº›è³‡è¨Šéƒ½æœƒè¢« prometheus æ”¶é›†èµ·ä¾†ï¼Œç„¶å¾Œä½ å¯ä»¥é€éå…¶ä»–å·¥å…·ï¼Œä¾‹å¦‚ kubecost çœ‹åˆ°é€™äº›è³‡è¨Š&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;grafana-cpu-usage.png&#34;
  &gt;

&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/dashboards/17375-k8s-resource-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/grafana/dashboards/17375-k8s-resource-monitoring/&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  é€™æ˜¯ prometheus æ”¶é›†çš„è³‡æ–™ï¼Œvm çš„ resource ä½¿ç”¨é‡çš„ grafana dashboard
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°å…¥æˆæœ¬åˆ†æèˆ‡é æ¸¬å·¥å…·&#34;&gt;å°å…¥æˆæœ¬åˆ†æèˆ‡é æ¸¬å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰äº† prometheus å¾Œï¼Œæˆ‘å€‘çŸ¥é“çŸ­æœŸ/é•·æœŸçš„è³‡æºä½¿ç”¨ç‹€æ³&lt;/li&gt;
&lt;li&gt;è¦æŠŠè³‡æºä½¿ç”¨è½‰æˆæˆæœ¬ï¼Œéœ€è¦ä¸€å€‹æˆæœ¬è¨ˆç®—å·¥å…·&lt;/li&gt;
&lt;li&gt;è©•ä¼°æ˜¯å¦è¦åšæˆæœ¬ç²¾ç°¡ï¼Œèƒ½å¤ æ¸›å°‘å¤šå°‘éŒ¢&lt;/li&gt;
&lt;li&gt;ç®¡ç†ä¸Šçš„è€ƒé‡ï¼šæŠ•è³‡äººåŠ›æˆæœ¬ï¼Œèˆ‡é æœŸå›å ±&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;æ”¿æ²»ä¸Šçš„è€ƒé‡ï¼Œåšæˆæœ¬ç¯€çœéœ€è¦æ™‚é–“è·ŸäººåŠ›è³‡æº
æœ‰ä¸€å€‹ç²¾æº–çš„æˆæœ¬åˆ†æï¼Œç¯€çœç©ºé–“ä¼°ç®—çš„å·¥å…·ååˆ†æœ‰èªªæœåŠ›&lt;/p&gt;
&lt;p&gt;æœ‰é€™äº›è³‡æ–™ï¼Œæ‰å¯ä»¥ç§‘å­¸åŒ–æ±ºç­–è¦ä¸è¦åšï¼Œè©²æ€éº¼åš
åšä¹‹å‰å°±èƒ½è©•ä¼°åšå®Œå¤§æ¦‚èƒ½çœå¤šå°‘&lt;/p&gt;
&lt;p&gt;å¦‚æœè©•ä¼°å®Œç™¼ç¾çœä¸äº†ä»€éº¼éŒ¢ï¼Œé‚£ç•¶ç„¶åœ˜éšŠå°±ä¸ä¸€å®šè¦åšé€™ä»¶äº‹&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æˆæœ¬åˆ†æ&#34;&gt;æˆæœ¬åˆ†æ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;VM å¯ä»¥ç”¨å„å®¶å…¬æœ‰é›²çš„è²»ç”¨è¨ˆç®—å·¥å…·&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://azure.microsoft.com/en-us/products/cost-management&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure Cost Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/aws-cost-management/aws-cost-explorer/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS Cost Explorer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/billing/docs/how-to/cost-breakdown&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Cost Breakdown&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;azure-cost-management.jpeg&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;æˆæœ¬åˆ†æå…¬æœ‰é›²-billing&#34;&gt;æˆæœ¬åˆ†æï¼šå…¬æœ‰é›² billing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨ˆç®—é•·æ™‚é–“çš„è²»ç”¨è¶¨å‹¢&lt;/li&gt;
&lt;li&gt;é©åˆç•¶ä½œæˆæœ¬ç²¾ç°¡å¾Œçš„æˆæœå›å ±&lt;/li&gt;
&lt;li&gt;ä¸é©åˆç•¶åšèª¿æ•´çš„ä¾æ“š&lt;/li&gt;
&lt;li&gt;æ™‚é–“è¨ˆç®—è¼ƒé•·ï¼Œåé¥‹æ™‚é–“é•·ï¼Œä¸åŠæ™‚ï¼Œé …ç›®ä¸å¤ ç²¾ç´°&lt;/li&gt;
&lt;li&gt;æœ‰ç„¡æ›´å³æ™‚çš„æˆæœ¬åˆ†æå·¥å…·ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æˆæœ¬åˆ†æ-kubecost--opencosthttpsdocskubecostcomusing-kubecost&#34;&gt;æˆæœ¬åˆ†æ: &lt;a href=&#34;https://docs.kubecost.com/using-kubecost/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰æä¾› UI&lt;/li&gt;
&lt;li&gt;åŸºæ–¼ prometheus&lt;/li&gt;
&lt;li&gt;å¯ä»¥é‡å° allocation åšæˆæœ¬åˆ†æ &lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cost Allocation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€é cloud provider å»æ’ˆé›²ç«¯çš„ä½¿ç”¨è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubecost.jpeg&#34;
  &gt;

&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubecost-allocation.jpeg&#34;
  &gt;

&lt;p&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubecost-efficiency.png&#34;
  &gt;

&lt;p&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation/efficiency-idle&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation/efficiency-idle&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·&#34;&gt;æ¨è–¦å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/robusta-dev/krr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/robusta-dev/krr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/savings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost Savings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA recommendator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·-kubecost--opencost-savingshttpsdocskubecostcomusing-kubecostnavigating-the-kubecost-uisavings&#34;&gt;æ¨è–¦å·¥å…·: &lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/savings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost Savings&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®š target utilization
&lt;ul&gt;
&lt;li&gt;request / allocatable&lt;/li&gt;
&lt;li&gt;dev 80%+&lt;/li&gt;
&lt;li&gt;prod 60%&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æ ¹æ“šæœå‹™å“è³ªçš„è¦æ±‚ï¼Œä»¥åŠå…¬å¸æ”¿ç­–å»åšè¨­å®š
SLA/SLO
é–‹ç™¼èˆ‡æ¸¬è©¦ç’°å¢ƒï¼Œåœ¨ä¸å½±éŸ¿å·¥ä½œçš„å‰æï¼Œéƒ½å¯ä»¥æ‹‰åˆ° overcommit
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·-krr&#34;&gt;æ¨è–¦å·¥å…·: KRR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/robusta-dev/krr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/robusta-dev/krr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å…å®‰è£ï¼Œä¸å½±éŸ¿ k8s æœ¬èº«&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¤–éƒ¨å·¥å…·è®€å– prometheus è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·-krr-1&#34;&gt;æ¨è–¦å·¥å…·: KRR&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward svc/prometheus 9090
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/robusta-dev/krr.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;source .venv/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python krr.py simple \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p http://127.0.0.1:9090 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --mem-min 10 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --cpu-min 10 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --history_duration 720 -q
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;krr.jpeg&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·-krr-2&#34;&gt;æ¨è–¦å·¥å…·: KRR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ“š krr è¨ˆç®—çš„çµæœï¼Œæ‰‹å‹•èª¿æ•´&lt;/li&gt;
&lt;li&gt;æœ‰ä¸€äº›å·¥å…·æœ‰æä¾›è‡ªå‹•èª¿æ•´ ex VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;è‡ªå‹•å·¥å…·æ¯”æ‰‹å‹•éœ€è¦è€ƒé‡æ›´å¤šå› ç´ ï¼Œé€™å€‹æˆ‘å€‘ç¨å€™ VPA å†æ&lt;/p&gt;
&lt;p&gt;è«‹è©³é–±å·¥å…·èªªæ˜å†æœç”¨&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·-vpa-recommendatorhttpsgithubcomkubernetesautoscalerblobmastervertical-pod-autoscalerpkgrecommenderreadmemd&#34;&gt;æ¨è–¦å·¥å…·: &lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA recommendator&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦å…ˆçŸ¥é“ VPA æ˜¯ä»€éº¼&lt;/li&gt;
&lt;li&gt;ç›´æ¥å®‰è£åœ¨ k8s cluster å…§&lt;/li&gt;
&lt;li&gt;é€é Prometheus è³‡æ–™ï¼Œæ¨è–¦é©ç•¶çš„è³‡æº&lt;/li&gt;
&lt;li&gt;å¯ä»¥è‡ªå‹•åŒ–æ¨è–¦è³‡æºï¼Œèª¿æ•´é‹è¡Œä¸­çš„ podï¼Œä¾ç…§è¨­å®šé‡å•Ÿ pod &lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/README.md#quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éœ€è¦å¯ä»¥åƒè€ƒ &lt;a href=&#34;https://github.com/cowboysysop/charts/tree/master/charts/vertical-pod-autoscaler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm chart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  krr æ˜¯å¯ä»¥ç„¡è…¦ç”¨çš„å·¥å…·ï¼Œä½†æ˜¯ VPA å°±ä¸æ˜¯äº†
è«‹è¨­å®š VPA mode Off
è«‹å‹™å¿…éœ€è¦ç ”ç©¶ä¸€ä¸‹åœ¨ä½¿ç”¨
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ¨è–¦å·¥å…·-æ¯”è¼ƒ&#34;&gt;æ¨è–¦å·¥å…·: æ¯”è¼ƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;kubecost éœ€è¦ helm installï¼Œkrr ä¸éœ€è¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kubecost ç”¢ç”Ÿä¸€å€‹æ¼‚äº®çš„ UIï¼Œkrr ç”¢ç”Ÿ command line å ±è¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VPA éœ€è¦ helm installï¼Œä¸¦ä¸”æœƒéœ€è¦ cluster æ¬Šé™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VPA å¯ä»¥åšåˆ°è‡ªå‹•åŒ–èª¿æ•´ï¼Œé‚è¼¯æ›´è¤‡é›œï¼Œæœ‰ä¾µå…¥æ€§ï¼Œè¨­å®šæœ‰å•é¡Œæœƒå‡ºäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å‰›ä¸Šæ‰‹çš„åšæ³•&#34;&gt;å‰›ä¸Šæ‰‹çš„åšæ³•&lt;/h3&gt;
&lt;p&gt;æ²’æ™‚é–“ç´°éƒ¨ç ”ç©¶ç ”ç©¶å…ƒä»¶çš„è¡Œç‚ºï¼Œç›´æ¥èª¿æ•´ request èˆ‡ limit&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆèª¿é™ requestï¼Œä¸å‹• limitï¼Œå°æœå‹™è¡æ“Šè¼ƒå°&lt;/li&gt;
&lt;li&gt;ç”¨æŠ“æ¯”ä¾‹çš„æ–¹å¼å‹•æ…‹èª¿æ•´ï¼Œä¾‹å¦‚ç›®å‰ request è·é›¢ p99 request å·®è· 1000Miï¼Œä½ å…ˆæ”¶ 500Mi å›ä¾†è©¦å€‹æ°´æº«&lt;/li&gt;
&lt;li&gt;p99 ç›´æ¥ä½¿ç”¨ tool è¨ˆç®—ï¼Œç´°ç¯€åœ¨å¾Œé¢&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦ç’°å¢ƒå…ˆè¡Œï¼Œæœ‰ä¿¡å¿ƒåœ¨ä¸Š production&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚æœä½ ç¬¬ä¸€æ¬¡åšï¼Œä½†å°æœå‹™å…ƒä»¶æ²’æœ‰ç†Ÿåˆ°é€™ç¨®ç¨‹åº¦ï¼Œé€™æ˜¯æ¯”è¼ƒå®‰å…¨çš„åšæ³•
å…¬å¸è¦æ¨¡å¤§æœå‹™å…ƒä»¶è¤‡é›œï¼Œèº«ç‚º SRE ä½ åªèƒ½ä»°è³´ metrics ä¾†åˆ¤æ–·æœå‹™å“è³ªæ˜¯å¦å—å½±éŸ¿ï¼Œä½†å¾ˆå¤šè¤‡é›œçš„æœå‹™ï¼Œä»¥åŠä¸ç†Ÿæ‚‰çš„æœå‹™ï¼Œæœƒå¾ˆé›£è©•ä¼°&lt;/p&gt;
&lt;p&gt;å…ˆèª¿é™ requestï¼Œæå‡å–®ä¸€ node ä¸Šçš„ pod æ•¸é‡ï¼Œç„¶å¾Œè§€å¯Ÿæœå‹™å“è³ªï¼Œå¦‚æœæœå‹™å“è³ªæ²’æœ‰å—åˆ°å½±éŸ¿ï¼Œé‚£éº¼ä½ å¯ä»¥é€²ä¸€æ­¥èª¿é™ limit
å¸‚å ´å–Šåƒ¹ï¼Œå…ˆå–Šå€‹ä¸€åŠï¼Œåœ¨çœ‹èƒ½ç¹¼çºŒå£“åˆ°ä»€éº¼ç¨‹åº¦&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ”¶é›†ç›®å‰è³‡æºä½¿ç”¨è³‡æ–™&lt;/li&gt;
&lt;li&gt;è½‰åŒ–æˆå…¬æœ‰é›²çš„æˆæœ¬&lt;/li&gt;
&lt;li&gt;é€é tool å»ºè­°é©ç•¶çš„è³‡æº&lt;/li&gt;
&lt;li&gt;æ ¹æ“šæœå‹™å“è³ªçš„è¦æ±‚ï¼Œèª¿é™ cpu / memory&lt;/li&gt;
&lt;li&gt;å›é ­æª¢æŸ¥ SLO æ˜¯å¦æœ‰å—åˆ°å½±éŸ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è‡ªå‹•æ‹“å±•hpa&#34;&gt;è‡ªå‹•æ‹“å±•ï¼šHPA&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s/horizontal-pod-autoscale&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ HPA åœ¨æˆæœ¬ç²¾ç°¡çš„æ„ç¾©ï¼šå› ç‚ºå¤–éƒ¨å› ç´ æ”¹è®Šè² è¼‰çš„å…ƒä»¶&lt;/li&gt;
&lt;li&gt;ä½è² è¼‰æ™‚ä¸è¦é–‹å¤ªå¤šï¼Œé«˜è² è¼‰æ™‚è‡ªå‹•åŠ é–‹ pod&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è‡ªå‹•æ‹“å±•hpa-çš„è€ƒé‡&#34;&gt;è‡ªå‹•æ‹“å±•ï¼šHPA çš„è€ƒé‡&lt;/h3&gt;
&lt;p&gt;å…ƒä»¶æ˜¯å¦èƒ½å¤ æ°´å¹³æ‹“å±•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•Ÿå‹•çš„ liveness check / readiness check&lt;/li&gt;
&lt;li&gt;laod balancer&lt;/li&gt;
&lt;li&gt;éœ€è¦æŒçºŒèª¿æ•´ scale up / down çš„æ¢ä»¶èˆ‡ time windows&lt;/li&gt;
&lt;li&gt;scale up å°ä¾è³´æœå‹™çš„ loading æœƒæœ‰å½±éŸ¿ ex. å¾Œé¢çš„ db&lt;/li&gt;
&lt;li&gt;é€€å ´æ©Ÿåˆ¶ï¼Œè¦å¦‚ä½•å®‰å…¨çš„ä¸­æ–·é€£ç·šï¼Œç´€éŒ„ state&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;è¦èƒ½å®‰å…¨åœ°é€²å‡ºå ´&lt;/p&gt;
&lt;p&gt;é€²å ´ï¼Œpod readiness / liveness
loading å¢åŠ æ™‚ scale up time windows
scale out å°å¾Œæ–¹æœå‹™çš„å½±éŸ¿ï¼Œæ˜¯å¦æœƒå‡ºç¾æ–°çš„ç“¶é ¸&lt;/p&gt;
&lt;p&gt;loading é™ä½æ™‚ scale down æ˜¯å¦æœƒå½±éŸ¿æœå‹™&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è‡ªå‹•æ‹“å±•vpa&#34;&gt;è‡ªå‹•æ‹“å±•ï¼šVPA&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/README.md#quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s/autoscaler/vertical-pod-autoscaler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸èƒ½æ°´å¹³æ‹“å±•ï¼Œåªå¥½å…ˆå‚ç›´æ‹“å±•&lt;/li&gt;
&lt;li&gt;èª¿æ•´è³‡æºï¼Œæœ‰å¯èƒ½æœƒé‡å•Ÿ pod / container&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/blog/2023/05/12/in-place-pod-resize-alpha/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes 1.27: In-place Resource Resize for Kubernetes Pods (alpha)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/122760&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;In-Place Pod Resource Resizing always restarts pod&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ çš„ workload ç„¶å¾Œä¸é©åˆåš HPAï¼Œä½†å¯ä»¥æ¥å— resize å¾Œé‡å•Ÿï¼Œé‚£å¯ä»¥è©¦è©¦VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  1.27 ä½ å¯ä»¥æŠŠ InPlacePodVerticalScaling feature gate é–‹èµ·ä¾†
ä»–ä¸ä¿è­‰ resize å¾Œä¸æœƒé‡å•Ÿ podï¼Œé‚„æ˜¯è¦çœ‹ä½ çš„ container runtime æ”¯æ´ç¨‹åº¦
è«‹å…ˆåœ¨æ¸¬è©¦ç’°å¢ƒä¸­ç©ä¸€ç©
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;saving-plan--ri&#34;&gt;Saving Plan / RI&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AWS Saving Plan / RI&lt;/li&gt;
&lt;li&gt;GCP Committed Use Discount&lt;/li&gt;
&lt;li&gt;Azure Saving Plan / Reservation&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;Saving Plan / RI æ˜¯ä¸€ç¨®é•·æœŸçš„åˆç´„ï¼Œä½ å¯ä»¥è·Ÿé›²ç«¯æœå‹™å•†ç°½ç´„ï¼Œä¿è­‰ä½ æœƒç”¨å¤šå°‘è³‡æºï¼Œç„¶å¾Œé›²ç«¯æœå‹™å•†æœƒçµ¦ä½ ä¸€å€‹æŠ˜æ‰£
ä¸ƒæŠ˜ä¸Šä¸‹ï¼Œå¾ˆé©åˆé•·æœŸä½¿ç”¨çš„å®¢æˆ¶&lt;/p&gt;
&lt;p&gt;æœ‰ monitoring + predictionï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¢ºå®šä½ æœƒç”¨å¤šå°‘è³‡æºï¼Œé€™æ™‚å€™å°±å¯ä»¥è€ƒæ…® saving plan / RI&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;spot-instance&#34;&gt;Spot Instance&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://azure.microsoft.com/en-us/products/virtual-machines/spot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;azure spot vm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/ec2/spot/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws spot intance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/spot-vms&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gcp spot vm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¸³é¢ä¸Šæœ€é«˜å¯çœ 90%&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;spot-instance-1&#34;&gt;Spot Instance&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¶…ä¾¿å®œï¼Œæ‰“ä¸€æŠ˜&lt;/li&gt;
&lt;li&gt;å¤šé¤˜çš„ç®—åŠ›&lt;/li&gt;
&lt;li&gt;interruptionï¼Œä¸ä¿è­‰ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/ec2/spot/instance-advisor/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://aws.amazon.com/ec2/spot/instance-advisor/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å› ç‚ºä¸€æŠ˜çœŸçš„å¾ˆé¦™ï¼Œä¸€æŠ˜æ˜¯æœ‰é»æ‹¼ï¼Œä½†æ‰“å€‹ 3 æŠ˜é‚„æ˜¯å¾ˆæœ‰æ©Ÿæœƒ
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;spot-instance-å¦‚ä½•é–‹å§‹&#34;&gt;Spot Instance: å¦‚ä½•é–‹å§‹&lt;/h3&gt;
&lt;p&gt;é‡å•Ÿä¸å½±éŸ¿æœå‹™å“è³ªçš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;stateless&lt;/li&gt;
&lt;li&gt;batch job&lt;/li&gt;
&lt;li&gt;å°‡ worklaod å¾ monolithic æ‹†åˆ†æˆå°çš„ batch job&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦ç’°å¢ƒ dev / stag&lt;/li&gt;
&lt;li&gt;CI/CD&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ä¹çœ‹ä¹‹ä¸‹å¹¾å€‹å°æ™‚~24hr å…§æœƒè¢«é‡å•Ÿï¼Œå¥½åƒæ˜¯çŠ§ç‰²äº†æœå‹™å“è³ªï¼Œä½†å¦‚æœä½ çš„æœå‹™æ˜¯å¯ä»¥å®¹å¿ interruption çš„ï¼Œä¾‹å¦‚ batch jobï¼Œé‚£éº¼ spot instance å°±æ˜¯ä¸€å€‹å¾ˆå¥½çš„é¸æ“‡&lt;/p&gt;
&lt;p&gt;å°‡ worklaod å¾ monolithic æ‹†åˆ†æˆå°çš„ batch jobï¼Œä¾‹å¦‚ä½ æ˜¯ api server è™•ç†ä¸€å€‹ request æœƒæœ‰å¾ˆå¤šæ­¥é©Ÿï¼Œä½ å¯ä»¥æŠŠé€™äº›æ­¥é©Ÿæ‹†åˆ†æˆå°çš„ batch jobï¼Œç„¶å¾Œç”¨ queue ä¸²æ¥ï¼Œé€™æ¨£ä½ çš„ api server å°±å¯ä»¥ç”¨ spot instance ä¾†è·‘ï¼Œç„¶å¾Œä½ çš„ batch job ç”¨ spot instance è·‘ï¼Œé€™æ¨£ä½ çš„æœå‹™å°±å¯ä»¥çœå¾ˆå¤šéŒ¢&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµ-1&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;krr å·¥å…·èª¿æ•´è³‡æº&lt;/li&gt;
&lt;li&gt;HPA åšæ°´å¹³æ“´å±•&lt;/li&gt;
&lt;li&gt;VPA è‡ªå‹•åŒ–èª¿æ•´è³‡æº&lt;/li&gt;
&lt;li&gt;saving plan / RI é•·æœŸåˆç´„æ‰“ä¸ƒæŠ˜&lt;/li&gt;
&lt;li&gt;spot instance æ‰“ä¸€æŠ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å±•æœ›&#34;&gt;å±•æœ›&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é‹è¡Œæˆæœ¬è½‰é”çµ¦é–‹ç™¼åœ˜éšŠ cost awareness development&lt;/li&gt;
&lt;li&gt;æ ¹æ“šå„åœ˜éšŠåˆ¶å®šç²¾ç°¡è¨ˆç•« find-grade optimization&lt;/li&gt;
&lt;li&gt;æˆæœ¬ç®¡ç†è‡ªå‹•åŒ– automation&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æœ‰äº†è³‡æºé æ¸¬ç³»çµ±ï¼Œå¯ä»¥åœ¨é–‹ç™¼éšæ®µå°±å°‡è³‡æºä½¿ç”¨å›é¥‹çµ¦é–‹ç™¼åœ˜éšŠ
æ ¹æ“šä¸åŒæœå‹™å…ƒä»¶çš„å“è³ªè¦æ±‚ï¼Œåšæ›´ç´°ç·»çš„è³‡æºç®¡æ§
è‡ªå‹•åŒ–èª¿æ•´ï¼Œè®“äººåŠ›å¯ä»¥å°ˆæ³¨åœ¨æ›´é‡è¦çš„äº‹æƒ…ä¸Š
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµ-2&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;cpu / memory&lt;/li&gt;
&lt;li&gt;ç›£æ¸¬æ˜¯åŸºç¤&lt;/li&gt;
&lt;li&gt;ä¾æ“šç›£æ¸¬åšé æ¸¬&lt;/li&gt;
&lt;li&gt;é–‹å§‹èª¿æ•´&lt;/li&gt;
&lt;li&gt;é•·æœŸåˆç´„æ‰“ä¸ƒæŠ˜&lt;/li&gt;
&lt;li&gt;spot instance æ‰“ä¸€æŠ˜&lt;/li&gt;
&lt;li&gt;HPA / VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ„Ÿè¬&#34;&gt;æ„Ÿè¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;presentation and speaker notes &lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.linkedin.com/company/maicoin/jobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin è·ç¼º&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¬å¸ç¦åˆ©ä¸éŒ¯ï¼Œæ¥­å‹™æˆé•·ä¸­ï¼Œæƒ³ä¸€èµ·å…±äº‹ï¼Œæ­¡è¿æ‰¾æˆ‘èŠ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
</description>
    </item>
    
    <item>
      <title>2024 04 27 Contribute to K8s</title>
      <link>https://chechia.net/zh-hant/post/2024-04-27-contribute-to-k8s/</link>
      <pubDate>Sat, 27 Apr 2024 18:18:43 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2024-04-27-contribute-to-k8s/</guid>
      <description>&lt;h1 id=&#34;get-started&#34;&gt;Get-Started&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Google &amp;ldquo;how to contribute to kubernetes&amp;rdquo;&lt;/li&gt;
&lt;li&gt;click the first link you like in every page&lt;/li&gt;
&lt;li&gt;do what the page says&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;get-started-1&#34;&gt;Get-Started&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.kubernetes.dev&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.kubernetes.dev&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.kubernetes.dev/docs/guide/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.kubernetes.dev/docs/guide/&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/contributor-playground/blob/master/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contributor Playground&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/playlist?list=PL69nYSiGNLP3M5X7stuD7N4r3uP2PZQUx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Youtube: New Contributor Series 2018-2019&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://communityinviter.com/apps/kubernetes/community&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Join the Kubernetes Slack&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/contribute/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contribute to kubernetes Documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;join-group&#34;&gt;Join Group&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.kubernetes.dev/community/community-groups/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.kubernetes.dev/community/community-groups/&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/sig-docs/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SIG-DOCS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;find-issue-on-github&#34;&gt;Find Issue on Github&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/website/issues/38681&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes/website/issues/38681&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/website/blob/36fa877ba3be67cb0a8c508757bdc8849cbdb5af/CONTRIBUTING.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contributing to Kubernetes Documentation&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://groups.google.com/g/kubernetes-sig-docs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Join sig-docs google groupd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;prerequisites&#34;&gt;Prerequisites&lt;/h1&gt;
&lt;p&gt;In my opinion, the following are the prerequisites to contribute to Kubernetes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;English proficiency&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;unorganized-links&#34;&gt;Unorganized Links&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/community-membership.md#member&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Community-membership&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;actively contributer&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://discuss.kubernetes.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Community Forums&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>SRE Conference: Cloud Infrastructure Saving Engineering  é›²ç«¯çœéŒ¢å·¥ç¨‹</title>
      <link>https://chechia.net/zh-hant/talk/sre-conference-cloud-infrastructure-saving-engineering-%E9%9B%B2%E7%AB%AF%E7%9C%81%E9%8C%A2%E5%B7%A5%E7%A8%8B/</link>
      <pubDate>Fri, 26 Apr 2024 13:20:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/sre-conference-cloud-infrastructure-saving-engineering-%E9%9B%B2%E7%AB%AF%E7%9C%81%E9%8C%A2%E5%B7%A5%E7%A8%8B/</guid>
      <description>&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;Title: SRE Conference: Cloud Infrastructure Saving Engineering é›²ç«¯çœéŒ¢å·¥ç¨‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ AWS èˆ‡ Kubernetes å°±æ˜¯è¦èŠ±éŒ¢ï¼Œå¦‚ä½•çœéŒ¢ï¼Ÿ
åˆç†çš„è¨­å®šè³‡æºï¼Œä¸åƒ…çœéŒ¢ï¼Œé‚„æå‡æ•´é«”æœå‹™ç©©å®šåº¦ï¼Ÿ
æ—¢æœ‰æœå‹™å·²ç¶“å­˜åœ¨ï¼Œå¦‚ä½•é€æ­¥æ”¹è®Šï¼Œé™ä½æˆæœ¬ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›ä»¥å¯¦å‹™çš„ç¯„ä¾‹ï¼Œåˆ†äº«å¹¾å€‹ç¯€çœé›²ç«¯é–‹éŠ·çš„æ–¹æ³•ï¼ŒåŒ…å«ï¼šå°å…¥ spot instanceï¼Œæˆæœ¬è¨ˆç®—èˆ‡é æ¸¬å·¥å…·ï¼Œå‹•æ…‹è³‡æºèª¿æ•´HPAèˆ‡VPAï¼Œsaving plan&amp;hellip;ï¼Œä¸¦åˆ†äº«å¦‚ä½•æ”¹è®Šæ–‡åŒ–ï¼Œæé«˜åœ˜éšŠçš„æˆæœ¬æ„è­˜ï¼Œå¯¦éš›çš„é™ä½é–‹éŠ·&lt;/p&gt;
&lt;h1 id=&#34;target-group&#34;&gt;Target group&lt;/h1&gt;
&lt;p&gt;AWS &amp;amp; Kubernetes User who want to decrease overall cost of infrastructure&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å…¥å·¥å…·ï¼šæœ‰å“ªäº›å·¥å…·å¯ä»¥ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;åˆ†æç¾æ³ï¼šç²¾ç®—å„åœ˜éšŠèˆ‡å„å°ˆæ¡ˆæˆæœ¬&lt;/li&gt;
&lt;li&gt;æ”¹è®Šç¾æ³ï¼šå¾æ—¢æœ‰çš„æ¶æ§‹ä¸­ï¼Œæ‰¾å°‹å¯ä»¥ç¯€çœæˆæœ¬çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;æ”¹å–„æµç¨‹ï¼šæœ‰æ•ˆç‡çš„ç¶­æŒçœéŒ¢ workflow&lt;/li&gt;
&lt;li&gt;æ”¹è®Šæ–‡åŒ–ï¼šæŒçºŒæ€§ä½ç¶­æŒæ–°æœå‹™èˆ‡èˆŠæœå‹™çš„åˆç†æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2023 DevOpsDay&lt;/li&gt;
&lt;li&gt;2023 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>SRE Conference: Cloud Infrastructure Saving Engineering  é›²ç«¯çœéŒ¢å·¥ç¨‹</title>
      <link>https://chechia.net/zh-hant/slides/2024-04-26-saving-money-on-cloud-k8s/</link>
      <pubDate>Tue, 26 Mar 2024 00:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2024-04-26-saving-money-on-cloud-k8s/</guid>
      <description>
&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;onepiece.jpg&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  æŠ•å½±ç‰‡è·Ÿè¬›ç¨¿æˆ‘éƒ½æ”¾åœ¨æˆ‘çš„ç¶²ç«™ä¸Šï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒ
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cost-management-of-cloud-kubernetes&#34;&gt;Cost Management of Cloud Kubernetes&lt;/h3&gt;
&lt;h3 id=&#34;é›²ç«¯k8sçœéŒ¢å·¥ç¨‹&#34;&gt;é›²ç«¯K8sçœéŒ¢å·¥ç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Che Chia Chang&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å…©å€‹é—œéµå­—ï¼šé›²ç«¯ / k8s
å¦‚æœä½ æœ‰åœ¨ä½¿ç”¨å…¬æœ‰é›²ï¼Œè€Œä¸”æœ‰åœ¨è·‘ k8sï¼Œä½ æ˜¯é€™ç¯‡æ¼”è¬›çš„æœ€ä¸»è¦å°è±¡
å¦‚æœä½ æ˜¯ç§æœ‰é›² k8sï¼Œæˆ–æ˜¯å…¶ä»–çš„é›²ç«¯æœå‹™ï¼Œæœ‰ä¸€äº›ç›¸é€šçš„æ¦‚å¿µï¼Œæœƒæœ‰ä¸€äº›åƒè€ƒåƒ¹å€¼
å¦‚æœä½ æ˜¯åœ°ç«¯çš„æ©Ÿå™¨ï¼Œé›–ç„¶æ¦‚å¿µç›¸åŒï¼Œä½†æˆæœ¬æ§åˆ¶çš„åšæ³•å®Œå…¨æ˜¯å¦å¤–ä¸€å€‹æ•…äº‹ï¼Œä½ å¯ä»¥ç•¶åˆä¼‘æ™‚é–“çš„æ•…äº‹è½è½çœ‹
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;about-me&#34;&gt;About Me&lt;/h3&gt;
&lt;h3 id=&#34;che-chia-chang&#34;&gt;Che Chia Chang&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;SRE @ &lt;a href=&#34;https://www.linkedin.com/company/maicoin/jobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mvp.microsoft.com/zh-TW/MVP/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å€‹äººéƒ¨è½æ ¼&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;presentation and speaker notes&lt;/li&gt;
&lt;li&gt;éµäººè³½ (Terraform / Vault æ‰‹æŠŠæ‰‹å…¥é–€)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;outline&#34;&gt;Outline&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Cost on Public Cloud&lt;/li&gt;
&lt;li&gt;K8s Compute Resource Management&lt;/li&gt;
&lt;li&gt;Monitoring&lt;/li&gt;
&lt;li&gt;Cost Analysis and Prediction&lt;/li&gt;
&lt;li&gt;Resource Recommendation&lt;/li&gt;
&lt;li&gt;Saving Plan&lt;/li&gt;
&lt;li&gt;Spot Instance&lt;/li&gt;
&lt;li&gt;HPA / VPA&lt;/li&gt;
&lt;li&gt;Q&amp;amp;A&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é€™æ˜¯æˆ‘å€‘ä»Šå¤©çš„å¤§ç¶±&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘æœƒå…ˆè¬›ä¸€ä¸‹åœ¨å…¬æœ‰é›²ä¸Šçš„æˆæœ¬
ç„¶å¾Œè¬›ä¸€ä¸‹ k8s çš„é‹ç®—è³‡æºç®¡ç†
æ¥è‘—è¬›ä¸€ä¸‹ç›£æ§ï¼Œç‚ºä½•æˆæœ¬æ§ç®¡çš„åŸºç¤æ˜¯ç›£æ§
å¦‚ä½•ä½¿ç”¨å·¥å…·æˆæœ¬åˆ†æï¼Œæœªä¾†æˆæœ¬é æ¸¬
ç„¶å¾Œä½¿ç”¨å·¥å…·å»ºè­°åˆé©çš„è³‡æº
æœ€å¾Œè¬›å¯¦å‹™ä¸Šè¦å¦‚ä½•é™ä½æˆæœ¬ï¼Œä¾‹å¦‚ saving plan / spot instance / HPA / VPAï¼Œä¾ç…§åŸ·è¡Œçš„é›£åº¦æ’åºï¼Œæœ‰æ™‚é–“çš„è©±ä¹Ÿæœƒè¬›å¦‚ä½•å¾ç„¡åˆ°æœ‰é–‹å§‹é€²è¡Œ&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cost-on-public-cloud&#34;&gt;Cost on Public Cloud&lt;/h3&gt;
&lt;p&gt;open your cloud billing&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Compute Resource (cpu, memory)&lt;/li&gt;
&lt;li&gt;Storage (Disk, EBS, S3&amp;hellip;)&lt;/li&gt;
&lt;li&gt;Database (Compute Resource + Storage)&lt;/li&gt;
&lt;li&gt;Networking&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æœ‰åœ¨ä½¿ç”¨å…¬æœ‰é›²çš„äººï¼ŒæŠŠå…¬æœ‰é›²çš„ billing å¸³å–®æ‰“é–‹ä¾†çœ‹ï¼Œå¯èƒ½çœ‹åˆ°çš„å¤§æ¦‚æ˜¯é€™å¹¾å€‹é …ç›®
ç•¶ç„¶å› ç‚ºä¸åŒåœ˜éšŠçš„æœå‹™ä¸åŒï¼Œå¯èƒ½æœƒæœ‰ä¸€äº›å‡ºå…¥ï¼Œä½†å¦‚æœä½ çš„å…¬å¸çš„ç”¢å“æ˜¯ web serviceï¼Œæ‡‰è©²æœƒæœ‰é€™å¹¾å€‹é …ç›®
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;todays-topic&#34;&gt;Today&amp;rsquo;s topic&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Today&amp;rsquo;s topic&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Compute Resource&lt;/li&gt;
&lt;li&gt;cpu &amp;amp; memory&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Maybe next time&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Storage (Disk, EBS, S3&amp;hellip;)&lt;/li&gt;
&lt;li&gt;Database (Compute Resource + Storage)&lt;/li&gt;
&lt;li&gt;Networking&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;Storage ä¸å¤ªå¥½èªªçœå°±çœï¼Œå› ç‚ºä½ çš„è³‡æ–™é‡å°±åœ¨é‚£é‚Šï¼Œæ”¾ä¸ä¸‹å°±æ˜¯è¦å†è²·ï¼Œæ‰€ä»¥ storage çš„æˆæœ¬æ§åˆ¶ï¼Œå¯èƒ½æ˜¯åœ¨è³‡æ–™çš„ä½¿ç”¨ä¸Šï¼Œä¾‹å¦‚è³‡æ–™çš„å£“ç¸®ï¼Œæˆ–æ˜¯è³‡æ–™çš„å‚™ä»½ï¼Œæˆ–æ˜¯è³‡æ–™çš„å­˜å–æ–¹å¼ï¼Œé€™äº›æ˜¯å¦å¤–ä¸€å€‹æ•…äº‹
ä½¿ç”¨å…¬æœ‰é›²çš„æœå‹™ï¼ŒåŸºæœ¬ä¸Š storage éƒ½æ˜¯ä¾æ“šä½¿ç”¨çš„å¤§å°è¨ˆåƒ¹ï¼Œè€Œä¸”éœ€å¤šæœå‹™éƒ½å¯ä»¥å‹•æ…‹å¢é•·ï¼Œä¾‹å¦‚å‹•æ…‹å¢åŠ  disk&lt;/p&gt;
&lt;p&gt;Storage / Database / Networking é€™å¹¾å€‹é …ç›®ï¼Œæˆ‘å€‘ä¸‹é›†å†ä¾†è«‡&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cost-on-public-cloud-1&#34;&gt;Cost on Public Cloud&lt;/h3&gt;
&lt;p&gt;CPU / memory intense web service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RESTful api&lt;/li&gt;
&lt;li&gt;long-connetion service&lt;/li&gt;
&lt;li&gt;business logic&lt;/li&gt;
&lt;li&gt;save state to disk / database&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚æœä½ è·Ÿæ•ç¤¾ä¸€æ¨£æ˜¯ web serviceï¼Œé‚£éº¼ cpu / memory å¯èƒ½æ˜¯ä½ æœ€å¤§çš„ä¸€ç­†æˆæœ¬&lt;/p&gt;
&lt;p&gt;ä½ éœ€è¦è¶³å¤ é‹ç®—èƒ½åŠ› serve å®¢æˆ¶ï¼Œä¸ç®¡æ˜¯æ”¯æŒç”¨æˆ¶çš„requestï¼Œé€²è¡Œå•†æ¥­é‚è¼¯çš„é‹ç®—ï¼Œç„¶å¾ŒæŠŠé‹ç®—å®Œæˆçš„ç‹€æ…‹å›å‚³çµ¦å®¢æˆ¶ï¼Œæˆ–æ˜¯å­˜åœ¨è³‡æ–™åº«ä¸­ï¼Œæ¯ä¸€å€‹å‹•ä½œéƒ½éœ€è¦ç®—åŠ›&lt;/p&gt;
&lt;p&gt;è¶³å¤ çš„ cpu è·Ÿ memoryï¼Œä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè€Œæ˜¯è¶³å¤ ï¼Œä¸æœƒæµªè²»ï¼Œä¹Ÿä¸æœƒå› ç‚ºä¸è¶³è€Œå½±éŸ¿æœå‹™å“è³ª
æˆ‘å€‘è¦çœéŒ¢ï¼Œå°±è¦å¾é€™è£¡ä¸‹æ‰‹&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°‹æ‰¾å¤šé¤˜çš„ç®—åŠ›&#34;&gt;å°‹æ‰¾å¤šé¤˜çš„ç®—åŠ›&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å·²æœ‰è¶³å¤ çš„ cpu / memoryï¼Œå¤šçµ¦ä¹Ÿä¸æœƒå¢åŠ æœå‹™å“è³ªçš„å¤šé¤˜ç®—åŠ›&lt;/li&gt;
&lt;li&gt;å¤šå°‘æ‰æ˜¯å¤ ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ¸›å»å¤šå°‘ cpu / memoryï¼Œä¾ç„¶ä¸æ”¹è®Šæœå‹™å“è³ª&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¤šå°‘æ‰æ˜¯å¤ ï¼Ÿé€™æ˜¯ä¸€å€‹è¤‡é›œçš„å•é¡Œï¼Œå¯¦å‹™ä¸Šé€šå¸¸ä½¿ç”¨ SLA / SLO ä¾†è¡¡é‡æœå‹™å“è³ªï¼Œç„¶å¾Œæ ¹æ“šæœå‹™å“è³ªçš„è¦æ±‚ï¼Œä¾†è¨­å®š cpu / memory çš„é…é¡&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©è¦åšçš„æ˜¯æˆæœ¬å„ªåŒ–ï¼Œç™½è©±çš„èªªæ˜¯é™ä½ cpu / memory çš„è¨­å®šé…é¡ï¼Œä½†æ˜¯æˆ‘å€‘ä¸èƒ½é™ä½åˆ°å½±éŸ¿æœå‹™å“è³ª
ç”šè‡³é€€ä¸€ç™¾æ­¥ï¼Œé˜²å®ˆæ€§çš„ä¾†èªªï¼Œæˆ‘å€‘ä¸å¸Œæœ›å› ç‚ºé™ä½ cpu / memory çš„è¨­å®šé…é¡ï¼Œç‚ºäº†çœéŒ¢è€Œå°è‡´è² é¢çš„çµæœï¼Œç”šè‡³ç‚ºæœå‹™çš„ç©©å®šåº¦èƒŒé‹ã€‚&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç¶­æŒslo&#34;&gt;ç¶­æŒSLO&lt;/h3&gt;
&lt;p&gt;ä»¥ç¶­æŒå„å€‹æœå‹™å…ƒä»¶çš„ SLOç‚ºå‰æï¼Œé™ä½ cpu / memory ä½¿ç”¨é‡&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ç¶­æŒå€‹å€‹æœå‹™å…ƒä»¶çš„ SLO
æ˜¯ä¸€å€‹å¾ˆå¥½çš„æŒ‡æ¨™ï¼Œå¦‚æœä½ çš„æœå‹™æ˜¯ 99.9% çš„ SLAï¼Œé‚£éº¼ä½ çš„æœå‹™å°±è¦ä¿è­‰ 99.9% çš„æ™‚é–“éƒ½æ˜¯æ­£å¸¸é‹ä½œçš„ï¼Œé‚£éº¼ä½ çš„ cpu / memory å°±è¦è¶³å¤ æ”¯æŒé€™å€‹ SLA&lt;/p&gt;
&lt;p&gt;è«‡ SLO ä¹‹å‰ï¼Œä½ è¦å…ˆçŸ¥é“ä½ çš„æœå‹™çš„ SLA æ˜¯å¤šå°‘ï¼Œä½ è¦å…ˆçŸ¥é“ç•¶å‰çš„ç‹€æ…‹æ˜¯å¤šå°‘
é€™å€‹åœ¨ç¨å¾Œçš„ monitoring æœƒæåˆ°ï¼Œç‚ºä»€éº¼ç›£æ§æ˜¯æˆæœ¬ç®¡ç†çš„åŸºç¤&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;åŸºæ–¼-slo-çš„æˆæœ¬èª¿é™&#34;&gt;åŸºæ–¼ SLO çš„æˆæœ¬èª¿é™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è² è¼‰ç©©å®šçš„å…ƒä»¶ï¼Œå¯ä»¥æŠ“éå» 30d çš„ p99 cpu time æˆ– p99 memory usage + buffer&lt;/li&gt;
&lt;li&gt;è² è¼‰ä¸ç©©å®šçš„å…ƒä»¶ï¼Œä¾‹å¦‚ cpu usage èˆ‡å—æ´»èºç”¨æˆ¶æ•¸é‡æ­£æ¯”ï¼Œéœ€è¦æ­é… HPA æ°´å¹³æ‹“å±•&lt;/li&gt;
&lt;li&gt;è² è¼‰ä¸ç©©å®šçš„å…ƒä»¶ï¼Œä½†åˆä¸èƒ½æ°´å¹³æ‹“å±•ï¼Œä¾‹å¦‚ stateful serviceï¼Œå¯ä»¥è€ƒæ…® VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  è² è¼‰ç©©å®šçš„å…ƒä»¶ï¼Œå›ºå®šåƒå¤šå°‘ cpu / memoryï¼Œä»–çš„é™„è¼‰ä¸å¤ªå®¹æ˜“éš¨å¤–éƒ¨å› ç´ æ³¢å‹•çš„æœå‹™ï¼Œå¯ä»¥æŠ“éå» 30d çš„ p99 cpu time æˆ– p99 memory usage + bufferï¼Œç„¶å¾Œé™ä½ cpu / memory çš„è¨­å®šé…é¡
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµæˆæœ¬æ§ç®¡çš„åŸºæœ¬æ¦‚å¿µ&#34;&gt;å°çµï¼šæˆæœ¬æ§ç®¡çš„åŸºæœ¬æ¦‚å¿µ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å°‹æ‰¾æœå‹™ä¸­å¤šé¤˜ç®—åŠ›&lt;/li&gt;
&lt;li&gt;ä»¥ç¶­æŒ SLO ç‚ºå‰æ&lt;/li&gt;
&lt;li&gt;é™ä½ cpu / memory ä½¿ç”¨é‡&lt;/li&gt;
&lt;li&gt;ä¾æ“šå…ƒä»¶è² è¼‰ç‰¹æ€§ï¼Œé¸æ“‡é©ç•¶çš„èª¿é™æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;background-knowledge&#34;&gt;Background Knowledge&lt;/h3&gt;
&lt;h3 id=&#34;k8s-cpu--memory-managementhttpskubernetesiodocsconceptsconfigurationmanage-resources-containers&#34;&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s cpu / memory management&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;k8s å¦‚ä½•ç®¡ç† workload çš„ cpu èˆ‡ memory&lt;/li&gt;
&lt;li&gt;èª¿é™å¤šå°‘æœƒå½±éŸ¿æœå‹™å“è³ª&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é€™è£¡é¢å†è¬›ä¸€ä¸‹ k8s å¦‚ä½•ç®¡ç† cpu / memory&lt;/p&gt;
&lt;p&gt;é€™é‚Šçš„é‡é»æ˜¯ï¼Œæ€éº¼æ¨£çš„èª¿æ•´æœƒå½±éŸ¿åˆ°æœå‹™å“è³ªï¼Œé‚£æˆ‘å€‘åšæˆæœ¬æ§åˆ¶çš„æ™‚å€™ï¼Œå°±ä¸è¦å»è¸©åˆ°é€™å€‹åº•ç·š&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;how-k8s-manage-cpu--memoryhttpskubernetesiodocsconceptsconfigurationmanage-resources-containershow-pods-with-resource-limits-are-run&#34;&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#how-pods-with-resource-limits-are-run&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How k8s manage cpu / memory&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;scheduler ä¾æ“š cpu / memory request èª¿åº¦ pod&lt;/li&gt;
&lt;li&gt;container runtime è¨­å®š cgroup
&lt;ul&gt;
&lt;li&gt;cpu ä½¿ç”¨é‡ä¾æ“š request ä½” node æ¯”ä¾‹åˆ†é…&lt;/li&gt;
&lt;li&gt;æ§åˆ¶ cpu ç”¨é‡ä¸è¶…é limit&lt;/li&gt;
&lt;li&gt;memory ä½¿ç”¨ limitï¼Œè¶…é limit æœƒè¢« oomkillï¼Œä¸¦ä¾æ“šè¨­å®šé‡å•Ÿ&lt;/li&gt;
&lt;li&gt;ç•¶å‰ node memory ä¸è¶³æ™‚ï¼Œæœƒä¾æ“š pod request Evict pod&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æ–‡ä»¶è¬›å¾—å¾ˆæ¸…æ¥š
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ä¸Šé¢éƒ½æ˜¯æ¦‚å¿µåº•ä¸‹é€²å¯¦ä½œ&#34;&gt;ä¸Šé¢éƒ½æ˜¯æ¦‚å¿µï¼Œåº•ä¸‹é€²å¯¦ä½œ&lt;/h3&gt;
&lt;hr&gt;
&lt;h3 id=&#34;monitoring&#34;&gt;Monitoring&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Monitoring æ˜¯ cost management çš„åŸºç¤&lt;/li&gt;
&lt;li&gt;æ²’æœ‰ monitoring å°±æ²’æœ‰ p99 cpu time / p99 memory usageï¼Œä¹Ÿæ²’æœ‰ SLI/SLO&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²’æœ‰ monitoring å…ˆè£œ monitoring&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å¦‚æœæ²’æœ‰ monitoringï¼Œä¸Šé¢çš„å…©å¤§å‰æéƒ½ä¸å­˜åœ¨
ç›®å‰çš„ cpu / memory usageï¼Œruntime utilization çš„è³‡æ–™
ç›®å‰SLOï¼Œèª¿é™ä¹‹å¾Œæ–°çš„SLO
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;grafana-dashboard.png&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;monitoring-èª¿æ•´å‰&#34;&gt;Monitoring: èª¿æ•´å‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;éå»çš„ p99 è³‡æºç”¨é‡&lt;/li&gt;
&lt;li&gt;ç›®å‰çš„æ•ˆèƒ½è¡¨ç¾&lt;/li&gt;
&lt;li&gt;å¤šé¤˜çš„ç®—åŠ› = (åˆ†é…çš„ resource - p99)&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;åšä¹‹å‰è¦èƒ½è©•ä¼°åšå®Œå¤§æ¦‚èƒ½çœå¤šå°‘
ä¾‹å¦‚è©•ä¼°å®Œå¾Œ&lt;/p&gt;
&lt;p&gt;å¦‚æœè©•ä¼°å®Œç™¼ç¾çœä¸äº†ä»€éº¼éŒ¢ï¼Œé‚£ç•¶ç„¶åœ˜éšŠå°±ä¸ä¸€å®šè¦åšé€™ä»¶äº‹&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;monitoring-èª¿æ•´å¾Œ&#34;&gt;Monitoring: èª¿æ•´å¾Œ&lt;/h3&gt;
&lt;p&gt;èª¿æ•´å‰å¾Œæ¯”è¼ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è³‡æºç”¨é‡&lt;/li&gt;
&lt;li&gt;ç›®å‰çš„æ•ˆèƒ½è¡¨ç¾&lt;/li&gt;
&lt;li&gt;ç¢ºå®šæ²’æœ‰æ”¹å£æ±è¥¿&lt;/li&gt;
&lt;li&gt;æœ‰æ”¹å£ï¼Œè¦æœ‰åŠæ™‚çš„ alert&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å¦‚æœä½ æ”¹å£äº†ï¼ŒåŠæ™‚çš„ alert æœƒæ•‘ä½ ä¸€å‘½
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;monitoring-tools&#34;&gt;Monitoring Tools&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;prometheus.png&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¤§å®¶éƒ½çŸ¥é“ prometheus æ˜¯ä»€éº¼å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;çŸ¥é“çš„äººè«‹èˆ‰å€‹æ‰‹
ä¸çŸ¥é“çš„æˆ‘å¾ˆç°¡å–®èªªä¸€ä¸‹&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘æƒ³è¦çŸ¥é“ä¸€å€‹ pod æœƒéœ€è¦èŠ±å¤šå°‘ cpu / memoryï¼Œä½ å°±æŠŠå®ƒè·‘èµ·ä¾†ï¼Œç„¶å¾Œå»ç´€éŒ„è·‘èµ·ä¾†çš„ pod ç”¨äº†å¤šå°‘ cpu / memoryï¼Œç„¶å¾Œæ ¹æ“šæ™‚é–“çµ±è¨ˆï¼Œä½ å°±å¯ä»¥æ‹‰å‡ºä¸€å¼µåœ–ï¼Œçœ‹åˆ°é€™å€‹ pod ç”¨äº†å¤šå°‘ cpu / memory
ä½ çš„ kubelet / cadvisor / container runtime æœƒçŸ¥é“ä½ çš„ container çš„ cpu / memory ä½¿ç”¨é‡ï¼ŒåŒ…å« request &amp;amp; limit ç„¶å¾Œæ˜¯å¦æœ‰ throttling æˆ–æ˜¯ oomkillï¼Œé€™äº›è³‡è¨Šéƒ½æœƒè¢« prometheus æ”¶é›†èµ·ä¾†ï¼Œç„¶å¾Œä½ å¯ä»¥é€éå…¶ä»–å·¥å…·ï¼Œä¾‹å¦‚ kubecost çœ‹åˆ°é€™äº›è³‡è¨Š&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;grafana-cpu-usage.png&#34;
  &gt;

&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/dashboards/17375-k8s-resource-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/grafana/dashboards/17375-k8s-resource-monitoring/&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  é€™æ˜¯ prometheus æ”¶é›†çš„è³‡æ–™ï¼Œvm çš„ resource ä½¿ç”¨é‡çš„ grafana dashboard
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cost-analysis-and-prediction&#34;&gt;Cost Analysis and Prediction&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰äº† prometheus å¾Œï¼Œæˆ‘å€‘çŸ¥é“çŸ­æœŸ/é•·æœŸçš„è³‡æºä½¿ç”¨ç‹€æ³&lt;/li&gt;
&lt;li&gt;è¦æŠŠè³‡æºä½¿ç”¨è½‰æˆæˆæœ¬ï¼Œéœ€è¦ä¸€å€‹æˆæœ¬è¨ˆç®—å·¥å…·&lt;/li&gt;
&lt;li&gt;è©•ä¼°æ˜¯å¦è¦åšæˆæœ¬ç²¾ç°¡ï¼Œèƒ½å¤ æ¸›å°‘å¤šå°‘éŒ¢&lt;/li&gt;
&lt;li&gt;ç®¡ç†ä¸Šçš„è€ƒé‡ï¼šæŠ•è³‡äººåŠ›æˆæœ¬ï¼Œèˆ‡é æœŸå›å ±&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;æ”¿æ²»ä¸Šçš„è€ƒé‡ï¼Œåšæˆæœ¬ç¯€çœéœ€è¦æ™‚é–“è·ŸäººåŠ›è³‡æº
æœ‰ä¸€å€‹ç²¾æº–çš„æˆæœ¬åˆ†æï¼Œç¯€çœç©ºé–“ä¼°ç®—çš„å·¥å…·ååˆ†æœ‰èªªæœåŠ›&lt;/p&gt;
&lt;p&gt;æœ‰é€™äº›è³‡æ–™ï¼Œæ‰å¯ä»¥ç§‘å­¸åŒ–æ±ºç­–è¦ä¸è¦åšï¼Œè©²æ€éº¼åš
åšä¹‹å‰å°±èƒ½è©•ä¼°åšå®Œå¤§æ¦‚èƒ½çœå¤šå°‘&lt;/p&gt;
&lt;p&gt;å¦‚æœè©•ä¼°å®Œç™¼ç¾çœä¸äº†ä»€éº¼éŒ¢ï¼Œé‚£ç•¶ç„¶åœ˜éšŠå°±ä¸ä¸€å®šè¦åšé€™ä»¶äº‹&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cost-analysis--billing&#34;&gt;Cost Analysis:  billing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å„å®¶å…¬æœ‰å…ƒéƒ½æœ‰è‡ªå·±çš„è²»ç”¨è¨ˆç®—å·¥å…·&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://azure.microsoft.com/en-us/products/cost-management&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure Cost Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/aws-cost-management/aws-cost-explorer/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS Cost Explorer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/billing/docs/how-to/cost-breakdown&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Cost Breakdown&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;azure-cost-management.jpeg&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;cost-analysis-cloud-billing&#34;&gt;Cost Analysis: Cloud billing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨ˆç®—é•·æ™‚é–“çš„è²»ç”¨è¶¨å‹¢&lt;/li&gt;
&lt;li&gt;é©åˆç•¶ä½œæˆæœ¬ç²¾ç°¡å¾Œçš„æˆæœå›å ±&lt;/li&gt;
&lt;li&gt;ä¸é©åˆç•¶åšèª¿æ•´çš„ä¾æ“š&lt;/li&gt;
&lt;li&gt;æ™‚é–“è¨ˆç®—è¼ƒé•·ï¼Œåé¥‹æ™‚é–“é•·ï¼Œä¸åŠæ™‚ï¼Œé …ç›®ä¸å¤ ç²¾ç´°&lt;/li&gt;
&lt;li&gt;æœ‰ç„¡æ›´å³æ™‚çš„æˆæœ¬åˆ†æå·¥å…·ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cost-analysis-kubecost--opencosthttpsdocskubecostcomusing-kubecost&#34;&gt;Cost Analysis: &lt;a href=&#34;https://docs.kubecost.com/using-kubecost/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰æä¾› UI&lt;/li&gt;
&lt;li&gt;åŸºæ–¼ prometheus&lt;/li&gt;
&lt;li&gt;å¯ä»¥é‡å° allocation åšæˆæœ¬åˆ†æ &lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cost Allocation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€é cloud provider å»æ’ˆé›²ç«¯çš„ä½¿ç”¨è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubecost.jpeg&#34;
  &gt;

&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubecost-allocation.jpeg&#34;
  &gt;

&lt;p&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubecost-efficiency.png&#34;
  &gt;

&lt;p&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation/efficiency-idle&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/cost-allocation/efficiency-idle&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools&#34;&gt;Recommedation Tools&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/robusta-dev/krr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/robusta-dev/krr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/savings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost Savings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA recommendator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools-kubecost--opencost-savingshttpsdocskubecostcomusing-kubecostnavigating-the-kubecost-uisavings&#34;&gt;Recommedation Tools: &lt;a href=&#34;https://docs.kubecost.com/using-kubecost/navigating-the-kubecost-ui/savings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubecost / Opencost Savings&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®š target utilization
&lt;ul&gt;
&lt;li&gt;dev 80%+&lt;/li&gt;
&lt;li&gt;prod 60%&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æ ¹æ“šæœå‹™å“è³ªçš„è¦æ±‚ï¼Œä»¥åŠå…¬å¸æ”¿ç­–å»åšè¨­å®š
SLA/SLO
é–‹ç™¼èˆ‡æ¸¬è©¦ç’°å¢ƒï¼Œåœ¨ä¸å½±éŸ¿å·¥ä½œçš„å‰æï¼Œéƒ½å¯ä»¥æ‹‰åˆ° overcommit
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools-krr&#34;&gt;Recommedation Tools: KRR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/robusta-dev/krr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/robusta-dev/krr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å…å®‰è£ï¼Œä¸å½±éŸ¿ k8s æœ¬èº«&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¤–éƒ¨å·¥å…·è®€å– prometheus è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools-krr-1&#34;&gt;Recommedation Tools: KRR&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward svc/prometheus 9090
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/robusta-dev/krr.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;source .venv/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python krr.py simple \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p http://127.0.0.1:9090 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --mem-min 10 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --cpu-min 10 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --history_duration 720 -q
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;krr.jpeg&#34;
  &gt;

&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools-krr-2&#34;&gt;Recommedation Tools: KRR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ“š krr è¨ˆç®—çš„çµæœï¼Œæ‰‹å‹•èª¿æ•´&lt;/li&gt;
&lt;li&gt;æœ‰ä¸€äº›å·¥å…·æœ‰æä¾›è‡ªå‹•èª¿æ•´ ex VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;è‡ªå‹•å·¥å…·æ¯”æ‰‹å‹•éœ€è¦è€ƒé‡æ›´å¤šå› ç´ ï¼Œé€™å€‹æˆ‘å€‘ç¨å€™ VPA å†æ&lt;/p&gt;
&lt;p&gt;è«‹è©³é–±å·¥å…·èªªæ˜å†æœç”¨&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools-vpa-recommendatorhttpsgithubcomkubernetesautoscalerblobmastervertical-pod-autoscalerpkgrecommenderreadmemd&#34;&gt;Recommedation Tools: &lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA recommendator&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦å…ˆçŸ¥é“ VPA æ˜¯ä»€éº¼&lt;/li&gt;
&lt;li&gt;ç›´æ¥å®‰è£åœ¨ k8s cluster å…§&lt;/li&gt;
&lt;li&gt;é€é Prometheus è³‡æ–™ï¼Œæ¨è–¦é©ç•¶çš„è³‡æº&lt;/li&gt;
&lt;li&gt;å¯ä»¥è‡ªå‹•åŒ–æ¨è–¦è³‡æºï¼Œèª¿æ•´é‹è¡Œä¸­çš„ podï¼Œä¾ç…§è¨­å®šé‡å•Ÿ pod &lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/README.md#quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éœ€è¦å¯ä»¥åƒè€ƒ &lt;a href=&#34;https://github.com/cowboysysop/charts/tree/master/charts/vertical-pod-autoscaler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm chart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  krr æ˜¯å¯ä»¥ç„¡è…¦ç”¨çš„å·¥å…·ï¼Œä½†æ˜¯ VPA å°±ä¸æ˜¯äº†
è«‹è¨­å®š VPA mode Off
è«‹å‹™å¿…éœ€è¦ç ”ç©¶ä¸€ä¸‹åœ¨ä½¿ç”¨
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;recommedation-tools-æ¯”è¼ƒ&#34;&gt;Recommedation Tools: æ¯”è¼ƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;kubecost éœ€è¦ helm installï¼Œkrr ä¸éœ€è¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kubecost ç”¢ç”Ÿä¸€å€‹æ¼‚äº®çš„ UIï¼Œkrr ç”¢ç”Ÿ command line å ±è¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VPA éœ€è¦ helm installï¼Œä¸¦ä¸”æœƒéœ€è¦ cluster æ¬Šé™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VPA å¯ä»¥åšåˆ°è‡ªå‹•åŒ–èª¿æ•´ï¼Œé‚è¼¯æ›´è¤‡é›œï¼Œæœ‰ä¾µå…¥æ€§ï¼Œè¨­å®šæœ‰å•é¡Œæœƒå‡ºäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å‰›ä¸Šæ‰‹çš„åšæ³•&#34;&gt;å‰›ä¸Šæ‰‹çš„åšæ³•&lt;/h3&gt;
&lt;p&gt;æ²’æ™‚é–“ç´°éƒ¨ç ”ç©¶ç ”ç©¶å…ƒä»¶çš„è¡Œç‚ºï¼Œç›´æ¥èª¿æ•´ request èˆ‡ limit&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆèª¿é™ requestï¼Œä¸å‹• limitï¼Œå°æœå‹™è¡æ“Šè¼ƒå°&lt;/li&gt;
&lt;li&gt;ç”¨æŠ“æ¯”ä¾‹çš„æ–¹å¼å‹•æ…‹èª¿æ•´ï¼Œä¾‹å¦‚ç›®å‰ request è·é›¢ p99 request å·®è· 1000Miï¼Œä½ å…ˆæ”¶ 500Mi å›ä¾†è©¦å€‹æ°´æº«&lt;/li&gt;
&lt;li&gt;p99 ç›´æ¥ä½¿ç”¨ tool è¨ˆç®—ï¼Œç´°ç¯€åœ¨å¾Œé¢&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦ç’°å¢ƒå…ˆè¡Œï¼Œæœ‰ä¿¡å¿ƒåœ¨ä¸Š production&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚æœä½ ç¬¬ä¸€æ¬¡åšï¼Œä½†å°æœå‹™å…ƒä»¶æ²’æœ‰ç†Ÿåˆ°é€™ç¨®ç¨‹åº¦ï¼Œé€™æ˜¯æ¯”è¼ƒå®‰å…¨çš„åšæ³•
å…¬å¸è¦æ¨¡å¤§æœå‹™å…ƒä»¶è¤‡é›œï¼Œèº«ç‚º SRE ä½ åªèƒ½ä»°è³´ metrics ä¾†åˆ¤æ–·æœå‹™å“è³ªæ˜¯å¦å—å½±éŸ¿ï¼Œä½†å¾ˆå¤šè¤‡é›œçš„æœå‹™ï¼Œä»¥åŠä¸ç†Ÿæ‚‰çš„æœå‹™ï¼Œæœƒå¾ˆé›£è©•ä¼°&lt;/p&gt;
&lt;p&gt;å…ˆèª¿é™ requestï¼Œæå‡å–®ä¸€ node ä¸Šçš„ pod æ•¸é‡ï¼Œç„¶å¾Œè§€å¯Ÿæœå‹™å“è³ªï¼Œå¦‚æœæœå‹™å“è³ªæ²’æœ‰å—åˆ°å½±éŸ¿ï¼Œé‚£éº¼ä½ å¯ä»¥é€²ä¸€æ­¥èª¿é™ limit
å¸‚å ´å–Šåƒ¹ï¼Œå…ˆå–Šå€‹ä¸€åŠï¼Œåœ¨çœ‹èƒ½ç¹¼çºŒå£“åˆ°ä»€éº¼ç¨‹åº¦&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ”¶é›†ç›®å‰è³‡æºä½¿ç”¨è³‡æ–™&lt;/li&gt;
&lt;li&gt;è½‰åŒ–æˆå…¬æœ‰é›²çš„æˆæœ¬&lt;/li&gt;
&lt;li&gt;é€é tool å»ºè­°é©ç•¶çš„è³‡æº&lt;/li&gt;
&lt;li&gt;æ ¹æ“šæœå‹™å“è³ªçš„è¦æ±‚ï¼Œèª¿é™ cpu / memory&lt;/li&gt;
&lt;li&gt;å›é ­æª¢æŸ¥ SLO æ˜¯å¦æœ‰å—åˆ°å½±éŸ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;hpa&#34;&gt;HPA&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s/horizontal-pod-autoscale&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ HPA åœ¨æˆæœ¬ç²¾ç°¡çš„æ„ç¾©ï¼šå› ç‚ºå¤–éƒ¨å› ç´ æ”¹è®Šè² è¼‰çš„å…ƒä»¶&lt;/li&gt;
&lt;li&gt;ä½è² è¼‰æ™‚ä¸è¦é–‹å¤ªå¤šï¼Œé«˜è² è¼‰æ™‚è‡ªå‹•åŠ é–‹ pod&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;hpa-è€ƒé‡&#34;&gt;HPA: è€ƒé‡&lt;/h3&gt;
&lt;p&gt;å…ƒä»¶æ˜¯å¦èƒ½å¤ æ°´å¹³æ‹“å±•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•Ÿå‹•çš„ liveness check / readiness check&lt;/li&gt;
&lt;li&gt;laod balancer&lt;/li&gt;
&lt;li&gt;éœ€è¦æŒçºŒèª¿æ•´ scale up / down çš„æ¢ä»¶èˆ‡ time windows&lt;/li&gt;
&lt;li&gt;scale up å°ä¾è³´æœå‹™çš„ loading æœƒæœ‰å½±éŸ¿ ex. å¾Œé¢çš„ db&lt;/li&gt;
&lt;li&gt;é€€å ´æ©Ÿåˆ¶ï¼Œè¦å¦‚ä½•å®‰å…¨çš„ä¸­æ–·é€£ç·šï¼Œç´€éŒ„ state&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;è¦èƒ½å®‰å…¨åœ°é€²å‡ºå ´&lt;/p&gt;
&lt;p&gt;é€²å ´ï¼Œpod readiness / liveness
loading å¢åŠ æ™‚ scale up time windows
scale out å°å¾Œæ–¹æœå‹™çš„å½±éŸ¿ï¼Œæ˜¯å¦æœƒå‡ºç¾æ–°çš„ç“¶é ¸&lt;/p&gt;
&lt;p&gt;loading é™ä½æ™‚ scale down æ˜¯å¦æœƒå½±éŸ¿æœå‹™&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;vpa&#34;&gt;VPA&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/README.md#quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s/autoscaler/vertical-pod-autoscaler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸èƒ½æ°´å¹³æ‹“å±•ï¼Œåªå¥½å…ˆå‚ç›´æ‹“å±•&lt;/li&gt;
&lt;li&gt;èª¿æ•´è³‡æºï¼Œæœ‰å¯èƒ½æœƒé‡å•Ÿ pod / container&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/blog/2023/05/12/in-place-pod-resize-alpha/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes 1.27: In-place Resource Resize for Kubernetes Pods (alpha)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/122760&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;In-Place Pod Resource Resizing always restarts pod&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ çš„ workload ç„¶å¾Œä¸é©åˆåš HPAï¼Œä½†å¯ä»¥æ¥å— resize å¾Œé‡å•Ÿï¼Œé‚£å¯ä»¥è©¦è©¦VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  1.27 ä½ å¯ä»¥æŠŠ InPlacePodVerticalScaling feature gate é–‹èµ·ä¾†
ä»–ä¸ä¿è­‰ resize å¾Œä¸æœƒé‡å•Ÿ podï¼Œé‚„æ˜¯è¦çœ‹ä½ çš„ container runtime æ”¯æ´ç¨‹åº¦
è«‹å…ˆåœ¨æ¸¬è©¦ç’°å¢ƒä¸­ç©ä¸€ç©
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;saving-plan--ri&#34;&gt;Saving Plan / RI&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AWS Saving Plan / RI&lt;/li&gt;
&lt;li&gt;GCP Committed Use Discount&lt;/li&gt;
&lt;li&gt;Azure Reservation&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;Saving Plan / RI æ˜¯ä¸€ç¨®é•·æœŸçš„åˆç´„ï¼Œä½ å¯ä»¥è·Ÿé›²ç«¯æœå‹™å•†ç°½ç´„ï¼Œä¿è­‰ä½ æœƒç”¨å¤šå°‘è³‡æºï¼Œç„¶å¾Œé›²ç«¯æœå‹™å•†æœƒçµ¦ä½ ä¸€å€‹æŠ˜æ‰£
ä¸ƒæŠ˜ä¸Šä¸‹ï¼Œå¾ˆé©åˆé•·æœŸä½¿ç”¨çš„å®¢æˆ¶&lt;/p&gt;
&lt;p&gt;æœ‰ monitoring + predictionï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¢ºå®šä½ æœƒç”¨å¤šå°‘è³‡æºï¼Œé€™æ™‚å€™å°±å¯ä»¥è€ƒæ…® saving plan / RI&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;spot-instance&#34;&gt;Spot Instance&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://azure.microsoft.com/en-us/products/virtual-machines/spot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;azure spot vm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/ec2/spot/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws spot intance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/spot-vms&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gcp spot vm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¸³é¢ä¸Šæœ€é«˜å¯çœ 90%&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;spot-instance-1&#34;&gt;Spot Instance&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¶…ä¾¿å®œï¼Œæ‰“ä¸€æŠ˜&lt;/li&gt;
&lt;li&gt;å¤šé¤˜çš„ç®—åŠ›&lt;/li&gt;
&lt;li&gt;interruptionï¼Œä¸ä¿è­‰ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/ec2/spot/instance-advisor/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://aws.amazon.com/ec2/spot/instance-advisor/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  å› ç‚ºä¸€æŠ˜çœŸçš„å¾ˆé¦™ï¼Œä¸€æŠ˜æ˜¯æœ‰é»æ‹¼ï¼Œä½†æ‰“å€‹ 3 æŠ˜é‚„æ˜¯å¾ˆæœ‰æ©Ÿæœƒ
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;spot-instance-åˆ†é¡-workload&#34;&gt;Spot Instance: åˆ†é¡ workload&lt;/h3&gt;
&lt;p&gt;interruption ç›´æ¥å½±éŸ¿æœå‹™å“è³ªçš„å°±ä¸å®œ&lt;/p&gt;
&lt;p&gt;ä¸å½±éŸ¿æœå‹™å“è³ªçš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;stateless&lt;/li&gt;
&lt;li&gt;batch job&lt;/li&gt;
&lt;li&gt;å°‡ worklaod å¾ monolithic æ‹†åˆ†æˆå°çš„ batch job&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦ç’°å¢ƒ dev / stag&lt;/li&gt;
&lt;li&gt;CI/CD&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ä¹çœ‹ä¹‹ä¸‹å¹¾å€‹å°æ™‚~24hr å…§æœƒè¢«é‡å•Ÿï¼Œå¥½åƒæ˜¯çŠ§ç‰²äº†æœå‹™å“è³ªï¼Œä½†å¦‚æœä½ çš„æœå‹™æ˜¯å¯ä»¥å®¹å¿ interruption çš„ï¼Œä¾‹å¦‚ batch jobï¼Œé‚£éº¼ spot instance å°±æ˜¯ä¸€å€‹å¾ˆå¥½çš„é¸æ“‡&lt;/p&gt;
&lt;p&gt;å°‡ worklaod å¾ monolithic æ‹†åˆ†æˆå°çš„ batch jobï¼Œä¾‹å¦‚ä½ æ˜¯ api server è™•ç†ä¸€å€‹ request æœƒæœ‰å¾ˆå¤šæ­¥é©Ÿï¼Œä½ å¯ä»¥æŠŠé€™äº›æ­¥é©Ÿæ‹†åˆ†æˆå°çš„ batch jobï¼Œç„¶å¾Œç”¨ queue ä¸²æ¥ï¼Œé€™æ¨£ä½ çš„ api server å°±å¯ä»¥ç”¨ spot instance ä¾†è·‘ï¼Œç„¶å¾Œä½ çš„ batch job ç”¨ spot instance è·‘ï¼Œé€™æ¨£ä½ çš„æœå‹™å°±å¯ä»¥çœå¾ˆå¤šéŒ¢&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµ-1&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;krr å·¥å…·èª¿æ•´è³‡æº&lt;/li&gt;
&lt;li&gt;HPA åšæ°´å¹³æ“´å±•&lt;/li&gt;
&lt;li&gt;VPA è‡ªå‹•åŒ–èª¿æ•´è³‡æº&lt;/li&gt;
&lt;li&gt;saving plan / RI é•·æœŸåˆç´„æ‰“ä¸ƒæŠ˜&lt;/li&gt;
&lt;li&gt;spot instance æ‰“ä¸€æŠ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å±•æœ›&#34;&gt;å±•æœ›&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;cost awareness development&lt;/li&gt;
&lt;li&gt;find-grade optimization&lt;/li&gt;
&lt;li&gt;automation&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æœ‰äº†è³‡æºé æ¸¬ç³»çµ±ï¼Œå¯ä»¥åœ¨é–‹ç™¼éšæ®µå°±å°‡è³‡æºä½¿ç”¨å›é¥‹çµ¦é–‹ç™¼åœ˜éšŠ
æ ¹æ“šä¸åŒæœå‹™å…ƒä»¶çš„å“è³ªè¦æ±‚ï¼Œåšæ›´ç´°ç·»çš„è³‡æºç®¡æ§
è‡ªå‹•åŒ–èª¿æ•´ï¼Œè®“äººåŠ›å¯ä»¥å°ˆæ³¨åœ¨æ›´é‡è¦çš„äº‹æƒ…ä¸Š
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å°çµ-2&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;cpu / memory&lt;/li&gt;
&lt;li&gt;ç›£æ¸¬æ˜¯åŸºç¤&lt;/li&gt;
&lt;li&gt;ä¾æ“šç›£æ¸¬åšé æ¸¬&lt;/li&gt;
&lt;li&gt;é–‹å§‹èª¿æ•´&lt;/li&gt;
&lt;li&gt;é•·æœŸåˆç´„æ‰“ä¸ƒæŠ˜&lt;/li&gt;
&lt;li&gt;spot instance æ‰“ä¸€æŠ˜&lt;/li&gt;
&lt;li&gt;HPA / VPA&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ„Ÿè¬&#34;&gt;æ„Ÿè¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;presentation and speaker notes &lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.linkedin.com/company/maicoin/jobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maicoin è·ç¼º&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¬å¸ç¦åˆ©ä¸éŒ¯ï¼Œæ¥­å‹™æˆé•·ä¸­ï¼Œæƒ³ä¸€èµ·å…±äº‹ï¼Œæ­¡è¿æ‰¾æˆ‘èŠ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Summit: Resource as Code for Kubernetes: Stop kubectl apply</title>
      <link>https://chechia.net/zh-hant/talk/kubernetes-summit-resource-as-code-for-kubernetes-stop-kubectl-apply/</link>
      <pubDate>Wed, 25 Oct 2023 13:20:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/kubernetes-summit-resource-as-code-for-kubernetes-stop-kubectl-apply/</guid>
      <description>&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;Title: Resource as Code for Kubernetes: stop kubectl apply&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://k8s.ithome.com.tw/CFP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://k8s.ithome.com.tw/CFP&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Infrastrure as Code (IaC) èˆ‡ PaCï¼Œåœ¨è¬ç‰©éƒ½è©² as Code å¾—æ™‚ä»£ï¼Œä½ é‚„åœ¨ä¸æ–·çš„ kubectl apply å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ‰‹å‹• apply çš„ç—›é»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äººå°±æ˜¯æœƒå¿˜ï¼šæ˜¯èª° apply é€™å€‹åœ¨ k8s ä¸Šçš„ï¼Ÿæ˜¯èª°ä¸Šæ¬¡æ¼ apply æ‰€ä»¥å£äº†ï¼Ÿ&lt;/li&gt;
&lt;li&gt;äººå°±æ˜¯æœƒå¯«éŒ¯ï¼šèƒ½å¦ apply&lt;/li&gt;
&lt;li&gt;ç®¡ç†å¤§é‡çš„ label, taint, annotation&lt;/li&gt;
&lt;li&gt;å®‰å…¨ï¼šapply è®Šæ›´å…§å®¹æ˜¯å¦æœ‰ç¶“éè³‡è¨Šå®‰å…¨çš„ review&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç•¶æœå‹™çš„ app code base éƒ½å·²ç¶“ç”¨ chart æ‰“åŒ…ï¼Œä½¿ç”¨ vcs ç®¡ç†å¾Œï¼Œç‚ºä½•ä¾è³´çš„ k8s resource (namespace, secret, label, crd, &amp;hellip;) ä¸éœ€è¦æ¨ä¸Š vcs ç®¡ç†çš„ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›é›†åˆå¹¾å€‹ç®¡ç† k8s çš„ç¯„ä¾‹ï¼Œå°‡ k8s resource ä»¥ code ç®¡ç†ï¼Œæ¨ä¸Š vcsï¼Œä¸¦ä½¿ç”¨ argoCD, secret operator, &amp;hellip; ç­‰å·¥å…·é€²è¡Œç®¡ç†ï¼Œä¾†è®“é¿å…ä½ç´šçš„äººå·¥æ“ä½œéŒ¯èª¤ï¼Œé™ä½åœ˜éšŠæ•´é«”å¤±èª¤ç‡ï¼Œä¸¦é™ä½ k8s admin ç®¡ç†çš„æˆæœ¬ï¼Œæé«˜ç®¡ç†æ•ˆç‡&lt;/p&gt;
&lt;h1 id=&#34;target-group&#34;&gt;target group&lt;/h1&gt;
&lt;p&gt;Kubernetes User who want to increase performance in k8s management&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Summit: Resource as Code for Kubernetes: Stop kubectl apply</title>
      <link>https://chechia.net/zh-hant/slides/2023-10-25-k8s-resource-as-code/</link>
      <pubDate>Mon, 23 Oct 2023 00:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2023-10-25-k8s-resource-as-code/</guid>
      <description>
&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;onepiece.jpg&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  Q1: æœ‰éä½¿ç”¨ helm è·Ÿ argocd çš„äººè«‹èˆ‰æ‰‹
Q2: k8s object èµ° gitflow ç®¡ç†çš„æ¯”ä¾‹æœ‰è¶…é 9 æˆçš„
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;resource-as-code-for-k8s-object&#34;&gt;Resource as Code for K8s Object&lt;/h3&gt;
&lt;h3 id=&#34;å¦‚ä½•ç®¡ç†-k8s-object&#34;&gt;å¦‚ä½•ç®¡ç† k8s object&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Che Chia Chang&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;outline&#34;&gt;Outline&lt;/h3&gt;
&lt;p&gt;Manage Kubernetes Objects in Gitflow&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;li&gt;helm chart&lt;/li&gt;
&lt;li&gt;argocd (gitflow)
&lt;ul&gt;
&lt;li&gt;applicationset&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;test&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ä»Šå¤©çš„å…§å®¹å‰åŠéƒ¨åƒæ˜¯è¬›å¤&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæœƒè¬› kubectl create / apply
kubectl ä½¿ç”¨ï¼Œç„¶å¾Œå®˜æ–¹æœ‰æé†’æˆ‘å€‘ä½¿ç”¨ kubectl ç®¡ç† k8s object æ™‚çš„ trade-offï¼Œé€™äº› trade-off æˆ‘å€‘å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å·¥å…·ä¾†å½Œè£œ&lt;/p&gt;
&lt;p&gt;å°å…¥ helm chartï¼Œä¾†æ‰“åŒ… k8s objects è®Šæˆä¸€å€‹å®Œæ•´åœ°ç™¼å¸ƒå–®ä½&lt;/p&gt;
&lt;p&gt;argocd èµ° gitflow ä¾†ç™¼å¸ƒ&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œåœ¨ workflow è£¡åŠ å…¥æ¸¬è©¦ï¼Œç¢ºä¿ k8s objects çš„äº¤ä»˜å“è³ª&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;kubectl&#34;&gt;Kubectl&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Imperative commands 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create deployment nginx --image nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Imperative object configuration 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create -f nginx.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Declarative object configuration
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -R -f configs/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/object-management/#management-techniques&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/overview/working-with-objects/object-management/#management-techniques&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  kubectl æ‡‰è©²æ˜¯æ‰€æœ‰äººå­¸ k8s çš„ç¬¬ä¸€å€‹å·¥å…·
ä½œç‚ºå®˜æ–¹çš„ cli å·¥å…·ï¼Œkunectl éå¸¸å¼·å¤§ï¼Œå¯ä»¥æ§åˆ¶å¹¾ä¹å¤§éƒ¨åˆ† k8s çš„ apiï¼Œä¹Ÿèƒ½å°å¹¾ä¹æ‰€æœ‰ k8s object é€²è¡Œæ“ä½œ
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;kubectl.jpg&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é¦–å…ˆï¼Œå¦‚åŒå®˜æ–¹æ–‡ä»¶æ‰€æè¿°ï¼Œkubectl çš„ä½¿ç”¨ä¸Šï¼Œä¹Ÿæœ‰å„ç¨®ä¸åŒæ–¹æ³•ã€‚ie. kubectl äº¤åœ¨ä¸åŒäººæ‰‹ä¸Šï¼Œä½¿ç”¨æ–¹å¼æ˜¯ä¸åŒçš„
å®˜æ–¹æ–‡ä»¶æè¿°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Imperative commands æŒ‡ä»¤å¼&lt;/li&gt;
&lt;li&gt;Imperative object configuration æŒ‡ä»¤ç‰©ä»¶&lt;/li&gt;
&lt;li&gt;Declarative object configuration å®£å‘Šç‰©ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;kubectl create deployment nginxï¼Œä¸€è¡Œå‘½ä»¤å‘Šè¨´ k8s ä½ è¦ create deployment&lt;/p&gt;
&lt;p&gt;kubectl create -f nginx.yamlï¼Œä½¿ç”¨è€…é¸æ“‡è¦ create / apply / delete è€Œ nginx.yaml è£¡é¢æè¿°ä¸€å€‹ nginx deployment ç‰©ä»¶&lt;/p&gt;
&lt;p&gt;kubectl apply -f -R nginx/ï¼Œä½¿ç”¨è€…æè¿°ä¸€å€‹æˆ–å¤šå€‹ç‰©ä»¶ï¼Œæè¿°ç‰©ä»¶çš„ç‹€æ…‹ã€‚apply æ™‚ï¼Œç”± kubectl æ±ºå®šè¦å° object åŸ·è¡Œï¼Œcreate / update / delete&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;issue&#34;&gt;Issue&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Imperative commands 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create deployment nginx --image nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Imperative object configuration 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create -f nginx.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Declarative object configuration
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -R -f configs/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;kubectl é€™éº¼å¥½ç”¨ï¼Œé‚£ç‚ºä½•ä¸ç¹¼çºŒç”¨ä¸‹å»ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çš„å•é¡Œå¾ˆæ˜é¡¯ï¼Œä¸èƒ½ diff
2.3. æœƒæœ‰ä¸€å€‹åŸºç¤çš„ specï¼Œé—œæ–¼ deployment/nginxï¼Œå› æ­¤å¯ä»¥åœ¨&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‡é»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;change review / diff&lt;/li&gt;
&lt;li&gt;source record other than live&lt;/li&gt;
&lt;li&gt;templateï¼Œä¸€å€‹å¯é‡è¤‡ä½¿ç”¨çš„æ¨£ç‰ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2.3. çš„å•é¡Œï¼Œä½ å¿…é ˆå° object å¤ äº†è§£ï¼Œæ‰å¯«å¾—å‡ºå®Œæ•´æ²’ bug çš„ spec yaml&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;è½èµ·ä¾†æ˜¯æœ€å®Œæ•´çš„ï¼Œä»–çš„å•é¡Œå°±æ˜¯è¦å¦‚ä½•ç¶­æŒ local file èˆ‡ live é€£çµï¼Œæˆ–æ˜¯èªª sync
é€™å€‹æœ‰ä½¿ç”¨ argocd çš„äººå¯èƒ½å°±æœƒæ¯”è¼ƒæœ‰æ„Ÿè¦º&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¤§å®¶æœ‰èˆˆè¶£å¯ä»¥å»çœ‹å®˜æ–¹æè¿°çš„å…§å®¹ï¼Œé€™è£¡ä¸è´…è¿°&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;issue-1&#34;&gt;Issue&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;change review / diff before apply&lt;/li&gt;
&lt;li&gt;source of live record&lt;/li&gt;
&lt;li&gt;template / repetitive apply&lt;/li&gt;
&lt;li&gt;sync local to live&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;ul&gt;
&lt;li&gt;change review / diff before apply&lt;/li&gt;
&lt;li&gt;source of live record&lt;/li&gt;
&lt;li&gt;template / repetitive apply&lt;/li&gt;
&lt;li&gt;sync local to live&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;declarative-object-configuration&#34;&gt;Declarative object configuration&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ ingress.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ ingress.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;microservice-a b c ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  ç‚ºäº† change reviewï¼Œé€šå¸¸æœƒèµ°å‘ 3. Declarative object configurationï¼Œå¯èƒ½æœƒé•·é€™æ¨£
ä¸€å€‹ git repository
è£¡é¢æœ‰å¤šå€‹ directoryï¼Œæè¿°æ¯ä¸€çµ„æœå‹™æ‰€éœ€è¦çš„è³‡æº
ä½¿ç”¨ kubectl ä¸€æ¬¡ apply æ•´å€‹ directoryï¼Œæ‰€ä»¥ local file åŸºæœ¬ä¸Šä¹Ÿåæ‡‰ live object
æœ‰ local fileï¼Œå¾ˆè‡ªç„¶è€Œç„¶å°±æœƒæƒ³è¦æ”¾åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾‹å¦‚ gitï¼Œé€™æ¨£åˆå¯ä»¥èµ° gitflow
PR -&amp;gt; review -&amp;gt; merged -&amp;gt; apply master / release tag
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;helm.jpg&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;æœ‰äººåœ¨ 2014 å¹´å‰ç”¨é k8s å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¤æ—©æ™‚æœŸï¼Œè¦ç”¨å€‹ redis é‚„è¦è‡ªå·±åŒ… service / ingress / deploymentï¼Œå…ˆå» dockerhub æ‰¾ redisï¼Œç„¶å¾Œä¾æ“š readme è‡ªå·±åŒ… deploymentï¼Œè‡ªå·±æ¸¬è©¦çœ‹ redis æœƒä¸æœƒå‹•&lt;/p&gt;
&lt;p&gt;ç¾åœ¨æ‡‰è©²æ²’æœ‰äººæœƒå› ç‚ºè¦å»ä½¿ç”¨ redis æˆ–æ˜¯ mysqlï¼Œè‡ªå·±è·‘å»å¯« k8s object äº†å§&lt;/p&gt;
&lt;p&gt;helm v2.0-alpha 2016&lt;/p&gt;
&lt;p&gt;ç¾åœ¨æœ‰ helm + chart&lt;/p&gt;
&lt;p&gt;å¦‚æœåªæ˜¯ä½¿ç”¨ä½ä¸‰æ–¹é–‹æºçš„ helm chartï¼Œç¤¾ç¾¤å¹«ä½ ç¶­è­· service / ingress / deployment&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æä¾›åŸºæœ¬çš„ default valueï¼Œé è¨­å°±è·‘å¾—èµ·ä¾†&lt;/li&gt;
&lt;li&gt;è·‘å¾—èµ·ä¾†å¾Œï¼Œè·‘å¾—å¥½ï¼Œèƒ½ä½¿ç”¨ k8s orchestration æä¾›å®Œæ•´çš„åŠŸèƒ½ï¼Œé€é value.yaml æ§åˆ¶&lt;/li&gt;
&lt;li&gt;ç¶“éæ¸¬è©¦&lt;/li&gt;
&lt;li&gt;issue tracking&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;helm-chart&#34;&gt;Helm chart&lt;/h3&gt;
&lt;p&gt;k8s object çš„é–‹ç™¼ï¼Œæ‰“åŒ…ï¼Œæ¸¬è©¦ï¼Œrelease&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;k8s ååˆ†å¼·å¤§ï¼Œäº«å— orchestration&lt;/li&gt;
&lt;li&gt;k8s object è®Šå¾—å¤ªè¤‡é›œ&lt;/li&gt;
&lt;li&gt;æ¨™æº–åŒ– templateï¼Œrelease + upgrade&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;chart ä½œç‚ºä¸€å€‹ k8s object çš„ release / artifactï¼Œæœ‰é–‹ç™¼æµç¨‹ï¼Œç‰ˆæœ¬æ§ç®¡ï¼Œæ¸¬è©¦ï¼Œå®Œæ•´çš„ç™¼ä½ˆ&lt;/p&gt;
&lt;p&gt;app æœ¬èº«ï¼Œä¾‹å¦‚ redisï¼Œç•¶ç„¶æ˜¯æ•´å€‹æ‡‰ç”¨çš„æ ¸å¿ƒã€‚ä½†è¦èƒ½å¤ åœ¨ k8s åŸ·è¡Œï¼Œä¸¦æ­£ç¢ºåœ°äº«å— k8s orchestration çš„å¥½è™•ï¼Œk8s object éå¸¸çš„é‡è¦&lt;/p&gt;
&lt;p&gt;ç”šè‡³ï¼Œk8s object è¤‡é›œåº¦å·²ç¶“é é è¶…ééå»åœ¨ vm ä¸Šè·‘ä¸€å€‹ redisï¼Œå…œä¸€å€‹ systemd unit å°±å¯ä»¥è·‘èµ·ä¾†&lt;/p&gt;
&lt;p&gt;k8s object éœ€è¦ release / versionï¼Œæ‰èƒ½åš object çš„å›ºå®šç‰ˆæœ¬ applyï¼Œupgrade ç”Ÿç‰ˆï¼Œæœ‰å•é¡Œ rollback&lt;/p&gt;
&lt;p&gt;åœ¨ k8s ä¸Šè¦è·‘å¾—ç©©é‚Šçš„ååˆ†é–«é›£ï¼Œé€éç¤¾ç¾¤ä¾†ç¶­è­·å¤§éƒ¨åˆ†é€šé‹çš„ç¬¬ä¸‰æ–¹æœå‹™&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;helm-chart-library&#34;&gt;Helm Chart Library&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME       URL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bitnami    https://charts.bitnami.com/bitnami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;argocd     https://argoproj.github.io/argo-helm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chaos-mesh https://charts.chaos-mesh.org
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;k8s objects èƒ½å‹•å¾ˆç°¡å–®ï¼Œä½†è¦è·‘å¾—ç©©åˆèƒ½äº«å— orchestration çš„ä¾¿åˆ©ï¼Œååˆ†å›°é›£
é€éç¤¾ç¾¤ä¾†ç¶­è­·å¤§éƒ¨åˆ†é€šé‹çš„ç¬¬ä¸‰æ–¹æœå‹™ï¼Œé€éå–®ä¸€ value.yaml&lt;/p&gt;
&lt;p&gt;ç¤¾ç¾¤ç¶­è­·çš„ chart ä¸æ˜¯å°±ä¸€å‹æ°¸é€¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç†±é–€çš„ chart&lt;/li&gt;
&lt;li&gt;ç‰¹æ®Šéœ€æ±‚æ™‚ï¼Œé‚„æ˜¯éœ€è¦ fork chart å›ä¾†è‡ªå·±ç¶­è­·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†ç„¡è«–å¦‚ä½•ï¼Œéƒ½æ˜¯å¤§å¹…é™ä½ç¶­é‹çš„è¤‡é›œåº¦&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;helm-ç”Ÿæ…‹ç³»&#34;&gt;helm ç”Ÿæ…‹ç³»&lt;/h3&gt;
&lt;p&gt;ex. helmfile&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;repositories:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  url: https://argoproj.github.io/argo-helm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helmDefaults:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  kubeContext: general
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #verify: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  wait: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  timeout: 300
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;context: general
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;releases:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  chart: argocd/argo-cd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  version: 5.31.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  values:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - values/argocd.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: mysql
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/cdwv/awesome-helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/cdwv/awesome-helm&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æ›´é«˜å±¤ç´šçš„å°è£&#34;&gt;æ›´é«˜å±¤ç´šçš„å°è£&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;api-services
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ mysql
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ ingress -&amp;gt; nlb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;daemon-services
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ mysql
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ kafka
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;åº•ä¸‹çš„ä¾è³´æ¨™æº–åŒ–ï¼Œä¾æ“šç©©å®šçš„ release ç™¼å¸ƒä¹‹å¾Œ
å¯ä»¥å†é€²è¡Œæ›´é«˜å±¤ç´šçš„å°è£&lt;/p&gt;
&lt;p&gt;é‡è¤‡æ€§çš„æœå‹™ï¼Œä¾‹å¦‚æ¯å€‹ microservice éƒ½éœ€è¦
ä¾‹å¦‚æˆ‘æœ‰ä¸€ç™¾å€‹ api service groupï¼Œéƒ½æ˜¯ restful apiï¼Œéƒ½éœ€è¦ ingress / service / nginx ç­‰ç­‰&lt;/p&gt;
&lt;p&gt;åº•ä¸‹çš„å…ƒä»¶æ¨™æº–åŒ–ï¼Œé™ä½ç¶­è­·æˆæœ¬&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çµ±ä¸€ç‰ˆæœ¬ï¼Œé†«ç—…ç¶­è­·ï¼Œå‡ç´šï¼Œé€€ç‰ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ daemon serviceï¼Œåº•ä¸‹ä¾è³´ queue / redis / db&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;å¾®æœå‹™&#34;&gt;å¾®æœå‹™&lt;/h3&gt;
&lt;p&gt;å¾®æœå‹™ä¸æ˜¯å•é¡Œï¼Œå¾®æœå‹™åº•ä¸‹çš„ k8s object æ‰æ˜¯å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥å¿«é€Ÿï¼Œæ¨™æº–åŒ–çš„ç”¢ç”Ÿç¶“éæ¸¬è©¦ï¼Œå¾®æœå‹™å–®å…ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;issues&#34;&gt;Issues&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;V change review / diff before apply&lt;/li&gt;
&lt;li&gt;source of live record&lt;/li&gt;
&lt;li&gt;V template / repetitive apply&lt;/li&gt;
&lt;li&gt;sync local to live&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;version control / gitflow&lt;/p&gt;
&lt;p&gt;helm template æœ‰æä¾›è¨±å¤šèªæ³•ï¼Œå¯ä»¥æœ‰ç³»çµ±åŒ–çš„ç”¢ç”Ÿé‡è¤‡çš„ k8s object
ex. å¯ä»¥è·‘ for loop / for each
é€™å€‹åœ¨ IaC æˆ–æ˜¯ resource as code çš„ xxx as code éƒ½ååˆ†æœ‰åˆ©&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;argo-cd&#34;&gt;Argo CD&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://argo-cd.readthedocs.io/en/stable/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Declarative GitOps CD for Kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://argo-cd.readthedocs.io/en/stable/assets/argocd-ui.gif&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;why-argo-cd&#34;&gt;Why Argo CD?&lt;/h3&gt;
&lt;p&gt;Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;application æ‡‰è©²æ˜¯æ˜ç¢ºå®£å‘Šçš„ï¼Œæ¸…æ¥šæè¿°ï¼Œä¸¦ä¸”æœ‰ç‰ˆæœ¬æ§ç®¡
æè¿° application æœ¬èº«ï¼Œé™„å¸¶çš„è¨­å®š secret / configmap
environment ä¹Ÿæ‡‰è©²æ˜¯å®£å‘Šå¼çš„&lt;/p&gt;
&lt;p&gt;application çš„éƒ¨ç½²èˆ‡ lifecycle ç®¡ç†ï¼Œéƒ½æ‡‰è©²æ˜¯è‡ªå‹•åŒ–ï¼Œå¯ä»¥ç¨½æ ¸ï¼Œè€Œä¸”å¥½ç†è§£
æ¨™æº–åŒ–ï¼Œè‡ªå‹•åŒ–
UI åœ–åƒæè¿°ï¼Œä¸€ç›®ç­ç„¶ã€‚ä½†äº‹å¯¦ä¸Šå¦‚æœæœ‰åšåˆ°è¬› local file æ¨åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼Œå…‰æ˜¯ä½¿ç”¨ editor ä¹Ÿå¯ä»¥åšåˆ°ä¸€ç›®ç­ç„¶&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;argo-cd-1&#34;&gt;Argo CD&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;gitflow / git repository&lt;/li&gt;
&lt;li&gt;argocd application sync file from repository&lt;/li&gt;
&lt;li&gt;argocd controller è‡ªå‹•åŒ–çš„ç¢ºä¿ sync
&lt;ul&gt;
&lt;li&gt;un-sync è‡ªå‹•åŒ–è™•ç†&lt;/li&gt;
&lt;li&gt;ç„¡æ³• sync æ™‚é€šçŸ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;gitflow&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;k8s object çš„ change æ˜¯éœ€è¦ PR review çš„ï¼Œä¸æ˜¯æƒ³æ”¹å°± kubectl apply ä¸‹å»&lt;/li&gt;
&lt;li&gt;k8s object çš„å“è³ªæŠŠé—œï¼Œä¾†è‡ªé«˜å“è³ªçš„ review&lt;/li&gt;
&lt;li&gt;é‡å° cluster ä¸Šçš„è®Šæ›´éƒ½æœ‰ç®¡æ§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;èƒ½å¤ ç›´æ¥æŒæ¡ live objectï¼Œé€é editor æª¢æŸ¥ git repositoryï¼Œæˆ–æ˜¯é€é argocd UI æª¢è¦–&lt;/p&gt;
&lt;p&gt;local file ç­‰æ–¼ live object
åœ¨è¤‡é›œçš„ç’°å¢ƒè£¡å¾ˆé‡è¦ï¼Œex. k8s å…§æœ‰æˆåƒä¸Šç™¾å€‹ helm releaseï¼Œå¯ä»¥ç”¨ editor æª¢è¦– local file&lt;/p&gt;
&lt;p&gt;ä¸ç„¶è¦é€é k8s å»æ‰“ api&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;api call ä¹Ÿæ˜¯è³‡æºå•Šï¼Œèƒ½çœå‰‡çœ&lt;/li&gt;
&lt;li&gt;editor æ›´ç›´è¦ºå¿«é€Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;applicationset&#34;&gt;applicationset&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators-Git/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;git generator&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: argoproj.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: ApplicationSet
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: general-argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  generators:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - git:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      repoURL: https://github.com/chechiachang/azure-argo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      revision: master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      directories:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - path: clusters/dev/dev-general/argocd/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  template:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      name: &amp;#39;dev-general-argocd-{{path.basename}}&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      labels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        environment: dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        type: infra
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        function: argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        cluster: dev-general
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      project: default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      syncPolicy:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        automated:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          prune: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        repoURL: https://github.com/chechiachang/azure-argo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        targetRevision: master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        path: &amp;#39;clusters/dev/dev-general/argocd/{{path.basename}}&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      destination:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        server: https://kubernetes.default.svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        namespace: argocd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;argocd é™¤äº† sync ä»¥å¤–é‚„æä¾›çš„è¨±å¤šåŠŸèƒ½&lt;/p&gt;
&lt;p&gt;applicationset å®šç¾©ä¸€çµ„ setï¼Œå¯ä»¥é€é generator è¿­ä»£çš„ç”¢ç”Ÿå¤§é‡çš„ application
ex. ä¸€æ¬¡ deploy ä¸€ç¾¤ redis&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;applicationset-1&#34;&gt;applicationset&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dev-general
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ default/redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ default/mysql
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ default/my-app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ nginx-ingress/nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ argocd/argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;stag-general
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prod-general
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;cluster-wide-çš„-k8s-object&#34;&gt;cluster-wide çš„ k8s object&lt;/h3&gt;
&lt;p&gt;cluster-wide çš„ k8s object ä¹Ÿå¾ˆé©åˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ helm template helper ä¾†ç®¡ç† value.yaml label / annotation / env / &amp;hellip;&lt;/li&gt;
&lt;li&gt;namespace&lt;/li&gt;
&lt;li&gt;rbac&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;cluster-wide çš„ k8s object ä¹Ÿå¾ˆé©åˆå¡é€² argocd ç®¡ç†&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ cluster access controlï¼Œè¤‡é›œçš„ rbac ruleï¼Œä¹Ÿå¾ˆé©åˆæ•´ç†æˆç‚º helm chart&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥è¼•é¬†å¯¦ç¾ user -&amp;gt; rule å¤šå°å¤š&lt;/li&gt;
&lt;li&gt;å¯ä»¥å¿«é€Ÿå¢æ¸› user group&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;issues-1&#34;&gt;Issues&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;V change review / diff before apply&lt;/li&gt;
&lt;li&gt;V source of live record&lt;/li&gt;
&lt;li&gt;V template / repetitive apply&lt;/li&gt;
&lt;li&gt;V sync local to live&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;more-issues-multi-hybrid-cluster&#34;&gt;More Issues: multi-hybrid cluster&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;multiple k8s
&lt;ul&gt;
&lt;li&gt;dev / stag / prod&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;hybrid k8s
&lt;ul&gt;
&lt;li&gt;bare metal / public cloud&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ç”±æ–¼ k8s å…§éƒ¨çš„ component éƒ½å·²ç¶“æ¨™æº–åŒ–ï¼Œå¯ä»¥å¾ˆè¼•æ˜“åœ°è¤‡è£½æ¸¬è©¦éçš„ component
dev æ¸¬è©¦ PR branchï¼Œstaging è·‘ release candicateï¼Œproduction é¸æ“‡ç¶“éæ¸¬è©¦çš„ release&lt;/p&gt;
&lt;p&gt;èƒ½å¤ ç¢ºä¿ dev / stag / prod çš„ k8s object æ˜¯å®Œå…¨ç›¸åŒçš„&lt;/p&gt;
&lt;p&gt;hybrid ç’°å¢ƒç®¡ç†ï¼ŒæŸäº› k8s å…ƒä»¶æ‡‰è©²å®‰è£åœ¨å“ªäº› cluster ä¸Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;aws ingress controller / csi driver / cni node daemonsets&lt;/li&gt;
&lt;li&gt;local nginx-ingress controller&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;more-issues-multi-hybrid-cluster-1&#34;&gt;More Issues: multi-hybrid cluster&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators-Cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;argocd cluster generator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: ApplicationSet
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: aws-cni
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  generators:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - clusters:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      selector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          eks: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          #bare-metal: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          staging: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;more-issues-multi-hybrid-cluster-2&#34;&gt;More Issues: multi-hybrid cluster&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators-Cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;argocd cluster generator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-eks-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ aws cni
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ aws ingress controller
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ nginx-ingress controller
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bare-metal-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ cilium
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ bare-metal ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ nginx-ingress controller
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  å¤šåº§ cluster
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;more-issues-multi-hybrid-cluster-3&#34;&gt;More Issues: multi-hybrid cluster&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;applicationset&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;more-issues-test&#34;&gt;More Issues: Test&lt;/h3&gt;
&lt;p&gt;k8s object éœ€ä¸éœ€è¦æ¸¬è©¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;infra-test (bare-metal / self-hosted)&lt;/li&gt;
&lt;li&gt;release (helm chart)&lt;/li&gt;
&lt;li&gt;live status&lt;/li&gt;
&lt;li&gt;stress / load test / chaos engineering&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;k8s object éœ€ä¸éœ€è¦æ¸¬è©¦ï¼Œè¦ºå¾—éœ€è¦æ¸¬è©¦çš„è«‹èˆ‰æ‰‹&lt;/p&gt;
&lt;p&gt;k8s object éœ€ä¸éœ€è¦æ¸¬è©¦ï¼Œå°±è·Ÿé€™å€‹æŠ•å½±ç‰‡ä¸€æ¨£
æœ‰æ™‚é–“å°±è¬›ä¸€ä¸‹ï¼Œæ²’æ™‚é–“å°±è·³éå§&lt;/p&gt;
&lt;p&gt;infra-test provider æ‡‰è©²éƒ½æ¸¬å®Œäº†
è¦æ¸¬çš„æ˜¯ k8s object çš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆé æœŸ&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶ï¼Œæœ‰æ¸¬è©¦çš„ helm releae èˆ‡æ²’æ¸¬è©¦çš„ helm release ä¹Ÿæ˜¯å¤©å·®åœ°é &lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;test-ansible-playbook&#34;&gt;Test: ansible playbook&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¸¬è©¦ apply å¾Œ k8s object çš„ status
&lt;ul&gt;
&lt;li&gt;ingress æ˜¯å¦ ready&lt;/li&gt;
&lt;li&gt;endpoint æ˜¯å¦æœ‰ç”¢ç”Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯ä»¥å…ˆæ¸¬
&lt;ul&gt;
&lt;li&gt;networking (ingress / svc)&lt;/li&gt;
&lt;li&gt;storage (csi / pvc)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: Test nginx deployment
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: {{ host }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  gather_facts: no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  vars:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    deployment_name: &amp;#34;nginx&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tasks:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: Get deployment status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    shell: kubectl get deployment {{ deployment_name }} -o=jsonpath=&amp;#39;{.status.readyReplicas}&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    register: deployment_status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    failed_when: deployment_status.rc != 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: Verify deployment is running
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    assert:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      that:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - deployment_status.stdout != &amp;#39;null&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - deployment_status.stdout != &amp;#39;0&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      fail_msg: &amp;#39;Deployment {{ deployment_name }} is not running.&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;more-issues-test-1&#34;&gt;More Issues: Test&lt;/h3&gt;
&lt;p&gt;&lt;del&gt;Test&lt;/del&gt; Monitoring&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;prometheus rule with helm chart&lt;/li&gt;
&lt;li&gt;ServiceMonitor&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  helm release ä¸€å€‹ api-services
api service æœ‰ /metrics endpoint
é€é ServiceMonitor ä¾†æŒçºŒæ€§çš„ç´€éŒ„ metrics
é€é PrometheusRule ä¾†è¨­å®šç•°å¸¸ metrics çš„å‘Šè­¦
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;more-issues-test-2&#34;&gt;More Issues: Test&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;stress-test / load test
&lt;ul&gt;
&lt;li&gt;k6&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;chaos-engineering
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chaos-mesh.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chaos-mesh.org/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/asobti/kube-monkey&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/asobti/kube-monkey&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h3 id=&#34;summary&#34;&gt;Summary&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;kubectl + gitflow&lt;/li&gt;
&lt;li&gt;helm chart&lt;/li&gt;
&lt;li&gt;argocd: applicationset / generator&lt;/li&gt;
&lt;li&gt;test&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Q &amp;amp; A&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vault Workshop ??: Integrated Storage</title>
      <link>https://chechia.net/zh-hant/post/2023-10-10-vault-workshop-integrated-storage/</link>
      <pubDate>Tue, 10 Oct 2023 04:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-10-10-vault-workshop-integrated-storage/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day--integrated-backend&#34;&gt;Day ??: Integrated Backend&lt;/h1&gt;
&lt;p&gt;é›†æˆå­˜å„²&lt;/p&gt;
&lt;p&gt;Vault æ”¯æ´å¤šç¨®å­˜å„²é¸é …ï¼Œç”¨æ–¼æŒä¹…å­˜å„² Vault è³‡è¨Šã€‚è‡ª Vault 1.4 èµ·ï¼Œæä¾›äº†æ•´åˆå¼å­˜å„²é¸é …ã€‚æ­¤å­˜å„²å¾Œç«¯ä¸ä¾è³´æ–¼ä»»ä½•ç¬¬ä¸‰æ–¹ç³»çµ±ï¼Œå¯¦ç¾é«˜å¯ç”¨æ€§èªç¾©ï¼Œæ”¯æ´ä¼æ¥­è¤‡è£½åŠŸèƒ½ï¼Œä¸¦æä¾›å‚™ä»½/é‚„åŸå·¥ä½œæµã€‚&lt;/p&gt;
&lt;p&gt;è©²é¸é …å°‡ Vault çš„æ•¸æ“šå­˜å„²åœ¨æœå‹™å™¨çš„æ–‡ä»¶ç³»çµ±ä¸Šï¼Œä¸¦ä½¿ç”¨å…±è­˜å”è­°å°‡æ•¸æ“šè¤‡è£½åˆ°é›†ç¾¤ä¸­çš„æ¯å€‹æœå‹™å™¨ã€‚æœ‰é—œæ•´åˆå¼å­˜å„²å…§éƒ¨çš„æ›´å¤šä¿¡æ¯ï¼Œè«‹åƒé–±æ•´åˆå¼å­˜å„²å…§éƒ¨æ–‡æª”ã€‚æ­¤å¤–ï¼Œé…ç½®æ–‡æª”å¯ä»¥å¹«åŠ©é…ç½® Vault ä»¥ä½¿ç”¨æ•´åˆå¼å­˜å„²ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å„ç¯€å°‡è©³ç´°ä»‹ç´¹å¦‚ä½•ä½¿ç”¨æ•´åˆå¼å­˜å„²æ“ä½œ Vaultã€‚&lt;/p&gt;
&lt;p&gt;æœå‹™å™¨é–“é€šä¿¡
ä¸€æ—¦ç¯€é»åŠ å…¥åˆ°å½¼æ­¤ï¼Œå®ƒå€‘é–‹å§‹ä½¿ç”¨ Vault çš„å¢é›†ç«¯å£é€²è¡Œ mTLS é€šä¿¡ã€‚å¢é›†ç«¯å£çš„é»˜èªå€¼ç‚º 8201ã€‚TLS ä¿¡æ¯åœ¨åŠ å…¥æ™‚äº¤æ›ï¼Œä¸¦æŒ‰ä¸€å®šçš„ç¯€å¥é€²è¡Œè¼ªæ›ã€‚&lt;/p&gt;
&lt;p&gt;æ•´åˆå¼å­˜å„²çš„è¦æ±‚ä¹‹ä¸€æ˜¯å¿…é ˆè¨­ç½® cluster_addr é…ç½®é¸é …ã€‚é€™å…è¨± Vault åœ¨åŠ å…¥æ™‚ç‚ºç¯€é» ID åˆ†é…åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;å¢é›†æˆå“¡è³‡æ ¼
æœ¬ç¯€å°‡æ¦‚è¿°å¦‚ä½•å¼•å°å’Œç®¡ç†é‹è¡Œæ•´åˆå¼å­˜å„²çš„ Vault ç¯€é»é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;æ•´åˆå¼å­˜å„²åœ¨åˆå§‹åŒ–éç¨‹ä¸­å¼•å°ï¼Œä¸¦ä¸”çµæœæ˜¯å¤§å°ç‚º 1 çš„é›†ç¾¤ã€‚æ ¹æ“šæ‰€éœ€çš„éƒ¨ç½²å¤§å°ï¼Œå¯ä»¥å°‡ç¯€é»åŠ å…¥åˆ°æ´»å‹• Vault ç¯€é»ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åŠ å…¥ç¯€é»
åŠ å…¥æ˜¯å°‡æœªåˆå§‹åŒ–çš„ Vault ç¯€é»ä¸¦ä½¿å…¶æˆç‚ºç¾æœ‰é›†ç¾¤æˆå“¡çš„éç¨‹ã€‚ç‚ºäº†å°‡æ–°ç¯€é»é©—è­‰åˆ°é›†ç¾¤ï¼Œå®ƒå¿…é ˆä½¿ç”¨ç›¸åŒçš„å¯†å°æ©Ÿåˆ¶ã€‚å¦‚æœä½¿ç”¨è‡ªå‹•è§£å°ï¼Œå‰‡å¿…é ˆé…ç½®æ–°ç¯€é»ä»¥ä½¿ç”¨èˆ‡å…¶å˜—è©¦åŠ å…¥çš„é›†ç¾¤ç›¸åŒçš„ KMS æä¾›ç¨‹åºå’Œå¯†é‘°ã€‚å¦‚æœä½¿ç”¨ Shamir å¯†å°ï¼Œå‰‡å¿…é ˆåœ¨åŠ å…¥éç¨‹å®Œæˆä¹‹å‰ç‚ºæ–°ç¯€é»æä¾›è§£å°å¯†é‘°ã€‚ä¸€æ—¦ç¯€é»æˆåŠŸåŠ å…¥ï¼Œä¾†è‡ªæ´»å‹•ç¯€é»çš„æ•¸æ“šå°±å¯ä»¥é–‹å§‹è¤‡åˆ¶åˆ°å®ƒã€‚ä¸€æ—¦ç¯€é»åŠ å…¥ï¼Œå‰‡ä¸èƒ½é‡æ–°åŠ å…¥åˆ°ä¸åŒçš„é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥é€šéé…ç½®æ–‡ä»¶è‡ªå‹•åŠ å…¥ç¯€é»ï¼Œä¹Ÿå¯ä»¥é€šé API æ‰‹å‹•åŠ å…¥ï¼ˆä¸‹é¢æè¿°äº†é€™å…©ç¨®æ–¹æ³•ï¼‰ã€‚åœ¨åŠ å…¥ç¯€é»æ™‚ï¼Œå¿…é ˆä½¿ç”¨é ˜å°ç¯€é»çš„ API åœ°å€ã€‚æˆ‘å€‘å»ºè­°åœ¨æ‰€æœ‰ç¯€é»ä¸Šè¨­ç½® api_addr é…ç½®é¸é …ï¼Œä»¥ä½¿åŠ å…¥éç¨‹æ›´ç°¡å–®ã€‚&lt;/p&gt;
&lt;p&gt;retry_join é…ç½®
æ­¤æ–¹æ³•å…è¨±åœ¨é…ç½®æ–‡ä»¶ä¸­è¨­ç½®ä¸€å€‹æˆ–å¤šå€‹ç›®æ¨™é ˜å°ç¯€é»ã€‚ç•¶æœªåˆå§‹åŒ–çš„ Vault æœå‹™å™¨å•Ÿå‹•æ™‚ï¼Œå®ƒå°‡å˜—è©¦åŠ å…¥æ¯å€‹å·²å®šç¾©çš„æ½›åœ¨é ˜å°è€…ï¼Œç›´åˆ°æˆåŠŸã€‚ç•¶æŒ‡å®šçš„é ˜å°è€…ä¹‹ä¸€è®Šç‚ºæ´»å‹•ç‹€æ…‹æ™‚ï¼Œæ­¤ç¯€é»å°‡æˆåŠŸåŠ å…¥ã€‚ç•¶ä½¿ç”¨ Shamir å¯†å°æ™‚ï¼Œå·²åŠ å…¥çš„ç¯€é»ä»ç„¶éœ€è¦æ‰‹å‹•è§£å°ã€‚ç•¶ä½¿ç”¨è‡ªå‹•è§£å°æ™‚ï¼Œç¯€é»å°‡èƒ½å¤ è‡ªå‹•åŠ å…¥ä¸¦è‡ªå‹•è§£å°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€å€‹ç¤ºä¾‹ retry_join é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;storage &lt;span class=&#34;s2&#34;&gt;&amp;#34;raft&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/var/raft/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;node_id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;node3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  retry_join &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;leader_api_addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://node1.vault.local:8200&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  retry_join &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;leader_api_addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://node2.vault.local:8200&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;storage &lt;span class=&#34;s2&#34;&gt;&amp;#34;raft&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/var/raft/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;node_id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;node3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  retry_join &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;auto_join&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;provider=aws region=eu-west-1 tag_key=vault tag_value=... access_key_id=... secret_access_key=...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/concepts/integrated-storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/concepts/integrated-storage&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¾ˆé‡è¦ï¼šä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>DevOpsDay: HashiCorp Vault è‡ªå»ºé‡‘é‘°ç®¡ç†æœ€ä½³å…¥å‘å§¿å‹¢</title>
      <link>https://chechia.net/zh-hant/talk/devopsday-hashicorp-vault-%E8%87%AA%E5%BB%BA%E9%87%91%E9%91%B0%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%85%A5%E5%9D%91%E5%A7%BF%E5%8B%A2/</link>
      <pubDate>Tue, 26 Sep 2023 13:20:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/devopsday-hashicorp-vault-%E8%87%AA%E5%BB%BA%E9%87%91%E9%91%B0%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%85%A5%E5%9D%91%E5%A7%BF%E5%8B%A2/</guid>
      <description>&lt;p&gt;HashiCorp Vault è‡ªå»ºé‡‘é‘°ç®¡ç†æœ€ä½³å…¥å‘å§¿å‹¢&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›å¾å°å…¥ HashiCorp Vault ä½œç‚ºèµ·é»ï¼Œç›´æ¥æä¾›å¯¦å‹™ä¸Šç¶“é©—ï¼Œåˆ†äº«å»ºè­°çš„è¨­å®šèˆ‡è·¯ä¸Šå¯èƒ½æœ‰çš„é›·ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Vault å…¥å‘çš„å›°é›£&lt;/li&gt;
&lt;li&gt;Vault + Terraform ä¸€å…¥å‘å°± IaC&lt;/li&gt;
&lt;li&gt;mount path + role + policy å‘½åèˆ‡ç®¡ç†&lt;/li&gt;
&lt;li&gt;å‡ç´šèˆ‡ç¶­è­·&lt;/li&gt;
&lt;li&gt;æœƒä¾æ“šä¼æ¥­éœ€æ±‚æä¾›å¯¦éš›ç”¨ä¾‹ demoï¼Œç•¶å¤©æä¾› github code example&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸­éš&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é æœŸè½çœ¾æ˜¯æœ‰ Vault ä½¿ç”¨ç¶“é©—ï¼Œå¸Œæœ›èƒ½æ›´æœ‰æ•ˆç‡ç®¡ç† Vault çš„äºº&lt;/li&gt;
&lt;li&gt;ä¸æœƒè¬›å¤ªå¤šåŸºæœ¬åŠŸèƒ½ä»‹ç´¹ vault ä»‹ç´¹&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>DevOpsDay: HashiCorp Vault è‡ªå»ºé‡‘é‘°ç®¡ç†æœ€ä½³å…¥å‘å§¿å‹¢</title>
      <link>https://chechia.net/zh-hant/slides/2023-09-26-devopsday-2023-vault/</link>
      <pubDate>Thu, 21 Sep 2023 00:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2023-09-26-devopsday-2023-vault/</guid>
      <description>
&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;onepiece.jpg&#34;
  &gt;

&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;Q1: æœ‰éä½¿ç”¨ hashicorp vault çš„äººè«‹èˆ‰æ‰‹&lt;/p&gt;
&lt;p&gt;æ²’ä½¿ç”¨éçš„äººä¸æ˜¯é€™å€‹ session çš„ç›®æ¨™è½çœ¾ï¼Œå¯ä»¥ QR code æ‹ä¸‹ä¾†å»è½åˆ¥å ´ã€‚ä¾‹å¦‚å°é¢åŒé¡Œæçš„session
QR code æœ‰æŠ•å½±ç‰‡ï¼Œç¯„ä¾‹ github repoï¼ŒæŠ•å½±ç‰‡è£¡é‚„æœ‰è¬›ç¨¿ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©åœ¨é€™è£¡çš„ç”¨è™•å°±æ˜¯å¿µç¨¿ï¼ŒçœŸçš„å¯ä»¥ qrcode æ‹äº†å›å®¶çœ‹&lt;/p&gt;
&lt;p&gt;Q2: æœ‰ä½¿ç”¨é infrastructure as code / terraform çš„äººè«‹èˆ‰æ‰‹&lt;/p&gt;
&lt;p&gt;æœ‰ä½¿ç”¨ vault ä½†æ˜¯æ²’æœ‰ä½¿ç”¨ IaC çš„æœ‹å‹ï¼Œæ‰æ˜¯é€™å ´ session çš„ä¸»è¦å—çœ¾&lt;/p&gt;
&lt;p&gt;Q3: æœ‰ä½¿ç”¨ iac deploy vault stackï¼Œæˆ–æ˜¯æœ‰ä½¿ç”¨ iac / vcs ç®¡ç† vault å…§çš„ policy çš„äººè«‹èˆ‰æ‰‹&lt;/p&gt;
&lt;p&gt;é€™äº›äººå¯ä»¥å‡ºå»åƒé›¶é£Ÿï¼Œä»Šå¤©è¬›çš„å…§å®¹ä½ å€‘éƒ½æœƒäº†ï¼Œæˆ‘æ²’ä»€éº¼æ±è¥¿å¯ä»¥è·Ÿä½ å€‘åˆ†äº«&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;background.jpg&#34;
  &gt;

&lt;h2 id=&#34;hashicorp-vault&#34;&gt;HashiCorp Vault&lt;/h2&gt;
&lt;h2 id=&#34;è‡ªå»ºé‡‘é‘°ç®¡ç†æœ€ä½³å¯¦è¸&#34;&gt;è‡ªå»ºé‡‘é‘°ç®¡ç†æœ€ä½³å¯¦è¸&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Che Chia Chang&lt;/a&gt; | &lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vault éµäººè³½ workshop&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  s
æ¨™é¡Œæœ‰ç¨å¾®ä¿®æ”¹
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;about me&#34; srcset=&#34;
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/about-me_hu0533df8c600b6ebf5e775c57536fef00_311608_e417eec7e7a8490233a5f244ea106c42.webp 400w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/about-me_hu0533df8c600b6ebf5e775c57536fef00_311608_12a09867edd8370d5a4cd5564f097279.webp 760w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/about-me_hu0533df8c600b6ebf5e775c57536fef00_311608_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2023-09-26-devopsday-2023-vault/about-me_hu0533df8c600b6ebf5e775c57536fef00_311608_e417eec7e7a8490233a5f244ea106c42.webp&#34;
               width=&#34;760&#34;
               height=&#34;375&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/zh-hant/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;About Me&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;

&lt;section data-noprocess data-shortcode-slide
  
      
      data-background-image=&#34;background.jpg&#34;
  &gt;

&lt;h3 id=&#34;outline&#34;&gt;Outline&lt;/h3&gt;
&lt;h3 id=&#34;from-dev-to-prod-ready&#34;&gt;from dev to prod-ready&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;terraform deployment IaC
&lt;ul&gt;
&lt;li&gt;on aws / azure / gcp / k8s&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é–‹å§‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;terraform configuration IaC
&lt;ul&gt;
&lt;li&gt;IaC everything
&lt;ul&gt;
&lt;li&gt;secret backends / auth method / role / policy / audit &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·¥ä½œæµç¨‹è‡ªå‹•åŒ– gitflow / tested / automation&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  manage vault infra &amp;amp; vault configuration from a aspect of devops
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;vault-åŸºç¤çš„å­¸ç¿’è³‡æº&#34;&gt;Vault åŸºç¤çš„å­¸ç¿’è³‡æº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1iex9lm89OCIR8IAoD1RPe4vcW--bcKBmMHoixDybqP8/edit?usp=sharing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2023-05-10 é›²ç«¯åœ°ç«¯é€šåƒçš„ç§é‘°ç®¡ç†å¹³å°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2023 éµäººè³½: vault 10- day workshop&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/4057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2021 éµäººè³½: terraform 30 day workshop&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/vault-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¯„ä¾‹ Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŒä¸€æ™‚é–“ï¼ŒVault + Kubernetes è«‹å‡ºé–€å°é¢DEæœƒè­°å®¤&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ä¸æœƒè¬› vault çš„åŸºç¤æ“ä½œï¼Œä½†å¦‚æœä½ éœ€è¦å­¸ç¿’è³‡æºï¼Œä½ å¯ä»¥ä¾†é€™é‚Šæ‰¾
ç¬¬ä¸€å€‹ google slides æ˜¯æˆ‘åœ¨å…¶ä»–å ´åˆçš„æ¼”è¬›ï¼Œé©åˆç¬¬ä¸€æ¬¡æ¥è§¸ vaultï¼Œæˆ–æ˜¯æ­£åœ¨è©•ä¼°æ˜¯å¦è¦å°å…¥ vault çš„åœ˜éšŠ&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒå€‹ä»Šå¹´çš„ ithome 2023éµäººè³½ï¼Œæˆ‘å¯«çš„å…§å®¹å°±æ˜¯ vault workshopï¼Œé›–ç„¶å¯«åˆ°ç¬¬åç¯‡å°±å› æ•…åœæ›´ï¼Œä½†å‰é¢ 1-8 ç¯‡å‰›å¥½æ˜¯ vault æ“ä½œåŸºç¤ï¼Œä½¿ç”¨ chatgpt ç¿»è­¯ vault official tutorialï¼Œä¹Ÿæ˜¯é©åˆç¬¬ä¸€æ¬¡ä½¿ç”¨ vault çš„äºº&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰å€‹æ˜¯å¦‚æœæ²’æ¥è§¸é infrastructure as code IaCï¼Œé€™å€‹ä¹Ÿæ˜¯éµäººè³½çš„ 30 day workshopï¼Œé€™å€‹æœ‰å®Œè³½ä½³ä½œ&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;production-deploy-checklisthttpsdeveloperhashicorpcomvaulttutorialskuberneteskubernetes-raft-deployment-guideproduction-deployment-checklist&#34;&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-raft-deployment-guide#production-deployment-checklist&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;production deploy checklist&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;End-to-End TLS&lt;/li&gt;
&lt;li&gt;Single Tenancy&lt;/li&gt;
&lt;li&gt;Enable Auditing&lt;/li&gt;
&lt;li&gt;Immutable Upgrades&lt;/li&gt;
&lt;li&gt;Upgrade Frequently&lt;/li&gt;
&lt;li&gt;Restrict Storage Access&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;é€²å…¥ production å‰çš„ç¶­é‹å•é¡Œ&lt;/p&gt;
&lt;p&gt;vault å®˜æ–¹å»ºè­°çš„ prod checklist
å¤§å¤šéœ€è¦å®šæœŸæ›´æ–°ï¼Œç¶­è­·ï¼Œè€Œéä¸€å‹æ°¸é€¸ä¸€æ¬¡æ€§ä½œæ¥­&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ end-to-end TLS certificate éœ€è¦ç®¡ç†èˆ‡æ›´æ–°&lt;/p&gt;
&lt;p&gt;auditing å° vault çš„å­˜å–ç´€éŒ„éœ€è¦å®‰å…¨çš„è¼¸å‡ºï¼Œä¸¦ä¸”èƒ½å¤ æª¢æ ¸ã€‚è¨­å®šåšä¸€æ¬¡å°±å¯ä»¥ç”Ÿæ•ˆã€‚ä½†æ˜¯å¯¦å‹™ä¸Šæœªä¾†æœƒéœ€è¦ä¸æ–·çš„æ ¹æ“šå¤–éƒ¨ç¨½æ ¸éœ€æ±‚èª¿æ•´&lt;/p&gt;
&lt;p&gt;immutable upgrades æŒ‡çš„æ˜¯ç•¶ä½ ä½¿ç”¨ vault server èˆ‡ storage backendï¼Œvault server æœ¬èº«æ˜¯ immutable çš„ï¼Œä½ å¯ä»¥è‡ªå·±ä½¿ç”¨ official binary build VM Image (ex. aws ami)ï¼Œæˆ–æ˜¯é€é container image release ä¾†æ›´æ–°&lt;/p&gt;
&lt;p&gt;upgrade frequentlyï¼Œä½†è¦åšçš„å®‰å…¨ï¼Œè€Œä¸”æœ‰æ•ˆç‡ï¼Œæœ€å¥½æ˜¯åšåˆ°åŠè‡ªå‹•åŒ–æˆ–æ˜¯å…¨è‡ªå‹•åŒ–ï¼Œå¦‚æœæ²’æœ‰ IaC æœƒæ¯”è¼ƒè€—å·¥&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;infrastructure-as-code&#34;&gt;Infrastructure as Code&lt;/h2&gt;
&lt;p&gt;å°å…¥ IaC ï¼Œåšåˆ°é »ç¹ä¸”å®‰å…¨çš„ vault æ›´æ–°ï¼Œä½†åŒæ™‚åˆè¦æœ‰æ•ˆç‡ç”šè‡³å…¨è‡ªå‹•åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;multiple env: dev, stag, prod&lt;/li&gt;
&lt;li&gt;programable / reusable: æ¨™æº–åŒ–ï¼Œå¯é‡è¤‡ä½¿ç”¨çš„ code&lt;/li&gt;
&lt;li&gt;tested infrastructure&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;ä»¥ vault ç‚ºç›®æ¨™
ç¶­é‹ vault çš„ç¬¬ä¸€ç›®æ¨™ï¼šå®‰å…¨ç¬¬ä¸€ï¼Œä¸æ±‚é«˜æ•ˆèƒ½ï¼Œä½†æ˜¯è¿½æ±‚å®‰å…¨
æ˜¯æˆ‘å€‘è¦å°‡ deploy / release / upgrade vault ä¸­çš„é¢¨éšªé™åˆ°æœ€ä½&lt;/p&gt;
&lt;p&gt;infra: å‡ç´š vault ç‰ˆæœ¬ï¼Œèª¿æ•´ VM / containerï¼Œèª¿æ•´ load balancerï¼Œé™¤éŒ¯
config: æ›´æ”¹ auth-method / policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;policy å®¹æ˜“æ”¹å£ä½†ç„¡æ³•åŠæ™‚ç™¼ç¾ï¼Œè¦ç”¨æ™‚æ‰ç™¼ç¾æ¬Šé™å£äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å¦‚ä½•é–‹å§‹-iac-for-vault&#34;&gt;å¦‚ä½•é–‹å§‹ IaC for Vault&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;immutable Vault server&lt;/li&gt;
&lt;li&gt;storage backend&lt;/li&gt;
&lt;li&gt;load balancer&lt;/li&gt;
&lt;li&gt;security group / firewall rule&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  IaC å¥½æ£’ï¼Œé‚£æœ‰æ²’æœ‰ä»€éº¼è³‡æºå¯ä»¥å¹«åŠ©æˆ‘å€‘é–‹å§‹ deploy IaC Vault
ç­”æ¡ˆæ˜¯æœ‰çš„
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/deliver-iac_hu0533df8c600b6ebf5e775c57536fef00_243366_9f383f9419bbc426efb073535d07bb90.webp 400w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/deliver-iac_hu0533df8c600b6ebf5e775c57536fef00_243366_e189cd499d567e542a61c269d1655dda.webp 760w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/deliver-iac_hu0533df8c600b6ebf5e775c57536fef00_243366_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2023-09-26-devopsday-2023-vault/deliver-iac_hu0533df8c600b6ebf5e775c57536fef00_243366_9f383f9419bbc426efb073535d07bb90.webp&#34;
               width=&#34;760&#34;
               height=&#34;415&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/&lt;/a&gt;&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;deploy-on-public-cloud&#34;&gt;Deploy on public cloud&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hashicorp/terraform-aws-vault&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault-starter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hashicorp/terraform-aws-vault-starter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-azurerm-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hashicorp/terraform-azurerm-vault&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/terraform-google-modules/terraform-google-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/terraform-google-modules/terraform-google-vault&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  åœ¨å…¬æœ‰é›² deploy Vaultï¼Œé›²æœå‹™å•†æœ‰æä¾›æ—¢æœ‰çš„terraform module
ä¸ä¸€å®šè¦ç…§å–®å…¨æ”¶ï¼Œå¯ä»¥è©¦è‘—æ¶èµ·æ¸¬è©¦ç’°å¢ƒï¼Œç„¶å¾Œèª¿æ•´terraform moduleï¼Œæˆç‚ºé©åˆè‡ªå·±ç”¢å“çš„æ¶æ§‹
èª¿æ•´æ¶æ§‹éœ€è¦è€ƒé‡çš„é»ï¼Œåº•ä¸‹åˆ†æ
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;deploy-terraform-aws-vaulthttpsgithubcomhashicorpterraform-aws-vault&#34;&gt;Deploy &lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-aws-vault&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://github.com/hashicorp/terraform-aws-vault/blob/master/_docs/architecture.png?raw=true&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  hashicorp å®˜æ–¹æä¾›çš„ terraform-aws-vault æ˜¯ä¸€å€‹ä¸éŒ¯çš„é–‹å§‹
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;terraform-aws-vaulthttpsgithubcomhashicorpterraform-aws-vault&#34;&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-aws-vault&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ELB -&amp;gt; AWS Autoscaling Group -&amp;gt; EC2&lt;/li&gt;
&lt;li&gt;Backend: consul cluster&lt;/li&gt;
&lt;li&gt;Vault AMI&lt;/li&gt;
&lt;li&gt;security group&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault/blob/master/test/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tested&lt;/a&gt; by hashicorp with &lt;a href=&#34;https://github.com/gruntwork-io/terratest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terratest&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  goto &lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hashicorp/terraform-aws-vault&lt;/a&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;terraform-aws-vaulthttpsgithubcomhashicorpterraform-aws-vault-1&#34;&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-aws-vault&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/terraform-aws-vault_hu0533df8c600b6ebf5e775c57536fef00_310936_ae456b396f746fd2b64cf6415e38c5df.webp 400w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/terraform-aws-vault_hu0533df8c600b6ebf5e775c57536fef00_310936_c450b16c6a48d50aa7bc746acdb4b8a6.webp 760w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/terraform-aws-vault_hu0533df8c600b6ebf5e775c57536fef00_310936_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2023-09-26-devopsday-2023-vault/terraform-aws-vault_hu0533df8c600b6ebf5e775c57536fef00_310936_ae456b396f746fd2b64cf6415e38c5df.webp&#34;
               width=&#34;760&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;å¦‚ä½•ä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥åƒè€ƒ main.tf ç¯„ä¾‹&lt;/li&gt;
&lt;li&gt;å¯ä»¥æª¢è¦– ./modules å…§èªªæ˜é€æ­¥æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;terraform-aws-vault-starterhttpsgithubcomhashicorpterraform-aws-vault-starter&#34;&gt;&lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault-starter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-aws-vault-starter&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ELB -&amp;gt; AWS Autoscaling Group -&amp;gt; EC2&lt;/li&gt;
&lt;li&gt;security group&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/concepts/integrated-storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Integrated storage (raft)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  goto &lt;a href=&#34;https://github.com/hashicorp/terraform-aws-vault-starter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hashicorp/terraform-aws-vault-starter&lt;/a&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;integrated-storage&#34;&gt;Integrated storage&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/internals/integrated-storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;integrated-storage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Raft Consensus protocol
&lt;ul&gt;
&lt;li&gt;å‡ºincidentè¦æœ‰è¾¦æ³•è§£&lt;/li&gt;
&lt;li&gt;stateful server&lt;/li&gt;
&lt;li&gt;å‚™ä»½ï¼Œç®¡ç†(è³‡æ–™é·ç§») util å·¥å…·æœªå¿…å¤ æˆç†Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¸ä¸€å€‹æœƒç¶­è­·çš„&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/configuration/storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;storage&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/configuration/storage/dynamodb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DynamoDB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/configuration/storage/mysql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MySQL&lt;/a&gt; / &lt;a href=&#34;https://developer.hashicorp.com/vault/docs/configuration/storage/postgresql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  æ³¨æ„storageæ˜¯å¦èƒ½å¤ ç‚ºç¶­è­·ï¼Œé‡å•Ÿï¼Œå‚™ä»½
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;on-kubernetes&#34;&gt;On Kubernetes&lt;/h2&gt;
&lt;p&gt;argocd + vault helm chart&lt;/p&gt;
&lt;p&gt;server èˆ‡ injector å»ºè­°åˆ†é–‹å…©å€‹ argocd applicatoin / helm releaseç¨ç«‹deploy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hashicorp/vault-helm/blob/main/values.yaml#L357&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;server&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;é¸ä¸€å€‹æœƒç¶­è­·çš„&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/configuration/storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;storage backend&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hashicorp/vault-helm/blob/main/values.yaml#L46&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;injector&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;goto &lt;a href=&#34;https://github.com/hashicorp/vault-helm/blob/main/values.yaml#L357&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hashicorp/vault-helm/blob/main/values.yaml#L357&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„server æ˜¯å¦ ha&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;deploy-on-kuberneteshttpsdeveloperhashicorpcomvaulttutorialskuberneteskubernetes-raft-deployment-guide&#34;&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-raft-deployment-guide&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deploy On Kubernetes&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;warning&#34; srcset=&#34;
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/k8s-security-warning_hu0533df8c600b6ebf5e775c57536fef00_141847_8f5dde8ddcc13e3e54037d2244da90ac.webp 400w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/k8s-security-warning_hu0533df8c600b6ebf5e775c57536fef00_141847_e8c6254ba1ebf4ad920e34f8d89ffe5d.webp 760w,
               /zh-hant/slides/2023-09-26-devopsday-2023-vault/k8s-security-warning_hu0533df8c600b6ebf5e775c57536fef00_141847_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/slides/2023-09-26-devopsday-2023-vault/k8s-security-warning_hu0533df8c600b6ebf5e775c57536fef00_141847_8f5dde8ddcc13e3e54037d2244da90ac.webp&#34;
               width=&#34;760&#34;
               height=&#34;229&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;secure your k8s&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;goto &lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;FAQ: on VM or on K8s?
å•é¡Œä¸æ˜¯ vault åœ¨ VM ä¸Šå®‰å…¨ï¼Œé‚„æ˜¯åœ¨ k8s ä¸Šå®‰å…¨
è€Œæ˜¯åœ˜éšŠèƒ½ä¸èƒ½ secure åº•ä¸‹çš„ infraï¼Œå¦‚æœç†Ÿ VM å°±æœƒè¦ºå¾— VM å¥½åš
secure k8s æ˜¯ VM + k8s éƒ½è¦&lt;/p&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å›åˆ°-outline-prod-ready&#34;&gt;å›åˆ° Outline: prod-ready&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;terraform configuration IaC
&lt;ul&gt;
&lt;li&gt;auth method / config / role&lt;/li&gt;
&lt;li&gt;secret mounts&lt;/li&gt;
&lt;li&gt;policy
&lt;ul&gt;
&lt;li&gt;team / people&lt;/li&gt;
&lt;li&gt;application / service account&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;audit log&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;vault-configuration-iac&#34;&gt;Vault Configuration IaC&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;VCS / PR reviewed&lt;/li&gt;
&lt;li&gt;well-formed / linted / no-typo&lt;/li&gt;
&lt;li&gt;multiple env: dev, stag, prod&lt;/li&gt;
&lt;li&gt;programable / reusable: æ¨™æº–åŒ–ï¼Œå¯é‡è¤‡ä½¿ç”¨çš„ code&lt;/li&gt;
&lt;li&gt;tested
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ç‚º terraform code å¯«æ¸¬è©¦&lt;/li&gt;
&lt;li&gt;å¯ä»¥å¯«æ•´åˆæ¸¬è©¦è…³æœ¬æ¸¬è©¦ vault dev server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;automation&lt;/li&gt;
&lt;li&gt;auditable&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  &lt;p&gt;version control æœ‰å¤šé‡è¦ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰ / æ²’æœ‰ review çš„ code å“è³ªï¼Œå¤©å·®åœ°é &lt;/li&gt;
&lt;li&gt;åˆ†äº«åœ˜éšŠçŸ¥è­˜ï¼Œåˆ†äº«è®Šæ›´è³‡è¨Š&lt;/li&gt;
&lt;li&gt;é¿å…æœ€é›·çš„åŒäº‹å‡ºåŒ…ï¼Œå…¨ team çš„æ•ˆèƒ½ç“¶é ¸&lt;/li&gt;
&lt;li&gt;change management å°æ–¼ vault å…§çš„çš„æ›´æ”¹è¦æœ€åš´æ ¼æ§åˆ¶
&lt;ul&gt;
&lt;li&gt;æ²’æœ‰ã€èª’æ˜¯èª°æ”¹äº†é€™å€‹æˆ‘æ€éº¼ä¸çŸ¥é“ã€é€™å›äº‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Linter / formated æ˜¯å·¥ä½œæ•ˆç‡çš„æ ¹æœ¬&lt;/p&gt;
&lt;p&gt;å¤šç’°å¢ƒæ¸¬è©¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰å®‰å…¨çš„æ¸¬è©¦ç’°å¢ƒï¼Œæ‰èƒ½ä¿ƒé€²åœ˜éšŠå‰µæ–°&lt;/li&gt;
&lt;li&gt;æœ‰ / æ²’æœ‰ ç¶“éå®Œæ•´ç’°å¢ƒæ¸¬è©¦çš„ release å“è³ªï¼Œå¤©å·®åœ°é &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Programable / Reusable&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;variable / for loop&lt;/li&gt;
&lt;li&gt;reusable module / don&amp;rsquo;t repeat your self&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;tested policy code&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;policy as code&lt;/li&gt;
&lt;li&gt;terratest&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;automation&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gitflow&lt;/li&gt;
&lt;li&gt;secured admin access only to workflow. developer don&amp;rsquo;t have admin access.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;auditable&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;audit in code / review&lt;/li&gt;
&lt;li&gt;live server generate audit log&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨ç¨½æ ¸&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;hashicorp-official-tutorialhttpsdeveloperhashicorpcomvaulttutorialspoliciespolicieswrite-a-policy&#34;&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/policies/policies#write-a-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hashicorp official tutorial&lt;/a&gt;&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tee admin-policy.hcl &amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Read system health check
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &amp;#34;sys/health&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  capabilities = [&amp;#34;read&amp;#34;, &amp;#34;sudo&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# List existing policies
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &amp;#34;sys/policies/acl&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  capabilities = [&amp;#34;list&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  configure vault policy with CLI
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;hashicorp-official-tutorialhttpsdeveloperhashicorpcomvaulttutorialspoliciespolicieswrite-a-policy-1&#34;&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/policies/policies#write-a-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hashicorp official tutorial&lt;/a&gt;&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy write admin admin-policy.hcl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy read admin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  CLI ç®¡ç†å¾ˆä¸æ–¹ä¾¿
æ²’æœ‰ aggregated list view
æŸ¥éŒ¯æ™‚éœ€è¦è€—è²»å¤§é‡ api call åˆ—å‡º policy æŸ¥è¡¨
é€é IaC sync policy code to server
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;how-to-use&#34;&gt;How to use&lt;/h2&gt;
&lt;p&gt;prerequisites: vault, terraform, terragrunt&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:chechiachang/vault-playground.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd vault-playground/usage/03-terraform-lives/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  terraform èˆ‡ terragrunt æˆ‘çš„éƒ¨è½æ ¼ä¸Šéƒ½æœ‰è¨±å¤šä»‹ç´¹æ–‡ç« ï¼Œithome éµäººè³½ä¹Ÿæœ‰ 30day workshop
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;vcs--pr-review&#34;&gt;VCS &amp;amp; PR review&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;local lint with &lt;a href=&#34;https://github.com/antonbabenko/pre-commit-terraform#terraform_fmt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;git pre-commit hook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PR
&lt;ul&gt;
&lt;li&gt;lint check&lt;/li&gt;
&lt;li&gt;pipeline module test &lt;code&gt;terraform test&lt;/code&gt; on github action&lt;/li&gt;
&lt;li&gt;integration test against vault dev server&lt;/li&gt;
&lt;li&gt;review&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;merge / automation
&lt;ul&gt;
&lt;li&gt;apply to dev environment automatically&lt;/li&gt;
&lt;li&gt;release candidate tag will apply to stag automatically&lt;/li&gt;
&lt;li&gt;release tag will push to pre-production and production&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;multiple-environment&#34;&gt;Multiple environment&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;dev -&amp;gt; stag -&amp;gt; prod ç’°å¢ƒå¾ˆæ¥è¿‘
&lt;ul&gt;
&lt;li&gt;IaC + config as code&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ­è¨­æ–°ç’°å¢ƒåªéœ€1åˆ†é˜(VM)ï¼Œç”šè‡³æ•¸ç§’(container)ï¼Œå¯ä»¥é€²è¡Œå¤§é‡çš„æ¸¬è©¦&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;test&#34;&gt;Test&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;IaC code å¯ä»¥ä½¿ç”¨ &lt;code&gt;terraform test&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;config as code å¯ä»¥ä½¿ç”¨ &lt;code&gt;terraform test&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;live infrastructure å¯ä»¥ä½¿ç”¨ terratest&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;test-examplehttpsgithubcomchechiachangvault-playgroundtreemasterusage03-terraform-modulessecret_backendkv_v2&#34;&gt;Test &lt;a href=&#34;https://github.com/chechiachang/vault-playground/tree/master/usage/03-terraform-modules/secret_backend/kv_v2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Example&lt;/a&gt;&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;resource &amp;#34;test_assertions&amp;#34; &amp;#34;main&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  component = &amp;#34;main&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  equal &amp;#34;mount_path&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    description = &amp;#34;default mount_path is ${local.mount_path}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    got         = local.mount_path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    want        = local.mount_path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  equal &amp;#34;max_versions&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    description = &amp;#34;default max_versions is 10&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    got         = local.max_versions
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    want        = 10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  equal &amp;#34;delete_version_after&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    description = &amp;#34;default delete_version_after is 10&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    got         = local.delete_version_after
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    want        = 12600
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;aside class=&#34;notes&#34;&gt;
  é€™å€‹ module åªæ˜¯ä¸€å€‹ kv engineï¼Œæ‰€ä»¥éš¨æ‰‹å¯«äº†ä¸€å€‹ç°¡å–®çš„ test
Demo æˆ‘åœ¨æœ¬åœ°éš¨æ‰‹è·‘ä¸€ä¸‹æ¸¬è©¦
ç•¶ä½ ä½¿ç”¨ terraform æ™‚é–“å¤ ä¹…ï¼Œä½¿ç”¨è¦æ¨¡è¶Šå¤§æ™‚ï¼Œæœƒæœ‰å¾©é›œçš„ moduleï¼Œé€™æ™‚æœ‰å¯«æ¸¬è©¦çš„ module å°±æ˜¯å¤©å·®åœ°é 
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;policy-as-code-for-vault&#34;&gt;Policy as code for vault&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;vault ACL æ˜¯åŸºæ–¼ path è¨­å®šæ¬Šé™&lt;/li&gt;
&lt;li&gt;ç•¶policyæœ‰æˆåƒä¸Šè¬æ¢ï¼Œå½¼æ­¤å¯èƒ½æœƒ conflict&lt;/li&gt;
&lt;li&gt;policy çš„ policy
&lt;ul&gt;
&lt;li&gt;é«˜é«˜å±¤æ¬¡çš„(å…¬å¸çš„è³‡å®‰æ”¿ç­–)é€é policy as code å®šç¾©&lt;/li&gt;
&lt;li&gt;å¯«åˆ° vault policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.openpolicyagent.org/docs/latest/#1-download-opa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Policy Agent (OPA)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/policies/sentinel#endpoint-governing-policies-egps&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sentinel(Vault Enterprise): EGP&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;gitflow--automation&#34;&gt;Gitflow &amp;amp; automation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;PR
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.runatlantis.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;atlantis&lt;/a&gt; run terraform plan&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;PR merged&lt;/li&gt;
&lt;li&gt;PR apply
&lt;ul&gt;
&lt;li&gt;apply to dev environment automatically with gitflow&lt;/li&gt;
&lt;li&gt;release candidate tag will apply to stag automatically&lt;/li&gt;
&lt;li&gt;release tag will push to pre-production and production&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
  goto &lt;a href=&#34;https://www.runatlantis.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.runatlantis.io/&lt;/a&gt;
PR comment ä¸‹æœƒæœ‰é‡å° dev environemtn plan çš„çµæœ
ä½¿ç”¨ github webhookï¼Œå¯ä»¥ç›´æ¥åœ¨ PR approved å¾Œï¼Œå‘½ä»¤ atlantis ç›´æ¥ apply åˆ° dev server
é¿å…ä½¿ç”¨å·¥ç¨‹å¸« local machine å­˜å–é ç«¯ç’°å¢ƒï¼Œé¿å…å·¥ç¨‹å¸«å–å¾—ç®¡ç†å“¡æ¬Šé™ï¼Œé¿å…äººç‚ºæ“ä½œå¤±èª¤é€ æˆçš„ incident
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ IaC deploy vaultï¼Œä¸¦ä¾ç…§åœ˜éšŠéœ€æ±‚é€æ­¥èª¿æ•´ infra&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ IaC ç®¡ç† vault å…§éƒ¨ä¸€åˆ‡ config&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;questions&#34;&gt;Questions?&lt;/h1&gt;
</description>
    </item>
    
    <item>
      <title>Vault Workshop 10: Deploy with Docker</title>
      <link>https://chechia.net/zh-hant/post/2023-09-21-vault-workshop-deploy-on-kubernetes/</link>
      <pubDate>Thu, 14 Sep 2023 06:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-21-vault-workshop-deploy-on-kubernetes/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-09-deploy-with-docker&#34;&gt;Day 09: Deploy with Docker&lt;/h1&gt;
&lt;h3 id=&#34;local-with-docker&#34;&gt;Local with Docker&lt;/h3&gt;
&lt;h3 id=&#34;minikube&#34;&gt;minikube&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;r=https://api.github.com/repos/kubernetes/minikube/releases
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -LO $(curl -s $r | grep -o &amp;#39;http.*download/v.*beta.*/minikube-darwin-arm64&amp;#39; | head -n1)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo install minikube-darwin-arm64 /usr/local/bin/minikube
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¦‚ä½•é¸æ“‡-vm-or-docker-or-kubernetes&#34;&gt;å¦‚ä½•é¸æ“‡ VM or Docker or Kubernetes&lt;/h3&gt;
&lt;p&gt;å‡è­°é¡Œ&lt;/p&gt;
&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/install&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¾ˆé‡è¦ï¼šä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 09: Vault HA</title>
      <link>https://chechia.net/zh-hant/post/2023-09-20-vault-workshop-ha-docker/</link>
      <pubDate>Thu, 14 Sep 2023 05:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-20-vault-workshop-ha-docker/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-09-deploy-with-docker&#34;&gt;Day 09: Deploy with Docker&lt;/h1&gt;
&lt;h3 id=&#34;vault-configuration&#34;&gt;Vault configuration&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/install&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¾ˆé‡è¦ï¼šä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 08: Vault in Docker and Initialization</title>
      <link>https://chechia.net/zh-hant/post/2023-09-19-vault-workshop-docker-and-initialization/</link>
      <pubDate>Thu, 14 Sep 2023 04:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-19-vault-workshop-docker-and-initialization/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-08-vault-in-docker-and-initialization&#34;&gt;Day 08: Vault in Docker and Initialization&lt;/h1&gt;
&lt;h3 id=&#34;vault-in-container&#34;&gt;Vault in container&lt;/h3&gt;
&lt;p&gt;å‰å¹¾å¤©æˆ‘å€‘ä½¿ç”¨ vault dev Server ä¾†å•Ÿç”¨æ¸¬è©¦ç”¨çš„ Vault serverã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ production ç’°å¢ƒæˆ‘å€‘ä¸æœƒä½¿ç”¨ dev Serverã€‚Vault æä¾›è¨±å¤šå®‰è£æ–¹æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨ binary ç›´æ¥å®‰è£åœ¨VMä¸Š&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥é€é hashicorp/vault official docker imageï¼Œåœ¨container ç’°å¢ƒä¸­åŸ·è¡Œ&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯ä½¿ç”¨ hashicorp official helm chartï¼Œå®‰è£åœ¨kuberntesä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½¿ç”¨ç¯„ä¾‹-repository&#34;&gt;ä½¿ç”¨ç¯„ä¾‹ repository&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ç­†è€…æº–å‚™çš„ç¯„ä¾‹ repository &lt;a href=&#34;https://github.com/chechiachang/vault-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:chechiachang/vault-playground.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; deploy/00-docker-dev/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤å•Ÿå‹• vault in docker&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¦ä½¿ç”¨ -v flag ä¾†æ›è¼‰ ./config/ volume åˆ° container ä¸­çš„ /vault/config.d/&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker run --cap-add&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;IPC_LOCK &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --volume ./vault/config/:/vault/config.d &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --volume ./vault/file/:/vault/file &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --volume ./vault/logs/:/vault/logs &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -p 8200:8200 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --name vault_1 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -d &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  hashicorp/vault:1.14.3 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  vault server -config&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/vault/config.d/vault.hcl
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œä½¿ç”¨ docker logs æŒ‡ä»¤æª¢è¦– vault server log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker logs -f vault_1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; Vault server configuration:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Administrative Namespace:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             Api Address: https://0.0.0.0:8200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                     Cgo: disabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Cluster Address: https://0.0.0.0:8201
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Environment Variables: GODEBUG, GOTRACEBACK, HOME, HOSTNAME, NAME, PATH, PWD, SHLVL, VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Go Version: go1.20.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Listener 1: tcp &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;addr: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0:8200&amp;#34;&lt;/span&gt;, cluster address: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0:8201&amp;#34;&lt;/span&gt;, max_request_duration: &lt;span class=&#34;s2&#34;&gt;&amp;#34;1m30s&amp;#34;&lt;/span&gt;, max_request_size: &lt;span class=&#34;s2&#34;&gt;&amp;#34;33554432&amp;#34;&lt;/span&gt;, tls: &lt;span class=&#34;s2&#34;&gt;&amp;#34;disabled&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               Log Level:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   Mlock: supported: true, enabled: &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           Recovery Mode: &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 Storage: file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 Version: Vault v1.14.3, built 2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             Version Sha: &lt;span class=&#34;nv&#34;&gt;56debfa71653e72433345f23cd26276bc90629ce&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; Vault server started! Log data will stream in below:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:38:25.914Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  proxy environment: &lt;span class=&#34;nv&#34;&gt;http_proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;https_proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;no_proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:38:25.920Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: Initializing version &lt;span class=&#34;nb&#34;&gt;history&lt;/span&gt; cache &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; core
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ æœƒç™¼ç¾ï¼Œvault server ä¸æ˜¯ä»¥ dev server çš„ç‹€æ…‹å•Ÿå‹•çš„ï¼Œéœ€è¦é€²è¡Œé¡å¤–çš„åˆå§‹åŒ–è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æª¢æŸ¥ vault status&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault status
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œé¡¯ç¤ºä¸€å€‹ä¸Šæœªåˆå§‹åŒ–çš„ vault server èˆ‡å…¶ storage backend &amp;ldquo;filesyste&amp;rdquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥åœ¨ ./vault/config/vault.hcl ä¸Šçœ‹åˆ°æˆ‘å€‘ä½¿ç”¨æ–°çš„ Storage Backend &amp;ldquo;file&amp;rdquo; è¨­å®š&lt;/li&gt;
&lt;li&gt;vault server çš„ storage backend ç›®å‰æ˜¯ sealed ç‹€æ…‹
&lt;ul&gt;
&lt;li&gt;ä¸æ˜¯ vault server sealedï¼Œè€Œæ˜¯æ²’æœ‰æä¾› vault server åˆå§‹åŒ–è¨­å®š / unseal keysï¼Œæ‰€ä»¥ vault server ç„¡æ³•è§£å¯† storage backend&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Seal Type          shamir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initialized        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sealed             &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Total Shares       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Threshold          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Progress    0/0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Nonce       n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version            1.14.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Build Date         2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Storage Type       file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HA Enabled         &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;storage-backend-filesystem&#34;&gt;Storage Backend: filesystem&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/configuration/storage/filesystem&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/configuration/storage/filesystem&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;filesystem storage backendå°‡ Vault çš„è³‡æ–™å­˜å„²åœ¨æ–‡ä»¶ç³»çµ±ä¸Šï¼Œä½¿ç”¨æ¨™æº–çš„ç›®éŒ„çµæ§‹ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒå¯ä»¥ç”¨æ–¼æŒä¹…çš„Single Serveræƒ…æ³ï¼Œæˆ–è€…åœ¨æœ¬åœ°é–‹ç™¼æ™‚ï¼Œè€ä¹…æ€§ä¸æ˜¯é—œéµå•é¡Œçš„æƒ…æ³ä¸‹ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;filesystem storage backend ä¸æ”¯æ´é«˜å¯ç”¨æ€§ - æª”æ¡ˆç³»çµ±å¾Œç«¯ä¸æ”¯æ´é«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;filesystem storage backend ç”±HashiCorp å®˜æ–¹æ”¯æ´ - æª”æ¡ˆç³»çµ±å¾Œç«¯æ˜¯ç”± HashiCorp å®˜æ–¹æ”¯æ´ç¶­è­·çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆå§‹åŒ–-vault&#34;&gt;åˆå§‹åŒ– Vault&lt;/h3&gt;
&lt;p&gt;åˆå§‹åŒ–æ˜¯é…ç½® Vault çš„éç¨‹ã€‚åƒ…å°ç¬¬ä¸€æ¬¡ä½¿ç”¨åœ¨ Vault server ä¸Šçš„ Backend ä¸ŠåŸ·è¡Œä¸€æ¬¡ã€‚åœ¨é«˜å¯ç”¨(HA)æ¨¡å¼ä¸‹é‹è¡Œæ™‚ï¼Œé€™åƒ…åœ¨æ¯å€‹å¢é›†(Vault Cluster)ä¸­åŸ·è¡Œä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯å°Serverã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆå§‹åŒ–æœŸé–“ï¼Œå°‡ç”ŸæˆåŠ å¯†é‡‘é‘°ã€å‰µå»º unseal keysï¼Œä¸¦å‰µå»º init root tokenã€‚&lt;/p&gt;
&lt;p&gt;åˆå§‹åŒ–ä¸éœ€èº«ä»½é©—è­‰ï¼Œåƒ…é©ç”¨æ–¼å…¨æ–°çš„ Vaultï¼Œæœ‰è³‡æ–™å­˜åœ¨çš„ Storage Backend ç„¡æ³•ç”¨åˆå§‹åŒ–è§£é–ã€‚&lt;/p&gt;
&lt;p&gt;è¦åˆå§‹åŒ– Vaultï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator init
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key 1: 9AYJ...kNCn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key 2: RqDx...odRU
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key 3: uHUv...lws4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key 4: f+KD...aHgL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key 5: AKyF...e6vd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initial Root Token: hvs.8yU3...7esX
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Vault initialized with &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; key shares and a key threshold of 3. Please securely
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;distribute the key shares printed above. When the Vault is re-sealed,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;restarted, or stopped, you must supply at least &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; of these keys to unseal it
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;before it can start servicing requests.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Vault ä½¿ç”¨äº† 5 å€‹é‡‘é‘°ä»½é¡encryption key shareå’Œ 3 çš„ key threshold é€²è¡Œåˆå§‹åŒ–ã€‚è«‹å®‰å…¨åœ°åˆ†ç™¼ä¸Šé¢çš„é‡‘é‘°ä»½é¡ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç•¶ Vault è¢«é‡æ–°å¯†å°ã€é‡æ–°å•Ÿå‹•æˆ–åœæ­¢æ™‚ï¼Œä½ å¿…é ˆæä¾›è‡³å°‘ 3 å€‹é€™äº›é‡‘é‘°ä¾†å°å…¶é€²è¡Œè§£å°ï¼Œç„¶å¾Œå®ƒæ‰èƒ½é–‹å§‹è™•ç†è«‹æ±‚ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Vault does not store the generated root key. Without at least &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; keys to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reconstruct the root key, Vault will remain permanently sealed!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Vault ä¸å­˜å„²ç”Ÿæˆçš„æ ¹é‡‘é‘°ã€‚å¦‚æœæ²’æœ‰è‡³å°‘ 3 å€‹é‡‘é‘°ä¾†é‡å»ºæ ¹é‡‘é‘°ï¼ŒVault å°‡ä¿æŒæ°¸ä¹…å¯†å°ï¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;It is possible to generate new unseal keys, provided you have a quorum of
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;existing unseal keys shares. See &lt;span class=&#34;s2&#34;&gt;&amp;#34;vault operator rekey&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; more information.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¦‚æœä½ æœ‰è¶³å¤ çš„ç¾æœ‰è§£å°é‡‘é‘°ä»½é¡ï¼Œå‰‡å¯ä»¥ç”Ÿæˆæ–°çš„è§£å°é‡‘é‘°ã€‚æœ‰é—œæ›´å¤šä¿¡æ¯ï¼Œè«‹åƒé–± &amp;#34;vault operator rekey&amp;#34;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆå§‹åŒ–éç¨‹è¼¸å‡ºäº†å…©å€‹éå¸¸é‡è¦çš„ä¿¡æ¯ï¼šè§£å°é‡‘é‘°å’Œ init root tokenã€‚é€™æ˜¯å”¯ä¸€ä¸€æ¬¡ Vault é¡¯ç¤ºé€™äº›è³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†é€™å€‹å…¥é–€èª²ç¨‹ï¼Œè«‹å°‡é€™äº›é‡‘é‘°ä¿å­˜åœ¨æŸå€‹åœ°æ–¹ï¼Œç„¶å¾Œç¹¼çºŒé€²è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Vault backend storage èª key ä¸èªäººï¼Œè«‹æ”¶å¥½é€™äº”éš» unseal keyï¼Œæ”¾ç½®åœ¨äº”å€‹ä¸åŒå®‰å…¨çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;æœ‰ 3/5 çš„ unseal key å°±èƒ½é‡å»º encryption keyï¼Œä¹Ÿå°±æ˜¯èƒ½å¤ è§£å¯† storage backend&lt;/li&gt;
&lt;li&gt;å¯ä»¥ç”¨ 3/5 unseal key ç”¢ç”Ÿ root token &lt;code&gt;vault operator generate-root&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;æ›å¥è©±èªªï¼Œunseal key æ˜¯æ¯” root é‚„å¤§çš„è¶…ç´šç®¡ç†å“¡ key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨å¯¦éš›çš„éƒ¨ç½²æƒ…æ³ä¸‹ï¼Œä½ æ°¸é ä¸æ‡‰è©²å°‡é€™äº›é‡‘é‘°ä¿å­˜åœ¨ä¸€èµ·ã€‚
&lt;ul&gt;
&lt;li&gt;ä½ å¯èƒ½æœƒä½¿ç”¨ Vault çš„ PGP å’Œ Keybase.io æ”¯æ´ï¼Œä½¿ç”¨ä½¿ç”¨è€…çš„ PGP é‡‘é‘°åŠ å¯†æ¯å€‹è§£å°é‡‘é‘°ã€‚&lt;/li&gt;
&lt;li&gt;é€™å¯ä»¥é˜²æ­¢å–®å€‹äººæ“æœ‰æ‰€æœ‰çš„è§£å°é‡‘é‘°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;vault server logï¼Œå¯ä»¥çœ‹åˆ° vault server é–‹å§‹é€²è¡Œåˆå§‹åŒ–æµç¨‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:47:05.113Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: security barrier not initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:47:05.117Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: seal configuration missing, not initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.506Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: security barrier not initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.512Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: seal configuration missing, not initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.521Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: security barrier not initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.557Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: security barrier initialized: &lt;span class=&#34;nv&#34;&gt;stored&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;shares&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;threshold&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.589Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: post-unseal setup starting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.609Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: loaded wrapping token key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.609Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully setup plugin catalog: plugin-directory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.613Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: no mounts&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; adding default mount table
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.629Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cubbyhole &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cubbyhole/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.631Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;system &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sys/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.631Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;identity &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;identity/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.686Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;token &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;token/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.696Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  rollback: starting rollback manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.697Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: restoring leases
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.698Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  expiration: lease restore &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.713Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  identity: entities restored
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.714Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  identity: groups restored
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.720Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: usage gauge collection is disabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:28.733Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: Recorded vault version: vault &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1.14.3 upgrade &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2023-09-20 14:03:28.720230178 +0000 UTC&amp;#34;&lt;/span&gt; build &lt;span class=&#34;nv&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:29.120Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: post-unseal setup &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:29.146Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: root token generated
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:29.146Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: pre-seal teardown starting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:29.146Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  rollback: stopping rollback manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:03:29.146Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: pre-seal teardown &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥åœ¨é€™æ™‚æª¢è¦– ./vault/file è£¡é¢çš„å…§å®¹ï¼Œ./vault/file åœ¨ &lt;code&gt;vault operator init&lt;/code&gt; å‰æ˜¯ç©ºç™½çš„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls -al ./vault/file
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œå¯ä»¥çœ‹åˆ° ./vault/file å…§å·²ç¶“åˆå§‹åŒ– filesystem storage backend çš„å…§å®¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;core
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;logical
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥æª¢è¦– ./vault/file/* å…§çš„æª”æ¡ˆå…§å®¹ï¼Œæœƒç™¼ç¾å…§å®¹éƒ½æ˜¯ json ç›¸å®¹æ ¼å¼ï¼Œè€Œä¸”éƒ½ç¶“éåŠ å¯†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ­£å¸¸çš„æ¢ä»¶ä¸‹ï¼Œæ²’æœ‰ unseal key çš„äººï¼Œæ˜¯ç„¡æ³•åœ¨æœ‰æ•ˆæ™‚é–“å…§è§£é–é€™äº› filesystem ä¸­çš„å…§å®¹ï¼Œå…§å®¹é‚„æ˜¯å—åˆ°ä¿è­·&lt;/li&gt;
&lt;li&gt;é€™ä¸¦ä¸ä»£è¡¨ä½ å¯ä»¥éš¨æ„æ”¾ç½® filesystem storage backend çš„å…§å®¹
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚å°‡ä»– commit åˆ° repository ä¸­(vault-playground å·²ç¶“æ·»åŠ  .gitignore)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è«‹é¸æ“‡å®‰å…¨ï¼Œç¶“é vault è³‡å®‰åœ˜éšŠæ¸¬è©¦éçš„ backendï¼Œä¾†ä¿éšœè³‡æ–™å®‰å…¨èˆ‡å¯ç”¨ç¨‹åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;unseal&#34;&gt;Unseal&lt;/h3&gt;
&lt;p&gt;æ¯å€‹åˆå§‹åŒ–çš„ Vault Server éƒ½å§‹æ–¼å¯†å°ç‹€æ…‹ã€‚æ ¹æ“šé…ç½®ï¼ŒVault å¯ä»¥è¨ªå• storage backendï¼Œä½†å®ƒç„¡æ³•è®€å–å…¶ä¸­çš„ä»»ä½•è³‡æ–™ï¼Œå› ç‚ºå®ƒä¸çŸ¥é“å¦‚ä½•è§£å¯†å®ƒã€‚æ•™æœƒ Vault å¦‚ä½•è§£å¯†æ•¸æ“šç¨±ç‚ºè§£å°(unseal) Vaultã€‚&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡ Vault é–‹å§‹é‹è¡Œæ™‚éƒ½å¿…é ˆé€²è¡Œè§£å°ã€‚å¯ä»¥é€šé API å’Œå‘½ä»¤è¡Œä¾†åŸ·è¡Œè§£å°æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¦è§£å° Vaultï¼Œä½ å¿…é ˆæ“æœ‰è§£å°é‡‘é‘°çš„é–¾å€¼æ•¸é‡(threshold)ã€‚åœ¨ä¸Šé¢çš„è¼¸å‡ºä¸­ï¼Œè«‹æ³¨æ„ &amp;ldquo;key threshold&amp;rdquo; æ˜¯ 3ã€‚é€™æ„å‘³è‘—è¦è§£å° Vaultï¼Œä½ éœ€è¦ 5 å€‹ç”Ÿæˆçš„é‡‘é‘°ä¸­çš„ 3 å€‹ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„&lt;/p&gt;
&lt;p&gt;Vault ä¸å­˜å„²ä»»ä½•è§£å°é‡‘é‘°ç‰‡æ®µ(key share)ã€‚Vault ä½¿ç”¨ä¸€ç¨®ç¨±ç‚º Shamir&amp;rsquo;s Secret Sharing çš„ç®—æ³•ä¾†å°‡ root encryption key åˆ†æˆç‰‡æ®µ(share)ã€‚åªæœ‰æ“æœ‰thresholdæ•¸é‡çš„é‡‘é‘°ï¼Œæ‰èƒ½å°‡å…¶é‡å»ºï¼Œæœ€çµ‚è¨ªå•ä½ çš„è³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;é–‹å§‹è§£å° Vaultï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator unseal
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;will be hidden&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Seal Type          shamir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initialized        &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sealed             &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Total Shares       &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Threshold          &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Progress    1/3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Nonce       9d03a4e0-bb4f-cfd5-326b-5afb55fdce53
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version            1.14.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Build Date         2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Storage Type       file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HA Enabled         &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¹¼çºŒæ“ä½œï¼Œè¼¸å…¥3/5æŠŠ unseal key å°±å¯é †åˆ©è§£å° storage backend&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;will be hidden&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key             Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---             -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Seal Type       shamir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initialized     &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sealed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Total Shares    &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Threshold       &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version         1.14.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Build Date      2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Storage Type    file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster Name    vault-cluster-f90273e8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster ID      5ecc63c9-11eb-c384-355d-dffea2dd6484
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HA Enabled      &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server logï¼ŒæˆåŠŸè§£å°å¾Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.077Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core.cluster-listener.tcp: starting listener: &lt;span class=&#34;nv&#34;&gt;listener_address&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0.0.0.0:8201
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.078Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core.cluster-listener: serving cluster requests: &lt;span class=&#34;nv&#34;&gt;cluster_listen_address&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=[&lt;/span&gt;::&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:8201
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.089Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: post-unseal setup starting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.115Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: loaded wrapping token key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.115Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully setup plugin catalog: plugin-directory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.127Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;system &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sys/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.128Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;identity &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;identity/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.128Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cubbyhole &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cubbyhole/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.148Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: successfully mounted: &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;token &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.14.3+builtin.vault&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;token/ &lt;span class=&#34;nv&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ID: root. Path: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.154Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  rollback: starting rollback manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.154Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: restoring leases
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.156Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  expiration: lease restore &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.158Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  identity: entities restored
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.159Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  identity: groups restored
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.166Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: usage gauge collection is disabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.178Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: post-unseal setup &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T14:57:17.178Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: vault is unsealed
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;hashicorp-vault-docker&#34;&gt;Hashicorp Vault docker&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨å®¹å™¨(container) å‰éœ€è¦æŸ¥é–± image çš„å®˜æ–¹èªªæ˜ &lt;a href=&#34;https://hub.docker.com/r/hashicorp/vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hub.docker.com/r/hashicorp/vault&lt;/a&gt;ï¼Œå¹¾ä»¶äº‹æƒ…è¦æ³¨æ„&lt;/p&gt;
&lt;p&gt;Base Image æ˜¯é¸æ“‡ä½¿ç”¨ Alpineï¼Œæ¯”èµ·å…¶ä»– linux distributions å…·æœ‰ç›¸å°è¼ƒå°çš„å®‰å…¨é¢¨éšªï¼Œä½†åŠŸèƒ½è¶³å¤ ç”¨æ–¼é–‹ç™¼å’Œæ¸¬è©¦ã€‚&lt;/p&gt;
&lt;p&gt;Vault å§‹çµ‚åœ¨ dumb-init ä¸‹é‹è¡Œï¼Œå°‡ process èˆ‡ SIG å‚³éçµ¦å®¹å™¨ä¸­é‹è¡Œçš„æ‰€æœ‰processã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨çš„ Binary ç”± HashiCorp æ§‹å»ºï¼Œä¸¦ä½¿ç”¨ GPG é‡‘é‘°ç°½åï¼Œå› æ­¤ä½ å¯ä»¥é©—è­‰Binaryã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸å¸¶ä»»ä½•åƒæ•¸çš„æƒ…æ³ä¸‹é‹è¡Œ Vaultï¼Œå®¹å™¨å°‡ç‚ºä½ æä¾›ä¸€å€‹è™•æ–¼dev modeçš„ Vault Serverã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨å…¬é–‹äº†å…©å€‹å¯é¸çš„volumeï¼š&lt;/p&gt;
&lt;p&gt;/vault/logsï¼Œç”¨æ–¼å¯«å…¥ audit logã€‚é è¨­æƒ…æ³ä¸‹ï¼Œé€™è£¡ä¸æœƒå¯«å…¥ä»»ä½•å…§å®¹ï¼›å¿…é ˆåœ¨Vault config ä¸­å•Ÿç”¨æ–‡ä»¶audit backendã€‚&lt;/p&gt;
&lt;p&gt;/vault/fileï¼Œç”¨æ–¼åœ¨ä½¿ç”¨è³‡æ–™storage pluginæ™‚ï¼Œå°‡è³‡æ–™å¯«å…¥persistencyã€‚é è¨­æƒ…æ³ä¸‹ï¼Œé€™è£¡ä¸å¯«å…¥ä»»ä½•å…§å®¹ï¼ˆdev modeä½¿ç”¨ in-memory storageï¼‰ï¼›åœ¨å•Ÿå‹•å®¹å™¨ä¹‹å‰ï¼Œå¿…é ˆåœ¨ Vault çš„é…ç½®ä¸­å•Ÿç”¨æ–‡ä»¶ data storagebackendã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨åœ¨ /vault/config è¨­ç½®äº†ä¸€å€‹ Vault é…ç½®ç›®éŒ„ï¼ŒServer å°‡é€šévolumeï¼Œè¼‰å…¥é€™è£¡æ”¾ç½®çš„ä»»ä½• hcl æˆ– json config fileã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥é€šéé€šéç’°å¢ƒè®Šæ•¸ &lt;code&gt;VAULT_LOCAL_CONFIG&lt;/code&gt; å‚³éé…ç½® json ä¾†æ·»åŠ configã€‚&lt;/p&gt;
&lt;h3 id=&#34;vault-configuration&#34;&gt;Vault configuration&lt;/h3&gt;
&lt;p&gt;å¦‚åŒå‰é¢èªªæ˜ï¼Œé€é &lt;code&gt;--volume ./config/:/vault/config.d&lt;/code&gt; flag å°‡ ./config/vault.hcl è¨­å®šæª”æ¡ˆæ›è¼‰é€²å®¹å™¨ä¸­&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥æª¢è¦–ç›®å‰çš„ vault server configurationï¼Œæ˜¯ä»¥ vault.hcl æ ¼å¼è¡¨ç¤º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat ./config/vault.hcl
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œåœ¨é€™è£¡å¯ä»¥è¨­ç½® vault server çš„å•Ÿå‹•åƒæ•¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®ä¸€å€‹ listener &amp;ldquo;tcp&amp;rdquo;ï¼Œç›£è½å®¹å™¨å…§ 0.0.0.0:8200 é€²ä¾†çš„ request&lt;/li&gt;
&lt;li&gt;ç”±æ–¼ &lt;code&gt;docker run&lt;/code&gt; ä¹Ÿè¨­å®š &lt;code&gt;-p 8200:8200&lt;/code&gt; å°‡ä¸»æ©Ÿç¶²è·¯çš„ 8200 port bind åˆ°å®¹å™¨çš„ 8200 portï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ä¸»æ©Ÿç¶²è·¯ä¸­å­˜å– vaultã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ui&lt;/span&gt;            &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;disable_mlock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;api_addr&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://0.0.0.0:8200&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;default_lease_ttl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;168h&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;max_lease_ttl&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;720h&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;storage &lt;span class=&#34;s2&#34;&gt;&amp;#34;file&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/vault/file&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listener &lt;span class=&#34;s2&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;address&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0:8200&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;tls_disable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ“ä½œ-vault&#34;&gt;æ“ä½œ Vault&lt;/h3&gt;
&lt;p&gt;Vault in Docker ä½¿ç”¨èµ·ä¾†èˆ‡é€é binary åŸ·è¡Œçš„ dev server ä¸€æ¨£ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åƒç…§å‰å¹¾å¤©æ–‡ç« çš„å…§å®¹ï¼Œå° vault server é€²è¡Œæ“åšï¼Œä¹Ÿç®—æ˜¯åšå€‹ç·´ç¿’&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net kv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å¾Œé¢çš„å…§å®¹ï¼Œæˆ‘å€‘æœƒç”¨æ›´æœ‰æ•ˆç‡çš„æ–¹å¼ç®¡ç†ï¼Œè¨­å®š vault&lt;/p&gt;
&lt;h3 id=&#34;é—œé–‰-vault-container&#34;&gt;é—œé–‰ vault container&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é—œé–‰ vaultå®¹å™¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker stop vault_1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œserver æ¥å—åˆ°å¾Œæœƒé€²è¡Œ docker å°é–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&amp;gt; Vault shutdown triggered
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.627Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: marked as sealed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.627Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: pre-seal teardown starting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.627Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  rollback: stopping rollback manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.628Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: pre-seal teardown &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.628Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: stopping cluster listeners
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.628Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core.cluster-listener: forwarding rpc listeners stopped
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.641Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core.cluster-listener: rpc listeners successfully shut down
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.641Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: cluster listeners successfully shut down
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T13:06:28.641Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: vault is sealed
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å•Ÿç”¨ storage backend çš„è©±ï¼Œvault è³‡æ–™æˆ–ç•™å­˜åœ¨ storage &amp;ldquo;file&amp;rdquo; ä¸Šï¼Œé‡å•Ÿä¸æœƒå¦‚ dev server in-memory storage ä¸€æ¨£ï¼Œè¢«æ¸…ç©º&lt;/p&gt;
&lt;h3 id=&#34;vault-operator&#34;&gt;vault operator&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ vault operator æŒ‡ä»¤ä¾†åšæ›´å¤š vault cluster ç›¸é—œçš„æ“ä½œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator -h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ç”¢ç”Ÿæ–°çš„ root token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator generate-root -generate-otp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;A One-Time-Password has been generated &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; you and is shown in the OTP field.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You will need this value to decode the resulting root token, so keep it safe.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Nonce         13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Started       &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Progress      0/3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Complete      &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OTP           eYr...cMqx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OTP Length    &lt;span class=&#34;m&#34;&gt;28&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server log é¡¯ç¤ºé–‹å§‹ç”¢ç”Ÿ root&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T15:12:08.633Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: root generation initialized: &lt;span class=&#34;nv&#34;&gt;nonce&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ -otp flagï¼Œä¸¦è¼¸å…¥ unseal key&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator generate-root -otp&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Operation nonce: 13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;will be hidden&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Nonce       13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Started     &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Progress    1/3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Complete    &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŒçºŒè¼¸å…¥ 3/5 unseal keysï¼Œç›´åˆ°å–å¾— encoded token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Operation nonce: 13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;will be hidden&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Nonce            13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Started          &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Progress         3/3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Complete         &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Encoded Token    DS8B...MdGw
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ otp + encoded token ä¾†é€²è¡Œ decode&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator generate-root &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -decode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DS8B...MdGw&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -otp&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;eYr1...cMqx&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hvs.bDKG...Pnlc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server log é¡¯ç¤ºé€ç”Ÿ root å®Œæˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-20T15:15:40.541Z &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: root generation finished: &lt;span class=&#34;nv&#34;&gt;nonce&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;13ed8986-7b01-323c-0d06-2c32536fb8c1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;NOTE: ç¬¬ä¸€æŠŠ init root token é‚„æ˜¯æœ‰æ•ˆï¼ŒåŠ ä¸Šå¾Œä¾†ç”Ÿæˆçš„ç¬¬äºŒæŠŠï¼Œç¾åœ¨æœ‰å…©æŠŠå¸¸æ•ˆæœŸçš„ root token&lt;/p&gt;
&lt;h3 id=&#34;æ¸…ç©º&#34;&gt;æ¸…ç©º&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥åˆªé™¤ ./vault/file/ï¼Œå®Œå…¨æ¸…é™¤ vault server ä½¿ç”¨çš„ filesystem storage backend&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rm -rf ./vault/file/*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server æœ¬èº«å¹¾ä¹æ˜¯ç„¡ç‹€æ…‹ï¼Œæ¸…é™¤ storage backend å¾Œå°±ä»€éº¼ä¹Ÿä¸å‰©äº†&lt;/p&gt;
&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-deploy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-deploy&lt;/a&gt;
&lt;a href=&#34;https://hub.docker.com/r/hashicorp/vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hub.docker.com/r/hashicorp/vault&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¾ˆé‡è¦ï¼šä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 07: Policy &amp; approle</title>
      <link>https://chechia.net/zh-hant/post/2023-09-18-vault-workshop-policy-and-approle/</link>
      <pubDate>Thu, 14 Sep 2023 03:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-18-vault-workshop-policy-and-approle/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-07-policy--approle&#34;&gt;Day 07: Policy &amp;amp; Approle&lt;/h1&gt;
&lt;p&gt;åœ¨ Vault ä¸­ï¼Œç­–ç•¥ï¼ˆPoliciesï¼‰æ§åˆ¶è‘—ä½¿ç”¨è€…å¯ä»¥è¨ªå•çš„è³‡æºã€‚åœ¨ä¸Šä¸€ç¯‡èº«ä»½é©—è­‰ä¸­ï¼Œä½ å·²ç¶“å­¸åˆ°äº†èº«ä»½é©—è­‰æ–¹æ³•(authentication method)ã€‚è€Œé€™ä¸€ç¯€æ˜¯é—œæ–¼æˆæ¬Š(Authorization)ï¼Œä¹Ÿå°±æ˜¯åˆæ³•çš„ç”¨æˆ¶ç™»å…¥å¾Œï¼Œæ‡‰è©²èƒ½å¤ å–å¾—æ€æ¨£çš„æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨èº«ä»½é©—è­‰æ–¹é¢ï¼ŒVault æä¾›äº†å¤šç¨®å•Ÿç”¨å’Œä½¿ç”¨çš„é¸é …æˆ–æ–¹æ³•ã€‚Vault åœ¨æˆæ¬Šå’Œ policy æ–¹é¢ä¹Ÿä½¿ç”¨ç›¸åŒçš„è¨­è¨ˆã€‚æ‰€æœ‰èº«ä»½é©—è­‰æ–¹æ³•éƒ½å°‡ç™»å…¥è€…çš„èº«ä»½ map å›èˆ‡ Vault é…ç½®çš„æ ¸å¿ƒ policyã€‚&lt;/p&gt;
&lt;h3 id=&#34;æº–å‚™ç’°å¢ƒ&#34;&gt;æº–å‚™ç’°å¢ƒ&lt;/h3&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vault å®˜æ–¹ç¶²ç«™æ–‡ä»¶&lt;/a&gt;ä¸­ï¼ŒHashicorp å®˜æ–¹æº–å‚™äº† &lt;a href=&#34;https://instruqt.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://instruqt.com/&lt;/a&gt;çš„ session lab&lt;/p&gt;
&lt;p&gt;ç­†è€…å€‹äººè¦ºå¾— interactive lab çš„ browser tab å¾ˆé›£ç”¨ï¼Œä¹Ÿä¸å–œæ­¡ Terminal session é€£ remote VM çš„å»¶é²ï¼Œä»¥ä¸‹å…§å®¹é‚„æ˜¯æœƒä½¿ç”¨ local dev Server èªªæ˜ã€‚&lt;/p&gt;
&lt;p&gt;è§€çœ¾å€‘å¯ä»¥è‡ªå·±æ–Ÿé…Œä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;policy-æ ¼å¼&#34;&gt;Policy æ ¼å¼&lt;/h3&gt;
&lt;p&gt;ç­–ç•¥ï¼ˆPoliciesï¼‰æ˜¯ä»¥HCLæ’°å¯«çš„ï¼Œä½†ä¹Ÿå…¼å®¹JSONæ ¼å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç¯„ä¾‹ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-hcl&#34; data-lang=&#34;hcl&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Dev servers have version 2 of KV secrets engine mounted by default, so will
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# need these paths to grant permissions:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;secret/data/*&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  capabilities&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;, &amp;#34;update&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;secret/data/foo&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;  capabilities&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;read&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ç¯„ä¾‹ policy æˆäºˆäº†å° KV v2 ç§˜å¯†ç®¡ç†ï¼ˆsecrets engineï¼‰çš„è³‡æºçš„èƒ½åŠ›ã€‚å¦‚æœä½ å°æ–¼èˆ‡é€™å€‹ç§˜å¯†ç®¡ç†å¼•æ“ç›¸é—œçš„è·¯å¾‘ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥æŸ¥é–±è©²ç§˜å¯†ç®¡ç†å¼•æ“æ–‡ä»¶ä¸­çš„ &lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2#acl-rules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ACL è¦å‰‡&lt;/a&gt;éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ“šé€™å€‹ policyï¼Œä½¿ç”¨è€…å¯ä»¥å° &lt;code&gt;secret/data/&lt;/code&gt; ä¸­çš„ä»»ä½•ç§˜å¯†é€²è¡Œå¯«å…¥æ“ä½œï¼Œä½†å°æ–¼ &lt;code&gt;secret/data/foo&lt;/code&gt; çš„å­˜å–åƒ…å…è¨±è®€å–ã€‚policy çš„é è¨­è¡Œç‚ºæ˜¯ Denyï¼Œå› æ­¤ä¸å…è¨±å°æœªæŒ‡å®šè·¯å¾‘çš„è³‡æºé€²è¡Œä»»ä½•å­˜å–ã€‚&lt;/p&gt;
&lt;p&gt;policy æ ¼å¼ä½¿ç”¨ prefix åŒ¹é…ç³»çµ±ä¾†ç¢ºå®šå° API è·¯å¾‘çš„è¨ªå•æ§åˆ¶ã€‚ä½¿ç”¨æœ€å…·é«”çš„å·²å®šç¾©ç­–ç•¥ï¼Œå³ç²¾ç¢ºåŒ¹é…æˆ–æœ€é•· prefix åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯å­˜å– &lt;code&gt;secret/data/foo&lt;/code&gt; è·¯å¾‘ç¬¦åˆä¸Šé¢å…©æ¢è¦å‰‡ï¼Œä½†æ˜¯ç”±æ–¼ç¬¬äºŒæ¢è¦å‰‡çš„è·¯å¾‘ match æœ€é•·æœ€ç²¾ç¢ºï¼Œæ‰€ä»¥æœ€çµ‚æ‹¿åˆ°çš„æ¬Šé™æ˜¯ &amp;ldquo;read&amp;rdquo;&lt;/p&gt;
&lt;p&gt;ç”±æ–¼ Vault ä¸­çš„ä¸€åˆ‡éƒ½å¿…é ˆé€šé API é€²è¡Œè¨ªå•ï¼Œé€™ä½¿å¾—å° Vault çš„æ¯å€‹æ–¹é¢éƒ½æœ‰åš´æ ¼çš„æ§åˆ¶ï¼ŒåŒ…æ‹¬å•Ÿç”¨ç§˜å¯†ç®¡ç†å¼•æ“ã€å•Ÿç”¨èº«ä»½é©—è­‰æ–¹æ³•ã€èº«ä»½é©—è­‰ï¼Œä»¥åŠå­˜å–ç§˜å¯†ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸€äº›å…§å»ºçš„ç­–ç•¥ç„¡æ³•è¢«ç§»é™¤ã€‚ä¾‹å¦‚ï¼Œroot policy å’Œ default policy æ˜¯å¿…éœ€çš„ç­–ç•¥ï¼Œç„¡æ³•è¢«åˆªé™¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;default policy æä¾›äº†ä¸€çµ„å¸¸è¦‹çš„æ¬Šé™ï¼Œä¸¦ä¸” default åŒ…å«åœ¨æ‰€æœ‰ token ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;root policy çµ¦äºˆ token è¶…ç´šç®¡ç†å“¡æ¬Šé™ï¼Œé¡ä¼¼æ–¼Linuxæ©Ÿå™¨ä¸Šçš„ root ç”¨æˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å•Ÿå‹•æœ¬åœ°é–‹ç™¼ç’°å¢ƒ&#34;&gt;å•Ÿå‹•æœ¬åœ°é–‹ç™¼ç’°å¢ƒ&lt;/h3&gt;
&lt;p&gt;æ­¥é©Ÿåœ¨å‰å¹¾ç¯‡å·²ç¶“å‡ºç¾éæ•¸æ¬¡ï¼Œé€™é‚Šå°±ç°¡å–®å¸¶é&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault server -dev -dev-no-store-token
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; VAULT_TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;defult-policy&#34;&gt;Defult policy&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ç”¨ä¸‹åˆ—æŒ‡ä»¤åˆ—å‡ºé è¨­çš„ policy&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤è®€å– default policy çš„å…§å®¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output å›å‚³è¨±å¤šæ¢ policy ruleï¼Œä¸»è¦æ˜¯çµ¦äºˆ token åŸºæœ¬çš„æ“ä½œæ¬Šé™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Allow tokens to look up their own properties&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &lt;span class=&#34;s2&#34;&gt;&amp;#34;auth/token/lookup-self&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;capabilities&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;read&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Allow tokens to renew themselves&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &lt;span class=&#34;s2&#34;&gt;&amp;#34;auth/token/renew-self&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;capabilities&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Allow tokens to revoke themselves&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &lt;span class=&#34;s2&#34;&gt;&amp;#34;auth/token/revoke-self&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;capabilities&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç†Ÿæ‚‰ default policy å…§å®¹å¾Œï¼Œå¯ä»¥æ–Ÿé…Œä½¿ç”¨ã€‚æˆ–æ˜¯é¸æ“‡å¾é ­ç·¨å¯«è‡ªå·±çš„ policyã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç·¨å¯«ç¬¬ä¸€å€‹-policy&#34;&gt;ç·¨å¯«ç¬¬ä¸€å€‹ policy&lt;/h3&gt;
&lt;p&gt;è¦æ’°å¯« policy ï¼Œä½¿ç”¨ vault policy write æŒ‡ä»¤ã€‚è«‹æŸ¥é–±è©²æŒ‡ä»¤çš„å¹«åŠ©æ–‡ä»¶ä»¥é€²ä¸€æ­¥äº†è§£ç”¨æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy write -h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: vault policy write &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;options&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; NAME PATH
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Uploads a policy with name NAME from the contents of a &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; file PATH or
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  stdin. If PATH is &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;, the policy is &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; from stdin. Otherwise, it is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  loaded from the file at the given path on the &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; disk.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨ vault policy write æŒ‡ä»¤ï¼Œå¯ä»¥å¾æœ¬åœ°æ–‡ä»¶ PATH æˆ–æ¨™æº–è¼¸å…¥ï¼ˆstdinï¼‰çš„å…§å®¹ä¸Šå‚³ä¸€å€‹åç‚º NAME çš„ç­–ç•¥ã€‚å¦‚æœ PATH æ˜¯ &amp;#34;-&amp;#34;ï¼Œå‰‡ç­–ç•¥å°‡å¾ stdin è®€å–ã€‚å¦å‰‡ï¼Œå®ƒå°‡å¾æœ¬åœ° disk ä¸Šçµ¦å®šè·¯å¾‘çš„æ–‡ä»¶ä¸­è¼‰å…¥ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Upload a policy named &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-policy&amp;#34;&lt;/span&gt; from &lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/policy.hcl&amp;#34;&lt;/span&gt; on the &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; disk:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault policy write my-policy /tmp/policy.hcl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Upload a policy from stdin:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ cat my-policy.hcl &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vault policy write my-policy -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å‰µå»ºåç‚º &amp;ldquo;my-policy&amp;rdquo; çš„ policyï¼Œä¸¦å°‡å…¶å…§å®¹ä¾†è‡ª stdinï¼ˆæ¨™æº–è¼¸å…¥ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy write my-policy - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# Dev servers have version 2 of KV secrets engine mounted by default, so will
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# need these paths to grant permissions:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;path &amp;#34;secret/data/*&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  capabilities = [&amp;#34;create&amp;#34;, &amp;#34;update&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;path &amp;#34;secret/data/foo&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  capabilities = [&amp;#34;read&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Uploaded policy: my-policy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤åˆ—å‡º policy&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my-policy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®€å– my-policy çš„å…§å®¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault policy &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; my-policy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Dev servers have version 2 of KV secrets engine mounted by default, so will
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# need these paths to grant permissions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &amp;#34;secret/data/*&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  capabilities = [&amp;#34;create&amp;#34;, &amp;#34;update&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path &amp;#34;secret/data/foo&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  capabilities = [&amp;#34;read&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ¸¬è©¦-policy&#34;&gt;æ¸¬è©¦ policy&lt;/h3&gt;
&lt;p&gt;ä½ æ‰€å»ºç«‹çš„ policy ï¼Œæä¾›å° KV-V2 ç§˜å¯†å¼•æ“æ‰€å®šç¾©çš„ç§˜å¯†é€²è¡Œç®¡ç†ã€‚policy è¢«é™„åŠ åˆ° Vault ç›´æ¥ç”Ÿæˆçš„ otokenï¼Œæˆ–é€éå…¶å„ç¨®æˆæ¬Šæ–¹æ³•ç”Ÿæˆçš„ token ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å‰µå»ºä¸€å€‹ token ï¼Œæ·»åŠ  my-policyã€‚-field flag è¨­å®šåªå›å‚³éƒ¨åˆ† key-vault dataï¼Œè€Œä¸æ˜¯å‚³æ•´å€‹ metadata tableã€‚-policy è¨­å®šé€£çµ token çš„ policyã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token create -field token -policy&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my-policy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hvs.CAESIIDh...UxbUU
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç‚ºäº†ç°¡åŒ–ï¼Œæœ¬å…§å®¹ä½¿ç”¨ dev æ¨¡å¼ä¼ºæœå™¨ï¼Œç›´æ¥å¾ token æˆæ¬Šæ–¹æ³•å‰µå»º token ã€‚è«‹è¨˜ä½ï¼Œåœ¨å¤§å¤šæ•¸ production ç’°å¢ƒéƒ¨ç½²ä¸­ï¼Œtoken å°‡ç”±å·²å•Ÿç”¨çš„æˆæ¬Šæ–¹æ³•(ex. github auth method)å‰µå»ºã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ token login&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output å›å‚³ç™»å…¥è³‡è¨Šï¼Œä»¥åŠé€£çµ token çš„ policyï¼Œpolicy åŒ…å« default èˆ‡ my-policy&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! You are now authenticated. The token information displayed below
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;is already stored in the token helper. You do NOT need to run &amp;#34;vault login&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;again. Future Vault requests will automatically use this token.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                  Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                  -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                hvs.CAESIIDh...UxbUU
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor       vY3aLwMSezlxeOn7YwcjxuhZ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration       767h56m52s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable      true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies       [&amp;#34;default&amp;#34; &amp;#34;my-policy&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies    []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies             [&amp;#34;default&amp;#34; &amp;#34;my-policy&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥åŸ·è¡Œ vault token lookupï¼ŒæŸ¥æ‰¾ç›®å‰ token çš„å®Œæ•´è³‡è¨Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token lookup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                 Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                 -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;accessor            vY3aLwMSezlxeOn7YwcjxuhZ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;creation_time       &lt;span class=&#34;m&#34;&gt;1694917062&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;creation_ttl        768h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;display_name        token
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;entity_id           n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;expire_time         2023-10-19T10:17:42.723364+08:00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explicit_max_ttl    0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;id                  hvs.CAESIIDh...UxbUU
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;issue_time          2023-09-17T10:17:42.723365+08:00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meta                &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;num_uses            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;orphan              &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path                auth/token/create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies            &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;default my-policy&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;renewable           &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ttl                 767h55m45s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;                service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹policy å•Ÿç”¨äº† secret/ ç§˜å¯†å¼•æ“å…§æ¯å€‹è·¯å¾‘çš„å‰µå»ºå’Œæ›´æ–°åŠŸèƒ½ï¼Œé™¤äº†ä¸€å€‹ä¾‹å¤–è·¯å¾‘ secret/data/foo åƒ…å…è¨± readã€‚&lt;/p&gt;
&lt;p&gt;å¯«å…¥è³‡æ–™åˆ° secret/data/creds&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;secret creds &lt;span class=&#34;nv&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;my-long-password&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output å›å‚³æˆåŠŸè³‡è¨Šï¼Œç§˜å¯†å·²æˆåŠŸå‰µå»ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/data/creds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-17T02:26:44.179748Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è©²æ”¿ç­–åƒ…å•Ÿç”¨äº†å° secret/data/foo è·¯å¾‘çš„è®€å–åŠŸèƒ½ã€‚å˜—è©¦å‘æ­¤è·¯å¾‘å¯«å…¥å°‡å°è‡´&amp;quot;æ¬Šé™æ‹’çµ•&amp;quot;éŒ¯èª¤ã€‚è«‹å˜—è©¦å¯«å…¥ secret/data/foo è·¯å¾‘ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;secret foo &lt;span class=&#34;nv&#34;&gt;robot&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;beepboop
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œé¡¯ç¤ºæ¬Šé™éŒ¯èª¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error writing data to secret/data/foo: Error making API request.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: PUT http://127.0.0.1:8200/v1/secret/data/foo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: 403. Errors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; error occurred:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	* permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤ policy å®šç¾©äº†ä¸€çµ„æœ‰é™çš„è·¯å¾‘å’ŒåŠŸèƒ½ã€‚å¦‚æœæ²’æœ‰å° sys çš„è¨ªå•æ¬Šé™ï¼Œå‰‡ç³»çµ±ç›¸é—œç„ç·šï¼Œåƒ vault policy list æˆ– vault secrets list é€™æ¨£çš„å‘½ä»¤å°‡ç„¡æ³•é‹ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;kv-v2-èˆ‡-v1-èªæ³•&#34;&gt;kv v2 èˆ‡ v1 èªæ³•&lt;/h3&gt;
&lt;p&gt;ç•¶ä½ ä½¿ç”¨ vault kv CLI å‘½ä»¤è¨ªå• KV v2 ç§˜å¯†å¼•æ“æ™‚ï¼Œæˆ‘å€‘å»ºè­°ä½¿ç”¨ -mount flag èªæ³•ï¼Œä¾†å¼•ç”¨ KV v2 ç§˜å¯†å¼•æ“çš„è·¯å¾‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vault kv get -mount=secret foo&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¼å®¹ KV v1 é¢¨æ ¼çš„è·¯å¾‘ prefix èªæ³•ï¼Œåœ¨æŸå€‹ç¯„åœå…§ä¸Šæ˜¯ç­‰æ•ˆçš„ï¼Œç³»çµ±å°‡è‡ªå‹•é™„åŠ  /data åˆ°ç§˜å¯†è·¯å¾‘ï¼Œå¯èƒ½æœƒå¼•èµ·æ··æ·†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vault kv get secret/foo&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;é€£çµ-policy-èˆ‡-auth-method&#34;&gt;é€£çµ policy èˆ‡ auth method&lt;/h3&gt;
&lt;p&gt;Vault æœ¬èº«åªæœ‰å”¯ä¸€çš„ policy æˆæ¬Šç®¡ç†æ©Ÿæ§‹ï¼Œä¸åŒæ–¼èº«ä»½é©—è­‰ï¼Œä½ å¯ä»¥å•Ÿç”¨å¤šå€‹èº«ä»½é©—è­‰æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é…ç½®èº«ä»½é©—è­‰æ–¹æ³•ï¼Œä»¥è‡ªå‹•åˆ†é…ä¸€çµ„ policyï¼Œçµ¦ä½¿ç”¨æŸäº›èº«ä»½é©—è­‰æ–¹æ³•å‰µå»ºçš„ token ã€‚é€™æ¨£åšçš„æ–¹å¼å–æ±ºæ–¼ç›¸é—œçš„èº«ä»½é©—è­‰æ–¹æ³•ï¼Œä½†é€šå¸¸æ¶‰åŠå°‡ role æ˜ å°„åˆ° policy ï¼Œæˆ–è€…å°‡ identity æˆ– group æ˜ å°„åˆ° policyã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šç•¶è¨­å®š github auth method çš„ role æ™‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ token policies åƒæ•¸ä¾†å¯¦ç¾é€™ä¸€é»ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šå˜—è©¦å»ºç«‹å¦å¤–ä¸€å€‹ auth methodï¼ŒAppRoleï¼Œé †ä¾¿åœ¨æ•´ç†ä¸€æ¬¡ vault -&amp;gt; auth method -&amp;gt; policy çš„é—œä¿‚&lt;/p&gt;
&lt;h3 id=&#34;é…ç½®-approle-èº«ä»½é©—è­‰æ–¹æ³•&#34;&gt;é…ç½® AppRole èº«ä»½é©—è­‰æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;åœ¨ä»¥ä¸‹æ­¥é©Ÿä¸­ï¼Œä½¿ç”¨æ¬Šé™æ›´é«˜çš„ root token é€²è¡Œæ“ä½œèˆ‡ç™»å…¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Token &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;will be hidden&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! You are now authenticated. The token information displayed below
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;is already stored in the token helper. You &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; NOT need to run &lt;span class=&#34;s2&#34;&gt;&amp;#34;vault login&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;again. Future Vault requests will automatically use this token.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                  Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                  -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                hvs.uCGr6...749AI
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor       SlAe0epU6CLngp2iclB5WN2A
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration       âˆ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable      &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies       &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;root&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies    &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;root&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿç”¨ approle auth method&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; approle
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Enabled approle auth method at: approle/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-17T10:44:26.460+0800 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: enabled credential backend: &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;approle/ &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;approle &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;approle-é…ç½®-role&#34;&gt;approle é…ç½® role&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å·²ç¶“å•Ÿç”¨ approle é€™å€‹ auth methodï¼Œæ¥ä¸‹ä¾†è¦è¨­å®šåç‚º &amp;ldquo;my-role&amp;rdquo; çš„ AppRole roleï¼Œé…ç½®ä¸€äº›åŸºæœ¬çš„token è¨­å®šï¼Œä¸¦å°‡å…ˆå‰å®šç¾©çš„ &amp;ldquo;my-policy&amp;rdquo; policyï¼Œé™„åŠ åˆ°æ‰€æœ‰é€šéè©² role å‰µå»ºçš„ tokenã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼Œåœ¨ auth/approle/role/ ä¸‹æ–°å¢ my-roleï¼Œpath ä¹Ÿä»£è¡¨ approle / role / my-role çš„éšå±¤é—œä¿‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/approle/role/my-role &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;secret_id_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_num_uses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;20m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_max_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;30m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;secret_id_num_uses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;40&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_policies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my-policy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: auth/approle/role/my-role
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥é€šéä½¿ç”¨ auth æ–¹æ³•ä¾†é©—è­‰é€™å€‹ AppRole role æ˜¯å¦é™„åŠ äº†policyã€‚&lt;/p&gt;
&lt;p&gt;è¦ä½¿ç”¨ AppRole é€²è¡Œèº«ä»½é©—è­‰ï¼Œé¦–å…ˆéœ€è¦ç²å–è§’è‰²ID&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå…ˆè®€å–ç›®å‰ approle/role/my-role çš„è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; auth/approle/role/my-role
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                        Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                        -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bind_secret_id             &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;local_secret_ids           &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_bound_cidrs      &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_num_uses         &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_ttl              10m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_bound_cidrs          &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_explicit_max_ttl     0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_max_ttl              30m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_no_default_policy    &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_num_uses             &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_period               0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;my-policy&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_ttl                  20m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_type                 default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œè®€å– my-role çš„ role-id&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; auth/approle/role/my-role/role-id
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key        Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---        -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;role_id    600dce48-244c-094e-aeae-cb819ec7f5dd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹ä¾†ï¼Œç²å–ä¸€å€‹ç§˜å¯†ID(å®ƒé¡ä¼¼æ–¼æ‡‰ç”¨ç¨‹å¼ç”¨æ–¼ AppRole èº«ä»½é©—è­‰çš„å¯†ç¢¼)ï¼Œç”±æ–¼æˆ‘å€‘é€™å€‹ç¤ºç¯„ä¸¦ä¸æä¾›é¡å¤–åƒæ•¸å€¼ï¼Œé€™å…ˆéœ€è¦ä½¿ç”¨ -f | -force flagï¼Œå¼·è¿« vault å¯«å…¥ä¸€å€‹æ²’æœ‰ value çš„è³‡æ–™åˆ° auth/approle/role/my-role/secret-id endpoint&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write -f auth/approle/role/my-role/secret-id
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥æƒ³åƒæ˜¯å‘ API server æ‰“ POST my-role/secret-idï¼Œå‘ approle è¨»å†Šä¸€å€‹ appï¼Œserver å‰‡å›å‚³ä¸€çµ„ idï¼Œä»¥è¾¨è­˜é€™å€‹ appã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                   Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                   -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id             d80db935-9792-faf7-306d-93a2f0c3a18f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_accessor    32451384-f985-a387-175b-67140225856f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_num_uses    &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_ttl         10m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€å¾Œé€²è¡Œ login å–å¾— tokenï¼Œé€™è£¡ä½¿ç”¨ vault write é€²è¡Œ AppRole èº«ä»½é©—è­‰ï¼ŒæŒ‡å®š role pathä¸¦ä½¿ç”¨ç›¸æ‡‰çš„é¸é …å‚³érole idå’Œsecret id&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ROLE_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;600dce48-244c-094e-aeae-cb819ec7f5dd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;SECRET_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;d80db935-9792-faf7-306d-93a2f0c3a18f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/approle/login &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;role_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ROLE_ID&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;secret_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SECRET_ID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œå–å¾—åˆæ³•çš„ tokenï¼Œä¸¦ä¸”å…·æœ‰æˆ‘å€‘ç‚º approle/my-role é…ç½®çš„ my-policy æ¬Šé™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                     Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                     -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                   hvs.CAESIB9gD3aupV5X06IRIWMEvhL4QeBtizO20i2Hh2YderxpGh4KHGh2cy5BWVVWVDVFUVI3dkw5VUFUbmdoZmpnUFA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor          QGrKxnHH4e9SVLqhpaqgYsCZ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration          20m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable         &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies          &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies       &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_meta_role_name    my-role
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¦å‹™ä¸­ï¼Œé€™å€‹ &lt;code&gt;secret_id&lt;/code&gt; æœƒè¨­ç½®åœ¨ application ä¸Šï¼Œè®“ application å…·æœ‰åˆæ³•å­˜å– vault çš„æ¬Šé™&lt;/p&gt;
&lt;h3 id=&#34;å¯¦å‹™ç¯„ä¾‹è¬›è§£&#34;&gt;å¯¦å‹™ç¯„ä¾‹è¬›è§£&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å¯ä»¥é‡è¤‡ä½¿ç”¨è¨­å®šå¥½çš„ policyï¼Œç¶å®šåˆ° auth method ä¸Šï¼Œpolicy å° auth method æ˜¯å¤šå°å¤šçš„ï¼Œé€™é‚Šé€éæˆ‘å€‘ä¸Šç¯‡ github auth method ä¾†å°ç…§ä¸€ä¸‹ï¼Œè§£é‡‹ auth method èˆ‡ role / policy çš„é—œä¿‚&lt;/p&gt;
&lt;p&gt;chechia-net æ˜¯ä¸€å€‹çµ„ç¹”&lt;/p&gt;
&lt;p&gt;as a adminï¼Œæˆ‘å¸Œæœ›è—‰ç”± github auth methodï¼Œè®“æœ‰ github æ¬Šé™çš„å·¥ç¨‹å¸«ï¼Œå¯ä»¥å­˜å– vault&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¦ä¸”åœ¨ github ä¸Šçš„ org / team ç®¡ç†å„å€‹ä½¿ç”¨è€…ï¼Œvault å¯ä»¥ç›´æ¥è¤‡ç”¨ github çš„æ¬Šé™éšå±¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ–¼æ˜¯ï¼Œé€é github auth methodï¼Œè‡ªå‹•é…ç½® vault æ¬Šé™çµ¦ chechia-net github org ä¸‹çš„ä½¿ç”¨è€…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github-chechia github
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/github-chechia/config &lt;span class=&#34;nv&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;as a github userï¼Œæˆ‘å¸Œæœ›è—‰ç”± github auth methodï¼Œç›´æ¥ç™»å…¥ vaultï¼Œä¸ç”¨è¨»å†Šé¡å¤–çš„å¸³è™Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github-chechia
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›æˆ approle ä¹Ÿæ˜¯ç›¸åŒé“ç†&lt;/p&gt;
&lt;p&gt;as a adminï¼Œæˆ‘å¸Œæœ›æˆ‘çš„ application èƒ½å¤ æœ‰è¾¦æ³•å­˜å– vault&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯èƒ½æ˜¯ä¸€å€‹ badkend golang serverï¼Œéœ€è¦å­˜å– vault ä¸­çš„ mysql database credential&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;approle-golang-server approle
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ application å¯èƒ½æœ‰è¤‡æ•¸ä¸åŒç¨®é¡å·¥ä½œï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›èƒ½å¤ é…ç½®ä¸åŒçš„ roleï¼Œçµ¦äºˆä¸åŒçš„ policy æ¬Šé™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;role/default æœ‰ default policy&lt;/li&gt;
&lt;li&gt;role/my-role æœ‰ default, my-policy å…©å€‹ policy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´æ¥è¿‘å¯¦å‹™çš„ä¾‹å­ï¼Œåº•ä¸‹å¯èƒ½æ˜¯å¸¸è¦‹çš„ role ç”¨é€”&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;approle/databaseï¼Œç•¶ application éœ€è¦å‘ db å­˜å–æ™‚ä½¿ç”¨ï¼Œex. å»å–å¾— mysql ç›¸é—œçš„ credential&lt;/li&gt;
&lt;li&gt;approle/frontendï¼Œè®“ application å¯ä»¥å‘å‰ç«¯å­˜å–æ¸¬è©¦éœ€è¦ credential&lt;/li&gt;
&lt;li&gt;approle/qaï¼Œä¹Ÿè¨±æ˜¯ application è‡ªå‹•åŒ–æ¸¬è©¦çš„ credential
æƒ³è¡¨é”ï¼Œé›–ç„¶ä¾†æºéƒ½æ˜¯ç›¸åŒ applicationï¼Œä½¿ç”¨ approle auth methodï¼Œvault é‚„æ˜¯å¯ä»¥è¨­å®šä¸åŒçš„ policyï¼Œè®“ application å–ç”¨æœ€å°çš„å¯ç”¨æ¬Šé™ï¼Œè€Œä¸æœƒæ¯æ¬¡ç™»å…¥ vault éƒ½æ˜¯å¾ˆå¤§çš„æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;èº«ç‚º adminï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨ approle-golang-server ä¸­ç”¢ç”Ÿä¸€å€‹ default role&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/approle-golang-server/role/default &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;secret_id_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_num_uses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;20m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_max_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;30m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;secret_id_num_uses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;40&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_policies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ ä¸€å€‹ my-role&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/approle-golang-server/role/my-role &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;secret_id_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_num_uses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;20m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_max_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;30m &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;secret_id_num_uses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;40&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;token_policies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;default,my-policy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ—å‡ºåœ¨ approle-golang-server ä¸­å•Ÿç”¨çš„ role&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault list auth/approle-golang-server/role/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my-role
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;admin é…ç½®å®Œ role å¾Œï¼Œè¨˜å¾—è®€å– role-idï¼Œä¸¦å°‡ role-id é…ç½®åˆ° application ä¸Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥åœ¨ application ä¸­ç¶­è­·ä¸€å€‹ mapï¼Œç•¶ä½¿ç”¨é€™é€é applicationï¼Œæ‹¿åˆ° default roleï¼Œå°±ä½¿ç”¨ default/role-id&lt;/li&gt;
&lt;li&gt;æ­é…æ¥è¿‘å¯¦å‹™çš„ä¾‹å­ï¼Œå°±æ˜¯å¦‚æœæ˜¯å¾Œç«¯å·¥ç¨‹å¸«ä½¿ç”¨ applicationï¼Œapplication è¦èƒ½å¤ ä½¿ç”¨ role/backend/role-idï¼Œä¾†å‘ vault é€²è¡Œ authentication
&lt;ul&gt;
&lt;li&gt;ä½ ä¹Ÿå¯ä»¥è®“ application æœ‰æ¬Šé™è®€å– &lt;code&gt;auth/approle-golang-server/role/*/role-id&lt;/code&gt;ï¼Œè®“ application é€é vault API è‡ªå‹•å–å¾— role-id&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; auth/approle-golang-server/role/default/role-id
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; auth/approle-golang-server/role/my-role/role-id
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key        Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---        -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;role_id    f0340d97-a97d-85f9-30d5-65a2058baf11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key        Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---        -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;role_id    c1f3cd3e-8f0a-8b1f-91f7-a3a310b9755f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æ˜¯ admin éœ€è¦é…ç½®çš„å…§å®¹&lt;/p&gt;
&lt;p&gt;ç¾åœ¨è§’è‰²æ›æˆ applicationï¼Œapplication ä¸Šç·šäº†ã€‚application ä¾ç…§æƒ…å¢ƒï¼Œé¸æ“‡è¦ä½¿ç”¨é‚£å€‹ roleï¼Œå»å–å¾— secret-id&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ application è¦å»å­˜å– databaseï¼Œå°±è‡ªå·±ä½¿ç”¨ role/database&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„ï¼Œé€™å€‹ role/database èˆ‡ policy/database ä¸Šé¢éƒ½æ²’æœ‰é…ç½®ï¼Œè«‹è®€è€…è‡ªå·±ç·´ç¿’ï¼Œé…ç½®ä¸€å€‹ placeholder ç©ºçš„æ¬Šé™ï¼Œæˆ–æ˜¯ç™¼æ®å‰µæ„ä¹Ÿå¯ä»¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write -f auth/approle-golang-server/role/my-role/secret-id
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œvault å›è¦†ä¸€çµ„çŸ­æ™‚æ•ˆçš„ secret-idï¼Œttl=10 min&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                   Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                   -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id             ad70d84b-56a5-eec2-0a95-6aa7f2cfceef
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_accessor    76a5b993-a139-9837-5990-b6adc483542a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_num_uses    &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret_id_ttl         10m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;application å¯ä»¥ä½¿ç”¨ role-id + secret-idï¼Œå»å–å¾— token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/approle-golang-server/login &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;role_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ROLE_ID&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;secret_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SECRET_ID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                     Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                     -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                   hvs.CA...ZXRVc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor          zjBhj70A6ed72zksuooxCpYt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration          20m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable         &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies          &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;database&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies       &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;database&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_meta_role_name    database
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-policies&lt;/a&gt;
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/concepts/policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/concepts/policies&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¾ˆé‡è¦ï¼šä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 06: Github Auth method</title>
      <link>https://chechia.net/zh-hant/post/2023-09-17-vault-workshop-authentication-github/</link>
      <pubDate>Thu, 14 Sep 2023 02:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-17-vault-workshop-authentication-github/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-06github-auth-method&#34;&gt;Day 06ï¼šGithub auth method&lt;/h1&gt;
&lt;h3 id=&#34;ä¸éœ€è¦ä½¿ç”¨-root-token-çš„-auth-method-github&#34;&gt;ä¸éœ€è¦ä½¿ç”¨ root token çš„ auth method: github&lt;/h3&gt;
&lt;p&gt;Vault æ”¯æ´ç”¨æ–¼äººå“¡ä½¿ç”¨è€…çš„èº«ä»½é©—è­‰æ–¹æ³•ã€‚GitHub èº«ä»½é©—è­‰ï¼Œä½¿ç”¨æˆ¶å¯ä»¥é€šéæä¾›ä»–å€‘çš„ GitHub æ†‘è­‰ä¾†é©—è­‰ Vaultï¼Œä¸¦æ”¶åˆ°ä¸€å€‹ Vault tokenã€‚&lt;/p&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªï¼Œgithub organization &lt;a href=&#34;https://github.com/chechia-net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia-net&lt;/a&gt;ï¼Œå¯ä»¥è¨­å®šé©ç•¶çš„æ¬Šé™çµ¦æˆå“¡ chechiachangï¼Œè®“ chechiachang å¯ä»¥é€é github å–å¾—æœ‰æ¬Šé™çš„ tokenã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„&lt;/p&gt;
&lt;p&gt;åœ¨ç·´ç¿’ä¸­æ‰€æè¿°çš„é€™ç¨®èº«ä»½é©—è­‰æ–¹æ³•ï¼Œéœ€è¦ä½ æ“æœ‰ GitHubã€å±¬æ–¼ GitHub org ä¸­çš„ä¸€å€‹ team ï¼Œä¸¦ç”Ÿæˆäº†å…·æœ‰ &lt;code&gt;read:org&lt;/code&gt; scope çš„ GitHub personal access tokenã€‚ä½ å¯ä»¥æ–¼ github å‰µå»ºä¸€å€‹ free plan çš„ orgï¼Œä¸¦è¨­å®šä¸€å€‹ teamï¼Œç„¶å¾Œé€éå€‹äºº Settings / Developer Settings ä¾†ç”¢ç”Ÿä¸€æŠŠå…·æœ‰ &lt;code&gt;read:org&lt;/code&gt; æ¬Šé™çš„ personal access token&lt;/p&gt;
&lt;h3 id=&#34;å•Ÿç”¨-github-auth-method&#34;&gt;å•Ÿç”¨ github auth method&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼Œåœ¨ path=github/ ä¸‹å•Ÿç”¨ GitHub èº«ä»½é©—è­‰æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hvs.qCqY...9KYv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; github
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹æŒ‡ä»¤ä½¿ç”¨ root token è¨­å®š auth methodï¼Œä¹Ÿæ˜¯æ•´å€‹ github auth methods ä¸­ï¼Œå”¯ä¸€éœ€è¦ç”¨åˆ° root token è¨­å®šçš„åœ°æ–¹ï¼Œè€Œä¸”åªéœ€è¦è¨­å®šä¸€æ¬¡&lt;/p&gt;
&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Enabled github auth method at: github/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server log é¡¯ç¤º credential backend å·²å•Ÿç”¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-16T21:40:10.444+0800 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: enabled credential backend: &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github/ &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä¸‹åˆ—æŒ‡ä»¤ï¼Œåˆ—å‡ºæ‰€æœ‰çš„ auth methods&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path       Type      Accessor                Description                Version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----       ----      --------                -----------                -------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;github/    github    auth_github_9bc96e5f    n/a                        n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token/     token     auth_token_b7984c52     token based credentials    n/a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;github èº«ä»½é©—è­‰æ–¹æ³•å·²å•Ÿç”¨ï¼Œä¸¦ä½æ–¼è·¯å¾‘ auth/github/ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¨­å®š-github-auth-method&#34;&gt;è¨­å®š github auth method&lt;/h3&gt;
&lt;p&gt;æ­¤èº«ä»½é©—è­‰æ–¹æ³•éœ€è¦ä½ åœ¨é…ç½®ä¸­è¨­ç½® GitHub organizationã€‚GitHub organizationä¸­ï¼Œç¶­è­·äº†ä¸€å€‹å…è¨±èˆ‡ Vault é©—è­‰çš„ä½¿ç”¨è€…åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;è¨­ç½® GitHub èº«ä»½é©—è­‰çš„çµ„ç¹”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/github/config &lt;span class=&#34;nv&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: auth/github/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¾åœ¨ï¼Œchechia-net GitHub çµ„ç¹”ä¸­çš„æ‰€æœ‰ä½¿ç”¨è€…éƒ½å¯ä»¥é€²è¡Œèº«ä»½é©—è­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¨­å®š-github-auth-methodçµ¦ä¸åŒ-team-ä¸åŒçš„-policy&#34;&gt;è¨­å®š github auth methodï¼Œçµ¦ä¸åŒ team ä¸åŒçš„ policy&lt;/h3&gt;
&lt;p&gt;GitHub çµ„ç¹”å¯ä»¥å®šç¾©åœ˜éšŠ(team)ã€‚æ¯å€‹åœ˜éšŠå¯èƒ½å¯ä»¥åœ¨çµ„ç¹”ç¶­è­·çš„æ‰€æœ‰ repository ä¸­åŸ·è¡Œä¸åŒçš„æ“ä½œã€‚é€™äº›åœ˜éšŠä¹Ÿå¯èƒ½éœ€è¦è¨ªå• Vault å…§çš„ç‰¹å®šå¯†ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;é…ç½® GitHub sre åœ˜éšŠçš„èº«ä»½é©—è­‰ï¼Œä»¥ç²å¾— default å’Œ application å…©å€‹ policyçš„æˆæ¬Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/github/map/teams/sre &lt;span class=&#34;nv&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;default,application
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: auth/github/map/teams/sre
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;GitHub sre åœ˜éšŠä¸­ chechia-net çµ„ç¹”çš„æˆå“¡ï¼Œå°‡ä½¿ç”¨ default å’Œ application policy é€²è¡Œèº«ä»½é©—è­‰å’Œæˆæ¬Šã€‚&lt;/p&gt;
&lt;p&gt;å‚™è¨»ï¼šapplication policy å°šæœªåœ¨ Vault ä¸­å®šç¾©ã€‚åœ¨è©²ç­–ç•¥å®šç¾©ä¹‹å‰ï¼ŒVault ä»ç„¶å…è¨±ä½¿ç”¨è€…é€²è¡Œèº«ä»½é©—è­‰ï¼Œä½†æœƒç”¢ç”Ÿè­¦å‘Šã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨æŒ‡ä»¤é¡¯ç¤º Vault å•Ÿç”¨çš„æ‰€æœ‰èº«ä»½é©—è­‰æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›å‚³é¡¯ç¤ºå…©å€‹ auth methodsï¼Œgithub/ èˆ‡ token/&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path       Type      Accessor                Description                Version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----       ----      --------                -----------                -------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;github/    github    auth_github_9bc96e5f    n/a                        n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token/     token     auth_token_b7984c52     token based credentials    n/a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-github-auth-method-login&#34;&gt;ä½¿ç”¨ github auth method login&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ help æŒ‡ä»¤ä¾†äº†è§£ github auth method çš„èªªæ˜&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;help&lt;/span&gt; github
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: vault login -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;CONFIG &lt;span class=&#34;nv&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;V...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  The GitHub auth method allows users to authenticate using a GitHub
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  personal access token. Users can generate a personal access token from the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  settings page on their GitHub account.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# GitHub èº«ä»½é©—è­‰æ–¹æ³•å…è¨±ä½¿ç”¨è€…ä½¿ç”¨ GitHub personal access tokené€²è¡Œèº«ä»½é©—è­‰ã€‚ä½¿ç”¨è€…å¯ä»¥å¾å…¶ GitHub Settings -&amp;gt; Developer Settings -&amp;gt; Personal access tokens (classic) ç”Ÿæˆå€‹äººè¨ªå•ä»¤ç‰Œã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Authenticate using a GitHub token:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault login -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github &lt;span class=&#34;nv&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;abcd1234
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Configuration:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;mount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;string&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Path where the GitHub credential method is mounted. This is usually
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      provided via the -path flag in the &lt;span class=&#34;s2&#34;&gt;&amp;#34;vault login&amp;#34;&lt;/span&gt; command, but it can be
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      specified here as well. If specified here, it takes precedence over the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      value &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; -path. The default value is &lt;span class=&#34;s2&#34;&gt;&amp;#34;github&amp;#34;&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# GitHub æ†‘è­‰æ–¹æ³•æ›è¼‰çš„è·¯å¾‘ã€‚é€šå¸¸é€é &amp;#34;vault login&amp;#34; æŒ‡ä»¤çš„ -path flag æä¾›ï¼Œä½†é€™è£¡ä¹Ÿå¯ä»¥æŒ‡å®šã€‚å¦‚æœåœ¨é€™è£¡æŒ‡å®šï¼Œå‰‡å„ªå…ˆæ–¼ -path çš„å€¼ã€‚é è¨­çš„è·¯å¾‘å€¼ç‚º &amp;#34;github&amp;#34;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;string&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      GitHub personal access token to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; authentication. If not provided,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Vault will prompt &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the value.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç”¨æ–¼èº«ä»½é©—è­‰çš„ GitHub personal access tokenã€‚å¦‚æœæœªæä¾›ï¼ŒVault å°‡æç¤ºè¼¸å…¥æ­¤å€¼ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¼¸å‡ºé¡¯ç¤ºäº†ä½¿ç”¨ GitHub æ–¹æ³•é€²è¡Œ login çš„ä¾‹å­ã€‚è©²æ–¹æ³•è¦æ±‚å¿…é ˆå®šç¾©è©²æ–¹æ³•ï¼Œä¸¦ç”±ä½¿ç”¨è€…æä¾› GitHub personal access tokenã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼ä½ å°‡å˜—è©¦ä½¿ç”¨èº«ä»½é©—è­‰æ–¹æ³•é€²è¡Œç™»éŒ„ï¼Œè«‹ç¢ºä¿åœ¨æ­¤ shell session ä¸­æœªè¨­ç½® VAULT_TOKEN ç’°å¢ƒè®Šæ•¸ï¼Œå› ç‚ºå…¶å€¼å°‡å„ªå…ˆæ–¼ä½ å¾ Vault ç²å–çš„ä»»ä½• tokenã€‚&lt;/p&gt;
&lt;p&gt;å–æ¶ˆè¨­å®šè©²ç’°å¢ƒè®Šæ•¸ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; VAULT_TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å˜—è©¦ä½¿ç”¨ github auth methods ç™»å…¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œä½¿ç”¨è€…ä½¿ç”¨ github personal access tokenï¼Œå–å¾—æœ‰æ•ˆçš„ vault token&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;token æ ¼å¼ä¸åŒ&lt;/li&gt;
&lt;li&gt;token çš„æ•ˆæœŸç‚º 768hï¼ŒçŸ­æ•ˆæœŸ token çš„æ›éšªç¨‹åº¦è¼ƒä½&lt;/li&gt;
&lt;li&gt;é€™å€‹ token çš„ policy æ¬Šé™åªæœ‰ default policy&lt;/li&gt;
&lt;li&gt;metadata æ˜¯ github å›å‚³çš„ï¼Œvault ä¸­ä¸¦æ²’æœ‰å»ºç«‹ username=chechiachang çš„è³‡æ–™
&lt;ul&gt;
&lt;li&gt;org æ˜¯ chechia-net&lt;/li&gt;
&lt;li&gt;username æ˜¯ chechiachang&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GitHub Personal Access Token (will be hidden):
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! You are now authenticated. The token information displayed below
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;is already stored in the token helper. You do NOT need to run &amp;#34;vault login&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;again. Future Vault requests will automatically use this token.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                    Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                    -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                  hvs.CAESI...ncU0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor         lKVpMawotXg1fXcgRvpAOAwQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration         768h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable        true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies         [&amp;#34;default&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies      []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies               [&amp;#34;default&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_meta_org         chechia-net
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_meta_username    chechiachang
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç•¶æœªæä¾› GitHub personal access token çµ¦å‘½ä»¤æ™‚ï¼ŒVault CLI æœƒæç¤ºä½¿ç”¨è€…è¼¸å…¥ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæä¾›äº†æœ‰æ•ˆçš„ GitHub personal access tokenï¼Œå‰‡ä½¿ç”¨è€…å°‡æˆåŠŸç™»éŒ„ vaultï¼Œä¸¦ä¸”è¼¸å‡ºæœƒé¡¯ç¤ºä¸€å€‹ Vault tokenã€‚ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨é€™å€‹ Vault tokenï¼Œç›´åˆ°è©² token è¢«æ’¤éŠ·æˆ–å…¶æœ‰æ•ˆæœŸè¶…éäº† token_durationã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ vault token lookup ä¾†æª¢è¦–ç•¶å‰çš„ token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token lookup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œé¡¯ç¤ºä½¿ç”¨ä¸­çš„ tokenï¼Œä½¿ç”¨çš„ path èˆ‡ methods æ˜¯ github/ï¼Œæ•ˆæœŸ ttl åœ¨å€’æ•¸ä¸­é€æ¼¸æ¸›å°‘ 767h54m27s&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                 Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                 -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;accessor            lKVpMawotXg1fXcgRvpAOAwQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;creation_time       1694873434
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;creation_ttl        768h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;display_name        github-chechiachang
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;entity_id           5d8af1ab-53a2-e1c5-61bf-bb0b6c7d190f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;expire_time         2023-10-18T22:10:34.812089+08:00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explicit_max_ttl    0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;id                  hvs.CAESI...ncU0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;issue_time          2023-09-16T22:10:34.812099+08:00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meta                map[org:chechia-net username:chechiachang]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;num_uses            0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;orphan              true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path                auth/github/login
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies            [default]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;renewable           true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ttl                 767h54m27s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;type                service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨˜å¾—æˆ‘å€‘å»ºç«‹ team çš„ policy = default + application å—ï¼Ÿä½ å¯ä»¥åœ¨ github ä¸ŠæŠŠ user åŠ å…¥åˆ° team/sre&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚æˆ‘å€‘æŠŠ chechiachang åŠ å…¥åˆ° org/chechia-net çš„ team/sre&lt;/p&gt;
&lt;p&gt;ç•¶å‰ç™»å…¥ session æ¬Šé™å°šæœªæ›´æ–°ï¼Œæˆ‘å€‘ç›´æ¥é‡æ–°ç™»å…¥ä¸€æ¬¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;github
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œå¯ä»¥çœ‹è¦‹ç™»å…¥å¾Œçš„ policy æ¬Šé™å¢åŠ æˆç‚º default + application&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GitHub Personal Access Token (will be hidden):
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! You are now authenticated. The token information displayed below
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;is already stored in the token helper. You do NOT need to run &amp;#34;vault login&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;again. Future Vault requests will automatically use this token.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                    Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                    -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                  hvs.CAES...RcmE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor         6DbsDizOenhCuWMmUWspTZwp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration         768h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable        true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies         [&amp;#34;application&amp;#34; &amp;#34;default&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies      []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies               [&amp;#34;application&amp;#34; &amp;#34;default&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_meta_org         chechia-net
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_meta_username    chechiachang
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šæ˜¯é€é github/ auth methods&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®¡ç†è€…è¨­å®š github/ method config&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è€… chechiachangï¼Œä½¿ç”¨ github/ method login&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨çš„æ¬Šé™ç®¡ç†æ˜¯ä¾ç…§ github org / team ä¾†ç®¡ç†ï¼Œvault ä¸¦æ²’æœ‰ç´€éŒ„ team èˆ‡ä½¿ç”¨è€…è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¸…ç†ç§»é™¤-auth-methods&#34;&gt;æ¸…ç†ï¼šç§»é™¤ auth methods&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ root token å†æ¬¡é€²è¡Œç™»éŒ„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Token (will be hidden):
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! You are now authenticated. The token information displayed below
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;is already stored in the token helper. You do NOT need to run &amp;#34;vault login&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;again. Future Vault requests will automatically use this token.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                  Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                  -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                hvs.J80w...mjoh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor       DaI1V1rq9tKZX5EaO4AfMI26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration       âˆ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable      false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies       [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies    []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies             [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ’¤éŠ· github/ auth methods ç”¢ç”Ÿçš„ token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token revoke -mode path auth/github
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Revoked token &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; it existed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server logï¼Œå°æ–¼ auth/github è·¯å¾‘çš„æ‰€æœ‰ç™»éŒ„ç”Ÿæˆçš„ä»¤ç‰Œéƒ½å·²è¢«æ’¤éŠ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-16T22:25:06.793+0800 [INFO]  expiration: revoked lease: lease_id=auth/github/login/h71720c9bc6fed61d459da4b172dc518a6d55b1dd33c70103cf0b12eb42d7741a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-16T22:25:06.793+0800 [INFO]  expiration: revoked lease: lease_id=auth/github/login/hd2b110a8eda38814ac0e3ba7ccb926e75205c5065480c9c2675ae5f2860f9f97
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰èº«ä»½é©—è­‰æ–¹æ³•ï¼Œé™¤äº† token èº«ä»½é©—è­‰æ–¹æ³•ï¼Œéƒ½å¯ä»¥è¢«åœç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœç”¨ github èº«ä»½é©—è­‰æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth disable github
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Disabled the auth method &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; it existed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at: github/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault server log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-16T22:27:42.040+0800 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  core: disabled credential backend: &lt;span class=&#34;nv&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;auth/github/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰ä½¿ç”¨æ­¤èº«ä»½é©—è­‰æ–¹æ³•é€²è¡Œç™»éŒ„ç”Ÿæˆçš„tokenéƒ½å·²è¢«æ’¤éŠ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¸…ç†-github&#34;&gt;æ¸…ç† github&lt;/h3&gt;
&lt;p&gt;å¦‚æœæœ‰å»ºç«‹ org / team / github personal access token çš„è©±ï¼Œè¨˜å¾—ç§»é™¤ä»–&lt;/p&gt;
&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-authentication&lt;/a&gt;
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/github&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/auth/github&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 05: Authentication</title>
      <link>https://chechia.net/zh-hant/post/2023-09-16-vault-workshop-authentication/</link>
      <pubDate>Thu, 14 Sep 2023 01:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-16-vault-workshop-authentication/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-05authentication&#34;&gt;Day 05ï¼šAuthentication&lt;/h1&gt;
&lt;p&gt;åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œä½ å·²ç¶“å‰µå»ºäº†ç¬¬ä¸€å€‹ç§˜å¯†ï¼Œäº†è§£äº†ç§˜å¯†å¼•æ“ï¼Œä¸¦åœ¨ä»¥é–‹ç™¼æ¨¡å¼å•Ÿå‹•çš„ Vault æœå‹™å™¨ä¸­æ¢ç´¢äº†å‹•æ…‹ç§˜å¯†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹ä¾†çš„å…§å®¹ä¸­ï¼Œæˆ‘å€‘å°‡æ·±å…¥ç ”ç©¶ä½¿ç”¨ Vault token å’Œ GitHub æ†‘è­‰é€²è¡Œèº«ä»½é©—è­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;token-èº«ä»½é©—è­‰&#34;&gt;Token èº«ä»½é©—è­‰&lt;/h3&gt;
&lt;p&gt;Token èº«ä»½é©—è­‰å·²è‡ªå‹•å•Ÿç”¨ã€‚ç•¶ä½ å•Ÿå‹•é–‹ç™¼æ¨¡å¼æœå‹™å™¨æ™‚ï¼Œè¼¸å‡ºé¡¯ç¤ºäº† Root tokenã€‚Vault CLI å¾ &lt;code&gt;$VAULT_TOKEN&lt;/code&gt; ç’°å¢ƒè®Šæ•¸ä¸­è®€å– Root tokenã€‚é€™å€‹æ ¹ token å¯ä»¥åœ¨ Vault å…§åŸ·è¡Œä»»ä½•æ“ä½œï¼Œå› ç‚ºå®ƒè¢«åˆ†é…äº† Root policy æ¬Šé™ã€‚å…è¨±çš„æ¬Šé™ä¸­åŒ…å«å‰µå»ºæ–°çš„ tokenã€‚&lt;/p&gt;
&lt;p&gt;ç¾åœ¨ï¼Œè®“æˆ‘å€‘å‰µå»ºä¸€å€‹æ–°çš„ tokenã€‚&lt;/p&gt;
&lt;p&gt;å•Ÿå‹•å…¨æ–°çš„ dev Vault Server&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault server -dev
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œserver log å›å‚³ dev æ¨¡å¼çš„è­¦å‘Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;and starts unsealed with a single unseal key. The root token is already
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;authenticated to the CLI, so you can immediately begin using Vault.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# è­¦å‘Šï¼å·²å•Ÿç”¨é–‹ç™¼æ¨¡å¼ï¼åœ¨æ­¤æ¨¡å¼ä¸‹ï¼ŒVaultå®Œå…¨é‹è¡Œåœ¨å…§å­˜ä¸­ï¼Œä½¿ç”¨å–®å€‹unseal keyè§£å°ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# root tokenå·²è¢«CLIé©—è­‰ï¼Œå› æ­¤ä½ å¯ä»¥ç«‹å³é–‹å§‹ä½¿ç”¨Vaultã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You may need to set the following environment variables:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    $ export VAULT_ADDR=&amp;#39;http://127.0.0.1:8200&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ä»¥ä¸‹é¡¯ç¤ºäº†unseal key å’Œ root tokenï¼Œä»¥é˜²ä½ æƒ³è¦å°å­˜/è§£å°Vaultï¼Œæˆ–é‡æ–°é€²è¡Œèº«ä»½é©—è­‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The unseal key and root token are displayed below in case you want to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    seal/unseal the Vault or re-authenticate.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# dev æ¨¡å¼é è¨­é…ç½®çš„ unseal key èˆ‡ root token
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Unseal Key: QDUAuY7Kltsc/3bVwUYF39u8aEFgWNRs/1D5yxFtim4=
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Root Token: hvs.J30e...0DJaN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# é–‹ç™¼æ¨¡å¼çµ•ä¸æ‡‰åœ¨ç”Ÿç”¢å®‰è£ä¸­ä½¿ç”¨ï¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Development mode should NOT be used in production installations!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¾æ“šæç¤º export éœ€è¦çš„è®Šæ•¸&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ dev mode ä¸‹ï¼Œæœªä½¿ç”¨ token ä¹Ÿå¯ä»¥å­˜å– Vault Server ä¸­çš„è³‡æ–™ï¼Œé€™æ˜¯å› ç‚º vault server åœ¨å•Ÿç”¨æ™‚ï¼Œé è¨­ä½¿ç”¨ token helperï¼Œå°‡ root token å¯«å…¥åˆ° local filesystem&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/commands/token-helper&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vault token helper èªªæ˜&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼Œæª¢æŸ¥å„²å­˜æ–¼æœ¬åœ°çš„ vault token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat ~/.vault-token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hvs.J30e...0DJaN%
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault CLI è‡ªå‹•å–ç”¨æœ¬åœ°å„²å­˜çš„ root tokenï¼Œæ‰€ä»¥å·²ç¶“è‡ªå‹•å®Œæˆ authenticationï¼Œä¸ç”¨é¡å¤–é€²è¡Œ authenticationï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Vault&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Vault æ™‚ï¼Œé ˆé¡å¤–æ³¨æ„æœ¬åœ°å„²å­˜çš„ token&lt;/p&gt;
&lt;h3 id=&#34;é¿å…-dev-æ¨¡å¼ä¸‹å„²å­˜-root-token&#34;&gt;é¿å… dev æ¨¡å¼ä¸‹å„²å­˜ root token&lt;/h3&gt;
&lt;p&gt;Vault dev server è‡ªå‹•å¯«å…¥ root tokenï¼Œè®“é–‹ç™¼ Vault åŠŸèƒ½æ™‚ååˆ†ä¾¿åˆ©ã€‚ç„¶è€Œåœ¨è³‡è¨Šå®‰å…¨çš„é ˜åŸŸï¼Œä¾¿åˆ©å¾€å¾€ä»£è¡¨è‘—é¢¨éšªã€‚åœ¨é dev Server ç’°å¢ƒä¸­ï¼Œæˆ‘å€‘æœƒåš´æ ¼æ§åˆ¶æ‰€æœ‰ token çš„æ›éšªç¨‹åº¦ï¼Œç‰¹åˆ¥æ˜¯ root tokenï¼Œæ ¹æœ¬ä¸è©²è¢« print å‡ºï¼Œç•¶ç„¶ä¹Ÿè¬è¬ä¸èƒ½å„²å­˜åœ¨æœ¬åœ°é›»è…¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¾æ“šä½ çš„é–‹ç™¼éœ€æ±‚ï¼Œä½ å¯èƒ½ä¸å¸Œæœ› dev æ¨¡å¼ä¸‹ï¼Œlong-live æ°¸ä¹…æœ‰æ•ˆçš„ root token å„²å­˜åœ¨æœ¬åœ°é›»è…¦ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ -dev-no-store-token flag ä¾†é¿å… Vault dev server æš´éœ² root tokenã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault server -dev -dev-no-store-token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;and starts unsealed with a single unseal key. The root token is already
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;authenticated to the CLI, so you can immediately begin using Vault.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You may need to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; the following environment variables:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    $ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The unseal key and root token are displayed below in &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; you want to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;seal/unseal the Vault or re-authenticate.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key: hNi8T3YctTZrLYlKezLAJttfiF97D1Vy7Tq+HMM3y9w&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Root Token: hvs.qCqY...p89KYv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Development mode should NOT be used in production installations!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥æª¢æŸ¥æœ¬åœ°ä½¿å¦æœ‰å„²å­˜çš„çš„ vault token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat ~/.vault-token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat: /Users/che-chia/.vault-token: No such file or directory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œè©¦åœ–åœ¨æ²’æœ‰ .vault-token çš„ç‹€æ…‹ä¸‹ï¼Œå­˜å– Vault Server&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œæ²’æœ‰åˆæ³•çš„ access tokenï¼ŒVault server å›å‚³ 403 æ¬Šé™è¢«æ‹’&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error listing secrets engines: Error making API request.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: GET http://127.0.0.1:8200/v1/sys/mounts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: 403. Errors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;authentication&#34;&gt;Authentication&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ vault dev Server log ä¸­å›å‚³çš„ root token ä¾†å­˜å– Vault server&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥å°‡ token åœ¨å¯«å› .vault-tokenï¼Œé€™æ˜¯æœ€æ–¹ä¾¿ï¼Œä¹Ÿæœ€å±éšª&lt;/p&gt;
&lt;p&gt;å»ºè­°ï¼šæ°¸é ä¸è¦å„²å­˜ root token åœ¨æœ¬åœ°é›»è…¦ä¸Šã€‚éå¸¸å®¹æ˜“éºå¿˜è‡ªå·±æœ¬åœ°æœ‰å„²å­˜ root tokenã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; hvs.qCqY...p89KYv &amp;gt; ~/.vault-token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦ä¸€å€‹æ–¹å¼æ˜¯ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ &lt;code&gt;VAULT_TOKEN&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VAULT_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hvs.qCqY...p89KYv vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æ˜¯åœ¨ CLI å‰é¢æ’å…¥ç’°å¢ƒè®Šæ•¸ï¼Œä¸‹é¢æ˜¯ export &lt;code&gt;VAULT_TOKEN&lt;/code&gt; åˆ°ç•¶å‰ session çš„ç’°å¢ƒè®Šæ•¸&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hvs.qCqY...p89KYv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Type         Accessor              Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ----         --------              -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_9cc57bcf    per-token private secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_41faabef     identity store
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/       kv           kv_fca914b5           key/value secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys/          system       system_5dd83198       system endpoints used &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; control, policy and debugging
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥æª¢æŸ¥ç›®å‰ç’°å¢ƒè®Šæ•¸ä¸­ï¼Œèˆ‡ Vault æœ‰é—œçš„ env&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;env &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep VAULT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://127.0.0.1:8200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VAULT_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hvs.qCqY...p89KYv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç•¶ç„¶ï¼Œ&lt;code&gt;VAULT_TOKEN&lt;/code&gt; çš„å­˜åœ¨æ™‚é–“è¶Šä¹…ï¼Œtoken æ›éšªçš„æ©Ÿç‡å°±è¶Šé«˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¾ˆå®¹æ˜“å¿˜è¨˜ &lt;code&gt;VAULT_TOKEN&lt;/code&gt; æœ‰å­˜åœ¨çš„ç’°å¢ƒè®Šæ•¸ã€‚&lt;/p&gt;
&lt;h3 id=&#34;vault-token-é›·é»&#34;&gt;VAULT TOKEN é›·é»&lt;/h3&gt;
&lt;p&gt;workshop è‡³ä»Šï¼Œä½ ç›®å‰åªæœ‰ä¸€å° vault dev serverï¼Œè€Œä¸”è£¡é¢ä¸¦æ²’æœ‰ä»»ä½•çš„æ©Ÿå¯†è³‡æ–™ï¼Œé€™å€‹ vault server å¯ä»¥éš¨æ™‚æ‹‹æ£„ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œåœ¨å¯¦å‹™ä¸Šï¼ŒVault ç®¡ç†å“¡æ‰‹ä¸Šå¯èƒ½æœƒæœ‰å¤šå€‹ Vault server éœ€è¦ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³åƒä½ æœ‰ dev / stag / prod çš„ serverï¼ŒæŸä¸€å¤©ä½ æ­£åœ¨ dev é–‹ç™¼ä¸€å€‹æ–°åŠŸèƒ½ï¼Œç”±æ–¼æœ¬åœ°æœ‰ &lt;code&gt;VAULT_TOKEN&lt;/code&gt; èˆ‡ &lt;code&gt;VAULT_ADDR&lt;/code&gt;ï¼Œä½ ä¸ç–‘æœ‰ä»–çš„åœ¨é€™å° server ä¸Šé‹è¡Œè¨±å¤šæ¸¬è©¦çš„æŒ‡ä»¤ï¼ŒåŒ…å«æ–°å¢ä¸€å°æ¸¬è©¦ secretï¼Œåˆªåˆªæ”¹æ”¹ç¾æœ‰çš„ secretã€‚&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œä½ çš„æœ¬èƒ½å¿½ç„¶è¦ºå¾—æ€ªæ€ªçš„ï¼Œæˆ‘æ²’æœ‰è¨­ç½®ä»»ä½• vault envï¼Œç‚ºä½•å¯ä»¥ç›´æ¥å­˜å– dev serverï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä½ æ‹‰å‡º env çœ‹ï¼Œç™¼ç¾æ˜¯ production server çš„ addr + tokenï¼Œä¸Šæ¬¡é€²å…¥ production server æ™‚çš„ sessionï¼Œé‚„å­˜æœ‰æœ‰æ•ˆçš„ addr èˆ‡ token&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://vault.prod.chechia.net
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VAULT_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;this-is-prod-token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ éº»ç…©å¤§äº†&lt;/p&gt;
&lt;p&gt;å¿ƒå¾—ï¼šæ°¸é ä¸è¦å„²å­˜é•·æ•ˆæœŸçš„ token åœ¨æœ¬åœ°ã€‚æœ¬ workshop æœƒä¸æ–·åœ°å¼·èª¿ï¼Œæé†’å„ç¨®æ“ä½œä¸­çš„è³‡å®‰é¢¨éšªï¼Œè«‹å„ä½å­¸ç¿’éç¨‹ä¸­å°±é¤Šæˆè‰¯å¥½ç¿’æ…£ï¼Œä»¥å…æ–¹ä¾¿ä¸€æ™‚ï¼Œéºæ†¾çµ‚èº«ã€‚&lt;/p&gt;
&lt;h3 id=&#34;root-token&#34;&gt;root token&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/concepts/tokens#root-tokens&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/concepts/tokens#root-tokens&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;root tokenæ˜¯é™„å¸¶root policyçš„tokenã€‚root tokenå¯ä»¥åœ¨Vaultä¸­åŸ·è¡Œä»»ä½•æ“ä½œã€‚ä»»ä½•æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå®ƒå€‘æ˜¯Vaultä¸­å”¯ä¸€å¯ä»¥è¨­ç½®ç‚ºæ°¸ä¸éæœŸï¼Œä¸”ç„¡éœ€é€²è¡Œä»»ä½•çºŒè¨‚çš„ token é¡å‹ã€‚ç”±æ–¼ root token æ¬Šé™å¦‚æ­¤å¤§ï¼ŒVault è¨­è¨ˆä¸Šåˆ»æ„è®“å‰µå»ºroot token å¾ˆå›°é›£ï¼›å¯¦éš›ä¸Šåªæœ‰ä¸‰ç¨®æ–¹æ³•å¯ä»¥å‰µå»ºroot tokenï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ vault operator init æ™‚ç”Ÿæˆçš„åˆå§‹root token - æ­¤tokenä¸æœƒéæœŸ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨å¦ä¸€å€‹root token å‰µå»º root tokenã€‚é€™é»æœ‰å€‹é™åˆ¶ï¼šä½¿ç”¨æœ‰é™æœŸçš„root tokenï¼Œç„¡æ³•å‰µå»ºæ°¸ä¸éæœŸçš„root token&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æ“æœ‰ unseal keys quorumçš„æ¬Šé™ä¸‹ï¼Œä½¿ç”¨ vault operator generate-root ä¾†å‰µå»ºroot token&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;root tokenåœ¨é–‹ç™¼ä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ production ç’°å¢ƒä¸­æ‡‰è©²éå¸¸è¬¹æ…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å¯¦ä¸Šï¼ŒVaultåœ˜éšŠå»ºè­° root token åªèƒ½é€²è¡Œå¿…è¦çš„åˆå§‹è¨­ç½®ï¼Œé€šå¸¸æ˜¯è¨­ç½®èº«ä»½é©—è­‰æ–¹æ³•(auth method)ï¼Œå’Œå¿…è¦çš„ policyï¼Œä»¥å…è¨±ç®¡ç†å“¡ç²å–æ›´æœ‰é™çš„tokenã€‚æˆ–æ˜¯ç·Šæ€¥æƒ…æ³ä¸‹ä½¿ç”¨root tokenï¼Œä¸¦åœ¨ä¸å†éœ€è¦æ™‚ç«‹å³æ’¤éŠ·(revoke)ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœéœ€è¦æ–°çš„root tokenï¼Œå¯ä»¥ä½¿ç”¨ operator generate-root æŒ‡ä»¤ï¼Œä½¿ç”¨ç›¸é—œçš„ API endpointå³æ™‚ç”Ÿæˆã€‚&lt;/p&gt;
&lt;p&gt;åŒæ™‚ï¼Œç•¶root tokenè™•æ–¼æ´»å‹•ç‹€æ…‹æ™‚ï¼Œå»ºè­°åœ˜éšŠä¸­æä¾›å¤šäººä¸€èµ·å”ä½œï¼Œå…±åŒæª¢æŸ¥ terminal sessionï¼Œé¤Šæˆä¸€ç¨®è‰¯å¥½çš„å®‰å…¨å¯¦è¸ã€‚é€™æ¨£å¤šäººå¯ä»¥é©—è­‰ä½¿ç”¨root tokenåŸ·è¡Œçš„ä»»å‹™ï¼Œä»¥åŠé€™äº›ä»»å‹™å®Œæˆå¾Œï¼Œç«‹å³æ’¤éŠ·äº†è©²tokenã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-root-token-ç”¢ç”Ÿ-short-live-token&#34;&gt;ä½¿ç”¨ root token ç”¢ç”Ÿ short-live token&lt;/h3&gt;
&lt;p&gt;root token é è¨­é…ç½® root policyï¼Œæˆ‘å€‘å¯ä»¥ç”¢ç”Ÿæ¬Šé™è¼ƒå°çš„ tokenï¼Œä¸¦æŒ‡é…ç½®æœ€å°å¿…è¦æ¬Šé™(least privilege)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;VAULT_TOKEN=hvs.qCqY...p89KYv vault token create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                  Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                  -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                hvs.FbAeX...kjBIp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor       rPOOSI06WGnFo9MVOvS8luhn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration       âˆ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable      false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies       [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies    []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies             [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å·²å‰µå»ºtokenï¼Œè¼¸å‡ºä¸­ä»¥key valueçš„è¡¨æ ¼æè¿°äº†æ­¤tokenã€‚å‰µå»ºçš„tokenåœ¨æ­¤è™•é¡¯ç¤ºç‚º hvs.FbAeX&amp;hellip;kjBIp&lt;/p&gt;
&lt;p&gt;æ­¤tokenæ˜¯root tokençš„å­tokenï¼Œä¸¦ä¸”é è¨­æƒ…æ³ä¸‹ï¼Œå®ƒæœƒç¹¼æ‰¿å…¶ parent tokençš„policy æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;tokenæ˜¯æ ¸å¿ƒèº«ä»½é©—è­‰æ–¹æ³•(core auth method)ã€‚ä½ å¯ä»¥ä½¿ç”¨ç”Ÿæˆçš„tokenä¾† login Vaultï¼Œåªéœ€åœ¨æç¤ºæ™‚è¤‡è£½ä¸¦ç²˜è²¼å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ç™»å…¥ vault&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å›å‚³çš„è¼¸å…¥ä»¤ä¸­è¼¸å…¥æ–°ç”¢ç”Ÿçš„ child token hvs.FbAeX&amp;hellip;kjBIp&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING! The VAULT_TOKEN environment variable is set! The value of this
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;variable will take precedence&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; this is unwanted please &lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; VAULT_TOKEN or
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;update its value accordingly.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# è­¦å‘Šï¼å·²è¨­ç½® VAULT_TOKEN ç’°å¢ƒè®Šæ•¸ï¼æ­¤è®Šæ•¸çš„å€¼å°‡å„ªå…ˆè€ƒæ…®ï¼›å¦‚æœä¸éœ€è¦æ­¤è¨­ç½®ï¼Œè«‹å–æ¶ˆè¨­ç½® VAULT TOKEN æˆ–ç›¸æ‡‰åœ°æ›´æ–°å…¶å€¼ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±æ–¼åœ¨å‰é¢çš„æ“ä½œä¸­ï¼Œç’°å¢ƒè®Šæ•¸ä¸­ä»å¸¶æœ‰ &lt;code&gt;VAULT_TOKEN&lt;/code&gt;ï¼Œè€Œä¸”æ˜¯æ›´é«˜æ¬Šé™çš„æ°¸ä¸éæœŸ root tokenï¼Œvault CLI åµæ¸¬åˆ° VAULT TOKEN envï¼Œè·³å‡ºè­¦å‘Šã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é€éä»¥ä¸‹æŒ‡ä»¤æ¸…é™¤ &lt;code&gt;VAULT_TOKEN&lt;/code&gt; ç’°å¢ƒè®Šæ•¸&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; VAULT_TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œå†æ¬¡åŸ·è¡Œ vault loginï¼Œåœ¨å›å‚³çš„è¼¸å…¥ä»¤ä¸­è¼¸å…¥æ–°ç”¢ç”Ÿçš„ child token hvs.FbAeX&amp;hellip;kjBIp&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œé¡¯ç¤ºæˆåŠŸç™»å…¥ï¼Œä¸¦å›å‚³ token çš„ç›¸é—œè¨Šæ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Token (will be hidden):
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! You are now authenticated. The token information displayed below
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;is already stored in the token helper. You do NOT need to run &amp;#34;vault login&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;again. Future Vault requests will automatically use this token.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                  Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                  -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                hvs.FbAeX...kjBIp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor       rPOOSI06WGnFo9MVOvS8luhn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration       âˆ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable      false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies       [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies    []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies             [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤tokenæ˜¯root tokençš„å­tokenï¼Œç¹¼æ‰¿å…¶ parent tokençš„policy æ¬Šé™ï¼Œä¹Ÿå°±æ˜¯ rootã€‚æœ¬èº«æ˜¯ç„¡æ•ˆæœŸé™åˆ¶çš„æ°¸ä¹… root tokenã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‰µå»ºä¸€æŠŠ tokenï¼Œæ­¤æ™‚ç”±æ–¼ vault loginï¼Œé€²å…¥ç™»å…¥ç‹€æ…‹ï¼Œtoken å·²ç¶“å­˜åœ¨æœ¬åœ°ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token create
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;outputï¼Œç¬¬äºŒéš» token ç‚º hvs.FDjvyRFXo&amp;hellip;QVFGã€‚æ¯ä¸€éš» token éƒ½æ˜¯ä¸é‡è¤‡çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                  Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                  -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token                hvs.FDjvyRFXo...QVFG
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_accessor       gLe7IrUMUq4eb2pZWVdUhbHv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_duration       âˆ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_renewable      false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token_policies       [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity_policies    []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policies             [&amp;#34;root&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;revoke-æ’¤éŠ·-token&#34;&gt;revoke æ’¤éŠ· token&lt;/h3&gt;
&lt;p&gt;ç•¶æˆ‘å€‘ä¸å†éœ€è¦ä½¿ç”¨ token æ™‚ï¼Œæœ€å¥½ç›¡å¿«æ’¤éŠ· revoke token&lt;/p&gt;
&lt;p&gt;ç›®å‰çš„ token æ¨¹ç‹€çµæ§‹&lt;/p&gt;
&lt;p&gt;åˆå§‹ root token (å•Ÿå‹• dev Server æ™‚é è¨­ç”¢ç”Ÿçš„)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;child: hvs.FbAeX&amp;hellip;kjBIp
&lt;ul&gt;
&lt;li&gt;grandchild: hvs.FDjvyRFXo&amp;hellip;QVFG&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨æŒ‡ä»¤ï¼Œæ’¤éŠ·ç¬¬ä¸€æŠŠç”¢ç”Ÿçš„ token (child)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault token revoke hvs.FbAeX...kjBIp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;CLI outputï¼Œé¡¯ç¤º token å·²ç¶“æ’¤éŠ·&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Revoked token &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; it existed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ™‚ï¼Œvault server log ç´€éŒ„ revoked lease&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2023-09-16T21:29:21.464+0800 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;INFO&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  expiration: revoked lease: &lt;span class=&#34;nv&#34;&gt;lease_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;auth/token/create/hf153f5e80ed722f6816f592032a43906a5606a889bab4c13ff3368c9a1b95b69
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚„è¨˜å¾—æˆ‘å€‘æ˜¯ä½¿ç”¨åœ°ä¸€æŠŠç”¢ç”Ÿçš„ token (child) login çš„å—ï¼Ÿç›®å‰çš„ç™»å…¥ç•¶ç„¶ä¹Ÿéš¨è‘— token å¤±æ•ˆï¼Œå˜—è©¦å­˜å–å›å‚³ 403 æ¬Šé™è¢«æ‹’&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-zed&#34; data-lang=&#34;zed&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;vault&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;listing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;engines&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;making&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;API&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//127.0.0.1:8200/v1/sys/mounts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Errors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;permission&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;denied&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å˜—è©¦é‡æ–° loginï¼Œä½¿ç”¨åœ°ä¸€æŠŠç”¢ç”Ÿçš„ token (child) ä¸€æ¨£è¢«æ‹’&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-zed&#34; data-lang=&#34;zed&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;will&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hidden&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authenticating&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;looking&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;up&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;making&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;API&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//127.0.0.1:8200/v1/auth/token/lookup-self
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Errors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;permission&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;denied&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ’¤éŠ·token æ™‚ï¼Œä¹Ÿæœƒä¸€ä½µæ’¤éŠ·ä½¿ç”¨é€™æŠŠ token ç”¢ç”Ÿçš„å­ token (grandchild)&lt;/p&gt;
&lt;p&gt;å˜—è©¦é‡æ–° loginï¼Œä½¿ç”¨ç¬¬äºŒæŠŠç”¢ç”Ÿçš„ token (grandchild) ä¸€æ¨£è¢«æ‹’&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-zed&#34; data-lang=&#34;zed&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;will&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hidden&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authenticating&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;looking&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;up&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;making&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;API&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//127.0.0.1:8200/v1/auth/token/lookup-self
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Errors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;permission&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;denied&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç‚ºä½•ç¸½æ˜¯è¦ä½¿ç”¨-root-token&#34;&gt;ç‚ºä½•ç¸½æ˜¯è¦ä½¿ç”¨ root token&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢è¬›äº† vault æ ¸å¿ƒçš„ token auth methodï¼Œç›¸ä¿¡è®€è€…ä¸€å®šæœ‰ä¸€å€‹å¥‡æ€ªçš„æ„Ÿè¦º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ€é–‹å§‹ login éœ€è¦ token&lt;/li&gt;
&lt;li&gt;ç”¢ç”Ÿ token åœ¨å»ç”¢ç”Ÿæ–°çš„ token&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™æ¨£ç”¢ç”Ÿ token çš„ admin ä¸å°±éœ€è¦å°‡ token å…ˆå‚³çµ¦ä½¿ç”¨è€…ï¼Œä½¿ç”¨è€…æ‰èƒ½ç™»å…¥å—ï¼Ÿé€™æ¨£å‚³é token çš„è¡Œç‚ºï¼Œä¸æ˜¯åè€Œå¢åŠ æ›´å¤§çš„æ›éšªã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£çœŸçš„æœ‰æ¯”ä¸€èˆ¬ä½¿ç”¨ username password ç™»å…¥çš„æ–¹æ³•æ›´å®‰å…¨å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„æƒ³æ³•éƒ½æ˜¯æœ‰é“ç†çš„ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œå…‰ä½¿ç”¨ token auth methods æ˜¯ç„¡æ³•æ»¿è¶³æˆ‘å€‘çš„å®‰å…¨éœ€æ±‚ã€‚é€™äº›å®‰å…¨éœ€æ±‚ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»– auth method æ–¹æ³•ä¾†è§£æ±ºï¼Œè€Œ vault å¼·å¤§ä¹‹è™•ä¾¿æ˜¯æ”¯æ´çš„è¨±å¤š auth methodï¼Œå°‡ vault çš„å®‰å…¨å»ºç«‹åœ¨å…¶ä»–æ›´ç©©å®šçš„æœå‹™ä¸Šï¼Œä¾‹å¦‚ github / aws / azure / gcp / kubernetes ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€ç¯‡ï¼Œæˆ‘å€‘å°±ä¾†å¯¦ä½œ github auth methodã€‚&lt;/p&gt;
&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µéƒ¨åˆ†å…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-authentication&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¸è¦ä½¿ç”¨æ•¬èªï¼Œç¿»è­¯çµæœä¸­è‹¥å‡ºç¾&amp;#34;æ‚¨&amp;#34;ï¼Œè«‹ç”¨&amp;#34;ä½ &amp;#34;å–ä»£&amp;#34;æ‚¨&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“šåº«&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™åº«&amp;#34;ï¼Œå°‡ &amp;#34;æ•¸æ“š&amp;#34; æ”¹ç‚º &amp;#34;è³‡æ–™&amp;#34;ï¼Œå°‡ &amp;#34;è¨ªå•&amp;#34; æ”¹ç‚º &amp;#34;å­˜å–&amp;#34;ï¼Œå°‡ &amp;#34;æºä»£ç¢¼&amp;#34; æ”¹ç‚º &amp;#34;åŸå§‹ç¢¼&amp;#34;ï¼Œå°‡ &amp;#34;ä¿¡æ¯&amp;#34; æ”¹ç‚º &amp;#34;è³‡è¨Š&amp;#34;ï¼Œå°‡ &amp;#34;å‘½ä»¤&amp;#34; æ”¹ç‚º &amp;#34;æŒ‡ä»¤&amp;#34;ï¼Œå°‡ &amp;#34;ç¦ç”¨&amp;#34; æ”¹ç‚º &amp;#34;åœç”¨&amp;#34;ï¼Œå°‡ &amp;#34;é»˜èª&amp;#34; æ”¹ç‚º &amp;#34;é è¨­&amp;#34;ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 04: Secret Engine KV V2</title>
      <link>https://chechia.net/zh-hant/post/2023-09-15-vault-workshop-secret-engine-kv-v2/</link>
      <pubDate>Thu, 14 Sep 2023 00:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-15-vault-workshop-secret-engine-kv-v2/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-04secret-engine-kv-v2&#34;&gt;Day 04ï¼šSecret Engine KV V2&lt;/h1&gt;
&lt;p&gt;KVç§˜å¯†å¼•æ“ï¼Œç”¨æ–¼åœ¨Vaultçš„å·²é…ç½®ç‰©ç†Storageä¸­ï¼Œå­˜å„²ä»»æ„ç§˜å¯†ã€‚&lt;/p&gt;
&lt;p&gt;key åç¨±å¿…é ˆå§‹çµ‚æ˜¯å­—ç¬¦ä¸²ã€‚å¦‚æœä½ ç›´æ¥é€šéCLIç·¨å¯«éå­—ä¸² valueï¼Œå®ƒå€‘å°‡è¢«è½‰æ›ç‚ºå­—ä¸²ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šéå¾JSONæ–‡ä»¶ä¸­å°‡key-value pairå¯«å…¥Vaultï¼Œæˆ–ä½¿ç”¨HTTP APIä¾†ä¿ç•™éå­—ä¸² valueã€‚&lt;/p&gt;
&lt;p&gt;æ­¤ç§˜å¯†å¼•æ“éµç…§ACL policyä¸­ï¼Œå‰µå»º(create)å’Œæ›´æ–°(update)æ¬Šé™ä¹‹é–“çš„è¨­å®šã€‚å®ƒé‚„æ”¯æŒpatchåŠŸèƒ½ï¼Œç”¨æ–¼è¡¨ç¤ºéƒ¨åˆ†æ›´æ–°(patch)ï¼Œè€Œæ›´æ–°åŠŸèƒ½(update)å‰‡è¡¨ç¤ºå®Œå…¨è¦†è“‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¨­ç½®&#34;&gt;è¨­ç½®&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•¸ç§˜å¯†å¼•æ“å¿…é ˆåœ¨åŸ·è¡Œå…¶åŠŸèƒ½ä¹‹å‰äº‹å…ˆé…ç½®ã€‚é€™äº›æ­¥é©Ÿé€šå¸¸ç”±æ“ä½œäººå“¡æˆ–é…ç½®ç®¡ç†å·¥å…·å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;å•Ÿç”¨v2 kvç§˜å¯†å¼•æ“ï¼š&lt;/p&gt;
&lt;p&gt;å•Ÿå‹•ä¸€å€‹ä¹¾æ·¨çš„æœ¬åœ°çš„é–‹ç™¼æ¨¡å¼ Vault Serverï¼Œå…¨æ–°çš„ Vault Server åŒ…å«åº•ä¸‹é è¨­å•Ÿç”¨çš„å¼•æ“&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault server -dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Type         Accessor              Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ----         --------              -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_57a4ca51    per-token private secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_c2ecbd49     identity store
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/       kv           kv_c41afde8           key/value secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys/          system       system_c063e514       system endpoints used &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; control, policy and debugging
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥åœ¨æŒ‡å®šçš„è·¯å¾‘ä¸‹ï¼Œå•Ÿç”¨ä¸€å€‹æ–°çš„ v2 kv ç§˜å¯†å¼•æ“ã€‚è‹¥ä¸æŒ‡å®š -path åƒæ•¸ï¼Œå‰‡é è¨­ path ç‚º typeï¼Œä¹Ÿå°±æ˜¯ path=kvã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kv kv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Type         Accessor              Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ----         --------              -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_57a4ca51    per-token private secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_c2ecbd49     identity store
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kv/           kv           kv_904eee17           n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/       kv           kv_c41afde8           key/value secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys/          system       system_c063e514       system endpoints used &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; control, policy and debugging
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…ï¼Œä½ å¯ä»¥å°‡kv-v2ä½œç‚ºç§˜å¯†å¼•æ“é¡å‹ï¼Œä»¥åƒæ•¸å‚³éï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; kv-v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„æŒ‡ä»¤èˆ‡ä¸‹é¢çš„æŒ‡ä»¤ç­‰æ•ˆï¼Œé‡è¤‡åŸ·è¡Œæœƒå‡ºç¾è·¯å¾‘é‡è¤‡éŒ¯èª¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path kv-v2 -version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; kv-v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error enabling: Error making API request.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: POST http://127.0.0.1:8200/v1/sys/mounts/kv-v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: 400. Errors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* path is already in use at kv-v2/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥åœç”¨ä¸€å€‹ç§˜å¯†å¼•æ“&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets disable kv-v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç‚ºäº†å­¸ç¿’æ•ˆæœï¼Œå¾€å¾Œèª²ç¨‹éƒ½æœƒä½¿ç”¨æ›´å®Œæ•´çš„æŒ‡ä»¤ï¼Œä½œç‚ºç¤ºç¯„ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šå•Ÿç”¨ç§˜å¯†å¼•æ“çš„æŒ‡ä»¤ï¼Œä½ å¯ä»¥åƒè€ƒ vault secrets enable &amp;ndash;help çš„å”åŠ©æŒ‡ä»¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;options&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; TYPE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Enables a secrets engine. By default, secrets engines are enabled at the path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  corresponding to their TYPE, but users can customize the path using the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -path option.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  å•Ÿç”¨ç§˜å¯†å¼•æ“ã€‚é è¨­æƒ…æ³ä¸‹ï¼Œç§˜å¯†å¼•æ“æœƒåœ¨èˆ‡å…¶é¡å‹ç›¸å°æ‡‰çš„è·¯å¾‘å•Ÿç”¨ï¼Œä½†ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -path é¸é …è‡ªè¨‚è·¯å¾‘ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Once enabled, Vault will route all requests which begin with the path to the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  secrets engine.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ä¸€æ—¦å•Ÿç”¨ï¼ŒVault å°‡å°‡æ‰€æœ‰ä»¥è©²è·¯å¾‘é–‹é ­çš„è«‹æ±‚è·¯ç”±åˆ°ç§˜å¯†å¼•æ“ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Enable the AWS secrets engine at aws/:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; aws
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Enable the SSH secrets engine at ssh-prod/:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ssh-prod ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Enable the database secrets engine with an explicit maximum TTL of 30m:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -max-lease-ttl&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;30m database
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Enable a custom plugin &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;after it is registered in the plugin registry&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my-secrets -plugin-name&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my-plugin plugin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  OR &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;preferred way&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      $ vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my-secrets my-plugin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¾ä¸Šé¢çš„å…§å®¹ï¼Œå¯ä»¥çœ‹åˆ°ç§˜å¯†å¼•æ“æ”¯æ´å„ç¨®ä¸åŒçš„ç§˜å¯†é¡å‹ï¼Œä¾‹å¦‚ä»¥ä¸‹éƒ½æ˜¯ä¸€å€‹ç§˜å¯†å¼•æ“é¡å‹ï¼šawsï¼Œsshï¼Œdatabaseï¼Œpluginã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œè«‹ä¸è¦å¼„æ·· path=aws çš„ç§˜å¯†å¼•æ“ï¼Œä»¥åŠ type=aws çš„ç§˜å¯†å¼•æ“ã€‚åº•ä¸‹æ˜¯ä¸€å€‹ååˆ†æ··æ·†çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; --version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; --path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kv-v1 kv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; --version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; --path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kv-v2 kv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list --detailed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Plugin       Accessor              Default TTL    Max TTL    Force No Cache    Replication    Seal Wrap    External Entropy Access    Options           Description                                                UUID                                    Version    Running Version          Running SHA256    Deprecation Status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ------       --------              -----------    -------    --------------    -----------    ---------    -----------------------    -------           -----------                                                ----                                    -------    ---------------          --------------    ------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_57a4ca51    n/a            n/a        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;             &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;                      map&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;             per-token private secret storage                           cee0001e-95f8-efaa-6a9a-a3d5c3573abc    n/a        v1.14.3+builtin.vault    n/a               n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_c2ecbd49     system         system     &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;             replicated     &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;                      map&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;             identity store                                             3b481e0d-1c6d-6698-85c3-c52839b4d6e4    n/a        v1.14.3+builtin.vault    n/a               n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kv-v1/        kv           kv_c8de7a39           system         system     &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;             replicated     &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;                      map&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;version:2&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;    n/a                                                        98289587-5b5d-06f3-c3cf-469e830eda9e    n/a        v0.15.0+builtin          n/a               supported
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kv-v2/        kv           kv_f83d9acd           system         system     &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;             replicated     &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;                      map&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;version:1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;    n/a                                                        5fc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è«‹ä¸è¦åšé€™ç¨®ä¸è‰¯çš„å‘½åï¼Œèª¤å°è‡ªå·±ä¹Ÿèª¤å°åˆ¥äººã€‚ä¸å»ºè­°æŠŠ engine type ç•¶ä½œ pathï¼Œå¯¦å‹™ä¸Šä¹Ÿæ²’æœ‰å¿…è¦é€™å€‹åšã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets disable kv-v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets disable kv-v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨å…¬å¸çµ„ç¹”ï¼Œåœ˜éšŠï¼Œå°ˆæ¡ˆåç¨±ï¼Œä½œç‚º engine path çš„å‘½åï¼Œæ˜¯å€‹ä¸éŒ¯çš„èµ·é»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;org = chechia.net&lt;/li&gt;
&lt;li&gt;team = sre&lt;/li&gt;
&lt;li&gt;project = workshop&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; --version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; --path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop kv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-v2-kv&#34;&gt;ä½¿ç”¨ v2 kv&lt;/h3&gt;
&lt;p&gt;åœ¨ç§˜å¯†å¼•æ“é…ç½®å®Œæˆï¼Œä¸”ç”¨æˆ¶/æ©Ÿå™¨å…·å‚™å…·æœ‰é©ç•¶æ¬Šé™çš„Vault tokenå¾Œï¼Œå®ƒå¯ä»¥ç”Ÿæˆæ†‘è­‰ã€‚KVç§˜å¯†å¼•æ“å…è¨±å°‡ä»»æ„vvalueå¯«å…¥æŒ‡å®šçš„keyã€‚&lt;/p&gt;
&lt;p&gt;åœ¨KV-v2ä¸­ä»ç„¶å¯ä»¥ä½¿ç”¨é¡ä¼¼è·¯å¾‘çš„KV-v1èªæ³•ä¾†å¼•ç”¨ç§˜å¯†ï¼ˆsecret/fooï¼‰ï¼Œä½†æˆ‘å€‘å»ºè­°ä½¿ç”¨-flagçš„èªæ³•ä»¥é¿å…å°‡å…¶éŒ¯èª¤èªç‚ºæ˜¯ç§˜å¯†çš„å¯¦éš›è·¯å¾‘ï¼ˆsecret/data/fooæ˜¯çœŸæ­£çš„è·¯å¾‘ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯«å…¥è®€å–ä»»æ„è³‡æ–™&#34;&gt;å¯«å…¥/è®€å–ä»»æ„è³‡æ–™&lt;/h3&gt;
&lt;p&gt;å¯«å…¥ä»»æ„è³‡æ–™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret &lt;span class=&#34;nv&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;a &lt;span class=&#34;nv&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;b&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T16:48:45.817265Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®€å–ä»»æ„è³‡æ–™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T16:48:45.817265Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;nv&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;===&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key    Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---    -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bar    b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;foo    a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¤šç‰ˆæœ¬æ§åˆ¶&#34;&gt;å¤šç‰ˆæœ¬æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;v2 kv æ”¯æ´è¨˜éŒ„å¤šç‰ˆæœ¬çš„ç§˜å¯†ã€‚è«‹æä¾›å¦ä¸€å€‹ç‰ˆæœ¬ï¼Œä»¥å‰çš„ç‰ˆæœ¬ä»ç„¶å¯è¨ªå•ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é¸æ“‡å‚³é-cas flagä»¥åŸ·è¡Œå¯«å…¥å‰æª¢æŸ¥(check-and-set)ã€‚å¦‚æœæœªè¨­ç½®ï¼Œå°‡ç›´æ¥å…è¨±å¯«å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†ä½¿å¯«å…¥æˆåŠŸï¼Œcaså¿…é ˆè¨­ç½®ç‚ºç§˜å¯†çš„ç•¶å‰ç‰ˆæœ¬ã€‚å¦‚æœè¨­ç½®ç‚º0ï¼Œåªæœ‰åœ¨å¯†é‘°ä¸å­˜åœ¨æ™‚æ‰å…è¨±å¯«å…¥ï¼Œå› ç‚ºæœªè¨­ç½®çš„å¯†é‘°æ²’æœ‰ä»»ä½•ç‰ˆæœ¬ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;é‚„è¦è¨˜ä½ï¼Œsoft delete ä¸æœƒå¾å­˜å„²ä¸­åˆªé™¤ä»»ä½•åº•å±¤ç‰ˆæœ¬æ•¸æ“šã€‚ç‚ºäº†å¯«å…¥ soft delete çš„å¯†é‘°ï¼Œcasåƒæ•¸å¿…é ˆåŒ¹é…å¯†é‘°çš„ç•¶å‰ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -cas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; my-secret &lt;span class=&#34;nv&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;aa &lt;span class=&#34;nv&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;bb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T16:50:26.621978Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®€å–æœƒå›å‚³æœ€æ–°ç‰ˆæœ¬çš„ç§˜å¯†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T16:50:26.621978Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;nv&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;===&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key    Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---    -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bar    bb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;foo    aa
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥ä½¿ç”¨vault kv patchå‘½ä»¤é€²è¡Œéƒ¨åˆ†æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;è©²å‘½ä»¤å°‡é¦–å…ˆå˜—è©¦é€²è¡ŒHTTP PATCHè«‹æ±‚ï¼Œè©²è«‹æ±‚éœ€è¦patch ACLåŠŸèƒ½ã€‚å¦‚æœä½¿ç”¨çš„ token æ²’æœ‰å…è¨±patchåŠŸèƒ½çš„policyï¼Œå‰‡PATCHè«‹æ±‚å°‡å¤±æ•—ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¾åœ¨çš„ç¯„ä¾‹ï¼Œå®Œæ•´çš„PATCHå‘½ä»¤å°‡åŸ·è¡Œè®€å–ã€æœ¬åœ°æ›´æ–°å’Œå¾ŒçºŒå¯«å…¥ï¼Œé€™éœ€è¦è®€å–å’Œæ›´æ–°ACL policyæ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é¸æ“‡å‚³é-cas flag ä»¥åŸ·è¡Œå¯«å…¥å‰æª¢æŸ¥(check-and-set)ã€‚-cas åªæœƒåœ¨åˆå§‹PATCHè«‹æ±‚çš„æƒ…æ³ä¸‹ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv patch -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -cas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; my-secret &lt;span class=&#34;nv&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;bbb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T16:54:03.925959Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vault kv patchå‘½ä»¤é‚„æ”¯æŒä¸€å€‹ -method æ¨™èªŒï¼Œå¯ç”¨æ–¼æŒ‡å®šå…©ç¨® method&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP PATCH&lt;/li&gt;
&lt;li&gt;è®€å–å¾Œå¯«å…¥(read-and-write)
æ”¯æŒçš„å€¼åˆ†åˆ¥æ˜¯patchå’Œrw&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨patchæ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv patch -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;patch -cas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; my-secret &lt;span class=&#34;nv&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;bbb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T17:02:55.522095Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨read-and-write&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨è®€å–å¾Œå¯«å…¥(read-and-write)æµç¨‹ï¼Œå°‡ä½¿ç”¨è®€å–è¿”å›çš„ç§˜å¯†ç‰ˆæœ¬å€¼ï¼Œåœ¨å¾ŒçºŒå¯«å…¥ä¸­ï¼ŒåŸ·è¡Œå¯«å…¥å‰æª¢æŸ¥(check-and-set)ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv patch -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -method&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;rw my-secret &lt;span class=&#34;nv&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ccc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T17:03:37.331182Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ -version flag ä¾†å­˜å–æ›´æ—©çš„ç‰ˆæœ¬&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T16:48:45.817265Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;nv&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;===&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key    Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---    -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bar    b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;foo    a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆªé™¤è³‡æ–™&#34;&gt;åˆªé™¤è³‡æ–™&lt;/h3&gt;
&lt;p&gt;åœ¨åˆªé™¤è³‡æ–™æ™‚ï¼Œæ¨™æº–çš„ vault kv delete å‘½ä»¤å°‡åŸ·è¡Œ soft deletã€‚å®ƒå°‡æ¨™è¨˜ç‰ˆæœ¬ç‚ºå·²åˆªé™¤ä¸¦å¡«å…… &lt;code&gt;deletion_time&lt;/code&gt; timestampã€‚soft delete ä¸æœƒå¾å­˜å„²ä¸­åˆªé™¤åº•å±¤ç‰ˆæœ¬è³‡æ–™ï¼Œé€™å…è¨±ç‰ˆæœ¬å¯ä»¥è¢«é‚„åŸ&lt;/p&gt;
&lt;p&gt;é‚„åŸç‰ˆæœ¬&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv undelete
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åªæœ‰ç•¶ç§˜å¯†çš„ç‰ˆæœ¬æ•¸è¶…é max-versions è¨­ç½®å…è¨±çš„ç‰ˆæœ¬æ•¸æ™‚ï¼Œæˆ–è€…ä½¿ç”¨ vault kv destroy æ™‚ï¼Œç‰ˆæœ¬çš„è³‡æ–™æ‰æœƒæ°¸ä¹…åˆªé™¤ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ destroy å‘½ä»¤æ™‚ï¼Œåº•å±¤ç‰ˆæœ¬è³‡æ–™å°‡è¢«åˆªé™¤ï¼Œä¸¦å°‡å¯†é‘° metadata æ¨™è¨˜ç‚ºå·²éŠ·æ¯€ã€‚å¦‚æœé€šéè¶…é max-versions ä¾†æ¸…ç†ç‰ˆæœ¬ï¼Œå‰‡ç‰ˆæœ¬ metadata ä¹Ÿå°‡å¾å¯†é‘°ä¸­åˆªé™¤ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ delete å‘½ä»¤åˆªé™¤å¯†é‘°çš„æœ€æ–°ç‰ˆæœ¬ï¼Œé€™ä¹Ÿå¯ä»¥ä½¿ç”¨ -versions æ¨™èªŒåˆªé™¤ä¹‹å‰çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv delete -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data deleted &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; it existed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at: chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®€å– version=5 æ™‚ï¼Œåªå›å‚³ metadataï¼Œç„¡æ³•è®€å–è³‡æ–™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T17:03:37.331182Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      2023-09-15T17:10:01.558586Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®€å– version=4 æ™‚ï¼Œå¯ä»¥é †åˆ©è®€å–è³‡æ–™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop -version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T17:02:55.522095Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;nv&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;===&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key    Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---    -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bar    bbb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;foo    aa
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥å¾©åŸä¸€å€‹åˆªé™¤çš„ç‰ˆæœ¬ version=5&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv undelete -versions&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;  chechia-net/sre/workshop/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: chechia-net/sre/workshop/undelete/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Š undelete ä½¿ç”¨äº† legacy çš„ secret pathï¼Œè€Œä¸ä½¿ç”¨ -mount flagï¼Œæ˜¯å› ç‚º v2 kv åœ¨è™•ç†å¤šå±¤ mount path çš„ bug &lt;a href=&#34;https://github.com/hashicorp/vault/pull/19811&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Issue: #19811&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/hashicorp/vault/pull/19811&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR #19811&lt;/a&gt; is comming lolã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv undelete -versions&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error writing data to workshop/undelete/my-secret: Error making API request.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: PUT http://127.0.0.1:8200/v1/workshop/undelete/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: 404. Errors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* no handler &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; route &lt;span class=&#34;s2&#34;&gt;&amp;#34;workshop/undelete/my-secret&amp;#34;&lt;/span&gt;. route entry not found.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;metadata&#34;&gt;metadata&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰ç‰ˆæœ¬å’Œå¯†é‘° metadata å¯ä»¥ä½¿ç”¨ metadata å‘½ä»¤å’ŒAPI é€²è¡Œæª¢æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;åˆªé™¤ metadata å¯†é‘°å°‡å°è‡´è©²å¯†é‘°çš„æ‰€æœ‰ metadata å’Œç‰ˆæœ¬æ°¸ä¹…åˆªé™¤ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰é—œæ›´å¤šä¿¡æ¯ï¼Œè¯·åƒè¦‹ä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;p&gt;å¯ä»¥æŸ¥çœ‹å¯†é‘°çš„æ‰€æœ‰å…ƒæ•¸æ“šå’Œç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv metadata get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==============&lt;/span&gt; Metadata &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/metadata/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==========&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==========&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                     Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                     -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cas_required            &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time            2023-09-15T16:48:45.817265Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;current_version         &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata         &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;delete_version_after    0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;max_versions            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;oldest_version          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;updated_time            2023-09-15T17:03:37.331182Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T16:48:45.817265Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T16:50:26.621978Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T16:54:03.925959Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T17:02:55.522095Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T17:03:37.331182Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    2023-09-15T17:15:40.767682Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥é€éæ›´æ”¹ metadata API èª¿æ•´ secret çš„å±¬æ€§&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv metadata put -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -max-versions &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -delete-version-after&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3h25m19s&amp;#34;&lt;/span&gt; my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: secret/metadata/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Delete-version-after åªæœƒæ‡‰ç”¨åœ¨æ–°çš„ç‰ˆæœ¬ä¸Šï¼ŒMax versions changes æœƒæ‡‰ç”¨åœ¨ä¸‹æ¬¡å¯«å…¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret &lt;span class=&#34;nv&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt; Secret &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/data/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time       2023-09-15T17:34:09.61954Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata    &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time      2023-09-15T20:59:28.61954Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version            &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ“š max-version çš„è¨­å®šçµæœï¼Œåªä¿ç•™ version=5 èˆ‡ version=6ï¼Œæ›´èˆŠçš„ç‰ˆæœ¬éƒ½è¢«åˆªé™¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv metadata get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chechia-net/sre/workshop my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==============&lt;/span&gt; Metadata &lt;span class=&#34;nv&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chechia-net/sre/workshop/metadata/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;==========&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Metadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==========&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                     Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                     -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cas_required            &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time            2023-09-15T16:48:45.817265Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;current_version         &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;custom_metadata         &amp;lt;nil&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;delete_version_after    3h25m19s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;max_versions            &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;oldest_version          &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;updated_time            2023-09-15T17:34:09.61954Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T17:03:37.331182Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    2023-09-15T17:15:40.767682Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;======&lt;/span&gt; Version &lt;span class=&#34;nv&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;======&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key              Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---              -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created_time     2023-09-15T17:34:09.61954Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deletion_time    2023-09-15T20:59:28.61954Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destroyed        &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;vault-å‘½åç©ºé–“namespace-å’Œæ›è¼‰mountçµæ§‹&#34;&gt;Vault å‘½åç©ºé–“(namespace) å’Œæ›è¼‰(mount)çµæ§‹&lt;/h3&gt;
&lt;p&gt;å‘½åç©ºé–“æ˜¯åŠŸèƒ½ä¸Šå‰µå»ºâ€œVaultä¸­çš„Vaultâ€çš„éš”é›¢ç’°å¢ƒã€‚å®ƒå€‘å…·æœ‰ç¨ç«‹çš„ç™»éŒ„è·¯å¾‘ï¼Œä¸¦æ”¯æŒå‰µå»ºå’Œç®¡ç†èˆ‡å…¶å‘½åç©ºé–“éš”é›¢çš„æ•¸æ“šã€‚æ­¤åŠŸèƒ½ä½¿ä½ èƒ½å¤ å°‡Vaultä½œç‚ºæœå‹™æä¾›çµ¦ç§Ÿæˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºä»€éº¼é€™å€‹ä¸»é¡Œå¾ˆé‡è¦ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Vaultä¸­çš„ä¸€åˆ‡éƒ½æ˜¯åŸºæ–¼è·¯å¾‘çš„ã€‚æ¯å€‹è·¯å¾‘å°æ‡‰æ–¼Vaultä¸­çš„æ“ä½œæˆ–ç§˜å¯†ï¼ŒVault API endpointæ˜ å°„åˆ°é€™äº›è·¯å¾‘ã€‚å› æ­¤ï¼Œç·¨å¯« policy æœƒé…ç½®å°ç‰¹å®šç§˜å¯† path çš„å…è¨±æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œç‚ºäº†æˆäºˆç®¡ç†æ ¹å‘½åç©ºé–“ä¸­çš„ä»¤ç‰Œçš„è¨ªå•æ¬Šé™ï¼Œç­–ç•¥è·¯å¾‘æ˜¯auth/token/ã€‚è¦ç®¡ç†æ•™è‚²å‘½åç©ºé–“ä¸­çš„ä»¤ç‰Œï¼Œå®Œå…¨åˆæ ¼çš„è·¯å¾‘åœ¨åŠŸèƒ½ä¸Šè®Šç‚ºeducation/auth/token/ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹åœ–è¡¨ç¤ºäº†åŸºæ–¼æˆæ¬Šæ–¹æ³•å’Œç§˜å¯†å¼•æ“å•Ÿç”¨ä½ç½®çš„APIè·¯å¾‘ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dtutorials%26version%3Dmain%26asset%3Dpublic%252Fimg%252Fvault%252Fdiagram_namespaces_paths.png%26width%3D1273%26height%3D582&amp;amp;w=3840&amp;amp;q=75&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨å‘½åç©ºé–“ï¼Œæˆ–ç‚ºæ¯å€‹Vaultå®¢æˆ¶ç«¯å°ˆç”¨çš„æ›è¼‰ä¾†éš”é›¢ç§˜å¯†ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç‚ºæ¯å€‹ç¨ç«‹çš„ç§Ÿæˆ¶å‰µå»ºä¸€å€‹å‘½åç©ºé–“ï¼Œä»–å€‘è² è²¬ç®¡ç†å…¶å‘½åç©ºé–“ä¸‹çš„è³‡æºã€‚æˆ–è€…ï¼Œä½ å¯ä»¥åœ¨çµ„ç¹”å…§çš„æ¯å€‹åœ˜éšŠå°ˆç”¨çš„è·¯å¾‘ä¸Šå®‰è£å°ˆç”¨ç§˜å¯†å¼•æ“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dtutorials%26version%3Dmain%26asset%3Dpublic%252Fimg%252Fvault%252Fdiagram_namespaces_intro.png%26width%3D953%26height%3D444&amp;amp;w=1920&amp;amp;q=75&#34; alt=&#34;å‘½åç©ºé–“æœ€ä½³å¯¦è¸&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ ¹æ“šå¦‚ä½•éš”é›¢ç§˜å¯†ï¼Œç¢ºå®šäº†èª°è² è²¬ç®¡ç†é€™äº›ç§˜å¯†ï¼Œæ›´é‡è¦çš„æ˜¯èˆ‡é€™äº›ç§˜å¯†ç›¸é—œçš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;prerequisites&#34;&gt;Prerequisites&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ å°Vaultå‘½åç©ºé–“é‚„ä¸ç†Ÿæ‚‰ï¼Œè«‹æŸ¥çœ‹å¸¶æœ‰å‘½åç©ºé–“çš„å®‰å…¨å¤šç§Ÿæˆ¶æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„&lt;/p&gt;
&lt;p&gt;å‰µå»ºå‘½åç©ºé–“æ‡‰ç”±å…·æœ‰é«˜åº¦ç‰¹æ¬Šä»¤ç‰Œï¼ˆä¾‹å¦‚rootï¼‰çš„ç”¨æˆ¶åŸ·è¡Œï¼Œä»¥ç‚ºæ¯å€‹çµ„ç¹”ã€åœ˜éšŠæˆ–æ‡‰ç”¨ç¨‹åºè¨­ç½®éš”é›¢ç’°å¢ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;éƒ¨ç½²æ³¨æ„äº‹é …&#34;&gt;éƒ¨ç½²æ³¨æ„äº‹é …&lt;/h3&gt;
&lt;p&gt;è¦è¨ˆåŠƒå’Œè¨­è¨ˆVaultå‘½åç©ºé–“ã€æˆæ¬Šæ–¹æ³•è·¯å¾‘å’Œç§˜å¯†å¼•æ“è·¯å¾‘ï¼Œä½ éœ€è¦è€ƒæ…®å¦‚ä½•ç‚ºä½ çš„çµ„ç¹”ï¼Œè¨­è¨ˆVaultçš„é‚è¼¯å°è±¡ã€‚&lt;/p&gt;
&lt;p&gt;çµ„ç¹”çµæ§‹ - ä½ çš„çµ„ç¹”çµæ§‹æ˜¯ä»€éº¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;éƒ¨é–€ã€åœ˜éšŠã€æœå‹™ã€æ‡‰ç”¨ç¨‹åºä¹‹é–“çš„å±¤ç´šï¼Œåœ¨Vaultæœ€çµ‚è¨­è¨ˆä¸­éœ€è¦åæ˜ ä»€éº¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Vault policy å¦‚ä½•ç®¡ç†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ˜éšŠæ˜¯å¦éœ€è¦ç›´æ¥ç®¡ç†å…¶è² è²¬ç¯„åœçš„ policyï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µå…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2&lt;/a&gt;
&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/recommended-patterns/namespace-structure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/tutorials/recommended-patterns/namespace-structure&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚ä¸è¦ä½¿ç”¨æ•¬èªï¼Œè«‹ç”¨ä½ å–ä»£ä½ ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œvalueï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinaryï¼Œprefixï¼Œinstanceï¼Œmetadataã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šæ•¸æ“šæ”¹ç‚ºè³‡æ–™ï¼Œæ•¸æ“šåº«æ”¹ç‚ºè³‡æ–™åº«ï¼Œæ•¸æ“šæ”¹ç‚ºè³‡æ–™ï¼Œè¨ªå•æ”¹ç‚ºå­˜å–ï¼Œæºä»£ç¢¼æ”¹ç‚ºåŸå§‹ç¢¼ï¼Œä¿¡æ¯æ”¹ç‚ºè³‡è¨Šï¼Œå‘½ä»¤æ”¹ç‚ºæŒ‡ä»¤ï¼Œç¦ç”¨æ”¹ç‚ºåœç”¨ï¼Œé»˜èªæ”¹ç‚ºé è¨­ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 03: Secret Engine</title>
      <link>https://chechia.net/zh-hant/post/2023-09-14-vault-workshop-secret-engine/</link>
      <pubDate>Wed, 13 Sep 2023 22:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-14-vault-workshop-secret-engine/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;day-03ç´°æ¢-secret-engine-ç§˜å¯†å¼•æ“&#34;&gt;Day 03ï¼šç´°æ¢ Secret Engine ç§˜å¯†å¼•æ“&lt;/h1&gt;
&lt;h3 id=&#34;ä»€éº¼æ˜¯ç§˜å¯†å¼•æ“&#34;&gt;ä»€éº¼æ˜¯ç§˜å¯†å¼•æ“ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ç§˜å¯†å¼•æ“æ˜¯Vaultçš„çµ„ä»¶ï¼Œç”¨æ–¼å­˜å„²ã€ç”Ÿæˆæˆ–åŠ å¯†ç§˜å¯†ã€‚åœ¨å‰é¢çš„å…§å®¹ä¸­ï¼Œä½ ä½¿ç”¨äº†Key/Value v2 ç§˜å¯†å¼•æ“ä¾†å­˜å„²æ•¸æ“šã€‚ä¸€äº›ç§˜å¯†å¼•æ“ï¼Œæ¯”å¦‚éµ/å€¼ç§˜å¯†å¼•æ“ï¼Œåƒ…åƒ…æ˜¯ç”¨ä¾†å­˜å„²å’Œè®€å–æ•¸æ“šçš„ã€‚å…¶ä»–ç§˜å¯†å¼•æ“å‰‡é€£æ¥åˆ°å…¶ä»–æœå‹™ä¸¦æ ¹æ“šéœ€æ±‚ç”Ÿæˆå‹•æ…‹æ†‘è­‰ã€‚é‚„æœ‰ä¸€äº›ç§˜å¯†å¼•æ“æä¾›åŠ å¯†ä½œç‚ºæœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dtutorials%26version%3Dmain%26asset%3Dpublic%252Fimg%252Fvault%252Fvault-triangle.png%26width%3D1641%26height%3D973&amp;amp;w=3840&amp;amp;q=75&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‰é¢çš„å…§å®¹ä¸­ï¼Œé»˜èªæƒ…æ³ä¸‹ï¼Œkey/value v2 ç§˜å¯†å¼•æ“å·²å•Ÿç”¨ï¼Œä¸¦æº–å‚™åœ¨ secret/ ä¸‹æ¥æ”¶è«‹æ±‚ï¼Œå› ç‚ºæˆ‘å€‘åœ¨-dev æ¨¡å¼ä¸‹å•Ÿå‹•äº†Vault Serverã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åº•ä¸‹æˆ‘å€‘ä½¿ç”¨ kv v1 åšç°¡å–®çš„ç¯„ä¾‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mount-path&#34;&gt;mount path&lt;/h3&gt;
&lt;p&gt;å»ºè­°åœ¨ä½¿ç”¨ KV v2 ç§˜å¯†å¼•æ“æ™‚ï¼Œä½¿ç”¨å¯é¸çš„ -mount flag èªæ³•ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get -mount&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;secret foo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è«‹å˜—è©¦ä»¥ä¸‹å‘½ä»¤ï¼Œé€™å°‡å°è‡´éŒ¯èª¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put foo/bar &lt;span class=&#34;nv&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error making API request.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: GET http://127.0.0.1:8200/v1/sys/internal/ui/mounts/foo/bar
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: 403. Errors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* preflight capability check returned 403, please ensure client&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s policies grant access to path &lt;span class=&#34;s2&#34;&gt;&amp;#34;foo/bar/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Path prefix è·¯å¾‘å‰ç¶´å‘Šè¨´ Vault æ‡‰è©²å°‡æµé‡ route åˆ°å“ªå€‹ç§˜å¯†å¼•æ“&lt;/p&gt;
&lt;p&gt;ç•¶è«‹æ±‚åˆ°é” Vault æ™‚ï¼Œå®ƒæœƒä½¿ç”¨æœ€é•·å‰ç¶´åŒ¹é…ä¾†åŒ¹é…åˆå§‹è·¯å¾‘éƒ¨åˆ†ï¼Œç„¶å¾Œå°‡è«‹æ±‚å‚³éçµ¦åœ¨è©²è·¯å¾‘å•Ÿç”¨çš„ç›¸æ‡‰ç§˜å¯†å¼•æ“ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ mount è¨­ç½®ç‚º foo/bar
&lt;ul&gt;
&lt;li&gt;å‰‡æœƒåœ¨ foo/bar é€™å€‹ path ä¸‹çš„ secret engineï¼Œå„²å­˜ a=b&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœ mount è¨­ç½®ç‚º foo
&lt;ul&gt;
&lt;li&gt;å‰‡æœƒåœ¨ foo é€™å€‹ path ä¸‹çš„ secret engineï¼Œå„²å­˜åœ¨ path /barï¼Œa=b&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Vault å°‡é€™äº›ç§˜å¯†å¼•æ“å‘ˆç¾å¾—é¡ä¼¼æ–¼æ–‡ä»¶ç³»çµ± (ex. )/usr/local/bin/vault)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ linux ä¸Šå­˜å–ä¸€å€‹ mount path ä¸å­˜åœ¨çš„ directory path&lt;/li&gt;
&lt;li&gt;åœ¨ vault ä¸­å­˜å– foo è™•æœªæ›è¼‰ç§˜å¯†å¼•æ“ï¼Œæ‰€ä»¥ä¸Šé¢çš„å‘½ä»¤è¿”å›äº†éŒ¯èª¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°æ–¼ vault kv å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ -mount flag&lt;/p&gt;
&lt;h3 id=&#34;å•Ÿç”¨ä¸€å€‹ç§˜å¯†å¼•æ“&#34;&gt;å•Ÿç”¨ä¸€å€‹ç§˜å¯†å¼•æ“&lt;/h3&gt;
&lt;p&gt;è¦é–‹å§‹ï¼Œè«‹åœ¨è·¯å¾‘ kv å•Ÿç”¨ä¸€å€‹æ–°çš„ KV ç§˜å¯†å¼•æ“ã€‚æ¯å€‹è·¯å¾‘éƒ½æ˜¯å®Œå…¨éš”é›¢çš„ï¼Œç„¡æ³•èˆ‡å…¶ä»–è·¯å¾‘é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œ&lt;/p&gt;
&lt;p&gt;å•Ÿç”¨åœ¨ foo çš„ KV ç§˜å¯†å¼•æ“ç„¡æ³•èˆ‡å•Ÿç”¨åœ¨ bar çš„ KVç§˜å¯†å¼•æ“é€šä¿¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/foo &lt;span class=&#34;nv&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/bar &lt;span class=&#34;nv&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿç”¨æ–°çš„ç§˜å¯†å¼•æ“ä»¥å‰ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹ç›®å‰ vault server ä¸­å·²ç¶“å•Ÿç”¨çš„å¼•æ“ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† default å­˜åœ¨çš„å¼•æ“ï¼Œé‚„æœ‰åœ¨ dev æ¨¡å¼ä¸‹è‡ªå‹•å»ºç«‹çš„ secret/&lt;/p&gt;
&lt;p&gt;default&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cubbyhole/&lt;/li&gt;
&lt;li&gt;identity/&lt;/li&gt;
&lt;li&gt;sys/&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;dev mode&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;secret/&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Type         Accessor              Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ----         --------              -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_9c6d82c2    per-token private secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_8feb8f49     identity store
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/       kv           kv_6f946f62           key/value secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys/          system       system_b45bc416       system endpoints used for control, policy and debugging
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œåœ¨ path=kv ä¸‹ï¼Œå•Ÿç”¨ä¸€å€‹ secret engine&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets enable -path=kv kv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Enabled the kv secrets engine at: kv/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç§˜å¯†å¼•æ“å•Ÿç”¨çš„è·¯å¾‘é»˜èªç‚ºç§˜å¯†å¼•æ“çš„åç¨±ã€‚å› æ­¤ï¼Œä»¥ä¸‹å‘½ä»¤ç­‰æ•ˆæ–¼åŸ·è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; vault secrets enable kv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡è¤‡åŸ·è¡Œé€™å€‹å‘½ä»¤æœƒæ‹‹å‡ºâ€œè·¯å¾‘å·²åœ¨kv/ ä¸­ä½¿ç”¨â€éŒ¯èª¤ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†é©—è­‰æˆ‘å€‘çš„æˆåŠŸä¸¦ç²å–æœ‰é—œç§˜å¯†å¼•æ“çš„æ›´å¤šä¿¡æ¯ï¼Œä½¿ç”¨ä»¥ä¸‹çš„ vault secrets list å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Type         Accessor              Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ----         --------              -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_9c6d82c2    per-token private secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_8feb8f49     identity store
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kv/           kv           kv_2b6528af           n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/       kv           kv_6f946f62           key/value secret storage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys/          system       system_b45bc416       system endpoints used for control, policy and debugging
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é¡¯ç¤ºäº†åœ¨é€™å€‹Vaultä¼ºæœå™¨ä¸Šå·²å•Ÿç”¨çš„5å€‹ç§˜å¯†å¼•æ“ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥çœ‹åˆ°ç§˜å¯†å¼•æ“çš„é¡å‹ã€ç›¸æ‡‰çš„è·¯å¾‘ä»¥åŠå¯é¸çš„æè¿°ï¼ˆå¦‚æœæ²’æœ‰æä¾›æè¿°ï¼Œå‰‡ç‚ºâ€œn/aâ€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å¸¶æœ‰ -detailed æ¨™èªŒé‹è¡Œä¸Šè¿°å‘½ä»¤å¯ä»¥é¡¯ç¤ºKVç§˜å¯†å¼•æ“çš„ç‰ˆæœ¬å’Œæ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault  secrets list --detailed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Path          Plugin       Accessor              Default TTL    Max TTL    Force No Cache    Replication    Seal Wrap    External Entropy Access    Options           Description                                                UUID                                    Version    Running Version          Running SHA256    Deprecation Status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----          ------       --------              -----------    -------    --------------    -----------    ---------    -----------------------    -------           -----------                                                ----                                    -------    ---------------          --------------    ------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cubbyhole/    cubbyhole    cubbyhole_9c6d82c2    n/a            n/a        false             local          false        false                      map[]             per-token private secret storage                           6087f484-a02c-f36c-0a1a-aa07840f988c    n/a        v1.14.3+builtin.vault    n/a               n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;identity/     identity     identity_8feb8f49     system         system     false             replicated     false        false                      map[]             identity store                                             c3a1e4ae-09c6-29b9-906a-8281b46690f3    n/a        v1.14.3+builtin.vault    n/a               n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kv/           kv           kv_2b6528af           system         system     false             replicated     false        false                      map[]             n/a                                                        5ff9bc4c-6d2c-5fd7-cbe0-e9b7fbf03ee5    n/a        v0.15.0+builtin          n/a               supported
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;secret/       kv           kv_6f946f62           system         system     false             replicated     false        false                      map[version:2]    key/value secret storage                                   ed28307e-0472-c0a7-b7a9-65543a63e68c    n/a        v0.15.0+builtin          n/a               supported
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys/          system       system_b45bc416       n/a            n/a        false             replicated     true         false                      map[]             system endpoints used for control, policy and debugging    9712d56d-95e3-6c07-796f-d44565de5c07    n/a        v1.14.3+builtin.vault    n/a               n/a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;sys/ è·¯å¾‘å°æ‡‰åˆ°ç³»çµ±å¾Œç«¯ã€‚é€™äº›è·¯å¾‘èˆ‡Vaultçš„æ ¸å¿ƒç³»çµ±äº¤äº’ï¼Œå°æ–¼åˆå­¸è€…ä¾†èªªä¸æ˜¯å¿…éœ€çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å»ºç«‹-secret&#34;&gt;å»ºç«‹ Secret&lt;/h3&gt;
&lt;p&gt;è¦å‰µå»ºç§é‘°ï¼Œä½¿ç”¨ kv put å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put kv/hello target=world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: kv/hello
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦è®€å–å­˜å„²åœ¨kv/helloè·¯å¾‘ä¸­çš„ç§é‘°ï¼Œä½¿ç”¨ kv get å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get kv/hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;=====&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=====&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key       Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---       -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target    world
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å˜—è©¦å»ºç«‹ç¬¬äºŒå€‹ kv/my-secret&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put kv/my-secret &lt;span class=&#34;nv&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;s3c(eT&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data written to: kv/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®€å–ä½æ–¼ kv/my-secret çš„è³‡æ–™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get kv/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;====&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;====&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key      Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---      -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;value    s3c&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;eT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆªé™¤ä½æ–¼ kv/my-secret çš„è³‡æ–™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv delete kv/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Data deleted &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; it existed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at: kv/my-secret
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ—å‡ºä½æ–¼ kv/my-secret çš„è³‡æ–™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv list kv/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hello
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åœç”¨ç§˜å¯†å¼•æ“&#34;&gt;åœç”¨ç§˜å¯†å¼•æ“&lt;/h3&gt;
&lt;p&gt;ç•¶ä¸å†éœ€è¦ç§˜å¯†å¼•æ“æ™‚ï¼Œå¯ä»¥å°‡å…¶åœç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶åœç”¨ç§˜å¯†å¼•æ“æ™‚ï¼Œæ‰€æœ‰ç§é‘°éƒ½å°‡è¢«æ’¤éŠ·ï¼Œç›¸æ‡‰çš„Vaultæ•¸æ“šå’Œé…ç½®å°‡è¢«åˆªé™¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets disable kv/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Disabled the secrets engine &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; it existed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at: kv/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è«‹æ³¨æ„ï¼Œæ­¤å‘½ä»¤å°‡è·¯å¾‘ä½œç‚ºåƒæ•¸ï¼Œè€Œä¸æ˜¯ç§˜å¯†å¼•æ“çš„é¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;å°åŸå§‹è·¯å¾‘çš„ä»»ä½•æ•¸æ“šè·¯ç”±è«‹æ±‚éƒ½å°‡å°è‡´éŒ¯èª¤ï¼Œä½†ç¾åœ¨å¯ä»¥åœ¨è©²è·¯å¾‘å•Ÿç”¨å¦ä¸€å€‹ç§˜å¯†å¼•æ“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get kv/hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error making API request.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: GET http://127.0.0.1:8200/v1/sys/internal/ui/mounts/kv/hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: 403. Errors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* preflight capability check returned 403, please ensure client&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s policies grant access to path &lt;span class=&#34;s2&#34;&gt;&amp;#34;kv/hello/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç§˜å¯†å¼•æ“æ˜¯ä¸€å€‹æŠ½è±¡&#34;&gt;ç§˜å¯†å¼•æ“æ˜¯ä¸€å€‹æŠ½è±¡&lt;/h3&gt;
&lt;p&gt;Vaultçš„è¡Œç‚ºé¡ä¼¼æ–¼è™›æ“¬æ–‡ä»¶ç³»çµ±ã€‚è®€å–/å¯«å…¥/åˆªé™¤/åˆ—å‡ºæ“ä½œå°‡è½‰ç™¼åˆ°ç›¸æ‡‰çš„ç§˜å¯†å¼•æ“ï¼Œç§˜å¯†å¼•æ“æ±ºå®šå¦‚ä½•å°é€™äº›æ“ä½œåšå‡ºåæ‡‰ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¨®æŠ½è±¡éå¸¸å¼·å¤§ã€‚å®ƒä½¿Vaultèƒ½å¤ ç›´æ¥èˆ‡ç‰©ç†ç³»çµ±ã€è³‡æ–™åº«ã€HSM ç­‰é€²è¡Œäº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;ä½†é™¤äº†é€™äº›ç‰©ç†ç³»çµ±å¤–ï¼ŒVaulté‚„å¯ä»¥èˆ‡æ›´å¤šç¨ç‰¹çš„ç’°å¢ƒé€²è¡Œäº¤äº’ï¼Œæ¯”å¦‚AWS IAMã€å‹•æ…‹SQL user å‰µå»ºç­‰ï¼Œæ‰€æœ‰é€™äº›éƒ½ä½¿ç”¨ç›¸åŒçš„è®€å–/å¯«å…¥ interfaceã€‚&lt;/p&gt;
&lt;h3 id=&#34;chatgpt&#34;&gt;chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬æ®µå…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-secrets-engines&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-secrets-engines&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚ä¸è¦ä½¿ç”¨æ•¬èªï¼Œè«‹ç”¨ä½ å–ä»£æ‚¨ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinary
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šç§˜å¯†æ”¹ç‚ºç§é‘°ï¼Œæ•¸æ“šæ”¹ç‚ºè³‡æ–™ï¼Œæ•¸æ“šåº«æ”¹ç‚ºè³‡æ–™åº«ï¼Œæ•¸æ“šæ”¹ç‚ºè³‡æ–™ï¼Œè¨ªå•æ”¹ç‚ºå­˜å–ï¼Œæºä»£ç¢¼æ”¹ç‚ºåŸå§‹ç¢¼ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Vault Workshop 02: Get Started</title>
      <link>https://chechia.net/zh-hant/post/2023-09-13-vault-workshop-get-started/</link>
      <pubDate>Wed, 13 Sep 2023 21:42:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-13-vault-workshop-get-started/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;h1 id=&#34;day-02-æº–å‚™åŸ·è¡Œä¸€å€‹æœ¬åœ°é–‹ç™¼ç”¨é€”çš„-vault&#34;&gt;Day 02 æº–å‚™ï¼šåŸ·è¡Œä¸€å€‹æœ¬åœ°é–‹ç™¼ç”¨é€”çš„ Vault&lt;/h1&gt;
&lt;p&gt;æ•´ç¯‡ Workshop æœƒä½¿ç”¨çš„ç¯„ä¾‹èˆ‡åŸå§‹ç¢¼ï¼Œæ”¾åœ¨ &lt;a href=&#34;http://chechia.net/zh-hant/#projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github Repository: vault-playground&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;æº–å‚™å·¥ä½œ&#34;&gt;æº–å‚™å·¥ä½œ&lt;/h3&gt;
&lt;p&gt;åœ¨é–‹å§‹é€²è¡Œ Vault 30 å¤© workshop ä¹‹å‰ï¼Œæœ‰ä¸€äº›æº–å‚™å·¥ä½œéœ€è¦å®Œæˆï¼š&lt;/p&gt;
&lt;p&gt;æ­¥é©Ÿ1ï¼šä¸‹è¼‰ Vault Binary&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œä½ éœ€è¦ä¸‹è¼‰HashiCorp Vaultçš„æœ€æ–°ç‰ˆæœ¬ã€‚ä½ å¯ä»¥åœ¨HashiCorpçš„å®˜æ–¹ç¶²ç«™ä¸Šæ‰¾åˆ°Vaultçš„ä¸‹è¼‰éˆæ¥ã€‚è«‹ç¢ºä¿ä¸‹è¼‰é©ç”¨æ–¼ä½ æ“ä½œç³»çµ±çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/downloads&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/downloads&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://releases.hashicorp.com/vault/1.14.3/vault_1.14.3_darwin_amd64.zip&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MacOS amd64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://releases.hashicorp.com/vault/1.14.3/vault_1.14.3_darwin_arm64.zip&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MacOS arm64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://releases.hashicorp.com/vault/1.14.3/vault_1.14.3_linux_amd64.zip&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linux&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¥é©Ÿ2ï¼šå®‰è£Vault&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰å®Œæˆå¾Œï¼Œæ ¹æ“šä½ çš„æ“ä½œç³»çµ±é€²è¡Œå®‰è£ã€‚å°æ–¼å¤§å¤šæ•¸Linuxå’ŒUnixç³»çµ±ï¼Œä½ cå¯ä»¥é€šéè§£å£“ç¸®å£“ç¸®æ–‡ä»¶ä¾†å®‰è£Vaultã€‚å°‡Vault Binaryæ–‡ä»¶ç§»è‡³ä½ çš„PATHä¸­ï¼Œä»¥ä¾¿åœ¨çµ‚ç«¯ä¸­è¼•é¬†è¨ªå•&lt;/p&gt;
&lt;p&gt;ç­†è€…ä½¿ç”¨çš„æ˜¯ Mac M1ï¼Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é€²è¡Œå®‰è£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://releases.hashicorp.com/vault/1.14.3/vault_1.14.3_darwin_arm64.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unzip vault_1.14.3_darwin_arm64.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mv vault /usr/local/bin/vault
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Vault v1.14.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;56debfa71653e72433345f23cd26276bc90629ce&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;, built 2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¸éœ€è¦ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Vault ä¹Ÿå¯ä»¥å®Œæˆé€™æ¬¡ workshop&lt;/p&gt;
&lt;h3 id=&#34;å•Ÿå‹•-vault-server&#34;&gt;å•Ÿå‹• Vault server&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åœ¨æœ¬åœ°å•Ÿå‹• Vault Serverã€‚è«‹ç¢ºä¿ Vault ä¼ºæœå™¨å·²æ­£ç¢ºå•Ÿå‹•ï¼Œä¸¦ä¸”æœªå‡ºç¾éŒ¯èª¤æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault server -dev
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ -dev é¸é …å¯ä»¥å•Ÿå‹•Vaultçš„é–‹ç™¼æ¨¡å¼ï¼Œè©²æ¨¡å¼ä¸éœ€è¦èº«ä»½é©—è­‰å³å¯é‹è¡ŒVaultã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¢ºèªvaulté‹è¡Œ&#34;&gt;ç¢ºèªVaulté‹è¡Œ&lt;/h3&gt;
&lt;p&gt;æ‰“é–‹ä½ çš„ç€è¦½å™¨ï¼Œç€è¦½åˆ° http://127.0.0.1:8200&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /zh-hant/post/2023-09-13-vault-workshop-get-started/vault-ui_hu0533df8c600b6ebf5e775c57536fef00_59568_4ab2b9254ee45e74c042f87706145df3.webp 400w,
               /zh-hant/post/2023-09-13-vault-workshop-get-started/vault-ui_hu0533df8c600b6ebf5e775c57536fef00_59568_00fcb225ed09f103b35f33ade5547650.webp 760w,
               /zh-hant/post/2023-09-13-vault-workshop-get-started/vault-ui_hu0533df8c600b6ebf5e775c57536fef00_59568_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://chechia.net/zh-hant/post/2023-09-13-vault-workshop-get-started/vault-ui_hu0533df8c600b6ebf5e775c57536fef00_59568_4ab2b9254ee45e74c042f87706145df3.webp&#34;
               width=&#34;760&#34;
               height=&#34;727&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ–è€…ä½¿ç”¨ curl å‘½ä»¤ç™¼é€ GET è«‹æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://127.0.0.1:8200/v1/sys/health &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;initialized&amp;#34;&lt;/span&gt;: true,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;sealed&amp;#34;&lt;/span&gt;: false,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;standby&amp;#34;&lt;/span&gt;: false,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;performance_standby&amp;#34;&lt;/span&gt;: false,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;replication_performance_mode&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;disabled&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;replication_dr_mode&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;disabled&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;server_time_utc&amp;#34;&lt;/span&gt;: 1694693898,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.14.3&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;vault-cluster-3273d150&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster_id&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;a32d555e-3346-0757-1d57-21e2f646aaf3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœVaultæ­£å¸¸é‹è¡Œï¼Œä½ æ‡‰è©²æœƒæ”¶åˆ°ä¸€å€‹åŒ…å«Vaultè¨Šæ¯çš„JSON responseã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä½¿ç”¨ Vault Binary ä¾†å­˜å– Vault API&lt;/p&gt;
&lt;p&gt;export Vault Server çš„ http endpoint (æˆ‘å€‘å°šæœªå•Ÿå‹• tls listenerï¼Œæ‰€ä»¥æ²’æœ‰ https endpoint)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key             Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---             -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Seal Type       shamir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initialized     &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sealed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Total Shares    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Threshold       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version         1.14.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Build Date      2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Storage Type    inmem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster Name    vault-cluster-3273d150
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster ID      a32d555e-3346-0757-1d57-21e2f646aaf3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HA Enabled      &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„ Vault server&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·²åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;å·²è§£å°&lt;/li&gt;
&lt;li&gt;ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;æœªå•Ÿç”¨ HA&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ Vault Binary ä¸­çš„ operator æŒ‡ä»¤æª¢æ¸¬&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator members
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Host Name                     API Address              Cluster Address           Active Node    Version    Upgrade Version    Redundancy Zone    Last Echo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---------                     -----------              ---------------           -----------    -------    ---------------    ---------------    ---------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CheChias-MacBook-Pro.local    http://127.0.0.1:8200    https://127.0.0.1:8201    &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;           1.14.3     n/a                n/a                n/a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆå§‹åŒ–vault&#34;&gt;åˆå§‹åŒ–Vault&lt;/h3&gt;
&lt;p&gt;åœ¨é–‹ç™¼æ¨¡å¼ä¸‹é‹è¡Œçš„Vaultå¯èƒ½ä¸éœ€è¦åˆå§‹åŒ–ï¼Œä½†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ production æ¨¡å¼ï¼Œè«‹åƒè€ƒVaultçš„å®˜æ–¹æ–‡æª”ï¼Œé€²è¡Œåˆå§‹åŒ–å’Œè¨­ç½®ã€‚&lt;/p&gt;
&lt;p&gt;Vault server åœ¨ dev æ¨¡å¼ä¸‹å•Ÿå‹•å¾Œï¼Œæœƒè‡ªå‹•ç”¢ç”Ÿä¸€éš»å–®ä¸€å€‹ unseal keyï¼Œèˆ‡ä¸€æŠŠ Root Tokenã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;and starts unsealed with a single unseal key. The root token is already
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;authenticated to the CLI, so you can immediately begin using Vault.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You may need to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; the following environment variables:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    $ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The unseal key and root token are displayed below in &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; you want to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;seal/unseal the Vault or re-authenticate.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Key: &lt;span class=&#34;nv&#34;&gt;JbKrVzhH4VO14nPBRvWE1qxJz9CVhnOFJT0pYLsx9LU&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Root Token: hvs.0pmmzGSZ8S7w8vP2E4sm7SqE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Development mode should NOT be used in production installations!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ vault operator æŒ‡ä»¤ï¼Œå˜—è©¦ seal Vault server&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator seal
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success! Vault is sealed.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡æª¢æŸ¥ status&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key                Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---                -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Seal Type          shamir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initialized        &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sealed             &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Total Shares       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Threshold          &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Progress    0/1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Unseal Nonce       n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version            1.14.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Build Date         2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Storage Type       inmem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HA Enabled         &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¡¯ç¤ºç‚ºå¯†é‘°å¯†å°ï¼ˆSealedï¼‰ç‹€æ…‹&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ vault operator è§£å° Vault&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault operator unseal &lt;span class=&#34;nv&#34;&gt;JbKrVzhH4VO14nPBRvWE1qxJz9CVhnOFJT0pYLsx9LU&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Key             Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---             -----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Seal Type       shamir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Initialized     &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sealed          &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Total Shares    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Threshold       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version         1.14.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Build Date      2023-09-11T21:23:55Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Storage Type    inmem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster Name    vault-cluster-3273d150
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster ID      a32d555e-3346-0757-1d57-21e2f646aaf3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HA Enabled      &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¡¯ç¤ºç‚ºè§£å°ç‹€æ…‹&lt;/p&gt;
&lt;h3 id=&#34;å¯†é‘°å®‰å…¨&#34;&gt;å¯†é‘°å®‰å…¨&lt;/h3&gt;
&lt;p&gt;æœ¬ workshop ä¸­ä½¿ç”¨çš„ vault server / seal key / root token éƒ½æ˜¯æ¸¬è©¦ç”¨é€”çš„æš«æ™‚æ€§å­˜åœ¨ï¼Œç­†è€…å¯«å®Œæ–‡ç« å¾Œï¼Œé€™äº› server èˆ‡å¯†é‘°æ—©å·²ç¶“æ¸…ç†å®Œç•¢ï¼Œæ‰€ä»¥æ²’æœ‰è³‡å®‰é¢¨éšªã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†ç¤ºç¯„æ–¹ä¾¿ï¼Œworkshop æœƒä»¥æ˜ç¢¼ plain text å½¢å¼è¡¨ç¾&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ˜¯åœ¨å…¬å¸çš„ production ç’°å¢ƒä½¿ç”¨ï¼Œå‹™å¿…è¦ç¢ºä¿å¯†é‘°çš„å®‰å…¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦åœ¨ local é›»è…¦ä¸Šå­˜æ”¾ token æˆ– seal key&lt;/li&gt;
&lt;li&gt;ä¸è¦åœ¨æ²’æœ‰å¯†ç¢¼å­¸èˆ‡è³‡å®‰æª¢æ¸¬çš„å¹³å°ä¸Šå„²å­˜ token æˆ– seal key&lt;/li&gt;
&lt;li&gt;ä¸è¦é€éé€šè¨Šè»Ÿé«”(ex. slack) æ˜ç¢¼å‚³é€ token æˆ– seal key
&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯èƒ½æœƒå•ï¼Œæœ¬åœ°ä¸èƒ½å­˜ï¼Œé ç«¯ä¹Ÿä¸èƒ½å­˜ï¼Œä¹Ÿä¸èƒ½éš¨æ„å‚³é€çµ¦åŒäº‹ï¼Œé‚£æ‡‰è©²å¦‚ä½•å”ä½œèˆ‡ç®¡ç†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨å¾Œé¢çš„ workshop å…§å®¹æœƒèˆ‡å¤§å®¶ä¸€ä¸€ç¤ºç¯„è§£èªª&lt;/p&gt;
&lt;h3 id=&#34;dev-æ¨¡å¼&#34;&gt;Dev æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥é—œé–‰åŸ·è¡Œ vault server çš„ terminal session ä¾†é—œé–‰ vault server&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault server -dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ctrl + c
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/concepts/dev-server&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/concepts/dev-server&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Dev&amp;rdquo; ä¼ºæœå™¨æ¨¡å¼&lt;/p&gt;
&lt;p&gt;dev æ¨¡å¼çš„ä¼ºæœå™¨ä¸éœ€è¦é€²ä¸€æ­¥çš„è¨­å®šï¼Œä¸”ä½ æœ¬åœ°çš„ vault CLI å·²ç¶“è¢«èªè­‰ã€‚é€™ä½¿å¾—ä½¿ç”¨ Vault æˆ–å•Ÿå‹•ç”¨æ–¼é–‹ç™¼çš„ Vault instance è®Šå¾—å®¹æ˜“ã€‚Vault çš„æ¯ä¸€å€‹åŠŸèƒ½åœ¨ &amp;ldquo;dev&amp;rdquo; æ¨¡å¼ä¸­éƒ½æ˜¯å¯ç”¨çš„ã€‚-dev flag åªæ˜¯å°‡å¾ˆå¤šè¨­ç½®ç°¡åŒ–ç‚ºä¸å®‰å…¨çš„é»˜èªå€¼ã€‚&lt;/p&gt;
&lt;p&gt;è­¦å‘Šï¼šæ°¸é ã€æ°¸é ã€æ°¸é ä¸è¦åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­é‹è¡Œ &amp;ldquo;dev&amp;rdquo; æ¨¡å¼ä¼ºæœå™¨ã€‚é€™æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸”æ¯æ¬¡é‡æ–°å•Ÿå‹•éƒ½æœƒä¸Ÿå¤±è³‡æ–™ï¼ˆå› ç‚ºå®ƒå°‡è³‡æ–™å­˜å„²åœ¨è¨˜æ†¶é«”ä¸­ï¼‰ã€‚å®ƒåƒ…ä¾›é–‹ç™¼æˆ–å¯¦é©—ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dev-æ¨¡å¼ç‰¹æ€§&#34;&gt;dev æ¨¡å¼ç‰¹æ€§&lt;/h3&gt;
&lt;p&gt;dev ä¼ºæœå™¨çš„å±¬æ€§ï¼ˆæœ‰äº›å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œ flag æˆ–æŒ‡å®šé…ç½®æ–‡ä»¶ä¾†è¦†å¯«ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;åˆå§‹åŒ–ä¸”æœªå°å°: ä¼ºæœå™¨å°‡è‡ªå‹•åˆå§‹åŒ–ä¸”æœªå°å°ã€‚ä½ ä¸éœ€è¦ä½¿ç”¨ vault operator unsealã€‚å®ƒç«‹å³å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¨˜æ†¶é«”å­˜å„²: æ‰€æœ‰è³‡æ–™ï¼ˆåŠ å¯†å¾Œï¼‰éƒ½å­˜å„²åœ¨è¨˜æ†¶é«”ä¸­ã€‚Vault ä¼ºæœå™¨ä¸éœ€è¦ä»»ä½•æª”æ¡ˆæ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;ç¶å®šåˆ°æœ¬åœ°åœ°å€è€Œä¸ä½¿ç”¨ TLS: ä¼ºæœå™¨æ­£åœ¨ç›£è½ 127.0.0.1:8200ï¼ˆé»˜èªçš„ä¼ºæœå™¨åœ°å€ï¼‰è€Œä¸ä½¿ç”¨ TLSã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå‹•èªè­‰: ä¼ºæœå™¨å­˜å„²äº†ä½ çš„ root access tokenï¼Œæ‰€ä»¥ vault CLI å­˜å–å·²ç¶“æº–å‚™å¥½ã€‚å¦‚æœä½ é€é API å­˜å– Vaultï¼Œä½ éœ€è¦ä½¿ç”¨æ‰“å°å‡ºçš„ token é€²è¡Œèªè­‰ã€‚&lt;/p&gt;
&lt;p&gt;å–®ä¸€è§£å°é‘°åŒ™: ä¼ºæœå™¨ä½¿ç”¨å–®ä¸€çš„ unseal key é€²è¡Œåˆå§‹åŒ–ã€‚Vault å·²ç¶“æ˜¯è§£å°çš„ï¼Œä½†å¦‚æœä½ æƒ³å˜—è©¦ seal/unsealï¼Œé‚£éº¼åªéœ€è¦è¼¸å‡ºçš„å–®ä¸€é‘°åŒ™ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£ key value storage: åœ¨ secret/ è™•å®‰è£äº†ä¸€å€‹ v2 KV secret engineã€‚è«‹æ³¨æ„ v1 KV æœ‰æ‰€ä¸åŒã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ v1ï¼Œä½¿ç”¨æ­¤æ——æ¨™ -dev-kv-v1ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬ä¸€æ¬¡å­˜å–-vault-è³‡æ–™&#34;&gt;ç¬¬ä¸€æ¬¡å­˜å– vault è³‡æ–™&lt;/h3&gt;
&lt;p&gt;å»ºç«‹é€šç”¨ Key-Value å­˜å„²ï¼š ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ Vault ä¸­å‰µå»ºé€šç”¨çš„ Key-Value å­˜å„²ã€‚åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ secrets ä½œç‚ºå­˜å„²çš„è·¯å¾‘ï¼Œä½ å¯ä»¥æ ¹æ“šä½ çš„éœ€æ±‚è‡ªè¡Œå‘½åå­˜å„²è·¯å¾‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put secret/mysecrets &lt;span class=&#34;nv&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin &lt;span class=&#34;nv&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;secretpassword
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹å‘½ä»¤å°‡åœ¨ Vault ä¸­å‰µå»ºä¸€å€‹ Key-Value å­˜å„²ï¼Œå…¶ä¸­åŒ…å«ä¸€å° Key value pairï¼Œåˆ†åˆ¥æ˜¯ username å’Œ passwordã€‚&lt;/p&gt;
&lt;p&gt;æª¢ç´¢å­˜å„²çš„å€¼ï¼š ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æª¢ç´¢å­˜å„²ä¸­çš„å€¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv get secret/mysecrets
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹å‘½ä»¤å°‡è¿”å›å­˜å„²ä¸­çš„æ‰€æœ‰ Key Value pairã€‚&lt;/p&gt;
&lt;p&gt;æ›´æ–°å­˜å„²çš„å€¼ï¼š å¦‚æœä½ éœ€è¦æ›´æ–°å­˜å„²ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put secret/mysecrets &lt;span class=&#34;nv&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;newsecretpassword
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹å‘½ä»¤å°‡æ›´æ–°å­˜å„²ä¸­çš„ password éµçš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;åˆªé™¤å­˜å„²çš„å€¼ï¼š è‹¥è¦åˆªé™¤å­˜å„²ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv delete secret/mysecrets
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹å‘½ä»¤å°‡åˆªé™¤æ•´å€‹å­˜å„²è·¯å¾‘åŠå…¶å…§å®¹&lt;/p&gt;
&lt;h3 id=&#34;é—œæ–¼-kv-v2&#34;&gt;é—œæ–¼ kv-v2&lt;/h3&gt;
&lt;p&gt;dev æ¨¡å¼ä¸‹ï¼ŒVault server è‡ªå‹•åœ¨ secret/ è™•å®‰è£äº†ä¸€å€‹ v2 KV secret engine&lt;/p&gt;
&lt;p&gt;Vaultä¸­çš„ä¸åŒç§˜å¯†å¼•æ“ï¼ˆSecret Engineï¼‰æä¾›äº†ä¸åŒçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚æœ¬æ¬¡ workshop æœƒä»¥æœ€æ–°ï¼ŒåŠŸèƒ½ä¹Ÿæœ€å¤šå…ƒçš„ kv-v2 Secret Engine ç‚ºä¸»ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸‰ç¨®å¸¸è¦‹çš„ç§˜å¯†å¼•æ“ï¼ˆgenericã€kv v1 å’Œ kv v2ï¼‰ä¹‹é–“çš„ä¸»è¦å€åˆ¥ï¼š&lt;/p&gt;
&lt;h3 id=&#34;generic-secrets-engineé€šç”¨ç§˜å¯†å¼•æ“&#34;&gt;Generic Secrets Engineï¼ˆé€šç”¨ç§˜å¯†å¼•æ“ï¼‰&lt;/h3&gt;
&lt;p&gt;ç‰¹æ€§ï¼š é€šç”¨ç§˜å¯†å¼•æ“æ˜¯ä½ çš„æœ€ç°¡å–®çš„å¼•æ“ä¹‹ä¸€ï¼Œå®ƒå…è¨±ä½ å­˜å„²å’Œæª¢ç´¢é€šç”¨çš„ Key Value Secretï¼Œé€™äº› Secret ä¸éœ€è¦ç‰¹å®šçš„çµæ§‹æˆ–æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æ³•ï¼š é€šç”¨ç§˜å¯†å¼•æ“é©ç”¨æ–¼ç°¡å–®çš„ç§˜å¯†å­˜å„²éœ€æ±‚ï¼Œå…¶ä¸­ Secret å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„æ•¸æ“šã€‚ä½ å¯ä»¥ä½¿ç”¨é€šç”¨ç§˜å¯†å¼•æ“ä¾†å­˜å„²APIé‡‘é‘°ã€å¯†ç¢¼ã€é…ç½®ä¿¡æ¯ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;key-value-kv-version-1-secrets-enginekv-v1-ç§˜å¯†å¼•æ“&#34;&gt;Key-Value (KV) Version 1 Secrets Engineï¼ˆKV v1 ç§˜å¯†å¼•æ“ï¼‰&lt;/h3&gt;
&lt;p&gt;ç‰¹æ€§ï¼š KV v1ç§˜å¯†å¼•æ“å¼•å…¥äº†ä¸€å€‹æœ‰å±¤æ¬¡çµæ§‹çš„éµå€¼å­˜å„²ï¼Œå…è¨±ä½ çµ„ç¹”å’Œç‰ˆæœ¬æ§åˆ¶å„²å­˜çš„ Secretã€‚å®ƒå…·æœ‰ Secret ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥ä¿å­˜å¤šå€‹ç‰ˆæœ¬çš„ Secretã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æ³•ï¼š KV v1å¼•æ“é©ç”¨æ–¼éœ€è¦æœ‰çµ„ç¹”çµæ§‹ä¸¦å¸Œæœ›ä¿ç•™ç§˜å¯†ç‰ˆæœ¬çš„æƒ…æ³ã€‚å®ƒå¯ä»¥ç”¨æ–¼å­˜å„²é…ç½®ä¿¡æ¯ã€TLSè­‰æ›¸ã€APIé‡‘é‘°ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;key-value-kv-version-2-secrets-enginekv-v2-ç§˜å¯†å¼•æ“&#34;&gt;Key-Value (KV) Version 2 Secrets Engineï¼ˆKV v2 ç§˜å¯†å¼•æ“ï¼‰&lt;/h3&gt;
&lt;p&gt;ç‰¹æ€§ï¼š KV v2ç§˜å¯†å¼•æ“æ˜¯KV v1çš„é€²åŒ–ç‰ˆæœ¬ï¼Œå®ƒå¼•å…¥äº†æ›´å¼·å¤§çš„ç‰¹æ€§ï¼Œå¦‚å¯é…ç½®çš„ Secret Data typeï¼ˆå¦‚å­—ç¬¦ä¸²ã€list å’Œ dictï¼‰ï¼Œä¸¦å¯è¨­ç½®çš„å¤šç‰ˆæœ¬çš„ Secret å­˜å„²ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æ³•ï¼š KV v2å¼•æ“é©ç”¨æ–¼æ›´è¤‡é›œçš„ç§˜å¯†ç®¡ç†éœ€æ±‚ï¼Œå…¶ä¸­ç§˜å¯†å¯èƒ½å…·æœ‰ä¸åŒçš„æ•¸æ“šé¡å‹ï¼Œä¸¦ä¸”éœ€è¦æ›´éˆæ´»çš„ç‰ˆæœ¬ç®¡ç†ã€‚å®ƒä¹Ÿç”¨æ–¼é…ç½®ä¿¡æ¯ã€TLSè­‰æ›¸ã€APIé‡‘é‘°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¸½çµä¾†èªªï¼Œé€šç”¨ç§˜å¯†å¼•æ“é©ç”¨æ–¼ç°¡å–®çš„ç§˜å¯†å­˜å„²ï¼Œè€ŒKV v1å’ŒKV v2ç§˜å¯†å¼•æ“é©ç”¨æ–¼æ›´è¤‡é›œçš„ç§˜å¯†ç®¡ç†éœ€æ±‚ï¼Œå…·æœ‰æ›´å¤šçš„çµ„ç¹”å’Œç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ã€‚åœ¨é¸æ“‡å¼•æ“æ™‚ï¼Œè«‹è€ƒæ…®ä½ çš„å…·é«”éœ€æ±‚å’ŒVaultçš„é…ç½®ã€‚é€šå¸¸ï¼ŒKV v2å¼•æ“æ˜¯è¼ƒæ–°å’Œæ›´éˆæ´»çš„é¸æ“‡ï¼Œä½†æ ¹æ“šä½ çš„æƒ…æ³ï¼Œä¹Ÿå¯ä»¥è€ƒæ…®ä½¿ç”¨å…¶ä»–å¼•æ“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dev-ä½¿ç”¨æƒ…å¢ƒ&#34;&gt;dev ä½¿ç”¨æƒ…å¢ƒ&lt;/h3&gt;
&lt;p&gt;dev ä¼ºæœå™¨æ‡‰è©²ç”¨æ–¼å¯¦é©— Vault çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ä¸åŒçš„èªè­‰æ–¹æ³•ã€Secret engineã€audit device ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†å¯¦é©—ï¼Œdev ä¼ºæœå™¨å°æ–¼é–‹ç™¼ç’°å¢ƒçš„è‡ªå‹•åŒ–éå¸¸å®¹æ˜“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h3&gt;
&lt;p&gt;é€šéåŸ·è¡Œé€™äº›æ­¥é©Ÿï¼Œä½ å¯ä»¥ç¢ºä¿æœ¬åœ°å®‰è£çš„ Vault Binary æ­£å¸¸é‹è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è«‹æ³¨æ„ï¼ŒVaultçš„å¯¦éš›é…ç½®å’Œä½¿ç”¨å°‡æ ¹æ“šä½ çš„éœ€æ±‚å’Œç’°å¢ƒè€Œæœ‰æ‰€ä¸åŒï¼Œé€™äº›æ­¥é©Ÿä¸»è¦ç”¨æ–¼ç¢ºä¿Vaultçš„åŸºæœ¬åŠŸèƒ½æ­£å¸¸é‹è¡Œã€‚åœ¨ production ç’°å¢ƒä¸­ï¼Œä½ éœ€è¦æ›´å¤šçš„é…ç½®å’Œå®‰å…¨æ€§æªæ–½ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vault Workshop 01: Introduction</title>
      <link>https://chechia.net/zh-hant/post/2023-09-12-vault-workshop-introduction/</link>
      <pubDate>Tue, 12 Sep 2023 20:35:19 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-09-12-vault-workshop-introduction/</guid>
      <description>&lt;p&gt;å¦‚æœä½ å¸Œæœ›è¿½è¹¤æœ€æ–°çš„è‰ç¨¿ï¼Œè«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2023/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººè³½2023&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;h1 id=&#34;day-01-å‰è¨€å¾é›¶é–‹å§‹çš„-hashicorp-vault-workshop&#34;&gt;Day 01 å‰è¨€ï¼šå¾é›¶é–‹å§‹çš„ Hashicorp Vault Workshop&lt;/h1&gt;
&lt;p&gt;å¾é›¶é–‹å§‹ workshop ç³»åˆ—å·²ç¶“åšäº†å››å¹´ï¼Œå…§å®¹åŒ…å« k8s, terraform, aws ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ·±æ·±è¦ºå¾—è¦å­¸ç¿’ä¸€å€‹å·¥å…·ï¼Œé‚„æ˜¯è¦å‹•æ‰‹åšã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æœ‰äº† 30 å¤©æ‰‹æŠŠæ‰‹ workshop ç³»åˆ—æ–‡ï¼Œè®“æœ‰èˆˆè¶£æ¥è§¸çš„æœ‹å‹ï¼Œèƒ½ä»¥ç›¸å°ä½çš„é–€æª»å…¥é–€ã€‚&lt;/p&gt;
&lt;p&gt;é—œæ–¼å…§å®¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç„¡åŸºç¤çš„æ‰‹æŠŠæ‰‹çš„åŸºç¤æ•™å­¸&lt;/li&gt;
&lt;li&gt;å®Œæ•´çš„ç¯„ä¾‹ï¼Œæä¾›åŸå§‹ç¨‹å¼ç¢¼ï¼Œä¹Ÿæä¾› production çš„ç¶“é©—èˆ‡ç¯„ä¾‹&lt;/li&gt;
&lt;li&gt;å®˜æ–¹æœ€æ–°æ–‡ä»¶ç¹ä¸­ç¿»è­¯ (chatGPT based)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å»ºè­°è®€è€…å‹™å¿…è·Ÿè‘—æ“ä½œï¼Œä¸è¦åªæ˜¯çœ‹é&lt;/p&gt;
&lt;p&gt;å…¶ä»–æ–‡ç«  &lt;a href=&#34;https://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;éå»çš„ Workshop&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2022/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2022 éµäººè³½: Terraform IaC Best Practice on AWS Cloud / åœ¨ aws å…¬æœ‰é›²ä¸Šæ‰¾ IaC æœ€ä½³å¯¦è¸ (å› æ•…é€€è³½)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/4057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2021 éµäººè³½: Terraform Workshop - Infrastructure as Code for Public Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2020/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 éµäººè³½: Kubernetes X DevOps X å¾é›¶é–‹å§‹å°å…¥å·¥å…· X éœ€æ±‚åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/tag/%E9%90%B5%E4%BA%BA%E8%B3%BD2019/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2019 éµäººè³½: Kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é å®šå…§å®¹èˆ‡è¨±é¡˜æ¸…å–®&#34;&gt;é å®šå…§å®¹èˆ‡è¨±é¡˜æ¸…å–®&lt;/h1&gt;
&lt;p&gt;æœ¬ workshop é è¨ˆæœ‰åº•ä¸‹å…§å®¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Day 01 å‰è¨€ï¼šå¾é›¶é–‹å§‹çš„ Hashicorp Vault Workshop&lt;/li&gt;
&lt;li&gt;Day 02 æº–å‚™ï¼šåŸ·è¡Œä¸€å€‹æœ¬åœ°é–‹ç™¼ç”¨é€”çš„ Vault&lt;/li&gt;
&lt;li&gt;Day 03ï¼šç´°æ¢ Secret Engine ç§˜å¯†å¼•æ“&lt;/li&gt;
&lt;li&gt;Day 04ï¼šSecret Engine KV V2&lt;/li&gt;
&lt;li&gt;Day 05ï¼šAuthentication&lt;/li&gt;
&lt;li&gt;Day 06: Github auth method&lt;/li&gt;
&lt;li&gt;Day 07: Policy&lt;/li&gt;
&lt;li&gt;Day 08: Docker and Initialization&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬ workshop ä¹Ÿæ¥å—ç¶²å‹çš„è¨±é¡˜æ¸…å–®ï¼Œ&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10317378&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®å¯æ–¼ç¬¬ä¸€ç¯‡åº•ä¸‹ç•™è¨€&lt;/a&gt;ï¼Œç­†è€…æœƒç›¡åŠ›å¯¦ç¾ï¼Œä½†ä¸åšä»»ä½•ä¿è­‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dynamic Secrets&lt;/li&gt;
&lt;li&gt;tls certificate management&lt;/li&gt;
&lt;li&gt;configuration&lt;/li&gt;
&lt;li&gt;docker
&lt;ul&gt;
&lt;li&gt;initialization&lt;/li&gt;
&lt;li&gt;ha&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;storage backend
&lt;ul&gt;
&lt;li&gt;filesystem&lt;/li&gt;
&lt;li&gt;postgresql&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Infrastructure as Code for Vault
&lt;ul&gt;
&lt;li&gt;deploy&lt;/li&gt;
&lt;li&gt;policy&lt;/li&gt;
&lt;li&gt;auth method&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Vault Kuberntes integration&lt;/li&gt;
&lt;li&gt;Azure integration&lt;/li&gt;
&lt;li&gt;AWS integration&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/concepts/tokens#root-tokens&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;token in detail&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é—œæ–¼ç¿»è­¯å·¥å…·-chatgpt&#34;&gt;é—œæ–¼ç¿»è­¯å·¥å…· chatGPT&lt;/h3&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« å¤§é‡ä½¿ç”¨ chatGPT ç¿»è­¯å®˜æ–¹æ–‡ç« ã€‚ç›®çš„æ˜¯ä½¿ç”¨æœ€æ–°ç‰ˆå®˜æ–¹æ–‡ä»¶å…§å®¹ï¼Œæä¾›ç¬¬ä¸€æ‰‹ä¸”ç²¾æº–çš„è³‡æ–™çµ¦è®€è€…ï¼Œä½†åˆèƒ½é™ä½éæ¯èªè®€è€…å¾—å­¸ç¿’é–€æª»ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ç¿»è­¯çš„æ®µè½éƒ½æœƒæ¨™ç¤ºå‡ºè™•ï¼Œè‘—ä½œæ¬Šçš†å±¬æ–¼åŸå‡ºè™•æ‰€æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« ä»¥åˆ†äº«è³‡è¨Šï¼Œè²¢ç»ç¤¾ç¾¤ï¼Œæé«˜åœ‹å…§æ•´é«”æŠ€è¡“èƒ½åŠ›ç‚ºç›®çš„ï¼Œä¸¦ä¸ç”¨æ–¼å•†æ¥­ç”¨é€”ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç¿»è­¯å·¥å…·ä¸¦ä¸ä»£è¡¨ä½œè€…ï¼ˆè­¯è€…ï¼‰æ²’æœ‰ä»˜å‡ºç›¸ç•¶æ™‚é–“å¿ƒåŠ›ï¼ŒåŒ…å«è¦åŠƒæ–‡ç« å¤§ç¶±ï¼Œæ¸¬è©¦ prompt engineeringï¼Œèª¿æ•´åƒæ•¸ï¼Œä¸¦äººå·¥æ ¡æ­£ç”¢ç”Ÿçš„å…§å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç³»åˆ—ä½œå“åœ¨æ–¼æ•™å°è®€è€…ä½¿ç”¨å·¥å…· Hashicorp Vaultï¼Œè€Œ chatGPT ç­‰å¤§èªè¨€æ¨¡å‹å·¥å…·å°±æ˜¯è¿‘å¹´æœ€å€¼å¾—å­¸ç¿’çš„å·¥å…·ã€‚å¦‚æœè®€è€…é‚„ä¸æœƒä½¿ç”¨ chatGPTï¼Œæœ¬ç³»åˆ—æ–‡ç« éƒ½é™„ä¸Š Prompt æç¤ºè©ï¼Œå¯ä»¥åƒè€ƒï¼Œå­¸ç¿’ï¼Œä¸¦è‡ªç”±ä½¿ç”¨ã€‚ä¹Ÿè¨±å­¸æœƒä½¿ç”¨ chatGPT æ‰€å¸¶ä¾†çš„åƒ¹å€¼ï¼Œæœƒæ¯”å­¸ç¿’ Vault å¸¶ä¾†çš„é‚„å¤šã€‚&lt;/p&gt;
&lt;p&gt;å¾ˆé‡è¦æ‰€ä»¥å†èªªä¸€éï¼ŒchatGPT æ˜¯è¿‘å¹´æœ€å€¼å¾—å­¸ç¿’çš„å·¥å…·ï¼Œæ²’æœ‰ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/f/awesome-chatgpt-prompts/blob/main/prompts.csv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/f/awesome-chatgpt-prompts/blob/main/prompts.csv&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;what-is-vault&#34;&gt;What is Vault?&lt;/h1&gt;
&lt;p&gt;æœ¬æ®µå…§å®¹ä½¿ç”¨ chatGPT-3.5 ç¿»è­¯
&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/what-is-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://developer.hashicorp.com/vault/docs/what-is-vault&lt;/a&gt;
å…§å®¹ï¼Œä¸¦ç”±ç­†è€…äººå·¥æ ¡é©—&lt;/p&gt;
&lt;p&gt;base context&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æˆ‘å¸Œæœ›ä½ èƒ½å……ç•¶ä¸€åç¹é«”ä¸­æ–‡ç¿»è­¯ï¼Œæ‹¼å¯«ä¿®æ­£è€…å’Œæ”¹é€²è€…ã€‚æˆ‘å°‡ç”¨è‹±æ–‡èˆ‡ç¨‹å¼èªè¨€èˆ‡ä½ å°è©±ï¼Œä½ å°‡ç¿»è­¯å®ƒï¼Œä¸¦ä»¥å·²ç³¾æ­£ä¸”æ”¹é€²çš„ç‰ˆæœ¬å›ç­”ï¼Œä»¥ç¹é«”ä¸­æ–‡è¡¨é”ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ç”¨æ›´ç¾éº—å’Œå„ªé›…ã€é«˜ç´šçš„ç¹é«”ä¸­æ–‡è©èªå’Œå¥å­æ›¿æ›æˆ‘ç°¡åŒ–çš„è©èªå’Œå¥å­ã€‚ä¿æŒæ„ç¾©ä¸è®Šã€‚æˆ‘åªå¸Œæœ›ä½ å›ç­”ç³¾æ­£å’Œæ”¹é€²ï¼Œä¸è¦å¯«è§£é‡‹ã€‚ä¸è¦ä½¿ç”¨æ•¬èªï¼Œè«‹ç”¨ä½ å–ä»£æ‚¨ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;result correction&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;éƒ¨åˆ†è‹±æ–‡å…§å®¹ç‚ºå°ˆæœ‰åè©ï¼Œç”¢ç”Ÿçš„ç¹é«”ä¸­æ–‡ç¿»è­¯çµæœä¸­ï¼Œé€™äº›åè©ç¶­æŒè‹±æ–‡ï¼Œä¸éœ€è¦ç¿»è­¯æˆä¸­æ–‡ï¼škeyï¼Œcertificateï¼Œtokenï¼Œpolicyï¼Œpolicy ruleï¼Œpathï¼Œpath-basedï¼Œkey rollingï¼Œauditï¼Œaudit trailï¼Œplain textï¼Œkey valueï¼ŒConsulï¼ŒS3 bucketï¼ŒLeasingï¼ŒRenewalï¼Œbinary
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä¿®æ­£ä¸‹åˆ—ç¿»è­¯ï¼šç§˜å¯†æ”¹ç‚ºç§é‘°ï¼Œæ•¸æ“šæ”¹ç‚ºè³‡æ–™ï¼Œæ•¸æ“šåº«æ”¹ç‚ºè³‡æ–™åº«ï¼Œæ•¸æ“šæ”¹ç‚ºè³‡æ–™ï¼Œè¨ªå•æ”¹ç‚ºå­˜å–ï¼Œæºä»£ç¢¼æ”¹ç‚ºåŸå§‹ç¢¼ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;what-is-vault-1&#34;&gt;What is Vault?&lt;/h3&gt;
&lt;p&gt;HashiCorp Vault æ˜¯ä¸€å¥—åŸºæ–¼èº«ä»½çš„ç§é‘°å’ŒåŠ å¯†ç®¡ç†ç³»çµ±ã€‚æ‰€è¬‚çš„&amp;quot;ç§é‘°&amp;quot;ï¼Œæ˜¯ä½ å¸Œæœ›åš´æ ¼æ§åˆ¶å­˜å–çš„è³‡è¨Šï¼Œä¾‹å¦‚ API keyã€å¯†ç¢¼å’Œcertificateã€‚Vault æä¾›åŠ å¯†æœå‹™ï¼Œä¸¦é€éèªè­‰å’Œæˆæ¬Šæ–¹æ³•é€²è¡Œç®¡æ§ã€‚ä½¿ç”¨ Vault çš„ä½¿ç”¨è€…ä»‹é¢ã€å‘½ä»¤åˆ—ä»‹é¢æˆ– HTTP APIï¼Œå¯ä»¥å®‰å…¨åœ°å„²å­˜å’Œç®¡ç†ç§é‘°åŠå…¶ä»–æ•æ„Ÿè³‡æ–™ï¼Œä¸¦èƒ½åš´æ ¼æ§åˆ¶ï¼ˆé™åˆ¶ï¼‰å…¶å­˜å–æ¬Šï¼Œä¸¦å¯é€²è¡Œ auditã€‚&lt;/p&gt;
&lt;p&gt;ç¾ä»£ç³»çµ±éœ€è¦å­˜å–å¤§é‡çš„ç§é‘°ï¼ŒåŒ…æ‹¬è³‡æ–™åº«æ†‘è­‰ã€å¤–éƒ¨æœå‹™çš„ API keyã€é¢å‘æœå‹™çš„æ¶æ§‹é€šè¨Šæ†‘è­‰ç­‰ã€‚äº†è§£èª°æ­£åœ¨å­˜å–å“ªäº›ç§é‘°å¯èƒ½ç›¸ç•¶å›°é›£ï¼Œå°¤å…¶ç•¶é€™ç¨®å­˜å–å¯èƒ½å› å¹³å°è€Œç•°ã€‚è€Œåœ¨æ­¤åŸºç¤ä¸ŠåŠ å…¥key rollingã€å®‰å…¨å„²å­˜å’Œè©³ç´°çš„audit trailï¼Œè‹¥ç„¡è‡ªè¨‚çš„è§£æ±ºæ–¹æ¡ˆå¹¾ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚é€™æ­£æ˜¯ Vault ç™¼æ®ä½œç”¨çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;Vault æœƒé©—è­‰ä¸¦æˆæ¬Šå®¢æˆ¶ç«¯ï¼ˆç”¨æˆ¶ã€æ©Ÿå™¨ã€æ‡‰ç”¨ç¨‹åºï¼‰åœ¨æä¾›ä»–å€‘å­˜å–ç§˜å¯†æˆ–å„²å­˜çš„æ•æ„Ÿè³‡æ–™ä¹‹å‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;vault-å¦‚ä½•é‹ä½œ&#34;&gt;Vault å¦‚ä½•é‹ä½œï¼š&lt;/h3&gt;
&lt;p&gt;Vault ä¸»è¦ä½¿ç”¨ tokenï¼Œä¸” token èˆ‡å®¢æˆ¶ç«¯çš„ policy ç›¸é—œè¯ã€‚æ¯ä¸€ policy éƒ½æ˜¯åŸºæ–¼ path-based çš„ï¼Œpolicy rule é™åˆ¶æ¯å€‹å®¢æˆ¶ç«¯å°æ–¼æ¯ä¸€ path çš„è¡Œå‹•å’Œå­˜å–èƒ½åŠ›ã€‚ä½¿ç”¨ Vaultï¼Œä½ å¯ä»¥æ‰‹å‹•å»ºç«‹ token ä¸¦æŒ‡æ´¾çµ¦ä½ çš„å®¢æˆ¶ç«¯ï¼Œæˆ–å®¢æˆ¶ç«¯å¯ä»¥ç™»å…¥ä¸¦ç²å¾— tokenã€‚ä¸‹é¢çš„æ’åœ–é¡¯ç¤ºäº† Vault çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dvault%26version%3Drefs%252Fheads%252Frelease%252F1.14.x%26asset%3Dwebsite%252Fpublic%252Fimg%252Fhow-vault-works.png%26width%3D2077%26height%3D1343&amp;amp;w=3840&amp;amp;q=75&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;vault-å·¥ä½œæµç¨‹&#34;&gt;Vault å·¥ä½œæµç¨‹&lt;/h3&gt;
&lt;p&gt;Vault çš„æ ¸å¿ƒå·¥ä½œæµç¨‹åŒ…å«å››å€‹éšæ®µï¼š&lt;/p&gt;
&lt;p&gt;èªè­‰ï¼šåœ¨ Vault ä¸­çš„èªè­‰æ˜¯æŒ‡å®¢æˆ¶ç«¯æä¾›è³‡è¨Šï¼ŒVault ä½¿ç”¨æ­¤è³‡è¨Šä¾†åˆ¤å®šä»–å€‘æ˜¯å¦æ˜¯ä»–å€‘æ‰€è²ç¨±çš„é‚£å€‹äººã€‚ä¸€æ—¦å®¢æˆ¶ç«¯æ ¹æ“šæŸç¨®èªè­‰æ–¹å¼æˆåŠŸèªè­‰ï¼Œå°‡ç”Ÿæˆä¸€å€‹èˆ‡ç­–ç•¥ç›¸é—œè¯çš„ tokenã€‚&lt;/p&gt;
&lt;p&gt;é©—è­‰ï¼šVault æ ¹æ“šç¬¬ä¸‰æ–¹å—ä¿¡è³´çš„ä¾†æºï¼Œä¾‹å¦‚ Githubã€LDAPã€AppRole ç­‰ï¼Œå°å®¢æˆ¶ç«¯é€²è¡Œé©—è­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆæ¬Šï¼šå®¢æˆ¶ç«¯æ ¹æ“š Vault å®‰å…¨ç­–ç•¥é€²è¡ŒåŒ¹é…ã€‚æ­¤ç­–ç•¥æ˜¯ä¸€å¥—è¦å‰‡é›†ï¼Œå®šç¾©å®¢æˆ¶ç«¯ä½¿ç”¨å…¶ Vault token å¯å­˜å–å“ªäº› API ç«¯é»ã€‚ç­–ç•¥æä¾›äº†ä¸€ç¨®å®£å‘Šæ–¹å¼ä¾†æˆäºˆæˆ–ç¦æ­¢å­˜å– Vault ä¸­çš„ç‰¹å®šè·¯å¾‘å’Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å­˜å–ï¼šæ ¹æ“šèˆ‡å®¢æˆ¶ç«¯èº«ä»½ç›¸é—œè¯çš„ç­–ç•¥ï¼ŒVault é€šéç™¼å‡º token ä¾†æˆäºˆå­˜å–ç§˜å¯†ã€é‡‘é‘°å’ŒåŠ å¯†èƒ½åŠ›çš„æ¬Šé™ã€‚ç„¶å¾Œï¼Œå®¢æˆ¶ç«¯å¯ä»¥ä½¿ç”¨ä»–å€‘çš„ Vault token é€²è¡Œæœªä¾†çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dvault%26version%3Drefs%252Fheads%252Frelease%252F1.14.x%26asset%3Dwebsite%252Fpublic%252Fimg%252Fvault-workflow-diagram1.png%26width%3D8300%26height%3D9000&amp;amp;w=3840&amp;amp;q=75&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ç‚ºä»€éº¼é¸æ“‡-vault&#34;&gt;ç‚ºä»€éº¼é¸æ“‡ Vaultï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ç¾ä»Šçš„å¤§å¤šæ•¸ä¼æ¥­éƒ½æœ‰æ†‘è­‰æ•£å¸ƒåœ¨å…¶çµ„ç¹”ä¸­ã€‚å¯†ç¢¼ã€API é‡‘é‘°å’Œæ†‘è­‰å­˜å„²åœ¨æ˜æ–‡ä¸­ã€æ‡‰ç”¨æºä»£ç¢¼ã€é…ç½®æ–‡ä»¶å’Œå…¶ä»–ä½ç½®ã€‚ç”±æ–¼é€™äº›æ†‘è­‰å­˜åœ¨æ–¼å„è™•ï¼Œå› æ­¤å¯èƒ½å¾ˆé›£çœŸæ­£çŸ¥é“èª°æœ‰å­˜å–å’Œæˆæ¬Šæ¬Šé™ã€‚æ˜æ–‡ä¸­çš„æ†‘è­‰ä¹Ÿå¢åŠ äº†å…§éƒ¨å’Œå¤–éƒ¨æ”»æ“Šè€…é€²è¡Œæƒ¡æ„æ”»æ“Šçš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒæ…®åˆ°é€™äº›æŒ‘æˆ°ï¼ŒVault è¢«è¨­è¨ˆå‡ºä¾†ã€‚Vault æ¡å–æ‰€æœ‰é€™äº›æ†‘è­‰ä¸¦é›†ä¸­ç®¡ç†ï¼Œé€™æ¨£ä»–å€‘å°±åªåœ¨ä¸€å€‹ä½ç½®å®šç¾©ï¼Œå¾è€Œæ¸›å°‘äº†æ†‘è­‰çš„ä¸å¿…è¦æš´éœ²ã€‚ä½† Vault æ›´é€²ä¸€æ­¥ï¼Œç¢ºä¿ç”¨æˆ¶ã€æ‡‰ç”¨ç¨‹åºå’Œç³»çµ±éƒ½è¢«èªè­‰ä¸¦æ˜ç¢ºæˆæ¬Šå­˜å–è³‡æºï¼ŒåŒæ™‚ä¹Ÿæä¾›ä¸€å€‹å¯©è¨ˆè·Ÿè¸ªï¼Œæ•æ‰ä¸¦ä¿ç•™å®¢æˆ¶ç«¯æ“ä½œçš„æ­·å²è¨˜éŒ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;vault-çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬&#34;&gt;Vault çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬&lt;/h3&gt;
&lt;p&gt;å®‰å…¨çš„ç§˜å¯†å­˜å„²ï¼šå¯ä»¥åœ¨ Vault ä¸­å­˜å„²ä»»æ„çš„é‡‘é‘°/å€¼ç§˜å¯†ã€‚Vault åœ¨å°‡é€™äº›ç§˜å¯†å¯«å…¥æŒä¹…æ€§å­˜å„²ä¹‹å‰æœƒå°å…¶é€²è¡ŒåŠ å¯†ï¼Œå› æ­¤ç²å–åŸå§‹å­˜å„²ä¸¦ä¸è¶³ä»¥å­˜å–ä½ çš„ç§˜å¯†ã€‚Vault å¯ä»¥å¯«å…¥ç£ç›¤ã€Consul ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å‹•æ…‹ç§˜å¯†ï¼šVault å¯ä»¥ç‚ºæŸäº›ç³»çµ±å³æ™‚ç”Ÿæˆç§˜å¯†ï¼Œä¾‹å¦‚ AWS æˆ– SQL æ•¸æ“šåº«ã€‚ä¾‹å¦‚ï¼Œç•¶æ‡‰ç”¨ç¨‹åºéœ€è¦å­˜å– S3 æ¡¶æ™‚ï¼Œå®ƒæœƒè¦æ±‚ Vault æä¾›æ†‘è­‰ï¼ŒVault å°‡å³æ™‚ç”Ÿæˆå…·æœ‰æœ‰æ•ˆæ¬Šé™çš„ AWS å¯†é‘°å°ã€‚åœ¨å‰µå»ºé€™äº›å‹•æ…‹ç§˜å¯†å¾Œï¼ŒVault ä¹Ÿæœƒåœ¨ç§ŸæœŸåˆ°æœŸå¾Œè‡ªå‹•æ’¤éŠ·å®ƒå€‘ã€‚&lt;/p&gt;
&lt;p&gt;æ•¸æ“šåŠ å¯†ï¼šVault å¯ä»¥åœ¨ä¸å­˜å„²æ•¸æ“šçš„æƒ…æ³ä¸‹åŠ å¯†å’Œè§£å¯†æ•¸æ“šã€‚é€™å…è¨±å®‰å…¨åœ˜éšŠå®šç¾©åŠ å¯†åƒæ•¸ï¼Œä¸¦å…è¨±é–‹ç™¼äººå“¡å°‡åŠ å¯†æ•¸æ“šå­˜å„²åœ¨å¦‚ SQL æ•¸æ“šåº«ä¹‹é¡çš„åœ°æ–¹ï¼Œè€Œä¸å¿…è¨­è¨ˆä»–å€‘è‡ªå·±çš„åŠ å¯†æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç§Ÿè³ƒå’ŒçºŒæœŸï¼šVault ä¸­çš„æ‰€æœ‰ç§˜å¯†éƒ½æœ‰ä¸€å€‹èˆ‡ä¹‹ç›¸é—œçš„ç§ŸæœŸã€‚åœ¨ç§ŸæœŸçµæŸæ™‚ï¼ŒVault æœƒè‡ªå‹•æ’¤éŠ·è©²ç§˜å¯†ã€‚å®¢æˆ¶ç«¯å¯ä»¥é€šéå…§ç½®çš„çºŒæœŸ API ä¾†çºŒç§Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ’¤éŠ·ï¼šVault å…·æœ‰å…§ç½®çš„ç§˜å¯†æ’¤éŠ·æ”¯æ´ã€‚Vault ä¸åƒ…å¯ä»¥æ’¤éŠ·å–®ä¸€çš„ç§˜å¯†ï¼Œé‚„å¯ä»¥æ’¤éŠ·ç§˜å¯†æ¨¹ï¼Œä¾‹å¦‚ç”±ç‰¹å®šç”¨æˆ¶è®€å–çš„æ‰€æœ‰ç§˜å¯†ï¼Œæˆ–ç‰¹å®šé¡å‹çš„æ‰€æœ‰ç§˜å¯†ã€‚æ’¤éŠ·åœ¨é‡‘é‘°æ»¾å‹•ä»¥åŠåœ¨å…¥ä¾µæƒ…æ³ä¸‹é–å®šç³»çµ±æ™‚éƒ½å¾ˆæœ‰å¹«åŠ©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä»€éº¼æ˜¯-hcp-vault&#34;&gt;ä»€éº¼æ˜¯ HCP Vaultï¼Ÿ&lt;/h3&gt;
&lt;p&gt;HashiCorp Cloud Platform (HCP) Vault æ˜¯ Vault çš„è¨—ç®¡ç‰ˆæœ¬ï¼Œç”± HashiCorp é‹ç‡Ÿï¼Œä½¿çµ„ç¹”èƒ½å¤ å¿«é€Ÿå•Ÿå‹•ä¸¦é‹è¡Œã€‚HCP Vault ä½¿ç”¨èˆ‡è‡ªè¨—ç®¡çš„ Vault ç›¸åŒçš„äºŒé€²åˆ¶æ–‡ä»¶ï¼Œé€™æ„å‘³è‘—ä½ å°‡æ“æœ‰ä¸€è‡´çš„ç”¨æˆ¶é«”é©—ã€‚ä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ Vault å®¢æˆ¶ç«¯èˆ‡ HCP Vault é€šä¿¡ï¼Œå°±åƒä½ ä½¿ç”¨è‡ªè¨—ç®¡çš„ Vault ä¸€æ¨£ã€‚è«‹åƒè€ƒ HCP Vault æ–‡æª”ä»¥ç²å¾—æ›´å¤šè³‡è¨Šã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¾é›¶é–‹å§‹çš„ 30 å¤© Hashicorp Vault Workshop</title>
      <link>https://chechia.net/zh-hant/project/vault-playground/</link>
      <pubDate>Sun, 10 Sep 2023 00:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/project/vault-playground/</guid>
      <description></description>
    </item>
    
    <item>
      <title>HashiCorp Vault on AWS &amp; K8s - é›²ç«¯åœ°ç«¯é€šåƒçš„ç§é‘°ç®¡ç†å¹³å°</title>
      <link>https://chechia.net/zh-hant/talk/hashicorp-vault-on-aws-k8s-%E9%9B%B2%E7%AB%AF%E5%9C%B0%E7%AB%AF%E9%80%9A%E5%90%83%E7%9A%84%E7%A7%81%E9%91%B0%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/</link>
      <pubDate>Wed, 10 May 2023 11:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/talk/hashicorp-vault-on-aws-k8s-%E9%9B%B2%E7%AB%AF%E5%9C%B0%E7%AB%AF%E9%80%9A%E5%90%83%E7%9A%84%E7%A7%81%E9%91%B0%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/</guid>
      <description>&lt;h1 id=&#34;info&#34;&gt;Info&lt;/h1&gt;
&lt;p&gt;ç¾ä»£ç¶²è·¯æ‡‰ç”¨éœ€è¦è™•ç†è¨±å¤šç§å¯†é‡‘é‘°çš„ç®¡ç†ï¼Œä¾‹å¦‚ï¼šuser çš„å¯†ç¢¼ã€server çš„è³‡æ–™ã€database çš„è³‡æ–™ã€microservices å½¼æ­¤ authentication&amp;hellip;ã€‚åŠ ä¸Šé§­å®¢åœ˜é«”çŒ–ç—ï¼Œè¨±å¤šåœ‹å…§å¤–çŸ¥åä¼æ¥­ç´›ç´›é­é§­ï¼Œå°è‡´å…¬å¸èˆ‡ä½¿ç”¨è€…çš„æå¤±ã€‚ å¦‚ä½•ç³»çµ±åŒ–ä¸”è‡ªå‹•åŒ–ç®¡ç†å¤§é‡çš„ç§å¯†è³‡æ–™ï¼Œæˆç‚ºç³»çµ±æ•´é«”å®‰å…¨æ€§çš„é—œéµã€‚&lt;/p&gt;
&lt;p&gt;HashiCorp Vault ç‚ºä¸€æ¬¾é–‹æºçš„ç§å¯†è³‡æ–™ç®¡ç†å¹³å°ï¼Œé™¤äº†ä¿éšœç³»çµ±å®‰å…¨æ€§ï¼Œæ¯”èµ·å¸‚é¢ä¸Šçš„å…¶ä»–ç®¡ç†å·¥å…·ï¼Œé‚„æœ‰è¨±å¤šç‰¹é»å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;ä¸ä¾è³´å¤–éƒ¨æœå‹™ï¼Œé©åˆè‡ªè¡Œæ¶è¨­åœ¨å…§éƒ¨å…¬æœ‰é›²/ç§æœ‰é›²/å‚³çµ± server/Kubernetes/VM
æ”¯æ´è·¨ç’°å¢ƒçš„æ‡‰ç”¨ï¼Œå¯ä»¥ä¸²é€£æ··åˆé›²ä¸­çš„æ‡‰ç”¨ï¼Œä½œç‚ºç§é‘°èªè­‰çš„ä¸­å¿ƒ&lt;/p&gt;
&lt;h1 id=&#34;target-group&#34;&gt;Target group&lt;/h1&gt;
&lt;p&gt;æœ¬æ¬¡æ´»å‹•å°‡ç°¡ä»‹ Hashicorp Vaultï¼Œä¸¦ä»¥ AWS Cloud èˆ‡æœ¬åœ° Kubernetes ç‚ºä¾‹ï¼Œæä¾›å¹¾å€‹åŸºæœ¬çš„æ“ä½œç¯„ä¾‹ï¼Œé©åˆåˆæ¬¡æ¥è§¸ HashiCorp Vault èˆ‡å°‹æ‰¾ç§é‘°ç®¡ç†å¹³å°çš„åœ˜éšŠã€‚&lt;/p&gt;
&lt;h1 id=&#34;author&#34;&gt;Author&lt;/h1&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2023 DevOpsDay&lt;/li&gt;
&lt;li&gt;2023 Ithome Kubernetes Summit&lt;/li&gt;
&lt;li&gt;2022 COSCUP&lt;/li&gt;
&lt;li&gt;2022 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2021 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2020 DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/li&gt;
&lt;li&gt;2020 Cloud Native Taiwan å¹´æœ«èšæœƒ&lt;/li&gt;
&lt;li&gt;2020 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2019 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Cloud Summit&lt;/li&gt;
&lt;li&gt;2018 Ithome Kubernetes Summit&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Hashicorp Comminity Presentation Vault Introduction</title>
      <link>https://chechia.net/zh-hant/post/2023-05-10-hashicorp-comminity-presentation-vault-introduction/</link>
      <pubDate>Wed, 10 May 2023 12:19:02 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2023-05-10-hashicorp-comminity-presentation-vault-introduction/</guid>
      <description>&lt;h1 id=&#34;target-group&#34;&gt;target group&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;é‡‘èå®¢æˆ¶&lt;/li&gt;
&lt;li&gt;vault&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;4/15 ä¸Šæ¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;accupass
5/10 (Wed) 11:00-12:00&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;webbase link (online)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;10:30 ä¸Šç·šè¨­å‚™æ¸¬è©¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;11:00 Ming é–‹å ´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;11:05 ä¸»è¬›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;12:00 Q&amp;amp;A (ç•™è¨€)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç•¶å¤©éŒ„å½±æœƒä¸Šç·š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¼”è¬›å¤§ç¶±&#34;&gt;æ¼”è¬›å¤§ç¶±&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬ä»‹ç´¹ vault æ¶æ§‹&lt;/li&gt;
&lt;li&gt;ä¼æ¥­éœ€æ±‚
&lt;ul&gt;
&lt;li&gt;self-host&lt;/li&gt;
&lt;li&gt;è¤‡é›œçš„ policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”¨ä¾‹ demo
&lt;ul&gt;
&lt;li&gt;aws auth&lt;/li&gt;
&lt;li&gt;k8s auth&lt;/li&gt;
&lt;li&gt;policy&lt;/li&gt;
&lt;li&gt;ç•¶å¤©æä¾› github example&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Q&amp;amp;A (10mins)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…§å®¹&#34;&gt;å…§å®¹&lt;/h1&gt;
&lt;p&gt;æ¼”è¬›ä¸»é¡Œï¼šHashicorp vault é›²ç«¯åœ°ç«¯é€šåƒçš„ç§é‘°ç®¡ç†å¹³å°&lt;/p&gt;
&lt;p&gt;ç¾ä»£ç¶²è·¯æ‡‰ç”¨éœ€è¦è™•ç†è¨±å¤šç§å¯†é‡‘æ›œçš„ç®¡ç†ï¼Œä¾‹å¦‚ï¼šuser çš„å¯†ç¢¼ï¼Œserver çš„è³‡æ–™ï¼Œdatabase çš„è³‡æ–™ï¼Œmicroservices å½¼æ­¤ authentication&amp;hellip;ã€‚åŠ ä¸Šé§­å®¢åœ˜é«”çŒ–ç—ï¼Œè¨±å¤šåœ‹å…§å¤–çŸ¥åä¼æ¥­ç´›ç´›é­é§­ï¼Œå°è‡´å…¬å¸èˆ‡ä½¿ç”¨è€…çš„æå¤±ã€‚
å¦‚ä½•ç³»çµ±åŒ–ä¸”è‡ªå‹•åŒ–ç®¡ç†å¤§é‡çš„ç§å¯†è³‡æ–™ï¼Œæˆç‚ºç³»çµ±æ•´é«”å®‰å…¨æ€§çš„é—œéµã€‚
Hashicorp Vault ç‚ºä¸€æ¬¾é–‹æºçš„ç§å¯†è³‡æ–™ç®¡ç†å¹³å°ï¼Œé™¤äº†ä¿éšœç³»çµ±å®‰å…¨æ€§ï¼Œæ¯”èµ·å¸‚é¢ä¸Šçš„å…¶ä»–ç®¡ç†å·¥å…·ï¼Œæœ‰è¨±å¤šç‰¹é»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä¾è³´å¤–éƒ¨æœå‹™ï¼Œé©åˆè‡ªè¡Œæ¶è¨­åœ¨å…§éƒ¨å…¬æœ‰é›²/ç§æœ‰é›²/å‚³çµ±server/Kubernetes/VM&lt;/li&gt;
&lt;li&gt;æ”¯æ´è·¨ç’°å¢ƒçš„æ‡‰ç”¨ï¼Œå¯ä»¥ä¸²é€£æ··åˆé›²ä¸­çš„æ‡‰ç”¨ï¼Œä½œç‚ºç§è¦èªè­‰çš„ä¸­å¿ƒ
æœ¬æ¬¡æ¼”è¬›ç°¡ä»‹ Hashicorp Vaultï¼Œä»¥ aws cloud èˆ‡æœ¬åœ° kubernetes ç‚ºä¾‹ï¼Œæä¾›å¹¾å€‹åŸºæœ¬çš„æ“ä½œç¯„ä¾‹
é©åˆåˆæ¬¡æ¥è§¸çš„ Hashicorp Vaultï¼Œèˆ‡å°‹æ‰¾ç§è¦ç®¡ç†å¹³å°çš„åœ˜éšŠ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¬›è€…ç°¡ä»‹&lt;/p&gt;
&lt;p&gt;Che-Chia Changï¼ŒSREï¼Œå–œæ­¡ç ”ç©¶å…¬æœ‰é›²/å®¹å™¨åŒ–æ‡‰ç”¨/Kubernetes
Microsoft MVPï¼ŒIthome é›²ç«¯å¤§æœƒ/COSCUPè¬›å¸«ï¼Œå¸¸å‡ºç¾ CNTUG / DevOpsTW / Golang Taipei
æŠ€è¡“ blog æ”¶éŒ„éå¾€æ¼”è¬›èˆ‡æ–‡ç«  &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;presentation&#34;&gt;Presentation&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1iex9lm89OCIR8IAoD1RPe4vcW--bcKBmMHoixDybqP8/edit#slide=id.g2403737215e_0_147&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.google.com/presentation/d/1iex9lm89OCIR8IAoD1RPe4vcW--bcKBmMHoixDybqP8/edit#slide=id.g2403737215e_0_147&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Github Action CI/CD</title>
      <link>https://chechia.net/zh-hant/post/2022-09-25-14th-ithome-ironman-iac-aws-workshop-11-aws-github-action-ci-cd/</link>
      <pubDate>Sun, 25 Sep 2022 20:39:03 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-25-14th-ithome-ironman-iac-aws-workshop-11-aws-github-action-ci-cd/</guid>
      <description>&lt;p&gt;AWS cross account delegation ä¾èˆŠ WIPï¼Œä»Šå¤©å»¶çºŒæ˜¨å¤©å…§å®¹ï¼Œä½¿ç”¨ github action åš terraform module çš„ CI/CD&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;terraform-github-action-jobs&#34;&gt;Terraform Github Action Jobs&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å¯ä»¥åœ¨ terraform repository ä¸­å¢åŠ  tool checks åˆ° CI/CD ä¸­ï¼ŒåŠ å¼· code çš„å“è³ªæ§ç®¡&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/6&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-modules PR åœ¨æ­¤&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€™å€‹ PR åŒ…å«å¹¾å€‹ Github Action Workflow&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls .github/workflows
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;checkov.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;format.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plan.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;security-scan.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;validate.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;format.yaml ä¸­åŸ·è¡Œ terraform fmt -recursiveï¼Œéœ€æ±‚èˆ‡ç›®çš„å·²åœ¨æ˜¨å¤©èªªæ˜&lt;/li&gt;
&lt;li&gt;validate.yaml ä¸­åŸ·è¡Œ terraform validateï¼Œç”¨ä¾†é©—è­‰ module å…§çš„ terraform syntax æ˜¯å¦ç¬¦åˆèªæ³•&lt;/li&gt;
&lt;li&gt;checkov.yaml æ˜¯å¤šèªè¨€çš„ policy as code å·¥å…·ï¼Œåœ¨é€™é‚ŠåŸ·è¡Œæƒæ terraform code çš„å®‰å…¨æ€§èˆ‡ CVEs æª¢æŸ¥&lt;/li&gt;
&lt;li&gt;security-scan.yaml ä¸­ä¹Ÿæ˜¯ Policy As Code ä½¿ç”¨ tfsec å·¥å…·æƒæ&lt;/li&gt;
&lt;li&gt;plan.yaml ä¸­åœ¨ pipeline åŸ·è¡Œè‡ªå‹•åŒ– terraform plan
&lt;ul&gt;
&lt;li&gt;ç”±æ–¼ plan éœ€è¦å­˜å– state èˆ‡ provider APIï¼Œè¨­å®šä¸Šæœ‰è¨±å¤šæ¬Šé™è¨­å®šéœ€è¦é–‹å•Ÿï¼Œç›®å‰æ˜¯ä¸€å€‹ dummy workflow&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;policy as code å…§å®¹å¯ä»¥å°‡ä¸€ç¯‡æ¼”è¬›ï¼Œæœ‰èˆˆè¶£è«‹è¦‹åº•ä¸‹æŠ•å½±ç‰‡: &lt;a href=&#34;https://docs.google.com/presentation/d/1yawazO1B_sP5Yiav-XLGJXW3ZS2JTV0wGuJwhrUKQ3A&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2022 DevOpsDay: Policy As Code for Terraform: https://docs.google.com/presentation/d/1yawazO1B_sP5Yiav-XLGJXW3ZS2JTV0wGuJwhrUKQ3A&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å°æ–¼ Policy as Code æœ‰èˆˆè¶£çš„æœ‹å‹è«‹è¦‹ä»Šå¹´ DevOpsDay çš„æ¼”è¬›
&lt;a href=&#34;https://devopsdays.tw/session-page/1146&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://devopsdays.tw/session-page/1146&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220925/201203277AyBGqc8Ly.png&#34; alt=&#34;2022 DevOpsDay: å¾é›¶å°å…¥ Policy as Code åˆ° terraform ç”˜è‹¦è«‡&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; aws cross account iam role delegation&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account MFA policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; (Optional) Cloudtrail&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; (Optional) terraform aws config&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;cross-account-iam-role&#34;&gt;cross account iam role&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iam_cross_account_roles
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;todo-èˆ‡é€²åº¦-1&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; reset root account IAM user login profile &amp;amp; pgp key&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; aws cross account iam role delegation&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account MFA policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Optional: Cloudtrail&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Optional: terraform aws config&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Aws Cross Account Delegation &amp; pre-commit hook</title>
      <link>https://chechia.net/zh-hant/post/2022-09-21-14th-ithome-ironman-iac-aws-workshop-10-aws-cross-account-delegation-and-pre-commit-hook/</link>
      <pubDate>Wed, 21 Sep 2022 22:55:41 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-21-14th-ithome-ironman-iac-aws-workshop-10-aws-cross-account-delegation-and-pre-commit-hook/</guid>
      <description>&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; aws cross account iam role delegation&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account MFA policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; (Optional) Cloudtrail&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; (Optional) terraform aws config&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;aws-cross-account-with-iam-roles&#34;&gt;AWS cross account with iam roles&lt;/h3&gt;
&lt;p&gt;è¦åšè·¨ AWS account çš„ IAM Roles access controlï¼Œæˆ‘å€‘å…ˆçœ‹å®˜æ–¹æ–‡ä»¶ç†è§£é€™å€‹åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å›æ†¶æˆ‘å€‘åœ¨ day-04 æåˆ°çš„ multi-accounts æ¶æ§‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;account/security æœ‰æ‰€æœ‰ iam-users&lt;/li&gt;
&lt;li&gt;å…¶ä»– child-account ex. account/test ä¸­æœƒæœ‰ iam-roles&lt;/li&gt;
&lt;li&gt;éœ€æ±‚ï¼šsecurity/iam-user å¯ä»¥ä½¿ç”¨ test/iam-role çš„èº«ä»½ï¼Œå­˜å– test åº•ä¸‹çš„ resource ex.test/ec2&lt;/li&gt;
&lt;li&gt;å¥½è™•
&lt;ul&gt;
&lt;li&gt;admin ä¸éœ€è¦åˆ°æ¯ä¸€å€‹ child-account ä¸‹é¢å»é–‹æ¯ä¸€å€‹äººçš„ iam userï¼Œçµ±ä¸€åˆ° account/security ç®¡ç†&lt;/li&gt;
&lt;li&gt;user åªè¦ç™»å…¥ä¸€å€‹ security å¸³è™Ÿï¼Œå°±å¯ä»¥æ§åˆ¶å¤šå€‹ child-accountï¼Œä¸ç”¨ç™»å‡ºåˆç™»å…¥ä¸åŒ account&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ aws official doc ä¸Šï¼Œä¹Ÿæ˜¯èˆ‰å¹¾å€‹ account ä½œç‚º cross account delegation çš„ç¯„ä¾‹ã€‚ç”±æ–¼æœ¬ workshop å·²ç¶“æœ‰ç¾å­˜çš„ child-accountï¼Œæˆ‘å€‘æœƒç›´æ¥ä½¿ç”¨ workshop çš„ accounts åšèªªæ˜ã€‚å®Œæˆé€™æ¬¡ iam role delegation çš„è¨­å®šå¾Œï¼Œæˆ‘å€‘æœƒå¾—åˆ°ä»¥ä¸‹æˆæœ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;account/security ä¸‹é¢ IAM User å¯ä»¥ assume åˆ° account/test ä¸‹é¢çš„ç‰¹å®šçš„ IAM role&lt;/li&gt;
&lt;li&gt;account/test ä¸‹é¢æœ‰ä¸€å€‹ IAM role å¯ä»¥å­˜å– S3 Bucket&lt;/li&gt;
&lt;li&gt;å·¥ç¨‹å¸«å¯ä»¥ä½¿ç”¨ web console ç™»å…¥ security/userï¼Œç„¶å¾Œ assume role ç‚º test/roleï¼Œå–å¾—æŸ¥çœ‹ s3 bucket çš„æ¬Šé™&lt;/li&gt;
&lt;li&gt;å·¥ç¨‹å¸«ä¹Ÿå¯ä½¿ç”¨ä»¥ security/user çš„èº«ä»½ï¼Œ call aws API å–å¾— test/role çš„æš«æ™‚çš„ credential&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ­¥é©Ÿ&#34;&gt;æ­¥é©Ÿ&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æœƒå…ˆéä¸€æ¬¡ aws å®˜æ–¹æ–‡ä»¶ä¸Šæ‰€è¿°çš„æ­¥é©Ÿï¼Œè®“å¤§å®¶äº†è§£æ•´å€‹è¨­å®šæ­¥é©Ÿï¼Œå¼„æ¸…æ•´å€‹ delegation çš„æµç¨‹èˆ‡æ¦‚å¿µã€‚ä¹‹å¾Œæœƒè½‰è€Œä½¿ç”¨ Terraform è¨­å®šæ‰€æœ‰çš„å…ƒä»¶ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆè¦åœ¨ test (child-account) è¨­å®š iam role
&lt;ul&gt;
&lt;li&gt;å°‡ account/security ä½œç‚º trusted entity&lt;/li&gt;
&lt;li&gt;è¨­å®š role çš„ policyï¼Œå¢åŠ å¯ä»¥å­˜å– s3 bucket çš„æ¬Šé™çµ¦ test/role&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;èª¿æ•´ iam roleï¼Œå¯ä»¥è¨­å®šéœ€è¦çµ¦äºˆæ¬Šé™ï¼Œæˆ–æ˜¯ deny æŸäº›æ¬Šé™&lt;/li&gt;
&lt;li&gt;æœ€å¾Œåšæ¸¬è©¦ï¼Œæ˜¯å¦å¯ä»¥å®Œæˆ switch role&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AWS çš„ç¯„ä¾‹ä½¿ç”¨ aws web console åšç¯„ä¾‹ï¼Œé€™å€‹ workshop å¾Œé¢æˆ‘å€‘æœƒä½¿ç”¨ terraform ä¾†å¯¦ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤–å‡ºå–æ&#34;&gt;å¤–å‡ºå–æ&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢çš„ç¯„ä¾‹é‚„åœ¨ WIPï¼Œè«‹ç•¶ä½œè€…å¤–å‡ºå–æä¸€å¤©ï¼Œä»Šå¤©å…ˆè¬›å¦å¤–ä¸€å€‹å·¥å…·&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;terraform-fmt--lint&#34;&gt;Terraform fmt &amp;amp; lint&lt;/h3&gt;
&lt;p&gt;è¦æå‡ terraform code å“è³ªï¼Œæœ‰è¨±å¤šå·¥å…·éå¸¸å€¼å¾—åœ¨ CI/CD éç¨‹ä¸­ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ terraform å…§å»ºçš„ fmt èˆ‡ terragrunt å…§å»ºçš„ hclfmt&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ module çš„ repository ä¸­æœƒéœ€è¦è·‘ terraform fmtï¼Œç¢ºä¿æ¯å€‹ module release å‡ºå»å‰éƒ½æœ‰ç¶“é fmt&lt;/li&gt;
&lt;li&gt;åœ¨ä½¿ç”¨ terragrunt çš„ root module æœƒéœ€è¦ hclfmt .hcl æª”æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd terragrunt-infrastructure-modules
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform fmt -recursive
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd terragrunt-infrastructure-live-example
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt hclfmt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;fmt å°æ–¼ç¨‹å¼ç¢¼çš„å“è³ªæ˜¯åŸºç¤ä½†ååˆ†é‡è¦çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²’æœ‰å›ºå®š format çš„ç¨‹å¼ç¢¼æœƒé€ æˆ git ä½¿ç”¨å‡ºç¾éå¤š diffï¼Œé€ æˆåœ˜éšŠå”ä½œçš„å›°é›£&lt;/li&gt;
&lt;li&gt;format ä¹Ÿæœƒå½±éŸ¿è‡ªå‹•åŒ–ï¼Œä¾‹å¦‚ templating / variable expension&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;fmt / lint æ˜¯æˆ‘å€‘ç¬¬ä¸€å€‹å¸¶å…¥ CI/CD çš„å·¥å…·&lt;/p&gt;
&lt;h3 id=&#34;æ‰‹å‹•-fmt&#34;&gt;æ‰‹å‹• fmt&lt;/h3&gt;
&lt;p&gt;fmt ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd terragrunt-infrastructure-modules
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform fmt -recursive
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd terragrunt-infrastructure-live-example
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt hclfmt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;commit å¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/commit/cab9fe72bafe8fa238ba04a17b7a60858ca2d27c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-modules commit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example/commit/1810e1a28558937058e21feafa4a8c9d2c82fab3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-live-example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;git-precommit-hook&#34;&gt;Git precommit hook&lt;/h3&gt;
&lt;p&gt;æ—¢ç„¶æ˜¯ code å“è³ªçš„åŸºç¤ï¼Œæ‡‰è©²æ¯æ¬¡ commit ä¹‹å‰éƒ½è§¸ç™¼æª¢æŸ¥ï¼Œé€™å€‹éšæ®µé©åˆä½¿ç”¨ git pre-commit hook å‰åŸ·è¡Œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/antonbabenko/pre-commit-terraform&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/antonbabenko/pre-commit-terraform&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ terragrunt-infrastructure-live-example ç‚ºä¾‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR åœ¨æ­¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å•Ÿç”¨å‰éœ€è¦ install remote script åˆ°æœ¬åœ°&lt;/li&gt;
&lt;li&gt;git add å¾Œï¼Œä½¿ç”¨ run ä¾†æ‰‹å‹•è§¸ç™¼ pre-commit hook
&lt;ul&gt;
&lt;li&gt;æœƒæ ¹æ“š commit hook åŸ·è¡Œè…³æœ¬ï¼Œä»¥é€™é‚Šçš„ç¯„ä¾‹æœƒåŸ·è¡Œ
&lt;ul&gt;
&lt;li&gt;id: terraform-fmt&lt;/li&gt;
&lt;li&gt;id: terraform-validate&lt;/li&gt;
&lt;li&gt;id: tflint&lt;/li&gt;
&lt;li&gt;id: terraform_checkov&lt;/li&gt;
&lt;li&gt;id: terrascan&lt;/li&gt;
&lt;li&gt;id: terraform_tfsec&lt;/li&gt;
&lt;li&gt;id: infracost_breakdown&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é™¤äº† fmt æœ‰èªªæ˜éä»¥å¤–ï¼Œå…¶ä»–çš„ tool æˆ‘å€‘å¾ŒçºŒå†èªªæ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pre-commit install
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pre-commit install
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pre-commit installed at .git/hooks/pre-commit
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pre-commit run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœé€šé run æ¸¬è©¦ï¼Œå°±å¯ä»¥é€²è¡Œ git commit
&lt;ul&gt;
&lt;li&gt;commit ä¹‹å‰æœƒåœ¨è·‘ä¸€æ¬¡ scriptï¼Œæ‰€ä»¥ç¨±ä½œ pre-commit hook&lt;/li&gt;
&lt;li&gt;å¦‚æœé€šéæ¸¬è©¦è®ŠåŒ–è‡ªå‹• commit&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²’æœ‰é€šéï¼Œå‰‡é€€å›é€™æ¬¡ commit&lt;/li&gt;
&lt;li&gt;å¦‚æœæƒ³è¦è·³é pre-commit checkï¼Œå¯ä»¥ä½¿ç”¨ git commit &amp;ndash;no-verify&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šéä¸Šè¿°æ­¥é©Ÿï¼Œä¾†ç¢ºä¿å·¥ç¨‹å¸«åœ¨æœ¬åœ°ç™¼å‡ºçš„ commit æœ‰ç¶“éåŸºç¤çš„é©—è­‰ï¼Œéå¸¸å€¼å¾—åœ˜éšŠå°å…¥&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;github-action&#34;&gt;Github Action&lt;/h3&gt;
</description>
    </item>
    
    <item>
      <title>Modules and password security</title>
      <link>https://chechia.net/zh-hant/post/2022-09-20-14th-ithome-ironman-iac-aws-workshop-09-terraform-module-and-password-security/</link>
      <pubDate>Wed, 21 Sep 2022 00:01:14 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-20-14th-ithome-ironman-iac-aws-workshop-09-terraform-module-and-password-security/</guid>
      <description>&lt;h3 id=&#34;ä½¿ç”¨-aws-module-çš„å¥½è™•&#34;&gt;ä½¿ç”¨ aws module çš„å¥½è™•&lt;/h3&gt;
&lt;p&gt;ç‚ºä½•è¨±å¤šé–‹æºçš„ terraform module å…§éƒ¨ä½¿ç”¨çš„éƒ½æ˜¯å…¶ä»–çš„ moduleï¼Œè€Œä¸æ˜¯å¾ resource å–®ä½é–‹å§‹ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/language/modules/develop&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform å®˜æ–¹æ–‡ä»¶ï¼Œå¦‚ä½•å»ºç«‹ module&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½•å»ºç«‹ä¸€å€‹ module&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ“šæœ€å¸¸å‡ºç¾çš„ä½¿ç”¨æƒ…åŠ‡èˆ‡éœ€æ±‚&lt;/li&gt;
&lt;li&gt;å°ˆæ³¨æ–¼æ¥­å‹™çš„éœ€æ±‚èˆ‡æŠ½è±¡ï¼Œé›ƒå¾ŒæŠŠå¯¦ä½œ(terraform resource) åœ¨ module ä¸­çµ„åˆå¯¦ä½œå‡ºä¾†&lt;/li&gt;
&lt;li&gt;module ä¹Ÿéœ€è¦è€ƒæ…® resource ä¹‹é–“çš„ architecture&lt;/li&gt;
&lt;li&gt;ä¹Ÿè¦è€ƒæ…®åˆ°è§€ç¦®æ˜¯å¦æ–¹ä¾¿ï¼Ÿä½¿ç”¨ä¸Šæ˜¯å¦å®‰å…¨ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ex. æˆ‘å€‘éœ€æ±‚æ˜¯ç”¢ç”Ÿä¸€å€‹ IAM User&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ­£å¸¸çš„å¯¦ä½œå°±æ˜¯å¯«ä¸€å€‹ &lt;code&gt;resource.aws_iam_user&lt;/code&gt; é”æˆéœ€æ±‚&lt;/li&gt;
&lt;li&gt;æ›´å¥½çš„å¯¦ä½œæ˜¯ï¼šé™¤äº† &lt;code&gt;iam_user&lt;/code&gt; å¤–ï¼ŒåŠ ä¸Š
&lt;ul&gt;
&lt;li&gt;ä¸€å®šæœƒéœ€è¦é…æ¬Šé™ï¼Œæ‡‰æ­é… &lt;code&gt;iam_group&lt;/code&gt; + &lt;code&gt;iam_policy&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;pgp encrypt è®“è³‡æ–™æ›´å®‰å…¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;password_policy&lt;/code&gt; å¢åŠ å¯†ç¢¼å®‰å…¨&lt;/li&gt;
&lt;li&gt;&amp;hellip;ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¯”èµ·å–®ä¸€ä¸€å€‹ &lt;code&gt;iam_user&lt;/code&gt; æ€è€ƒçš„æ›´å…¨é¢ï¼Œæ›´æ¥è¿‘æœ€ä½³å¯¦è¸&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨é€™æ¬¡çš„ Best Practice è¿½å°‹ä¹‹æ—…ä¸­ï¼Œæˆ‘å€‘æœƒå¸¶å¤§å®¶å»çœ‹å…¶ä»–åœ˜éšŠæ‰€å¯«å‡ºçš„ terraform module&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®å‰å·²ç¶“çœ‹äº†
&lt;ul&gt;
&lt;li&gt;aws çš„ terraform module&lt;/li&gt;
&lt;li&gt;gruntwork çš„ terraform module design (æˆ‘å€‘æ²’çœ‹åˆ° private moduleï¼Œåªæ˜¯è·Ÿéš¨æ–‡ä»¶è‡ªå·±åˆ»)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€™äº›æœ‰å¤šå¹´ä¼æ¥­è§£æ±ºæ–¹æ¡ˆç¶“é©—çš„åœ˜éšŠï¼Œå¯«å‡ºä¾†çš„ terraform module éƒ½æœƒè€ƒé‡è¨±å¤š security æ–¹é¢çš„å•é¡Œ&lt;/li&gt;
&lt;li&gt;é€™ä¹Ÿæ˜¯æˆ‘å€‘å‰åç¯‡éƒ½åœ¨å°ˆæ³¨çš„æ–¹å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€èˆ¬ä¾†èªªï¼Œä¸€å€‹å¥½ module æœƒå¸¶ä¾†å¾ˆå¤šå¥½è™•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç²¾ç°¡ .tf codeï¼Œé€é terraform function èˆ‡åˆ¤æ–·å¼ä¾†ç”¢ç”Ÿ resource&lt;/li&gt;
&lt;li&gt;æ•´åˆä¸åŒ resource ä½¿ç”¨æ™‚è¦è¼¸å…¥çš„ input&lt;/li&gt;
&lt;li&gt;å¯ä»¥å¼•å°ä½¿ç”¨è€…çš„ architecture è¨­è¨ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;èƒ½ç¬¦åˆéœ€æ±‚ï¼Œåƒæ•¸æ–¹ä¾¿ä½¿ç”¨ï¼Œå…§å®¹é‚è¼¯æ¸…æ¥šçš„ module å°±æ˜¯å¥½ module&lt;/p&gt;
&lt;p&gt;ç„¶è€Œè¦å¯«å¥½ä¸€å€‹ module éœ€è¦å¾ˆå¤šç¶“é©—ï¼Œä¸åƒ…è¦å° aws å…ƒä»¶ï¼Œæ¶æ§‹éƒ½å¾ˆç†Ÿæ‚‰ï¼Œé‚„è¦è€ƒé‡ç®¡ç†èˆ‡å®‰å…¨ã€‚æˆ‘å€‘æœ‰æ©Ÿæœƒå†ä¾†åˆ†äº«ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºä»€éº¼è¦èŠ±é€™éº¼å¤šæ™‚é–“è¬› account / iam / security çš„åŸºç¤è¨­å®šï¼Ÿ
å› ç‚ºäººå®¶å¯«å‡ºä¾†çš„å°±æ˜¯é€™éº¼çš„å®‰å…¨ï¼Œé–‹é ­ç›´æ¥ç«‹æ–¼ä¸è¢«é§­ä¹‹åœ°&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ˜¨å¤©ä½¿ç”¨ reset root IAM user çš„å¯†ç¢¼ï¼Œä¸¦ä½¿ç”¨ pgp key åŠ å¯†ä¿è­·ï¼Œä»Šå¤©è¦é€²ä¸€æ­¥å¼·åŒ– IAM çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼·åŒ– password policy&lt;/li&gt;
&lt;li&gt;å¢åŠ è·¨å¸³è™Ÿ iam role çš„ assume permission&lt;/li&gt;
&lt;li&gt;å¢åŠ  MFA&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ—¥é€²åº¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; reset root account IAM user login profile &amp;amp; pgp key&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; aws cross account iam role delegation&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;password-policy&#34;&gt;password policy&lt;/h3&gt;
&lt;p&gt;å¯†ç¢¼å¼·åº¦çš„é‡è¦æ€§ä¸éœ€è¦å†å¼·èª¿ï¼Œå¼·è¿« user ä½¿ç”¨é«˜å¼·åº¦çš„å¯†ç¢¼ä¸¦ä¸”å®šæœŸæ›´æ–°ï¼Œæ‰èƒ½å°‡åœ°å®‰å…¨é¢¨éšª
æƒ³è¦é€é web console ä¿®æ”¹ password policy çš„æœ‹å‹å¯ä»¥çœ‹&lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws doc: setting account password policy&lt;/a&gt;ã€‚æˆ‘å€‘é€™é‚Šæœƒä½¿ç”¨ terraform é…ç½®&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹ terragrunt-infrastructure-modules&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨æ„ï¼šæ˜¨å¤©åœ¨ &lt;code&gt;module.iam_user&lt;/code&gt; è¨­å®šçš„æ˜¯ login profile çš„ passwordï¼Œæ˜¯ç®¡ç†å“¡é…çµ¦ user çš„ç¬¬ä¸€æŠŠ passwordï¼Œä¸¦ä¸”ç™»å…¥å¾Œå¿…é ˆæ›´æ›å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;ä»Šå¤©è¦è¨­ç½®çš„æ˜¯ä¹‹å¾Œçš„é‡è¨­å¯†ç¢¼éƒ½è¦éµå¾ªçš„è¦ç¯„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæƒ³è¦å¼·åŒ–å¯†ç¢¼ç®¡ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´é•·çš„å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;æ›´å¤šé™åˆ¶&lt;/li&gt;
&lt;li&gt;å®šæœŸæ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆå…ˆæ›´æ”¹ terraform moduleï¼Œé–‹å•Ÿ password policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢åŠ  &lt;code&gt;resource.aws_iam_account_password_policy&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¢åŠ  input variableï¼Œå°‡ variable å¾€å¾ä¸Šå±¤ input variable æ¥é€²ä¾†ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨æœ€ä¸Šå±¤èª¿æ•´
&lt;ul&gt;
&lt;li&gt;å¯ä»¥è¨­å®šå¯†ç¢¼å£½å‘½ï¼Œdefault 90 å¤©&lt;/li&gt;
&lt;li&gt;å¯ä»¥è¨­å®šæœ€å°å¯†ç¢¼é•·åº¦ï¼Œdefault 32 å­—å…ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…¶ä»– policy åƒæ•¸éƒ½å¯«æ­»å›ºå®š
&lt;ul&gt;
&lt;li&gt;éœ€è¦æ•¸å­—ï¼Œå¤§å°å¯«è‹±æ–‡&lt;/li&gt;
&lt;li&gt;å…è¨±ä½¿ç”¨è€…åœ¨å¯†ç¢¼éæœŸå‰é‡è¨­å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;å¯†ç¢¼éæœŸå°±é–ä½å¸³è™Ÿä¸çµ¦ç™»å…¥ï¼Œè¦è«‹ admin ä¾† reset&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# aws_iam_account_password_policy.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;resource &amp;#34;aws_iam_account_password_policy&amp;#34; &amp;#34;strict&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  allow_users_to_change_password = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  minimum_password_length        = var.minimum_password_length
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hard_expiry                    = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  max_password_age               = var.max_password_age
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  require_lowercase_characters   = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  require_numbers                = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  require_uppercase_characters   = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  require_symbols                = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password_reuse_prevention      = 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# variables.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;variable &amp;#34;minimum_password_length&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type = number
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  description = &amp;#34;The number of days that an user password is valid.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  default = 32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;variable &amp;#34;max_password_age&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type = number
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  description = &amp;#34;Minimum length to require for user passwords.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  default = 90
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€²è¡Œ terragrunt planï¼Œæ²’å•é¡Œçš„è©±å°±å¯ä»¥ç›´æ¥ apply&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform used the selected providers to generate the following execution
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plan. Resource actions are indicated with the following symbols:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_iam_account_password_policy.strict will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_account_password_policy&amp;#34; &amp;#34;strict&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + allow_users_to_change_password = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + expire_passwords               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + hard_expiry                    = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                             = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + max_password_age               = 90
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + minimum_password_length        = 32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_reuse_prevention      = 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + require_lowercase_characters   = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + require_numbers                = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + require_symbols                = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + require_uppercase_characters   = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 1 to add, 0 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„æ›´æ”¹å¯†ç¢¼çš„å‰¯ä½œç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±æ–¼æ›´æ”¹ password policy æ˜¯æ•´å€‹ account é€šç”¨çš„ï¼Œæ‰€ä»¥ä¹Ÿæœƒå½±éŸ¿åˆ° administrator çš„ password
&lt;ul&gt;
&lt;li&gt;é›–ç„¶å½±éŸ¿ passwordï¼Œä½†ä¸å½±éŸ¿ access keyï¼Œæ‰€ä»¥ terraform å¯ä»¥æ­£å¸¸å·¥ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Apply passsword policy å¾Œï¼Œæˆ‘å€‘ä½¿ç”¨åŸå…ˆçš„å¯†ç¢¼èµ° aws web console ç™»å…¥çœ‹çœ‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨ç¾æœ‰å¯†ç¢¼ç™»å…¥&lt;/li&gt;
&lt;li&gt;å˜—è©¦å¾å³ä¸Šè§’ User -&amp;gt; security credentials -&amp;gt; change passwordï¼Œå¯ä»¥ç™¼ç¾æ–°çš„ password policy å·²ç¶“æ›´æ–°äº†&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘ä¾¿æ‰‹å‹•æ›´æ”¹å¯†ç¢¼ï¼Œä»¥ç¬¦åˆæ–°çš„ password policy&lt;/li&gt;
&lt;li&gt;æ›´æ”¹å¯†ç¢¼å®Œæˆè¨˜å¾—å­˜åœ¨å¯†ç¢¼å„²å­˜å™¨ä¸­&lt;/li&gt;
&lt;li&gt;å€‹äººç¿’æ…£è€•è²·å¯†ç¢¼å®Œæˆå¾Œï¼Œéƒ½é‡æ–°ç™»å…¥ï¼Œå†ç™»å…¥ä¸€æ¬¡ï¼Œç¢ºå®šå¯†ç¢¼æ­£ç¢ºï¼Œæ¬Šé™ä¹Ÿæ²’å•é¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/20120327iUWx24T3IH.png&#34; alt=&#34;Password reset: new password policy enforced&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;mfa-for-me&#34;&gt;MFA for me&lt;/h3&gt;
&lt;p&gt;æ¥è‘—æˆ‘å€‘å¯ä»¥ç‚ºè‡ªå·±çš„ IAM User å•Ÿç”¨ MFA è£ç½®&lt;/p&gt;
&lt;p&gt;åœ¨å³ä¸Šè§’ User -&amp;gt; security credentials -&amp;gt; MFA&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»é¸ Assign MFA Device&lt;/li&gt;
&lt;li&gt;é¸æ“‡ virtual MFA Deviceï¼Œæˆ‘å€‘é€™é‚Šç¤ºç¯„ä½¿ç”¨ google authenticator app
&lt;ul&gt;
&lt;li&gt;ç•«é¢ä¸Šå‡ºç¾ MFA key çš„ QRcodeï¼Œé€™å€‹ QRcode == keyï¼Œä¸èƒ½æ´©æ¼ï¼Œé›¢é–‹é€™å€‹ç•«é¢å°±ä¸æœƒå†å‡ºç¾äº†&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ google authenticatorï¼Œæ–°å¢ä¸€çµ„ accountï¼Œç„¶å¾Œæƒæ QRCode&lt;/li&gt;
&lt;li&gt;åº•ä¸‹å¡«å…¥æ–° account ç”¢ç”Ÿçš„ 6 ä½æ•¸å­— token&lt;/li&gt;
&lt;li&gt;ç­‰å¾… 60 ç§’&lt;/li&gt;
&lt;li&gt;åº•ä¸‹å¡«å…¥ç¬¬äºŒçµ„æ–° account ç”¢ç”Ÿçš„ 6 ä½æ•¸å­— tokenï¼Œç¢ºå®šçœŸçš„èƒ½å¤ å–å¾—æ­£ç¢ºçš„ token&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¹‹å¾Œæ¯æ¬¡ç™»å…¥éƒ½éœ€è¦è¼¸å…¥ MFA&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/20120327XlAMWxDvcc.png&#34; alt=&#34;Enable MFA: Assign MFA Device&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/201203277eQhM3xCiI.png&#34; alt=&#34;Enable MFA: Assign Virtual MFA Device&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/20120327cMSbmpYG4o.png&#34; alt=&#34;Enable MFA: Complete&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;NOTE: é€™è£¡æ˜¯ IAM User login æ™‚éœ€è¦è¼¸å…¥ MFAï¼Œæˆ‘å€‘ä¹‹å¾Œæœƒè¨­å®š child account ä¸‹ iam-role assume æ™‚éƒ½éœ€è¦è¼¸å…¥ MFA&lt;/p&gt;
&lt;p&gt;æ˜å¤©æœƒå‰åç¯‡çš„é‡é»ä¹‹ä¸€ï¼šcross account çš„ iam role é…ç½®&lt;/p&gt;
&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; reset root account IAM user login profile &amp;amp; pgp key&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; aws cross account iam role delegation&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root account MFA policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; (Optional) Cloudtrail&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; (Optional) terraform aws config&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Reset Iam User Administrator</title>
      <link>https://chechia.net/zh-hant/post/2022-09-19-14th-ithome-ironman-iac-aws-workshop-08-reset-iam-user-administrator/</link>
      <pubDate>Tue, 20 Sep 2022 23:56:47 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-19-14th-ithome-ironman-iac-aws-workshop-08-reset-iam-user-administrator/</guid>
      <description>&lt;p&gt;æ˜¨å¤©è™•ç†å®Œ Accounting çš„ reset passwordï¼Œä»Šå¤©è¦ä¾† reset root account Administrator çš„æ¬Šé™&lt;/p&gt;
&lt;p&gt;æœ¬æ—¥é€²åº¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; reset root account IAM user login profile &amp;amp; pgp key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;reset-iam-root-user-administrator-password&#34;&gt;Reset IAM root user Administrator Password&lt;/h3&gt;
&lt;p&gt;ä¾ç…§ä¸Šé¢çš„æ­¥é©Ÿï¼Œæˆ‘å€‘ç¢ºå®šå¯ä»¥æ­£å¸¸ç™»å…¥ï¼Œæ–¼æ˜¯å¯ä»¥ä¾†å¯ä»¥æ–°å»º Administrator çš„ login profile&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±æ–¼ Administrator æœƒéœ€è¦ access keyï¼Œæ‰€ä»¥æˆ‘å€‘ä¹ŸæŠŠä»–è¨­æˆ true&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# terragrunt.hcl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  users = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Administrator = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      groups               = [&amp;#34;full-access&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      pgp_key              = &amp;#34;keybase:chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_login_profile = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_access_keys   = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Accounting = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      groups               = [&amp;#34;billing&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      pgp_key              = &amp;#34;keybase:chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_login_profile = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_access_keys   = false # accounting always use web console, won&amp;#39;t use access key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨˜å¾—æ›´æ”¹ module/output.tfï¼Œå¢åŠ  secret key çš„ outputï¼Œè€Œä¸è¦åªç•™åœ¨ terraform state è£¡é¢&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# output.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output &amp;#34;keybase_secret_key_decrypt_command&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  description = &amp;#34;Decrypt access secret key command&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value       = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     for key, value in module.iam_user : key =&amp;gt; value.keybase_secret_key_decrypt_command
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output &amp;#34;keybase_secret_key_pgp_message&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  description = &amp;#34;Encrypted access secret key&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value       = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     for key, value in module.iam_user : key =&amp;gt; value.keybase_secret_key_pgp_message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è©¦è‘— plan ä¸€ä¸‹ï¼Œé æœŸ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Administrator æœƒç”¢ç”Ÿä¸€çµ„æ–°çš„ login profile&lt;/li&gt;
&lt;li&gt;Administrator æœƒç”¢ç”Ÿä¸€çµ„æ–°çš„ access key&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform used the selected providers to generate the following execution
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plan. Resource actions are indicated with the following symbols:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_access_key.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_access_key&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_date                    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_secret               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_ses_smtp_password_v4 = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                             = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + key_fingerprint                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + pgp_key                        = &amp;#34;keybase:chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + secret                         = (sensitive value)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + ses_smtp_password_v4           = (sensitive value)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status                         = &amp;#34;Active&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + user                           = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user_login_profile.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_user_login_profile&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_password      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + key_fingerprint         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_length         = 20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_reset_required = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + pgp_key                 = &amp;#34;keybase:chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + user                    = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 2 to add, 0 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Changes to Outputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + iam_access_key_id = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Accounting    = &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ keybase_password_decrypt_command   = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (1 unchanged element hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ keybase_password_pgp_message       = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (1 unchanged element hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + keybase_secret_key_decrypt_command = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Accounting    = null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Administrator = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + keybase_secret_key_pgp_message     = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Accounting    = null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Administrator = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¦åˆé æœŸ!! å¯å–œå¯è³€&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘å€‘å·²ç¶“æœ‰ access key åœ¨ä½¿ç”¨äº†ï¼Œæˆ‘åˆä¸æƒ³è¦èµ° day 3 aws-vault add key çš„æ­¥é©Ÿæ›ä¸€çµ„æ–°çš„ï¼Œé€™æ™‚è©²æ€è¾¦&lt;/p&gt;
&lt;p&gt;æ²’éŒ¯ï¼Œæˆ‘å€‘å¯ä»¥åƒ Day3 ä¸€æ¨£ï¼Œä½¿ç”¨ import åŒ¯å…¥å·²ç¶“å­˜åœ¨çš„ resource åˆ° address è£¡é¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;google &amp;ldquo;terraform aws iam user access key&amp;rdquo;ï¼Œ&lt;a href=&#34;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_access_key#import&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰¾åˆ° aws iam user access key çš„èªªæ˜é é¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;address æ˜¯ &lt;code&gt;module.iam_user[&amp;quot;Administrator&amp;quot;].aws_iam_access_key.this[0]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;access key ID
&lt;ul&gt;
&lt;li&gt;å¯ä»¥åœ¨å¯†ç¢¼ç®¡ç†å™¨æŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯åœ¨ aws web console -&amp;gt; IAM -&amp;gt; User -&amp;gt; Administrator -&amp;gt; Security Credential -&amp;gt; Access Keys æŸ¥åˆ°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt import &amp;#39;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_access_key.this[0]&amp;#39; AKIA1234567890
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_access_key.this[0]: Importing from ID &amp;#34;AKIA2I2H7ERWKI4RIF4Z&amp;#34;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_access_key.this[0]: Import prepared!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Prepared aws_iam_access_key for import
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_access_key.this[0]: Refreshing state... [id=AKIA2I2H7ERWKI4RIF4Z]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import successful!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The resources that were imported are shown above. These resources are now in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;your Terraform state and will henceforth be managed by Terraform.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Releasing state lock. This may take a few moments...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é †ä¾¿ &lt;a href=&#34;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_user_login_profile#import&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;login profile ä¹Ÿ import è¿‘ä¾†&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt import &amp;#39;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user_login_profile.this[0]&amp;#39; Administrator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡ plan å°±ä¸éœ€è¦æ–°å»ºä¸€æŠŠ access key äº†&amp;hellip;å§ï¼Ÿï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform used the selected providers to generate the following execution
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plan. Resource actions are indicated with the following symbols:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-/+ destroy and then create replacement
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_access_key.this[0] must be replaced
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-/+ resource &amp;#34;aws_iam_access_key&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ create_date                    = &amp;#34;2022-09-16T13:05:35Z&amp;#34; -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_secret               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_ses_smtp_password_v4 = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ id                             = &amp;#34;AKIA2I2H7ERWKI4RIF4Z&amp;#34; -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + key_fingerprint                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + pgp_key                        = &amp;#34;keybase:chechiachang&amp;#34; # forces replacement
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + secret                         = (sensitive value)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + ses_smtp_password_v4           = (sensitive value)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (2 unchanged attributes hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user_login_profile.this[0] must be replaced
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-/+ resource &amp;#34;aws_iam_user_login_profile&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_password      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ id                      = &amp;#34;Administrator&amp;#34; -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + key_fingerprint         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_length         = 20 # forces replacement
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + pgp_key                 = &amp;#34;keybase:chechiachang&amp;#34; # forces replacement
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (2 unchanged attributes hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 2 to add, 0 to change, 2 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Changes to Outputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + iam_access_key_id = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Accounting    = &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Administrator = &amp;#34;AKIA2I2H7ERWARJJWIVK&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ keybase_password_decrypt_command   = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (1 unchanged element hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ keybase_password_pgp_message       = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (1 unchanged element hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ keybase_secret_key_decrypt_command = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (1 unchanged element hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ keybase_secret_key_pgp_message     = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      ~ Administrator = null -&amp;gt; (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (1 unchanged element hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;èª’çµæœä¸ç¬¦åˆé æœŸï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;aws_iam_access_key.this&lt;/code&gt; éœ€è¦é‡å»º
&lt;ul&gt;
&lt;li&gt;åŸå› æ˜¯æˆ‘å€‘æ›´æ”¹äº† &lt;code&gt;pgp_key = &amp;quot;keybase:chechiachang&amp;quot;&lt;/code&gt; é€ æˆ forces replacement&lt;/li&gt;
&lt;li&gt;å› ç‚º&lt;/li&gt;
&lt;li&gt;æƒ³ä¸€æƒ³ä¹Ÿå¾ˆåˆç†
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡å‰µå»º access key çš„æ™‚å€™ï¼Œkeybase æ˜¯äº‚å¯«çš„ï¼Œé€™æ™‚ç”¨ module çš„ code å»è·‘ï¼Œç”¢ç”Ÿç„¡åŠ å¯†çš„ access key æ”¾åœ¨ state ä¸­&lt;/li&gt;
&lt;li&gt;é€™æ¬¡ import å¾Œï¼Œmodule ä¸­çš„ .tf code å·²ç¶“æ”¹éï¼Œä¸å†å­˜ç„¡åŠ å¯†çš„ access keyï¼Œè€Œæ˜¯åŠ å¯†å¾Œå„²å­˜ GPG Encrypted Message&lt;/li&gt;
&lt;li&gt;é€™å€‹æ”¹è®Šè®“ provider è¦ºå¾—æ²’æœ‰è¾¦æ³•ç¬¦åˆï¼Œåªå¥½åˆªæ‰é‡å»º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.aws_iam_user_login_profile.this&lt;/code&gt; éœ€è¦é‡å»ºï¼ŒåŸå› ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œå› ç‚ºæˆ‘å€‘æ”¹äº† .tf code é‚è¼¯ï¼Œé€ æˆ provider å‹¢å¿…è¦é‡å»º login profile&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŸ·è¡Œ terraform apply&lt;/p&gt;
&lt;p&gt;NOTE: æ³¨æ„æœ‰ destroy çš„ terraform plan éƒ½è¦ç‰¹åˆ¥å°å¿ƒ reviewï¼Œå› ç‚ºå¾ˆå¤š aws API delete ç™¼å‡ºå»å°±æ˜¯ç„¡æ³•å¾©åŸäº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ access key èˆ‡ password åˆªæ‰å¾Œï¼Œæ˜¯ç„¡æ³• recover çš„&lt;/li&gt;
&lt;li&gt;æœ‰äº› API request æœƒæœ‰å‰¯ä½œç”¨
&lt;ul&gt;
&lt;li&gt;reset password å¾Œï¼Œaws web console æœƒè¢«ç™»å‡º&lt;/li&gt;
&lt;li&gt;access key æ›æ‰ terraform å°±ä¸èƒ½ç”¨ï¼Œæœ‰å¯èƒ½å°è‡´ terraform é€²è¡Œåˆ°ä¸€åŠè¢« permission denied (é€™å€‹ apply ä¸æœƒï¼Œåªæ˜¯æé†’å¤§å®¶è¦æ³¨æ„)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰ destroy çš„éƒ¨åˆ†éƒ½è¦å°å¿ƒ reviewï¼Œçœ‹ä¸æ‡‚å°±æ‰¾ peering review
æœ‰ destroy çš„éƒ¨åˆ†éƒ½è¦å°å¿ƒ reviewï¼Œçœ‹ä¸æ‡‚å°±æ‰¾ peering review
æœ‰ destroy çš„éƒ¨åˆ†éƒ½è¦å°å¿ƒ reviewï¼Œçœ‹ä¸æ‡‚å°±æ‰¾ peering review&lt;/p&gt;
&lt;p&gt;å¾ˆé‡è¦æ‰€ä»¥èªªä¸‰æ¬¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Apply complete! Resources: 2 added, 0 changed, 2 destroyed.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Outputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keybase_password_decrypt_command = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Accounting&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  echo &amp;#34;wcFMA4U4ylYlNYTfAQ/+KLtNeJqOqK/V3pNdcRh9nvyDw/huJfaYF7Ab/YdKqLKNVySBqc6HY8xedmER5Wn78RlG962/f772u8UlQN4XCOjOLjyOaNL8K0tkeoSVg+XXPx2qJO9Myc1d+74rG57biUD26XpwfS7+ryIjaHf+NzjisExZy2mgiMIzzAlfqTzRAc+jYP11wZcyFGwOe9pMq6BJy7FH5935ndVgNLCgYtSjgIV5b5kWQ3SDr0E9egAHnoAcHs8mni71x7OL7OCc/bS3nJSLz1jRkMoukWyQQ3+lM7Nwi36NSJneIKxW5f7lSxr7Bx+W3mx6gZgb18yRVIwbVW5iDFsAQOFb0zOHUf8tm3tAQ0F79Yeqy9sfLCfUUjVpCENEJe5FtwJkI8EbHKe8mGnYA4dbHaCkIDgVa8TZ4mdXl7yVZx0adlkKFIS48niwPHxMErZYqnRBitUCGdaH0bHcpPcnSVolLljZmXZUrntMjIEb9FGYbgl6hOiRF9MR3RQL5DNmpS7uSqU7V6TyhVbAOJO2oR01Z7hXdAMxZ54O+h06jN7fzvLrUSMWvUz/wp+JJnIDYNwu75Dvicn6NmXrP3fH3M8xmYIEPhpSvOldNzB4DMqQdD6tN+DphFFyvFwuLnWKWKOY+pbNXkd5q0H3A69owxgsONoOL1JqjZgOdcLtWTq+g9XqU5XSRQGo1ei5Ctv2f5yAHZuI2smwJkTA88SuyZqJNwRixw5OPpUDOuWxhK6xftsN7M1/TnioX8Ch3RTow7H0dvMFFD3ocvjG4A==&amp;#34; | base64 --decode | keybase pgp decrypt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Administrator&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  echo &amp;#34;wcFMA4U4ylYlNYTfAQ/+JcRNkO9SxMm9U196p2WuuXdSWo9ooktKJMp3q4Xf5xMG5z/ccphl5+fVDmkp2Pr76UJ9NmiBw8rzScFUEU4U+xZepNojSdN/rmZPWB6PKCdJMyItw6HOnn7OSa0i1arr0PHaC0bpVs4Bc+9Oqtw1SuU8uvwBpCeM+h33qOROnvKnGgvOHV2Zk1XcgT+sg7xMTv8q77KePoNLTK3joQL7fXdPWUGWCp8srWpxzJ8LD4aNMmsrjA/s/7sNbAAdhffRwwA6diuZfeYscZ6MlURUtrSx3iAuNV33kmhuyYimlmXstbfs/nIJVI5OfcVexPKzHK5O9DikXApAzbf/YACz0OebOcxnzh6+rQw9+XWwRtARcK3tViMhxqnEu4PHROmj1sNmLZLJqCniwN91J2iry7BAx2Zoyvvw7vd7Sw9LddaM+j2XHhSf21250sNMn/9R6beUlkWQgPci8mU51rnqBffbOJnvVh7QCTLssoMTgKRrgxb+oZbSsKLLQO/621ZcTY9rzC74w2kZWJTS7nx5G/0KQkwXP4NGRSTXYg3/6TcwT7LefQiJpWB2z92zT1sp5lPhtpNneqrtFFnirplfP5coeelRSlTEbHDwbHSX1LfHU7A5WHjf7oEHvn2hMhdgTlvGt4vL7rXiy9p8GWjcudGxZs+/WNs8CCkZd8j2gVvSRQEmNNtCd/U3jmq+o2VncJjBhetJ7eCyvKOAMwcCLHE0zleX77mXVtq7UVLXrcypxIbVjJAIko8y71fATyrRomcijS7Sgw==&amp;#34; | base64 --decode | keybase pgp decrypt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keybase_password_pgp_message = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Accounting&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----BEGIN PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Version: Keybase OpenPGP v2.0.76
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Comment: https://keybase.io/crypto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  wcFMA4U4ylYlNYTfAQ/+KLtNeJqOqK/V3pNdcRh9nvyDw/huJfaYF7Ab/YdKqLKNVySBqc6HY8xedmER5Wn78RlG962/f772u8UlQN4XCOjOLjyOaNL8K0tkeoSVg+XXPx2qJO9Myc1d+74rG57biUD26XpwfS7+ryIjaHf+NzjisExZy2mgiMIzzAlfqTzRAc+jYP11wZcyFGwOe9pMq6BJy7FH5935ndVgNLCgYtSjgIV5b5kWQ3SDr0E9egAHnoAcHs8mni71x7OL7OCc/bS3nJSLz1jRkMoukWyQQ3+lM7Nwi36NSJneIKxW5f7lSxr7Bx+W3mx6gZgb18yRVIwbVW5iDFsAQOFb0zOHUf8tm3tAQ0F79Yeqy9sfLCfUUjVpCENEJe5FtwJkI8EbHKe8mGnYA4dbHaCkIDgVa8TZ4mdXl7yVZx0adlkKFIS48niwPHxMErZYqnRBitUCGdaH0bHcpPcnSVolLljZmXZUrntMjIEb9FGYbgl6hOiRF9MR3RQL5DNmpS7uSqU7V6TyhVbAOJO2oR01Z7hXdAMxZ54O+h06jN7fzvLrUSMWvUz/wp+JJnIDYNwu75Dvicn6NmXrP3fH3M8xmYIEPhpSvOldNzB4DMqQdD6tN+DphFFyvFwuLnWKWKOY+pbNXkd5q0H3A69owxgsONoOL1JqjZgOdcLtWTq+g9XqU5XSRQGo1ei5Ctv2f5yAHZuI2smwJkTA88SuyZqJNwRixw5OPpUDOuWxhK6xftsN7M1/TnioX8Ch3RTow7H0dvMFFD3ocvjG4A==
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----END PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Administrator&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----BEGIN PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Version: Keybase OpenPGP v2.0.76
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Comment: https://keybase.io/crypto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  wcFMA4U4ylYlNYTfAQ/+JcRNkO9SxMm9U196p2WuuXdSWo9ooktKJMp3q4Xf5xMG5z/ccphl5+fVDmkp2Pr76UJ9NmiBw8rzScFUEU4U+xZepNojSdN/rmZPWB6PKCdJMyItw6HOnn7OSa0i1arr0PHaC0bpVs4Bc+9Oqtw1SuU8uvwBpCeM+h33qOROnvKnGgvOHV2Zk1XcgT+sg7xMTv8q77KePoNLTK3joQL7fXdPWUGWCp8srWpxzJ8LD4aNMmsrjA/s/7sNbAAdhffRwwA6diuZfeYscZ6MlURUtrSx3iAuNV33kmhuyYimlmXstbfs/nIJVI5OfcVexPKzHK5O9DikXApAzbf/YACz0OebOcxnzh6+rQw9+XWwRtARcK3tViMhxqnEu4PHROmj1sNmLZLJqCniwN91J2iry7BAx2Zoyvvw7vd7Sw9LddaM+j2XHhSf21250sNMn/9R6beUlkWQgPci8mU51rnqBffbOJnvVh7QCTLssoMTgKRrgxb+oZbSsKLLQO/621ZcTY9rzC74w2kZWJTS7nx5G/0KQkwXP4NGRSTXYg3/6TcwT7LefQiJpWB2z92zT1sp5lPhtpNneqrtFFnirplfP5coeelRSlTEbHDwbHSX1LfHU7A5WHjf7oEHvn2hMhdgTlvGt4vL7rXiy9p8GWjcudGxZs+/WNs8CCkZd8j2gVvSRQEmNNtCd/U3jmq+o2VncJjBhetJ7eCyvKOAMwcCLHE0zleX77mXVtq7UVLXrcypxIbVjJAIko8y71fATyrRomcijS7Sgw==
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----END PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keybase_secret_key_decrypt_command = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Accounting&amp;#34; = tostring(null)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Administrator&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  echo &amp;#34;wcFMA4U4ylYlNYTfARAAivQzF+bh6N6OH/3a1S7XQCrIceoLn9EXsc8Gr0p09TVieSqwwv1RojaCULjYXYu5UnxRFwaavN+ULxrl2c4hRBIMgNEAo1Nxy16vfDEj4W7S9l+yA/TU3ewbs8WqKHIFrO8+AcjxUV4Ol5cmziDu70UR0H1/f0w7lqC/s36Zqa1Rz5Mb1n7ATLfs4jiPDQiFlr+E6gSe+I23sAQqdDS/WEbwAVz6o2B9mvs+OznNzeDoTwd7nE2ca+jYDZKjEjD6+qfDAnVzftwSrJIb2yJYlKIeSKJLC9loEQk2wdR5fkKrPg//9S4gYQJjzkwWyJAQsc6AuOPZXjqVe5yV9EpG2r0938G/acR3SEjt53ckXjh6Fi0/EgOjfeTVMO0EH6Se/vurdXBRyMggTieyN76Ts8nnn32GBldTZBUgWTL1Udj6B9ueqFCFuB8LFGNNNoHYjp3hAeGEQdtgI9TQ9r+jRDKpO8zcDoRMFK7wv4DJ31Nl/aS++a8nFEwJp7D5XkiSPbJ9JE1MwvuufldAHqr8iRbt3LmKeB4qC3TFbIhNWY4gs2VZ5LTepIn18sQfQ4f5s9o1lpem4yQw2XeEA7Fd1sPVypVeOj4z8Y080duGES896LiGpsAZdQ3bm/RiuIMLSabArgWCP/0LgrOQU8SwrIdN3k4682nw41KVnhjY2IDSWQHfEUCTNkgNfdj8v7FiD/OHX5G6VX/NAOwiAQ7Qh9u6UOmyAVY3QTjgVYEF4+oUyX+zZWprhhJkvHRDTTTNqozxVBfbYqrKTxSa00MRwAFIwQJh3xXbvmlF&amp;#34; | base64 --decode | keybase pgp decrypt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keybase_secret_key_pgp_message = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Accounting&amp;#34; = tostring(null)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Administrator&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----BEGIN PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Version: Keybase OpenPGP v2.0.76
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Comment: https://keybase.io/crypto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  wcFMA4U4ylYlNYTfARAAivQzF+bh6N6OH/3a1S7XQCrIceoLn9EXsc8Gr0p09TVieSqwwv1RojaCULjYXYu5UnxRFwaavN+ULxrl2c4hRBIMgNEAo1Nxy16vfDEj4W7S9l+yA/TU3ewbs8WqKHIFrO8+AcjxUV4Ol5cmziDu70UR0H1/f0w7lqC/s36Zqa1Rz5Mb1n7ATLfs4jiPDQiFlr+E6gSe+I23sAQqdDS/WEbwAVz6o2B9mvs+OznNzeDoTwd7nE2ca+jYDZKjEjD6+qfDAnVzftwSrJIb2yJYlKIeSKJLC9loEQk2wdR5fkKrPg//9S4gYQJjzkwWyJAQsc6AuOPZXjqVe5yV9EpG2r0938G/acR3SEjt53ckXjh6Fi0/EgOjfeTVMO0EH6Se/vurdXBRyMggTieyN76Ts8nnn32GBldTZBUgWTL1Udj6B9ueqFCFuB8LFGNNNoHYjp3hAeGEQdtgI9TQ9r+jRDKpO8zcDoRMFK7wv4DJ31Nl/aS++a8nFEwJp7D5XkiSPbJ9JE1MwvuufldAHqr8iRbt3LmKeB4qC3TFbIhNWY4gs2VZ5LTepIn18sQfQ4f5s9o1lpem4yQw2XeEA7Fd1sPVypVeOj4z8Y080duGES896LiGpsAZdQ3bm/RiuIMLSabArgWCP/0LgrOQU8SwrIdN3k4682nw41KVnhjY2IDSWQHfEUCTNkgNfdj8v7FiD/OHX5G6VX/NAOwiAQ7Qh9u6UOmyAVY3QTjgVYEF4+oUyX+zZWprhhJkvHRDTTTNqozxVBfbYqrKTxSa00MRwAFIwQJh3xXbvmlF
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----END PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ™‚å˜—è©¦åœ¨ä½¿ç”¨ terraform planï¼Œæœƒç„¡æ³•å–å¾— state s3 bucket&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚º access key å·²ç¶“é‡å»ºï¼Œç¾åœ¨ terraform ä½¿ç”¨èˆŠçš„ access key é€£ s3 æœƒ 404 not found&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Remote state S3 bucket chechia-root-ap-northeast-1-terraform-state does not exist or you don&amp;#39;t have permissions to access it. Would you like Terragrunt to create it? (y/n) n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ERRO[0004] remote state S3 bucket chechia-root-ap-northeast-1-terraform-state does not exist or you don&amp;#39;t have permissions to access it
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ERRO[0004] Unable to determine underlying exit code, so Terragrunt will exit with error code 1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å–å¾— output å¾Œï¼Œä¸€æ¨£åš gpg decrypt å–å¾—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;password&lt;/li&gt;
&lt;li&gt;access key&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®Œæˆå¾Œä½¿ç”¨ aws-vault ç§»é™¤èˆŠçš„ profile + credentialï¼Œå†å¾æ–°åŒ¯å…¥ access key&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault remove terraform-30day-root-iam-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Delete credentials for profile &amp;#34;terraform-30day-root-iam-user&amp;#34;? (y|N) y
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Deleted credentials.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault add terraform-30day-root-iam-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter Access Key ID:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter Secret Access Key:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Added credentials to profile &amp;#34;terraform-30day-root-iam-user&amp;#34; in vault
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œæˆå¾Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ aws-vault plan äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„è®Šæ›´æˆ‘å€‘çš„ PR å¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-modules PR&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-live-example PR&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; reset root account IAM user login profile &amp;amp; pgp key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Reset Iam User</title>
      <link>https://chechia.net/zh-hant/post/2022-09-18-14th-ithome-ironman-iac-aws-workshop-07-reset-iam-user/</link>
      <pubDate>Tue, 20 Sep 2022 18:30:06 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-18-14th-ithome-ironman-iac-aws-workshop-07-reset-iam-user/</guid>
      <description>&lt;p&gt;æ˜¨å¤©æˆ‘å€‘å»ºç«‹ IAM Group èˆ‡ policyï¼Œä¸¦èªªæ˜ policy ç®¡ç†åŸå‰‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç„¶è€Œæ˜¨å¤©æœ€å¾Œå‰µå»º user æ™‚ï¼Œæˆ‘å€‘é—œé–‰äº† &lt;code&gt;create_login_profile = false&lt;/code&gt; çš„é¸é …
&lt;ul&gt;
&lt;li&gt;é€™æ˜¯ç‚ºäº†é¿å…ç•¶å‰çš„ç™»å…¥æ©Ÿåˆ¶è¢«è¦†è“‹æ‰ï¼Œå½±éŸ¿ root account Administrator çš„ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ login æ–¹å¼ï¼Œåœ¨æŸäº›æ¥µç«¯çš„æƒ…å½¢ä¸‹ï¼Œæœ‰å¯èƒ½è®“ Administrator è‡ªå·±è¦†è“‹è‡ªå·±çš„ login è¨­å®šå¾Œï¼Œè®“è‡ªå·±ç„¡æ³•ç™»å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½ æ˜¯ç®¡ç†å“¡ï¼Œåœ¨æ›´æ”¹ admin å¸³è™Ÿçš„æ¬Šé™èˆ‡ç™»å…¥è¨­å®šæ™‚ï¼Œä¸€å®šè¦å¤šåŠ æ³¨æ„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸å¹¸æ”¹å£ï¼Œç„¡æ³•ç™»å…¥ï¼Œå°±åªèƒ½å†å»æ‰¾å‡º root account root user å¸³è™Ÿä¾†è§£æ•‘äº†
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯ root account root user æŠŠè‡ªå·±çš„ login æ”¹å£ï¼Œå°±æœƒå¾ˆç—›è‹¦ï¼Œè¦è«‹ aws support ä¾†æ•‘ä½ &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ—¥é€²åº¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; reset root account IAM user login profile &amp;amp; pgp key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;enhance-user-login-security&#34;&gt;Enhance User Login Security&lt;/h3&gt;
&lt;p&gt;Gruntwork Guide åœ¨å®Œæˆ group èˆ‡ policy è¨­å®šå¾Œï¼Œä¸‹ä¸€å€‹éœ€è¦åšçš„æ˜¯åŠ å¼· user ç™»å…¥çš„å®‰å…¨æ€§&lt;/p&gt;
&lt;p&gt;éœ€è¦åšçš„äº‹æƒ…æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/mfa-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•Ÿç”¨ MFA policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/password-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¨­å®šåš´æ ¼çš„ password policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å»ºç«‹ login profile: password å¾Œï¼Œä½¿ç”¨å„å€‹æˆå“¡çš„ gpg key åŠ å¯† (encrypt) passwordï¼Œåªæœ‰æˆå“¡è‡ªå·±å¯ä»¥è§£é–‹è‡ªå·±çš„ password&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;mfa-policyhttpsdocsgruntworkioguidesbuild-it-yourselflanding-zoneproduction-grade-designmfa-policy&#34;&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/mfa-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MFA Policy&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Multi-factor authentication&lt;/a&gt; æ˜¯å¸¸ç”¨çš„èªè­‰æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä½¿ç”¨ AWS API çš„æ™‚å€™ï¼Œé™¤äº†å¸³è™Ÿå¯†ç¢¼ / access key ä»¥å¤–ï¼Œéœ€è¦ç¬¬äºŒå±¤ç™»å…¥è£ç½®åšé©—è­‰&lt;/li&gt;
&lt;li&gt;AWS æ”¯æ´è¨±å¤šä¸åŒå½¢å¼çš„ MFA è£ç½®
&lt;ul&gt;
&lt;li&gt;è™›æ“¬çš„ MFA è£ç½® ex. è·Ÿ google authenticator ä¸€èµ·ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ç¡¬é«”çš„ MFA è£ç½® ex. ç¬¦åˆ FIDO2 æ¨™æº–çš„ YubiKey ç­‰ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ¬ workshop æœƒå¯¦ä½œè™›æ“¬çš„ MFA è£ç½®ï¼Œè®“ä½¿ç”¨è€…ä½¿ç”¨ Google Authenticator ç™»å…¥æ‰èƒ½ä½¿ç”¨ API&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/mfa-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ Gruntwork Guide åœ¨ MFA Policy&lt;/a&gt;æ‰€è¿°ï¼Œè¦ enforce MFA åˆ°æ‰€æœ‰çš„ AWS API æœƒæœ‰è«¸å¤šå›°é›£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæˆ‘å€‘è¦æ±‚æ‰€æœ‰ AWS API éƒ½é MFAï¼Œæœ‰äº›ä¾†æºå¯èƒ½å¾ˆé›£åš MFA
&lt;ul&gt;
&lt;li&gt;ex. EC2 VM ä¸Šçš„ä¸€å€‹ application ä¹Ÿéœ€è¦æ‰“ AWS APIï¼Œä½†åœ¨ VM ä¸Šå°±å¾ˆé›£å–å¾— Google Authenticator çš„èªè­‰ç¢¼&lt;/li&gt;
&lt;li&gt;ex. æ–°çš„ IAM User å‰›æ–°å»ºï¼Œæ²’æœ‰ MFAï¼Œä¹Ÿå°±ç„¡æ³•ç™»å…¥è¨­å®šè‡ªå·±çš„ MFAï¼Œè®Šæˆé›ç”Ÿè›‹è›‹ç”Ÿé›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Gruntwork Guide ä¸­å»ºè­°åœ¨ä»¥ä¸‹æƒ…å¢ƒä¸­å•Ÿç”¨ MFA å°±å¥½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;security ä»¥å¤–çš„ child-account (dev/stag/prod) çš„æ‰€æœ‰ iam-role éƒ½é–‹å•Ÿ MFA
&lt;ul&gt;
&lt;li&gt;ç•¶æˆ‘å€‘è¦ä½¿ç”¨ security/iam-user assuem åˆ°å¦å¤–ä¸€å€‹ account/iam-role æ™‚ï¼Œéœ€è¦ MFA èªè­‰æ‰å¯ assume role&lt;/li&gt;
&lt;li&gt;ç„¶å¾ŒæŠŠ security ä»¥å¤–çš„ child-account &lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html#MFAProtectedAPI-user-mfa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é–‹å•Ÿ global çš„ trust policy&lt;/a&gt; ï¼Œé€™æ¨£è¨­å®šå°±å¾ˆå–®ç´”
&lt;ul&gt;
&lt;li&gt;ä¸æœƒ block iam-user ç™»å…¥ï¼Œå› ç‚ºæ‰€æœ‰ user éƒ½åœ¨ security åº•ä¸‹ï¼Œå…¶ä»– child-account æ²’æœ‰ user&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨ root èˆ‡ security account å…§ï¼Œæ‰æœ‰ IAM User èˆ‡ IAM Groupï¼Œåœ¨é€™é‚Šå•Ÿç”¨ MFA
&lt;ul&gt;
&lt;li&gt;å°‡ MFA ä¾æ“š policy å»è¨­å®šï¼Œé€é policy - group - user å» enforce user ä½¿ç”¨ MFA&lt;/li&gt;
&lt;li&gt;æ–° user å»ºç«‹æ™‚ï¼Œéœ€è¦é¡å¤–å»ºç«‹ &amp;ldquo;self-management&amp;rdquo; permissions policyï¼Œè®“æ–°ç”¨æˆ¶å¯ä»¥ä¸ç”¨ MFAï¼Œé€²è¡Œç¬¬ä¸€æ¬¡çš„ MFA è¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;password-policyhttpsdocsgruntworkioguidesbuild-it-yourselflanding-zoneproduction-grade-designpassword-policy&#34;&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/password-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Password Policy&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Password Policy æŒ‡çš„æ˜¯å°æ–¼ user è‡ªå·±è¨­å®šçš„å¯†ç¢¼è¦ç¬¦åˆä¸€å®šçš„è¦ç¯„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS official doc: å¦‚ä½•è¨­å®š password policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ex. å¯†ç¢¼è‡³å°‘è¦ 32 å­—å…ƒé•·åº¦&lt;/li&gt;
&lt;li&gt;ex. å¯†ç¢¼è¦åŒ…å«è‹±æ–‡ï¼Œæ•¸å­—ï¼Œå¤§å°å¯«ï¼Œæˆ–ç‰¹æ®Šå­—å…ƒ&lt;/li&gt;
&lt;li&gt;ex. å¯†ç¢¼å¤šä¹…éœ€è¦æ›´æ–°ä¸€æ¬¡
é€™äº› password policy å¯ä»¥å¤§å¹…å¼·åŒ–æ‰€æœ‰ User çš„å¯†ç¢¼å®‰å…¨æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘å€‘ä½¿ç”¨çš„ external module terraform-aws-iam å·²ç¶“æ•´åˆäº† password policyï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šç›´æ¥åœ¨ input ä¸­é–‹å•Ÿå³å¯ä»¥ä½¿ç”¨&lt;/p&gt;
&lt;h3 id=&#34;pgp-key&#34;&gt;PGP key&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://zh.wikipedia.org/zh-tw/PGP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pgp (Pretty Good Privacy)&lt;/a&gt; æ˜¯éå¸¸å¸¸ç”¨çš„éå°ç¨±åŠ å¯†å·¥å…·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”è¼ƒå¸¸ç”¨çš„å·¥å…·å¦‚ &lt;a href=&#34;https://www.openpgp.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenPGP&lt;/a&gt; æˆ–æ˜¯ &lt;a href=&#34;https://www.gnupg.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gpg (GnuPG)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç‚ºä½• iam user å‰µå»ºæœƒç‰½æ‰¯åˆ° pgpï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç®¡æ˜¯ gruntwork module æˆ–æ˜¯ aws terraform-aws-iam module éƒ½æ”¯æ´ pgp
&lt;ul&gt;
&lt;li&gt;åœ¨ admin æ–°å»º User èˆ‡ login profile å¾Œï¼Œaws api ç”¢ç”Ÿ passwordï¼Œå›å‚³çµ¦ admin terraformï¼Œé€™æ™‚ admin éœ€è¦æŠŠç¬¬ä¸€æŠŠ password å‚³çµ¦ userï¼Œè®“ user åšç¬¬ä¸€æ¬¡ç™»å…¥&lt;/li&gt;
&lt;li&gt;é€™æ•´å€‹å‚³ééç¨‹ï¼Œä¸ç®¡å¾ aws api -&amp;gt; terraform state -&amp;gt; terraform output -&amp;gt; admin -&amp;gt; userï¼Œå¦‚æœæ˜¯æ˜ç¢¼æœªåŠ å¯†çš„ç‹€æ…‹ä¸‹ï¼Œå¯¦åœ¨ä¸å®œå‚³éï¼Œå¾ˆæœ‰å¯èƒ½è¢«æœ‰å¿ƒä¸­ä¸­é€”æ””æˆª&lt;/li&gt;
&lt;li&gt;å› æ­¤æˆ‘å€‘å¯ä»¥ä½¿ç”¨ pgp ç›¸é—œå·¥å…·ä¾†åŠ å¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;admin ä»¥ gpg(GnuPG) ç‚ºä¾‹éå°ç¨±åŠ å¯† (local exposure)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;admin å–å¾—æ–° user (ex. accounting äººå“¡) çš„ gpg public key&lt;/li&gt;
&lt;li&gt;admin ç”¢ç”Ÿ user password å¾Œï¼Œä½¿ç”¨ gpg å·¥å…·ï¼Œä»¥ account äººå“¡çš„ public key åŠ å¯† password&lt;/li&gt;
&lt;li&gt;ç²å¾—ä¸€ä¸² encrypted textï¼Œå‚³çµ¦ accounting äººå“¡&lt;/li&gt;
&lt;li&gt;accounting äººå“¡ä½¿ç”¨è‡ªå·±çš„ private key ç”¨ gpg å·¥å…·è§£å¯†ï¼Œå³å¯å–å¾—æ˜ç¢¼ password
&lt;ul&gt;
&lt;li&gt;åªæœ‰æœ‰ private key çš„äººå¯ä»¥è§£é–‹ encrypted text&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;accounting äººå“¡ä½¿ç”¨ password ç™»å…¥å¾Œï¼Œæœƒå› ç‚º login profile è¦æ±‚ï¼Œè€Œè¢«è¿«æ›´æ”¹æ–°å¯†ç¢¼ï¼Œæ¨æ£„ admin local æœ‰æ›éšªéçš„ password&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„åšæ³• terraform state èˆ‡ admin local æœƒçœ‹åˆ°æ˜ç¢¼ passwordï¼Œä¸å¤ å®‰å…¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;pgp--keybaseio&#34;&gt;PGP &amp;amp; keybase.io&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/terraform-aws-modules/terraform-aws-iam/tree/master/modules/iam-user#notes-for-keybase-users&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws æä¾›ä¸€å€‹æ”¹é€²çš„åšæ³•&lt;/a&gt;ï¼Œterraform state åªå­˜ encrypted text&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€™æ¨£å¯ä»¥é¿å…åœ¨ terraform state ä¸­èˆ‡ admin local çš„ password æ›éšª&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;pre-requisite&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gpg tool&lt;/li&gt;
&lt;li&gt;keybase.io è¨»å†Š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®‰è£ gpg&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo port install gpg
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gpg --version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œå¯ä»¥å‰µå»ºä¸€å° key pair&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gpg --full-generate-key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ—å‡ºè‡ªå·±æœ‰çš„ secret key (private key)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gpg --list-secret-keys --keyid-format=long
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;export public key&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gpg --armor --export 3AA5C34371567BD2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----BEGIN PGP PUBLIC KEY BLOCK-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mQINBF9oN7ABEADeJ5BO3RsvfB0RpU3ZtI3AZmLmMfoaQ41QtkLoFEhF0XnSBNhH
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ARFfAR39B4hHAnA+/+scVFdGT8i9kuYxk8Ocb7zHgULrOBfKEPEQ5XLmdiqAD+DN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jO2IFPM=
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----END PGP PUBLIC KEY BLOCK-----
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;NOTE: private key æ˜¯é‘°åŒ™ï¼Œpublic key æ˜¯é–é ­ï¼Œæ°¸é ä¸è¦æŠŠ private key å‚³å‡ºå»ï¼Œè€Œæ˜¯æŠŠ public key å‚³å‡ºå»è®“åˆ¥äººåŠ å¯†ï¼Œç”¨ public key åŠ å¯†éçš„æ±è¥¿ï¼Œåªèƒ½ç”¨æ‰‹ä¸Šé€™æŠŠ private key è§£é–‹ï¼Œä¹Ÿå°±æ˜¯å°ˆå±¬ä½ çš„&lt;/p&gt;
&lt;p&gt;åœ¨ keybase.io ä¸Šé¢è¨»å†Šå¾Œï¼Œä¸Šå‚³ä½ çš„ pgp public key&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾ç…§æŒ‡ç¤ºå®Œæˆæ­¥é©Ÿ&lt;/li&gt;
&lt;li&gt;(optional) èªè­‰ github / domain / å…¶ä»–ç¶²ç«™è®“å…¶ä»–äººç¢ºå®šé€™å€‹æ˜¯ä½ æœ¬äºº&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/20120327MIjudbzimM.png&#34; alt=&#34;keybase.io chechiachang æˆ‘æœ¬äºº&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å¯¦éš›æ“ä½œpassword-policy--pgp-key&#34;&gt;å¯¦éš›æ“ä½œï¼špassword policy &amp;amp; pgp key&lt;/h3&gt;
&lt;p&gt;NOTE: å¦‚æœä¸å•Ÿç”¨ pgp-keyï¼Œadmin terraform apply æ–° user å¾Œæ‹¿åˆ°çš„ password å°±æœƒæ˜¯æ˜ç¢¼ï¼Œå¯ä»¥é€é gpg å·¥å…·åŠ å¯†ï¼Œåœ¨é€éç¶²è·¯å‚³çµ¦å°æ–¹&lt;/p&gt;
&lt;p&gt;é€™é‚Šæˆ‘å€‘å…ˆä½¿ç”¨ Accounting å…ˆåšæ¸¬è©¦ï¼Œå•Ÿç”¨ login profile&lt;/p&gt;
&lt;p&gt;NOTE: ä½ çŸ¥é“è‡ªå·±æ˜¯ adminï¼Œå°±è«‹ä¸è¦æ‹¿è‡ªå·±çš„ User åšæ¸¬è©¦ï¼Œå£äº†å¾ˆéº»ç…©&lt;/p&gt;
&lt;p&gt;å°‡ terragrunt.hcl æ”¹æˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Accounting = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      groups               = [&amp;#34;billing&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      pgp_key              = &amp;#34;keybase:chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_login_profile = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_access_keys   = false # accounting always use web console, won&amp;#39;t use access key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥è‘—è¦æ”¹ module ä¸­çš„ codeï¼Œå°‡ module çš„ output æ¥å‡ºä¾†åˆ°ä¸Šå±¤çš„ root module&lt;/p&gt;
&lt;p&gt;output.tf&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# https://github.com/terraform-aws-modules/terraform-aws-iam/blob/master/modules/iam-user/outputs.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output &amp;#34;keybase_password_pgp_message&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  description = &amp;#34;Encrypted password&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    for key, value in module.iam_user : key =&amp;gt; value.keybase_password_pgp_message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output &amp;#34;keybase_password_decrypt_command&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  description = &amp;#34;Decrypt user password command&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    for key, value in module.iam_user : key =&amp;gt; value.keybase_password_decrypt_command
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œæˆ‘å€‘è©¦è‘— plan&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é æœŸï¼šç”¢ç”Ÿ accounting login profileï¼Œç”¢ç”Ÿ pgp encrypted password text (è€Œä¸æ˜¯æ˜ç¢¼ password)&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Accounting&amp;#34;].aws_iam_user_login_profile.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_user_login_profile&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_password      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + key_fingerprint         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_length         = 20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_reset_required = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + pgp_key                 = &amp;#34;keybase:chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + user                    = &amp;#34;Accounting&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 1 to add, 0 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Changes to Outputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + keybase_password_decrypt_command = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Accounting    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Administrator = null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + keybase_password_pgp_message     = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Accounting    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + Administrator = null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¦åˆé æœŸï¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Output ä¸­ &lt;code&gt;keybase_password_pgp_message&lt;/code&gt; çš„ &lt;code&gt; Accounting    = (known after apply)&lt;/code&gt; æ‡‰è©²æ˜¯åŠ å¯†éçš„ output&lt;/li&gt;
&lt;li&gt;æ‡‰è©²è¦åŠ å¯†çµ¦ keybase:chechiachangï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ‘çš„ gpg key å¯ä»¥è§£é–‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ç›´æ¥ä¾† apply è©¦è©¦çœ‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Outputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keybase_password_decrypt_command = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Accounting&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  echo &amp;#34;wcFMA4U4ylYlNYTfAQ/+KLtNeJqOqK/V3pNdcRh9nvyDw/huJfaYF7Ab/YdKqLKNVySBqc6HY8xedmER5Wn78RlG962/f772u8UlQN4XCOjOLjyOaNL8K0tkeoSVg+XXPx2qJO9Myc1d+74rG57biUD26XpwfS7+ryIjaHf+NzjisExZy2mgiMIzzAlfqTzRAc+jYP11wZcyFGwOe9pMq6BJy7FH5935ndVgNLCgYtSjgIV5b5kWQ3SDr0E9egAHnoAcHs8mni71x7OL7OCc/bS3nJSLz1jRkMoukWyQQ3+lM7Nwi36NSJneIKxW5f7lSxr7Bx+W3mx6gZgb18yRVIwbVW5iDFsAQOFb0zOHUf8tm3tAQ0F79Yeqy9sfLCfUUjVpCENEJe5FtwJkI8EbHKe8mGnYA4dbHaCkIDgVa8TZ4mdXl7yVZx0adlkKFIS48niwPHxMErZYqnRBitUCGdaH0bHcpPcnSVolLljZmXZUrntMjIEb9FGYbgl6hOiRF9MR3RQL5DNmpS7uSqU7V6TyhVbAOJO2oR01Z7hXdAMxZ54O+h06jN7fzvLrUSMWvUz/wp+JJnIDYNwu75Dvicn6NmXrP3fH3M8xmYIEPhpSvOldNzB4DMqQdD6tN+DphFFyvFwuLnWKWKOY+pbNXkd5q0H3A69owxgsONoOL1JqjZgOdcLtWTq+g9XqU5XSRQGo1ei5Ctv2f5yAHZuI2smwJkTA88SuyZqJNwRixw5OPpUDOuWxhK6xftsN7M1/TnioX8Ch3RTow7H0dvMFFD3ocvjG4A==&amp;#34; | base64 --decode | keybase pgp decrypt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Administrator&amp;#34; = tostring(null)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keybase_password_pgp_message = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Accounting&amp;#34; = &amp;lt;&amp;lt;-EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----BEGIN PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Version: Keybase OpenPGP v2.0.76
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Comment: https://keybase.io/crypto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  wcFMA4U4ylYlNYTfAQ/+KLtNeJqOqK/V3pNdcRh9nvyDw/huJfaYF7Ab/YdKqLKNVySBqc6HY8xedmER5Wn78RlG962/f772u8UlQN4XCOjOLjyOaNL8K0tkeoSVg+XXPx2qJO9Myc1d+74rG57biUD26XpwfS7+ryIjaHf+NzjisExZy2mgiMIzzAlfqTzRAc+jYP11wZcyFGwOe9pMq6BJy7FH5935ndVgNLCgYtSjgIV5b5kWQ3SDr0E9egAHnoAcHs8mni71x7OL7OCc/bS3nJSLz1jRkMoukWyQQ3+lM7Nwi36NSJneIKxW5f7lSxr7Bx+W3mx6gZgb18yRVIwbVW5iDFsAQOFb0zOHUf8tm3tAQ0F79Yeqy9sfLCfUUjVpCENEJe5FtwJkI8EbHKe8mGnYA4dbHaCkIDgVa8TZ4mdXl7yVZx0adlkKFIS48niwPHxMErZYqnRBitUCGdaH0bHcpPcnSVolLljZmXZUrntMjIEb9FGYbgl6hOiRF9MR3RQL5DNmpS7uSqU7V6TyhVbAOJO2oR01Z7hXdAMxZ54O+h06jN7fzvLrUSMWvUz/wp+JJnIDYNwu75Dvicn6NmXrP3fH3M8xmYIEPhpSvOldNzB4DMqQdD6tN+DphFFyvFwuLnWKWKOY+pbNXkd5q0H3A69owxgsONoOL1JqjZgOdcLtWTq+g9XqU5XSRQGo1ei5Ctv2f5yAHZuI2smwJkTA88SuyZqJNwRixw5OPpUDOuWxhK6xftsN7M1/TnioX8Ch3RTow7H0dvMFFD3ocvjG4A==
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -----END PGP MESSAGE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  EOT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;Administrator&amp;#34; = tostring(null)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„ PGP message æ˜¯åŠ å¯†éçš„ textï¼Œå¯ä»¥æ”¾å¿ƒçš„å‚³é&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªæœ‰æˆ‘çš„ private key èƒ½è§£é–‹ï¼Œæ‰€ä»¥å°±ç®—æ“´æ•£ä¹Ÿæ²’æœ‰ä»€éº¼é¢¨éšª&lt;/li&gt;
&lt;li&gt;æ²’æœ‰ private key çš„äººå·²ç¶“è­‰æ˜ç„¡æ³•åœ¨æœ‰æ•ˆçš„æ™‚é–“å…§è§£é–‹&lt;/li&gt;
&lt;li&gt;é™„ä¸Šè§£å¯†çš„ keybase command å¾ˆè²¼å¿ƒï¼Œæœ‰ä½¿ç”¨ keybase tool äººå¯ä»¥ç›´æ¥è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æˆ‘æ˜¯ä½¿ç”¨ gpg è€Œä¸æ˜¯ keybaseï¼Œä¹Ÿæ˜¯å¯ä»¥è§£é–‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;echo &amp;#34;wcFMA4U4ylYlNYTfAQ/+KLtNeJqOqK/V3pNdcRh9nvyDw/huJfaYF7Ab/YdKqLKNVySBqc6HY8xedmER5Wn78RlG962/f772u8UlQN4XCOjOLjyOaNL8K0tkeoSVg+XXPx2qJO9Myc1d+74rG57biUD26XpwfS7+ryIjaHf+NzjisExZy2mgiMIzzAlfqTzRAc+jYP11wZcyFGwOe9pMq6BJy7FH5935ndVgNLCgYtSjgIV5b5kWQ3SDr0E9egAHnoAcHs8mni71x7OL7OCc/bS3nJSLz1jRkMoukWyQQ3+lM7Nwi36NSJneIKxW5f7lSxr7Bx+W3mx6gZgb18yRVIwbVW5iDFsAQOFb0zOHUf8tm3tAQ0F79Yeqy9sfLCfUUjVpCENEJe5FtwJkI8EbHKe8mGnYA4dbHaCkIDgVa8TZ4mdXl7yVZx0adlkKFIS48niwPHxMErZYqnRBitUCGdaH0bHcpPcnSVolLljZmXZUrntMjIEb9FGYbgl6hOiRF9MR3RQL5DNmpS7uSqU7V6TyhVbAOJO2oR01Z7hXdAMxZ54O+h06jN7fzvLrUSMWvUz/wp+JJnIDYNwu75Dvicn6NmXrP3fH3M8xmYIEPhpSvOldNzB4DMqQdD6tN+DphFFyvFwuLnWKWKOY+pbNXkd5q0H3A69owxgsONoOL1JqjZgOdcLtWTq+g9XqU5XSRQGo1ei5Ctv2f5yAHZuI2smwJkTA88SuyZqJNwRixw5OPpUDOuWxhK6xftsN7M1/TnioX8Ch3RTow7H0dvMFFD3ocvjG4A==&amp;#34; | base64 --decode | gpg --decrypt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±å–å¾— Accounting çš„åˆæ¬¡ç™»å…¥å¯†ç¢¼çš„ï¼Œè¶•å¿«åˆ° aws console ä¸Šé¢è©¦è©¦çœ‹&lt;/p&gt;
&lt;p&gt;NOTE: æƒ³è¦åœ¨ browser åŒæ™‚å¤šé–‹ aws login session çš„è©±ï¼Œå¯ä»¥åƒè€ƒ chrome plugin session box&lt;/p&gt;
&lt;p&gt;ç™»å…¥ aws web console&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨æ„ account ID æ˜¯ root account ID&lt;/li&gt;
&lt;li&gt;user æ˜¯ Accounting&lt;/li&gt;
&lt;li&gt;password æ˜¯å‰›å‰›è§£å¯†çš„å¯†ç¢¼
&lt;ul&gt;
&lt;li&gt;password å°¾ç«¯å¦‚æœæœ‰ &lt;code&gt;%&lt;/code&gt; ä¸æ˜¯å¯†ç¢¼çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ EOL (End of line) indicatorï¼Œè¨˜å¾—å»æ‰&lt;/li&gt;
&lt;li&gt;å‰é¢çš„éƒ¨åˆ†å‰›å¥½ 20 å­—å…ƒï¼Œç¬¦åˆæˆ‘å€‘ login profile çš„å¯†ç¢¼é•·åº¦é™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é †åˆ©ç™»å…¥æ‹‰
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/20120327ZL24NpwgEX.png&#34; alt=&#34;Login success as Accounting&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Accounting çš„æ¬Šé™æ˜¯ä¸èƒ½å‹•ç”¨ EC2 API çš„ï¼Œåˆ‡åˆ° EC2 é é¢ç›´æ¥ API Errorï¼Œä¹Ÿç¬¦åˆé æœŸ
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220921/20120327GDnxFXArEe.png&#34; alt=&#34;Accounting get permission denied&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸Šé¢çš„è®Šæ›´æˆ‘å€‘çš„ PR å¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-modules PR&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-live-example PR&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ˜å¤©é‚„æœ‰ Administrator å¸³æˆ¶éœ€è¦è™•ç†ï¼Œæœƒå†æ›´éº»ç…©ä¸€äº›&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Provision Iam Group Policy</title>
      <link>https://chechia.net/zh-hant/post/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/</link>
      <pubDate>Tue, 20 Sep 2022 10:39:37 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/</guid>
      <description>&lt;p&gt;æ˜¨å¤©æˆ‘å€‘å°‡ root account IAM user import åˆ° terraform ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºç¯„ terraform import&lt;/li&gt;
&lt;li&gt;å¢åŠ  iam user çš„åŠŸèƒ½åˆ° module repository ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»Šå¤©è¦å®Œæˆ root account ä¸­ IAM Group + Policyï¼Œé †ä¾¿èŠèŠ aws IAM policy ç®¡ç†åŸå‰‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ‰¿æ¥æ˜¨å¤©çš„ plan çµæœï¼Œæˆ‘å€‘ä»Šå¤©è¦æŠŠ IAM policy èˆ‡ group é–‹å‡ºä¾†&lt;/p&gt;
&lt;h3 id=&#34;iam-user&#34;&gt;Iam User&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆ review &lt;code&gt;aws_iam_user&lt;/code&gt; çš„ resource&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0] will be updated in-place
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ resource &amp;#34;aws_iam_user&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + force_destroy = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        id            = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        name          = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        tags          = {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (4 unchanged attributes hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }`
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;force_destroy&lt;/code&gt; é€™å€‹åƒæ•¸æˆ‘å€‘éœ€è¦å—ï¼Ÿå¯ä»¥ä¸€æ‰¾ä»¥ä¸‹çš„æ­¥é©ŸæŸ¥æ–‡ä»¶åˆ¤æ–·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥ google &amp;ldquo;terraform aws iam user&amp;rdquo;ï¼Œæ‰¾åˆ° &lt;a href=&#34;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_user#force_destroy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform registry ä¸Š AWS iam user çš„èªªæ˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é€™è£¡æœ‰èªªæ˜ï¼Œåˆªé™¤ user æ™‚ï¼Œå¦‚æœæœ‰ non-terraform-managed çš„ access key, login profile, MFA devicesï¼Œæ˜¯å¦ä»è¦å¼·åˆ¶åˆªé™¤&lt;/li&gt;
&lt;li&gt;é€™è£¡æˆ‘å€‘å¸Œæœ›å¦‚æœæœ‰ access key æˆ– MFA device å­˜åœ¨çš„è©±ï¼Œä¸è¦ç›´æ¥åˆªé™¤ User
å°‡ &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-b15a741b1129d8f5451060653922d85c934792a1dd41c7fae1b02f3a6398094aR8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-b15a741b1129d8f5451060653922d85c934792a1dd41c7fae1b02f3a6398094aR8&lt;/a&gt; æ”¹æˆ false&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;iam-group--policy&#34;&gt;Iam Group &amp;amp; Policy&lt;/h3&gt;
&lt;p&gt;ä»Šå¤©è¦ä¾†èª¿æ•´ Iam Group &amp;amp; Policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/the-root-account&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork æ–‡ä»¶: Root Account èªªæ˜&lt;/a&gt;ï¼Œroot account ä¸‹æ‡‰è©²æœ‰å…©å€‹ policy group
&lt;ul&gt;
&lt;li&gt;group/full-access çµ¦äºˆ root account è¶…ç´šç®¡ç†å“¡å®Œæ•´çš„æ§åˆ¶æ¬Šé™&lt;/li&gt;
&lt;li&gt;billing çµ¦äºˆ billing çš„æœƒè¨ˆäººå“¡é€²ä¾†å ±å¸³&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆ full-access çš„ &lt;code&gt;iam_group&lt;/code&gt; plan å¾Œçš„çµæœå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±æ–¼æˆ‘å€‘ä½¿ç”¨çš„ &lt;a href=&#34;https://github.com/terraform-aws-modules/terraform-aws-iam/tree/master/modules/iam-group-with-policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;module æ˜¯ terraform-aws-iam çš„ group with policies&lt;/a&gt; &lt;code&gt;module.iam_group_with_policies_full_access&lt;/code&gt; è£¡é¢æœ‰ group ä¹Ÿæœ‰ policy&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.aws_iam_group.this[0]&lt;/code&gt; æ˜¯ä¸»è¦çš„ group&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name      = &amp;#34;full-access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path      = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + unique_id = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_membership&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name  = &amp;#34;full-access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + users = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          + &amp;#34;Administrator&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº† groupï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦é… policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€æ¨£é€é group + policy -&amp;gt; attachment çš„ resourceï¼ŒæŠŠ group è·Ÿ policy ç¶åœ¨ä¸€èµ·&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-858c29afbd11c170c1b2d1f0368b50368ff0d056682ec1ddc51cd2014b04f275R22&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å€‘é€™é‚Šçš„ç¨‹å¼ç¢¼&lt;/a&gt; ç›´æ¥ä½¿ç”¨ aws é å…ˆå®šç¾©å¥½çš„ policy &lt;code&gt;arn:aws:iam::aws:policy/AdministratorAccess&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;custom_arns&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = &amp;#34;arn:aws:iam::aws:policy/AdministratorAccess&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;iam-aws-é å…ˆå®šç¾©çš„-policy&#34;&gt;IAM AWS é å…ˆå®šç¾©çš„ policy&lt;/h3&gt;
&lt;p&gt;æœ‰å“ªäº› aws å·²ç¶“é å…ˆå®šç¾©å¥½çš„ policy å¯ä»¥ä½¿ç”¨ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä¸Š aws web console -&amp;gt; iam -&amp;gt; policies ä¸‹æŸ¥è©¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220920/20120327I5BmCCMAky.png&#34; alt=&#34;AWS Web Console IAM Policies&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€™äº›é å…ˆå®šç¾©çš„ policyï¼Œæ˜¯ aws ä¾ç…§æœ€å¸¸å‡ºç¾çš„ä½¿ç”¨æƒ…å¢ƒï¼Œäº‹å…ˆå»ºç«‹çš„ policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è€…ä¸ç”¨å†å»ºè­°&lt;/li&gt;
&lt;li&gt;ex. AWS è¦ºå¾— administrator å¤§æ¦‚æœƒéœ€è¦é€™äº›æ¬Šé™ï¼Œéƒ½å…ˆé–‹åˆ°é€™å€‹ policy/admin ä¸Š&lt;/li&gt;
&lt;li&gt;ex. AWS è¦ºå¾— billing å¤§æ¦‚æœƒéœ€è¦é€™äº›æ¬Šé™ï¼Œéƒ½å…ˆé–‹åˆ°é€™å€‹ policy/billing ä¸Š&lt;/li&gt;
&lt;li&gt;ç”±æ–¼æ˜¯ AWS ä¾ç…§å¤§éƒ¨åˆ†äººçš„éœ€æ±‚é–‹çš„ policyï¼Œæ‰€ä»¥æœƒå¤šé–‹è¨±å¤šæ¬Šé™
&lt;ul&gt;
&lt;li&gt;é€™ä¹Ÿæ˜¯ç”¨é å…ˆå®šç¾© policy çš„ç¼ºé»ï¼Œå°±æ˜¯ç‚ºäº†æ»¿è¶³å¾ˆå¤šäººçš„éœ€æ±‚ï¼Œæ¬Šé™å¤ªå¤§&lt;/li&gt;
&lt;li&gt;é•åæœ€å°æ¬Šé™åŸå‰‡ï¼Œçµ¦äºˆæ¬Šé™éå¤šä¹Ÿé€ æˆå®‰å…¨æ€§çš„é¢¨éšª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ä½¿ç”¨é å…ˆå®šç¾©çš„ policy çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥è‡ªå·±å¯« policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹ policy é–‹å‡ºä¾† default æ²’æœ‰ä»»ä½• permission&lt;/li&gt;
&lt;li&gt;ä¾æ“šæœ€å°æ¬Šé™åŸå‰‡ï¼Œä¸€å¥ä¸€å¥å¢åŠ  permission åˆ° policy ä¸Š&lt;/li&gt;
&lt;li&gt;å¦‚æ­¤å¯ä»¥ç¢ºä¿ policy ä¸Šçš„ permission éƒ½æ˜¯éœ€è¦çš„ï¼Œè€Œä¸æœƒæœ‰å¤šé–‹ä½†æ˜¯ç”¨ä¸åˆ°çš„æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¬Šé™æ„ˆå¤§ï¼Œå®‰å…¨æ€§é¢¨éšªè¶Šé«˜ï¼Œæ‰€ä»¥æœ€ä½³å¯¦è¸æœƒå¸Œæœ›æ‰€æœ‰ policy éƒ½æ˜¯é…å¾—å‰›å‰›å¥½å¤ ç”¨å°±å¥½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç„¶è€Œé… policy å¾ˆèŠ±æ™‚é–“ï¼Œç”¨ aws å·²ç¶“å¯«å¥½çš„ policy é¦¬ä¸Šå¯ä»¥ç”¨&lt;/li&gt;
&lt;li&gt;å¯¦å‹™ä¸Šå¯ä»¥è€ƒé‡å°ˆæ¡ˆæ™‚é–“èˆ‡æ•´é«”äººåŠ›ï¼Œä»¥åŠéœ€è¦çš„å®‰å…¨ç­‰ç´šï¼Œä¾†è€ƒæ…®è¦ä¸è¦åšåˆ°é€™éº¼ç´°&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;aws-policy-access-advisor&#34;&gt;AWS policy access advisor&lt;/h3&gt;
&lt;p&gt;é€šå¸¸å¯« policy å¾ˆé›£é…åˆ°éå¸¸å®Œç¾å‰›å‰›å¥½ï¼Œé€šå¸¸éƒ½æœƒå¤šé–‹ permission&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¬Šé™å¤šé–‹åŠŸèƒ½ä¸æœƒå£ï¼Œå°‘é–‹ç›´æ¥ permission denied&lt;/li&gt;
&lt;li&gt;é‚£å¤šé–‹çš„æ¬Šé™æ²’æœ‰ç”¨åˆ°ï¼Œä¹‹å¾Œè¦å¦‚ä½•æŠŠæ²’æœ‰ç”¨åˆ°çš„æ¬Šé™æ”¶å›ä¾†ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AWS web console æä¾›æ ¹æ“šä½¿ç”¨ç´€éŒ„ï¼Œæå»ºè­°ä¿®æ”¹ policy&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor-view-data.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws æœƒçµ±è¨ˆå„å€‹ IAM å…ƒä»¶ï¼Œå­˜å– AWS API ä½¿ç”¨/æ²’ä½¿ç”¨çš„æ¬Šé™&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚é€™å€‹ User éå» 90 å¤©ä½¿ç”¨äº†å“ªäº› permission å»æ‰“ API&lt;/li&gt;
&lt;li&gt;ä»¥åŠ User é‚„æœ‰å“ªäº› policy permissionï¼Œæ˜¯éå» 90 å¤©éƒ½æ²’æœ‰ç”¨åˆ°çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›é•·æ™‚é–“éƒ½æ²’æœ‰ç”¨åˆ°çš„ policyï¼Œæˆ‘å€‘å°±æ‡‰è©²å®šæœŸ reviewï¼Œç„¶å¾Œç§»é™¤é€™äº›ä¸å¿…è¦çš„æ¬Šé™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;User / Group / &amp;hellip; ç­‰ç­‰éƒ½éœ€è¦åšä¸€æ¨£çš„äº‹æƒ…&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;module-ä½œç‚ºä¸€å€‹çµ„æˆå…ƒä»¶ä½¿ç”¨&#34;&gt;module ä½œç‚ºä¸€å€‹çµ„æˆå…ƒä»¶ä½¿ç”¨&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼æˆ‘å€‘åœ¨ module input ä¸­é–‹å•Ÿäº† &lt;code&gt;attach_iam_self_management_policy = true&lt;/code&gt; åƒæ•¸ï¼Œåœ¨ module ä¸­ä¾¿é€£å¸¶ç”¢ç”Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.aws_iam_policy.iam_self_management[0]&lt;/code&gt;ï¼Œè£¡é¢å®šç¾©çš„è¦åš self management æ‰€éœ€è¦çš„ permission&lt;/li&gt;
&lt;li&gt;å†æŠŠ policy é€é &lt;code&gt;.aws_iam_group_policy_attachment.iam_self_management[0]&lt;/code&gt; ç¶åˆ° group ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_policy&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢å°±æ˜¯æˆ‘å€‘çš„ root account group/full-access èˆ‡å°æ‡‰çš„ policy&lt;/p&gt;
&lt;h3 id=&#34;billing-account&#34;&gt;billing account&lt;/h3&gt;
&lt;p&gt;æ¥è‘—æ˜¯ root account group/full-access èˆ‡å°æ‡‰çš„ policy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘å¯ä»¥è‡ªå·±æ‰‹å¯« policyï¼Œä¾ç…§æœ€å°æ¬Šé™åŸå‰‡ï¼Œä¸€æ¢ä¸€æ¢åŠ å…¥ permission&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯æˆ‘å€‘å¯ä»¥ä¸Š aws web console æ‰¾çœ‹çœ‹æœ‰ç„¡é å…ˆå®šç¾©å¥½çš„ policy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220920/20120327nNp3eZnW9v.png&#34; alt=&#34;AWS Web Console IAM Policies: billing&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220920/20120327nhmspwn04K.png&#34; alt=&#34;AWS Web Console IAM Policies: billing difference&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘æœå°‹ billing æœ‰çœ‹åˆ°å››å€‹ policyï¼Œæ¯å€‹ policy éƒ½æœ‰é™„ä¸Š description èªªæ˜ä½¿ç”¨çš„ç›®çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Billing&lt;/li&gt;
&lt;li&gt;AWSBillingConductorReadOnlyAccess&lt;/li&gt;
&lt;li&gt;AWSBillingConductorFullAccess&lt;/li&gt;
&lt;li&gt;AWSBillingReadOnlyAccess&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™è£¡å°±è¦ä¾æ“šä½¿ç”¨çš„éœ€æ±‚é¸æ“‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çµ¦äºˆ billing ç®¡ç†å“¡çš„æ¬Šé™ï¼Œå°±æœƒæ˜¯ ConductorFullAccess æˆ– ConductorReadOnlyAccess&lt;/li&gt;
&lt;li&gt;çµ¦äºˆ billing å ±å¸³äººå“¡ï¼Œæ‡‰è©²ä¸ç”¨æ›´æ”¹ aws çš„å…¶ä»–è¨­å®šï¼Œåªéœ€è¦è®€å–è·Ÿè¼¸å‡ºï¼Œå°±æœƒæ˜¯ AWSBillingReadOnlyAccess&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šé¸æ“‡ AWSBillingConductorFullAccessï¼Œåšå€‹ç¤ºç¯„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»æ“Š AWSBillingConductorFullAccessï¼Œè·³åˆ° Policies &amp;raquo; AWSBillingConductorFullAccess é é¢&lt;/li&gt;
&lt;li&gt;å¯ä»¥çœ‹åˆ° policy çš„å®Œæ•´ arnï¼ŒAmazon Resource Name (ARN) å”¯ä¸€è­˜åˆ¥AWS è³‡æºï¼Œé¡ä¼¼æ–¼ ID&lt;/li&gt;
&lt;li&gt;ç„¶å¾ŒæŠŠ arn å¡«å…¥ &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-858c29afbd11c170c1b2d1f0368b50368ff0d056682ec1ddc51cd2014b04f275R46&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;module.am_group_with_policies_billing&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220920/20120327PmO72VOmMV.png&#34; alt=&#34;AWS Web Console IAM Policies: AWSBillingConductorFullAccess&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;plan--apply&#34;&gt;plan &amp;amp; apply&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢çš„è®Šæ›´æˆ‘å€‘çš„ PR å¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-modules PR&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terragrunt-infrastructure-live-example PR&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘å€‘ module ä¸­æœ‰æ–°å¢ &lt;code&gt;module &amp;quot;iam_group_with_policies_billing&amp;quot;&lt;/code&gt;ï¼Œè¨˜å¾—è¦å…ˆåŸ·è¡Œ init&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â•·
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Error: Module not installed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   on group.tf line 29:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   29: module &amp;#34;iam_group_with_policies_billing&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ This module is not yet installed. Run &amp;#34;terraform init&amp;#34; to install all
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ modules required by this configuration.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â•µ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform used the selected providers to generate the following execution
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plan. Resource actions are indicated with the following symbols:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_billing.aws_iam_group.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name      = &amp;#34;billing&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path      = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + unique_id = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_billing.aws_iam_group_membership.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_membership&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name  = &amp;#34;billing&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + users = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          + &amp;#34;Accounting&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_billing.aws_iam_group_policy_attachment.custom_arns[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;custom_arns&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = &amp;#34;arn:aws:iam::aws:policy/AWSBillingConductorFullAccess&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_billing.aws_iam_group_policy_attachment.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_billing.aws_iam_policy.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_policy&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name_prefix = &amp;#34;IAMSelfManagement-&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path        = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy      = jsonencode(
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              + Statement = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action   = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UploadSigningCertificate&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UploadSSHPublicKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateUser&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:ResyncMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:List*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:Get*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:GenerateServiceLastAccessedDetails&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:GenerateCredentialReport&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:EnableMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteVirtualMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateVirtualMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:ChangePassword&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect   = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/*/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:mfa/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid      = &amp;#34;AllowSelfManagement&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action   = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:List*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:Get*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect   = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource = &amp;#34;*&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid      = &amp;#34;AllowIAMReadOnly&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action    = &amp;#34;iam:DeactivateMFADevice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Condition = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + Bool            = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              + &amp;#34;aws:MultiFactorAuthPresent&amp;#34; = &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + NumericLessThan = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              + &amp;#34;aws:MultiFactorAuthAge&amp;#34; = &amp;#34;3600&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect    = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource  = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/*/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:mfa/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid       = &amp;#34;AllowDeactivateMFADevice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              + Version   = &amp;#34;2012-10-17&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_id   = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name      = &amp;#34;full-access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path      = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + unique_id = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_membership&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name  = &amp;#34;full-access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + users = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          + &amp;#34;Administrator&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;custom_arns&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = &amp;#34;arn:aws:iam::aws:policy/AdministratorAccess&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_policy&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name_prefix = &amp;#34;IAMSelfManagement-&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path        = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy      = jsonencode(
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              + Statement = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action   = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UploadSigningCertificate&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UploadSSHPublicKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateUser&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:ResyncMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:List*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:Get*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:GenerateServiceLastAccessedDetails&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:GenerateCredentialReport&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:EnableMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteVirtualMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateVirtualMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:ChangePassword&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect   = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/*/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:mfa/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid      = &amp;#34;AllowSelfManagement&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action   = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:List*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:Get*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect   = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource = &amp;#34;*&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid      = &amp;#34;AllowIAMReadOnly&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action    = &amp;#34;iam:DeactivateMFADevice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Condition = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + Bool            = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              + &amp;#34;aws:MultiFactorAuthPresent&amp;#34; = &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + NumericLessThan = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              + &amp;#34;aws:MultiFactorAuthAge&amp;#34; = &amp;#34;3600&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect    = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource  = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/*/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:mfa/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid       = &amp;#34;AllowDeactivateMFADevice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              + Version   = &amp;#34;2012-10-17&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_id   = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Accounting&amp;#34;].aws_iam_user.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_user&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn           = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + force_destroy = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name          = &amp;#34;Accounting&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path          = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + unique_id     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 11 to add, 0 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ¼å°–çš„åŒå­¸æ‡‰è©²æœ‰æ³¨æ„åˆ°æˆ‘å€‘æŠŠ &lt;code&gt;create_login_profile = false&lt;/code&gt; å…ˆé—œæ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºæˆ‘å€‘é‚„æ²’æœ‰æº–å‚™ pgp keyï¼Œé€™å€‹åˆè¦æ˜å¤©å†ä¾†äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Provision Iam User</title>
      <link>https://chechia.net/zh-hant/post/2022-09-16-14th-ithome-ironman-iac-aws-workshop-05-provision-iam-user/</link>
      <pubDate>Mon, 19 Sep 2022 11:59:27 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-16-14th-ithome-ironman-iac-aws-workshop-05-provision-iam-user/</guid>
      <description>&lt;p&gt;æ˜¨å¤©æˆ‘å€‘ç‚ºæ¯å€‹ç’°å¢ƒ(dev / stag / prod &amp;hellip;) è¨­å®šä¸€å€‹ aws organization account&lt;/p&gt;
&lt;p&gt;ä»Šå¤©è¦ä½¿ç”¨ terraform è¨­å®š AWS IAM User&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User åŠ åˆ° terraform ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h1 id=&#34;accounts--iam-users&#34;&gt;Accounts &amp;amp; IAM Users&lt;/h1&gt;
&lt;p&gt;ä»Šå¤©è¦ä½¿ç”¨ Terraform è¨­å®š IAM Usersã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœªä¾†æ‰€æœ‰çš„ User éƒ½æœƒé€é terraform è¨­å®šä¸¦ç®¡ç†&lt;/li&gt;
&lt;li&gt;Day02 è¨­å®šçš„ root account IAM User: Administrator é›–ç„¶æ˜¯æ‰‹å‹•å»ºç«‹çš„ï¼Œæˆ‘å€‘ä¸€æ¨£éœ€è¦æŠŠä»–åŒ¯å…¥åˆ° terraform ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œä¸Šå€‹ PR ä¸­ï¼Œæˆ‘å€‘çš„ terraform module ä¸­ä¸¦æ²’æœ‰è¨­å®š IAM User çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯é€™æ®µ code æ˜¯æ²’æœ‰ç™¼æ®åŠŸèƒ½
&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/1/files#diff-62920ff868733e1c625c23fe7ffd6c93bebd87ae16b865869bf682e29b082a99R54-R67&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/1/files#diff-62920ff868733e1c625c23fe7ffd6c93bebd87ae16b865869bf682e29b082a99R54-R67&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  users = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    alice = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      groups               = [&amp;#34;full-access&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      pgp_key              = &amp;#34;keybase:alice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_login_profile = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_access_keys   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    bob = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      groups               = [&amp;#34;billing&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      pgp_key              = &amp;#34;keybase:bob&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_login_profile = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      create_access_keys   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å€‘é€™é‚Šä¸€æ¨£å˜—è©¦æŠŠé€™å€‹ users (map) çš„åŠŸèƒ½è£œä¸Š&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨é–‹æº-module-å¯¦ä½œ-iam-user&#34;&gt;ä½¿ç”¨é–‹æº module å¯¦ä½œ IAM User&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨çš„é–‹æº terraform module æ˜¯ &lt;a href=&#34;https://github.com/terraform-aws-modules/terraform-aws-iam/tree/master/modules/iam-user&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-aws-modules/terraform-aws-iam&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯ aws å®˜æ–¹ç¶­è­·çš„é–‹æº terraform moduleï¼Œå“è³ªå¾ˆå¥½ï¼Œæ”¾å¿ƒä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éœ€æ±‚æ•´ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¦ç”¢ç”Ÿ IAM User&lt;/li&gt;
&lt;li&gt;input: ä¸€å€‹ map users = {}&lt;/li&gt;
&lt;li&gt;output: å¤šå€‹ user&lt;/li&gt;
&lt;li&gt;è¦ç”¢ç”Ÿ IAM Group èˆ‡ IAM Policy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¢åŠ  IAM User PR çš„ commit åœ¨æ­¤ &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯æˆ‘å€‘è©¦è‘—åŸ·è¡Œ terraform plan&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform used the selected providers to generate the following execution
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plan. Resource actions are indicated with the following symbols:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name      = &amp;#34;full-access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path      = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + unique_id = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_membership&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name  = &amp;#34;full-access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + users = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          + &amp;#34;Administrator&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;custom_arns&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = &amp;#34;arn:aws:iam::aws:policy/AdministratorAccess&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_group_policy_attachment&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + group      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_arn = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_policy&amp;#34; &amp;#34;iam_self_management&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name        = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name_prefix = &amp;#34;IAMSelfManagement-&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path        = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy      = jsonencode(
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              + Statement = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action   = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UploadSigningCertificate&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UploadSSHPublicKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateUser&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:UpdateAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:ResyncMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:List*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:Get*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:GenerateServiceLastAccessedDetails&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:GenerateCredentialReport&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:EnableMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteVirtualMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:DeleteAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateVirtualMFADevice&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateLoginProfile&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:CreateAccessKey&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:ChangePassword&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect   = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/*/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:mfa/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid      = &amp;#34;AllowSelfManagement&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action   = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:List*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;iam:Get*&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect   = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource = &amp;#34;*&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid      = &amp;#34;AllowIAMReadOnly&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  + {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Action    = &amp;#34;iam:DeactivateMFADevice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Condition = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + Bool            = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              + &amp;#34;aws:MultiFactorAuthPresent&amp;#34; = &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + NumericLessThan = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              + &amp;#34;aws:MultiFactorAuthAge&amp;#34; = &amp;#34;3600&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Effect    = &amp;#34;Allow&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Resource  = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/*/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:user/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          + &amp;#34;arn:aws:iam::706136188012:mfa/${aws:username}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      + Sid       = &amp;#34;AllowDeactivateMFADevice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              + Version   = &amp;#34;2012-10-17&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + policy_id   = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all    = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_user&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn           = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + force_destroy = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name          = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + path          = &amp;#34;/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + unique_id     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user_login_profile.this[0] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_iam_user_login_profile&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + encrypted_password      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + key_fingerprint         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_length         = 20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + password_reset_required = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + pgp_key                 = &amp;#34;keybase:alice&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + user                    = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 7 to add, 0 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœƒç”¢ç”Ÿå¹¾å€‹æ±è¥¿&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;module.iam_user[&amp;quot;Administrator&amp;quot;]&lt;/code&gt; æ˜¯ä¸€å€‹ moduleï¼Œè£¡é ­ç”¢ç”Ÿ IAM User èˆ‡å…¶ä»– resource
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;module.iam_user[&amp;quot;Administrator&amp;quot;].aws_iam_user_login_profile&lt;/code&gt; æˆ‘å€‘æœ‰é–‹å•Ÿ create login file çš„åƒæ•¸ï¼Œæ‰€ä»¥ aws terraform module ä¾¿ç”¢ç”Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management&lt;/code&gt; æˆ‘å€‘æœ‰é–‹å•Ÿ create self management policyï¼Œæ‰€ä»¥ aws terraform module ä¾¿ç”¢ç”Ÿ
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment&lt;/code&gt; é€éé€™å€‹ attachment å°‡ IAM policy é—œè¯åˆ° IAM groupï¼Œä¹Ÿå°±æ˜¯ group ä¸­æœ‰ attach æ­¤ full-access policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;module.iam_group_with_policies_full_access.aws_iam_group&lt;/code&gt; æ˜¯ IAM Group: full-access
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;module.iam_group_with_policies_full_access.aws_iam_group_membership&lt;/code&gt; å°‡ IAM User é—œè¯åˆ° IAM group ä¹Ÿå°±æ˜¯ user/Administrator å±¬æ–¼ group/full-access&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AWS è¨±å¤šè³‡æºçš„æè¿°éƒ½ç”¨ attachment çš„å½¢å¼æè¿°å…©å€‹å…ƒä»¶çš„é—œè¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;user + group -&amp;gt; &lt;code&gt;group_membership&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;group + policy -&amp;gt; &lt;code&gt;group_policy_attachment&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åƒæ˜¯ RMDBS çš„é—œè¯ tableï¼Œæ›´æ”¹é—œè¯æ™‚ä¸¦ä¸æœƒå½±éŸ¿åˆ°å…©å€‹å…ƒä»¶æœ¬èº«çš„å…§å®¹ï¼Œèª¿æ•´é—œè¯å¾ˆå½ˆæ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;terraform-import&#34;&gt;Terraform Import&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼ Administrator æˆ‘å€‘ Day02 å·²ç¶“é€é web console å»ºç«‹ï¼Œç¾åœ¨ terraform plan å‡ºä¾†çš„çµæœå»ä¹Ÿæ˜¯è¦ create ä¸€å€‹ new userï¼Œé€™å€‹çµæœä¸æ˜¯æˆ‘å€‘æƒ³è¦çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚º web console ç”¢ç”Ÿçš„ User ä¸¦æ²’æœ‰åœ¨ terraform ä¸­ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯é›–ç„¶ AWS ä¸Š User ç¢ºå¯¦å­˜åœ¨ï¼Œä½† terraform ä¸­ä¸¦æ²’æœ‰ state ä¾†æè¿°é€™å€‹ Userï¼Œæ‰€ä»¥ Terraform ä¸çŸ¥é“é€™å€‹ plan create çš„ User å…¶å¯¦å°±æ˜¯ AWS console ä¸Šå·²ç¶“å­˜åœ¨çš„ Administrator
&lt;ul&gt;
&lt;li&gt;ä¸åœ¨ terraform state çš„å…ƒä»¶ï¼Œterraform ä¾¿ç„¡æ³•ç®¡ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦å°‡å·²ç¶“å­˜åœ¨çš„ AWS å…ƒä»¶ï¼Œç´å…¥ terraform state é€²è¡Œç®¡ç†ï¼Œé€™å€‹è¡Œç‚ºæˆ‘å€‘ç¨±ä½œ import&lt;/p&gt;
&lt;p&gt;ç¾åœ¨æˆ‘å€‘è¦è©¦è‘— terraform import å·²ç¶“å­˜åœ¨çš„ User/Administrator&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œå…ˆåˆ° terraform registry å»æœå°‹ aws provider import çš„èªæ³•åŠåƒæ•¸
&lt;ul&gt;
&lt;li&gt;ç›´æ¥ google å…ƒä»¶çš„åç¨± &lt;code&gt;terraform aws iam user&lt;/code&gt; é€šå¸¸å°±æœƒæ‰¾åˆ°&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_user#import&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ²åˆ°é é¢æœ€åº•ä¸‹å°±å¯ä»¥çœ‹åˆ° import èªæ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# terraform import aws_iam_user.lb loadbalancer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform import &amp;lt;address&amp;gt; &amp;lt;username&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šçš„ address éœ€è¦å¡«å…¥ plan æ™‚é è¨ˆç”¢ç”Ÿçš„ resource &lt;code&gt;aws_iam_user&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯ &lt;code&gt;module.iam_user[&amp;quot;Administrator&amp;quot;].aws_iam_user.this[0]&lt;/code&gt; é€™å€‹ address&lt;/li&gt;
&lt;li&gt;å‰›é–‹å§‹å­¸ terraform å¯èƒ½æœƒé‚„ä¸å¤ªæ¸…æ¥š address ç‚ºä½•æœƒé•·é€™æ¨£ï¼Œä¹…äº†å°±æœƒäº†è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥å…ˆå¾æ‰¾åˆ° resource ä¸»é«”ç‚ºç›®æ¨™æ…¢æ…¢çœ‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€è¬‚çš„ resource çš„ä¸»é«”ï¼Œå…¶å¯¦å°±æ˜¯ terraform çš„åŸºæœ¬å–®ä½&lt;/li&gt;
&lt;li&gt;ä¸€å€‹ terraform resource å¯èƒ½å°±æ˜¯å°æ‡‰ä¸€å€‹ aws å…ƒä»¶
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;aws_iam_user&lt;/code&gt; -&amp;gt; &lt;code&gt;iam_user&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;aws_iam_policy&lt;/code&gt; -&amp;gt; &lt;code&gt;iam_policy&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å»æ‰å‰é¢çš„ module èˆ‡å¾Œé¢çš„ index å°±å¯ä»¥æ‰¾åˆ° resource&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å…¶ä¸­ aws_iam_user æ˜¯ terraform resource
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.&amp;lt;module_name&amp;gt;.aws_iam_user.&amp;lt;iam_user_name&amp;gt;.&amp;lt;iam_user_index&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# æˆ–æ˜¯é€™å€‹ address ä¸­  aws_iam_policy æ˜¯ terraform resource
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.&amp;lt;module_name&amp;gt;.aws_iam_policy.&amp;lt;iam_user_name&amp;gt;.&amp;lt;iam_user_index&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# module å¯ä»¥åœ¨åŒ…å…¶ä»– moduleï¼Œæ‰€ä»¥æ¶æ§‹è¤‡é›œçš„ terraform moduleï¼Œresource address å°±æ„ˆä¾†è¶Šé•·
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.&amp;lt;module_name&amp;gt;.module.&amp;lt;module_name&amp;gt;.aws_iam_user.&amp;lt;iam_user_name&amp;gt;.&amp;lt;iam_user_index&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€ä¸Šå±¤çš„ resource æ˜¯ &lt;code&gt;module/iam_user[*]&lt;/code&gt;ï¼Œå°æ‡‰çš„ .tf code æ˜¯ &lt;a href=&#34;&#34;&gt;user.tf&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module &amp;#34;iam_user&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  source   = &amp;#34;terraform-aws-modules/iam/aws//modules/iam-user&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  for_each = var.users
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name          = each.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  force_destroy = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  create_iam_user_login_profile = each.value.create_login_profile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  create_iam_access_key         = each.value.create_access_keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pgp_key                       = each.value.pgp_key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password_reset_required       = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;module/iam_user&lt;/code&gt; ä¸­åŒ…å«äº†è¨±å¤š terraform resource
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;aws_iam_user&lt;/code&gt; æ˜¯åŸºæœ¬ resource&lt;/li&gt;
&lt;li&gt;&lt;code&gt;aws_iam_user.this[0]&lt;/code&gt; å¾Œé¢å¤šäº† index suffixï¼Œæ˜¯å› ç‚ºå¯èƒ½åœ¨ module ä¸­æœ‰ä½¿ç”¨ &lt;code&gt;count&lt;/code&gt; æˆ– &lt;code&gt;for_each&lt;/code&gt;ï¼Œé€ æˆä¸€å€‹ list çš„ &lt;code&gt;aws_iam_user&lt;/code&gt;ï¼Œè€Œå…¶ä¸­ index ç‚º 0 çš„å°±æ˜¯ &lt;code&gt;aws_iam_user.this[0]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;terraform æ”¯æ´è¨±å¤šå¥½ç”¨çš„ build-in function è®“æˆ‘å€‘å¯ä»¥å¿«é€Ÿçš„ä½¿ç”¨ï¼Œç”¢ç”Ÿè¤‡é›œçš„é‚è¼¯ï¼Œé€™å€‹ä¹‹å¾Œæœ‰ç©ºæœƒæ•™å¤§å®¶ã€‚æˆ–æ˜¯&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10263624&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åƒè€ƒ 2021 iThome çš„ç™¼æ–‡: infrastructure ä¹Ÿå¯ä»¥ for each ä¹‹ä¸€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å›åˆ° importï¼Œæˆ‘å€‘æŠŠ terraform import address name æ•¸å…¥å¾Œï¼Œç™¼ç¾å‡ºéŒ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Bash syntax error
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session -- terragrunt import module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0] Administrator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;zsh: no matches found: module.iam_user[Administrator].aws_iam_user.this[0]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ˜¯å› ç‚ºæœ‰äº› address å­—å…ƒ bash ä¸­æœ‰å…¶ä»–æ„ç¾©çš„ç‰¹æ®Šå­—å…ƒï¼Œbash å…ˆçœ‹ä¸æ‡‚äº†ï¼Œå°±ç„¡æ³•åŸ·è¡Œï¼Œé‚„æ²’è·‘åˆ° terragruntã€‚æˆ‘å€‘æŠŠ address å‰å¾Œéƒ½å¢åŠ å–®å¼•è™Ÿï¼Œè®“ bash æŠŠ address ç•¶ä½œå­—ä¸²è™•ç†è€Œä¸è¦å±•é–‹ (expension)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add single quote to escape
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;taws-vault exec terraform-30day-root-iam-user --no-session -- erragrunt import &amp;#39;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0]&amp;#39; Administrator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0]: Importing from ID &amp;#34;Administrator&amp;#34;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0]: Import prepared!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Prepared aws_iam_user for import
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0]: Refreshing state... [id=Administrator]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import successful!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The resources that were imported are shown above. These resources are now in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;your Terraform state and will henceforth be managed by Terraform.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Releasing state lock. This may take a few moments...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¡¯ç¤ºç‚º Import Success äº†ï¼Œå°±è¡¨ç¤ºæˆ‘å€‘å·²ç¶“æŠŠ aws å­˜åœ¨çš„ user import åˆ° terraform state ä¸­&lt;/p&gt;
&lt;p&gt;å†æ¬¡ planï¼Œç™¼ç¾å¾ Plan: 7 to addï¼Œè®Šæˆ Plan: 6 to add, 1 to change&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¡¨ç¤º terraform çŸ¥é“ plan ä¸­çš„ address è¦ç›´æ¥å°æ‡‰åˆ° aws ç¾å­˜çš„ user/Administrator&lt;/li&gt;
&lt;li&gt;change ä¸­é¡¯ç¤º &lt;code&gt;+ force_destroy = true&lt;/code&gt; è¡¨ç¤º
&lt;ul&gt;
&lt;li&gt;aws ç¾å­˜çš„ user/Administrator æ²’æœ‰é€™å€‹è¨­å®š&lt;/li&gt;
&lt;li&gt;.tf çš„ &lt;code&gt;module.iam_user[&amp;quot;Administrator&amp;quot;].aws_iam_user.this[0]&lt;/code&gt; æœ‰é€™è¡Œ code&lt;/li&gt;
&lt;li&gt;terraform plan ç™¼ç¾ .tf æ¯”ç¾å­˜çš„ user/Administrator å¤šè¨­å®šï¼Œæ–¼æ˜¯è¦å¤šåŠ è¨­å®š&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘å¯ä»¥ä¾æ“šéœ€æ±‚ï¼Œæ±ºå®šè¦
&lt;ul&gt;
&lt;li&gt;æ›´æ”¹ .tfï¼Œæ‹¿æ‰ &lt;code&gt;+ force_destroy = true&lt;/code&gt;ï¼Œé€™æ¨£ plan å¾Œ terraform å°±æœƒè¦ºå¾—å…©é‚Šçš„ user/Administrator ä¸€æ¨¡å£¹æ¨£ï¼Œä¸éœ€è¦ change&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯å°±ç›´æ¥ apply ï¼Œè®“ç¾å­˜çš„ user/Administrator å¢åŠ  &lt;code&gt;+ force_destroy = true&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # module.iam_user[&amp;#34;Administrator&amp;#34;].aws_iam_user.this[0] will be updated in-place
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ~ resource &amp;#34;aws_iam_user&amp;#34; &amp;#34;this&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + force_destroy = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        id            = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        name          = &amp;#34;Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        tags          = {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # (4 unchanged attributes hidden)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 6 to add, 1 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; root ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å°‡æ‰‹å‹•ç”¢ç”Ÿçš„ Administrator çš„ IAM User import terraform ä¸­&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; è£œä¸Š root account IAM Group&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>AWS Multi-Accounts Structure</title>
      <link>https://chechia.net/zh-hant/post/2022-09-15-14th-ithome-ironman-iac-aws-workshop-04-aws-multi-account-structure/</link>
      <pubDate>Sun, 18 Sep 2022 09:35:25 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-15-14th-ithome-ironman-iac-aws-workshop-04-aws-multi-account-structure/</guid>
      <description>&lt;p&gt;æ˜¨å¤©è¨­å®šäº†å¤šå€‹ aws organization accountsï¼Œä½†æˆ‘å€‘é‚„æ²’æœ‰èªªæ˜ç‚ºä»€éº¼è¦é€™æ¨£åš&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æœƒå…ˆè¬› Gruntwork æå‡ºçš„ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/intro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Production-Grade Design: multi-account security strategy&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹†åˆ†å¤šå€‹ account çš„ç”¨æ„&lt;/li&gt;
&lt;li&gt;å¤š account ä¸‹å¦‚ä½•çµ±ä¸€ç®¡ç† IAM User&lt;/li&gt;
&lt;li&gt;access control èˆ‡å®‰å…¨æ€§æ§ç®¡&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h1 id=&#34;production-grade-design-iam&#34;&gt;Production-grade Design IAM&lt;/h1&gt;
&lt;p&gt;Gruntwork æå‡ºçš„ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/intro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Production-Grade Design: multi-account security strategy&lt;/a&gt;ï¼Œæˆ‘å€‘é€™é‚Šä¸€ä¸€è¬›è§£&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220918/20120327GL49e7CTD0.png&#34; alt=&#34;Multi-account security strategy&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;root-accounthttpsdocsgruntworkioguidesbuild-it-yourselflanding-zoneproduction-grade-designthe-root-account-çš„ç”¨é€”&#34;&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/the-root-account&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Root Account&lt;/a&gt; çš„ç”¨é€”&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½æ–¼ diagram åœ–ä¸­çš„æœ€ä¸Šå±¤&lt;/li&gt;
&lt;li&gt;æ˜¯æ•´å€‹æ¶æ§‹çš„å‰µä¸–å¸³è™Ÿï¼Œæ¬Šé™æœ€å¤§&lt;/li&gt;
&lt;li&gt;root account è£¡é¢æ²’æœ‰ä»»ä½• infrastructure å…ƒä»¶ï¼Œ i.e. aws ec2 ä¸æœƒé•·åœ¨è£¡é¢ï¼Œæ˜¯ä¸€å€‹ç©º account&lt;/li&gt;
&lt;li&gt;root account çš„å­˜å–æœ€åš´æ ¼
&lt;ul&gt;
&lt;li&gt;åªæœ‰å¾ˆå°‘æ•¸çš„ admin å¯ä»¥å­˜å–
&lt;ul&gt;
&lt;li&gt;i.e åªæœ‰ SRE éƒ¨é–€ä¸»ç®¡æœ‰è‡ªå·±çš„ IAM Userï¼Œå…¶ä»– SRE æ²’æœ‰æ¬Šé™å­˜å– root account&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;root account çš„å·¥ä½œæœ€å°‘
&lt;ul&gt;
&lt;li&gt;è¨­å®š child account&lt;/li&gt;
&lt;li&gt;ç®¡ç† billing&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;IAM policy ç®¡ç†ï¼Œä¸è¦æŠŠ policy ç›´æ¥ç¶åœ¨ User ä¸Šï¼Œæ‡‰è©²è¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‚ºä¸åŒæ¬Šè²¬çš„æˆå“¡è¨­å®š IAM Groupï¼Œex. dev-admin / dev-user / stag-admin / qa / billing / &amp;hellip;&lt;/li&gt;
&lt;li&gt;æŠŠ policy ç¶åœ¨ Group ä¸Šï¼Œex. ReadPermission -&amp;gt; dev-user / Read+Write -&amp;gt; dev-admin&lt;/li&gt;
&lt;li&gt;æŠŠ User åŠ é€² / ç§»é™¤ Groupï¼Œä¾†ç®¡ç†äººå“¡æ¬Šé™&lt;/li&gt;
&lt;li&gt;Group é€šå¸¸æœƒæ¥è¿‘å…¬å¸åœ˜éšŠçš„è·è²¬åˆ†é…&lt;/li&gt;
&lt;li&gt;root account å…§éƒ¨åªæœƒæœ‰
&lt;ul&gt;
&lt;li&gt;full-access çš„ç®¡ç†å“¡ group&lt;/li&gt;
&lt;li&gt;billing çš„æœƒè¨ˆå‡ºå¸³ group&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;child-accounthttpsdocsgruntworkioguidesbuild-it-yourselflanding-zoneproduction-grade-designchild-accounts-çš„ç”¨é€”&#34;&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/child-accounts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Child Account&lt;/a&gt; çš„ç”¨é€”&lt;/h3&gt;
&lt;p&gt;é€é root account å‰µå»º child accounts å¾Œï¼Œé€™è£¡èªªæ˜å„å€‹ account çš„è¨­è¨ˆç”¨é€”&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Security&lt;/code&gt; ç”¨ä¾†ç®¡ç† authentication èˆ‡ authorization&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº•ä¸‹ä¸€æ¨£æ²’æœ‰ä»»ä½• infrastructure å…ƒä»¶&lt;/li&gt;
&lt;li&gt;å®šç¾©æ‰€æœ‰ IAM User èˆ‡ IAM Groupï¼Œæ‰€æœ‰åœ˜éšŠæˆå“¡çš„ User åœ¨é€™é‚Šè¨­å®š
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰çš„ User æ”¾åœ¨ &lt;code&gt;Security&lt;/code&gt; åº•ä¸‹çµ±ä¸€ç®¡ç†&lt;/li&gt;
&lt;li&gt;å…¶ä»–çš„ child account ä¸æœƒè¨­å®š IAM Userï¼Œex. dev / stag / prod è£¡é¢éƒ½æ²’æœ‰ IAM User
&lt;ul&gt;
&lt;li&gt;child account ä¸­è¨­å®š IAM rolesï¼Œè®“ security/user &lt;a href=&#34;https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;assume role&lt;/a&gt; å­˜å–å…¶ä»– child account&lt;/li&gt;
&lt;li&gt;ex. &lt;code&gt;security&lt;/code&gt;/dev-admin/chechia assume role &lt;code&gt;dev&lt;/code&gt;/adminï¼Œé€é aws STS(Security Token Service) æš«æ™‚å–å¾— dev/admin é€™å€‹ role çš„æ¬Šé™ä¾†æ§åˆ¶ &lt;code&gt;dev&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ˜éšŠä¸»ç®¡ä¹Ÿæœƒæœ‰ä¸€å€‹ security IAM Userï¼Œå¹³æ™‚é–‹ç™¼ infrastructure ä½¿ç”¨é€™å€‹ IAM Userï¼Œåªæœ‰éœ€è¦èª¿æ•´ root account æ™‚æ‰æœƒå‹•ç”¨ root account IAM Userã€‚åæ­£ root account æ˜¯èƒ½ä¸ç”¨å°±ä¸ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™å€‹åšæ³•æœ‰éå¸¸å¤šå¥½è™•ï¼Œä½†åˆä¸æœƒé€ æˆå·¥ä½œä¸Šçš„è² æ“”&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ–¹é¢ï¼šæ‰€æœ‰çš„åœ˜éšŠæˆå“¡åªæœƒæœ‰ä¸€å€‹ Userï¼Œé€é &lt;code&gt;security&lt;/code&gt; ç™»å…¥ã€‚ä¸æœƒä¸€å€‹äººæœ‰å¥½å¹¾å€‹å¸³è™Ÿå¯†ç¢¼å¾ˆç…©&lt;/li&gt;
&lt;li&gt;ç®¡ç†æ–¹é¢ï¼šç®¡ç†å“¡åªè¦åœ¨ &lt;code&gt;security&lt;/code&gt; å…§ç®¡ç† Userï¼Œè€Œä¸ç”¨ä¸€ç›´åˆ‡æ› account å»èª¿æ•´ IAM User&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ–¹é¢ï¼šåªè¦åœ¨ &lt;code&gt;security&lt;/code&gt; å…§è½å¯¦å®‰å…¨æ€§è¨­å®šï¼Œå°±å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶æ‰€æœ‰ account çš„å­˜å–æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;dev&lt;/code&gt; / &lt;code&gt;stag&lt;/code&gt; / &lt;code&gt;prod&lt;/code&gt; ç”¨ä¾†å­˜æ”¾ infrastructure èˆ‡è·‘ application&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é–‹ç™¼æ™‚ä½¿ç”¨ dev / stag ç’°å¢ƒï¼Œæ¸¬è©¦éƒ½å®Œæˆå¾Œï¼Œæ‰è‡ªå‹•æ¨å€’ &lt;code&gt;prod&lt;/code&gt; å…¬é–‹çµ¦ç”¨æˆ¶ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;dev / stag ç’°å¢ƒæ˜¯å…§éƒ¨ç’°å¢ƒï¼Œæ¶æ§‹èˆ‡ prod é¡ä¼¼ï¼Œä¾†æ¨¡æ“¬ prod çš„ç’°å¢ƒæ–¹ä¾¿é–‹ç™¼èˆ‡æ¸¬è©¦
&lt;ul&gt;
&lt;li&gt;å¯èƒ½æ©Ÿå™¨æ•¸é‡æˆ–è¦æ ¼æ¯” prod å°å¾ˆå¤šï¼Œä¾†ç¯€çœæˆæœ¬&lt;/li&gt;
&lt;li&gt;æœ‰äº›åœ˜éšŠæœƒæœ‰æ›´å¤š accountï¼Œä¾‹å¦‚ qa / uat / &amp;hellip;ï¼Œéƒ½å¯ä»¥ä¾ç…§éœ€æ±‚å»ºç«‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;prod æœ‰äº›åœ˜éšŠæœƒæœ‰è¤‡æ•¸ prod ç’°å¢ƒï¼Œå¯ä»¥ä¾›ç½é›£ç™¼ç”Ÿæ™‚åšå‚™æ´åˆ‡æ›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;shared&lt;/code&gt; è£¡é¢æ”¾è·¨ application account å…±ç”¨çš„å…ƒä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚
&lt;ul&gt;
&lt;li&gt;AWS ECR å¯èƒ½ä¸æƒ³è¦æ¯å€‹ account éƒ½é–‹ï¼Œæƒ³æ”¾ä¸€èµ·çš„è©±å¯ä»¥æ”¾åœ¨ &lt;code&gt;shared&lt;/code&gt;ï¼Œç„¶å¾Œè®“å…¶ä»– account å­˜å– &lt;code&gt;shared&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç‰ˆæœ¬æ§åˆ¶ç³»çµ± Git / github å¯èƒ½æœƒåªæœ‰ä¸€çµ„å¤§å®¶å…±ç”¨&lt;/li&gt;
&lt;li&gt;CI/CD pipeline / Jenkins&lt;/li&gt;
&lt;li&gt;&amp;hellip;ç­‰ç­‰è·¨ç’°å¢ƒå…±ç”¨çš„è³‡æºï¼Œå¯ä»¥æ”¾ &lt;code&gt;shared&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¯å€‹ account éƒ½é–‹ä¹Ÿæ˜¯æœ‰è¨±å¤šå¥½è™•ï¼Œä¾‹å¦‚æ›´ç¨ç«‹æ›´å®‰å…¨ï¼Œé€™å°±çœ‹çœ‹å„å€‹åœ˜éšŠç½å®‰å…¨èˆ‡æˆæœ¬ä¸Šçš„å–æ¨&lt;/li&gt;
&lt;li&gt;ç®¡ç†ä¸Šç”±æ–¼ &lt;code&gt;prod&lt;/code&gt; æœƒä½¿ç”¨åˆ° &lt;code&gt;shared&lt;/code&gt; çš„å…ƒä»¶ï¼Œå»ºè­°è¦æŠŠ &lt;code&gt;shared&lt;/code&gt; çš„å®‰å…¨ç­‰ç´šç•¶ä½œ &lt;code&gt;prod&lt;/code&gt; ä¾†ç®¡ç†ï¼Œåš´æ ¼é™åˆ¶ &lt;code&gt;shared&lt;/code&gt; çš„å­˜å–ï¼Œä»¥ä¿è­· &lt;code&gt;prod&lt;/code&gt; ç’°å¢ƒçš„å®‰å…¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾ˆå¤šå€‹ &lt;code&gt;sandbox&lt;/code&gt; account è®“å·¥ç¨‹å¸«è‡ªç”±çš„æ¸¬è©¦åŠŸèƒ½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰éœ€æ±‚èˆ‡é ç®—ï¼Œä¸€å€‹å®Œå…¨ç¨ç«‹çš„ &lt;code&gt;sandbox&lt;/code&gt; è®“å·¥ç¨‹å¸«å¯ä»¥åšå„ç¨®å¯¦é©—ï¼Œå°æ–¼ä¿ƒé€²åœ˜éšŠå…§éƒ¨çš„å‰µæ–°æœƒæœ‰éå¸¸å¤§çš„å¹«åŠ©
&lt;ul&gt;
&lt;li&gt;å¦‚æœåœ¨ &lt;code&gt;dev&lt;/code&gt; ä¸Šåšé€™æ¸¬è©¦ï¼Œæœ‰å¯èƒ½æœƒå½±éŸ¿åˆ°å…¶ä»–åœ˜éšŠæˆå“¡ï¼Œè€Œè¦ºå¾—ç¶æ‰‹ç¶è…³çš„äº‹æƒ…ï¼Œéƒ½å¯ä»¥ç›¡æƒ…åœ¨ &lt;code&gt;sandbox&lt;/code&gt; ä¸Šæ“ä½œ&lt;/li&gt;
&lt;li&gt;å¯ä»¥ç‚º &lt;code&gt;sandbox&lt;/code&gt; çš„å¸³è™Ÿè¨­å®šæ›´åš´æ ¼çš„ billing / cost è¨­å®šï¼Œé¿å…å·¥ç¨‹å¸«ç©å¤ªå—¨è¶…éé ç®—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é»ƒé‡‘æº–å‰‡æ˜¯ä¸€å€‹å·¥ç¨‹å¸«ä¸€å€‹ &lt;code&gt;sandbox&lt;/code&gt; ä¾†é”åˆ° 100% é–‹ç™¼ç¨ç«‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;testing&lt;/code&gt; account ç”¨ä¾†æ¸¬è©¦ infrastructure çš„æ¸¬è©¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰ä½¿ç”¨ &lt;a href=&#34;https://blog.gruntwork.io/open-sourcing-terratest-a-swiss-army-knife-for-testing-infrastructure-code-5d883336fcd5?gi=141873b58326&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork/Terratest&lt;/a&gt; ä¾†æ¸¬è©¦ terraform tf code çš„æœ‹å‹ï¼Œæ‡‰è©²çŸ¥é“ terratest æœƒæŠŠ terraform module ä¸­çš„ infrastrcuture çœŸçš„åœ¨ aws é–‹å‡ºä¾†ï¼ŒåšåŠŸèƒ½æ¸¬è©¦ï¼Œç„¶å¾Œæ¸¬è©¦å®Œæˆå¾Œå†æŠŠ infrastrcture å…¨éƒ¨åˆªæ‰
&lt;ul&gt;
&lt;li&gt;æ˜¯çš„ IaC terraform module ä¹Ÿæ˜¯éœ€è¦å–®å…ƒæ¸¬è©¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;testing&lt;/code&gt; å°±æ˜¯ç”¨ä¾†è®“ IaC åšè‡ªå‹•åŒ–æ¸¬è©¦çš„ç’°å¢ƒï¼Œè£¡é¢çš„ infrastructure éƒ½æ˜¯å¸¸å¸¸ create + destroyï¼Œä¸æœƒæœ‰å¸¸é§çš„æœå‹™&lt;/li&gt;
&lt;li&gt;èˆ‡ &lt;code&gt;sandbox&lt;/code&gt; ä¸åŒçš„æ˜¯
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;testing&lt;/code&gt; æ˜¯è·‘è‡ªå‹•åŒ– CI/CD pipeline çš„æ¸¬è©¦&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sandbox&lt;/code&gt; æ˜¯è®“å·¥ç¨‹å¸«åšè¦æ¨¡è¼ƒå°çš„æ‰‹å‹•æ¸¬è©¦èˆ‡é–‹ç™¼ï¼Œå› ç‚ºæˆ‘å€‘ä¹Ÿä¸å¸Œæœ›ä¸€å †æ¸¬è©¦ç”¨ infrastructure æ•£è½åœ¨ &lt;code&gt;sandbox&lt;/code&gt; è£¡é¢ï¼Œæ„Ÿè¦ºå¾ˆè²´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;logs&lt;/code&gt; ç”¨ä¾†æ”¶é›† log åˆ°å–®ä¸€ account åº•ä¸‹ï¼Œæ–¹ä¾¿æŸ¥é–±&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰ child account çš„ log éƒ½æ”¶åˆ°é€™è£¡ï¼Œè€Œä¸ç”¨è·‘åˆ°å„å€‹ account å»æŸ¥ log&lt;/li&gt;
&lt;li&gt;aws account å…§éƒ¨çš„ logï¼Œcloud trail éƒ½å¯ä»¥é€éå®¢è¨‚èˆ‡å·¥å…·è½‰ç™¼ï¼Œé›†ä¸­æ”¶é›†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå…¬å¸è¦æ¨¡å¾ˆå¤§ï¼Œæœ‰å¤šå€‹ business unit çš„è©±ï¼Œä¹Ÿå¯ä»¥å¤šå»ºå¹¾å€‹ organizationï¼Œä¾†å°æ‡‰å…¬å¸çµ„ç¹”&lt;/p&gt;
&lt;h3 id=&#34;é€é-web-console-switch-role&#34;&gt;é€é web console switch role&lt;/h3&gt;
&lt;p&gt;æˆ‘æ˜¯ä¸€å€‹é–‹ç™¼å·¥ç¨‹å¸«ï¼ˆä¸æ˜¯ adminï¼‰ï¼Œé‚£åœ¨ multi-account ä¸‹çš„ç’°å¢ƒæˆ‘æ‡‰è©²å¦‚ä½•å·¥ä½œï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚ä½•å­˜å– aws&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IAM User å¯ä»¥é€éå¸³è™Ÿå¯†ç¢¼ä¾†å­˜å– aws web consoleï¼Œç™»å…¥ä¹‹å¾Œæœƒç™¼ç¾è‡ªå·±è™•åœ¨ &lt;code&gt;security&lt;/code&gt; account åº•ä¸‹
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡ç™»å…¥çš„è©±éœ€è¦é‡è¨­å¯†ç¢¼ï¼Œéœ€è¦ç¬¦åˆ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/password-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IAM Password Policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æœƒéœ€è¦è¼¸å…¥ MFAï¼Œæœƒéœ€è¦ç¬¦åˆ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/mfa-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IAM MFA Policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å…©é¢çš„å®‰å…¨æ€§ policy åœ¨å¯¦éš›å…¬å¸å¸³è™Ÿè£¡æ˜¯å¿…å‚™ï¼Œä½†åœ¨ workshop ä¸­ï¼Œæˆ‘å€‘é‚„æ²’åšï¼Œå…ˆç•™å€‹å‘ä¹‹å¾Œä¾†è£œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;programatic access å¦‚åŒ &lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10292900&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day03 çš„ root account IAM User æ­¥é©Ÿ&lt;/a&gt;ï¼Œæˆ‘å€‘ä¹Ÿæ˜¯ä½¿ç”¨ aws-vault æ­é… aws access keyï¼Œä¾†è®“ terraform åŸ·è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;web console å¦‚ä½• switch role&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥åœ¨ aws web console -&amp;gt; å³ä¸Šè§’ user -&amp;gt; switch role&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220918/20120327WzL2o9OCng.png&#34; alt=&#34;AWS Console: switch role&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220918/20120327KR6vRGyAxe.png&#34; alt=&#34;AWS Console: switch role&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¡«å…¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®æ¨™ account ID (ex dev: 123456789012)&lt;/li&gt;
&lt;li&gt;ç›®æ¨™çš„ role&lt;/li&gt;
&lt;li&gt;çµ¦è‡ªå·±çœ‹çš„å¥½è¾¨è­˜åç¨±
å¦‚æœ admin æœ‰è¨­å®š IAM role èˆ‡ assume role æ¬Šé™ï¼Œå°±å¯ä»¥åˆ‡æ›åˆ° &lt;code&gt;dev&lt;/code&gt; account ä¸‹çš„ IAM role èº«åˆ†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220918/20120327YSjdG8mJE1.png&#34; alt=&#34;AWS Console: switch role&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;é€é-web-console-switch-role-1&#34;&gt;é€é web console switch role&lt;/h3&gt;
&lt;p&gt;å¦‚åŒ &lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10292900&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day03 ä½¿ç”¨ root account IAM User&lt;/a&gt;ï¼Œæˆ‘å€‘ä¹Ÿæ˜¯ä½¿ç”¨ aws-vault æ­é… aws access keyï¼Œä¾†è®“ terraform åŸ·è¡Œ) ä¾†è·‘ terraform å»ºç«‹ child accounts ä¸€æ¨£ï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦è¨­å®š aws-vaultï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ local æ©Ÿä¸Š assume ä¸åŒ account roleï¼Œä¾†ä½¿ç”¨å„å€‹ child account&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/99designs/aws-vault#roles-and-mfa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws-vault Roles and MFA&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éœ€è¦èª¿æ•´ &lt;code&gt;~/.aws/config&lt;/code&gt; çš„è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;security ç®¡ç†å“¡è¨­å®šå®Œ iam role + assume policy å¾Œï¼Œæœƒæä¾›ç™»å…¥è³‡è¨Šçµ¦å…¶ä»–åœ˜éšŠæˆå“¡&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat ~/.aws/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# é€™æ˜¯ root account IAM User ä¸è¦å†æ‹¿ä¾†ç”¨äº†
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# aws access key æ”¶åœ¨æœ¬æ©Ÿçš„ aws-vault å…§
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[profile terraform-30day-root-iam-user]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;region=ap-northeast-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# é€™æ˜¯ security account (111111111111) IAM Userï¼ˆé‚„æ²’å»ºç«‹ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# aws access key æ”¶åœ¨æœ¬æ©Ÿçš„ aws-vault å…§
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[profile chechia-security-iam-user]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;region=ap-northeast-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# é€™æ˜¯ dev account (333333333333) IAM Roleï¼ˆé‚„æ²’å»ºç«‹ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[profile dev-admin]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;source_profile = chechia-security-iam-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;role_arn = arn:aws:iam::333333333333:role/dev-admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mfa_serial = arn:aws:iam::111111111111:mfa/chechia-security-iam-user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢é€™äº›éƒ½é‚„æ²’å»ºç«‹ï¼Œæ‰€ä»¥éƒ½é‚„ä¸èƒ½ç”¨ï¼Œåªæ˜¯å…ˆèªªä¸€ä¸‹ä¹‹å¾Œè¦æ€éº¼æ“ä½œ&lt;/p&gt;
&lt;p&gt;security ç®¡ç†å“¡è¦è¨­å®šä¸€å¤§å †æ±è¥¿ï¼Œä½†å·¥ç¨‹å¸«ä½¿ç”¨éå¸¸ç°¡å–®ï¼Œåªè¦é€é aws-vault åˆ‡æ›å°±å¯ä»¥åœ¨ä¸åŒ account ä¸‹æ“ä½œ terraform&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec dev-admin -- aws sts get-caller-identity
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;UserId&amp;#34;: &amp;#34;xxxxxxxxxxxxxxxx&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;Account&amp;#34;: &amp;#34;333333333333&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;Arn&amp;#34;: &amp;#34;arn:aws:iam::333333333333:role/dev-admin&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec dev-admin -- terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec stag-admin -- terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h3&gt;
&lt;p&gt;Cloudtrail&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;12 month free-tier æ˜¯å¯ä»¥å…è²»ä½¿ç”¨çš„&lt;/li&gt;
&lt;li&gt;log å­˜æ”¾åœ¨ s3 ä¸Šï¼Œæœƒéœ€è¦æ”¶å– s3 çš„è²»ç”¨ï¼Œ12 month free-tier s3 æ˜¯ 5Gï¼Œæˆ‘å€‘é€™å€‹ workshop ä¸æœƒè¶…é
&lt;ul&gt;
&lt;li&gt;note: terraform state ä¹Ÿæ˜¯æ”¾åœ¨ s3 ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;todo-èˆ‡é€²åº¦&#34;&gt;TODO èˆ‡é€²åº¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šä¸€çµ„ IAM User&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; é€é root account è¨­å®šå¤šå€‹ aws child accounts&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM User
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š password policy&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security è¨­å®š MFA policy&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; security ä¸­è¨­å®š IAM Policy &amp;amp; Group&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; dev ä¸­è¨­å®š IAM role&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; å…è¨± security assume dev IAM role&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Provision Child AWS Accounts</title>
      <link>https://chechia.net/zh-hant/post/2022-09-14-14th-ithome-ironman-iac-aws-workshop-03-provision-aws-account/</link>
      <pubDate>Fri, 16 Sep 2022 17:16:21 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-14-14th-ithome-ironman-iac-aws-workshop-03-provision-aws-account/</guid>
      <description>&lt;p&gt;ä»Šå¤©è¦ä½¿ç”¨ terraform è¨­å®š AWS account structure&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;p&gt;Provision AWS Account&lt;/p&gt;
&lt;p&gt;ä»Šå¤©è¦æŠŠ aws account è¨­å®šå®Œæˆï¼Œä¸¦ä¸”é–‹å§‹ä½¿ç”¨ live-repository ä¾†æ­å»º aws å…ƒä»¶&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;æˆ‘å€‘è‡ªå·±çš„-module-repository&#34;&gt;æˆ‘å€‘è‡ªå·±çš„ module repository&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é–‹ä¸€å€‹æ¬Šé™çš„ repository&lt;/li&gt;
&lt;li&gt;fork æˆ‘è‡ªå¹¹çš„ modules repository terragrunt-infrastructure-modules &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-modules&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸Šé¢é€™å€‹æ˜¯æ”¾ terraform module çš„ repositoryï¼Œæ˜¯å…©å€‹ repository&lt;/li&gt;
&lt;li&gt;ä¸è¦è·ŸåŸ·è¡Œ terragrunt repository ææ··ï¼Œæ˜¯å…©å€‹ repository &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-live-example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»Šå¤©çš„é€²åº¦èˆ‡ code base&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-live-example PR åœ¨æ­¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;terragrunt-infrastructure-modules è«‹ç›´æ¥çœ‹ tag v0.0.1&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºæœ‰åœ°æ–¹åš´é‡å¯«éŒ¯ï¼Œæˆ‘æœ‰ force push æ±è¥¿ :tear:ï¼Œå¦‚æœå·²ç¶“ææ—©ä¸‹è¼‰çš„æœ‹å‹å¯èƒ½æœƒéœ€è¦æ¸…æ‰ repository main branch + tag é‡æ‹‰ orz&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°ï¼Œæˆ‘å€‘ä¸”æˆ°ä¸”èµ°å¸¸å¸¸æœƒé€™æ¨£ï¼Œç™¼ç¾æ˜¨å¤©å¯«çš„æ±è¥¿å¯«éŒ¯è‡¨æ™‚æ”¹ï¼Œè«‹å¤§å®¶è¦‹è«’&lt;/p&gt;
&lt;h3 id=&#34;ç‚ºä½•ä½¿ç”¨-aws-modules&#34;&gt;ç‚ºä½•ä½¿ç”¨ aws modules&lt;/h3&gt;
&lt;p&gt;X) å› ç‚ºæˆ‘å€‘æ²’æœ‰ä»˜éŒ¢ï¼Œä¸èƒ½ç”¨ gruntwork çš„ priviate repository (å¤§èª¤&lt;/p&gt;
&lt;p&gt;O) å› ç‚ºæˆ‘å€‘æƒ³è¦ä½¿ç”¨é–‹æºç‰ˆæœ¬çš„ terraform module (XD)&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å¿«é€Ÿçœ‹ä¸€ä¸‹ module è£¡é¢çš„å…§å®¹
&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules/tree/v0.0.1/aws/modules/account-baseline-root&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-modules/tree/v0.0.1/aws/modules/account-baseline-root&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;resource &amp;#34;aws_organizations_organization&amp;#34; &amp;#34;org&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  aws_service_access_principals = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;cloudtrail.amazonaws.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;config.amazonaws.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  feature_set = &amp;#34;ALL&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  for_each = var.child_accounts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name  = each.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  email = each.value[&amp;#34;email&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  depends_on = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    aws_organizations_organization.org
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å€‘çš„éœ€æ±‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ root account ä¸‹ provision ä¸€å€‹ aws organization
&lt;ul&gt;
&lt;li&gt;ç‚ºæ¯å€‹ç’°å¢ƒ provision ä¸€å€‹ aws organization account&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ terraform &lt;code&gt;for_each&lt;/code&gt; function ä¾†è¿­ä»£ variabel å‚³å…¥çš„ organization accounts (å‹åˆ¥æ˜¯ map)&lt;/li&gt;
&lt;li&gt;each.key æœƒæ‹¿åˆ°æ¯å€‹ map element çš„ keyï¼Œä¾‹å¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  child_accounts = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    logs = {},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    security = {},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    shared = {},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    dev = {},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    stage = {},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    prod = {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;è·‘å‡ºä¾† each.key å°±æœƒæ˜¯ [logs, security, shared, dev, stage, prod] æ­£å¥½æ˜¯æˆ‘å€‘é€™æ¬¡éœ€è¦ provision çš„å…­å€‹ aws organization accountsï¼Œæ»¿è¶³ç›®å‰çš„éœ€æ±‚&lt;/li&gt;
&lt;li&gt;each.value[&amp;ldquo;email&amp;rdquo;] å‰‡ä¾åºå¸¶å…¥å„è‡ªçš„ email åˆ° account ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NOTE: é€™äº› email è«‹ä½¿ç”¨ä½ æ”¶å¾—åˆ°çš„ email&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ç¾å¯¦ä¸­é€™æœƒæ˜¯å…­çµ„ä¸åŒçš„ emailï¼Œemail é‡è¤‡çš„è©±æœƒè¢« aws api rejectï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸åŒçš„ email
&lt;ul&gt;
&lt;li&gt;æˆ–æ˜¯è·Ÿ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/configure-the-security-baseline-for-the-root-account&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gruntwork guide&lt;/a&gt; ä¸€æ¨£ï¼Œä½¿ç”¨ gmail å¸³è™Ÿå¾Œ+ çš„å­—å…ƒæœƒ ignore&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœè¨­å®šäº†æ”¶ä¸åˆ°ä¿¡çš„ email ä½œç‚º account email å°±æœƒæœ‰é»éº»ç…©&lt;/li&gt;
&lt;li&gt;ä¸è¦åƒæˆ‘ä¸€æ¨£è¨­äº† 6 å€‹æ”¶ä¸åˆ° emailï¼Œåªå¥½å†å¤šé–‹ä¸€å€‹ account XDï¼Œé‚„å¥½æˆ‘å€‘æ˜¯åœ¨ workshop&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™å€‹ terraform module çš„å¯«æ³•å®Œå…¨å¿½ç•¥å…¶ä»– each.value å…§çš„å€¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘ä¸¦ä¸æ¸…æ¥š gruntwork åœ¨ private çš„ terraform module ä¸­ï¼Œé®äº›åƒæ•¸çš„ç¢ºåˆ‡ç”¨é€”ï¼Œä»¥åŠå° aws organization account è¨­å®šæœ‰ä½•å½±éŸ¿&lt;/li&gt;
&lt;li&gt;ä½†ä»¥ç­†è€…ä½¿ç”¨ aws çš„ç¶“é©—ï¼Œå¤§æ¦‚çŒœå¾—å‡ºä¾†é€™äº›åƒæ•¸çš„ç”¨é€”ï¼Œä»¥åŠ terraform module æ‡‰è©²å¦‚ä½•èª¿æ•´ï¼Œç‚ºäº†èª²ç¨‹é€²åº¦å®‰æ’ï¼Œæˆ‘å€‘å…ˆæš«æ™‚å¿½ç•¥ã€‚ç¹¼çºŒç…§è‘— gruntwork çš„æ–‡ä»¶åšä¸‹å»ï¼Œä¹‹å¾Œæœ‰ç”¨åˆ°å†ä¾†è£œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;terragrunt-plan--apply&#34;&gt;Terragrunt Plan &amp;amp; apply&lt;/h3&gt;
&lt;p&gt;åœ¨è·‘ terragrunt ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆè¦åˆ‡æ›æˆ root account çš„ iam Userï¼Œæ˜¨å¤©æ–°å»ºçš„ IAM Userï¼Œå­˜æ”¾åœ¨å¯†ç¢¼ä¼ç†ï¼Œé‚„è¨˜å¾—å—ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ aws-vault æ‹¿ IAM User çš„ access key åš programatic ç™»å…¥ï¼Œæä¾› terraform credentialã€‚è€Œéé€é aws web console&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¨˜ä½ï¼šæˆ‘å€‘ä¸èƒ½ç”¨ root account åšé€™äº›å·¥ä½œ&lt;/p&gt;
&lt;h3 id=&#34;aws-vault&#34;&gt;aws-vault&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼æˆ‘å€‘ç¾åœ¨è¦ä½¿ç”¨ IAM User åš terraform ä¾†å‰µå»ºæ–°çš„ child accountsï¼Œæœªä¾†æœƒä½¿ç”¨æ–°çš„ child accounts ä¾†åšå„å€‹ç’°å¢ƒä¸­çš„ terraform å…ƒä»¶æ“ä½œï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹å·¥å…·ä¾†å”åŠ©åˆ‡æ›é€™äº› account&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä½¿ç”¨çš„å·¥å…·æ˜¯ aws-vault&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/99designs/aws-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/99designs/aws-vault&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ”¯æ´å¾ˆå¤šå®‰è£å¹³å°ï¼Œé¸è‡ªå·±å–œæ­¡ç”¨çš„ï¼Œæˆ–æ˜¯ç›´æ¥åœ¨ github release é é¢ä¸‹è¼‰ binary&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ aws-vault --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;usage: aws-vault [&amp;lt;flags&amp;gt;] &amp;lt;command&amp;gt; [&amp;lt;args&amp;gt; ...]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;A vault for securely storing and accessing AWS credentials in development environments.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ Root Account IAM User èº«ä»½åŸ·è¡Œ terragrunt&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ©Ÿç´€éŒ„ access key (è«‹å¥½å¥½ä¿è­·æœ¬æ©Ÿçš„å®‰å…¨)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault add terraform-30day-root-iam-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter Access Key Id: XXXXXXXXXXXX
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter Secret Key: YYYYYYYYYYYY
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€é aws-cli å–å¾— caller identityï¼Œä¹Ÿå°±æ˜¯ç¾åœ¨çš„èº«ä»½æ˜¯èª°ï¼Œç¢ºå®šæ˜¯ Administrator&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¾ aws çš„è§’åº¦ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯ IAM User: Administrator æ“ä½œçš„&lt;/li&gt;
&lt;li&gt;åªèƒ½æ“ä½œç•¶åˆå»ºç«‹ IAM User æ™‚ attach çš„æ¬Šé™ï¼ˆè˜‡ç„¶ä¹Ÿæ˜¯å¾ˆå¤§ï¼‰ä½†å·²ç¶“æ¯” root account å°å¾ˆå¤š
&lt;ul&gt;
&lt;li&gt;ä¹‹å¾Œæˆ‘å€‘æœƒé€²ä¸€æ­¥é™ç¸®æ¯ä¸€å€‹ IAM User çš„ permission&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user -- aws sts get-caller-identity
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;UserId&amp;#34;: &amp;#34;AIDAxxxxxxxxxxxKGW&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;Account&amp;#34;: &amp;#34;706136188012&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;Arn&amp;#34;: &amp;#34;arn:aws:iam::706136188012:user/Administrator&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œé€é aws-vault ä¾†åŸ·è¡Œ terraguntï¼Œé€™æ¨£ terragrunt å°±æœƒä½¿ç”¨ IAM User çš„ credential ä¾†æ“ä½œ provider å»å‘¼å« aws api&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user -- terragrunt init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user -- terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Terraform will perform the following actions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_organizations_account.account[&amp;#34;dev&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;terraform30days@outlook.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;dev&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_organizations_account.account[&amp;#34;logs&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;terraform30days@outlook.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;logs&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_organizations_account.account[&amp;#34;prod&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;terraform30days@outlook.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;prod&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_organizations_account.account[&amp;#34;security&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;terraform30days@outlook.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;security&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_organizations_account.account[&amp;#34;shared&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;terraform30days@outlook.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;shared&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # aws_organizations_account.account[&amp;#34;stage&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;terraform30days@outlook.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;stage&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # aws_organizations_account.account[&amp;#34;prod&amp;#34;] will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    + resource &amp;#34;aws_organizations_account&amp;#34; &amp;#34;account&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn               = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + close_on_deletion = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + create_govcloud   = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + email             = &amp;#34;chechiachang999+terraform-test@gmail.com&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + govcloud_id       = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_method     = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + joined_timestamp  = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + name              = &amp;#34;prod&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + parent_id         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + status            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + tags_all          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # aws_organizations_organization.org will be created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    + resource &amp;#34;aws_organizations_organization&amp;#34; &amp;#34;org&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + accounts                      = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + arn                           = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + aws_service_access_principals = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          + &amp;#34;cloudtrail.amazonaws.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          + &amp;#34;config.amazonaws.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + feature_set                   = &amp;#34;ALL&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + id                            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + master_account_arn            = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + master_account_email          = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + master_account_id             = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + non_master_accounts           = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      + roots                         = (known after apply)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Plan: 8 to add, 0 to change, 0 to destroy.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Terragrunt plan å¾Œç”¢ç”Ÿ terraform planï¼Œæˆ‘å€‘è¦ä»”ç´° review&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0 change / 0 deleteï¼Œé€™é‚Šå¾ˆé‡è¦ï¼Œç¢ºå®šæˆ‘å€‘ä¸æœƒæ”¹éŒ¯æˆ–æ˜¯èª¤åˆªå·²ç¶“å­˜åœ¨çš„ aws å…ƒä»¶&lt;/li&gt;
&lt;li&gt;7 to addï¼Œæ–°å¢äº† 7 å€‹ aws å…ƒä»¶
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹ aws_organization&lt;/li&gt;
&lt;li&gt;å…­å€‹ aws_organization_accountï¼Œå°æ‡‰æœªä¾†çš„å…­å€‹ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;ä¸€å€‹ aws_organization_accountï¼Œå› ç‚ºä¸Šé¢ email è¨­éŒ¯å¡ä½ï¼Œè€Œå¤šé–‹ä¸€å€‹ test ç’°å¢ƒXD&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;review æ²’å•é¡Œå¾Œï¼Œæˆ‘å€‘é€²è¡Œ apply&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user -- terragrunt apply
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;logs&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;stage&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;prod&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;security&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;dev&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;shared&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;prod&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;logs&amp;#34;]: Creating...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;logs&amp;#34;]: Still creating... [10s elapsed]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;prod&amp;#34;]: Still creating... [10s elapsed]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;logs&amp;#34;]: Creation complete after 14s [id=557659608246]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws_organizations_account.account[&amp;#34;prod&amp;#34;]: Creation complete after 14s [id=420896464212]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‰µå»ºå®Œæˆ organization èˆ‡ organization accounts å¾Œï¼Œæˆ‘å€‘å¯ä»¥é€²è¡Œæª¢æŸ¥&lt;/p&gt;
&lt;p&gt;åˆ° aws console -&amp;gt; organization é é¢ï¼Œå¯ä»¥çœ‹åˆ°æ–°å»ºçš„ organization èˆ‡ accounts&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220917/20120327PXmDKamKOs.png&#34; alt=&#34;AWS Organization &amp;amp;amp; Accounts&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ aws-cli åˆ—å‡º organization çš„ accounts&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aws-vault exec terraform-30day-root-iam-user --no-session  -- aws organizations list-accounts
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-external-module-äºŒä¸‰äº‹&#34;&gt;ä½¿ç”¨ external module äºŒä¸‰äº‹&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨é–‹æºçš„ terraform module ä¹Ÿæ˜¯æœ‰å¾ˆå¤šå¥½è™•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæˆ‘å€‘ä½¿ç”¨çš„æ˜¯ aws ç¶­è­·çš„ terraform moduleï¼Œå¦‚æœ aws api æœ‰æ›´æ–°é€šå¸¸éƒ½è·Ÿå¾—å¾ˆå¿«&lt;/li&gt;
&lt;li&gt;é–‹æº module æœƒæœ‰å¤§é‡çš„ç¤¾ç¾¤å¹«å¿™ç™¼ issue è¨è«–èˆ‡ PR review&lt;/li&gt;
&lt;li&gt;é‡åˆ°å•é¡Œå¯ä»¥ç›´æ¥é–‹ issue å•
gruntwork enterprise çš„ module æ˜¯ enterprise ç­‰ç´šçš„è§£æ±ºæ–¹æ¡ˆï¼Œæœ‰ç›¸ç•¶çš„ code å“è³ªï¼Œä½†åœ¨ä¸Šé¢å¹¾é»è‡ªç„¶æ˜¯ä¸å¦‚é–‹æº repository&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é †ä¾¿æä¸€ä¸‹ï¼Œå¦‚æœä¹‹å¾Œè¦è‡ªå·±å‹•æ‰‹å¯«å…¶ä»–å…ƒä»¶ï¼Œæ‡‰è©²å¦‚ä½•æ‰¾åˆ°é©åˆçš„ external terraform module?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰éœ€è¦å°å…¥å…¶ä»–å…¬æœ‰é›²çš„å…ƒä»¶ (ex. azure / gcp / &amp;hellip;)ï¼Œå¯ä»¥åœ¨ &lt;a href=&#34;https://registry.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;registry.terraform.io&lt;/a&gt; ä¸Šé¢æœå°‹æ‰¾åˆ°&lt;/li&gt;
&lt;li&gt;é€šå¸¸æ¯”è¼ƒå¤§é–“çš„ Cloud provider ç‚ºäº†æ–¹ä¾¿ä½¿ç”¨è€…ï¼Œéƒ½æœƒç¶­è­·è‡ªå®¶ç”¢å“çš„ terraform moduleï¼Œæ–¹ä¾¿ä½¿ç”¨é€™ç›´æ¥ä½¿ç”¨ IaC çš„æ–¹å¼å°å…¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è‡ªå·±å®¶æ¨å‡ºçš„ terraform module
&lt;ul&gt;
&lt;li&gt;å› ç‚º aws æœ€ç†Ÿæ‚‰è‡ªå·±å®¶çš„å…ƒä»¶ï¼Œæ¯”è¼ƒä¸æœƒå‡º bug&lt;/li&gt;
&lt;li&gt;é‡åˆ°å•é¡Œå¯ä»¥ç›´æ¥ç™¼ issue è®“ aws çš„å·¥ç¨‹å¸«ä¾†çœ‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;a href=&#34;https://registry.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;registry.terraform.io&lt;/a&gt; ä¸Šï¼ŒæŸå€‹å…ƒä»¶æ‰¾ä¸åˆ°è‡ªå·±å…¬å¸å‡ºçš„ terraform moduleï¼Œé‚£å¯èƒ½å°±è¦æ‰¾çœ‹çœ‹ç¤¾ç¾¤ç‰ˆæœ¬çš„&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;a href=&#34;https://registry.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;registry.terraform.io&lt;/a&gt; ä¸Šæœå°‹ä¸åˆ°ï¼Œå¯ä»¥ä¸Š Github æœå°‹ &amp;ldquo;terraform + å…ƒä»¶åç¨±&amp;rdquo; å¯èƒ½æ‰¾åˆ°æ²’æœ‰æ”¶éŒ„åœ¨ registry çš„ terraform moduleã€‚æˆ–æ˜¯ç›´æ¥ googleï¼Œå¶çˆ¾ä¹Ÿæœƒæœ‰æ„å¤–æ”¶ç©«
&lt;ul&gt;
&lt;li&gt;æ²’æœ‰ terraform official validated module å°±è¦ç‰¹åˆ¥æ³¨æ„å®‰å…¨æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€å€‹å¥½çš„ terraform module é€šå¸¸æœ‰å¹¾å€‹ç‰¹å¾µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰è‰¯å¥½çš„æ›´æ–°ç´€éŒ„åœ¨ commit history ä¸­&lt;/li&gt;
&lt;li&gt;æœ‰æ´»èºçš„ç¤¾ç¾¤ ç™¼ issue è¨è«– / PR / review&lt;/li&gt;
&lt;li&gt;æœ‰å®Œæ•´çš„ changelog ç´€éŒ„è®Šæ›´å¦‚ä½•æ™‚å‡ç‰ˆï¼Œä¹Ÿæ–¹ä¾¿è®“ä½¿ç”¨è€…å‡ç‰ˆæ™‚æª¢æŸ¥&lt;/li&gt;
&lt;li&gt;æ™‚å¸¸æ›´æ–°ï¼Œèƒ½å¤ ç¬¦åˆæ–°ç‰ˆçš„ terraform core version è¦æ ¼&lt;/li&gt;
&lt;li&gt;æœƒé–å®š dependency ç‰ˆæœ¬ï¼Œex. terraform core version èˆ‡ä¾è³´çš„ provider version
åä¹‹ï¼Œå¦‚æœç™¼ç¾ä¸€å€‹ terraform module å¹´ä¹…å¤±ä¿®ï¼Œå¾ˆå°‘äººè¨è«–ï¼Œä¹Ÿæ²’æœ‰è·Ÿä¸Š terraform core ç‰ˆæœ¬ (ex. ä¸æ”¯æ´ 1.x) å¯èƒ½å°±è¦è€ƒæ…®ä¸€ä¸‹æ˜¯å¦è¦ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½¿ç”¨å¤–éƒ¨-module-æ‡‰è©²æ³¨æ„çš„äº‹æƒ…&#34;&gt;ä½¿ç”¨å¤–éƒ¨ module æ‡‰è©²æ³¨æ„çš„äº‹æƒ…&lt;/h3&gt;
&lt;p&gt;æœ‰æ™‚å€™æŸäº›å¤–éƒ¨ module æœƒæœ‰é›·ï¼Œå°è‡´æˆ‘å€‘å»å¼•ç”¨æ™‚å‡ºç¾éŒ¯èª¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ”¹å·²ç¶“å­˜åœ¨çš„ tag / ç«„æ”¹ commit history / &amp;hellip; ç­‰&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯ repository ç§»é™¤è®Šä¸è¦‹ / æ”¹å / æ”¹ url&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç‚ºäº†é¿å…æˆ‘å€‘åŸæœ¬å¥½å¥½çš„ terraform code å—åˆ°å½±éŸ¿ï¼Œå¦‚æœæœ‰ä½¿ç”¨å¤–éƒ¨ moduleï¼Œæˆ‘å€‘å¯ä»¥å…ˆ fork ä¸€ä»½å¤–éƒ¨ module åˆ° internal repository (clone ä¸€ä»½å† push åˆ°è‡ªå®¶çš„ cvs ä¸Šé¢ï¼‰ï¼Œç„¶å¾ŒæŠŠ source url æ”¹æˆ fork internal repository&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚æœ¬ä¾†æ˜¯ &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/chechiachang/terragrunt-infrastructure-modules&lt;/a&gt; fork (clone &amp;amp; push) è®Šæˆ chechia.bitbucket.com/chechia/terragrunt-infrastructure-modules&lt;/li&gt;
&lt;li&gt;source url ä¸­ä½¿ç”¨ git tag referenceï¼Œæ˜ç¢ºæŒ‡å®š internal module (ä¸ç”¨ github.com è€Œç”¨ chechia.bitchecket)&lt;/li&gt;
&lt;li&gt;éœ€è¦æ›´æ–°æ™‚ï¼Œåœ¨å¾ github ä¸Š pull æœ€æ–°çš„ codeï¼Œpush åˆ° bitbucket ä¸Šï¼Œä¿®æ”¹ source url å°±å®Œæˆå‡ç‰ˆ
é€™æ¨£å¯ä»¥å°‡å° external module çš„ä¾è³´è½‰ä¹˜ loose couplingï¼Œé™ä½è€¦åˆç¨‹åº¦ï¼Œå¦‚æœ external module æ•´å€‹å£æ‰ï¼Œæˆ‘å€‘çš„ terraform module ä½¿ç”¨ä¸å—å½±éŸ¿ã€‚ä½†åˆèƒ½ trace åŸå…ˆçš„ external module remoteï¼Œæ–¹ä¾¿æ¥æ”¶æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºé»æ˜¯æœƒèŠ±ä¸€äº›äººåŠ›æ•´ç†é€™äº› forked module repositories&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ external module ä¹Ÿè¦æ³¨æ„è³‡è¨Šå®‰å…¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¦å°å¿ƒä¾†è·¯ä¸æ˜çš„ terraform moduleï¼Œterraform module å¯ä»¥å–å¾—å¾ˆå¤šé ç«¯çš„ç§å¯†è¨Šæ¯ï¼Œå¯èƒ½æœƒæœ‰å®‰ç¾¤æ€§çš„éš±æ†‚&lt;/li&gt;
&lt;li&gt;æ²’æœ‰ terraform validated çš„ terraform moduleï¼Œä½¿ç”¨å‰è‡ªå·±è¦çœ‹éå…§å®¹&lt;/li&gt;
&lt;li&gt;çœ‹åˆ°ä½¿ç”¨ä¸ç†Ÿæ‚‰çš„ terraform providerï¼Œä¹Ÿæ‡‰è©²å»æª¢æŸ¥ provider çš„å‡ºè™•èˆ‡å…§å®¹
é¿å…ç”¨è‡ªå·±çš„ aws account èº«ä»½åŸ·è¡Œå¾Œï¼Œç™¼ç¾è¢«å·åŸ‹æ±è¥¿ï¼Œæˆ–æ˜¯è³‡æ–™æ´©æ¼å‡ºå»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœç™¼ç¾è‡ªå·±ä½¿ç”¨çš„å…ƒä»¶æ¯”è¼ƒå†·é–€ï¼Œç¬¦åˆè‡ªå·±éœ€æ±‚çš„ external module ä¹Ÿå¹´ä¹…å¤±ä¿®ï¼Œä¹Ÿå¯ä»¥è€ƒæ…® hard fork ä¸€ç‰ˆï¼Œç”±åœ˜éšŠè‡ªå·±ç¶­è­·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥åƒè€ƒç¾æœ‰çš„æ¶æ§‹èˆ‡å…§å®¹ï¼Œæ ¹æ“šå…§éƒ¨çš„éœ€æ±‚å»ä¿®æ”¹ terraform moduleï¼Œæœ€å¾Œåœ¨è‡ªå·±å¼•ç”¨&lt;/li&gt;
&lt;li&gt;å…§éƒ¨ç¶­è­·ï¼Œè‡ªå·±æ§åˆ¶å‡ç‰ˆèˆ‡ç™¼ä½ˆ&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸æ˜¯å¤ªè¤‡é›œçš„ module å…¶å¯¦å¯ä»¥åš&lt;/li&gt;
&lt;li&gt;åšå®Œè¨˜å¾—ç”¨å®‰å…¨æ€§å·¥å…·æª¢æŸ¥ï¼Œç¢ºä¿æ²’æœ‰å®‰å…¨éš±æ†‚ï¼ˆé€™å€‹æˆ‘å€‘ç¨å¾Œå¹¾å¤©çš„å…§å®¹æœƒæï¼‰&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>AWS Account Struture</title>
      <link>https://chechia.net/zh-hant/post/2022-09-13-14th-ithome-ironman-iac-aws-workshop-02-aws-account-structure/</link>
      <pubDate>Thu, 15 Sep 2022 17:16:21 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-13-14th-ithome-ironman-iac-aws-workshop-02-aws-account-structure/</guid>
      <description>&lt;p&gt;ä»Šå¤©è¦ä½¿ç”¨ terraform è¨­å®š AWS account structure&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;h1 id=&#34;aws-account-structure&#34;&gt;AWS Account structure&lt;/h1&gt;
&lt;p&gt;AWS account structure æ˜¯ AWS IAM æä¾›çš„ feature ä¹‹ä¸€ï¼Œå¯ä»¥è®“ç”¨æˆ¶å¾ä¸€å€‹ account loginï¼Œç„¶å¾Œé€éæˆæ¬Šæ“ä½œå…¶ä»– account çš„å…ƒä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œæœ‰é€™å€‹ feature ä¸ä»£è¡¨ç”¨æˆ¶å°±è¦è²·å–®ï¼Œæœ‰å¯¦éš›éœ€æ±‚æˆ‘å€‘æ‰ä¾†ç”¨ featureã€‚ä½¿ç”¨ account structure çš„ç†ç”±æ˜¯ä»€éº¼ï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;account-structure-çš„éœ€æ±‚&#34;&gt;Account structure çš„éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/whitepapers/latest/organizing-your-aws-environment/benefits-of-using-multiple-aws-accounts.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS å®˜æ–¹ whitepaper: ä½¿ç”¨ multiple aws account çš„å¥½è™•&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾æ“šè·å‹™éœ€æ±‚å°‡ workload åˆ†çµ„&lt;/li&gt;
&lt;li&gt;ç‚ºä¸åŒ environment è¨­å®šç¨ç«‹çš„ security control&lt;/li&gt;
&lt;li&gt;é™åˆ¶æ•æ„Ÿè³‡æ–™çš„å­˜å–&lt;/li&gt;
&lt;li&gt;æå‡å‰µæ–°èˆ‡é–‹ç™¼çš„æ•æ·&lt;/li&gt;
&lt;li&gt;æ§åˆ¶äº‹æ•…çš„å½±éŸ¿ç¨‹åº¦èˆ‡è¡æ“Š impact&lt;/li&gt;
&lt;li&gt;ç²¾ç´°çš„æ‹†åˆ† IT çš„å·¥ä½œ&lt;/li&gt;
&lt;li&gt;æˆæœ¬æ§ç®¡&lt;/li&gt;
&lt;li&gt;åˆ†æ•£ aws quotas ä½¿ç”¨é™é¡èˆ‡ API rate limit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/organizations/getting-started/best-practices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS å®˜æ–¹çš„ organization best practice&lt;/a&gt;
&lt;a href=&#34;https://aws.amazon.com/blogs/mt/best-practices-for-organizational-units-with-aws-organizations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS å®˜æ–¹ OU ç®¡ç†çš„ best practice&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/core-concepts/what-is-an-aws-account-structure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork Doc å»ºè­°çš„ IaC best practice ä¸­çš„ aws account structure&lt;/a&gt;ï¼Œæåˆ°ä¸‰å€‹ä¸»è¦çš„ç›®çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Isolation (AKA compartmentalization)
&lt;ul&gt;
&lt;li&gt;ä¸åŒç’°å¢ƒï¼Œäº‹æ•…ç™¼ç”Ÿæ™‚ï¼Œå½±éŸ¿ç¯„åœä¸æœƒå¤ªå¤§ (ex. å·¥ç¨‹å¸« terraform èª¤åˆª infra)&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§ï¼Œdev / stag æœ‰å®‰å…¨æ€§æ¼æ´æ™‚ï¼Œattacker ä¸æœƒæ”»æ“Šåˆ° prod ç’°å¢ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Authentication and authorization
&lt;ul&gt;
&lt;li&gt;æŠŠ user éƒ½æ”¾åœ¨ä¸€èµ·ç®¡ç†ï¼Œé€éæ›´ç²¾ç´°çš„ access control å»æ§åˆ¶å…¶ä»– account å…§éƒ¨çš„å…ƒä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Auditing and reporting
&lt;ul&gt;
&lt;li&gt;ä¾æ“šç’°å¢ƒèˆ‡ç”¨é€”æ‹†åˆ† accountï¼Œè®“ç›£æ¸¬èˆ‡æˆæœ¬æ§åˆ¶æ›´ç²¾ç´°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾å¯¦å‹™ä¸Šçš„ç¶“é©—ï¼Œæœ‰ä»¥ä¸‹ç‹€æ³å°±è€ƒæ…®è¦æ‹†åˆ† aws account&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ IT éƒ¨é–€å¾ˆå¤§äººæ•¸å¾ˆå¤šï¼Œé‚£å°‡æ‰€æœ‰å·¥ä½œå…§å®¹ä¸åŒçš„ user éƒ½æ”¾åœ¨åŒä¸€å€‹ aws account ä¸‹å°è‡´ç®¡ç†éº»ç…©&lt;/li&gt;
&lt;li&gt;å¤§å¤šæ•¸çš„ incident éƒ½æ˜¯å·¥ç¨‹å¸« change é€ æˆçš„ï¼Œæ‹†åˆ† dev / stag çš„ change æ›¾ç¶“å½±éŸ¿åˆ° prod&lt;/li&gt;
&lt;li&gt;ä¸åŒåœ˜éšŠå°æ–¼è² è²¬çš„å…ƒä»¶ç¯„åœå€åˆ†ä¸æ¸…
&lt;ul&gt;
&lt;li&gt;å·¥ä½œæ‰çƒï¼Œè©²åšçš„äº‹æ²’äººè™•ç†&lt;/li&gt;
&lt;li&gt;å·¥ä½œé‡åŠŸï¼Œåšäº†ä¸€æ¨£çš„äº‹æƒ…å°è‡´è¡çª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å°æ•…äº‹æŠ€è¡“å•é¡Œè§£æ±ºäººç‚ºå•é¡Œ&#34;&gt;å°æ•…äº‹ï¼šæŠ€è¡“å•é¡Œè§£æ±ºäººç‚ºå•é¡Œï¼ˆï¼Ÿï¼‰&lt;/h1&gt;
&lt;p&gt;iThome DevOpsDay æœ‰ä¸€å€‹è½çœ¾è½å®Œ&lt;a href=&#34;pfbid0DqcJsjuULbQ4KT7S9FQ312AJNuCtMoEZEnNcy8LFHd7ELfbSuUw8SHXCCzB2hpQxl&#34;&gt;2022 DevOpsDay PaC for IaC æ¼”è¬›&lt;/a&gt; å¾Œè·‘ä¾†æ‰¾æˆ‘ï¼Œä»–å•èªªï¼š
è¬›å¸«ä½ å¥½ï¼Œæˆ‘å€‘ terraform å¸¸å¸¸èª¤åˆªæ±è¥¿ï¼Œdeploy dev / stag çµæœ prod å£æ‰ï¼ˆæ±—
å¦‚æœä¸æ˜¯æŠ€è¡“çš„å•é¡Œï¼Œæ˜¯äººçš„å•é¡Œï¼Œä¸çŸ¥é“æœ‰æ²’æœ‰æ–¹æ³•è§£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¦æ²»æœ¬é‚„æ˜¯è¦åŠ å¼·å…§éƒ¨æ•™è‚²è¨“ç·´ï¼Œå¾ˆåŸºç¤çš„é‡å¤§éŒ¯èª¤æ˜¯å¾ˆé›£ç”¨æŠ€è¡“æ“‹çš„
ä½†çŸ­æœŸè¦æ²»æ¨™ï¼Œå¯ä»¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå€éš” dev stag èˆ‡ prod çš„ terraform repo è·Ÿ aws account&lt;/li&gt;
&lt;li&gt;æŠŠ prod æ¬Šé™é–èµ·ä¾†ï¼Œå…ˆä¸è¦è®“ junior çš„æˆå“¡å»è§¸ç¢°&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ prod apply éƒ½è¦å…©åˆ°ä¸‰å€‹ senior å» approve&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹Ÿè¨±ä½ å€‘çš„ç”Ÿæ´»æœƒå¿«æ¨‚ä¸€é»(å¥½è¡€æ·š)&lt;/p&gt;
&lt;h1 id=&#34;workshop&#34;&gt;workshop&lt;/h1&gt;
&lt;p&gt;æˆ‘å€‘æœƒæ ¹æ“š &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/pre-requisites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork Landing Zone Guide&lt;/a&gt; çš„æ–‡å­—æ•˜è¿°ä¾†é€²è¡Œä»Šå¤©çš„ workshop&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CAUTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You must be a Gruntwork subscriber to access the Gruntwork Infrastructure as Code Library.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯çš„ï¼Œé€™ä»½ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/pre-requisites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork Landing Zone Guide&lt;/a&gt; å…§éƒ¨çš„ç¯„ä¾‹æœ‰ä½¿ç”¨è¨±å¤š gruntwork-io çš„ private repositoryï¼Œé€™éƒ¨åˆ†æ˜¯éœ€è¦ä»˜è²»ã€‚gruntwork subscription ä¸€å€‹æœˆ $795 èµ·è·³ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥åƒè€ƒ &lt;a href=&#34;https://gruntwork.io/checkout&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork subscription checkout&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™ç¯‡ workshop ä¸¦ä¸ä½¿ç”¨ Gruntwork çš„ä»˜è²»åŠŸèƒ½ï¼Œæ‰€æœ‰ private repository æˆ‘å€‘å°±æœƒä½¿ç”¨å…¶ä»–é–‹æºçš„ modules ä¾†æ›¿ä»£ï¼Œä¾‹å¦‚ä½¿ç”¨ &lt;a href=&#34;https://github.com/terraform-aws-modules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aws + terraform team å®˜æ–¹ç¶­è­·çš„ aws modules&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç”±æ–¼ç¼ºå°‘éƒ¨åˆ† repository çš„å…§å®¹ï¼Œé€™ä»½ &lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/pre-requisites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork Landing Zone Guide&lt;/a&gt; æœƒå¸¸å¸¸çœ‹åˆ°å¾ˆå¤š github external link æ˜¯ 404 not foundï¼Œè¡¨ç¤ºæ˜¯ private repositoryã€‚çœ‹èµ·ä¾†æœƒæœ‰é»ä¸èˆ’æœï¼Œä½†æ²’é—œä¿‚æˆ‘å€‘å°±è¦‹æ‹›æ‹†æ‹›è‡ªç”±ç™¼æ®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å»ºç«‹-workspace-repository&#34;&gt;å»ºç«‹ workspace repository&lt;/h3&gt;
&lt;p&gt;repository çš„å…§å®¹å¯ä»¥&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/prepare-your-infrastructure-live-repository&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›´æ¥åƒç…§ Gruntwork Guide çš„å…§å®¹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡ workshop æˆ‘å€‘ä½¿ç”¨çš„ repository &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-live-example&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;terragrunt éƒ½æœƒåœ¨é€™å€‹ repository è£¡é¢é‹ä½œ&lt;/li&gt;
&lt;li&gt;å„ä½å¯ä»¥ç›´æ¥ copy ä¾†æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;root-account&#34;&gt;Root account&lt;/h3&gt;
&lt;p&gt;root account æ˜¯æ•´å€‹ account structure æœ€ä¸Šå±¤çš„ accountï¼Œå‰µä¸– accountã€‚ç”±æ–¼æ˜¯å‰µä¸– accountï¼Œæ¬Šé™ä¹Ÿæ˜¯æœ€å¤§ï¼Œå› æ­¤&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/lock-down-the-root-user&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœƒéœ€è¦åŠ ä¸Šè¨±å¤šé™åˆ¶&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨é«˜å¼·åº¦çš„å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¯†ç¢¼å„²å­˜å™¨ä¿ç®¡å¯†ç¢¼ï¼Œex 1password / lastpass / &amp;hellip;ï¼Œé€™äº›å¯†ç¢¼å„²å­˜å™¨éƒ½æœ‰è‡ªå‹•åŠ å¯†ï¼Œä¸”æœ‰é€šéå®‰å…¨é¢¨éšªæ¸¬è©¦
&lt;ul&gt;
&lt;li&gt;ä¸è¦å­˜åœ¨é›»è…¦ä¸Š / email / google drive / ç´™ä¸Š / æˆ–æ˜¯å…¶ä»–æ²’æœ‰ç¶“éå®‰å…¨é©—è­‰å·¥å…·ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å‹™å¿…é–‹å•Ÿ MFA&lt;/li&gt;
&lt;li&gt;åˆªé™¤ root account çš„ aws access keyï¼Œåªå…è¨±é€é aws web console å­˜å–&lt;/li&gt;
&lt;li&gt;è‡ªå·±å†ä¹Ÿä¸è¦ä½¿ç”¨é€™å€‹å¸³è™Ÿï¼Œé™ä½æ´©æ¼çš„é¢¨éšª
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/general/latest/gr/aws_tasks-that-require-root.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS å®˜æ–¹å»ºè­°ï¼Œåªæœ‰é€™äº›å·¥ä½œéœ€è¦ä½¿ç”¨ root account&lt;/a&gt; ï¼Œå…¶ä»–å·¥ä½œéƒ½ä¸æ‡‰è©²ä½¿ç”¨ root account&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;root-account-iam-user&#34;&gt;Root Account IAM user&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘ä½¿ç”¨ root account çš„æœ€å¾Œä¸€ä»¶å·¥ä½œï¼Œå°±æ˜¯å»ºç«‹ä¸€å€‹ IAM User ä½œç‚º adminï¼Œä¹‹å¾Œä½¿ç”¨é€™å€‹ IAM User æ“ä½œã€‚&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/create-an-iam-user-in-the-root-account&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶èˆ‡æ­¥é©Ÿåœ¨æ­¤&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Name: Administrator&lt;/li&gt;
&lt;li&gt;å‹¾é¸:
&lt;ul&gt;
&lt;li&gt;programmatic access&lt;/li&gt;
&lt;li&gt;AWS Management Console access&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220916/20120327tmntcNCOG5.png&#34; alt=&#34;Root account IAM User: Name&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Permission é é¢é¸æ“‡ Attach existing policies to user directly
&lt;ul&gt;
&lt;li&gt;å‹¾é¸ AdministratorAccess policy.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220916/20120327wrpyvOLW1h.png&#34; alt=&#34;Root account IAM User: Attach existing policy&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»ä¸‹ä¸€æ­¥ï¼Œç›´åˆ°ç”¢ç”Ÿå‡º IAM User&lt;/li&gt;
&lt;li&gt;å°‡ç™»å…¥è³‡è¨Šå­˜åœ¨å¯†ç¢¼å„²å­˜å™¨
&lt;ul&gt;
&lt;li&gt;login url&lt;/li&gt;
&lt;li&gt;name&lt;/li&gt;
&lt;li&gt;password&lt;/li&gt;
&lt;li&gt;Access key ID&lt;/li&gt;
&lt;li&gt;Secret access key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20220916/20120327EQGsL60PGH.png&#34; alt=&#34;Root account IAM User: 1Password&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥è‘—ä¹Ÿæ˜¯è¦é–ä½ root account çš„ IAM User&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨é«˜å¼·åº¦çš„å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¯†ç¢¼å„²å­˜å™¨ä¿ç®¡å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;å‹™å¿…é–‹å•Ÿ MFA&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç‚º-root-account-è¨­å®š-security-baseline&#34;&gt;ç‚º Root account è¨­å®š Security baseline&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/deployment-walkthrough/configure-the-security-baseline-for-the-root-account&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¾ç…§ gruntwork guide&lt;/a&gt; æ¥ä¸‹ä¾†éœ€è¦è¨­å®šåº•ä¸‹çš„å…ƒä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å»ºç«‹æ‰€æœ‰çš„ child accounts&lt;/li&gt;
&lt;li&gt;è¨­å®š AWS Organization&lt;/li&gt;
&lt;li&gt;IAM ROles&lt;/li&gt;
&lt;li&gt;IAM Users&lt;/li&gt;
&lt;li&gt;IAM Groups&lt;/li&gt;
&lt;li&gt;IAM Password Policies&lt;/li&gt;
&lt;li&gt;Amazon GuardDuty&lt;/li&gt;
&lt;li&gt;AWS CloudTrail&lt;/li&gt;
&lt;li&gt;AWS Config.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CAUTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;You must be a Gruntwork subscriber to access terraform-aws-service-catalog.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±æ–¼ &lt;a href=&#34;https://github.com/gruntwork-io/terraform-aws-service-catalog&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform-aws-service-catalog&lt;/a&gt; æ˜¯ private repositoryï¼Œéœ€è¦ä»˜è²»è¨‚é–±æ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘ç„¡æ³•å–å¾—è£¡é¢çš„å…§å®¹&lt;/p&gt;
&lt;p&gt;ç‚ºäº†é¿å…é€™å€‹ workshop å¡åœ¨é€™è£¡ï¼Œæˆ‘å€‘å°±ä¾†è‡ªå¹¹é€™äº› module å§ï¼¸ï¼¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥ä½¿ç”¨å…¶ä»–çš„é–‹æº modules æ›¿ä»£&lt;/li&gt;
&lt;li&gt;ä¾ç…§ guide æŠŠå…ƒä»¶ç”Ÿå‡ºä¾†&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œä¾ç…§è‡ªå·±çš„éœ€æ±‚å»å®¢è£½åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NOTE: Gruntwork çš„ security module æœ‰å…¶ enterprise solution çš„ç¶“é©—åœ¨è£¡é¢ï¼Œå…¶å¯¦å…¬å¸æœ‰é ç®—é‚„æ˜¯ç›¸ç•¶å€¼å¾—åƒè€ƒçš„ã€‚åªæ˜¯æˆ‘å€‘ workshop ç‚ºäº†å£é¢å¤§å®¶ç ´è²»ï¼Œå…ˆç•¶ä¸€å›å…è²»ä»”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘å€‘è‡ªå·±çš„-module-repository&#34;&gt;æˆ‘å€‘è‡ªå·±çš„ module repository&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é–‹ä¸€å€‹æ¬Šé™çš„ repository&lt;/li&gt;
&lt;li&gt;fork &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-modules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘è‡ªå¹¹çš„ modules repository terragrunt-infrastructure-modules&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸Šé¢é€™å€‹æ˜¯æ”¾ terraform module çš„ repositoryï¼Œæ˜¯å…©å€‹ repository&lt;/li&gt;
&lt;li&gt;ä¸è¦è·ŸåŸ·è¡Œ terragrunt repository ææ··ï¼Œæ˜¯å…©å€‹ repository &lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terragrunt-infrastructure-live-example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å¯«åˆ°é€™é‚Šå°± 6000 å­—äº†ï¼Œé‚„æ²’é–‹å§‹ç¢° terragrunt&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;aws account structure èˆ‡ terragrunt directory structure çš„æ¦‚å¿µéå¸¸é‡è¦ï¼Œæœ‰å¥½çš„åŸºç¤æœƒè®“å¾Œé¢çš„å·¥ä½œå¿«æ¨‚å¾ˆå¤š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ˜å¤©æœƒç¹¼çºŒä»Šå¤©çš„å·¥ä½œï¼ŒæŠŠ aws account / iam policy / permission é…å¥½&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>IaC best practice workshop on aws</title>
      <link>https://chechia.net/zh-hant/post/2022-09-12-14th-ithome-ironman-iac-aws-workshop-01-introduction/</link>
      <pubDate>Mon, 12 Sep 2022 14:31:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-09-12-14th-ithome-ironman-iac-aws-workshop-01-introduction/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10290931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iThome éµäººè³½å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;p&gt;AWS ç‚ºä¾‹ï¼Œå¯¦ç¾ production framework çš„æœ€ä½³å¯¦è¸çš„ 30 å¤© workshop&lt;/p&gt;
&lt;h1 id=&#34;æº–å‚™-production-environmtn-devops-é¢è‡¨çš„å•é¡Œ&#34;&gt;æº–å‚™ Production environmtn Devops é¢è‡¨çš„å•é¡Œ&lt;/h1&gt;
&lt;p&gt;DevOps çš„å·¥ä½œå…§å®¹ç¹é›œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»Šå¤©æƒ³è¦ Deploy ä¸€å€‹ backend API deployment åˆ° k8s ä¸Š&lt;/li&gt;
&lt;li&gt;ä¸€è½‰çœ¼ç™¼ç¾è‡ªå·±åœ¨ä¿® port / servie / ingress / alb&lt;/li&gt;
&lt;li&gt;ä¸€è½‰çœ¼ç™¼ç¾è‡ªå·±åœ¨ä¿® tls certificate&lt;/li&gt;
&lt;li&gt;ä¸€è½‰çœ¼ç™¼ç¾è‡ªå·±åœ¨ä¿® node linux ä¸Šçš„ä¸€å€‹ bug&lt;/li&gt;
&lt;li&gt;ä¸€è½‰çœ¼ç™¼ç¾è‡ªå·±åœ¨ä¿® monitoring / metrics + alert / log collection
&amp;hellip;&lt;/li&gt;
&lt;li&gt;æˆ‘åªæ˜¯æƒ³ deploy ä¸€å€‹ backend deployment
&lt;ul&gt;
&lt;li&gt;ä¿®infra èŠ±äº†å¥½å¹¾å¤©ï¼Œè€Œå¯« deployment åªè¦ 2 hr&lt;/li&gt;
&lt;li&gt;Devops çš„å·¥ä½œï¼Œæ˜¯è™•ç† developer èˆ‡ operator ä¸­é–“çš„ç¹é›œçš„ç´°ç¯€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›å€‹è§’åº¦æ€è€ƒï¼šä¸Šé¢é€™äº›å…ƒä»¶å…¨éƒ½æ˜¯å­˜åœ¨è¨±ä¹…çš„åŠŸèƒ½ï¼Œæ‡‰è©²æœ‰ä¸€å¥—çµ±ä¸€ä»‹é¢éš¨å«å³ç”¨é€™äº›æœå‹™ï¼Œex.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»Šå¤©æƒ³è¦ Deploy ä¸€å€‹ backend API deployment åˆ° k8s ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰¿ä¸Šï¼ŒåŒå€¼æ€§é«˜ï¼Œcoding è¬›æ±‚ DRY åŸå‰‡ (Don&amp;rsquo;t Repeat Youself)ï¼Œinfra ç®¡ç†ä¸Šå»æœƒæœ‰å¤§é‡é‡è¤‡çš„å·¥ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é–‹ä¸€å€‹ Restful API deployment&lt;/li&gt;
&lt;li&gt;é–‹ä¸€å€‹ GRPC deployment&lt;/li&gt;
&lt;li&gt;é–‹ä¸€å€‹ Kafka message Queue / redis / RDS / &amp;hellip;&lt;/li&gt;
&lt;li&gt;å¸Œæœ›é€™äº›å…ƒä»¶éƒ½æœ‰å¯«å¥½çš„ unit å¯ä»¥é‡è¤‡ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä½†å¯¦å‹™ä¸Šé‚„æ˜¯æœƒæœ‰ç´°ç¯€éœ€è¦èª¿æ•´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡ªå‹•åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨™æº–åŒ–åŠŸèƒ½å¾Œï¼Œæ‡‰è©²è¦å¯ä»¥è‡ªå‹•éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;ç”šè‡³æ˜¯ç•¶ Backend API deployment éƒ¨ç½²ä¸Šå»æ™‚ï¼Œè‡ªå‹•èª¿ç”¨ç”¢ç”Ÿå°æ‡‰çš„å…ƒä»¶&lt;/li&gt;
&lt;li&gt;Backend API deployment æœ‰è®ŠåŒ–æ™‚æ‡‰è©²è¦è·Ÿæ“š deployment éœ€æ±‚å»åš reconcile (k8s controller)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºä¹æ¸¬è©¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VM / alb / RDS / &amp;hellip; ç­‰å…¬æœ‰é›²æœå‹™éœ€è¦æ¸¬è©¦å—
&lt;ul&gt;
&lt;li&gt;A: AWS / Google / Azure éƒ½æ¸¬éäº†ï¼Œæˆ‘å€‘ä¸ç”¨å†æ¸¬
&lt;ul&gt;
&lt;li&gt;ç„¶è€Œ SRE å»ç™¼ç¾æ™‚å¸¸éœ€è¦èŠ±æ™‚é–“ debug é€™äº›å…ƒä»¶
&lt;ul&gt;
&lt;li&gt;ä¸æ˜¯ functional issueï¼Œè€Œæ˜¯ configuration å•é¡Œï¼Œæˆ–æ˜¯ä¸åŒå…ƒä»¶è¨­å®šé€ æˆäº¤äº’ä½œç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;B: è¦ä¸Š production çš„å…ƒä»¶éƒ½è¦æ¸¬è©¦
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ terraform provision ä¸€å° EC2 å¾Œï¼Œåœ¨ä½¿ç”¨ terratest (Golang) æ‰“ aws API é€²è¡Œæ¸¬è©¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¨™æº–åŒ–ï¼Œè‡ªå‹•åŒ–å¾Œï¼Œæ‡‰è©²æœ‰å¤§é‡çš„è‡ªå‹•åŒ–æ¸¬è©¦ï¼Œä¾†ç¢ºä¿æ¯ä¸€å€‹å…ƒä»¶çš„ configuration éƒ½æ˜¯æ­£ç¢ºçš„ï¼Œè€Œä¸”æœ‰ä¿¡å¿ƒç¶­æŒç©©å®šåº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;infra æ™‚å¸¸æ”¹è®Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠ€è¡“å…ƒä»¶æ™‚å¸¸æ”¹è®Šï¼šterraform å‡ç´šï¼Œaws å‡ç´šï¼Œk8s å‡ç´šï¼Œlinux å‡ç´šèˆ‡ patch
&lt;ul&gt;
&lt;li&gt;infra æ²’æœ‰å°„å¾Œä¸ç†é€™ç¨®äº‹ï¼Œéƒ½éœ€è¦æ™‚å¸¸ä¸”ç©©å®šçš„æ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‚ºäº†æ»¿è¶³ä¸Šæ¸¸æœå‹™(å‰å¾Œç«¯/DB/&amp;hellip;)çš„éœ€æ±‚
&lt;ul&gt;
&lt;li&gt;èª¿æ•´ VM spec / networking / routing / security rules /&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸æ–·çš„æ”¹è®Šè€—è²»å¤§é‡çš„äººå·¥æ™‚é–“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;production ready éœ€è¦æº–å‚™çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;production -&amp;gt; çœŸé‡‘ç™½éŠ€ï¼Œå…¬å¸çš„æ¥­å‹™èˆ‡åè²&lt;/li&gt;
&lt;li&gt;production ready æ‡‰è©²æ˜¯æœ‰æ˜ç¢ºçš„è¡¨æº– True / Falseï¼Œè€Œä¸æ˜¯ã€æˆ‘è¦ºå¾—ç¾åœ¨æ˜¯ production ready äº†ã€
&lt;ul&gt;
&lt;li&gt;DevOps / SRE éƒ½çŸ¥é“ production ready çš„æ¨™æº–ï¼Œåªæ˜¯æ²’æœ‰æŠŠä»–æ˜ç¢ºå¯«å‡ºä¾†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;production ready æ‡‰è©²å°±è·Ÿ unit test ä¸€æ¨£ï¼Œä¸€å€‹ checklist è·‘ä¸‹å»æª¢æŸ¥ï¼Œé€šéå°±æ˜¯ production-readyï¼Œä¸é€šéå°±æ˜¯ not-readyï¼Œä¸”æœƒèªªæ˜ä¸é€šéçš„åŸå› &lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gruntwork.io/devops-checklist/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork production ready checklist&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äººå·¥ä»‹å…¥å·¥ä½œå¤ªå¤š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°å¢å…ƒä»¶éœ€è¦äººå·¥è™•è£¡&lt;/li&gt;
&lt;li&gt;å®šæœŸçš„ patch &amp;amp; update / å®‰å…¨æ€§æ›´æ–° / deploy éƒ½éœ€è¦äººå·¥ä»‹å…¥çš„è©±å°±å¤ªæµªè²»æ™‚é–“äº†&lt;/li&gt;
&lt;li&gt;äººå·¥å·¥ä½œå¤ªå¤šå®¹æ˜“é€ æˆäººç‚ºéŒ¯èª¤(human error)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤šç’°å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SRE éœ€è¦æä¾›å¤§é‡çš„ç’°å¢ƒ dev / qa / stag / prod &amp;hellip;&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯ææ—© scan åˆ°æ›´å‰é¢çš„å·¥ä½œæµç¨‹ï¼Œä¾‹å¦‚åœ¨ code base / reposiroty ä¸­å°±å…ˆ scan&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;gruntwork-solution&#34;&gt;Gruntwork solution&lt;/h1&gt;
&lt;p&gt;ç‚ºä½•è¦ä½¿ç”¨ gruntwork framework&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/production-framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why you need a framework&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.gruntwork.io/intro/next-steps&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork æå‡ºå…©å€‹ solution&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/reference-architecture/example-usage-guide&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Reference Architecture&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.gruntwork.io/guides/build-it-yourself&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Build your own architecture&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;prerequisites&#34;&gt;Prerequisites&lt;/h1&gt;
&lt;p&gt;ç”±æ–¼æœ¬æ¬¡åˆ†äº«ä¸å¸Œæœ›æœ‰å¤šé¤˜çš„è²»ç”¨ï¼Œæ‰€ä»¥å…§å®¹ä¾æ“š gruntwork å…¬é–‹ç¶²ç«™èˆ‡é–‹æºçš„ repository å…§å®¹è¬›è§£ä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸æœƒæ¶‰åŠä»˜è²»ç‰ˆçš„ terraform code library å…§å®¹èˆ‡æ•™æ(subscription $795/month)&lt;/li&gt;
&lt;li&gt;aws æœå‹™ä¹Ÿç›¡é‡ä½¿ç”¨ free tier ä¸­çš„é¡åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Prerequisites&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬ Terraform ç¶“é©—ï¼Œæˆ–æ˜¯åƒè€ƒ&lt;a href=&#34;&#34;&gt;2021 å¹´çš„éµäººè³½ç³»åˆ—æ–‡ç« : 30 å¤©å­¸ Terraform on Azure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸºæœ¬ AWS æœå‹™çš„è§€å¿µ
éƒ½æ²’æœ‰ä¹Ÿæ²’é—œä¿‚ï¼Œæœƒæ²¿è·¯åœ¨å¹«å„ä½è¤‡ç¿’&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;30-å¤©çš„ç›®æ¨™&#34;&gt;30 å¤©çš„ç›®æ¨™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ terraform è¨­å®šæ‰€æœ‰ aws account çš„ resource&lt;/li&gt;
&lt;li&gt;åƒè€ƒ gruntwork-io çš„é–‹æº repositoryï¼Œè¨­å®š
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯æ¸¬è©¦æˆ–å­¸ç¿’ï¼Œå¯ä»¥åƒè€ƒ
&lt;a href=&#34;https://github.com/gruntwork-io/terraform-aws-service-catalog&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/gruntwork-io/terraform-aws-service-catalog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å­¸ç¿’ç›®æ¨™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç†Ÿæ‚‰ terraform åŸºæœ¬è§€å¿µ&lt;/li&gt;
&lt;li&gt;å­¸æœƒä½¿ç”¨ terraform IaC æ§åˆ¶æ‰€æœ‰ aws service&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;repository&#34;&gt;Repository&lt;/h1&gt;
&lt;p&gt;NOTE: å¦‚æœæ˜¯æœ‰è³¼è²· gruntwork subscription çš„æœ‹å‹ï¼Œè«‹ä½¿ç”¨ç§æœ‰çš„ IaC library repositoryï¼Œæœ‰æ›´å®Œæ•´ä¸”ç¶“éæ¸¬è©¦çš„æ¶æ§‹&lt;/p&gt;
&lt;p&gt;æœ¬èª²ç¨‹ä½¿ç”¨ &lt;a href=&#34;https://github.com/gruntwork-io/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gruntwork é–‹æºçš„ repository æ¶æ§‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è«‹ copy éœ€è¦çš„éƒ¨åˆ†ï¼ˆè€Œä¸è¦ forkï¼Œå› ç‚ºé€™è£¡ä¸éœ€è¦éå»çš„ commit history èˆ‡æœªä¾†çš„ update)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-30-days&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å»å¹´iThome éµäººè³½ä½¿ç”¨çš„ç¯„ä¾‹ repository&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-azure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘è‡ªå·±ä½¿ç”¨çš„ repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šå¹´ iThome æœƒä½¿ç”¨çš„ repository&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä»Šå¤©è¦åšçš„äº‹&#34;&gt;ä»Šå¤©è¦åšçš„äº‹&lt;/h1&gt;
&lt;p&gt;è«‹æº–å‚™å¥½ä»¥ä¸‹ prerequisite&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®š / è¨»å†Š aws account ä½µå–å¾— aws 12-month free-tier (é æœŸæ˜¯å…è²»çš„é æœŸ 12-month free tier å³å¯åŒ…å«æ‰€æœ‰å…§å®¹)
&lt;ul&gt;
&lt;li&gt;ç„¶è€Œæˆæœ¬æ§åˆ¶ä¹Ÿæ˜¯èª²ç¨‹çš„ä¸€ç’°ï¼Œå„ä½è¦æ³¨æ„ä½¿ç”¨çš„è³‡æºï¼Œä¸è¦è¶…é aws free tier å¤ªå¤šï¼Œç†è«–ä¸Šä¹Ÿæ˜¯æœ€å¤šå¹¾ç¾é‡‘çš„èŠ±è²»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®‰è£èˆ‡è¨­å®š terraform tools
&lt;ul&gt;
&lt;li&gt;terraform 1.2.9&lt;/li&gt;
&lt;li&gt;terragrunt 0.38.9&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨èˆŠç‰ˆæœ¬çš„æœ‹å‹è«‹ç›¡é‡ä½¿ç”¨ terraform &amp;gt;1.x èˆ‡ terragrunt &amp;gt;0.35.8 çš„ç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Aws account&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå·²ç¶“æœ‰ aws cloud service account å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæœ¬èª²ç¨‹æœƒä½¿ç”¨å…¨æ–°çš„ aws account&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ email è¨»å†Š aws cloud service
&lt;ul&gt;
&lt;li&gt;email èªè­‰&lt;/li&gt;
&lt;li&gt;ä¿¡ç”¨å¡ç™»è¨˜&lt;/li&gt;
&lt;li&gt;æ‰‹æ©Ÿèªè­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Install terraform&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;terraform 1.2.9&lt;/li&gt;
&lt;li&gt;terragrunt 0.38.9&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è¨­å®š-github-repository&#34;&gt;è¨­å®š Github repository&lt;/h1&gt;
&lt;p&gt;æº–å‚™ä¸€å€‹ github repository ä¾†å­˜æ”¾ã„çš„ terraform code&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://github.com/chechiachang/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ç¯„ä¾‹ repository&lt;/a&gt;ï¼Œä¹Ÿæ˜¯ fork åº•ä¸‹ gruntwork çš„ repository ç¨ä½œæ•´ç†&lt;/li&gt;
&lt;li&gt;æˆ–åƒè€ƒ &lt;a href=&#34;https://github.com/gruntwork-io/terragrunt-infrastructure-live-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gruntwork Github repository example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:chechiachang/terragrunt-infrastructure-live-example.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;æ˜å¤©&#34;&gt;æ˜å¤©&lt;/h1&gt;
&lt;p&gt;å¸¶è‘—å¤§å®¶åœ¨ terraform code ä¸­è¨­å®š aws account èˆ‡ IAM æ¬Šé™&lt;/p&gt;
&lt;h1 id=&#34;åƒè€ƒè³‡æº&#34;&gt;åƒè€ƒè³‡æº&lt;/h1&gt;
&lt;p&gt;ä¸ç†Ÿæ‚‰ terraform çš„æœ‹å‹ä¸å¦¨åƒè€ƒå»å¹´çš„ä½³ä½œ &lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/4057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform Workshop - Infrastructure as Code for Public Cloud ç–«æƒ…è­¦æˆ’é™ªä½ åº¦é 30 å¤©&lt;/a&gt;ï¼Œé›–ç„¶æ˜¯åœ¨ Azure ä¸Š
ï¼Œä½†è¨±å¤šåŸºæœ¬æ¦‚å¿µéƒ½æ˜¯ç›¸é€šçš„&lt;/p&gt;
&lt;p&gt;éå»çš„éµäººè³½æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;13th ä½³ä½œ &lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/4057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform Workshop - Infrastructure as Code for Public Cloud ç–«æƒ…è­¦æˆ’é™ªä½ åº¦é 30 å¤©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;12th ä½³ä½œ &lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/3248&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes X DevOps X å¾é›¶é–‹å§‹å°å…¥å·¥å…· X éœ€æ±‚åˆ†æï¼Šå¾åº•å±¤é–‹å§‹ç ”ç©¶åˆ°æ‡·ç–‘äººç”Ÿçš„é«”æ‚Ÿï¼Š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;11th å„ªå‹ &lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/2444&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¶å¯¦æˆ‘çœŸçš„æ²’æƒ³éåªæ˜¯æŠŠæœå‹™ä¸Ÿä¸Š kubernetes å°±æœ‰é€™éº¼å¤šå•é¡Œåªå¥½ä¾†åƒåŠ 30å¤©åˆ†äº«é‚£äº›å¹´æˆ‘æ€éº¼åœ¨ kubernetes ä¸Šè¸©é›·å„é …æœå‹™&lt;/a&gt;
kkk&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨è–¦ä¸€ä¸‹ Gruntwork ä»–å€‘å®¶çš„ blog: &lt;a href=&#34;https://blog.gruntwork.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gruntwork devops as a service&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h1&gt;
&lt;p&gt;éå»åƒè³½éƒ½æœƒæœ‰è¨±å¤šæœ‹å‹æå‡ºå•é¡Œï¼Œä»Šå¹´è‹¥æœ‰ç–‘å•å¯ä»¥é›†ä¸­åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘æœƒè·Ÿå¤§å®¶ä¸€èµ·è¨è«–ã€‚æœ‰æƒ³è¦çœ‹çš„é¡Œç›®ä¹Ÿå¯ä»¥ç•™è¨€ï¼Œæˆ‘å€‘çœ‹æ™‚é–“åšå®‰æ’ã€‚&lt;/p&gt;
&lt;h1 id=&#34;references&#34;&gt;references&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.gruntwork.io/intro/overview/how-it-works&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.gruntwork.io/intro/overview/how-it-works&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>IThome 2022 DevOpsDay Introducing policy as code for terraform</title>
      <link>https://chechia.net/zh-hant/post/2022-06-09-ithome-devopsday-2022-proposal-introduce-policy-as-code-for-terraform-/</link>
      <pubDate>Thu, 09 Jun 2022 01:04:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-06-09-ithome-devopsday-2022-proposal-introduce-policy-as-code-for-terraform-/</guid>
      <description>&lt;h3 id=&#34;titleq&#34;&gt;Titleq&lt;/h3&gt;
&lt;p&gt;å¾é›¶å°å…¥ Policy as Code åˆ° terraform ç”˜è‹¦è«‡ - Introducing policy as code for terraform&lt;/p&gt;
&lt;h3 id=&#34;presentation&#34;&gt;Presentation&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1yawazO1B_sP5Yiav-XLGJXW3ZS2JTV0wGuJwhrUKQ3A/edit?usp=sharing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Slides&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;p&gt;Terraform æ˜¯ä¸€å€‹å¾ˆæ£’çš„ Infrastructure as Code çš„å·¥å…·ï¼Œèƒ½å¤ ä»¥ç¾ä»£çš„è»Ÿé«”å·¥ç¨‹æµç¨‹ä¾†ç©©å®šçš„å»ºæ§‹ infrastructureï¼Œä¸¦éš¨è‘—éœ€æ±‚è®Šæ›´è‡ªå‹•åŒ–è¿­ä»£ï¼Œå°‡æ–°çš„ feature å®‰å…¨åœ°æ›´æ–°åˆ°æ—¢æœ‰çš„ infrastructure ä¸Šã€‚åªè¦æ˜¯ Infrastructure æœ‰é—œçš„å•é¡Œï¼Œæˆ‘ä¸€å¾‹æ¨è–¦ Terraformã€‚&lt;/p&gt;
&lt;p&gt;é€™ä¹Ÿæ„å‘³ Terraform çš„å“è³ªå°±ç­‰æ–¼ infrastructure çš„å“è³ªï¼Œå¥½çš„ terraform å¸¶ä½ ä¸Šå¤©å ‚ï¼Œä¸å¥½çš„ terraform å…¨ team ç«è‘¬å ´ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Infrastructure æœ‰å¤ªå¤šè³‡å®‰çš„è€ƒé‡ï¼Œæ–°çš„é¢¨éšªä¸æ–·è¢«æª¢æŸ¥å‡ºä¾†ï¼Œé€£å¸¶è¦ä¸æ–·çš„ patch terraform code ä¾†é¿å…æ½›åœ¨çš„è³‡å®‰é¢¨éšª&lt;/li&gt;
&lt;li&gt;Infrastructure æœƒä¸æ–·åœ°æ›´æ–°ï¼Œä¾‹å¦‚å…¬æœ‰é›²çš„ api ä¸æ–·æ›´æ–°ï¼Œå»å¹´çš„ code å·²ç¶“è·Ÿä¸ä¸Šä»Šå¹´çš„æœ€ä½³å¯¦è¸äº†&lt;/li&gt;
&lt;li&gt;å¥½çš„å·¥ç¨‹å¸«å¯«å‡ºçš„ terraform code å±Œæ‰“èœé³¥å·¥ç¨‹å¸«ï¼Œè¦å¦‚ä½•è®“åœ˜éšŠä¾å¾ªæ›´å¥½çš„å¯¦è¸ï¼Œé¿å…å¯«å‡ºçˆ› code
ç¶­è­· code æœ‰ clean code / best practiceï¼ŒTerraform ä¹Ÿæœ‰ clean code èˆ‡ best practiceï¼Œå·¥ç¨‹å¸«è¦å¦‚ä½•å·¥å…·ä¾†è¼”åŠ©ï¼Œæ˜¯ Policy as Code çš„ä¸€å¤§èª²é¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ¼”è¬›èšç„¦æ–¼å¯¦éš›ç¶“é©—ï¼Œå¾ä¸€å¤§å † terraform modules é–‹å§‹ï¼Œæ²’æœ‰ Policy as Codeï¼Œåˆ°ä¸€æ­¥æ­¥è©•ä¼°ã€å°å…¥ã€å¯¦ä½œã€æ”¹é€²èˆ‡è¿­ä»£ï¼Œé€æ¼¸çš„æå‡åœ˜éšŠ Terraform code å“è³ªï¼Œæå‡ infrastructure äº¤ä»˜å“è³ªï¼Œä¸¦é¿å…åˆ°æœªä¾†æ½›åœ¨çš„é¢¨éšªã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›çš„ Terraform ç‰ˆæœ¬ç‚ºå¾ 0.12, 0.13, ä¸€è·¯æ¨é€² 1.0+ã€‚&lt;/p&gt;
&lt;h3 id=&#34;content&#34;&gt;Content&lt;/h3&gt;
&lt;p&gt;å¾é›¶å°å…¥ Policy as Code åˆ° terraform ç”˜è‹¦è«‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ Terraform èˆ‡ Policy as Code&lt;/li&gt;
&lt;li&gt;ç•¶ä½ æ‰‹ä¸Šæœ‰æ•¸ä¸å®Œçš„ terraform modulesï¼Œç®¡ç† terraform å“è³ªæ˜¯å€‹å¤§å•é¡Œ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç®¡ç† Terraform
&lt;ul&gt;
&lt;li&gt;è‡ªå‹•åŒ–: æ”¹è®Šå¾ Jenkins pipeline é–‹å§‹ï¼Œgitflow æ”¹é€²ï¼Œpre-commit hook&lt;/li&gt;
&lt;li&gt;Policy as Code æ ¡é©—&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å·¥å…·é‡åŒ– terraform code å“è³ª&lt;/li&gt;
&lt;li&gt;å®Œæ•´å°å…¥ Policy as Code&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°çµ: ç© infra å¿…ç”¨ terraformï¼Œç© terraform å¿…åš policy as code&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;about-me&#34;&gt;About me&lt;/h3&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2018 Ithome Cloud Summit
2018 Ithome Kubernetes Summit
2019 Ithome Cloud Summit
2020 Ithome Cloud Summit
2020/12/18	Cloud Native Taiwan å¹´æœ«èšæœƒ
2020/8/17	DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform
2021 Ithome Cloud Summit
2022 Ithome Cloud Summit
2022 COSCUP&lt;/p&gt;
&lt;h3 id=&#34;suggested-audience&#34;&gt;Suggested Audience&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¨è–¦æœ‰ Terraform ä½¿ç”¨ç¶“é©—ï¼Œç‰¹åˆ¥æ˜¯å…¬æœ‰é›²ç¶“é©—ï¼Œå° Policy as Code æœ‰èˆˆè¶£çš„äºº&lt;/li&gt;
&lt;li&gt;æƒ³è¦å¯«å‡º Terraform clean code çš„äºº&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2022 05 21 COSCUP Operating Time Series Database in K8s</title>
      <link>https://chechia.net/zh-hant/post/2022-05-21-coscup-proposal-operating-time-series-database-in-k8s/</link>
      <pubDate>Sat, 21 May 2022 01:04:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2022-05-21-coscup-proposal-operating-time-series-database-in-k8s/</guid>
      <description>&lt;h3 id=&#34;titleq&#34;&gt;Titleq&lt;/h3&gt;
&lt;p&gt;åœ¨ k8s ä¸Šè·‘ time series database ç”˜è‹¦è«‡ - Operating Time Series Database in K8s&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1PZryGImYRALMJfbEMuf_jPd2P-qzIwDmVd5DgXSuqq0/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Slides&lt;/a&gt;
Youtube live record: &lt;a href=&#34;https://youtu.be/YexUnVOZC8M?t=9421&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://youtu.be/YexUnVOZC8M?t=9421&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;p&gt;Influxdb ç‚ºå¸‚å æœ€é«˜çš„ time series DBMS ä¹‹ä¸€ï¼Œä½¿ç”¨ä¸Šèˆ‡ RDBMS æœ‰ä¸åŒå„ªåŠ£å‹¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¶­é‹æ–¹é¢ï¼Œdatabase æœ‰è¨±å¤šç›¸ä¼¼éœ€æ±‚ï¼šç©©å®šæ€§ã€é«˜å¯ç”¨æ€§ã€å‚™ä»½ã€é‚„åŸã€è³‡æºç®¡ç†ã€èª¿åº¦ã€ç½é›£å¾©åŸ&amp;hellip;ç­‰ã€‚ç¤¾ç¾¤å¸¸è½åˆ°æœ‰äººå•ï¼šå¯ä¸å¯ä»¥åœ¨ K8s ä¸Šè·‘ databaseã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¼”è¬›æœƒåˆ†äº«åœ¨ k8s ä¸­ç¶­é‹ï¼Œå¯¦å‹™ä¸Šæ‰€é‡åˆ°çš„å•é¡Œï¼Œæä¾›ä¸€äº›æ€è€ƒæ–¹å‘ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›çš„ influxdb ç‰ˆæœ¬ç‚º Influxdb OSS / enterprise 1.9+&lt;/p&gt;
&lt;p&gt;InfluxDB is one the the most popular time series database management system (DBMS) and is a powerful platform when dealing with time series data.&lt;/p&gt;
&lt;p&gt;DBMSs, including RDBMS, have many similar requirements on aspect of infrastructure operation. They all require stability, high availability, backup and restore utilities, cpu / memory resource management, disaster recovery&amp;hellip;etc. People often ask about that whether is it ok to run DBMS in kubernetes cluster or not. This lecture try to provide some points from our experiences dealing with real-world issues.&lt;/p&gt;
&lt;p&gt;The version of InfluxDB discussed in the lecture is InfluxDB OSS / Enterprise 1.9+&lt;/p&gt;
&lt;h3 id=&#34;content&#34;&gt;Content&lt;/h3&gt;
&lt;p&gt;åœ¨ k8s ä¸Šè·‘ time series database ç”˜è‹¦è«‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ Influxdbï¼Œtime series èˆ‡ RDBMS çš„å·®ç•°&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ time series çš„å¹¾å€‹æƒ…å¢ƒ:&lt;/li&gt;
&lt;li&gt;åœ¨ k8s ä¸Šè·‘ DB
&lt;ul&gt;
&lt;li&gt;ç©©å®šæ€§ Availabilityã€HA (enterprise)ã€faillure recovery&lt;/li&gt;
&lt;li&gt;è³‡æºç®¡ç† OOMKilledã€cpu throttlingã€OutOfDisk&lt;/li&gt;
&lt;li&gt;DB management: data migrationã€backup &amp;amp; restoreã€data retention&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°çµ: ä½ è©²ä¸è©²ç”¨ cloud service / VM / åœ¨ K8s ä¸Šè·‘ database&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Operating Time Series Database in K8s&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A brief introduction about InfluxDB and the differences with RDBMS&lt;/li&gt;
&lt;li&gt;Some scenario to use a time series database (other than RDBMS)&lt;/li&gt;
&lt;li&gt;Operate InfluxDB in K8s
&lt;ul&gt;
&lt;li&gt;Stability, availability, disaster recovery&lt;/li&gt;
&lt;li&gt;Resource management, OOMKilled, cpu throttling, out of disk&lt;/li&gt;
&lt;li&gt;DB management: data migration, retention, rotation, backup &amp;amp; restore&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;summary: whether or not to run a database in k8s&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;about-me&#34;&gt;About me&lt;/h3&gt;
&lt;p&gt;Che-Chia Changï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚
Microsoft æœ€æœ‰åƒ¹å€¼å¾æ¥­äººå“¡ MVPã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ç‚º Golang Taiwan Meetup Organizerï¼Œå¸¸å‡ºç¾æ–¼ CNTUGï¼ŒDevOps Taipeiï¼ŒGDG Taipeiï¼Œ Golang Taipei Meetupã€‚&lt;/p&gt;
&lt;p&gt;Che-Chia Chang, an SRE specialize in container and Kubernetes operation. An active member of CNTUG, DevOps Taipei, GDS Taipei, Golang Taiwan Meetup.
Microsoft Most Valuable Professional since 2020.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2018 Ithome Cloud Summit
2018 Ithome Kubernetes Summit
2019 Ithome Cloud Summit
2020 Ithome Cloud Summit
2020/12/18	Cloud Native Taiwan å¹´æœ«èšæœƒ
2020/8/17	DevOps Taiwan Meetup #26 - å¾é›¶é–‹å§‹å°å…¥ Terraform
2021 Ithome Cloud Summit&lt;/p&gt;
&lt;h3 id=&#34;suggested-audience&#34;&gt;Suggested Audience&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¨è–¦æœ‰ k8s ä½¿ç”¨ç¶“é©—çš„å¾æ¥­äººå“¡ï¼Œå° k8s æœ‰ä¸Šæ‰‹ç¶“é©—&lt;/li&gt;
&lt;li&gt;å•å¯ä¸å¯ä»¥åœ¨ k8s ä¸Šé¢è·‘ database çš„äºº&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2021 11 16 Ithome Cloud Summit Vault</title>
      <link>https://chechia.net/zh-hant/post/2021-11-16-ithome-cloud-summit-vault/</link>
      <pubDate>Tue, 16 Nov 2021 01:04:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2021-11-16-ithome-cloud-summit-vault/</guid>
      <description>&lt;p&gt;å„ä½å¥½&lt;/p&gt;
&lt;p&gt;é—œæ–¼é€™å€‹ QRcode&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡ä¸Šå°å‰ï¼Œæˆ‘éƒ½æœƒæƒ³è¦å¸¶ä»€éº¼æ¨£çš„å…§å®¹çµ¦è§€çœ¾ï¼Œè®“è§€çœ¾å€¼å¾—èŠ± 30 åˆ†é˜åœ¨åº•ä¸‹è½ã€‚å¾Œä¾†å°±ç¿’æ…£å…ˆç™¼è¡¨ä¸€ç¯‡æ–‡ç« ï¼ŒæŠŠå°è§€çœ¾æœ‰å¹«åŠ©çš„è³‡æºåŒ…æˆä¸€åŒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ˜¯å®Œæ•´æŠ•å½±ç‰‡ï¼šhttps://slides.com/chechiac&amp;hellip;/terraform-introduction-a56697&lt;/li&gt;
&lt;li&gt;é€å­—è¬›ç¨¿ï¼š(æœ€å¾Œæ ¡ç¨¿ä¸­ï¼‰&lt;/li&gt;
&lt;li&gt;ç„¶è€Œåªæœ‰æœ¬æ¬¡æ¼”è¬›å…§å®¹ï¼Œå›å»å¯èƒ½é‚„æ˜¯ä¸å¤ªå®¹æ˜“æ“ä½œã€‚æ‰€ä»¥é€™æ¬¡é™„ä¸Šä½¿ç”¨ Terraform ä¸€éµéƒ¨ç½² vault çš„ Github Repositoryï¼šhttps://github.com/&amp;hellip;/southe&amp;hellip;/chechia_net/vault/singleton&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸ç†Ÿ Terraformï¼Œå†é™„ä¸Š 30 å¤©æ‰‹æŠŠæ‰‹ Terraform æ•™å­¸æ–‡ç« ï¼Œåªè¦é¡˜æ„èŠ±æ™‚é–“ï¼Œå…¨ç¯‡ä¸­æ–‡ä¸€å€‹æœˆå¸¶ä½ ä¸Šæ‰‹ Terraformã€‚
&lt;ul&gt;
&lt;li&gt;IThome éµäººè³½å¥½è®€ç‰ˆï¼šhttps://ithelp.ithome.com.tw/users/20120327/ironman/4057&lt;/li&gt;
&lt;li&gt;Github Repository å®Œæ•´ç‰ˆï¼šhttps://github.com/&amp;hellip;/terraform-30&amp;hellip;/tree/main/lecture/zh&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœé‡åˆ°å•é¡Œé‚„æ˜¯éœ€è¦æ‰¾äººç™¼å•ï¼Œæ‰€ä»¥å†æ¨è–¦å…©å€‹ç¤¾ç¾¤ï¼Œå¯ä»¥ä¾†é€™é‚Šç™¼å•ï¼Œè¦æ‰¾æˆ‘æœ¬äººä¹Ÿæ‰¾å¾—åˆ°ã€‚ç”šè‡³åªæ˜¯åŠ å…¥æ½›æ°´ä¸è¬›è©±ï¼Œéƒ½å¯ä»¥è¢«å‹•å¸æ”¶è¨±å¤šæ–°çŸ¥ã€‚
&lt;ul&gt;
&lt;li&gt;Cloud Native Taiwan User Group
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://t.me/cntug&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://t.me/cntug&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://fb.cloudnative.tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://fb.cloudnative.tw&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DevOps Taiwan Meetup Group
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://t.me/devopstw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://t.me/devopstw&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥æ‰‹æ©Ÿæ‹å®Œé€™å€‹å°±å‡ºå»åƒåˆé¤äº†ã€‚
æˆ–æ˜¯æ‹å›å®¶ï¼Œç„¶å¾Œå‚³çµ¦ä¸€å€‹åŒäº‹å«ä»–èŠ± 30 å¤©æŠŠ Terraform è·Ÿ Vault é€™äº›éƒ½å­¸æœƒã€‚&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹å¸Œæœ›å°å„ä½æœ‰å¹«åŠ©ï¼Œè®“åœ‹å…§æŠ€è¡“åŠ›èƒ½æŒçºŒé€²æ­¥æˆé•·ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å›åˆ°æœ¬æ¬¡æ¼”è¬›ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è¬›æœ‰ä¸‰å€‹é—œéµå­—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes&lt;/li&gt;
&lt;li&gt;Vault&lt;/li&gt;
&lt;li&gt;Terraform é€™å€‹æ˜¯éš±è—çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è«‹å•å¹³æ™‚å·¥ä½œæœƒç”¨åˆ°é€™ä¸‰å€‹æŠ€è¡“ä¹‹ä¸€çš„æœ‹å‹ï¼Œè«‹èˆ‰å€‹æ‰‹ï¼Œå¥½è®“æˆ‘çŸ¥é“ä¸€ä¸‹è§€çœ¾çš„åˆ†å¸ƒï¼Œç­‰ç­‰åˆ†äº«çš„å…§å®¹æœƒç…§æ¯”ä¾‹åšä¸€äº›èª¿æ•´ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©ä¸æœƒè¬›å¤ªå¤š Kubernetes çš„å…§å®¹ï¼Œé‡é»æ”¾åœ¨ Vaultï¼Œä»¥åŠå¦‚ä½•è¨­å®š Vaultï¼Œæ‰€ä»¥ Terraform Infrastructure as Code æˆ–æ˜¯ configuration as Code æœƒåœ¨é€™é‚Šè·‘å‡ºä¾†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é—œæ–¼æˆ‘ï¼Œæˆ‘æ˜¯å“²å˜‰ã€‚æˆ‘åœ¨ Maicoin ç•¶ SREã€‚å¸¸å‡ºç¾çš„ç¤¾ç¾¤æ˜¯ CNTUG èˆ‡ DevOpsTWã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©è«‡çš„æ›´å¤§çš„ä¸»é¡Œå…¶å¯¦æ˜¯ Key Management ç§é‘°ç®¡ç†ï¼Œæˆ–æ˜¯å¯†ç¢¼ç®¡ç†ã€‚é€™æ˜¯ä¸€å€‹å¾ˆå¤§çš„é¡Œç›®ï¼Œä»Šå¤©æ¼”è¬›å…§å®¹åªæ˜¯å…¶ä¸­çš„ä¸€å€‹å¯¦ä½œæ¡ˆä¾‹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;èˆ‰å€‹ä¾‹å­ï¼Œä¸€é‚Šæ˜¯ API Serverï¼Œå¦ä¸€é‚Š Databaseï¼Œæˆ–æ˜¯ç¬¬ä¸‰æ–¹æœå‹™&lt;/p&gt;
&lt;p&gt;Database ä¾† Authenticate åˆæ³•çš„ Client ç”¨æˆ¶ç«¯ï¼Œå¯èƒ½æ˜¯ username + passwordï¼Œæˆ–æ˜¯ API Key + Secretï¼Œæˆ–æ˜¯ Access Tokenï¼Œæˆ–æ˜¯ Private Keyï¼ŒClient Certificateï¼Œéƒ½å¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è·¨ä¸åŒå¹³å°æˆ–æ˜¯ä»‹é¢çš„æœå‹™ï¼Œæˆ‘å€‘å¸¸ç”¨çš„ Auth æ–¹æ³•ã€‚èª Key ä¸èªäººã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é‚£ä¸­é–“é€™äº› Key è¦æ€éº¼ç®¡ç†ï¼Œå°±æœ‰å¾ˆå¤šå­¸å•
å…¶ä¸­æœ€åŸºæœ¬çš„ï¼Œæ˜¯æ€éº¼é…ç½®çµ¦ API Server è®“ä»–ä½¿ç”¨
æ³¨æ„ï¼šè®“ API Server ä½¿ç”¨ï¼Œéš±å«çš„æ„æ€æ˜¯ï¼Œå…¶ä»–äººä¸ç®¡æ˜¯å…¶ä»–å¾®æœå‹™ï¼Œæˆ–æ˜¯é–‹ç™¼å·¥ç¨‹å¸«ï¼Œé–’é›œäººç­‰éƒ½ä¸èƒ½çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é€™é‚Šæˆ‘å€‘å‡è¨­ API Server æ˜¯åœ¨ Kubernetes è£¡é¢è·‘ï¼Œå¾®æœå‹™æ¶æ§‹ï¼Œæ‰€ä»¥ API Server å¯èƒ½æ˜¯ä¸€å€‹ Podï¼Œæˆ‘å€‘ SRE è¦ç‚ºé€™çµ„ Pod é…ç½®å¯†ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šåˆ—å‡ºçš„æ‡‰è©²æ˜¯ K8s æ¯”è¼ƒå¸¸è¦‹çš„å¹¾ç¨®åšæ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;plain textï¼Œç›´æ¥å¯«é€² file è®“ Pod å»è®€å–&lt;/li&gt;
&lt;li&gt;k8s secret åš base64 encode&lt;/li&gt;
&lt;li&gt;å®‰å…¨ä¸€é»çš„é€éå¤–éƒ¨æ©Ÿåˆ¶ä½œåŠ å¯†è§£å¯†&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯å¯«åœ¨ API Server çš„ memory ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº‹å¯¦ä¸Šå¦‚æœæ²’æœ‰ä½¿ç”¨ K8sï¼Œä½¿ç”¨ VM æˆ–æ˜¯å…¬æœ‰é›² Container Serviceï¼Œæ‡‰è©²éƒ½æ˜¯é¡ä¼¼çš„åŸç†ï¼Œå¤§å®¶éƒ½æ˜¯ Linux baseï¼Œsecret æ”¾é€²ä¾†çœ‹è¦æ”¾åœ¨ disk æˆ–æ˜¯ memory è£é¢ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¯¦éš›æ”¾åˆ° K8s å¤§æ¦‚æœƒé•·é•·é€™äº› yaml&lt;/p&gt;
&lt;p&gt;æœ€ç°¡å–®ï¼Œå°±ç›´æ¥æŠŠ secret å£“åˆ° Pod env è£é¢ï¼Œ&lt;/p&gt;
&lt;p&gt;æœ€ç°¡å–®ä¹Ÿæœ€å±éšª&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰çœ‹å¾—åˆ° yaml çš„äººéƒ½æ˜ç¢¼çœ‹è¦‹å¯†ç¢¼&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰èƒ½é€²åˆ° file system&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æå¤–è©±&lt;/p&gt;
&lt;p&gt;API Server è¢«å¾æ­£é¢æ‰“ç©¿ï¼Œæ»²é€åˆ°æ‹¿åˆ°é€™çµ„å¯†ç¢¼çš„æ©Ÿæœƒå¤šé«˜ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ API Server golang library æœ‰åœ¨è·Ÿå®‰å…¨æ€§æ›´æ–°&lt;/li&gt;
&lt;li&gt;Kubernetes ç”¨å…¬æœ‰é›²çš„ Kubernetes Serviceï¼Œæœ‰åœ¨æ›´æ–°&lt;/li&gt;
&lt;li&gt;OS ami è·Ÿ docker image éƒ½æœ‰åœ¨æ›´æ–°&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œæœ‰åŠŸèƒ½æ­£å¸¸çš„é˜²ç«ç‰†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰“æ›è »æœ‰å¯èƒ½çš„ï¼Œä½†æ‰“ç©¿æœå‹™åˆ°æ‹¿åˆ°å¯†ç¢¼ï¼Œæ˜¯æœ‰é›£åº¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šæ™‚å€™ï¼Œè‡³å°‘åœ¨å¹£åœˆæœ‰è¢«çˆ†å‡ºä¾†çš„è³‡å®‰äº‹ä»¶ï¼Œå¤§å¤šæ˜¯æ˜¯å…¬å¸å“¡å·¥è¢«é‡£é­šä¿¡æ‰åˆ°ï¼Œè¢«æ¤å…¥æƒ¡æ„è»Ÿé«”åœ¨ local é›»è…¦ï¼Œç„¶å¾Œä»–åˆçœ‹å¾—åˆ°æ˜ç¢¼çš„å¯†ç¢¼ï¼Œç›´æ¥çˆ†ç‚¸ã€‚&lt;/p&gt;
&lt;p&gt;æ˜ç¢¼ç³Ÿç³•çš„åœ°æ–¹ï¼Œå¤§å®¶éƒ½çœ‹å¾—åˆ°ï¼Œä¸€é–‹å§‹å°±æ˜¯ exposed çš„ç‹€æ…‹ï¼Œé¢¨éšªä¸å¯æ§ï¼Œä¹Ÿç„¡å¾ç®¡åˆ¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç„¶å¾Œæ˜¯ K8s secretï¼Œä¹Ÿæ˜¯å¾ env æ›é€²å» Pod&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ”¾åœ¨ k8s secretï¼Œæ˜¯ base64 çš„æ ¼å¼&lt;/p&gt;
&lt;p&gt;çœ‹èµ·ä¾†è·ŸåŸå…ˆå…§å®¹ä¸ä¸€æ¨£äº†ï¼Œæœ‰äººå°±è·Ÿæˆ‘èªªï¼Œä»–å€‘å®¶çš„ k8s secret æœ‰ç”¨ base64 åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;encode è·Ÿ encrypt&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;k8s secret æœ‰ä»€éº¼å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜ç¢¼ plain text çš„å•é¡Œï¼Œä¸è©²çœ‹åˆ°çš„äººå¾ˆå®¹æ˜“å°±çœ‹åˆ°&lt;/li&gt;
&lt;li&gt;æ ¹æœ¬çš„å•é¡Œé‚„æ˜¯ RBAC æ‡¶å¾—è¨­å®šï¼Œå¤§å®¶éƒ½ç”¨ default role é€²ä¾†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦ç”¨å¯ä»¥ï¼Œå…ˆçœ‹ k8s secret å¾Œé¢çš„å„²å­˜å¯¦ä½œæ˜¯ä»€éº¼ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯ k8s etcd&lt;/li&gt;
&lt;li&gt;é€é k8s API server å­˜å–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;etcd è·Ÿ kube-api ä¸€èˆ¬ä¾†èªªæ˜¯å¤ å®‰å…¨çš„ã€‚å®˜æ–¹æ–‡ä»¶é‚„å»ºè­°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;secret è¦åŠ å¯† encrypt&lt;/li&gt;
&lt;li&gt;å¢å¼· RBAC æ§åˆ¶ï¼Œåªæœ‰ç‰¹å®š role æ‰çœ‹å¾—åˆ° secretï¼Œï¼Œè€Œä¸æ˜¯æ¯å€‹äººéƒ½ç”¨ default role è¿‘ä¾† k8sï¼Œç„¶å¾Œé€²åˆ° namespace å…¨éƒ¨ secret å°±çœ‹å…‰å…‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;RBAC æœ‰è¨­å®šå¥½ï¼Œæœ‰åŠ å¯†ï¼Œæ˜¯å¯ä»¥åšåˆ°å®‰å…¨ã€‚ç•¶ç„¶é‚„æ˜¯æ²’æœ‰å°ˆé–€ key Management å·¥å…·ï¼Œå¦‚ Vault æœ‰é¡å¤–ç®¡ç†ä¸Šçš„å„ªåŒ–åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åŠ å¯†ç¯„ä¾‹å¯ä»¥çœ‹å¼·è€…æˆ‘æœ‹å‹çš„æ–‡ç« &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŠ å¯†å®Œå¯èƒ½é•·é€™æ¨£ï¼Œé‚„è¦é¡å¤–é€éå…¶ä»–æ©Ÿåˆ¶æ‰èƒ½é€²è¡Œè§£å¯†ï¼Œæ‹¿åˆ°åŸå§‹è³‡æ–™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚é€é k8s controller è§£å¯†&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯é€é vault server&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯é€éå…¬æœ‰é›²çš„ Key Management Service åšè§£å¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å…¶ä»–çš„ k8s secret åŠ å¯†è§£æ±ºæ–¹æ¡ˆ&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»Šå¤©æˆ‘å€‘ä½¿ç”¨ Vaultï¼Œå…¶ä¸­ä¸€å€‹ç›®çš„å°±æ˜¯è¦åä¸­é–“é€™æ®µ Safe Magic&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çµ¦é€™å€‹ Pod secret&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œåªçµ¦é€™å€‹ Pod Secret&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;ç•¶ç„¶ Key Management å…¶ä»–é‚„æœ‰ä¸€å †äº‹æƒ…è¦è™•ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯†ç¢¼æ´©æ¼çš„è©±æœ‰æ²’æœ‰ revoke æ©Ÿåˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èƒ½ä¸èƒ½å®šæ™‚ Rotate æ±°æ›å¯†ç¢¼ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ”¹æ¶æ§‹ï¼Œåº•ä¸‹çš„è¨­å®šå¥½ä¸å¥½è€•è‘—å‹•æ…‹èª¿æ•´ï¼Œé‚„æ˜¯è¦è·Ÿè‘— rename / mv k8s secret&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ€éº¼åšç¨½æ ¸ï¼Œæ€éº¼æª¢æŸ¥å…§å®¹ã€‚æˆ‘çœ‹ä¸åˆ° vault å¹«æˆ‘çœ‹ä¸€ä¸‹å…§å®¹å°ä¸å°ï¼Œé€™å€‹å¾ˆå®¹æ˜“ç™¼ç”Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡†æƒ³é ­å°±å¾ˆç—›&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»Šå¤©çš„ç›®çš„å¾ˆå–®ç´”&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯†ç¢¼çš„éœ²å‡ºç›¡é‡å°&lt;/li&gt;
&lt;li&gt;æœ€å¥½å¯†ç¢¼æ˜¯æœ‰æœŸé™çš„ï¼Œé€¾æœŸè‡ªå‹•å¤±æ•ˆ&lt;/li&gt;
&lt;li&gt;æš´éœ²äº†å¯ä»¥ revoke&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Vault&lt;/p&gt;
&lt;p&gt;æœ‰äººç”¨éï¼Ÿé€™é‚Šç°¡ä»‹ä¸€ä¸‹&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åœ¨ CNCF çš„ landscape æ¼±æ¸ Key Managementï¼Œæ‡‰è©²æ˜¯è£¡é¢å¸‚ä½”æœ€é«˜çš„é–‹æºé …ç›®&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é‡é»å°±æ˜¯ä¿è­·èˆ‡ç®¡ç† secret&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Vault çš„æ ¸å¿ƒæ¦‚å¿µï¼Œé€™å€‹å½±ç‰‡æ˜¯ Hashicorp å®˜æ–¹ä»‹ç´¹çš„å½±ç‰‡ï¼Œè¬›å¾—å¾ˆå¥½ï¼Œå¤§å®¶è‡ªå·±å›å»çœ‹ä¸€ä¸‹&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é€™é‚Šç°¡å–® vault 101&lt;/p&gt;
&lt;p&gt;ç¾åœ¨æœ‰ä¸€å° vault server å·²ç¶“è¨­å®šå¥½äº†ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ vault client é€£ç·š&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚é€™é‚Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ VAULT TOKEN å‘Šè¨´ vault ä½ æ˜¯ä»€éº¼èº«ä»½çš„ç”¨æˆ¶&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯é€²è¡Œ loginï¼ŒVault æœƒå‘¸ç™¼ä¸€çµ„è‡¨æ™‚çš„ TOKEN çµ¦ä½ &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‹¿è‘—çµ„ TOKEN å»å• Vaultï¼Œè«‹å•æˆ‘å¯ä»¥è¦ /user/mysql é€™å€‹è·¯å¾‘ä¸‹çš„è³‡æ–™å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Vault æª¢æŸ¥ TOKEN çš„ role èˆ‡ permissionï¼Œå¯ä»¥å°±å›å‚³å€¼
ä¸è¡Œå°± permission denied&lt;/p&gt;
&lt;p&gt;Vault å°±æ˜¯é‡‘åº«ï¼ŒçœŸæ­£é‡è¦çš„ key å­˜åœ¨è£¡é¢ï¼Œä½¿ç”¨é€™è¦ä¾†å• Vaultï¼Œè¦å…ˆé Vault é€™é—œ&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Vault å¯¦éš›å­˜æ”¾ Secret Engineï¼Œé€™é‚Šä¹Ÿè·³éï¼Œå¤§å®¶å…ˆæŠŠä»–ç•¶ key / value å­˜æ”¾å¥½äº† XD&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç­‰ç­‰ï¼Œé€™æ¨£ vault Auth æœ‰é»æ€ª&lt;/p&gt;
&lt;p&gt;æœ¬ä¾†æ‹¿ username / password å»æ§åˆ¶ Mysql
å…ˆåœ¨å¤šä¸€æ­¥ï¼Œå…ˆæ‹¿åˆ° VAULT TOKENï¼Œå†æ‹¿ TOKEN å»è·Ÿ Vault æ‹¿ Mysql passwordï¼Œå†å»é€£ MySQL&lt;/p&gt;
&lt;p&gt;å’¦é€™æ¨£ä¸æ˜¯å¾ˆæ€ªï¼Ÿæˆ‘å¦‚æœ Vault token æš´éœ²äº†ï¼Œæœ‰å¿ƒäººå£«é‚„æ˜¯å¯ä»¥å¾ vault æ‹¿åˆ°è³‡æ–™å•Š&lt;/p&gt;
&lt;p&gt;é€™æ¨£æœ‰æ¯”è¼ƒå®‰å…¨å—ï¼Ÿé‚„æ˜¯åªæ˜¯èŠ±å¼è¢«é§­&lt;/p&gt;
&lt;p&gt;å°ï¼Œåªæ˜¯åš token äº¤æ›çš„è©±ï¼Œé‚„æ˜¯ä¸å¤ ï¼Œæ‰€ä»¥ Vault æœ‰æä¾›è¨±å¤š Auth method&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;token åªæ˜¯å…¶ä¸­ä¸€ç¨®&lt;/li&gt;
&lt;li&gt;æœ‰å¾ˆå¤šèªè­‰æ–¹æ³•ä¸ç”¨ token äº¤æ›ï¼Œä½†ä¹Ÿèƒ½è®“ vault èªå¾— k8s pod èˆ‡ api server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™æ˜¯ä»Šå¤©çš„é‡é»ä¹‹ä¸€ï¼Œtoken / å¯†ç¢¼å‚³éä¸å®‰å…¨ï¼Œé‚£å°±ç”¨å…¶ä»–æ‰‹æ®µ auth&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»¥ AWS IAM auth ç‚ºä¾‹&lt;/p&gt;
&lt;p&gt;å¦‚æœä»Šå¤©æ˜¯åœ¨ aws ec2 ä¸Šè·‘ï¼Œé‚£å¯ä»¥é€é aws internal api å»å–å¾—èº«ä»½èªè­‰è³‡æ–™ï¼Œä¹Ÿå°±æ˜¯ ec2 instance metadata&lt;/p&gt;
&lt;p&gt;æ‹¿é€™å€‹ metadata å»å• vaultï¼Œvault å†é€é aws api å»ç¢ºèªï¼Œé€™å€‹ ec2 instance çœŸçš„æ˜¯åˆæ³•çš„&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œä¾æ“š ec2 instance èº«ä»½ï¼Œé…ç™¼æ¬Šé™è·Ÿè³‡æ–™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;api server ec2 å°±çµ¦ api server secret&lt;/li&gt;
&lt;li&gt;frontend server ec2 å°±çµ¦ frontend secret&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸­é–“æ²’æœ‰å¤šé¤˜çš„å¯†ç¢¼ / token äº¤æ›&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¾†å¾€çš„å°è©±å¤§æ¦‚æ˜¯é€™æ¨£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AWS API æ˜¯å¯ä¿¡çš„&lt;/li&gt;
&lt;li&gt;Vault è‡ªå·±ç¶­è­·æ˜¯å¯ä¿¡çš„&lt;/li&gt;
&lt;li&gt;æœå‹™é€éä¸‰æ–¹äº¤æ¡å»èªè­‰ï¼Œèª runtime ç’°å¢ƒçš„ metadataï¼Œä¸å†æ˜¯èª key ä¸èªäºº&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;è‡³æ–¼ api server ec2 è¿‘ä¾† vault å¾Œï¼Œæ‡‰è©²æœ‰ä»€éº¼æ¨£çš„æ¬Šé™ï¼Œåœ¨ vault å…§éƒ¨é€é policy é…ç½®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®š path&lt;/li&gt;
&lt;li&gt;è¨­å®šå…è¨±çš„ operation ä¾‹å¦‚ read write list delete &amp;hellip; ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;runtime å‹•æ…‹èª¿æ•´&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç•¶ç„¶ Vault é‚„æœ‰æä¾›å¾ˆå¤šæ›´åŠ å®‰å…¨çš„åŠŸèƒ½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚å¦‚ä½•å®‰å…¨åœ°å­˜æ”¾ secret&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Storage é€™é‚Šè·³é&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Secret + auth æ­é…è·³é&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»¥åŠ dynamic secretï¼Œä¾†è§£èª key ä¸èªäººçš„å•é¡Œ&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ mysql çš„éœæ…‹ username / passwordï¼Œé€é vault è¨­å®šå¯ä»¥è®Šæˆå‹•æ…‹çš„&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å›åˆ° k8sï¼Œä½¿ç”¨ token authï¼Œç„¶å¾ŒæŠŠ VAULT TOKEN æ”¾åœ¨ k8s secret è£é¢ï¼Œåªæœ‰æ¯”è¼ƒå®‰å…¨ä¸€é»é»&lt;/p&gt;
&lt;p&gt;å°±æ˜¯ VAULT TOKEN å¯ä»¥å¿«é€Ÿ rotate è·Ÿ revoke&lt;/p&gt;
&lt;p&gt;é€™é‚Šå¯ä»¥æ­é…å…¶ä»– auth æ–¹å¼ä¾†è§£æ±º&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å‰›å‰›ä¸æ˜¯è®“ vault å»èª aws ec2ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨ k8s ä¸­ï¼Œå¯ä»¥è®“ vault å»èª k8s cluster / service account&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è·¯å¾‘åœ–é•·é€™æ¨£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pod runtime éƒ½æœƒæœ‰ service account&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ service account çš„ metadata å»å• vault&lt;/li&gt;
&lt;li&gt;vault å»å• k8sï¼Œé€™å€‹ service account æ˜¯çœŸçš„å‡çš„&lt;/li&gt;
&lt;li&gt;k8s å›ç­” vaultï¼ŒPod è·Ÿservice account æ˜¯åˆæ³•çš„&lt;/li&gt;
&lt;li&gt;vault å†é…æ¬Šé™çµ¦ Pod&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;auth detail çš„æ–‡å­—æè¿°ï¼Œè·Ÿä¸Šé¢è¬›çš„ä¸€æ¨£&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é…åˆ k8s sidecarï¼Œå¯ä»¥æŠŠ vault æ‹¿åˆ°çš„ key å¯«åˆ° memory mount è£é¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pod init æ™‚ init container æ‰å» invoke vault API&lt;/li&gt;
&lt;li&gt;key ä¸æœƒé€é k8s api å‚³éï¼Œä¹Ÿä¸æœƒåœ¨ etcd å…§å‡ºç¾&lt;/li&gt;
&lt;li&gt;main container é€é memory mount å­˜å– key&lt;/li&gt;
&lt;li&gt;key çš„ lifecycle è·Ÿ pod ä¸€æ¨£ï¼Œ pod delete æ‰é€™çµ„ in-memory key ä¹Ÿè‡ªå‹•æ¸…é™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å¥½è™•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´å°‘ exposeï¼Œæ²’æœ‰é kube-api èˆ‡ etcd&lt;/li&gt;
&lt;li&gt;in-memory&lt;/li&gt;
&lt;li&gt;vault è·Ÿ pod ä¹‹é–“çš„ vault token çš„ time-to-live æœŸé™å¯ä»¥å¾ˆçŸ­ï¼Œå¹¾åç§’å…§ï¼Œinit å®Œå³å¯æ‹‹æ£„çš„ token&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å£è™•ï¼ˆï¼Ÿï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯å€‹ pod èµ·ä¾†æœƒå»æ‰“ vault api
&lt;ul&gt;
&lt;li&gt;å¯¦å‹™ç¶“é©—ä¸Š loading å¾ˆä½&lt;/li&gt;
&lt;li&gt;è€Œä¸” vault server å¯ä»¥åš HA è·Ÿ horizontal scaling&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€å¤§çš„æˆæœ¬ï¼Œå…¶å¯¦æ˜¯ vault è¨­å®š
&lt;ul&gt;
&lt;li&gt;è®“ vault èª k8s&lt;/li&gt;
&lt;li&gt;æ ¹æ“š service account å»é…æ¬Šé™&lt;/li&gt;
&lt;li&gt;å…¶ä»–èŠ±ä¿åŠŸèƒ½éƒ½éœ€è¦é¡å¤–çš„è¨­å®š&lt;/li&gt;
&lt;li&gt;ç³»çµ±è¤‡é›œï¼Œä¿è­‰é…åˆ°ä½ é ­æ˜çœ¼èŠ±&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;æƒ³åƒä¸€ä¸‹ï¼Œé€™å¼µåœ–é‡Œçš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;policy è·Ÿç‚ºæœå‹™æ•¸é‡å‘ˆæ­£æ¯”&lt;/li&gt;
&lt;li&gt;secret path ä¹Ÿè€•æœå‹™æ•¸é‡å‘ˆæ­£æ¯”&lt;/li&gt;
&lt;li&gt;auth k8s æ•¸é‡ä¹Ÿè·Ÿæœå‹™æ•¸é‡å‘ˆæ­£ç›¸é—œ&lt;/li&gt;
&lt;li&gt;ç”¨è¶Šä¹…ï¼Œå…§å®¹éš¨æ™‚é–“å¢åŠ &lt;/li&gt;
&lt;li&gt;æ”¹æ¶æ§‹æ™‚æ›´åˆºæ¿€&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å»ºè­°ä½¿ç”¨ vault å‹™å¿… æ­é… Terraform ç®¡ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;infrastructure as code&lt;/li&gt;
&lt;li&gt;configuration as code&lt;/li&gt;
&lt;li&gt;policy as code&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Terraform éå¸¸é©åˆç®¡ç†è¤‡é›œï¼Œä½†æœ‰å¸¸å¸¸éœ€è¦ç´°éƒ¨èª¿æ•´çš„è¨­å®šè³‡æ–™&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å…¶ä»–åŠŸèƒ½ï¼Œè·³é&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å…¶ä»–åŠŸèƒ½&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;secret debug è¶…éº»ç…©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…§å®¹æ­£ç¢ºæ€§ï¼Œvalid key é‚„æ˜¯ invalid keyï¼Œé‚„æ˜¯æ ¹æœ¬æ˜¯å¦ä¸€éš» key&lt;/li&gt;
&lt;li&gt;æ¬Šé™æ­£ç¢ºæ€§ï¼Œæ˜¯ä¸æ˜¯é€™å€‹ username / password çš„æ¬Šé™æ˜¯æ­£ç¢ºçš„&lt;/li&gt;
&lt;li&gt;è·¨åœ˜éšŠæºé€šæ›´é ­ç—›ï¼Œä¸æ˜¯å¯ä»¥è²¼åœ¨ slack å¤§å®¶ä¸€èµ·å¹«çœ‹çš„æ±è¥¿&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;terraform å¯ä»¥å¹«åŠ© vault è¨­å®š debug&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡³å°‘è·¨ç’°å¢ƒå¾©ç¾å•é¡Œå¾ˆæ–¹é‚Š&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Vault æœ‰ HA&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Vault Performance é€šå¸¸ä¸æ˜¯å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›–ç„¶ loading éš¨ micro service ç·šæ€§å¢åŠ &lt;/li&gt;
&lt;li&gt;ä½†æœ¬èº«å¯ä»¥æ˜¯ç„¡ç‹€æ…‹ serverï¼Œå¯ä»¥ horizontal scale&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;æ³¨æ„ä¸€ä¸‹ auto-retry&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pod fail restart åˆå† init ä¸€æ¬¡ï¼Œå¦‚æœä¸€è¬å€‹ pod ä¸€ç›´ retry å¯èƒ½çœŸçš„æœƒæŠŠ vault æ‰“çˆ†&lt;/li&gt;
&lt;li&gt;backup limit è¦æ³¨æ„&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ init container çš„è©±ï¼Œæ˜¯ cache åœ¨ Pod å±¤ç´šï¼Œcontainer fail restart ä¸æœƒé‡æ–°æ‰“ vault api&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å®‰å…¨æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;vault æœ‰å°ˆæ¥­è³‡å®‰åœ˜éšŠæŠŠé—œ&lt;/li&gt;
&lt;li&gt;ä¸è¦æ€• vault è¢«æ‰“ç©¿ï¼Œè€Œæ˜¯è¦æ€•åŒäº‹è¢«é‡£é­š&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;çµè«–&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è¦ä¸è¦ vault&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;qrcode æœ€å¾Œæ©Ÿæœƒ&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ‰å•é¡Œå¯ä»¥ä¾†ç¤¾ç¾¤æ‰¾æˆ‘&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Maicoin æ˜¯é–“å¥½å…¬å¸ 2014 æœå‹™ä¸Šç·šåˆ°ç¾åœ¨ï¼Œåœ¨å°ç£å·²ç¶“é‚å…¥ç¬¬å…«å¹´ã€‚é¡§å®¢æ•¸ä¸€ç›´å¢åŠ ï¼Œæˆ‘å€‘ä¹ŸæŒçºŒç·©æ…¢æ“´ç·¨ã€‚&lt;/p&gt;
&lt;p&gt;è¦ºå¾—è‡ªå·±æœ‰èƒ½åŠ›ï¼Œæ­¡è¿ä¾†æŒ‘æˆ°ï¼Œç­‰ç­‰ç§ä¸‹æ‰¾æˆ‘èŠ&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è¬è¬&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Q &amp;amp; A&lt;/p&gt;
&lt;p&gt;Terraform vs Pulumi&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ“ä½œèªè¨€å·®ç•°ï¼Œæœ‰å¥½æœ‰å£&lt;/li&gt;
&lt;li&gt;vault è·Ÿ terraform çš„ hcl æ˜¯å¢å¼·ç‰ˆ jsonï¼Œæœ¬è³ªé‚„æ˜¯ jsonï¼Œæœ‰èˆˆè¶£å¯ä»¥å»çœ‹æˆ‘çš„æ–‡ç« &lt;/li&gt;
&lt;li&gt;terraform ç›®å‰æ˜¯ç«™è·Ÿæ˜Ÿæ˜Ÿé‚„æ˜¯é ˜å…ˆï¼Œæœªä¾†ç¹¼çºŒçœ‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kubernetes Service account token è¦ä¸è¦æ›´æ–°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¦ï¼Œæ‡‰è©²å®šæœŸæ›´æ–°ï¼Œå®˜æ–¹æ–‡ä»¶æœ‰æ“ä½œæ­¥é©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Vault / Terraform å¯¦å‹™ä¸Šçš„å·¥ä½œè² æ“”æœƒå¾ˆèŠ±æ™‚é–“è·ŸäººåŠ›å—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­¸ç¿’æ›²ç·šæ¯”è¼ƒå¥‡æ€ªï¼Œè¦èŠ±ä¸€é»æ™‚é–“åšä¸­å­¸&lt;/li&gt;
&lt;li&gt;å­¸ç†Ÿäº†ä¹‹å¾Œå°±å¾ˆå¥½æ”¹ï¼Œæ•ˆç‡å¾ˆé«˜&lt;/li&gt;
&lt;li&gt;è‡³å°‘æ˜¯å±Œæ‰“ç”¨ gui æ”¹æˆ–æ˜¯ client ç›´æ¥ä¸‹ cmd æ‹‰&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2021 09 01 Ithome Ironman Go</title>
      <link>https://chechia.net/zh-hant/post/2021-09-01-ithome-ironman-go/</link>
      <pubDate>Wed, 01 Sep 2021 12:25:06 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2021-09-01-ithome-ironman-go/</guid>
      <description>&lt;p&gt;2021 ithome éµäººè³½é–‹è·‘äº†ï½&lt;/p&gt;
&lt;p&gt;ä»Šå¹´çš„é¡Œç›®æ˜¯ã€ŒTerraform Workshop - Infrastructure as Code for Public Cloud ç–«æƒ…è­¦æˆ’é™ªä½ åº¦é 30 å¤©ã€ï¼Œæ˜¯ä¸€å€‹é•·é” 30 å¤©çš„ terraform workshopï¼Œå° terraform æœ‰èˆˆè¶£çš„æœ‹å‹æ­¡è¿è¿½ç¸±&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10258904&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Day 01 - å¼•è¨€ï¼šTerraform æ˜¯å€‹å¥½æ±è¥¿ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-30-days&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èª²ç¨‹å…§å®¹èˆ‡ä»£ç¢¼æœƒæ”¾åœ¨ Github ä¸Š: https://github.com/chechiachang/terraform-30-days&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://chechia.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³½å¾Œæ–‡ç« æœƒæ•´ç†æ”¾åˆ°å€‹äººçš„éƒ¨è½æ ¼ä¸Š http://chechia.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¹¤ç²‰å°ˆå¯ä»¥æ”¶åˆ°æ–‡ç« çš„ä¸»å‹•æ¨æ’­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; alt=&#34;https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>DevOps Taiwan Meetup #33: Hashicorp Vault for Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2021-05-13-devops-taiwan-33-hashicorp-vault-for-kubernetes-apps/</link>
      <pubDate>Thu, 13 May 2021 16:29:26 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2021-05-13-devops-taiwan-33-hashicorp-vault-for-kubernetes-apps/</guid>
      <description>&lt;h1 id=&#34;event&#34;&gt;Event&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://devops.kktix.cc/events/meetup33-maicoin-devops-taiwan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://devops.kktix.cc/events/meetup33-maicoin-devops-taiwan&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://youtu.be/8hEifTAWnY0?t=3269&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://youtu.be/8hEifTAWnY0?t=3269&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;audience: 90/90&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;resources&#34;&gt;resources&lt;/h1&gt;
&lt;p&gt;this presentation&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction-a56697&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://slides.com/chechiachang/terraform-introduction-a56697&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;github&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-azure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terraform-azure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/vault-playground/tree/master/deploy/v0.8.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/vault-playground/tree/master/deploy/v0.8.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code: Atlantis</title>
      <link>https://chechia.net/zh-hant/post/2020-10-07-terraform-infrastructure-as-code-atlantis/</link>
      <pubDate>Wed, 07 Oct 2020 11:15:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-10-07-terraform-infrastructure-as-code-atlantis/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;éœ€æ±‚èˆ‡å•é¡Œ&#34;&gt;éœ€æ±‚èˆ‡å•é¡Œ&lt;/h1&gt;
&lt;p&gt;éš¨è‘— terraform åœ¨åœ˜éšŠå…§çš„è¦æ¨¡æŒçºŒæˆé•·ï¼Œåœ˜éšŠéœ€è¦è®“å·¥ä½œæµç¨‹æ›´åŠ é †æš¢ï¼Œä¾†é¢å°å¤§é‡çš„ tf è®Šæ›´æŸ¥æ ¸èˆ‡è®Šæ›´è«‹æ±‚ã€‚æƒ³åƒå¹¾åå€‹å·¥ç¨‹å¸«åŒæ™‚åœ¨ä¿®æ”¹å¹¾åå€‹ä¸åŒçš„ terraform projects / modulesï¼Œé€™æ™‚å¯èƒ½æœƒæœ‰å¹¾å€‹å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ä¸€å€‹ç©©å®šä¹¾æ·¨çš„ç’°å¢ƒåŸ·è¡Œ terraform
&lt;ul&gt;
&lt;li&gt;å·¥ç¨‹å¸«çš„é–‹ç™¼æœ¬æ©Ÿä¸æ˜¯å€‹å¥½é¸æ“‡&lt;/li&gt;
&lt;li&gt;éœ€è¦ 24/7 çš„ terraform åŸ·è¡Œä¸­å¿ƒ
&lt;ul&gt;
&lt;li&gt;åŸ·è¡Œä¸­å¿ƒæœƒæœ‰å„å€‹ç’°å¢ƒ (dev / stage / prod) çš„å­˜å–æ¬Šé™ï¼Œå¸Œæœ›è¨­ç½®åœ¨å…§éƒ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸‹åˆ—å…©å€‹å·¥ä½œæœƒåˆ‡æ›å·¥ä½œå¹³å°ï¼Œä¾‹å¦‚ Github
&lt;ul&gt;
&lt;li&gt;reviewï¼Œæª¢è¦– differenceï¼Œèˆ‡è¨è«–&lt;/li&gt;
&lt;li&gt;PR&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;review å®Œæœ‰æ™‚æœƒå¿˜è¨˜ mergeï¼Œmerge å®Œæœ‰æ™‚æœƒå¿˜è¨˜ apply
&lt;ul&gt;
&lt;li&gt;repository è¶Šå¤šï¼Œå¿˜å¾—è¶Šå¤š&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ˜éšŠå·²ç¶“å°å…¥ Git-flowï¼Œå¸Œæœ›æŠŠå·¥ä½œæµç¨‹åšå¾—æ›´å®Œæ•´è‡ªå‹•åŒ–æ›´åŠ ä¾¿åˆ©&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.runatlantis.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Atlantis è§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;æ˜¯èˆ‡ç‰ˆæœ¬æ§åˆ¶æ•´åˆï¼Œæä¾› terraform åŸ·è¡Œçš„ workerï¼Œç—…å¯ä»¥èˆ‡ Git Host (e.g. Github) æ•´åˆåš PR + Reviewï¼Œä¾†é”æˆæŒçºŒçš„ CI/CD é ç«¯åŸ·è¡Œï¼Œè‡ªå‹• plan èˆ‡è‡ªå‹• apply mergeã€‚ä¹Ÿå°±æ˜¯ Atlantis å¹«æˆ‘å€‘è™•ç†ä»¥ä¸‹å¹¾ä»¶äº‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Git-flow&lt;/li&gt;
&lt;li&gt;TODO è‡ªå‹•åŒ– plan&lt;/li&gt;
&lt;li&gt;TODO Webhook å›å‚³ plan çµæœ&lt;/li&gt;
&lt;li&gt;TODO é€é bot æ§åˆ¶ apply&lt;/li&gt;
&lt;li&gt;TODO è‡ªå‹• merge&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;éœ€æ±‚èˆ‡å·¥ä½œæµç¨‹&#34;&gt;éœ€æ±‚èˆ‡å·¥ä½œæµç¨‹&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸‹çš„ç¯„ä¾‹ä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Github ä½œç‚ºç‰ˆæœ¬æ§ç®¡å·¥å…·
&lt;ul&gt;
&lt;li&gt;æ˜¯æ•´å€‹å·¥ä½œæµç¨‹çš„æ§åˆ¶ä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;tf codeï¼Œreviewï¼Œplanï¼Œapply çš„çµæœéƒ½æœƒåœ¨ Github&lt;/li&gt;
&lt;li&gt;é€²ä¸€æ­¥æ•´åˆåˆ° Slack ä¸Šä¹Ÿéå¸¸æ–¹ä¾¿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Atlantis æ”¾åœ¨ Kubernetes ä¸Š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ helm chart éƒ¨ç½²&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœéœ€è¦å…¶ä»–çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·æˆ–æ˜¯å®‰è£æ–¹å¼ï¼Œè«‹è¦‹&lt;a href=&#34;https://www.runatlantis.io/docs/installation-guide.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Atlantis å®˜æ–¹æ–‡ä»¶&lt;/a&gt;ï¼ŒAtlantis æ”¯æ´éå¸¸å¤šç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œä¾‹å¦‚ Githubï¼ŒGitlabï¼ŒBitbucketï¼Œ&amp;hellip;ç­‰&lt;/p&gt;
&lt;p&gt;æ•´å€‹å·¥ä½œæµç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Github commit push
&lt;ul&gt;
&lt;li&gt;Github event -&amp;gt; Atlantis webhook&lt;/li&gt;
&lt;li&gt;Atlantis run terraform validate plan&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Github PR push
&lt;ul&gt;
&lt;li&gt;Github event -&amp;gt; Atlantis webhook&lt;/li&gt;
&lt;li&gt;Atlantis run terraform validate plan&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Github Merge event / main branch push
&lt;ul&gt;
&lt;li&gt;Github event -&amp;gt; Atlantis webhook&lt;/li&gt;
&lt;li&gt;Atlantis run terraform validate plan&lt;/li&gt;
&lt;li&gt;Atlantis acquire access to site (dev / stage)&lt;/li&gt;
&lt;li&gt;Atlantis apply to site&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Github release tag push (eg. 1.2.0-rc)
&lt;ul&gt;
&lt;li&gt;Github event -&amp;gt; Atlantis webhook&lt;/li&gt;
&lt;li&gt;Atlantis run terraform validate plan&lt;/li&gt;
&lt;li&gt;Atlantis acquire access to site (dev/stage)&lt;/li&gt;
&lt;li&gt;Atlantis apply to site (release-candidate / prod)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾æ“šä¸Šé¢çš„ç’°å¢ƒï¼Œå®‰è£éœ€è¦æº–å‚™ä»¥ä¸‹å¹¾å€‹æ±è¥¿&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Git
&lt;ul&gt;
&lt;li&gt;Git Host ä¸Šè¨­å®š Atlantis å­˜å– Git Repository çš„æ¬Šé™&lt;/li&gt;
&lt;li&gt;ç‚º Git Host è¨­å®šå­˜å–ç§é‘°ï¼Œè®“ Atlantis èªè­‰ webhook&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Terraform Backend State storage: Atlantis éœ€è¦å­˜å–å¤–éƒ¨çš„ state storage&lt;/li&gt;
&lt;li&gt;Terraform ä½¿ç”¨çš„ç‰ˆæœ¬è¦æ³¨æ„ä¸€ä¸‹ã€‚Atlantis å¯ä»¥æ”¯æ´ä¸åŒ repository / project ä½¿ç”¨ä¸åŒç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;Environment credential (provider credential)
&lt;ul&gt;
&lt;li&gt;Atlantis æœƒéœ€è¦å­˜å–ä¸åŒçš„ç’°å¢ƒ (dev / stage / prod)&lt;/li&gt;
&lt;li&gt;ç‚ºé€™äº›ç’°å¢ƒç¨ç«‹é…ç½® credential è®“ Atlantis å­˜å–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¦éš› Atlantis çš„ç’°å¢ƒæœƒæœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Docker ä½œç‚ºå­¤åŸå¸«æœ¬æ©Ÿé–‹ç™¼æ¸¬è©¦ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;Kubernetes Atlantis
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘çš„åœ˜éšŠæœƒæ˜¯ä¸€å€‹ç’°å¢ƒä¸€å€‹ç¨ç«‹çš„ Atlantis
&lt;ul&gt;
&lt;li&gt;å®‰å…¨æ€§ï¼šåˆ‡åˆ†å„å€‹ç’°å¢ƒçš„æ¬Šé™èˆ‡ Access&lt;/li&gt;
&lt;li&gt;å„å€‹ Atlantis webhook åªæ¥æ”¶å±¬æ–¼è‡ªå·±çš„ event&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;docker&#34;&gt;Docker&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ Docker ä½œç‚ºæœ¬åœ°é–‹ç™¼èˆ‡æ¸¬è©¦çš„å®¹å™¨ runtimeï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker pull runatlantis/atlantis:v0.15.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker run runatlantis/atlantis:v0.15.0 atlantis \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --gh-user=GITHUB_USERNAME \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --gh-token=GITHUB_TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;helm-chart&#34;&gt;Helm Chart&lt;/h3&gt;
&lt;p&gt;Helm çš„å®‰è£ååˆ†ç°¡æ˜“&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add runatlantis https://runatlantis.github.io/helm-charts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm inspect values runatlantis/atlantis &amp;gt; values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›´æ”¹ values.yaml&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;github:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  user: chechiachang
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  token: ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  secret: ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;orgWhitelist: github.com/chechiachang/*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£åˆ° Kubernetes ä¸Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install atlantis runatlantis/atlantis -f values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;çµæœ&#34;&gt;çµæœ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å·¥ç¨‹å¸«é€é Github å°±å¯ä»¥å®Œæˆæ‰€æœ‰å·¥ä½œ
&lt;ul&gt;
&lt;li&gt;åŠ ä¸Š Github Slack æ•´åˆï¼Œå°±å®Œå…¨ä¸ç”¨é›¢é–‹ Slackï¼Œè·Ÿ bot èŠå¤©å°±å¯ä»¥å®Œæˆæ‰€æœ‰ terraform å·¥ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®‰å…¨ç©©å®šçš„ terraform åŸ·è¡Œç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;ç¨ç«‹çš„ in-cluster credentialï¼Œé›†ç¾¤çš„å­˜å–æ¬Šé™éƒ½æ§åˆ¶åœ¨é›†ç¾¤å…§ï¼Œä¸æœƒæš´éœ²åˆ°å¤–éƒ¨ç’°å¢ƒ&lt;/li&gt;
&lt;li&gt;è‡ªå‹• plan èˆ‡ applyï¼Œä¸æœƒéºå¿˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å„ªåŠ£&#34;&gt;å„ªåŠ£&lt;/h1&gt;
&lt;p&gt;å„ªé»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ self-hostedï¼Œcredential ä¸å¤–æ´©ï¼Œç¢ºä¿æœ€é«˜çš„å®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;å·²ç¶“æ•´åˆ Kubernetes, helm chart&lt;/li&gt;
&lt;li&gt;webhook æ•´åˆè¨±å¤šç‰ˆæœ¬æ§åˆ¶åº«ï¼Œä¾‹å¦‚ github, gitlab,&amp;hellip;&lt;/li&gt;
&lt;li&gt;å¯¦ç¾å®‰å…¨çš„é ç«¯åŸ·è¡Œ
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°åŸ·è¡Œé‚„æ˜¯æœƒæœ‰è«¸å¤šå•é¡Œ&lt;/li&gt;
&lt;li&gt;terraform cloud æä¾›çš„é ç«¯åŸ·è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºé»ï¼Œå…¶å¯¦æ²’ä»€éº¼ç¼ºé»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°±éœ€è¦å¤šé¤Šä¸€çµ„ Atlantis
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ stateless deploymentï¼Œå…¶å¯¦æ˜¯æ‡‰è©²ä¸æœƒæœ‰ä»€éº¼è² æ“”&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Terraform ç³»åˆ—è‡³æ­¤æ‡‰è©²æ˜¯å…¨éƒ¨å®Œçµï¼Œæ„Ÿè¬å„ä½&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code: Terragrunt</title>
      <link>https://chechia.net/zh-hant/post/2020-10-06-terraform-infrastructure-as-code-terragrunt/</link>
      <pubDate>Tue, 06 Oct 2020 11:15:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-10-06-terraform-infrastructure-as-code-terragrunt/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸Šé¢è¬›è§£ Terraform çš„åŸºæœ¬æ“ä½œæµç¨‹ï¼Œæä¾›ç¯„æœ¬åŸå§‹ç¢¼ï¼Œä»¥åŠä¸€æ­¥ä¸€æ­¥å°å…¥çš„è©³ç´°æ­¥é©Ÿã€‚å„ä½æ‡‰è©²éƒ½å¯ä»¥ä¾ç…§ä¸Šé¢å¹¾ç¯‡çš„èªªæ˜ï¼Œé–‹å§‹å¿«æ¨‚çš„ä½¿ç”¨ Terraform äº†ã€‚&lt;/p&gt;
&lt;p&gt;è€Œç•¶ä½¿ç”¨ Terraform çš„è¦æ¨¡è¶Šä¾†è¶Šå¤§ï¼Œç®¡ç†çš„è³‡æ–™è¶Šä¾†è¶Šå¤šæ™‚ï¼Œé–‹å§‹æœƒå‡ºç¾ä¸€äº›å•é¡Œï¼Œä¾‹å¦‚é‡è¤‡çš„ terraform code è¶Šä¾†è¶Šå¤šï¼Œå”åŒå·¥ä½œ review ä¸å¤ªå®¹æ˜“ï¼Œstate çš„å…§å®¹ç®¡ç†èˆ‡é–ç®¡ç†ï¼Œç­‰ç­‰ã€‚é€™äº›å•é¡Œå¯ä»¥é€éä¸€äº›å·¥ä½œæµç¨‹çš„æ”¹é€²ï¼Œæˆ–æ˜¯å°å…¥æ–°çš„å°å·¥å…·ï¼Œä¾†æ”¹å–„å·¥ä½œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹ä¾†ç­†è€…æ¨è–¦å¹¾å€‹å¿ƒå¾—èˆ‡å·¥å…·ï¼Œå¸Œæœ›èƒ½æå‡ä½¿ç”¨ Terraform çš„æ•ˆç‡èˆ‡ç”¢å€¼&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å¹¾ç¯‡æ–‡ç« ï¼Œé©åˆå·²ç¶“ä½¿ç”¨é terraform ä¸€é»æ™‚é–“ï¼Œæœ‰ç¶“é©—çš„åœ˜éšŠï¼Œä¸¦æ‰“ç®—æ›´å¤§è¦æ¨¡å°å…¥ terraformï¼Œæ­£åœ¨å°‹æ±‚æ”¹å–„çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿ƒå¾—
&lt;ul&gt;
&lt;li&gt;CI/CD å…¨è‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;State backend é¸æ“‡&lt;/li&gt;
&lt;li&gt;æœ€ä½³å¯¦è¸ &lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·¥å…·
&lt;ul&gt;
&lt;li&gt;Terraform Atlantis&lt;/li&gt;
&lt;li&gt;Terragrunt&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å•é¡Œèˆ‡éœ€æ±‚&#34;&gt;å•é¡Œèˆ‡éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;ç•¶åœ˜éšŠå·²ç¶“é–‹å§‹å¤§è¦æ¨¡ä½¿ç”¨ terraformï¼Œtf æª”æ¡ˆè¶Šä¾†è¶Šå¤šã€‚æˆ‘å€‘ç‚ºäº†å¢åŠ ç¨‹å¼ç¢¼çš„é‡è¤‡åˆ©ç”¨æ€§ï¼Œæœƒä½¿ç”¨ terraform module å°‡å¸¸ç”¨çš„ tf æª”æ¡ˆå°è£ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éš¨è‘—å°å…¥çš„è¦æ¨¡è¶Šä¾†è¶Šå¤§ï¼Œé€™äº› module æœƒè¶Šä¾†è¶Šå¤šï¼Œè€Œä¸”ä½¿ç”¨é€™äº› module çš„ project ä¹Ÿå¢åŠ &lt;/li&gt;
&lt;li&gt;éš¨è‘—ç®¡ç†çš„ infrastructure è¶Šä¾†è¶Šè¤‡é›œï¼Œç‚ºäº†æè¿°é€™äº›æœ¬ä¾†å°±å¾ˆè¤‡é›œçš„ infrastructureï¼Œmodule ä¸åªè¶Šä¾†è¶Šå¤šï¼Œé‚„æœƒå‡ºç¾ module å¼•ç”¨å…¶ä»– moduleï¼Œå¤§ module ä½¿ç”¨å° module çš„ nested module
&lt;ul&gt;
&lt;li&gt;é€™é»åœ¨è¤‡é›œçš„ provider ä¸­å¸¸å‡ºç¾ï¼Œä¾‹å¦‚
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ terraform æè¿°ç¶²è·¯æ¶æ§‹&lt;/li&gt;
&lt;li&gt;æè¿°è¤‡é›œçš„ IAM &amp;amp; Role&lt;/li&gt;
&lt;li&gt;terraform vault-provider&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç®¡ç†çš„ç’°å¢ƒè¶Šä¾†è¶Šå¤šï¼Œä¾‹å¦‚ dev, staging, prod,&amp;hellip;ï¼Œæ¯å€‹ç’°å¢ƒéƒ½éœ€è¦ç¨ç«‹çš„å·¥ä½œç©ºé–“ï¼Œé€ æˆå¤§é‡é‡è¤‡çš„ tf code&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ä¸€æ®µæ™‚é–“ terraform ï¼Œå¾ˆå¿«å°±æœƒç™¼ç¾çš„ç¬¬ä¸€å€‹å•é¡Œæ˜¯ï¼šä¸è«–æ€éº¼å¾ tf æª”æ¡ˆä¸­æå–é‡è¤‡éƒ¨åˆ†ï¼Œåšæˆ moduleï¼Œé‚„æ˜¯æœ‰å¾ˆå¤šéƒ¨åˆ†çš„ tf code æ˜¯å®Œå…¨é‡è¤‡çš„ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯å€‹ module æœƒå®šç¾©çš„ variable (argument)ï¼Œä½¿ç”¨é€™å€‹ module çš„ä¸Šå±¤æœƒéœ€è¦æä¾›å‚³å…¥ variable&lt;/li&gt;
&lt;li&gt;æ¯å€‹ module éƒ½æœƒéœ€è¦æä¾› provider&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Terraform çš„èªæ³•è¦æ±‚ä¸Šé¢é€™äº›åƒæ•¸éƒ½æ˜ç¢ºçš„å®šç¾©ï¼Œé€™è®“æ•´å€‹ module æˆ–è³‡æ–™å¤¾çš„æè¿°éå¸¸æ¸…æ¥šã€‚ä½†æœƒè™•å°±æ˜¯ï¼Œé€™äº›æè¿°çš„åƒæ•¸é“å‡ºéƒ½æ˜¯ï¼Œè€Œä¸”ä¸æ–·çš„é‡è¤‡ï¼Œæ¯å€‹ module æˆ–è³‡æ–™å¤¾éƒ½è¦æä¾›ï¼Œä¸ç„¶åœ¨ terraform validate æ™‚æœƒå› ç‚ºæ‡‰æä¾›åƒæ•¸æœªæä¾›ï¼Œå°è‡´éŒ¯èª¤ã€‚é›–ç„¶ç«‹æ„è‰¯å¥½ï¼Œä½†å»åš´é‡é•å DRY (Don&amp;rsquo;t Repeat Yourself) çš„åŸå‰‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;module å¤šå±¤å¼•ç”¨ï¼Œproject å¼•ç”¨å¤§ moduleï¼Œå¤§ module åˆå¼•ç”¨å° module&lt;/li&gt;
&lt;li&gt;é–‹å§‹æ„Ÿè¦º backend èˆ‡ provider çš„ code æ¯”å…¶ä»–åŠŸèƒ½ code å¤šäº†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰æ²’æœ‰å¯èƒ½ç”¨å…¶ä»–å·¥å…·ï¼Œé¿å…é€™äº›é‡è¤‡çš„åƒæ•¸ï¼Œbackendï¼Œprovider ç­‰ç­‰ï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;terragrunt&#34;&gt;Terragrunt&lt;/h1&gt;
&lt;p&gt;æ¨è–¦æœ‰å¤§é‡ä½¿ç”¨çš„åœ˜éšŠï¼Œç›´æ¥ä½¿ç”¨ &lt;a href=&#34;https://terragrunt.gruntwork.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terragrunt&lt;/a&gt; é€™æ¬¾å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ä»–æ˜¯ä¸€å±¤ terraform çš„ wrapper&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;i.e. åŸ·è¡Œ terraform plan -&amp;gt; terragrunt plan&lt;/li&gt;
&lt;li&gt;terragrunt æœƒå…ˆè§£æï¼Œç”¢ç”Ÿé‡è¤‡çš„ codeï¼Œç„¶å¾Œå†åŸ·è¡Œ terraform&lt;/li&gt;
&lt;li&gt;ç·¨è¼¯æ™‚åªè¦å¯«ä¸€æ¬¡ï¼Œterragrunt ä»£ç‚ºåœ¨å…¶ä»–åœ°æ–¹ç”¢ç”Ÿé‡è¤‡çš„ code&lt;/li&gt;
&lt;li&gt;ç”¢ç”Ÿçš„ code æœƒè¢«éš±è—èˆ‡ cache&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Terragrunt æœ‰è¨±å¤šåŠŸèƒ½ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è™•ç† Backendï¼Œproviderï¼Œèˆ‡å…¶ä»–ä¸æ–·é‡è¤‡çš„ tf code&lt;/li&gt;
&lt;li&gt;è™•ç†å¤šç’°å¢ƒä¸‹é‡è¤‡çš„ tf&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;a href=&#34;https://terragrunt.gruntwork.io/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´åŠŸèƒ½è«‹è¦‹å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°å…¥ Terragrunt å¯ä»¥é¿å…é‡è¤‡ä»£ç¢¼ï¼Œé™ä½ç¶­è­·æˆæœ¬ï¼Œæå‡ç”Ÿç”¢æ•ˆç‡&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨æƒ…å¢ƒ&#34;&gt;ä½¿ç”¨æƒ…å¢ƒ&lt;/h1&gt;
&lt;p&gt;ä¸Šè¿°èªªæ˜å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œæˆ‘å€‘å¯¦éš›çœ‹ç¯„ä¾‹ï¼Œä»¥&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‰å¹¾ç¯‡æˆ‘å€‘ä½¿ç”¨çš„ç¯„ä¾‹ repository&lt;/a&gt; ç‚ºä¾‹å­ï¼ŒæŠŠ gcp çš„è³‡æ–™å¤¾ç›®éŒ„æ‡‰è©²é•·é€™æ¨£ï¼š&lt;/p&gt;
&lt;p&gt;å¯ä»¥å¾ˆæ¸…æ¥šè¦‹åˆ°åº•ä¸‹å¹¾å€‹æ±è¥¿ä¸æ–·é‡è¤‡
ç”±æ–¼ my-new-project, gke-playground, national-team-5g ä¸‰å€‹å°ˆæ¡ˆæ˜¯ç¨ç«‹çš„å°ˆæ¡ˆï¼Œå„è‡ªå¯ä»¥ç¨ç«‹é‹è¡Œã€‚ä½†å…¶å¯¦åŒå±¬æ–¼åŒå…¬å¸çš„å°ˆæ¡ˆï¼Œå¯èƒ½è¨±å¤šå…§å®¹éƒ½æ˜¯é‡è¤‡çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tree gcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ my-new-project/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ terraform.tfvars
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ variable.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ gke-playground/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ terraform.tfvars
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ variable.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ national-team-5g/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ variable.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ stag
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ variable.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â”œâ”€â”€ terraform.tfvars
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â”œâ”€â”€ variable.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â””â”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ templates/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ modules/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥å¾ˆæ¸…æ¥šè¦‹åˆ°åº•ä¸‹å¹¾å€‹æ±è¥¿ä¸æ–·é‡è¤‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;provider.tf é€™è£¡æè¿°ä½¿ç”¨çš„ providerï¼Œé€™é‚Šåªæœ‰ä½¿ç”¨ gcp providerï¼Œæ‰€ä»¥æ˜¯å®Œå…¨ä¸€æ¨£é‡è¤‡&lt;/li&gt;
&lt;li&gt;variable.tf æ˜¯å®šç¾©çš„åƒæ•¸&lt;/li&gt;
&lt;li&gt;terraform.tfvars æ˜¯å‚³å…¥çš„åƒæ•¸ï¼Œä¹Ÿå°±æ˜¯å¯¦éš›å„å°ˆæ¡ˆå„è‡ªçš„åŸ·è¡Œåƒæ•¸&lt;/li&gt;
&lt;li&gt;national-team-5g çš„å°ˆæ¡ˆä¸‹ï¼Œåˆå„è‡ªæ‹†åˆ†å¤šå€‹åŸ·è¡Œç’°å¢ƒï¼Œæ¯å€‹ç’°å¢ƒç¨ç«‹ï¼Œæ‰€ä»¥åˆæœ‰è¨±å¤šé‡è¤‡çš„ code&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šçš„ç›®çš„ï¼Œæ˜¯æœ‰ç³»çµ±åŒ–çš„è™•ç†é€™äº›é‡è¤‡çš„ä»£ç¢¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ terraform.tfvars        # gcp å…±ç”¨çš„åƒæ•¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ terragrunt.hcl          # gcp å…±ç”¨çš„ç¨‹å¼ç¢¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ national-team-5g/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ terraform.tfvars    # national-team-5g å…±ç”¨çš„åƒæ•¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ terragrunt.hcl      # national-team-5g å…±ç”¨çš„ç¨‹å¼ç¢¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars  # dev çš„åƒæ•¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ terragrunt.hcl    # dev ç’°å¢ƒè‡ªå·±çš„ç¨‹å¼ç¢¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ staging
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars  # staging çš„åƒæ•¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ terragrunt.hcl    # staging ç’°å¢ƒè‡ªå·±çš„ç¨‹å¼ç¢¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â”œâ”€â”€ terraform.tfvars  # prod çš„åƒæ•¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â””â”€â”€ terragrunt.hcl    # prod ç’°å¢ƒè‡ªå·±çš„ç¨‹å¼ç¢¼
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å·®ç•°éå¸¸å¤šæ˜¯å§ï¼Œä½†é€™é‚Šåªæ˜¯å¾è³‡æ–™ç›®éŒ„çµæ§‹çœ‹ï¼Œå…¶å¯¦å¦‚æœå¾ tf æª”æ¡ˆå…§éƒ¨çš„ç¨‹å¼ç¢¼çœ‹ï¼Œè£¡é¢çš„ä»£ç¢¼æ›´æ˜¯ç²¾ç°¡åˆ°ä¸è¡Œï¼Œç”¨èµ·ä¾†éå¸¸çš„çˆ½XD&lt;/p&gt;
&lt;h1 id=&#34;å®‰è£&#34;&gt;å®‰è£&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å» release é é¢æ‰¾é©åˆçš„åŸ·è¡Œæª”æ¡ˆ&lt;/li&gt;
&lt;li&gt;ä¸‹è¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod u+x terragrunt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv terragrunt /usr/local/bin/terragrunt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://terragrunt.gruntwork.io/docs/getting-started/quick-start/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è©³ç´°æ–‡ä»¶è«‹è¦‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç¯„ä¾‹&#34;&gt;ç¯„ä¾‹&lt;/h1&gt;
&lt;p&gt;Terragrunt çš„ DRY featureï¼Œå…¶å¯¦å…§å®¹éƒ½å¤§åŒå°ç•°&lt;/p&gt;
&lt;p&gt;â”œâ”€â”€ national-team-5g/
â”‚Â Â  â”œâ”€â”€ dev
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars  # staging çš„åƒæ•¸
â”‚Â Â  â”‚Â Â  â””â”€â”€ provider.tf
â”‚Â Â  â”œâ”€â”€ stag
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars  # staging çš„åƒæ•¸
â”‚Â Â  â”‚Â Â  â””â”€â”€ provider.tf
â”‚Â Â  â””â”€â”€ prod
â”‚Â Â      â”œâ”€â”€ terraform.tfvars  # prod çš„åƒæ•¸
â”‚Â Â      â””â”€â”€ provider.tf&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;p&gt;national-team-5g/dev/provider.tf&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;provider &amp;#34;google&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  version = &amp;#34;~&amp;gt;v3.25.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  credentials = file(var.credential_json)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  project = var.project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  region  = var.region
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”¹æˆ&lt;/p&gt;
&lt;p&gt;national-team-5g/dev/terragrunt.hcl&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;generate &amp;#34;provider&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  path      = &amp;#34;provider.tf&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  if_exists = &amp;#34;overwrite&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  contents = &amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;provider &amp;#34;google&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  version = &amp;#34;~&amp;gt;v3.25.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  credentials = file(var.credential_json)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  project = var.project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  region  = var.region
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸ·è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd national-team-5g/dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terragrunt plan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é—œæ–¼åƒæ•¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;var.region æ˜¯æœ¬åœ°åƒæ•¸ï¼Œå¯ä»¥ä¾æ“š dev/staging/prod åƒæ•¸å„è‡ªè¨­å®š&lt;/li&gt;
&lt;li&gt;var.project é€™å€‹æ˜¯æ•´å€‹ national-team-5g éƒ½å…±ç”¨çš„åƒæ•¸ï¼Œå¯ä»¥é€²ä¸€æ­¥æé«˜åˆ°æ›´ä¸Šå±¤
&lt;ul&gt;
&lt;li&gt;i.g. æ”¾åœ¨ national-team-5g/terraform.tfvars æª”æ¡ˆè£¡é¢ï¼Œé€é terragrunt.hcl å‚³éã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;functions&#34;&gt;Functions&lt;/h1&gt;
&lt;p&gt;tf æª”æ¡ˆï¼Œåœ¨è¨±å¤š block ä¸­ç¦æ­¢ä½¿ç”¨ variableï¼Œé€™å±¤é™åˆ¶æœ‰å…¶è€ƒé‡ï¼Œä½†æ˜¯ç¼ºé»æ˜¯é€ æˆè¨±å¤š hard coded çš„ç¨‹å¼ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;Terragrunt ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼ï¼Œç”±æ–¼æ˜¯åœ¨ terragrunt åŸ·è¡Œå¾Œï¼Œterraform åŸ·è¡Œå‰ï¼Œå› æ¬¡æ²’æœ‰é€™å±¤é™åˆ¶ï¼Œå¯ä»¥åšè¨±å¤šäº‹æƒ…ï¼Œä¾‹å¦‚ code generate ä»¥åŠ function é‹ç®—ï¼Œterragrunt æä¾›è¨±å¤šå…§å»º functionï¼Œé€™é‚Šåªä»‹ç´¹å¸¸ç”¨å¹¾å€‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;find_in_parent_folder()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;path_relative_to_include()&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¯„ä¾‹å…©å€‹æª”æ¡ˆ&lt;/p&gt;
&lt;p&gt;project/dev/terraform.hcl&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;include {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  path = find_in_parent_folders()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;project/terraform.hcl&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;env = path_relative_to_include()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€å¾Œ parse å¾Œçš„çµæœ&lt;/p&gt;
&lt;p&gt;project/dev/terraform.hcl&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;env = &amp;#34;dev&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åšäº†å…©ä»¶äº‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¦æ±‚ project/dev å»ä¸Šå±¤å°‹æ‰¾ terraform.hclï¼Œä¸¦ä¸”å¼•å…¥å…¶ä¸­çš„è¨­å®š (env=&amp;quot;&amp;quot;)
&lt;ul&gt;
&lt;li&gt;å­å°ˆæ¡ˆå¯ä»¥ include æ¯è³‡æ–™å¤¾çš„ç¨‹å¼ç¢¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŒ¯å…¥ä¸Šå±¤ project æ™‚ï¼Œå¯«å…¥ç›¸å°çš„è·¯å¾‘ (dev)ï¼Œä¸¦ä¸”å¸¶å…¥ (env=&amp;ldquo;dev&amp;rdquo;)
&lt;ul&gt;
&lt;li&gt;æ¯å°ˆæ¡ˆå¯ä»¥ç‚ºå„å€‹å­ç›®éŒ„é…ç½®ç›¸å°è·¯å¾‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://terragrunt.gruntwork.io/docs/reference/built-in-functions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¶ä»–å…§å»º function è«‹è¦‹å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;p&gt;Terragrunt å¯ä»¥ç²¾ç°¡ç¨‹å¼ç¢¼ï¼Œå¤§ç¦æå‡ç”Ÿç”¢æ•ˆç‡ï¼Œç„¶è€Œåœ¨é‚„ä¸ç†Ÿæ‚‰ terraform æ ¸å¿ƒåŠŸèƒ½ä¹‹å‰ï¼Œä¸å»ºè­°éæ—©å°å…¥ï¼Œæœƒå°è‡´å¤šé¤˜çš„å­¸ç¿’æˆæœ¬ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code: Recommended Practices</title>
      <link>https://chechia.net/zh-hant/post/2020-10-05-terraform-infrastructure-as-code-recommended-practices/</link>
      <pubDate>Mon, 05 Oct 2020 11:15:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-10-05-terraform-infrastructure-as-code-recommended-practices/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸Šé¢è¬›è§£ Terraform çš„åŸºæœ¬æ“ä½œæµç¨‹ï¼Œæä¾›ç¯„æœ¬åŸå§‹ç¢¼ï¼Œä»¥åŠä¸€æ­¥ä¸€æ­¥å°å…¥çš„è©³ç´°æ­¥é©Ÿã€‚å„ä½æ‡‰è©²éƒ½å¯ä»¥ä¾ç…§ä¸Šé¢å¹¾ç¯‡çš„èªªæ˜ï¼Œé–‹å§‹å¿«æ¨‚çš„ä½¿ç”¨ Terraform äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å¹¾ç¯‡æ–‡ç« ï¼Œé©åˆå·²ç¶“ä½¿ç”¨é terraform ä¸€é»æ™‚é–“ï¼Œæœ‰ç¶“é©—çš„åœ˜éšŠï¼Œä¸¦æ‰“ç®—æ›´å¤§è¦æ¨¡å°å…¥ terraformï¼Œæ­£åœ¨å°‹æ±‚æ”¹å–„çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿ƒå¾—
&lt;ul&gt;
&lt;li&gt;CI/CD å…¨è‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;State backend é¸æ“‡&lt;/li&gt;
&lt;li&gt;æœ€ä½³å¯¦è¸&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·¥å…·
&lt;ul&gt;
&lt;li&gt;Terraform Atlantis&lt;/li&gt;
&lt;li&gt;Terragrunt&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å·¥å…·èˆ‡æ–‡åŒ–&#34;&gt;å·¥å…·èˆ‡æ–‡åŒ–&lt;/h1&gt;
&lt;p&gt;æ–°å·¥å…·æä¾›è§£æ±ºæ–¹æ¡ˆï¼Œç„¶è€Œå–®ç´”å°å…¥å·¥å…·å¾Œä¸æ˜¯å°±ä¸€å‹æ°¸é€¸ï¼Œè¨±å¤šå¯¦å‹™ä¸Šçš„å•é¡Œï¼Œé‚„æ˜¯è¦ä¾è³´æ”¹å–„å·¥ä½œæµç¨‹ï¼Œä¸¦ä¸”é¿å…æ•´é«”é‹ä½œçš„éŒ¯èª¤ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œä¸åŒåœ˜éšŠå·²æœ‰æ—¢æœ‰çš„åœ˜éšŠæ–‡åŒ–ï¼Œæ•´åˆæ–°çš„å·¥å…·å¾Œé‚„æ˜¯éœ€è¦ç£¨åˆï¼Œä¸ä¸€å®šè¦ç…§å–®å…¨æ”¶ã€‚æ›å¥è©±èªªï¼Œå·¥ä½œæµç¨‹çš„ä¸æ–·æ”¹é€²ä¹Ÿæ˜¯è§£æ±ºæ–¹æ¡ˆçš„ä¸€ç’°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å»ºè­°å¯¦è¸-recommended-practices&#34;&gt;å»ºè­°å¯¦è¸ Recommended Practices&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform å®˜ç¶²æœ‰è¨±å¤šå»ºè­°çš„å¯¦ä½œèˆ‡å°å…¥æµç¨‹&lt;/a&gt;ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†çš„å»ºè­°æˆ‘å€‘éƒ½å·²ç¶“åœ¨å‰é¢çš„å¹¾ç¯‡æ–‡ç« ä¸­æåˆ°ï¼Œé€™é‚Šè¦ä¾†èªªæ˜ä¸€ä¸‹ï¼Œä¸¦è£œå……å…¶ä»–å®˜æ–¹æ¨è–¦çš„å¯¦è¸ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠ€è¡“è¤‡é›œåº¦: éš¨è‘—æ¶æ§‹çš„è¤‡é›œå¢åŠ ï¼Œç¶­è­·æ•´é«”æ¶æ§‹çš„å›°é›£é€æ¼¸å¢åŠ &lt;/li&gt;
&lt;li&gt;çµ„ç¹”è¤‡é›œåº¦: éš¨è‘—åœ˜éšŠè¦æ¨¡å¢é•·ï¼Œåˆ†å·¥èˆ‡æ¬Šè²¬è¶Šé¡¯è¤‡é›œï¼Œåœ˜éšŠçš„å”ä½œå›°é›£é€æ¼¸å¢åŠ &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Terraform çš„ç›®çš„ï¼Œåœ¨æ–¼æ¸›å°‘ä¸Šé¢å…©è€…çš„è¤‡é›œåº¦ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å·¥ä½œç›®éŒ„çµæ§‹&#34;&gt;å·¥ä½œç›®éŒ„çµæ§‹&lt;/h1&gt;
&lt;p&gt;å·¥ä½œç›®éŒ„ (workspace) æ˜¯ terraform é‹ä½œçš„åŸºæº–é»ï¼Œå®¹ç´ tf æª”æ¡ˆï¼Œé€šå¸¸æœƒä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·ç®¡ç†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸€å€‹ç’°å¢ƒä¸€å€‹å·¥ä½œç›®éŒ„&#34;&gt;ä¸€å€‹ç’°å¢ƒä¸€å€‹å·¥ä½œç›®éŒ„&lt;/h1&gt;
&lt;p&gt;é€™å€‹æˆ‘å€‘åœ¨å‰é¢çš„ç¯„ä¾‹å·²ç¶“å¯¦è¸ï¼ŒåŸºæœ¬ä¸Šç›®éŒ„ç‚º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;project (git repository)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ api-server/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ stage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â””â”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ grpc-server/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°‡ç”¢å“æˆ–å°ˆæ¡ˆåˆ‡å‰²æˆå„è‡ªç¨ç«‹çš„ç’°å¢ƒï¼Œä»¥æŸå°ˆæ¡ˆçš„æŸç’°å¢ƒä½œç‚ºç®¡ç†å–®ä½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;project-api-server-dev&lt;/li&gt;
&lt;li&gt;project-api-server-stage&lt;/li&gt;
&lt;li&gt;project-api-server-prod&lt;/li&gt;
&lt;li&gt;project-grpc-server-dev&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™éº¼åšæœ‰å¹¾å€‹å¥½è™•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¢ºä¿ç”¢å“èˆ‡ç’°å¢ƒçš„ç¨ç«‹
&lt;ul&gt;
&lt;li&gt;å½¼æ­¤ä¸äº’ç›¸å½±éŸ¿&lt;/li&gt;
&lt;li&gt;ä½†åˆå¯ç¢ºä¿å½¼æ­¤çš„é—œé€£æ€§ï¼Œä¾‹å¦‚æ¶æ§‹ç›¸åŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»¥ç’°å¢ƒçš„ç‚ºç®¡ç†å–®ä½ï¼Œæ›å¥è©±èªªï¼Œä¸€çµ„å®Œæ•´çš„ç’°å¢ƒ ç›´æ¥å°æ‡‰åˆ° ä¸€çµ„å®Œæ•´çš„å·¥ä½œç›®éŒ„
&lt;ul&gt;
&lt;li&gt;ç®¡ç†ä¸Šéå¸¸ç›´è§€æ˜ç¢º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å·¥ä½œç›®éŒ„åˆ†é…æ¬Šé™èˆ‡æ¬Šè²¬
&lt;ul&gt;
&lt;li&gt;ç›´æ¥ç‚ºä¸åŒåœ˜éšŠåˆ†é…ä¸åŒå·¥ä½œç›®éŒ„çš„å­˜å–æ¬Šé™&lt;/li&gt;
&lt;li&gt;æ¬Šè²¬èˆ‡å·¥ä½œç›®éŒ„çš„æ˜ç¢ºå°æ‡‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æŒçºŒè©•ä¼°èˆ‡æ”¹é€²&#34;&gt;æŒçºŒè©•ä¼°èˆ‡æ”¹é€²&lt;/h1&gt;
&lt;p&gt;è‡ªå‹•åŒ–ç¨‹åº¦ä¹Ÿæ˜¯å·¥ä½œæµç¨‹é€²æ­¥çš„æŒ‡æ¨™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰‹å‹•æ§åˆ¶&lt;/li&gt;
&lt;li&gt;åŠè‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;å…¨è‡ªå‹•åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°å…¥ terraform å¾Œçš„æˆ‘å€‘å·²ç¶“æè¿°éäº†ï¼Œå…§å®¹è©³æƒ…è«‹è¦‹ä¸Šä¸Šç¯‡æ–‡ç« ã€‚ä¸‹é¢æè¿°å®˜æ–¹æ¨è–¦çš„å¾æœ€é–‹å§‹ï¼Œå®Œå…¨æ²’æœ‰ terraform ç¶“é©—é–‹å§‹å°å…¥æµç¨‹ï¼Œä»¥ç­†è€…å€‹äººæ–¼å…¬å¸å¾é›¶é–‹å§‹å°å…¥çš„ç¶“é©—ï¼Œéå¸¸ç›´å¾—åƒè€ƒã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚ä½•å¾å®Œå…¨æ‰‹å‹•æ“ä½œï¼Œè®ŠæˆåŠè‡ªå‹•æ“ä½œ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å¾åŠè‡ªå‹•ï¼Œè®Šæˆ IaC (infrastructure as code)&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å¾ IaCï¼Œè®Šæˆ IaC å¤šäººå”ä½œ&lt;/li&gt;
&lt;li&gt;é€²éšæ”¹é€² IaC å¤šäººå”ä½œ&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å¦‚ä½•å¾å®Œå…¨æ‰‹å‹•æ“ä½œè®ŠæˆåŠè‡ªå‹•æ“ä½œ&#34;&gt;å¦‚ä½•å¾å®Œå…¨æ‰‹å‹•æ“ä½œï¼Œè®ŠæˆåŠè‡ªå‹•æ“ä½œ&lt;/h1&gt;
&lt;p&gt;å¦‚æœåœ˜éšŠæ‡‰è©²æ˜¯é‚„åœ¨å®Œå…¨æ‰‹å‹•æ§åˆ¶ infrastructure&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥é©— (audit) å›°é›£&lt;/li&gt;
&lt;li&gt;ç„¡æ³•è¤‡ç¾ (reproduce)&lt;/li&gt;
&lt;li&gt;æ‹“å±• (scale) å›°é›£&lt;/li&gt;
&lt;li&gt;å¾ˆé›£åˆ†äº« infrastructure çš„çŸ¥è­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥è¦åŸ·è¡Œçš„æ˜¯ï¼šé¸æ“‡å°‘éƒ¨åˆ†ï¼Œå¯ä»¥æ§åˆ¶çš„ infrastructure é–‹å§‹å°å…¥ terraformã€‚æ‰€ä»¥è¦åšçš„å°±æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é–‹å§‹ä½¿ç”¨ terraform&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦å¯ä»¥åƒè€ƒä¸€äº›ç¯„ä¾‹å°ˆæ¡ˆ
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://learn.hashicorp.com/collections/terraform/aws-get-started?utm_source=WEBSITE&amp;amp;utm_medium=WEB_IO&amp;amp;utm_offer=ARTICLE_PAGE&amp;amp;utm_content=DOCS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform: Get Started collection&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é–‹å§‹é€²å…¥åŠè‡ªå‹•éšæ®µå¾Œï¼Œåœ˜éšŠä¸­çš„å°‘éƒ¨åˆ†äººå“¡é–‹å§‹ä½¿ç”¨ terraformï¼Œæ‰‹ä¸Šä¹Ÿæœ‰äº†å¯é‹ä½œçš„å°‘éƒ¨åˆ† infrastructure as codeï¼Œå¯ä»¥ä½œç‚º demo ï¼Œæˆ–æ˜¯å…¶ä»–åœ˜éšŠæˆå“¡çš„æ•™è‚²è¨“ç·´ï¼Œé€™å€‹å¯ä»¥å¹«åŠ©ä¸‹ä¸€éšæ®µçš„æ¼”é€²ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•å¾åŠè‡ªå‹•è®Šæˆ-iac-infrastructure-as-code&#34;&gt;å¦‚ä½•å¾åŠè‡ªå‹•ï¼Œè®Šæˆ IaC (infrastructure as code)&lt;/h1&gt;
&lt;p&gt;ç›®å‰åŠè‡ªå‹•çš„å·¥ä½œå°ˆæ¡ˆå…§å®¹æ‡‰è©²æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Terraform code&lt;/li&gt;
&lt;li&gt;æ‰‹å‹•æ“ä½œçš„æµç¨‹&lt;/li&gt;
&lt;li&gt;ä¸€äº›è¼”åŠ©è…³æœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å€‹éšæ®µå¸Œæœ›ç¹¼çºŒæ¨å±• terraform çš„ä½¿ç”¨ï¼Œé™ä½æ‰‹å‹•æ­¥é©Ÿèˆ‡è…³æœ¬åŸ·è¡Œã€‚é€™å€‹éšæ®µå¯ä»¥åšçš„äº‹æƒ…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç† tf code
&lt;ul&gt;
&lt;li&gt;é€™é‚Šå‡è¨­åœ˜éšŠæœ¬ä¾†å°±æœ‰ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼Œé–‹å§‹å°‡ tf code å°å…¥ç‰ˆæœ¬æ§åˆ¶çš„å·¥ä½œæµç¨‹&lt;/li&gt;
&lt;li&gt;é–‹å§‹å°‡å…ˆç”¢ç”Ÿçš„ tf code ç§»å…¥ç‰ˆæœ¬æ§åˆ¶&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰åœ˜éšŠéƒ½èƒ½å…±äº«æ–° tf code çš„çŸ¥è­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é–‹å§‹ä½¿ç”¨ç¬¬ä¸€å€‹ terraform module
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹ç°¡å–®çš„æ–¹å¼æ˜¯å°‡é‡è¤‡ä½¿ç”¨çš„ infrastructure æŠ½å‡ºï¼Œæ¸›å°‘é‡è¤‡çš„ tf code&lt;/li&gt;
&lt;li&gt;é€™é‚Šéœ€è¦æé†’ï¼Œç›¡é‡ä»¥å®Œæ•´å€‹ infrastructure ä½œç‚ºå–®ä½æŠ½é›¢ tf code ä½œç‚º module
&lt;ul&gt;
&lt;li&gt;å®Œæ•´çš„ infrastructure ä¹Ÿæ˜¯åœ¨ provider ä¸­é–“è½‰æˆçš„å–®ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æŒçºŒæ¨å»£åœ˜éšŠå…§ terraform çš„ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;é–‹å§‹è¨­å®šå·¥ä½œæº–å‰‡ (Guidelines) ä¾†æè¿°ä¸¦è¦ç¯„å·¥ä½œæµç¨‹
&lt;ul&gt;
&lt;li&gt;åœ¨åœ˜éšŠä¸Šä¸å®Œå…¨ç†Ÿæ‚‰ terraform å‰ï¼Œå¯ä»¥æå‡å·¥ä½œæ•ˆç‡ï¼Œæ¨å»£æœ€ä½³å¯¦è¸ï¼Œä¸¦ä¸”é™ä½éŒ¯èª¤é¢¨éšª&lt;/li&gt;
&lt;li&gt;åœ˜éšŠçš„æ¶æ§‹å¸«å¯ä»¥ä¾æ“šåœ˜éšŠæ–‡åŒ–å½¢å¡‘å·¥ä½œæµç¨‹ï¼Œæ›´ç¬¦åˆåœ˜éšŠéœ€æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é–‹å§‹å°å…¥ configuration management
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ Chef cookbook&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç§é‘°èˆ‡éš±ç§˜è³‡è¨Šç®¡ç†
&lt;ul&gt;
&lt;li&gt;å°å…¥ vault ä¾†ç®¡ç†&lt;/li&gt;
&lt;li&gt;terraform æ•´åˆ vaultï¼Œå¯ä»¥ä½¿ç”¨ terraform ç®¡ç† vault çš„çµæ§‹ï¼Œä½¿ç”¨ vault ä¾†ç®¡ç† terraform æ‰€éœ€çš„ credentials&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¦‚ä½•å¾-iacè®Šæˆ-iac-å¤šäººå”ä½œ&#34;&gt;å¦‚ä½•å¾ IaCï¼Œè®Šæˆ IaC å¤šäººå”ä½œ&lt;/h1&gt;
&lt;p&gt;å°å…¥ç‰ˆæœ¬æ§åˆ¶å¯ä»¥é™ä½å †äººå”ä½œçš„è¤‡é›œåº¦ï¼Œä¸‹å€‹éšæ®µéœ€è¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çµ±ä¸€è·¨åœ˜éšŠçš„å·¥ä½œæµç¨‹&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ terraform ç®¡ç†åœ˜éšŠçš„ IAM æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥åŸ·è¡Œçš„æ”¹é€²å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹æ¨è–¦ä½¿ç”¨ Terraform Cloud ä¾†åšå¾Œå°ï¼Œæˆ‘å€‘ç¨å€™æ¨è–¦çš„å¹¾å€‹å…è²»å·¥å…·ä¹Ÿæœ‰ç›¸ä¼¼åŠŸèƒ½ï¼Œåœ˜éšŠå¯ä»¥åƒè€ƒä½¿ç”¨ã€‚é€™é‚Šå°ˆæ³¨åœ¨éœ€æ±‚èˆ‡æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;é–‹å§‹è¨­è¨ˆæ•´å€‹çµ„ç¹”é–“çš„å·¥ä½œç›®éŒ„çµæ§‹
&lt;ul&gt;
&lt;li&gt;å·¥ä½œç›®éŒ„è¦åæ˜ 
&lt;ul&gt;
&lt;li&gt;ç¨ç«‹çš„ç’°å¢ƒèˆ‡ç¨ç«‹çš„å°ˆæ¡ˆ&lt;/li&gt;
&lt;li&gt;è² è²¬ç®¡ç†çš„åœ˜éšŠçµ„ç¹”ï¼Œå·²åˆ†é…å­˜å–æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€™éƒ¨åˆ†çš„å¯¦ä½œå¾Œé¢çš„æ–‡ç« ä¹Ÿæœƒæåˆ°&lt;/li&gt;
&lt;li&gt;å®˜æ–¹æ¨è–¦çš„ Terraform Cloud å¯è¦‹&lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/part3.3.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é€²éšæ”¹é€²-iac-å¤šäººå”ä½œ&#34;&gt;é€²éšæ”¹é€² IaC å¤šäººå”ä½œ&lt;/h1&gt;
&lt;p&gt;å¦‚ä»Šåœ˜éšŠå·²ç¶“æœ‰å¤šäººå”ä½œçš„ä»‹é¢ï¼Œä¹Ÿæœ‰å®Œæ•´çš„å·¥ä½œæµç¨‹ï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”±ä»¥ä¸‹æ”¹é€²ï¼Œé”æˆæ›´å …å›ºçš„æ¡†æ¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹å»ºè­°å¤§é‡å°å…¥ Terraform Cloudï¼Œä½†é€™æœƒè¶…å‡ºå…è²»é¡åº¦&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘ä¹‹å¾Œçš„æ–‡ç« æœƒæä¾›é–‹æºç‰ˆæœ¬çš„è§£æ³•
&lt;ul&gt;
&lt;li&gt;ç°¡åŒ–å·¥ä½œç›®éŒ„çš„ç®¡ç†&lt;/li&gt;
&lt;li&gt;æ˜ç¢ºçš„ review èˆ‡ audit å·¥ä½œæµç¨‹&lt;/li&gt;
&lt;li&gt;å¢åŠ  infrastructure çš„ç›£æ¸¬èˆ‡æ•ˆèƒ½ç›£æ§ï¼Œé€™äº›éƒ½å¯ä»¥ä½¿ç”¨ terraform è¨­ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…·é«”å¯¦ä½œï¼Œè«‹è¦‹ä¸‹ç¯‡æ–‡ç« &lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code: Backends</title>
      <link>https://chechia.net/zh-hant/post/2020-10-04-terraform-infrastructure-as-code-backend/</link>
      <pubDate>Sun, 04 Oct 2020 11:15:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-10-04-terraform-infrastructure-as-code-backend/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸Šé¢è¬›è§£ Terraform çš„åŸºæœ¬æ“ä½œæµç¨‹ï¼Œæä¾›ç¯„æœ¬åŸå§‹ç¢¼ï¼Œä»¥åŠä¸€æ­¥ä¸€æ­¥å°å…¥çš„è©³ç´°æ­¥é©Ÿã€‚å„ä½æ‡‰è©²éƒ½å¯ä»¥ä¾ç…§ä¸Šé¢å¹¾ç¯‡çš„èªªæ˜ï¼Œé–‹å§‹å¿«æ¨‚çš„ä½¿ç”¨ Terraform äº†ã€‚&lt;/p&gt;
&lt;p&gt;è€Œç•¶ä½¿ç”¨ Terraform çš„è¦æ¨¡è¶Šä¾†è¶Šå¤§ï¼Œç®¡ç†çš„è³‡æ–™è¶Šä¾†è¶Šå¤šæ™‚ï¼Œé–‹å§‹æœƒå‡ºç¾ä¸€äº›å•é¡Œï¼Œä¾‹å¦‚é‡è¤‡çš„ terraform code è¶Šä¾†è¶Šå¤šï¼Œå”åŒå·¥ä½œ review ä¸å¤ªå®¹æ˜“ï¼Œstate çš„å…§å®¹ç®¡ç†èˆ‡é–ç®¡ç†ï¼Œç­‰ç­‰ã€‚é€™äº›å•é¡Œå¯ä»¥é€éä¸€äº›å·¥ä½œæµç¨‹çš„æ”¹é€²ï¼Œæˆ–æ˜¯å°å…¥æ–°çš„å°å·¥å…·ï¼Œä¾†æ”¹å–„å·¥ä½œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹ä¾†ç­†è€…æ¨è–¦å¹¾å€‹å¿ƒå¾—èˆ‡å·¥å…·ï¼Œå¸Œæœ›èƒ½æå‡ä½¿ç”¨ Terraform çš„æ•ˆç‡èˆ‡ç”¢å€¼&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å¹¾ç¯‡æ–‡ç« ï¼Œé©åˆå·²ç¶“ä½¿ç”¨é terraform ä¸€é»æ™‚é–“ï¼Œæœ‰ç¶“é©—çš„åœ˜éšŠï¼Œä¸¦æ‰“ç®—æ›´å¤§è¦æ¨¡å°å…¥ terraformï¼Œæ­£åœ¨å°‹æ±‚æ”¹å–„çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿ƒå¾—
&lt;ul&gt;
&lt;li&gt;CI/CD å…¨è‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;State backend é¸æ“‡&lt;/li&gt;
&lt;li&gt;æœ€ä½³å¯¦è¸ &lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·¥å…·
&lt;ul&gt;
&lt;li&gt;Terraform Atlantis&lt;/li&gt;
&lt;li&gt;Terragrunt&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;terraform-backend&#34;&gt;Terraform Backend&lt;/h1&gt;
&lt;p&gt;å‰›é–‹å§‹ä½¿ç”¨ terraform çš„æ™‚å€™ï¼Œå¤§å®¶çš„ç¬¬ä¸€å€‹ç¯„ä¾‹æ‡‰è©²éƒ½æ˜¯ local backend å§ï¼Œå°±æ˜¯ç›´æ¥åœ¨æœ¬åœ° terraform applyï¼Œåœ¨ç›®å‰çš„å·¥ä½œç›®éŒ„ä¸‹ç”¢ç”Ÿ state æª”æ¡ˆã€‚é€™å€‹ state æª”æ¡ˆç›´æ¥ cat æ‰“é–‹ä¾†çœ‹å¾Œï¼Œå¯ä»¥ç™¼ç¾è£¡é¢ä¸€åˆ‡éƒ½æ˜¯æ˜ç¢¼çš„ã€‚åˆå­¸æ™‚ç­†è€…æ„Ÿè¦ºæ‰€è¬‚çš„ Terraform backend åªæ˜¯ä¸€å€‹å­˜æ”¾ä¸­ç¹¼çš„ state è³‡æ–™çš„ workspaceï¼Œå¾Œä¾†ç™¼ç¾å®Œå…¨ä¸æ˜¯é€™éº¼å›äº‹ï¼Œä¾¿ç«‹åˆ»æ£„ç”¨äº† local backendã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å¾Œä¾ç…§å®˜æ–¹æ¨è–¦å°±ä½¿ç”¨äº† &lt;a href=&#34;https://app.terraform.io/app&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform Cloud&lt;/a&gt;ï¼Œå¾Œä¾†ä¾¿å‡ºç¾è¨±å¤šå•é¡Œï¼Œç­‰ç­‰æœƒåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œåœ˜éšŠé¸ç”¨äº†è‡ªå®¶å…¬æœ‰é›²çš„ backendï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AWS S3 ä½œç‚º state storageï¼ŒDynamoDB ä½œç‚ºä¸­å¿ƒåŒ–çš„ workflow lock&lt;/li&gt;
&lt;li&gt;GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/docs/backends/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´ terraform backend æ”¯æ´æ¸…å–®å¯ä»¥è¦‹å®˜æ–¹ç¶²ç«™&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« è¦ä¾†ä»”ç´°æ¢è¨æ‰€è¬‚çš„ terraform backendï¼Œbackend çš„é‡è¦æ€§ï¼Œèˆ‡å¦‚é¸æ“‡é©åˆè‡ªå·±åœ˜éšŠçš„ backendã€‚&lt;/p&gt;
&lt;h1 id=&#34;å•é¡Œ&#34;&gt;å•é¡Œ&lt;/h1&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ tf random ç”¢ç”Ÿäº‚æ•¸å¯†ç¢¼ï¼Œç›´æ¥å» cat state æª”æ¡ˆå°±å¯ä»¥çœ‹åˆ°æ˜ç¢¼çš„ random æ•¸å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å¤šäººå”ä½œ lock&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€å€‹è§£æ³•æ˜¯ï¼Œæ ¹æœ¬ä¸ä½¿ç”¨ backendï¼Œterraform ä¹Ÿæ”¯æ´é€™æ¨£çš„åšæ³•ã€‚é›–ç„¶&lt;a href=&#34;https://www.terraform.io/docs/backends/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹ä¹Ÿæ˜è¬› backend are completely optional&lt;/a&gt;ï¼Œä½†ä¾ç…§ç­†è€…çš„ç¶“é©—ï¼Œå¼·çƒˆå»ºè­°å¤šäººåœ˜éšŠå‹™å¿…å»å•Ÿç”¨ï¼Œä¸¦æ‰¾å°‹é©åˆè‡ªå·±çš„ Backendã€‚&lt;/p&gt;
&lt;h1 id=&#34;éœ€æ±‚&#34;&gt;éœ€æ±‚&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;è³‡è¨Šå®‰å…¨ï¼Œå¸Œæœ› terraform ä½¿ç”¨æ˜¯å®‰å…¨çš„ï¼Œä¸æœƒæš´éœ²æ•æ„Ÿè³‡è¨Š&lt;/li&gt;
&lt;li&gt;å¤šäººå”ä½œï¼Œå¸Œæœ›å¯ä»¥åŒæ™‚å·¥ä½œï¼Œä½†åˆä¸æœƒäº’ç›¸è¡çª&lt;/li&gt;
&lt;li&gt;é ç«¯æ“ä½œï¼Œé¿å…æœ¬åœ°æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;state-å­˜æ”¾èˆ‡é–&#34;&gt;State å­˜æ”¾èˆ‡é–&lt;/h1&gt;
&lt;p&gt;é è¨­çš„ backend æ˜¯ loal backendï¼Œä¹Ÿå°±æ˜¯åŸ·è¡Œ terraform apply å¾Œï¼Œæœ¬åœ°æœƒå‡ºç¾ä¸€å€‹ JSON æ ¼å¼çš„ state æª”æ¡ˆã€‚ç„¶è€Œ local state æœƒç«‹åˆ»é‡åˆ°çš„å•é¡Œï¼Œå°±æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€å€‹æ˜¯å”ä½œå›°é›£ï¼Œapply çš„çµæœåˆ¥äººçœ‹ä¸åˆ°ï¼Œä¸èƒ½æ¥çºŒè‘—åš&lt;/li&gt;
&lt;li&gt;æ¯å€‹äººéƒ½å¯ä»¥ apply&lt;/li&gt;
&lt;li&gt;ä½†ä¸åŒäººçš„ apply æ²’æœ‰ç›¸ä¾æ€§
&lt;ul&gt;
&lt;li&gt;å¯æ˜¯é ç«¯çš„ infrastructure æœ‰ï¼ŒA B ä¸åŒäººä¸€èµ· apply åˆ° infrastructure ä¸Šï¼Œå¯å¯§å°±æœƒè¡çªï¼Œæˆ–æ˜¯ç”¢ç”Ÿä¸å¯é æœŸçš„éŒ¯èª¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥ç­†è€…å¼·çƒˆæ¨è–¦ä½¿ç”¨å¤–éƒ¨çš„ backend ä¾†å–ä»£ local backendã€‚å¤šåŠ backend æœƒå¤šåšè¨±å¤šäº‹ï¼Œé€éæ§åˆ¶ state ä¾†ç¢ºä¿ infrastrure çš„å®Œæ•´æ€§ï¼Œä¾‹å¦‚å° state å­˜å–æœ‰ä»¥ä¸‹çš„é™åˆ¶:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ï¼¡é€éé–ä¾†æ§åˆ¶ï¼Œç¦æ­¢å¤šäººåŒæ™‚å­˜å–ï¼Œä¾‹å¦‚åŒæ™‚æœ‰å…©å€‹äºº apply ç›¸åŒæˆ–ä¸åŒæª”æ¡ˆï¼Œå…ˆå–å¾— backend lock çš„äººåŸ·è¡Œï¼Œå¾Œä¾†çš„äººæœƒè¢« terraform é˜»æ“‹
&lt;ul&gt;
&lt;li&gt;é¿å…å¤šé ­é¦¬è»Šçš„å•é¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¢ºä¿ state çš„å”¯ä¸€æ€§ï¼Œä½¿ç”¨å¦å¤–ä¸€å€‹ repo çš„ state æª”æ¡ˆï¼Œé ç«¯çš„ state æœƒæ‹’çµ•å­˜å–&lt;/li&gt;
&lt;li&gt;ç¢ºä¿ state çš„é †åºï¼Œæ¯æ¬¡ apply çš„ state éƒ½æ˜¯ä¾åºç”¢ç”Ÿ
&lt;ul&gt;
&lt;li&gt;å¦‚æœ state æ˜¯èˆŠçš„ï¼Œå¯èƒ½å°±æœƒè¢«é ç«¯çš„ backend æ‹’çµ•ï¼Œé¿å…ä½¿ç”¨èˆŠçš„ apply è¦†è“‹æ–°çš„ infrastructure&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›é™åˆ¶ï¼Œå¦‚æœä½¿ç”¨ local backend æ‰æœƒå®¹æ˜“é‡åˆ°ï¼Œä½¿ç”¨å¤–éƒ¨çš„ backend å…¶å¯¦ä¸å®¹æ˜“æœƒç™¼ç”Ÿã€‚Terraform åŸºæ–¼ Infrastructure as Code å¯¦ç¾ï¼Œå¯ä»¥å°‡æ•´å€‹ terraform repo è¦–ç‚º code ä¸€éƒ¨åˆ†ï¼Œé€™æ¨£å°±å¯ä»¥æƒ³åƒç‚ºä½•é€™äº› state é™åˆ¶æ˜¯é‡è¦çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;state è·Ÿéš¨ tf æª”æ¡ˆï¼Œéš¨è‘— tf æª”æ¡ˆçš„ commit æ¨é€²ï¼Œstate ä¹Ÿè·Ÿè‘—æ¨é€²&lt;/li&gt;
&lt;li&gt;commit 1 çš„ tf æª”æ¡ˆï¼Œapply å¾Œç”¢ç”Ÿ state 1&lt;/li&gt;
&lt;li&gt;å¦‚æœä»Šå¤©æœ‰åœ˜éšŠ force push äº†ä¸€å€‹ conflict çš„ tf æª”æ¡ˆï¼Œç¡¬è¦ apply çš„çµæœä¹Ÿå¯èƒ½é€ æˆ infrastructure conflicts&lt;/li&gt;
&lt;li&gt;å¦‚æœä»Šå¤©åœ˜éšŠæœ‰å¤šå€‹ branch åŒæ™‚é–‹ç™¼ï¼Œbranch A apply çš„ state æœƒèˆ‡ branch B apply çš„ state ä¹Ÿå¯èƒ½é€ æˆè¡çª&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;state-æ‰‹å‹•æ›´æ”¹&#34;&gt;State æ‰‹å‹•æ›´æ”¹&lt;/h1&gt;
&lt;p&gt;åœ¨å¾ˆç‰¹æ®Šçš„ç‹€æ³ä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹å‹•æ›´æ”¹ state fileï¼Œç„¶å¾Œ push ä¸Šå‚³ï¼Œä½†é€™é»éå¸¸ä¸å»ºè­°ï¼Œterraform æœƒè‡ªå‹•ç¶­è­· state çš„å®Œæ•´æ€§ï¼Œæ‰‹å‹•æ›´æ”¹å¯èƒ½æœƒç›´æ¥ç ´å£æ­£å¸¸çš„ stateã€‚ä»€éº¼æƒ…å½¢æœƒç”¨åˆ°ï¼Ÿå°±æ˜¯ä½ çš„ state å› ç‚ºæŸå€‹åŸå› è¢«ç©å£ï¼Œå¤§éƒ¨åˆ†æ˜¯äººç‚ºå¼„å£çš„ã€‚é€™æ™‚å€™æ‰è¢«è¿«è¦æ‰‹å‹•æ›´æ”¹ stateã€‚æ‰‹å‹•æ›´æ”¹ state ï¼Œè¬›ç™½äº†ä¸åšæ­»å°±ä¸æœƒæ­»ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault state pull
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim your-local-state-file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Increment Serial if needed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault state push
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# vault state push -force
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;hosted-terraform-cloud&#34;&gt;Hosted: Terraform Cloud&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://app.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform Cloud&lt;/a&gt;ï¼Œæ˜¯å®˜æ–¹æä¾›çš„è§£æ±ºæ–¹æ¡ˆï¼Œæœ‰æä¾›è¼ƒå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨ terraform cloud çš„ç¶²ç«™ä¸Šé ç«¯ planã€‚æœ‰æä¾›å…è²»ç‰ˆï¼Œæä¾›æœ€å¤š 5 äººåœ˜éšŠä½¿ç”¨ã€‚ä¹Ÿæœ‰æä¾›é€²éšçš„æ–¹æ¡ˆ $20/user æˆ–æ˜¯ $70/userï¼Œä»¥åŠ enterprise ç‰ˆæœ¬ï¼Œå¯ä»¥æœ¬åœ°å®‰è£ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å¾ˆç°¡å–®ï¼Œ&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘åœ¨å‰å¹¾ç¯‡æä¾›çš„ç¯„ä¾‹ repository&lt;/a&gt;å…¨éƒ¨éƒ½æ˜¯ä½¿ç”¨ terraform cloud ä½œç‚º Backendã€‚æä¾›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é ç«¯çš„ state å„²å­˜åº«
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰åœ˜éšŠæˆå“¡ä½¿ç”¨å„è‡ªå¸³è™Ÿç™»å…¥&lt;/li&gt;
&lt;li&gt;plan ä¹‹å‰æœƒ sync terraform cloud ä¸Šé¢çš„ state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é ç«¯çš„ state lock
&lt;ul&gt;
&lt;li&gt;å¦‚æœ lock è¢«äººä½”æ“šï¼Œè¡¨ç¤ºæœ‰å…¶ä»–äººæ­£åœ¨ä½¿ç”¨ï¼Œæœƒå–æ¶ˆæ–°çš„æ“ä½œï¼Œé¿å…è¡çª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¹Ÿæä¾›ç·šä¸Šæª¢è¦– state ï¼Œæˆ–æ˜¯ç·šä¸Šä¿®æ”¹ state çš„åŠŸèƒ½
&lt;ul&gt;
&lt;li&gt;è²¼å¿ƒå°åŠŸèƒ½ï¼Œä½†å¤šåŠç”¨ä¸åˆ°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¨—ç®¡çš„ Terraform Cloud ä½œç‚º backend ä»–æœ‰å¹¾å€‹å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¦å•Ÿç”¨é ç«¯ planï¼Œéœ€è¦ç¶å®šç‰ˆæœ¬æ§åˆ¶æœå‹™å™¨ï¼Œä¾‹å¦‚ç¶å®š Github æˆ– Gitlab
&lt;ul&gt;
&lt;li&gt;åŸºæ–¼å®‰å…¨æ€§è€ƒé‡ï¼Œé€™é»å¾ˆå¤šå…¬å¸å°±ç›´æ¥æ‰“æ§äº†
&lt;ul&gt;
&lt;li&gt;æš´éœ²åŸå§‹ç¢¼çµ¦ç¬¬ä¸‰æ–¹å…¬å¸ï¼Œå¯èƒ½æœƒè®“å…¬å¸çš„å®‰å…¨æ€§æª¢é©—ä¸é&lt;/li&gt;
&lt;li&gt;åŠ ä¸Š terraform çš„ Git Codeï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ‰€æœ‰ infrastructure çš„è³‡è¨Š&lt;/li&gt;
&lt;li&gt;åŠ ä¸Šå¦‚æœæœ‰ä½¿ç”¨ terraform ç·¨è¼¯ IAM æˆ–æ˜¯ provision vaultï¼Œç­‰æ–¼è¨±å¤šæ•æ„Ÿè³‡æ–™éƒ½æœƒå‡ºç¾åœ¨ terraform repository ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ˜¯é‡è¦–å®‰å…¨æ€§çš„åœ˜éšŠï¼Œå‰‡è‡³å°‘è¦ä½¿ç”¨å¯ä»¥ self-hosted çš„ Terraform Enterpriseï¼Œè€Œä¸è¦ä½¿ç”¨å…¬æœ‰çš„ Terraform Cloudã€‚ç„¶è€Œ Enterprise æˆ‘æ˜¯æ²’ç”¨éï¼Œè«‹ä¸è¦å•æˆ‘åƒ¹éŒ¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;consul&#34;&gt;Consul&lt;/h1&gt;
&lt;p&gt;Consul åš´æ ¼ä¾†èªªä¸æ˜¯å–®ç´”çš„å„²å­˜åº«ï¼Œä»–æ˜¯ Service Networking è¨­å®šèˆ‡æœå‹™ç™¼ç¾çš„è§£æ±ºæ–¹æ¡ˆï¼Œåªæ˜¯æœ¬èº«å¸¶æœ‰ key value çš„å„²å­˜åŠŸèƒ½ï¼Œå°±è¢«è‡ªå®¶æ•´åˆã€‚æ›å¥è©±èªªï¼Œä»–ä¸æ˜¯å°ˆé–€æ‹¿ä¾†åš terraform backend çš„ï¼Œæ¯”è¼ƒåƒæ˜¯å¦‚æœåœ˜éšŠæœ¬ä¾†å°±æœ‰ä½¿ç”¨ consulï¼Œå¯ä»¥è€ƒæ…®å…¬ç”¨å„²å­˜åº«ï¼Œä½œç‚º terraform backendã€‚&lt;/p&gt;
&lt;p&gt;é€™æ˜¯ç›¸åŒå…¬å¸ Hashicorp æä¾›çš„è‡ªå®¶çš„ backendï¼Œæ•´åˆçš„å¾ˆå®Œæ•´ã€‚ä½†å°±åªæ˜¯å–®ç´”çš„å„²å­˜åº«ï¼Œæ²’æœ‰ terraform cloud çš„é ç«¯åŸ·è¡Œå•Šï¼Œæˆ–æ˜¯ç·šä¸Šæª¢è¦– state æª”æ¡ˆçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨å…¬å¸å…§éƒ¨è‡ªè¡Œæ¶è¨­ä¸€çµ„ clusterï¼Œç„¶å¾Œå°±å¯ä»¥ä½œç‚º backendã€‚&lt;/p&gt;
&lt;p&gt;å•é¡Œæ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Consul é€™éº¼å¤§ä¸€åŒ…ï¼Œçµæœåªä½¿ç”¨äº†è£¡é¢çš„ kv store&lt;/li&gt;
&lt;li&gt;Consul æ˜¯åˆ†æ•£å¼çš„ Key-value storeï¼Œä¸ç†Ÿæ‚‰çš„è©±ä¸å¤ªå¥½é¤Š
&lt;ul&gt;
&lt;li&gt;æ›å¥è©±èªªï¼Œå¦‚æœæ­»äº†æ•‘å¾—èµ·ä¾†å—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;etcd&#34;&gt;Etcd&lt;/h1&gt;
&lt;p&gt;Etcd è·Ÿ consul é¡ä¼¼ï¼Œé›–ç„¶æ˜¯å°ˆæ¥­çš„å„²å­˜åº«ï¼Œä½†æ˜¯ä½¿ç”¨é€™éº¼è¤‡é›œçš„åˆ†æ•£å¼å„²å­˜åº«ï¼Œåªä½œç‚º terraform çš„ backendï¼Œé¡¯ç„¶å¾ˆä¸ç¶“æ¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨å…¬å¸å…§éƒ¨è‡ªè¡Œæ¶è¨­ä¸€çµ„ clusterï¼Œç„¶å¾Œå°±å¯ä»¥ä½œç‚º backendã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ¨£åªå»ºè­°å·²ç¶“æœ‰åœ¨ä½¿ç”¨ etcd ï¼Œä¸”ç†Ÿæ‚‰ç¶­é‹ etcd çš„åœ˜éšŠï¼Œæ‰è€ƒæ…®ä½¿ç”¨ etcd å…¼ä½œç‚º terraform backendã€‚&lt;/p&gt;
&lt;p&gt;é€™äº›åˆ†æ•£å¼çš„å„²å­˜åº«ï¼Œä¸å¤ªå®¹æ˜“æ­»ï¼Œç„¶è€Œè¬ä¸€æ­»äº†å¯èƒ½ä¸å¤ªå¥½æ•‘ã€‚&lt;/p&gt;
&lt;h1 id=&#34;public-cloud&#34;&gt;Public Cloud&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/docs/backends/types/s3.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS S3 + DynamoDB&lt;/a&gt;
&lt;a href=&#34;https://www.terraform.io/docs/backends/types/azurerm.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP gcs + pg&lt;/a&gt;
&lt;a href=&#34;https://www.terraform.io/docs/backends/types/gcs.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azurerm + pg&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åªæœ‰å–®ç´”çš„ state storage èˆ‡ lock çš„åŠŸèƒ½ï¼Œæ²’æœ‰ä»€éº¼èŠ±ä¿çš„ç·šä¸ŠåŸ·è¡Œæˆ–æ˜¯å¿«é€Ÿ reviewã€‚&lt;/p&gt;
&lt;p&gt;å¥½è™•æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨éå¸¸å–®ç´”&lt;/li&gt;
&lt;li&gt;ä¹Ÿæ˜¯è™•åœ¨å®‰å…¨çš„å…§ç¶²ç’°å¢ƒä¸­&lt;/li&gt;
&lt;li&gt;æœ‰æ–¼æ˜¯å…¬æœ‰é›²æä¾›çš„æœå‹™ï¼ŒåŸºæœ¬çš„ IAM èˆ‡æ¬Šé™æ§ç®¡å¯ä»¥ç›´æ¥æ‡‰ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;postgresql&#34;&gt;Postgresql&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/docs/backends/types/pg.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Postgrel ä¹Ÿæ˜¯ä¸€å€‹ä¸éŒ¯çš„é¸æ“‡&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Terraform ä¸¦ä¸æœƒå¸¶ä¾†å¤§é‡çš„è³‡æ–™åº«è² æ“”ï¼Œæ‰€ä»¥å¯èƒ½æœƒæŠŠ terraform èˆ‡é™„è¼‰è¼ƒä½çš„æ‡‰ç”¨ï¼Œå…±ç”¨è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šä½œç‚º state storage èˆ‡ lock å¾ˆå–®ç´”æ²’ä»€éº¼å•é¡Œ&lt;/p&gt;
&lt;h1 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/docs/backends/types/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹é‚„æœ‰æä¾›æ‰€æœ‰æ”¯æ´çš„ backend&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœ Kubernetes é‚„æœ‰åšå…¶ä»–äº‹æƒ…çš„è©±ï¼Œè«‹ä¸è¦ç”¨ Kubernetes secret ä½œç‚º terraform çš„ backend&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code: CI/CD automation</title>
      <link>https://chechia.net/zh-hant/post/2020-10-03-terraform-infrastructure-as-code-automation/</link>
      <pubDate>Sat, 03 Oct 2020 11:15:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-10-03-terraform-infrastructure-as-code-automation/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸Šé¢è¬›è§£ Terraform çš„åŸºæœ¬æ“ä½œæµç¨‹ï¼Œæä¾›ç¯„æœ¬åŸå§‹ç¢¼ï¼Œä»¥åŠä¸€æ­¥ä¸€æ­¥å°å…¥çš„è©³ç´°æ­¥é©Ÿã€‚å„ä½æ‡‰è©²éƒ½å¯ä»¥ä¾ç…§ä¸Šé¢å¹¾ç¯‡çš„èªªæ˜ï¼Œé–‹å§‹å¿«æ¨‚çš„ä½¿ç”¨ Terraform äº†ã€‚&lt;/p&gt;
&lt;p&gt;è€Œç•¶ä½¿ç”¨ Terraform çš„è¦æ¨¡è¶Šä¾†è¶Šå¤§ï¼Œç®¡ç†çš„è³‡æ–™è¶Šä¾†è¶Šå¤šæ™‚ï¼Œé–‹å§‹æœƒå‡ºç¾ä¸€äº›å•é¡Œï¼Œä¾‹å¦‚é‡è¤‡çš„ terraform code è¶Šä¾†è¶Šå¤šï¼Œå”åŒå·¥ä½œ review ä¸å¤ªå®¹æ˜“ï¼Œstate çš„å…§å®¹ç®¡ç†èˆ‡é–ç®¡ç†ï¼Œç­‰ç­‰ã€‚é€™äº›å•é¡Œå¯ä»¥é€éä¸€äº›å·¥ä½œæµç¨‹çš„æ”¹é€²ï¼Œæˆ–æ˜¯å°å…¥æ–°çš„å°å·¥å…·ï¼Œä¾†æ”¹å–„å·¥ä½œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹ä¾†ç­†è€…æ¨è–¦å¹¾å€‹å¿ƒå¾—èˆ‡å·¥å…·ï¼Œå¸Œæœ›èƒ½æå‡ä½¿ç”¨ Terraform çš„æ•ˆç‡èˆ‡ç”¢å€¼&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å¹¾ç¯‡æ–‡ç« ï¼Œé©åˆå·²ç¶“ä½¿ç”¨é terraform ä¸€é»æ™‚é–“ï¼Œæœ‰ç¶“é©—çš„åœ˜éšŠï¼Œä¸¦æ‰“ç®—æ›´å¤§è¦æ¨¡å°å…¥ terraformï¼Œæ­£åœ¨å°‹æ±‚æ”¹å–„çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿ƒå¾—
&lt;ul&gt;
&lt;li&gt;CI/CD å…¨è‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;State backend é¸æ“‡&lt;/li&gt;
&lt;li&gt;æœ€ä½³å¯¦è¸ &lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·¥å…·
&lt;ul&gt;
&lt;li&gt;Terraform Atlantis&lt;/li&gt;
&lt;li&gt;Terragrunt&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;cicd-å…¨è‡ªå‹•åŒ–&#34;&gt;CI/CD å…¨è‡ªå‹•åŒ–&lt;/h1&gt;
&lt;p&gt;ç•¶å…¬å¸æˆåŠŸå°å…¥ terraform ï¼Œä¸¦ä¸”æ•´åˆ Git-flow çš„å·¥ä½œæµç¨‹å¾Œï¼Œæ‡‰è©²å¯ä»¥å¾ˆæ˜é¡¯çš„æ„Ÿå—åˆ°ï¼Œæ•´é«”çš„ infrastructure ç”¢å‡ºç©©å®šåº¦æœ‰å¤§å¹…æå‡ï¼Œç•¢ç«Ÿè»Ÿé«”å·¥ç¨‹ä¸­ code review æ˜¯ç©©å®šåº¦çš„æ ¸å¿ƒé—œéµä¹‹ä¸€ï¼Œè€Œå°å…¥ terraform èˆ‡ infrastructure as code è®“ infrastructure ä¹Ÿèƒ½åœ¨åˆç†çš„å·¥ä½œæµç¨‹ä¸­è¢«å±¤å±¤ reviewã€‚&lt;/p&gt;
&lt;p&gt;stable master -&amp;gt; feature/add-new-infra -&amp;gt; PR feature/add-new-infra -&amp;gt; master&lt;/p&gt;
&lt;p&gt;feature branch merge é€²å» master ä¹‹å¾Œï¼Œå°±ç¢ºå®šæ˜¯ review éè€Œä¸”ç©©å®šçš„ç¨‹å¼ç¢¼ï¼Œå†ç”±å·¥ç¨‹å¸« pull æœ€æ–°çš„ master ï¼Œç„¶å¾Œåœ¨æœ¬åœ°åŸ·è¡Œ terraform applyï¼ŒæŠŠ infrastructure ç”Ÿå‡ºä¾†ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£åšæœ¬è³ªä¸æœƒæœ‰ä»€éº¼å¤§å•é¡Œï¼Œç•¢ç«Ÿ code å·²ç¶“æ˜¯ç©©å®šã€‚ç„¶è€Œï¼Œå¯¦å‹™ä¸Šå»é‚„æ˜¯æœƒå‡ºç¾å¶ç™¼çš„å•é¡Œã€‚ä¾‹å¦‚ï¼šä½¿ç”¨éŒ¯èª¤çš„ credentail æˆ– contextï¼Œå°è‡´ dev æˆ– staging çš„ infrastructure apply åˆ° prod ä¸Šï¼Œç›´æ¥ p0 issue å¤§çˆ†ç™¼ï¼ŒSRE éƒ½è·ªè‘—ä¸Šç­ã€‚åˆä¾‹å¦‚ï¼šä½¿ç”¨éŒ¯èª¤çš„ master ç‰ˆæœ¬ applyï¼Œçµæœä¹Ÿæ˜¯æœå‹™æ‰ç·šï¼Œæ•´å€‹ team è·ªè‘—ä¸Šç­ã€‚&lt;/p&gt;
&lt;p&gt;é—œéµï¼šåœ˜éšŠæ•´é«”çš„å®‰å…¨æ€§ï¼Œæ˜¯ç”±ç¨‹åº¦æœ€èœçš„åŒäº‹æ±ºå®šã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘å°±æ˜¯åœ¨èªªä½ XDã€‚ç„¶è€Œäººéƒ½æœƒèœï¼Œè€Œäººäº‹æˆæœ¬ä¹Ÿæ˜¯å…¬å¸ç¶“ç‡Ÿçš„é—œéµè€ƒé‡ï¼Œç›¸ä¿¡æ‰€æœ‰åŒäº‹éƒ½å¤§ç¥æ˜¯ä¸åˆ‡å¯¦éš›çš„ï¼Œä¸å¦‚æ”¹é€²å·¥ä½œæµç¨‹ï¼Œè¿‘ä¸€æ­¥é™ä½äººç‚ºæ“ä½œå¤±èª¤çš„å¯èƒ½ã€‚äººçš„å•é¡Œï¼Œæ ¹æœ¬ä¹‹é“é‚„æ˜¯æ•™è‚²ï¼Œç„¶è€Œæˆ‘å€‘å¯ä»¥è©¦è‘—ç”¨æŠ€è¡“èˆ‡å·¥å…·é™ä½é¢¨éšªã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹çš„åšæ³•ï¼Œå¯èƒ½æœƒå”åŠ©é¿å…é€™å€‹å•é¡Œã€‚æˆ‘å€‘è¦åšçš„å°±æ˜¯ CI/CD çš„å…¨è‡ªå‹•åŒ–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;éœ€æ±‚&#34;&gt;éœ€æ±‚&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;é¿å… apply å¤±èª¤
&lt;ul&gt;
&lt;li&gt;é¿å…æ„šè ¢çš„éŒ¯èª¤
&lt;ul&gt;
&lt;li&gt;ç’°å¢ƒåˆ‡æ›éŒ¯èª¤&lt;/li&gt;
&lt;li&gt;apply éŒ¯ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;(æ„šè ¢çš„éŒ¯èª¤æ¯”ä½ æƒ³çš„è¦å¤šï¼Œå‡ºç¾å¾Œæœƒè®“ä½ ä¸‰è§€å¤§é–‹)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŠ é€Ÿå·¥ä½œæµç¨‹
&lt;ul&gt;
&lt;li&gt;PR çµæŸå¾Œï¼Œåœ¨åˆé©çš„æ™‚é–“è‡ªå‹• apply&lt;/li&gt;
&lt;li&gt;è‡ªå‹•å›å ±çµæœ&lt;/li&gt;
&lt;li&gt;å‡ºéŒ¯è‡ªå‹• rollback ä¸Šå€‹ç©©å®šç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€å°æ¬Šé™åŸå‰‡ (least privilege access)
&lt;ul&gt;
&lt;li&gt;åŸæœ¬å·¥ç¨‹å¸«ç‚ºäº† apply ï¼Œæœƒæœ‰ admin æ¬Šé™çš„ credential&lt;/li&gt;
&lt;li&gt;ç§»è½‰åˆ°å®‰å…¨çš„ CI/CD server ä¸Šï¼Œåœ¨ server ä¸ŠåŸ·è¡Œ&lt;/li&gt;
&lt;li&gt;å·¥ç¨‹å¸«ä¸å†æ¡æœ‰é€™äº›è¶…ç´šç®¡ç†å“¡æ¬Šé™ï¼Œé¿å…å·¥ä½œæ©Ÿè¢«é§­çš„å®‰å…¨éš±æ†‚
&lt;ul&gt;
&lt;li&gt;NOTE: å·¥ç¨‹å¸«è¢«é‡£é­š (phishing) æˆ–æ˜¯ç¤¾äº¤å·¥ç¨‹æ”»æ“Š (social engineering attacks) æ‰æ˜¯å°è‡´å…¬å¸æœå‹™è¢«å®³çš„ä¸»å› ï¼Œä¸å¯ä¸é˜²&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è§£æ±ºæ–¹æ¡ˆ&#34;&gt;è§£æ±ºæ–¹æ¡ˆ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;é¸æ“‡å®‰å…¨çš„ CI/CD serverï¼Œä¾‹å¦‚åœ¨å…§ç¶²çš„ self-hosted Jenkins server&lt;/li&gt;
&lt;li&gt;å°‡ terraform çš„åŸ·è¡Œé»ï¼Œå¾å·¥ç¨‹å¸«æœ¬æ©Ÿç§»è½‰åˆ° CI/CD æœå‹™å™¨ä¸Š&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ CI/CD ï¼ŒåŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿ
&lt;ul&gt;
&lt;li&gt;Terraform validate&lt;/li&gt;
&lt;li&gt;Terraform plan çš„çµæœè¼¸å‡ºåˆ° Github / Slack&lt;/li&gt;
&lt;li&gt;plan çµæŸå¾Œåœä½ CI/CDï¼Œç™¼é€ä¸€å€‹ apply request åˆ° Github commentï¼Œä¸å†ç¹¼çºŒåŸ·è¡Œ apply&lt;/li&gt;
&lt;li&gt;SRE ä¸»ç®¡åªè¦é€é Github comment æˆ–æ˜¯ Slack bot å°±å¯ä»¥é¸æ“‡åˆé©çš„æ™‚é–“ï¼Œapprove apply&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€å¾Œç§»é™¤å¤§å¤šæ•¸å·¥ç¨‹å¸«çš„ terraform æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç¯„ä¾‹&#34;&gt;ç¯„ä¾‹&lt;/h1&gt;
&lt;p&gt;äº‹å¯¦ä¸Šï¼Œä¸åŒå®¶çš„ CI/CD serverï¼Œå·¥ä½œæµç¨‹éƒ½æ˜¯é¡ä¼¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;checkout&lt;/li&gt;
&lt;li&gt;initialize tools / SDK (ex. az/aws/gcloud client)&lt;/li&gt;
&lt;li&gt;inject public cloud credential (ex. Azure/AWS/GCP key)&lt;/li&gt;
&lt;li&gt;terraform validete&lt;/li&gt;
&lt;li&gt;terraform plan&lt;/li&gt;
&lt;li&gt;terraform apply
&lt;ul&gt;
&lt;li&gt;(option) require manual approve&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ˜¯ Jenkins çš„ä½¿ç”¨è€…ï¼Œå¯ä»¥åƒè€ƒ &lt;a href=&#34;https://github.com/Azure/terraform-with-jenkins-samples/blob/master/jenkins-pipelines/create-vmss-from-image/provision/Jenkinsfile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure æä¾›çš„ç¯„ä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç’°å¢ƒç®¡ç†&#34;&gt;ç’°å¢ƒç®¡ç†&lt;/h1&gt;
&lt;p&gt;åœ¨äººå·¥ apply çš„å·¥ä½œæµç¨‹ä¸­ï¼Œå·¥ç¨‹å¸«éœ€è¦è‡ªè¡Œåˆ‡æ›ç’°å¢ƒï¼Œä¾‹å¦‚ git repo å·¥ä½œç›®éŒ„å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tree
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; â”œâ”€â”€ dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; â”œâ”€â”€ staging
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; â””â”€â”€ prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd project/dev; terraform plan  # plan staging
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd project/prod; terraform plan # plan prod
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ˜¯ç›¸å°æ¯”è¼ƒå®‰å…¨çš„åšæ³•ï¼Œåœ¨å°çš„è³‡æ–™å¤¾ç›®éŒ„ä¸‹ï¼Œå°±æœƒ apply åˆ°æ­£ç¢ºçš„ç’°å¢ƒï¼Œç¨‹å¼ç¢¼èˆ‡ç’°å¢ƒæœ‰ç·Šå¯†çš„å°æ˜ ã€‚é™¤äº†ä»¥ä¸‹å¹¾ç¨®æƒ…å½¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æƒ³è¦éƒ¨ç½² devï¼Œçµæœæ²’æ³¨æ„åˆ°è‡ªå·±åœ¨ staging æˆ–æ˜¯ prod&lt;/li&gt;
&lt;li&gt;æœ‰ä¸€éƒ¨åˆ†çš„ input variable æœƒå½±éŸ¿çµæœï¼Œç„¶å¾Œåˆè¼¸å…¥éŒ¯èª¤çš„ input åˆ°éŒ¯èª¤çš„ç’°å¢ƒä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°å¾ˆæ„šè ¢ï¼Œä½†æˆ‘éƒ½è¦‹éï¼ˆæ°£è¡€æ”»å¿ƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶å°å…¥äº†è‡ªå‹•åŒ–ï¼Œç’°å¢ƒçš„åˆ‡æ›å¯ä»¥è‡ªå‹•åˆ‡æ›ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰ feature branch åŸ·è¡Œ CI/CD server ä¸Šçš„æœ¬åœ°æ¸¬è©¦
&lt;ul&gt;
&lt;li&gt;lint&lt;/li&gt;
&lt;li&gt;init&lt;/li&gt;
&lt;li&gt;validate&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ PR éƒ½æœƒè§¸ç™¼æ–°çš„ dev ç’°å¢ƒéƒ¨ç½²
&lt;ul&gt;
&lt;li&gt;plan&lt;/li&gt;
&lt;li&gt;apply&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦è…³æœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ master merge / push éƒ½æœƒè§¸ç™¼ staginge éƒ¨ç½²
&lt;ul&gt;
&lt;li&gt;QA æ¸¬è©¦&lt;/li&gt;
&lt;li&gt;å£“åŠ›æ¸¬è©¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;(optional) æ‰€æœ‰ release candidate tag æœƒéƒ¨ç½²åˆ° release candinate
&lt;ul&gt;
&lt;li&gt;release management&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ç™¼å¸ƒç‰ˆæœ¬çš„ tag (ex. 1.1.0 / 1.2.0-release) æœƒéƒ¨ç½² prod
&lt;ul&gt;
&lt;li&gt;ç•¶ç„¶è¦äº‹å…ˆé€šçŸ¥ç›¸é—œäººå£« stack holders&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è³‡æ·±å·¥ç¨‹å¸«åªè¦æ§åˆ¶ branch / tag å°±å¯ä»¥æ§åˆ¶ç™¼å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;ä½ èªªé€™æ¨£ï¼Œè¬ä¸€å¤©å…µå»è‡ªå·±æ‰“ tag æ‰“éŒ¯ commitï¼Œæˆ–æ˜¯æ¨éŒ¯ branch æ¨åˆ° masteræˆ–æ˜¯ release candidateï¼Œé‚„ä¸æ˜¯ä¾æ¨£çˆ†æ‰ã€‚é‚£ä½ å¯ä»¥æŠŠ master èˆ‡ release branch é–èµ·ä¾† (protected branch) ï¼Œç„¶å¾ŒæŠŠ tag push æ¬Šé™é–ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä½ èªªé‚„æ˜¯éŒ¯
é‚£æˆ‘&amp;hellip;
&amp;hellip;å€‘çœ‹ä¸‹ä¸€æ®µ orz&lt;/p&gt;
&lt;h1 id=&#34;å®‰å…¨æ€§&#34;&gt;å®‰å…¨æ€§&lt;/h1&gt;
&lt;p&gt;é›–ç„¶èªªæ˜¯è‡ªå‹•åŒ–æ”¹å–„å·¥ä½œæµç¨‹ï¼Œç„¶è€Œæ”¶å›å­˜å–æ¬Šé™ï¼Œå°æ–¼æœå‹™çš„æ•´é«”å®‰å…¨æ€§å¤§å¹…æå‡ï¼Œç•¢ç«Ÿæ˜¯å¯ä»¥æ›´æ”¹ infrastructure çš„ç®¡ç†å“¡å¸³æˆ¶ã€‚Terraform æ—¢ç„¶èƒ½å¤ æ–°å¢ä¿®æ”¹é›²ç«¯çš„ infrastructureï¼Œé€™å€‹å¸³è™Ÿçš„æ¬Šé™æ˜¯ç›¸ç•¶å¤§çš„ï¼Œè¬ä¸€é‡‘é‘°(GCP/AWS/Azure credentail) æµå‡ºæˆ–é­é§­ï¼Œå¾Œæœéƒ½æ˜¯æ¯€æ»…æ€§çš„ï¼Œä¾‹å¦‚å¯ä»¥ç›´æ¥åˆªé™¤æœå‹™çš„ infrastructureï¼Œæˆ–æ˜¯ä¿®æ”¹é˜²ç«ç‰†çš„è¦å‰‡ï¼Œå·åŸ‹å…¶ä»–é‡‘è€€ï¼Œ&amp;hellip;ç­‰æ–¼æ˜¯æ•´åº§å…¬æœ‰é›²é€çµ¦é§­å®¢ã€‚æ‰€ä»¥æˆ‘å€‘ä½¿ç”¨ Terraform æ‡‰è©²è¦æ…é‡è€ƒæ…®å­˜å–æ¬Šé™çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¾†æ˜¯æ¯å€‹ SRE çš„æœ¬æ©Ÿé›»è…¦ä¸Šï¼Œå¯èƒ½éƒ½æœƒæœ‰é€™æŠŠå¸³æˆ¶æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ self-hosted Jenkins serverï¼Œæˆ–æ˜¯ Github enterprise serverï¼ŒæŠŠæœå‹™æ¬Šé™ç§»è½‰åˆ°é€™äº›æœå‹™å™¨ï¼Œä¾¿å¯ä»¥ç¢ºä¿é‡‘é‘°æ°¸é éƒ½åœ¨å…¬å¸çš„é˜²ç«ç‰†å…§éƒ¨ç¶²è·¯ï¼Œæ›´åŠ å¤§å¹…åº¦çš„æå‡æ•´é«”çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h1&gt;
&lt;p&gt;å¯ä»¥é€²ä¸€æ­¥åšé‡‘é‘°æ¬Šé™åˆ†å‰²ï¼Œå°‡åº•ä¸‹å››å€‹æ¬Šé™é€éå…¬æœ‰é›²çš„ IAM role å»åˆ‡å‰²ã€‚è¦æ˜¯è¬ä¸€é‡‘é‘°é‚„æ˜¯å¤–æ´©äº†ï¼Œå¯ä»¥é™ä½æå¤±ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®€å–&lt;/li&gt;
&lt;li&gt;æ–°å¢&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;åˆªé™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ èªªé€™å€‹ä¸ç”¨è‡ªå‹•åŒ–å°±å¯ä»¥åšï¼Œæˆ‘èªªå¦‚æœåˆ†å‰²é‡‘é‘°ç„¶å¾Œäººå·¥è‡ªå·±åˆ‡æ›æ“ä½œï¼Œåè€Œæœƒå¢åŠ æ“ä½œçš„è¤‡é›œåº¦ï¼Œå¢åŠ éŒ¯èª¤çš„æ©Ÿæœƒã€‚ç„¶å¾Œå·¥ç¨‹å¸«çš„ç—›è‹¦ç¨‹åº¦ï¼Œèˆ‡æ‰‹ä¸Šçš„é‡‘é‘°æ•¸é‡æˆæ­£æ¯”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–æ˜¯åˆ©ç”¨ç’°å¢ƒå­˜å–é‡‘è€€åˆ†å‰²ï¼ŒæŠŠé‡‘è€€é€²ä¸€æ­¥åˆ‡å‰²æˆä¸åŒçš„æ¬Šé™ï¼Œè¬ä¸€æ‰äº†ï¼Œæå®³ä¹Ÿæ§åˆ¶åœ¨ä¸€å€‹ç’°å¢ƒä¹‹å…§ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dev&lt;/li&gt;
&lt;li&gt;staging&lt;/li&gt;
&lt;li&gt;prod&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸åŒç’°å¢ƒçš„ infrastructure ï¼Œåœ¨å‰µå»ºåˆæœŸå°±æ˜¯é€éä¸åŒçš„å¸³è™Ÿç”¢ç”Ÿçš„ï¼Œå½¼æ­¤ä¸æœƒæœ‰ä¸ä¹¾æ·¨æ®˜ç•™çš„å¸³è™Ÿæ¬Šé™ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;p&gt;é€™é‚Šå°±è¬›å…©ä»¶äº‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå‹•åŒ–å¯ä»¥é˜²å‘†&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–å¯ä»¥å¢åŠ å®‰å…¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åƒè€ƒæ–‡ä»¶&#34;&gt;åƒè€ƒæ–‡ä»¶&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://learn.hashicorp.com/tutorials/terraform/automate-terraform?in=terraform/automation&amp;amp;utm_source=WEBSITE&amp;amp;utm_medium=WEB_IO&amp;amp;utm_offer=ARTICLE_PAGE&amp;amp;utm_content=DOCS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform Official doc: Running Terraform in Automation
&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code: Example repository</title>
      <link>https://chechia.net/zh-hant/post/2020-10-02-terraform-infrastructure-as-code-repository-example/</link>
      <pubDate>Fri, 02 Oct 2020 11:15:48 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-10-02-terraform-infrastructure-as-code-repository-example/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸Šé¢è¬›äº†å¾ˆå¤š terraform çš„æ“ä½œç¯„ä¾‹ï¼Œæ‡‰è©²çœ‹åˆ°é€™è£¡ï¼Œå°æ–¼ terraform åŸºæœ¬ä¸Šæ˜¯ä»€éº¼æ±è¥¿ï¼Œæ‡‰è©²æœ‰äº›æ¦‚å¿µäº†ã€‚ç„¶è€Œé€™æ¨£é‚„ä¸èƒ½ç®—æ˜¯å­¸æœƒ terraformï¼Œé€™ç¨®å·¥å…·çš„æ±è¥¿ä¸€å®šè¦æœ‰å¯¦éš›æ“ä½œéçš„ç¶“é©—æ‰ç®—æ˜¯å­¸æœƒã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ç›´æ¥åƒè€ƒ Terraform å®˜æ–¹çš„ Get-started æ–‡ä»¶ä¾†æ“ä½œå­¸ç¿’ï¼Œæˆ‘é€™é‚Šä¹Ÿæä¾›ä¸€å€‹ Git repository è®“å¤§å®¶ä¸Šæ‰‹ï¼Œç•¶ä½œåˆæ¬¡æ“ä½œçš„æ¡†æ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æä¾›åšç‚ºç¯„ä¾‹çš„åŸå§‹ç¢¼&#34;&gt;æä¾›åšç‚ºç¯„ä¾‹çš„åŸå§‹ç¢¼&lt;/h3&gt;
&lt;p&gt;é€™å€‹ Github Repository æ˜¯æˆ‘çµ¦ç¤¾ç¾¤æ¼”è¬›æ‰€ä½¿ç”¨çš„ç¯„ä¾‹ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨çš„å¯ä»¥åƒè€ƒ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terraform-playground&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tree
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ SOP.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ aws/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ azure/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ gcp/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;tldr&#34;&gt;TL;DR&lt;/h3&gt;
&lt;p&gt;é¸æ“‡ä½¿ç”¨çš„é›²å¹³å°ï¼Œé€™é‚Šæä¾›ä¸‰å®¶ç¯„ä¾‹ï¼Œä¾‹å¦‚æˆ‘é€™é‚Šä½¿ç”¨ gcpï¼Œç•¶ç„¶ä½ å°±è¦æº–å‚™ GCP çš„å¸³è™Ÿï¼Œä¸¦ä¸”ä¸‹è¼‰æœ‰åŸ·è¡Œæ¬Šé™çš„ç”¨æˆ¶ credential json key ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶æˆ‘æ²’æ”¶ gcp éŒ¢ï¼Œé€™é‚Šé‚„æ˜¯æ¨å»£ä¸€ä¸‹ gcp çš„ free credit è©¦ç”¨ã€‚é˜¿è¦ç”¨ Azure Cloud çš„ free credit ä¾†åŸ·è¡Œé€™å€‹ç¯„ä¾‹ä¹Ÿæ˜¯å®Œå…¨æ²’å•é¡Œï¼Œéå¸¸å¤ ç”¨ã€‚å”¯æœ‰ AWS çš„è©¦ç”¨æ–¹æ¡ˆè·Ÿå‰©ä¸‹å…©å®¶ä¸å¤ªä¸€æ¨£ï¼Œé€™å€‹ repository èµ·çš„æœå‹™å¯èƒ½æœƒè¶…é AWS çš„å…è²»é¡åº¦æ¶µè“‹ç¯„åœï¼Œç¸½ä¹‹è«‹è‡ªå·±æ³¨æ„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/chechiachang/terraform-playground
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd gcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DIR=my-new-project make project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd my-new-project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim *tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform apply
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ¨£æ‡‰è©²å°±æœƒè·‘å®Œã€‚ç„¶å¾Œæˆ‘å€‘è¬›è§£å¹¾å€‹åœ°æ–¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œç›®éŒ„&#34;&gt;å·¥ä½œç›®éŒ„&lt;/h3&gt;
&lt;p&gt;Terraform é è¨­æ˜¯ä»¥ç•¶ä¸‹åŸ·è¡Œçš„ç›®éŒ„ä½œç‚ºåŸºæº–ï¼Œæƒæè³‡æ–™å¤¾ä¸­çš„ .tf æª”æ¡ˆã€‚æ‰€ä»¥å¯ä»¥æŠŠä¸€å€‹ä¸€å€‹ç¨ç«‹çš„å°ˆæ¡ˆå…ˆç”¨è³‡æ–™å¤¾è£å¥½ï¼Œå½¼æ­¤å…§å®¹äº’ä¸å¹²æ¶‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šå‰µå»ºæ–°çš„ subdirectoryï¼Œé€™é‚Šæ˜¯ä»¥ my-new-project ç‚ºç¯„ä¾‹ã€‚é€™é‚ŠæŒ‡çš„ project åªæ˜¯ä¸€å€‹ terraform resource ç¯„åœï¼Œå¯ä»¥ä½†ä¸ç”¨æ˜¯ä¸€å€‹çœŸå¯¦çš„ gcp projectã€‚terraform åŸ·è¡Œæ˜¯ä»¥ä¸€å€‹ directory ç‚ºç¯„åœï¼Œä¸åŒ project directory å¯ä»¥é€éä¸åŒ terraform æŒ‡ä»¤æ§åˆ¶ã€‚å¦‚æœæ˜¯ç¨ç«‹çš„æœå‹™å¸Œæœ›ç¨ç«‹ç®¡ç†ä¹Ÿå¯ä»¥åˆ‡é–‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¯«äº†ä¸€å€‹ç°¡å–®çš„ Makefileï¼Œé€²ä¸€æ­¥å°è£åŸºæœ¬çš„æŒ‡ä»¤ï¼ŒåŸºæœ¬ä¸Šä¸éœ€è¦ Makefile ä»¥å¤–çš„æ“ä½œã€‚
make project æ˜¯å…¶ä¸­ä¸€å€‹æŒ‡ä»¤ï¼Œå¹«å¿™å‰µå»ºè³‡æ–™å¤¾ã€å¸ƒç½® Makefile èˆ‡åŸºæœ¬çš„ terraform è¨­å®šç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ˜éšŠæœ‰å¤šäººå”ä½œï¼Œéå¸¸æ¨è–¦ä½¿ç”¨çµ±ä¸€ Makefile / æˆ–æ˜¯ bash script å°è£ï¼Œçµ±ä¸€é€™äº›ç·¨è¼¯çš„é›œäº‹ï¼Œé™ä½ä¸åŒäººç·¨è¼¯å‡ºéŒ¯çš„é¢¨éšªã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›®éŒ„çµæ§‹&#34;&gt;ç›®éŒ„çµæ§‹&lt;/h3&gt;
&lt;p&gt;ç¸½ä¹‹æˆ‘å€‘ç¾åœ¨ cd åˆ° my-new-project çš„å·¥ä½œç›®éŒ„ä¸‹ï¼Œé€™å€‹ç›®éŒ„ä»£è¡¨ä¸€å€‹å°ˆæ¡ˆã€‚å…¶ä»–çš„ gke-playgound èˆ‡ national-team-5g ä¹Ÿæ˜¯å…¶ä»–çš„å°ˆæ¡ˆï¼Œå…ˆå¿½ç•¥ä»–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ my-new-project/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ gke-playground/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ national-team-5g/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ templates/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ modules/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd my-new-project
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€²å…¥ my-new-project ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è£¡é¢å·²ç¶“æœ‰ä¸€äº›æª”æ¡ˆï¼Œæˆ‘å€‘é¦–å…ˆè¦ç·¨è¼¯çš„æ˜¯é€™å€‹ &lt;code&gt;terraform.tf&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my-new-project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ variables.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;terraformtf-æ˜¯-terraform-æœ¬èº«çš„è¨­å®š&#34;&gt;terraform.tf æ˜¯ terraform æœ¬èº«çš„è¨­å®š&lt;/h3&gt;
&lt;p&gt;é€™é‚Šæ˜¯ Terraform Backend çš„è¨­å®šï¼Œå¦‚æœä¸çŸ¥é“ä»€éº¼æ˜¯ terraform backend é€™å€‹æˆ‘å€‘æ˜å¤©çš„æ–‡ç« æœƒè¬›ã€‚é€™é‚Šä½¿ç”¨çš„ backend æ˜¯ terraform å®˜æ–¹è‡ªå®¶çš„ &lt;a href=&#34;https://app.terraform.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;terraform cloud&lt;/a&gt;ï¼Œå¯ä»¥åœ¨ç¶²ç«™ä¸Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨»å†Šä½¿ç”¨è€…ï¼Œå¡«åˆ°åº•ä¸‹ &lt;code&gt;organization&lt;/code&gt; é€™è£¡&lt;/li&gt;
&lt;li&gt;å‰µå»ºä¸€å€‹ workspaceï¼Œå¡«åˆ° &lt;code&gt;workspace.name&lt;/code&gt; é€™è£¡&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Create a remote organization on https://app.terraform.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  backend &amp;#34;remote&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Provide terraform credential by
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # - terraform login (suggested)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # - use User API Token
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #token        = &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    hostname     = &amp;#34;app.terraform.io&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    organization = &amp;#34;chechia&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    workspaces {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      name = &amp;#34;terraform-playground&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;providertf-æ˜¯-provider-çš„è¨­å®š&#34;&gt;provider.tf æ˜¯ provider çš„è¨­å®š&lt;/h3&gt;
&lt;p&gt;terraform client æœƒæŠŠ tf æª”æ¡ˆæ‹¿ä¾†é‹ç®—ï¼Œé€é Provider ï¼Œå°‡éœ€æ±‚å¯¦éš›è½‰åŒ–æˆ API call ï¼Œç„¶å¾Œé€åˆ°å…¬æœ‰é›²æˆ–æ˜¯å…¶ä»–ç›®æ¨™ã€‚é€™é‚Šå°±åªè¬›åˆ°é€™æ¨£ã€‚&lt;/p&gt;
&lt;p&gt;provider ç‚ºäº†å·¥ä½œï¼Œå¯èƒ½æœƒéœ€è¦æä¾›ä¸€äº›åƒæ•¸ï¼Œä¾‹å¦‚ google çš„ provider æœƒéœ€è¦åœ¨é€™è£¡æä¾› credential_json çš„è·¯å¾‘ï¼Œè«‹æŠŠå®ƒæ”¾åœ¨é©åˆçš„åœ°æ–¹ï¼Œç„¶å¾Œç”¨çµ•å°è·¯å¾‘æŒ‡å‘ google&lt;/p&gt;
&lt;p&gt;NOTE: ä¸è¦ commit credential key åˆ° git repository è£¡é¢ã€‚å¯ä»¥æ”¾åˆ°å¤–å±¤è³‡æ–™å¤¾ï¼Œæˆ–è‡³å°‘è¦ gitignore æ‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;provider &amp;#34;google&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  version = &amp;#34;~&amp;gt;v3.25.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  credentials = file(var.credential_json)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  project = var.project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  region  = var.region
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;variabletf-åšåƒæ•¸çš„å­˜æ”¾é»&#34;&gt;variable.tf åšåƒæ•¸çš„å­˜æ”¾é»&lt;/h3&gt;
&lt;p&gt;é›–ç„¶ä¸Šé¢ tf æª”æ¡ˆä½¿ç”¨äº† terraform / provider / variable ï¼Œä½† terraform æƒææª”æ¡ˆæ™‚ï¼Œæª”åæœ¬èº«ä¸¦ä¸æœƒå½±éŸ¿ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œåƒæ•¸ä½ æƒ³æ“ºå“ªå°±æ“ºå“ªã€‚ä¸éä¸Šé¢æ˜¯å¸¸è¦‹çš„å‘½åæ…£ä¾‹ï¼Œé€™æ¨£æ“ºäººé¡æ¯”è¼ƒå®¹æ˜“æ‰¾å¾—åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;variable é€™é‚Šè¨­å®šçš„åƒæ•¸ï¼Œæ¯”è¼ƒåƒæ˜¯ argumentsï¼Œä¹Ÿå°±æ˜¯ç•¶å…¶ä»–ä½ç½®çš„ tf æª”æ¡ˆï¼Œå¼•ç”¨é€™å€‹è³‡æ–™å¤¾ä½œç‚º module çš„æ™‚å€™ï¼Œä½œç‚ºåƒæ•¸è¼¸å…¥çš„ placeholderï¼Œå…¶ä»– tf æª”æ¡ˆå¯ä»¥ä½¿ç”¨ variable é—œéµå­—å®šç¾©çš„åƒæ•¸ï¼Œä¾‹å¦‚: var.projectï¼Œæˆ–æ˜¯ provider.tf è£¡çš„ var.credential_jsonã€‚&lt;/p&gt;
&lt;p&gt;variable é—œéµå­—ä¹Ÿå¯ä»¥å®šç¾© default é è¨­å€¼ï¼Œå¦‚æœæ²’æœ‰å®šç¾© defaultï¼Œä¹Ÿæ²’æœ‰å¾å¤–éƒ¨å‚³å…¥ argumentï¼Œæœƒåœ¨ validate æ™‚é€ æˆ errorã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Global
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;variable &amp;#34;project&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type    = string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  default = &amp;#34;myproject&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;variable &amp;#34;credential_json&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type    = string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  default = &amp;#34;../credentials/gke-playground-0423-aacf6a39cc3f.json&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;variable &amp;#34;region&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type    = string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  default = &amp;#34;asia-east1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;create&#34;&gt;Create&lt;/h3&gt;
&lt;p&gt;é€™è£¡æˆ‘å€‘è©¦è‘—å‰µå»ºä¸€å° GCEï¼Œä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼Œæœƒç™¼ç¾å¤šäº†ä¸€å€‹æª”æ¡ˆ compute_instance.tfã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME=my-new-gce make gce
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my-new-project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ compute_instance.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ provider.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ terraform.tf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ variables.tf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…§å®¹å¤§æ¦‚æ˜¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;module &amp;#34;my-new-gce&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  source = &amp;#34;../modules/compute_instance&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  providers = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    google      = google
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  project      = var.project
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name         = &amp;#34;my-new-gce&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  image        = &amp;#34;https://www.googleapis.com/compute/v1/projects/centos-cloud/global/images/centos-7-v20200429&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  machine_type = &amp;#34;n1-standard-1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  network    = &amp;#34;projects/${var.project}/global/networks/myproject&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  subnetwork = &amp;#34;projects/${var.project}/regions/asia-east1/subnetworks/myproject&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;module é—œéµå­—å®šç¾©ä¸€çµ„è³‡æºï¼Œ&lt;a href=&#34;https://github.com/chechiachang/terraform-playground/tree/master/gcp/modules/compute_instance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…·é«”çš„å…§å®¹æ˜¯é€™è£¡&lt;/a&gt;ï¼Œç°¡å–®ä¾†èªªå¯ä»¥æŠŠä¸€å † tf æª”æ¡ˆæ”¾åœ¨ä¸€å¡Šï¼Œç„¶å¾ŒæŠŠéœ€è¦çš„åƒæ•¸ä½¿ç”¨ variable.tf æ‹‰å‡ºå»ï¼Œè®“å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;source = &amp;quot;&amp;quot; æ˜¯å¯¦éš›å¼•ç”¨çš„ module ä¾†æº&lt;/p&gt;
&lt;p&gt;åº•ä¸‹æ˜¯é€™å€‹ module éœ€è¦ç”¨åˆ°çš„åƒæ•¸ï¼Œä¾‹å¦‚ project, name, image, machine_type,&amp;hellip; ç­‰æ˜¯ gce é€™å€‹ module éœ€è¦çš„åƒæ•¸ã€‚&lt;/p&gt;
&lt;h3 id=&#34;makefile&#34;&gt;Makefile&lt;/h3&gt;
&lt;p&gt;NAME=my-new-gce make gce
é€™è¡ŒæŒ‡ä»¤èˆ‡ terraform ç„¡é—œï¼Œåªæ˜¯ä¸€å€‹å¿«é€Ÿç”Ÿæˆ compute_instance.tf çš„å°è…³æœ¬ã€‚ä½¿ç”¨é€™å€‹è…³æœ¬å¯ä»¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿«é€Ÿç”¢ç”Ÿ tf æª”æ¡ˆ&lt;/li&gt;
&lt;li&gt;ç”¢ç”Ÿæ¨™æº–åŒ–çš„ tf æª”æ¡ˆï¼Œæ‰€æœ‰ project çš„ compute_instance éƒ½é•·ä¸€æ¨£&lt;/li&gt;
&lt;li&gt;æŠ½æ›åå­ name&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ symbolic link è®“æ‰€æœ‰ project è³‡æ–™å¤¾ä½¿ç”¨åŒä¸€å€‹ Makefileï¼Œkeep your code DRYã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œå°±æ˜¯å¸¸è¦çš„ plan èˆ‡ applyï¼Œé€™é‚Šæ²’æœ‰ä»€éº¼ç‰¹åˆ¥çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform plan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;terraform apply
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰è¦å¾‹åœ°æ•´ç† project å¯ä»¥é™ä½ç¶­è­·æˆæœ¬&lt;/li&gt;
&lt;li&gt;å–„ç”¨ module å°è£ï¼Œå¯ä»¥æé«˜æ•´é«”çš„é‡ç”¨æ€§èˆ‡æ˜“ç”¨å§“ï¼Œæé«˜é–‹ç™¼æ•ˆç‡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ template tf å¯ä»¥åŠ é€Ÿé‡è¤‡çš„è³‡æºç”¢ç”Ÿæ­¥é©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å•é¡Œ: æ­¤æ™‚çš„è³‡æ–™å¤¾ä¸­é‚„æ˜¯å……æ»¿å¤§é‡é‡è¤‡çš„ codeï¼Œä¾‹å¦‚åˆ°è™•éƒ½éœ€è¦ providerã€é‡è¤‡çš„ moduleï¼Œä¸€å¤§å †é‡è¤‡çš„æ±è¥¿ã€‚æœ‰æ²’æœ‰å¯èƒ½å†è®“æˆ‘å€‘çš„ç¨‹å¼ç¢¼æ›´ DRY ä¸€é»å‘¢?&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/gruntwork-io/terragrunt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terragrunt&lt;/a&gt; å¹«æˆ‘å€‘å¯¦ç¾é€™é»ï¼Œéå¸¸å€¼å¾—ä½¿ç”¨çš„å·¥å…·ã€‚è«‹è¦‹ä¸‹ç¯‡åˆ†äº«ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2020-09-26-gcp-preemptible-instance-kubernetes/</link>
      <pubDate>Sat, 26 Sep 2020 17:24:20 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-26-gcp-preemptible-instance-kubernetes/</guid>
      <description>&lt;h3 id=&#34;å…ˆå è™›æ“¬æ©Ÿèˆ‡-kubernetes&#34;&gt;å…ˆå è™›æ“¬æ©Ÿèˆ‡ Kubernetes&lt;/h3&gt;
&lt;p&gt;åœ¨ GCP ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿï¼Œæœƒéœ€è¦é¢å°å…ˆå è™›æ“¬æ©Ÿçš„é¡å¤–é™åˆ¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è³‡æ–™ä¸­å¿ƒæœƒ (å¯é æœŸæˆ–ä¸å¯é æœŸåœ°) çµ‚æ­¢å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿä¸èƒ½è‡ªå‹•é‡å•Ÿï¼Œè€Œæ˜¯æœƒè¢«è³‡æ–™ä¸­å¿ƒçµ‚æ­¢å¾Œå›æ”¶&lt;/li&gt;
&lt;li&gt;GCP ä¸ä¿è­‰æœ‰è¶³å¤ çš„å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¯€é»çš„çµ‚æ­¢æœƒé€ æˆé¡å¤–çš„ç¶­é‹æˆæœ¬ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®¡ç†å¤šå€‹ç¯€é»ï¼Œå®¹å¿å…ˆå è™›æ“¬æ©Ÿçš„ç§»é™¤ï¼Œè‡ªå‹•è£œå……æ–°çš„å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;ç®¡ç†å¤šå€‹æ‡‰ç”¨è¤‡æœ¬ï¼Œç¯€é»çµ‚æ­¢æ™‚ï¼Œç¶­è­·æ•´é«”æ‡‰ç”¨çš„å¯ç”¨æ€§&lt;/li&gt;
&lt;li&gt;å°‡ç§»é™¤ç¯€é»ä¸Šçš„æ‡‰ç”¨ï¼Œé‡æ–°æ’ç¨‹åˆ°å…¶ä»–å¯ç”¨ç¯€é»&lt;/li&gt;
&lt;li&gt;å‹•æ…‹ç¶­è­·æ‡‰ç”¨è¤‡æœ¬çš„æœå‹™ç™¼ç¾ (Service Discovery) èˆ‡æœå‹™ç«¯é» (Endpoints)
&lt;ul&gt;
&lt;li&gt;æ„æ€æ˜¯æ‡‰ç”¨é—œé–‰é‡å•Ÿå¾Œï¼Œæ›äº†ä¸€å€‹æ–° IPï¼Œé‚„è¦èƒ½æŒçºŒå­˜å–æ‡‰ç”¨ã€‚èˆŠçš„ IP è¦ä¸»å‹•å¤±æ•ˆ&lt;/li&gt;
&lt;li&gt;é…åˆæ‡‰ç”¨çš„å¥åº·æª¢æŸ¥ (Health Check) èˆ‡å¯ç”¨æª¢æŸ¥ (Readiness Check)ï¼Œå†åˆ†é…ç¶²è·¯æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›éœ€æ±‚ï¼Œå¿…é ˆè¦æœ‰è‡ªå‹•åŒ–çš„ç®¡ç†å·¥å…·ï¼Œæ˜¯ä¸å¯èƒ½äººå·¥ç®¡ç†çš„ï¼Œæƒ³åƒä½ æ‰‹ä¸Šä½¿ç”¨ 100 å€‹å…ˆå ç¯€é»ï¼Œå¹³å‡æ¯å¤©æœƒæœ‰ 10% - 15% çš„å…ˆå ç¯€é»è¢«è³‡æ–™ä¸­å¿ƒå›æ”¶ï¼Œç¶­é‹éœ€è¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è£œè¶³è¢«ç§»é™¤çš„ 15 å€‹ç¯€é»&lt;/li&gt;
&lt;li&gt;è¨ˆç®—è¢«ç§»é™¤çš„æ‡‰ç”¨ï¼Œè£œè¶³ç§»é™¤çš„æ‡‰ç”¨æ•¸é‡&lt;/li&gt;
&lt;li&gt;ç§»é™¤å¤±æ•ˆçš„æ‡‰ç”¨ç«¯é»ï¼Œè£œä¸Šæ–°çš„æ‡‰ç”¨ç«¯é»&lt;/li&gt;
&lt;li&gt;æŒçºŒç›£æ§æ‡‰ç”¨ç‹€æ…‹&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ²’æœ‰è‡ªå‹•åŒ–ç®¡ç†å·¥å…·ï¼Œçœ‹äº†å¿ƒå·²ç´¯ (è²“çˆªæ©é¢)&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä½¿ç”¨ Kubernetes å”åŠ©ç¶­é‹è‡ªå‹•åŒ–ï¼Œåœ¨ GCP ä¸Šæˆ‘å€‘ä½¿ç”¨ GKEï¼Œé™¤äº†ä¸Šè¿°æåˆ°çš„å®¹å™¨æ‡‰ç”¨ç®¡ç†è‡ªå‹•åŒ–å¤–ï¼ŒGKE é‚„é¡å¤–æ•´åˆå…ˆå è™›æ“¬æ©Ÿçš„ä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•Ÿç”¨å…ˆå è™›æ“¬æ©Ÿçš„ç¯€é»æ±  (node-pool)ï¼Œè¨­å®šç¯€é»æ± çš„è‡ªå‹•æ‹“å±•ï¼Œè‡ªå‹•è£œè¶³å…ˆå ç¯€é»çš„æ•¸é‡&lt;/li&gt;
&lt;li&gt;GKE è‡ªå‹•ç¶­è­·å…ˆå è™›æ“¬æ©Ÿçš„ labels&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é—œæ–¼ GKE çš„å…ˆå è™›æ“¬æ©Ÿçš„å®Œæ•´ç´°ç¯€ï¼Œè«‹è¦‹&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/preemptible-vms&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP å®˜æ–¹æ–‡ä»¶&lt;/a&gt;ã€‚é€™ä»½æ–‡ä»¶åº•ä¸‹ä¹Ÿæä¾›äº† GCP å®˜æ–¹å»ºè­°çš„å…ˆå è™›æ“¬æ©Ÿæœ€ä½³å¯¦è¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶æ§‹è¨­è¨ˆéœ€è¦å‡è¨­ï¼Œéƒ¨åˆ†æˆ–æ˜¯å…¨éƒ¨çš„å…ˆå è™›æ“¬æ©Ÿéƒ½ä¸å¯ç”¨çš„æƒ…å½¢&lt;/li&gt;
&lt;li&gt;Pod ä¸ä¸€å®šæœ‰æ™‚é–“èƒ½å„ªé›…çµ‚æ­¢ (graceful shutdown)&lt;/li&gt;
&lt;li&gt;åŒæ™‚ä½¿ç”¨éš¨é¸è™›æ“¬æ©Ÿèˆ‡å…ˆå è™›æ“¬æ©Ÿï¼Œä»¥ç¶­æŒå…ˆå è™›æ“¬æ©Ÿä¸å¯ç”¨æ™‚ï¼Œæœå‹™ä¾ç„¶å¯ç”¨&lt;/li&gt;
&lt;li&gt;æ³¨æ„ç¯€é»æ›¿æ›æ™‚çš„ IP è®Šæ›´&lt;/li&gt;
&lt;li&gt;é¿å…ä½¿ç”¨æœ‰ç‹€æ…‹çš„ Pod åœ¨å…ˆå è™›æ“¬æ©Ÿä¸Š (é€™é»ç¨å¾Œçš„æ–‡ç« ï¼Œæˆ‘å€‘æœƒè©¦åœ–è¶…è¶Š)&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ node taint ä¾†å”åŠ©æ’ç¨‹åˆ°å…ˆå è™›æ“¬æ©Ÿï¼Œèˆ‡éå…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½ä¹‹ï¼Œç”±æ–¼æœ‰å®¹å™¨è‡ªå‹•åŒ–ç®¡ç†ï¼Œæˆ‘å€‘æ‰èƒ½è¼•æ˜“çš„ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿã€‚&lt;/p&gt;
&lt;h3 id=&#34;gke&#34;&gt;GKE&lt;/h3&gt;
&lt;p&gt;ç„¶è€Œï¼Œæ±ºå®šä½¿ç”¨ GKE å¾Œï¼Œå°±æœ‰è¨±å¤šé—œæ–¼æˆæœ¬çš„äº‹æƒ…éœ€è¦è¨è«–&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹ &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/pricing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GKE çš„è¨ˆè²»æ–¹å¼ pricing&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯å€‹ GKE é›†ç¾¤ç®¡ç†è²»ç”¨ $0.1/hr = $72/hr&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™å€‹è²»ç”¨æ˜¯å›ºå®šæ”¶è²»ï¼Œåªè¦é–‹ä¸€å€‹é›†ç¾¤ï¼Œä¸è«–é›†ç¾¤çš„ç¯€é»æ•¸é‡ã€‚æ‰€ä»¥åœ¨ç¯€é»å¤šã€ç®—åŠ›å¤§çš„é›†ç¾¤è£¡ï¼Œé€™å€‹è²»ç”¨æœƒè¢«ç¨€é‡‹ï¼Œä½†åœ¨ç¯€é»å°‘çš„é›†ç¾¤è£¡æ¯”ä¾‹æœƒè¢«æ”¾å¤§ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œ GKE é‚„æ˜¯æœƒæœ‰ä¸€äº›è‡ªå·±çš„æ¯›ï¼Œä¿—è©±èªªæœ‰ä¸€å¥½æ²’å…©å¥½ï¼Œæˆ‘å€‘ä½¿ç”¨å®ƒçš„å¥½è™•åŒæ™‚ï¼Œä¹Ÿè¦æ³¨æ„è¨±å¤šçœ‰çœ‰è§’è§’ã€‚å†ä¾†çˆ¬&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶&lt;/a&gt;ã€‚å¦‚åŒæœ€å‰é¢å®£å°ï¼Œç”¨ç”¢å“å°±è¦ä¹–ä¹–æŠŠæ–‡ä»¶çœ‹å®Œï¼Œä¸éé€™è£¡å…ˆé‡å°èˆ‡å…ˆå è™›æ“¬æ©Ÿç›¸é—œçš„è­°é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture#memory_cpu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Allocatable Resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/regional-clusters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Regional Cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cluster autoscaler&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;allocatable-resource&#34;&gt;Allocatable Resource&lt;/h3&gt;
&lt;p&gt;åœ¨ç¶²è·¯ä¸Šçœ‹åˆ°é€™ç¯‡å¥½æ–‡ &lt;a href=&#34;https://learnk8s.io/allocatable-resources&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GKE ä¸Šçš„å¯ä½¿ç”¨çš„è³‡æº Allocatable Resource&lt;/a&gt;ã€‚å•¥æ„æ€å‘¢ï¼Ÿé›£é“é‚„æœ‰ä¸èƒ½ä½¿ç”¨çš„è³‡æºå—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ²’éŒ¯ï¼ŒGKE æœƒä¿ç•™ä¸€å®šçš„æ©Ÿå™¨è³‡æº (e.g. cpu, memory, disk)ï¼Œä¾†ç¶­æŒç¯€é»çš„ç®¡ç†å…ƒä»¶ï¼Œä¾‹å¦‚ container runtime (e.g. Docker)ã€kubeletã€cAdvisorã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯èªªï¼Œå°±ç®—æˆ‘å€‘è·Ÿ GCP è³¼è²·äº†ç®—åŠ›ï¼Œæœ‰ä¸€å€‹æ¯”ä¾‹çš„è³‡æºæˆ‘å€‘æ˜¯ä½¿ç”¨ä¸åˆ°çš„ã€‚ç´°ç¯€è«‹è¦‹ &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture#memory_cpu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ GKE é›†ç¾¤æ¶æ§‹&lt;/a&gt;ã€‚é€™æœƒå½±éŸ¿æˆ‘å€‘å–®ä¸€ç¯€é»çš„è¦æ ¼ï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦ä¸€ä¸¦è¨ˆç®—ï¼Œèƒ½å¯¦éš›ä½¿ç”¨çš„è³‡æº (allocatable resource)ã€‚&lt;/p&gt;
&lt;p&gt;Allocatable = Capacity - Reserved - Eviction Threshold&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Capacityï¼Œæ˜¯æ©Ÿå™¨ä¸Šå¯¦éš›è£è¼‰çš„è³‡æºï¼Œä¾‹å¦‚ n1-standard-4 æä¾› 4 cpu 15 Gb memory&lt;/li&gt;
&lt;li&gt;Reservedï¼Œå…¬æœ‰é›²ä»£ç®¡é›†ç¾¤ï¼Œé ä¿ç•™çš„è³‡æº&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/#eviction-thresholds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Eviction Threshold&lt;/a&gt;ï¼šKubernetes è¨­å®šçš„ kubelet é©…é€é–€æª»&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é©…é€é–€æª»-eviction-threshold&#34;&gt;é©…é€é–€æª» (Eviction threshold)&lt;/h3&gt;
&lt;p&gt;Kubelet æœƒä¸»å‹•ç›£æ¸¬ç¯€é»ä¸Šçš„è³‡æºä½¿ç”¨ç‹€æ³ï¼Œç•¶ç¯€é»ç™¼ç”Ÿè³‡æºä¸è¶³çš„ç‹€æ³æ™‚ï¼Œkubelet æœƒä¸»å‹•çµ‚æ­¢æŸäº› Pod çš„é‹è¡Œï¼Œä¸¦å›æ”¶ç¯€é»çš„è³‡æºï¼Œä¾†é¿å…æ•´å€‹ç¯€é»è³‡æºä¸è¶³å°è‡´çš„ç³»çµ±ä¸ç©©å®šã€‚è¢«çµ‚æ­¢çš„ Pod å¯ä»¥å†æ¬¡æ’ç¨‹åˆ°å…¶ä»–è³‡æºè¶³å¤ çš„ç¯€é»ä¸Šã€‚ç´°ç¯€è«‹è¦‹ &lt;a href=&#34;https://kubernetes.io/docs/concepts/scheduling-eviction/eviction-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶ Scheduling and Eviction&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸Šï¼Œæˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥è¨­å®šé©…é€é–€æª»ï¼Œç•¶ç¯€é»çš„å¯ç”¨è³‡æºä½æ–¼é©…é€çš„é–€æª»ï¼Œkubelet æœƒè§¸ç™¼ Pod é©…é€æ©Ÿåˆ¶&lt;/p&gt;
&lt;p&gt;GKE ä¸Šæ¯å€‹ç¯€é»æœƒé¡å¤–ä¿ç•™ 100 MiB çš„è¨˜æ†¶é«”ï¼Œä½œç‚ºé©…é€é–€æª»ï¼Œæ„æ€æ˜¯ç•¶ç¯€é»è€—ç›¡è³‡æºï¼Œå°è‡´å‰©é¤˜è¨˜æ†¶é«”ä½æ–¼ 100 MiB çš„æ™‚å€™ï¼Œæœƒç›´æ¥è§¸ç™¼ GKE çš„ Pod Evictionï¼Œçµ‚æ­¢ä¸¦å›æ”¶éƒ¨åˆ†çš„ Podã€‚æ›å¥è©±èªªï¼Œé€™ 100 MiB æ˜¯ä¸èƒ½è¢«ä½¿ç”¨çš„è³‡æºã€‚ç´°ç¯€è«‹è¦‹&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture#eviction_threshold&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;é›†ç¾¤ä¿ç•™è³‡æºç²¾ç®—&#34;&gt;é›†ç¾¤ä¿ç•™è³‡æºç²¾ç®—&lt;/h3&gt;
&lt;p&gt;è³‡æºçš„å®šç¾©ï¼Œä½¿ç”¨é›²å¹³å°çš„ä¸€èˆ¬è²»ç”¨å¤§å¤šä¾†è‡ªæ­¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cpu&lt;/li&gt;
&lt;li&gt;memory&lt;/li&gt;
&lt;li&gt;storage&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶å¾Œæ˜¯é€™å€‹è¡¨ï¼Œæ³¨æ„ä¿ç•™çš„è³‡æºæ˜¯ç´¯é€²ç´šè·&lt;/p&gt;
&lt;p&gt;255 MiB of memory for machines with less than 1 GB of memory
25% of the first 4GB of memory
20% of the next 4GB of memory (up to 8GB)
10% of the next 8GB of memory (up to 16GB)
6% of the next 112GB of memory (up to 128GB)
2% of any memory above 128GB&lt;/p&gt;
&lt;p&gt;å€¼è¨ˆä¸Šèƒ½å¤ ç”¨åˆ°çš„è³‡æºï¼Œåº•ä¸‹ GCP ä¹Ÿæ•´ç†å¥½äº†ï¼Œä¾‹å¦‚ n1-standard-4 å¯¦éš›ä½¿ç”¨çš„æ˜¯ memory 12.3/15ï¼Œcpu 3.92/4ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¶­æŒåˆç†çš„ä½¿ç”¨ç‡ä¸‹ï¼Œé–‹å•Ÿå¤§çš„æ©Ÿå™¨ï¼Œå¯ä»¥é™ä½è¢«ä¿ç•™çš„è³‡æºæ¯”ä¾‹ï¼Œä¾ç…§ç­†è€…å…¬å¸éå»ç¶“é©—ï¼ŒGKE èµ·è·³å°±æ˜¯ n1-standard-4 æˆ–æ˜¯ä»¥ä¸Šè¦æ ¼ï¼Œå¦‚æœä½æ–¼é€™å€‹è¦æ ¼ï¼Œå¯èª¿åº¦çš„è³‡æºæ¯”ä¾‹çœŸçš„å¤ªä½ï¼Œæ‡‰è©²é‡æ–°è€ƒæ…®ä¸€ä¸‹é€™å€‹è§£æ±ºæ–¹æ¡ˆæ˜¯å¦åˆä¹æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç©¶ç«Ÿä»€éº¼è¦æ ¼çš„æ©Ÿå™¨é©åˆæˆ‘å€‘çš„éœ€æ±‚ï¼Œèªªå¯¦åœ¨å®Œå…¨è¦çœ‹åŸ·è¡Œçš„æ‡‰ç”¨è€Œå®šã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance Introduction</title>
      <link>https://chechia.net/zh-hant/post/2020-09-26-gcp-preemptible-instance-introduction/</link>
      <pubDate>Sat, 26 Sep 2020 11:03:40 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-26-gcp-preemptible-instance-introduction/</guid>
      <description>&lt;h1 id=&#34;å…ˆå è™›æ“¬æ©ŸæŠ€è¡“æ–‡ä»¶äºŒä¸‰äº‹&#34;&gt;å…ˆå è™›æ“¬æ©Ÿï¼ŒæŠ€è¡“æ–‡ä»¶äºŒä¸‰äº‹&lt;/h1&gt;
&lt;p&gt;ç¬¬ä¸€ç¯‡çš„å…§å®¹å¤§éƒ¨ä»½é‚„æ˜¯ç¿»è­¯è·Ÿè¬›è§£å®˜æ–¹æ–‡ä»¶ã€‚å¾Œé¢å¹¾ç¯‡æ‰æœƒæœ‰å¯¦éš›çš„éœ€æ±‚èˆ‡è§£æ±ºæ–¹æ¡ˆåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/preemptible&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google å…ˆå è™›æ“¬æ©Ÿå®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸ç†Ÿæ‚‰çš„ç”¢å“å‰ä¸€å®šè¦å¥½å¥½çœ‹æ–‡ä»¶ï¼Œæ‰ä¸æœƒè¸©åˆ°é›·çš„æ™‚å€™ï¼Œç™¼ç¾äººå®¶å°±æ˜¯é€™æ¨£è¨­è¨ˆçš„ï¼Œè€Œä¸”æ–‡ä»¶ä¸Šå¯«å¾—æ¸…æ¸…æ¥šæ¥šã€‚ä»¥ç‚ºæ˜¯ bug çµæœçœŸçš„æ˜¯ featureï¼Œé›·åˆ°è‡ªå·±ã€‚å…ˆå è™›æ“¬æ©Ÿæ˜¯ç”¨èµ·ä¾†è·Ÿæ™®é€šè™›æ“¬æ©Ÿæ²’ä»€éº¼å…©æ¨£ï¼Œä½†å¯¦éš›ä¸Šè¶…ç´šå¤šç´°ç¯€è¦æ³¨æ„ï¼Œæ¯›å¾ˆå¤šçš„ç”¢å“ï¼Œè«‹å‹™å¿…è¦å°å¿ƒä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ–‡ç« æ˜¯ç­†è€…å·¥ä½œç¶“é©—ï¼Œè¦ºå¾—å¥½ç”¨ã€ç¢ºå¯¦æœ‰å¹«åŠ©å…¬å¸ï¼Œä¾†è·Ÿå¤§å®¶åˆ†äº«ã€‚ç¤™æ–¼ç¯‡å¹…ï¼Œé€™è£¡åªèƒ½éå¸¸ç²—ç•¥åœ°æè¿°æˆ‘å€‘åœ˜éšŠæ€è€ƒéçš„å•é¡Œï¼Œå¯¦éš›ä¸Šçš„å•é¡Œæœƒè¤‡é›œéå¸¸å¤šã€‚æ–‡ç« åªæ˜¯ä½œå€‹ç™¼æƒ³ï¼Œä¸¦ä¸è¶³ä»¥æ”¯æ’å¯¦éš›çš„æ¥­å‹™ï¼Œæ‰€ä»¥å¦‚æœè¦è€ƒæ…®å°å…¥ï¼Œé‚„æ˜¯è¦&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šä½œåŠŸèª²ï¼Œä»”ç´°æŸ¥é–±å®˜æ–¹æ–‡ä»¶ï¼Œç†è§£æœå‹™çš„è¦æ ¼&lt;/li&gt;
&lt;li&gt;æ·±å…¥åˆ†æè‡ªèº«çš„éœ€æ±‚&lt;/li&gt;
&lt;li&gt;åŸºæ–¼ä¸Šé¢å…©è€…ï¼Œé‡åŒ–åˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;ä»€éº¼æ˜¯å…ˆå è™›æ“¬æ©Ÿå™¨preemptible-instance&#34;&gt;ä»€éº¼æ˜¯å…ˆå è™›æ“¬æ©Ÿå™¨(Preemptible Instance)&lt;/h1&gt;
&lt;p&gt;å…ˆå è™›æ“¬æ©Ÿå™¨ï¼Œæ˜¯è³‡æ–™ä¸­å¿ƒçš„å¤šé¤˜ç®—åŠ›ï¼Œè®€è€…å¯ä»¥æƒ³åƒæ˜¯ç›®å‰è³£å‰©çš„æ©Ÿå™¨ï¼Œæœƒä¾æ“šè³‡æ–™ä¸­å¿ƒçš„éœ€æ±‚å‹•æ…‹èª¿æ•´ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®å‰è³‡æ–™ä¸­å¿ƒçš„ç®—åŠ›éœ€æ±‚ä½ï¼Œå¯ä½¿ç”¨çš„å…ˆå è™›æ“¬æ©Ÿé‡‹å‡ºé‡å¤šï¼Œå¯èƒ½å¯ä»¥ç”¨æ›´ä¾¿å®œçš„åƒ¹æ ¼ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ç›®å‰è³‡æ–™ä¸­å¿ƒç®—åŠ›éœ€æ±‚é«˜ï¼Œè³‡æ–™ä¸­å¿ƒæœƒæ”¶å›éƒ¨åˆ†å…ˆå è™›æ“¬æ©Ÿçš„é¡åº¦ï¼Œè½‰åŒ–æˆéš¨é¸ä»˜è²»çš„è™›æ“¬æ©Ÿ (pay-as-you-go)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼å…ˆå è™›æ“¬æ©Ÿæœƒä¸å®šæ™‚ï¼ˆä½†å¯é æœŸï¼‰åœ°è¢«è³‡æ–™ä¸­å¿ƒæ”¶å›ï¼Œå› æ­¤ä¸Šé ­åŸ·è¡Œçš„æ‡‰ç”¨ï¼Œéœ€è¦å¯ä»¥æ‰¿å—æ©Ÿå™¨çš„çµ‚æ­¢ï¼Œé©åˆæœ‰å®¹éŒ¯æ©Ÿåˆ¶ (fault-tolerant) çš„æ‡‰ç”¨ï¼Œæˆ–æ˜¯æ‰¹æ¬¡åŸ·è¡Œçš„å·¥ä½œä¹Ÿå¾ˆé©åˆã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…ˆå æ©Ÿå™¨çš„å„ªç¼ºé»&#34;&gt;å…ˆå æ©Ÿå™¨çš„å„ªç¼ºé»&lt;/h1&gt;
&lt;p&gt;é™¤äº†æœ‰ä¸€èˆ¬éš¨é¸è™›æ“¬æ©Ÿçš„ç‰¹æ€§ï¼Œå…ˆå è™›æ“¬æ©Ÿé‚„æœ‰ä»¥ä¸‹ç‰¹é»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”ä¸€èˆ¬çš„è™›æ“¬æ©Ÿå™¨ä¾¿å®œéå¸¸å¤šï¼Œé€™ä¹Ÿæ˜¯æˆ‘å€‘é¸ç”¨å…ˆå è™›æ“¬æ©Ÿå„ªæ–¼ä¸€èˆ¬è™›æ“¬æ©Ÿçš„å”¯ä¸€ç†ç”±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…ˆå è™›æ“¬æ©Ÿæœ‰ä»¥ä¸‹é™åˆ¶ï¼Œä»¥ç¶­é‹çš„è§’åº¦ï¼Œé€™äº›éƒ½æ˜¯éœ€è¦è€ƒé‡çš„é»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCP ä¸ä¿è­‰æœƒæœ‰è¶³å¤ çš„å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿä¸èƒ½ç›´æ¥è½‰æ›æˆæ™®é€šè™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;è³‡æ–™ä¸­å¿ƒè§¸ç™¼ç¶­è­·äº‹ä»¶æ™‚(ex. å›æ”¶å…ˆå è™›æ“¬æ©Ÿ)ï¼Œå…ˆå è™›æ“¬æ©Ÿä¸èƒ½è¨­å®šè‡ªå‹•é‡å•Ÿï¼Œè€Œæ˜¯æœƒç›´æ¥é—œé–‰&lt;/li&gt;
&lt;li&gt;å…ˆå æ©Ÿå™¨æ’é™¤åœ¨ &lt;a href=&#34;https://cloud.google.com/compute/sla&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP çš„æœå‹™ç­‰ç´šå”è­° (SLA)&lt;/a&gt;ä¹‹å¤–&lt;/li&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿä¸é©ç”¨&lt;a href=&#34;https://cloud.google.com/free&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP å…è²»é¡åº¦&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è²»ç”¨ç²—ä¼°è©¦ç®—&#34;&gt;è²»ç”¨ç²—ä¼°è©¦ç®—&lt;/h1&gt;
&lt;p&gt;è‡³æ–¼ä¾¿å®œæ˜¯å¤šä¾¿å®œå‘¢ï¼Ÿé€™é‚Šå…ˆé–‹å¹¾å€‹ä¾‹å­çµ¦å„ä½ä¸€äº›æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å¸¸ç”¨çš„ N1 standard è™›æ“¬æ©Ÿï¼šhttps://cloud.google.com/compute/vm-instance-pricing#n1_standard_machine_types&lt;/p&gt;
&lt;p&gt;Hourly
Machine type	CPUs	Memory	Price (USD)	Preemptible price (USD)
n1-standard-1	1	3.75GB	$0.0550		$0.0110
n1-standard-2	2	7.5GB	$0.1100		$0.0220
n1-standard-4	4	15GB	$0.2200		$0.0440
n1-standard-8	8	30GB	$0.4400		$0.0880
n1-standard-16	16	60GB	$0.8800		$0.1760
n1-standard-32	32	120GB	$1.7600		$0.3520
n1-standard-64	64	240GB	$3.5200		$0.7040&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ç”¨ GPU é‹ç®—ï¼šhttps://cloud.google.com/compute/gpus-pricing&lt;/p&gt;
&lt;p&gt;Model			GPUs	GPU memory	GPU price (USD)	Preemptible GPU price (USD)
NVIDIAÂ® TeslaÂ® T4	1 GPU	16 GB GDDR6	$0.35 per GPU	$0.11 per GPU
NVIDIAÂ® TeslaÂ® V100	1 GPU	16 GB HBM2	$2.48 per GPU	$0.74 per GPU&lt;/p&gt;
&lt;p&gt;ä¾æ“šè™›æ“¬æ©Ÿè¦æ ¼çš„ä¸åŒï¼Œå…ˆå è™›æ“¬æ©Ÿå¤§ç´„æ˜¯éš¨é¸è™›æ“¬æ©Ÿåƒ¹æ ¼çš„ 2 åˆ° 3 æŠ˜ã€‚åœ¨ AWS èˆ‡ Azureï¼Œç”±æ–¼è¨ˆè²»æ–¹å¼ä¸åŒï¼Œæœ‰å¯èƒ½æ‹¿åˆ° 1 æŠ˜å·¦å³çš„æµ®å‹•åƒ¹æ ¼ã€‚å¾å„ç¨®è§’åº¦ä¾†èªªï¼Œéƒ½æ˜¯éå¸¸é«˜çš„æŠ˜æ•¸ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å¦¨èªªï¼Œé€™æ•´ç³»åˆ—æ–‡ç« ï¼Œéƒ½æ˜¯è¡é€™è‘—å€‹æŠ˜æ•¸ä¾†çš„ XDã€‚ç•¢ç«Ÿæˆæœ¬æ˜¯å¯¦å¯¦åœ¨åœ¨çš„èŠ±è²»ï¼Œå·¥ä½œè² è¼‰ (workload) åˆé©çš„è©±ï¼Œæ‡‰è©²ç›¡é‡å˜—è©¦å°å…¥ã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹æŠ˜æ•¸é‚„æœ‰å¦å¤–ä¸€å€‹æ•ˆæœæ˜¯ï¼Œå¯ä»¥åœ¨ç›¸åŒæˆæœ¬ä¸‹ï¼Œæ·»å¢æ›´å¤šè³‡æºç®—åŠ›ï¼Œä½œç‚ºè§£æ±ºæ–¹æ¡ˆã€‚ä»€éº¼æ„æ€å‘¢ï¼Ÿå°±æ˜¯å¦‚æœå·¥ä½œè² è¼‰åˆé©çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨æ›´é«˜è¦æ ¼çš„å…ˆå ç¯€é»ï¼Œæ•´é«”æˆæœ¬åè€Œæœƒä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ–¼ç©¶ç«Ÿå·®å¤šå°‘ï¼Œéœ€è¦ä¾æ“šè¦æ ¼èˆ‡å®šåƒ¹è©³ç´°è©¦ç®—æ‰çŸ¥é“ã€‚åº•ä¸‹æˆ‘å€‘å°±ä¾†ç®—ç®—çœ‹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance Resource Calculation</title>
      <link>https://chechia.net/zh-hant/post/2020-09-25-gcp-preemptible-instance-resource-calculation/</link>
      <pubDate>Fri, 25 Sep 2020 12:22:02 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-25-gcp-preemptible-instance-resource-calculation/</guid>
      <description>&lt;h3 id=&#34;é—œæ–¼è³‡æºè©•ä¼°&#34;&gt;é—œæ–¼è³‡æºè©•ä¼°&lt;/h3&gt;
&lt;p&gt;æ¶æ§‹åœ˜éšŠæä¾›è™›æ“¬æ©Ÿçµ¦æ‡‰ç”¨ï¼Œæœ‰å€‹å•é¡Œæ™‚å¸¸å‡ºç¾ï¼šæ‡‰è©²åˆ†é…å¤šå°‘è³‡æºçµ¦æ‡‰ç”¨ï¼Ÿä¾‹å¦‚ï¼šå¾Œç«¯æº–å‚™ä¸€å€‹ API serverï¼ŒSRE é€™é‚Šè¦æº–å‚™å¤šå°‘ä»€éº¼è¦æ ¼çš„æ©Ÿå™¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»¥å¾€ä½¿ç”¨è™›æ“¬æ©Ÿç›´æ¥éƒ¨ç½²æ‡‰ç”¨æ™‚ï¼Œæœƒéœ€è¦æ˜ç¢ºè¦åŠƒå„ç¾¤è™›æ“¬æ©Ÿï¼Œå„è‡ªéœ€è¦åŸ·è¡Œçš„æ‡‰ç”¨ï¼Œå¦‚æœæ²’æœ‰åšè³‡æºçš„äº‹å‰è©•ä¼°ï¼Œæœ‰å¯èƒ½æ”¾ä¸Šæ©Ÿå™¨é‹è¡Œå¾Œå°±ç™¼ç”Ÿè³‡æºä¸è¶³ã€‚&lt;/p&gt;
&lt;p&gt;å°å…¥ Kubernetes å¾Œï¼Œé€éç¯€é»æ±  (Node Pool) å½¢æˆä¸€å€‹å¤§å‹è³‡æºæ± ï¼Œè¨­å®šéƒ¨ç½²çš„æ”¿ç­–å¾Œï¼Œè®“ Kubernetes è‡ªå‹•èª¿åº¦æ‡‰ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸€å€‹ç¯€é»çš„è³‡æºå¤ å¤§ï¼Œä½¿å¾—æ‡‰ç”¨è™›æ“¬æ©Ÿå™¨ä¸Šæ‰€ä½”çš„æ¯”ä¾‹ç›¸å°è¼ƒå°ï¼Œä¹Ÿå°±æ˜¯å–®ä¸€æ‡‰ç”¨çš„èª¿åº¦ä¸æœƒå½±éŸ¿ç¯€é»çš„æ•´é«”è² è¼‰
&lt;ul&gt;
&lt;li&gt;å¦‚æœç¯€é»å¤ªå°ï¼Œèª¿åº¦æ‡‰ç”¨å°±æœƒæœ‰äº›ä¾·ä¿ƒï¼Œä¾‹å¦‚ï¼šä¸€å€‹ API server å‡è¼‰æ™‚æ¶ˆè€— 1 cpu æ»¿è¼‰æ™‚æ¶ˆè€— 2 cpuã€‚æº–å‚™ 3 cpu çš„è™›æ“¬æ©Ÿï¼Œèª¿åº¦æ‡‰ç”¨æ™‚å¹¾ä¹æ˜¯é·ç§»æ•´å°è™›æ“¬æ©Ÿçš„è² è¼‰&lt;/li&gt;
&lt;li&gt;æ­¤å¤–é‚„æœ‰æ©Ÿæœƒå› ç‚º&lt;a href=&#34;&#34;&gt;ä¸Šç¯‡&lt;/a&gt;æåˆ°çš„è³‡æºä¿ç•™ï¼Œé€ æˆèª¿åº¦å¤±æ•—ã€‚å¦‚æœæº–å‚™ 24 cpu çš„æ©Ÿå™¨ï¼Œèª¿åº¦èµ·ä¾†å½ˆæ€§å°±å¾ˆå¤§ï¼Œå°ç¯€é»çš„æ€§èƒ½è¡æ“Šä¹Ÿæ¯”è¼ƒä½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åªéœ€è¦ä¼°è¨ˆæ•´é«”çš„è³‡æºæ¶ˆè€—ç‡è¨ˆç®—éœ€æ±‚ï¼Œé…åˆè‡ªå‹•æ“´å±•ï¼Œå‹•æ…‹å™¨è£œè¶³ä¸è¶³çš„è³‡æº
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šä¼°è¨ˆç¸½å…±éœ€è¦ 32 cpu ï¼Œæº–å‚™ 36 cpu çš„è™›æ“¬æ©Ÿï¼Œç•¶æ»¿è¼‰æ™‚ä¾æ“š cpu å£“åŠ›è‡ªå‹•æ“´å®¹åˆ° 48 cpu&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¸Œæœ›æ•´é«”è³‡æºçš„ä½¿ç”¨ç‡å¤ é«˜ï¼Œç•¶ç„¶é ç•™å¤ªå¤šçš„è³‡æºæœƒé€ æˆæµªè²»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦æ§ç®¡ Kubernetes çš„è³‡æºä½¿ç”¨é‡ä¹Ÿå¯è¨­å®š&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è³‡æºéœ€æ±‚èˆ‡è³‡æºé™åˆ¶&lt;/a&gt;ï¼Œå»¶ä¼¸é–±è®€ã€‚&lt;/p&gt;
&lt;p&gt;ä¼°è¨ˆå¾—è¶Šæº–ç¢ºï¼Œç•¶ç„¶å¯¦éš›éƒ¨ç½²çš„è³‡æºæŒæ¡åº¦å°±è¶Šé«˜ï¼Œç„¶è€Œç­†è€…éå»çš„ç¶“é©—ï¼Œåœ˜éšŠåœ¨äº¤ä»˜æºç¢¼æ™‚æœªå¿…å°±èƒ½å¤ åšå‡ºæœ‰æ•ˆçš„è³‡æºæ¶ˆè€—è©•ä¼°ï¼Œé‚£æœ‰æ²’æœ‰ä»€éº¼è¾¦æ³•å¯ä»¥å¹«åŠ©æˆ‘å€‘ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;è³‡æºéœ€æ±‚ä¼°ä¼°çœ‹&#34;&gt;è³‡æºéœ€æ±‚ä¼°ä¼°çœ‹&lt;/h3&gt;
&lt;p&gt;å¦‚æœæ‡‰ç”¨é–‹ç™¼åœ˜éšŠï¼Œæœ‰å…ˆä½œæ‡‰ç”¨çš„ profilingï¼Œç„¶å¾Œ release candidate ç‰ˆæœ¬æœ‰åœ¨ staging ä¸Šä½œå£“åŠ›æ¸¬è©¦çš„è©±ï¼Œç¶­é‹åœ˜éšŠé€™é‚Šæ‡‰è©²å°±å–å¾—çš„æ•¸æ“šï¼Œåšéƒ¨ç½²å‰çš„è³‡æºè©•ä¼°ã€‚&lt;/p&gt;
&lt;p&gt;æ‡‰ç”¨åœ¨ä¸åŒç‹€æ…‹æˆ–æ˜¯å·¥ä½œéšæ®µï¼Œæœƒæ¶ˆè€—ä¸åŒçš„è³‡æº&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šé‹ç®—å¯†é›†çš„ batch job å¯èƒ½æœƒæœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ§åˆ¶ç¯€é» (master node) å•Ÿå‹•å¾Œæœƒä½”æœ‰ä¸€å®šçš„è³‡æºï¼Œä¸€èˆ¬ä¾†èªªä¸æœƒæ¶ˆè€—å¤ªå¤šï¼Œåªæ˜¯éœ€è¦ç‚ºæ§åˆ¶ç¯€é»å„ªå…ˆä¿ç•™è³‡æº&lt;/li&gt;
&lt;li&gt;å·¥ä½œç¯€é» (worker node) å•Ÿå‹•æ™‚æœƒéœ€è¦é ç•™è¶³å¤ çš„è³‡æºï¼Œæ¥æ”¶å·¥ä½œå¾Œæœƒé€æ¼¸å¢åŠ è³‡æºä½¿ç”¨ï¼Œæ‹‰åˆ°æ»¿è¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šé¢å‘ç”¨æˆ¶çš„æœå‹™ï¼Œå¯èƒ½æœƒæœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•Ÿå‹•æ‡‰ç”¨æ‰€éœ€çš„è³‡æº&lt;/li&gt;
&lt;li&gt;æ²’æœ‰å¤§é‡è«‹æ±‚ï¼Œåªç¶­æŒåŸºæœ¬æ‡‰ç”¨é‹è¡Œæ‰€ä½¿ç”¨çš„è³‡æº&lt;/li&gt;
&lt;li&gt;è² è¼‰å£“åŠ›çŒé€²ä¾†æ™‚ï¼Œæ¶ˆè€—è³‡æºéš¨ç”¨æˆ¶è«‹æ±‚æ•¸é‡çš„æˆé•·æ›²ç·šï¼Œè¨­å®šçš„å®‰å…¨ä¸Šç•Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰é€™äº›æ•¸æ“šï¼Œå…¶å¯¦ç¶­é‹å¾ˆé›£äº‹å‰ä¼°è¨ˆè³‡æºï¼Œè®Šæˆè¦å¯¦éš›æ¨ä¸Šç·šå¾Œè¦‹æ‹›æ‹†æ‹›ï¼ŒåŸºæ–¼å¯¦éš›çš„è³‡æºæ¶ˆè€—å»åšè‡ªå‹•æ“´å®¹ï¼Œå…¶å¯¦æœ‰å¯èƒ½æœƒé€ æˆè³‡æºçš„æµªè²»ï¼Œå› æ­¤æˆ‘å»ºè­°å¦‚æœé–‹ç™¼åœ˜éšŠæ²’æœ‰ä½œ profilingï¼Œç¶­é‹åœ˜éšŠå¯ä»¥åœ¨å·¥ä½œæµç¨‹å…§ç°¡å–®åŠ ä¸€æ­¥ profilingï¼Œç›®å‰ä¸»æµèªè¨€éƒ½æœ‰æä¾›ç›¸é—œå·¥å…·ï¼Œç°¡å–®çš„åŸ·è¡Œå°±å¯ä»¥ç²å¾—å¾ˆå¤šè³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ–¼å£“åŠ›æ¸¬è©¦ï¼Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨åŸºæœ¬çš„å·¥å…·(ä¾‹å¦‚ &lt;a href=&#34;https://artillery.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Artilery&lt;/a&gt;)ç°¡å–®æ•´åˆ°å·¥ä½œæµç¨‹ã€‚ç‰¹åˆ¥æ˜¯é¢å°å®¢æˆ¶çš„æ‡‰ç”¨ï¼Œå‹™å¿…è¦é€²è¡Œå£“åŠ›æ¸¬è©¦ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†ä¸Šè¿°çš„è³‡æºéœ€æ±‚æ•¸æ“šï¼Œæ‰èƒ½äº‹å…ˆå®‰æ’æ©Ÿå™¨çš„è¦æ ¼ã€‚ä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‡‰ç”¨æ˜¯é¢å°å®¢æˆ¶çš„ API server&lt;/li&gt;
&lt;li&gt;åŸºæœ¬è³‡æºæ˜¯ 200m cpu 1Gi memoryï¼Œé€™éƒ¨åˆ†ç›´æ¥å¯«é€² Kubernetes resource requestï¼Œåœ¨æ’ç¨‹æ™‚å°±å…ˆçµé»ä¸Šé ç•™ã€‚&lt;/li&gt;
&lt;li&gt;è² è¼‰æ‹‰åˆ° 1,000 RPSï¼Œlatency 95% 20ms  99% 30msï¼Œé€™æ™‚çš„è³‡æºéœ€æ±‚çš„ä¸Šç•Œå¤§ç´„ 2 cpu 4 Gi memory&lt;/li&gt;
&lt;li&gt;è¶…é 1,000 RPS å°±æ‡‰è©²è¦é€éæ°´å¹³æ“´å±•å»å¢åŠ æ›´å¤š instamce&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå–®è·‘é€™å€‹ API serverï¼Œå°±å¯ä»¥å®‰æ’ memory 8ï¼Œcpu 4 çš„ GKE node-poolï¼Œè®“è² è¼‰è½åœ¨å¯ç”¨è³‡æºçš„ 60%-70%ï¼Œé€™æ¨£é‚„æœ‰é¤˜è£•å¯ä»¥æ‰¿å—å¤§æµé‡ï¼Œçµ¦è‡ªå‹•æ°´å¹³æ“´å±•åšå‹•çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è³‡æºèª¿æ•´åƒè€ƒ&#34;&gt;è³‡æºèª¿æ•´åƒè€ƒ&lt;/h3&gt;
&lt;p&gt;ç•¶ç„¶é€™äº›æ•¸æ“šéƒ½å¯ä»¥ä¾ç…§æ™‚å¯¦éš›éœ€æ±‚èª¿æ•´ï¼Œè³‡æºè¦å£“ç¸®å¾—æ›´ç·Šæˆ–æ›´é¬†éƒ½æ˜¯å¯è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‡‰ç”¨æœ‰æ•´åˆåˆ†æå¾Œå°ï¼Œä¾‹å¦‚ Real-time Uer Monitoringã€æˆ–æ˜¯åŸºæœ¬çš„ Google Analyticsï¼Œéƒ½å¯ä»¥è§€å¯Ÿé€™äº›èª¿æ•´å¯¦éš›å°ç”¨æˆ¶å¸¶ä¾†çš„å½±éŸ¿ï¼Œç”¨æˆ¶è¡Œç‚ºæ”¹è®Šå°å…¬å¸ç‡Ÿæ”¶çš„å½±éŸ¿ï¼Œå…¨éƒ½å¯ä»¥é‡åŒ–ã€‚ä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ©Ÿå™¨è² è¼‰æ‹‰åˆ° 80%ï¼Œcpu çš„å£“åŠ›ï¼Œå°è‡´ API latency å¢åŠ åˆ° 95% 50ms 99% 100ms&lt;/li&gt;
&lt;li&gt;æ­¤æ™‚ç”¨æˆ¶å·²ç¶“å¾ˆæœ‰æ„Ÿäº†ï¼Œæœƒå°è‡´ 0.1% ç”¨æˆ¶è·³è½‰é›¢é–‹&lt;/li&gt;
&lt;li&gt;è€Œé€™ 0.1% çš„ç”¨æˆ¶ï¼Œä»¥å¾€çš„å¹³å‡æ¶ˆè²»ï¼Œæ›ç®—æˆç‚ºå…¬å¸ç‡Ÿæ”¶ï¼Œæ˜¯ $1,000/month&lt;/li&gt;
&lt;li&gt;æŠŠæ©Ÿå™¨è² è¼‰å£“åˆ° 60%ï¼Œåªè¨ˆç®— cpu çš„æ•¸é‡çš„è©±ï¼Œéœ€è¦å¤šé–‹ 3 å° n1-standard-4 æ©Ÿå™¨ï¼Œå…±è¨ˆ $337.26/month&lt;/li&gt;
&lt;li&gt;æä¾›è€é—†åšåƒè€ƒï¼Œè€é—†å¯èƒ½æœƒè¶¨å‘åŠ é–‹æ©Ÿå™¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç•¶ç„¶ä¸Šé¢çš„ä¾‹å­éƒ½éå¸¸ç°¡åŒ–ï¼Œè®Šæˆåœ‹ä¸­æ•¸å­¸å•é¡Œï¼Œé€™é‚Šåªæ˜¯æä¾›ä¸€å€‹ä¼°ç®—çš„ä¾‹å­ã€‚ç¾å¯¦ä¸­çš„å•é¡Œéƒ½æœƒè¤‡é›œç™¾å€ï¼Œä¾‹å¦‚æ©Ÿå™¨è¦æ ¼æ‹‰ä¸Šå»å‡ºç¾æ–°çš„ç“¶é ¸ã€ä¾‹å¦‚ä¾è³´çš„æœå‹™ï¼Œmessage queueã€database å£“åŠ›ä¸Šå‡ï¼Œæˆ–æ˜¯å…¬å¸å…§éƒ¨å•é¡Œï¼Œå°±æ‹¿ä¸åˆ°é ç®—(è¡€æ·š SRE)ã€‚å¦‚æœè¦æ¸›å°‘æ©Ÿå™¨ï¼Œä¹Ÿå¯ä»¥åƒè€ƒï¼Œä¸€èˆ¬ä¾†èªªè½åˆ°é—œæ©Ÿå™¨çœéŒ¢çš„è©±ï¼Œè€é—†éƒ½æœƒæ¥å—çš„ XDã€‚&lt;/p&gt;
&lt;h3 id=&#34;å›åˆ°å…ˆå æ©Ÿå™¨&#34;&gt;å›åˆ°å…ˆå æ©Ÿå™¨&lt;/h3&gt;
&lt;p&gt;æ ¹æ“šä¸Šé¢çš„åœ‹ä¸­æ•¸å­¸ï¼ŒæŠŠæ‡‰ç”¨ä¸€å€‹ä¸€å€‹éƒ½è¨ˆç®—æ¸…æ¥šï¼Œéœ€æ±‚é€æ¼¸æ˜ç¢ºäº†ã€‚å‡è¨­ï¼Œæ¶æ§‹åœ˜éšŠæ‹¿åˆ°é–‹æ©Ÿå™¨çš„å·¥å–®ï¼ŒææŒ‡ä¸€ç®—ï¼Œæ±ºå®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 GKE cluster&lt;/li&gt;
&lt;li&gt;6 n1-standard-4&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›éƒ½æ˜¯éš¨é¸è™›æ“¬æ©Ÿï¼Œåƒ¹æ ¼å¤§ç´„æ˜¯ $747/month (å«é›†ç¾¤ç®¡ç†è²» $73/month)ã€‚ä»Šå¤©æœ‰äººè…¦å‹•å¤§é–‹ï¼Œé‚£å¦‚æœå…¨éƒ¨æ›æˆå…ˆå ç¯€é»å‘¢ï¼Ÿè®Šæˆ $265/monthï¼Œè™›æ“¬æ©Ÿè²»ç”¨ $192 / $674 = 0.28 ç›´æ¥æ‰“è¶…éä¸‰æŠ˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äººå°±æ“”å¿ƒï¼Œé€™æ¨£çœŸçš„å¯ä»¥å—ï¼ŸçœŸçš„æ²’å•é¡Œå—ï¼Ÿæœƒä¸æœƒå½±éŸ¿ç”¨æˆ¶é˜¿ã€‚&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¯æœƒï¼Œå°±æ˜¯æœƒå½±éŸ¿ç”¨æˆ¶ XD&lt;/p&gt;
&lt;p&gt;è½åˆ°é€™é‚Šå¾ˆå¤šäººå°±æ€•äº†ã€‚ä½†æ˜¯æ€éº¼å€‹å½±éŸ¿æ³•å‘¢ï¼Œé‚„éœ€è¦çœ‹åº•ä¸‹å¹¾å€‹æ®µè½ï¼Œå¦‚æœæ›æˆå…ˆå è™›æ“¬æ©Ÿï¼Œç”¨æˆ¶æœƒæ€éº¼å—åˆ°å½±éŸ¿ã€‚æˆ‘å€‘ä¹Ÿè¦è©¦åœ–é‡åŒ–é€™å€‹å½±éŸ¿ï¼Œç•¶ä½œè¦ä¸è¦å°å…¥çš„åˆ¤æ–·ä¾æ“šã€‚&lt;/p&gt;
&lt;p&gt;å¥å€‹åä¾‹ï¼Œã€Œæˆ‘è¦ºå¾—å¯ä»¥ã€ã€Œä½ è¦ºå¾—ä¸è¡Œã€ï¼Œæˆ–æ˜¯ã€ŒæŸæŸå…¬å¸çš„æŸæŸåœ˜éšŠå¯ä»¥å•Šã€ã€Œæˆ‘å€‘å…¬å¸ä¹Ÿä¾†åšå§ã€ï¼Œé€™äº›éƒ½æ˜¯å¾ˆç³Ÿç³•çš„ç†ç”±ã€‚é™¤äº†å°å…§éƒ¨æ¯«ç„¡èªªæœåŠ›ä¹‹å¤–ï¼Œä¹Ÿæ²’æœ‰è¾¦æ³•ä½œç‚ºå°å…¥æˆæ•ˆçš„æŒ‡æ¨™ï¼Œæœƒè®“åœ˜éšŠé™·å…¥ã€Œå°å…¥äº†ä¹Ÿä¸çŸ¥é“æœ‰æ¯”å°å…¥å‰å¥½ï¼Ÿã€æˆ–æ˜¯ã€Œå…·é«”å°å…¥å¾Œæˆæ•ˆé‡åŒ–ã€ï¼Œæœƒå½±éŸ¿åœ˜éšŠåšå‡ºçœŸæ­£æœ‰æ•ˆçš„åˆ¤æ–·ï¼Œæ‡‰æ¥µåŠ›é¿å…ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå•è¡Œä¸è¡Œä¹‹å‰ï¼Œå…¶å¯¦éœ€è¦çŸ¥é“åœ˜éšŠé¡˜æ„ç‚ºäº†ä¸‰æŠ˜æ©Ÿå™¨ï¼Œä»˜å‡ºå¤šå°‘æˆæœ¬ã€‚å¦‚æœåªæ˜¯æ¯æœˆçœå€‹å°å¹£ 15,000ï¼Œå·¥ç¨‹å¸«è–ªæ°´éƒ½è¶…éäº†ã€‚ä½†å¦‚æœæ‰‹ä¸‹æœ‰ä¸‰åå°æˆ–ä¸‰ç™¾å°ä»¥ä¸Šï¼Œä¹Ÿè¨±å°±éå¸¸å€¼å¾—æŠ•è³‡ã€‚æˆæœ¬ä¸æ˜¯çµ•å°çš„ï¼Œå¾ˆå¤šæ™‚å€™è¦èˆ‡å…¶ä»–æˆæœ¬ (e.g. é–‹ç™¼äººåŠ›æ™‚é–“æˆæœ¬) ä¸€èµ·è€ƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šéƒ½æ˜¯èªªæ˜å°å…¥çš„å‹•æ©Ÿï¼Œä»¥ä¸‹èªªæ˜å…ˆå è™›æ“¬æ©Ÿçš„å„ç¨®æ©Ÿåˆ¶ï¼Œä»¥åŠå°æ‡‰ç”¨çš„å¯¦éš›å½±éŸ¿ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance Requirement</title>
      <link>https://chechia.net/zh-hant/post/2020-09-24-gcp-preemptible-instance-requirement/</link>
      <pubDate>Thu, 24 Sep 2020 13:39:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-24-gcp-preemptible-instance-requirement/</guid>
      <description>&lt;h1 id=&#34;éœ€æ±‚è¦åŠƒ&#34;&gt;éœ€æ±‚è¦åŠƒ&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨å…ˆå ç¯€é»æ¯”èµ·ä½¿ç”¨ä¸€èˆ¬éš¨é¸è™›æ“¬æ©Ÿï¼Œæœƒå¤šå‡ºè¨±å¤šæŠ€è¡“å›°é›£éœ€è¦å…‹æœï¼Œåªæœ‰ç¯€çœä¸‹çš„æˆæœ¬å¤§æ–¼æ•´é«”æŠ€è¡“æˆæœ¬æ™‚ï¼Œæˆ‘å€‘æ‰æœƒé¸ç”¨å…ˆå ç¯€é»ã€‚å› æ­¤é€™é‚Šè¦é€²è¡Œæˆæœ¬ç²¾ç®—ï¼Œé‡æ–°èª¿æ•´çš„æ¶æ§‹ä¸‹ï¼Œå¯¦éš›åˆ°åº•èƒ½çœå¤šå°‘éŒ¢ã€‚å‹™å¿…ä½¿ç”¨ &lt;a href=&#34;https://cloud.google.com/products/calculator?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Cloud Pricing Calculator&lt;/a&gt; ç²¾ç®—æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œé›–ç„¶å…ˆå è™›æ“¬æ©Ÿæœƒæœ‰å¾ˆå¤šé¡å¤–çš„é™åˆ¶èˆ‡æŠ€è¡“å›°é›£ï¼Œä½†å¯¦å‹™ä¸Šé‚„æ˜¯è¦å°æ¯”å¯¦éš›çš„éœ€æ±‚ï¼Œæœ‰äº›é™åˆ¶èˆ‡éœ€æ±‚æ˜¯è¡çªçš„ï¼Œæœ‰äº›é™åˆ¶å‰‡å®Œå…¨ä¸æœƒå½±éŸ¿æˆ‘å€‘çš„éœ€æ±‚ã€‚å‰è€…ç•¶ç„¶æœƒå¸¶çµ¦æˆ‘å€‘è¼ƒé«˜çš„å°å…¥é›£åº¦ï¼Œå¾Œè€…å¯èƒ½æœƒéå¸¸è¼•é¬†ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šæƒ³çµ¦å¤§å®¶çš„æ¦‚å¿µæ˜¯ï¼Œå‹™å¿…å…ˆæ˜ç¢ºéœ€æ±‚ï¼Œå†è¨è«–æŠ€è¡“ã€‚é€™é»å¾ˆé‡è¦ï¼ŒæŠ€è¡“çš„é©ç”¨èˆ‡å¦ï¼Œä¸æ˜¯ç”±å€‹äººçš„å–œå¥½æ±ºå®šï¼Œå”¯ä¸€çš„åˆ¤æ–·æ¨™æº–ï¼Œæ˜¯èƒ½ä¸èƒ½æœ‰æ•ˆç‡çš„æ»¿è¶³éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥é€™é‚Šå…ˆå®šç¾©æˆ‘å€‘ä»¥ä¸‹å¹¾å€‹éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸ·è¡ŒçŸ­æœŸçš„ batch job&lt;/li&gt;
&lt;li&gt;åŸ·è¡Œé•·æœŸçš„ user-facing API server&lt;/li&gt;
&lt;li&gt;åŸ·è¡Œé•·æœŸçš„ stateful è³‡æ–™åº«ã€å„²å­˜åº«&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;batch-job&#34;&gt;Batch Job&lt;/h3&gt;
&lt;p&gt;å¸¸è¦‹çš„ç¯„ä¾‹ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç¶²è·¯çˆ¬èŸ² (crawler) å»æŠ“å–è¨±å¤šç¶²ç«™çš„æ‰€æœ‰å…§å®¹&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ GPU é€²è¡Œæ©Ÿå™¨å­¸ç¿’çš„ Model Training&lt;/li&gt;
&lt;li&gt;å¤§æ•¸æ“šè¨ˆç®—&lt;/li&gt;
&lt;li&gt;MapReduce&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›ä»»å‹™çš„æ ¸å¿ƒéœ€æ±‚ï¼Œå¾ˆç°¡å–®ç›´æ¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›¡å¿«å®Œæˆæ•´é«”å·¥ä½œ&lt;/li&gt;
&lt;li&gt;ç›¡å¯èƒ½ç¯€çœå¤§é‡ç®—åŠ›æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šæˆ‘æ‰‹ä¸Šçš„æ©Ÿå™¨å­¸ç¿’ Model ç²—ç•¥ä¼°è¨ˆ 10000 å°æ™‚*GPU çš„ç®—åŠ›éœ€æ±‚ï¼Œæ‰èƒ½ç”¢å‡ºä¸€å€‹æœ‰æ•ˆçš„Modelã€‚ç”±æ–¼å¤§é‡çš„ç®—åŠ›éœ€æ±‚ï¼Œä¸€èˆ¬ä¾†èªªéƒ½æœƒé¸æ“‡åˆ†æ•£å¼çš„é‹ç®—æ¡†æ¶ (ex. MapReduce) ï¼Œå°‡çœŸæ­£æ¶ˆè€—ç®—åŠ›çš„å·¥ä½œï¼Œä½¿ç”¨åˆ†è€ŒåŒ–ä¹‹ (divide and conquer) çš„æ¶æ§‹è¨­è¨ˆï¼Œå°‡åˆ†é…ä»»å‹™çš„æ§åˆ¶ç¯€é» (master)ï¼Œèˆ‡å¯¦éš›é€²è¡Œé‹ç®—çš„å·¥ä½œç¯€é»(worker) æ‹†åˆ†ã€‚åŸºæ–¼åŸæœ¬çš„åˆ†æ•£å¼æ¶æ§‹ï¼Œå¹¾ä¹å¯ä»¥ç„¡ç—›åœ°å°‡å·¥ä½œç¯€é»è½‰ç§»åˆ°å…ˆå è™›æ“¬æ©Ÿä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ“šä¸Šè¿°çš„éœ€æ±‚ï¼Œé€™é¡çš„å·¥ä½œç‰¹æ€§å¯èƒ½æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU / GPU ç®—åŠ›éœ€æ±‚é«˜çš„é‹ç®—ç¯€é» (Worker)&lt;/li&gt;
&lt;li&gt;Worker æœ¬èº«æ˜¯ç„¡ç‹€æ…‹çš„ Stateless&lt;/li&gt;
&lt;li&gt;å¯æ§çš„å³æ™‚è² è¼‰&lt;/li&gt;
&lt;li&gt;å°‡æ•´é«”å·¥ä½œåˆ‡åˆ†æˆä»»å‹™å–®å…ƒ (task)ï¼Œåˆ†é…çµ¦å·¥ä½œç¯€é»&lt;/li&gt;
&lt;li&gt;ä»»å‹™å–®å…ƒçš„ç‹€æ…‹å¤–éƒ¨ä¿ç•™ï¼Œå·¥ä½œç¯€é»å¯å®¹éŒ¯ (fault-tolerent)ï¼Œä»»å‹™å–®å…ƒå¯å¾©åŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼å…ˆå è™›æ“¬æ©Ÿå¯èƒ½æ˜¯æµ®å‹•åƒ¹æ ¼ï¼Œé€™é¡å·¥ä½œå¯ä»¥æ ¹æ“šå„ªå…ˆç¨‹åº¦ï¼Œèª¿æ•´åˆé©çš„å·¥ä½œæ™‚é–“ï¼Œä¾‹å¦‚åœ¨è³‡æ–™ä¸­å¿ƒç®—åŠ›éœ€æ±‚ä½ï¼Œå…ˆå è™›æ“¬æ©Ÿçš„è²»ç”¨ä½å»‰æ™‚ï¼Œå•Ÿç”¨è¼ƒå¤šçš„å·¥ä½œç¯€é»åŠ å¿«é‹ç®—ï¼Œå¦‚æœè²»ç”¨é«˜æ™‚ï¼Œå¯ä»¥é™ä½å…ˆå è™›æ“¬æ©Ÿçš„ä½¿ç”¨ï¼Œå»¶å¾Œå·¥ä½œï¼Œç”šè‡³æ˜¯èª¿ç”¨ä¸åŒå€åŸŸï¼Œè²»ç”¨ä½çš„å·¥ä½œç¯€é»ï¼Œä¾†é™ä½æ•´é«”çš„æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;åŸ·å¾—æ³¨æ„çš„æ˜¯ï¼Œé€™é¡ä»»å‹™çš„æ§åˆ¶ç¯€é» (master)ï¼Œä¹Ÿè¨±æ˜¯é›†ä¸­å¼çš„ï¼Œä¹Ÿè¨±æ˜¯åˆ†æ•£å¼çš„ï¼Œéœ€è¦æ ¹æ“šæ€§è³ªè€ƒé‡ï¼Œæ˜¯å¦é©åˆæ”¾åœ¨å…ˆå è™›æ“¬æ©Ÿä¸Šã€‚æœ‰äº›æ¶æ§‹æ§åˆ¶ç¯€é»å¯ä»¥å®¹éŒ¯ï¼Œç„¶è€ŒéŒ¯èª¤ç™¼ç”Ÿå¾Œæœƒéœ€è¦å¾©åŸç‹€æ…‹ï¼Œé€™æ™‚æœƒæ¶ˆè€—é¡å¤–çš„ç®—åŠ›ï¼Œå¯èƒ½æœƒæ‹–ç·©æ•´é«”é€²åº¦ï¼Œé€ æˆç®—åŠ›çš„æ¶ˆè€—ã€‚ä¹Ÿè¨±å°±å¯ä»¥è€ƒé‡ä½¿ç”¨éš¨é¸è™›æ“¬æ©Ÿé…åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;user-facing-services&#34;&gt;User-facing services&lt;/h3&gt;
&lt;p&gt;å¸¸è¦‹çš„ç¯„ä¾‹ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Restful API server&lt;/li&gt;
&lt;li&gt;Websocket Server&lt;/li&gt;
&lt;li&gt;TCP/HTTP reverse proxy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›å·¥ä½œçš„æ ¸å¿ƒéœ€æ±‚å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•´é¡Œæœå‹™çš„é«˜å¯ç”¨æ€§ (high availability)&lt;/li&gt;
&lt;li&gt;æ‰¿å—ä¸å¯é æœŸçš„è² è¼‰é«˜å³° (load spikes)&lt;/li&gt;
&lt;li&gt;æ•´é«”è¡¨ç¾éœ€è¦ä½å»¶é² (low latency)&lt;/li&gt;
&lt;li&gt;å¯ä»¥æ°´å¹³æ“´å±• (horizontal scaling)ï¼Œæ”¯æ’ç”¨æˆ¶çš„æˆé•·&lt;/li&gt;
&lt;li&gt;æœ€çµ‚å¹³è¡¡æ•ˆèƒ½å‘ˆç¾èˆ‡æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æœƒé¢å°ä½¿ç”¨è€…ï¼Œéœ€è¦èƒ½æ”¯æŒä½¿ç”¨è€…çš„å£“åŠ›ï¼ŒåˆåŒæ™‚éœ€è¦æœ‰ä¸€å®šçš„æœå‹™æ•ˆèƒ½ï¼Œä¾†ç¶­æŒä½¿ç”¨è€…é«”é©—ã€‚å¯¦å‹™ä¸Šè¨­è¨ˆå¯èƒ½æ¡ç”¨ç„¡ç‹€æ…‹æ‡‰ç”¨ (stateless)ï¼Œå¤šå‰¯æœ¬ (replica) éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚éœ€è¦å„²å­˜çš„ç‹€æ…‹ï¼ˆå¦‚ç”¨æˆ¶ç‹€æ…‹ï¼‰ï¼Œä½¿ç”¨å¤–éƒ¨çš„å…±ç”¨å„²å­˜ (ä¾‹å¦‚ï¼šRedisï¼ŒRDBMSï¼Œæˆ–æ˜¯ Non-SQL DB)ã€‚è«‹æ±‚çš„æµé‡ï¼Œé€éä¸Šæ¸¸çš„è² è¼‰å‡è¡¡å™¨ (Load Balancer)ï¼Œé€é€²å¤šå€‹å¾Œç«¯ï¼Œè™•ç†å®Œæˆè«‹æ±‚å¾Œï¼Œå†è¿”å›çµ¦ä½¿ç”¨è€…ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£çš„è¨­è¨ˆï¼Œä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿä¹Ÿä¸æœƒæœ‰å¤ªå¤šçš„å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¾ä»£çš„é™„è¼‰å‡è¡¡å™¨å¤šåŠéƒ½èƒ½åƒå¾Œç«¯åšå¯ç”¨æ€§æª¢æ¸¬ (health check)ï¼Œå¯ä»¥æŠŠæµé‡å°å‘å·¥ä½œæ­£å¸¸çš„ç¯€é»ï¼Œå¦‚æœå¾Œç«¯çš„è™›æ“¬æ©Ÿè¢«è³‡æ–™ä¸­å¿ƒæ”¶å›äº†ï¼Œæµé‡ä¹Ÿæœƒç§»è½‰åˆ°å…¶ä»–ç¯€é»ä¸Šï¼Œä¸æœƒéºå¤±ç”¨æˆ¶è«‹æ±‚&lt;/li&gt;
&lt;li&gt;é…åˆè‡ªå‹•æ°´å¹³æ‹“å±•å·¥å…· (Auto horizontal scaler)ï¼Œå¯ä»¥è¨­å®šæœŸæœ›çš„æœå‹™ç¯€é»æ•¸é‡ï¼Œå¦‚æœè³‡æ–™ä¸­å¿ƒå›æ”¶å…ˆå ç¯€é»ï¼Œæ‹“å±•å·¥å…·å¯ä»¥åŒæ™‚å»å–å¾—æ–°çš„å…ˆå ç¯€é»ï¼Œæˆ–æ˜¯å–å¾—éš¨é¸éš¨ç”¨çš„è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;é…åˆæµé‡ç›£æ¸¬ï¼Œä¹Ÿå¯ä»¥å‹•æ…‹èª¿æ•´æœŸæœ›çš„æœå‹™ç¯€é»æ•¸é‡ï¼Œä¾‹å¦‚ï¼šåµæ¸¬åˆ°å¤§é‡ç”¨æˆ¶é€£ç·šæ•¸æ™‚ï¼Œå¢åŠ æ›´å¤šæœå‹™ç¯€é»ï¼Œå¾…æµé‡ä¸‹é™å¾Œï¼Œå†é™ä½æœå‹™ç¯€é»æ•¸é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™æ¨£çš„è¨­è¨ˆå¯¦å‹™ä¸Šæœ‰å¹¾é»æ³¨æ„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›–ç„¶èªªæ‡‰ç”¨å¾Œç«¯æœ¬èº«æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œä½†é¢å°ç”¨æˆ¶ä¹Ÿè¨±é‚„æ˜¯æœƒæœ‰éƒ¨åˆ†ç‹€æ…‹å­˜åœ¨æ‡‰ç”¨å¤–éƒ¨ï¼Œä¾‹å¦‚ï¼šUser sessionï¼Œæˆ–æ˜¯ websocket çš„é•·é€£ç·šã€‚ç‰¹åˆ¥æ³¨æ„é€™äº›æœå‹™æ–·ç·šçš„æ™‚å€™ï¼Œå°æ–¼ä½¿ç”¨è€…çš„å½±éŸ¿ï¼Œé…åˆå‰ç«¯å¢å¼·ä½¿ç”¨è€…é«”é©—&lt;/li&gt;
&lt;li&gt;å¾Œç«¯æ°´å¹³æ‹“å±•å¾Œï¼Œç“¶é ¸æœƒè½‰ç§»åˆ°å…¶ä»–åœ°æ–¹ï¼Œä¾‹å¦‚ Database æˆç‚ºæ•ˆèƒ½ç“¶é ¸ï¼Œæ‡‰ç”¨é€™é‚Šéœ€è¦åšä¸€å®šç¨‹åº¦çš„è‡ªå¾‹( ex. connection limitï¼Œrate limit)ï¼Œé¿å…ä¸æ–·å¢é•·çš„æ‡‰ç”¨å£“å®ä¾è³´çš„æœå‹™ï¼Œå¦‚ MessageQueue æˆ–æ˜¯ Database&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ†æ•£å¼çš„å„²å­˜ä¸­å¿ƒ (distributed DB)ï¼Œå¦‚ï¼šcassandra æˆ–æ˜¯å°å¼· DBã€‚è€Œé€™æ¨£é¡å‹çš„æœå‹™ï¼Œæ˜¯å¦é©åˆæ”¾åœ¨å…ˆå ç¯€é»ä¸Šï¼Ÿ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance Speficication</title>
      <link>https://chechia.net/zh-hant/post/2020-09-23-gcp-preemptible-instance-speficication/</link>
      <pubDate>Wed, 23 Sep 2020 16:23:14 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-23-gcp-preemptible-instance-speficication/</guid>
      <description>&lt;h1 id=&#34;å…ˆå è™›æ“¬æ©Ÿçµ‚æ­¢æµç¨‹-preemption-process&#34;&gt;å…ˆå è™›æ“¬æ©Ÿçµ‚æ­¢æµç¨‹ (Preemption process)&lt;/h1&gt;
&lt;p&gt;å­æ›°ï¼šæœªçŸ¥ç”Ÿç„‰çŸ¥æ­»ã€‚ä½†åšå·¥ç¨‹å¸«è¦åéä¾†ï¼Œè€ƒé‡æœ€å·®æƒ…å½¢ï¼Œä¹Ÿå°±æ˜¯è¦çŸ¥é“æ‡‰ç”¨å¯èƒ½å¦‚ä½•æ­»å»ã€‚ä¸çŸ¥é“æ‡‰ç”¨å¯èƒ½æ€éº¼æ­»ï¼Œåˆ¥èªªä½ çŸ¥é“æ‡‰ç”¨æ´»å¾—å¥½å¥½çš„ï¼Œå¤§æ¦‚æƒ³è¡¨é”é€™éº¼æ„æ€ã€‚&lt;/p&gt;
&lt;p&gt;é€™å°å…ˆå è™›æ“¬æ©Ÿä¾†èªªç‰¹åˆ¥é‡è¦ï¼Œä¸€èˆ¬æ‡‰ç”¨é¢å°çš„æ©Ÿå™¨æ•…éšœæˆ–æ˜¯æ©Ÿå™¨çµ‚æ­¢ï¼Œåœ¨ä½¿ç”¨å…ˆå è¥¿ä½ å¹¾çš„ç‹€æ³ä¸‹ï¼Œè®Šæˆæ¯æ—¥çš„å¿…ç„¶ï¼Œå› æ­¤ï¼Œéœ€è¦å°æ‡‰ç”¨çš„çµ‚æ­¢æƒ…å¢ƒï¼Œèˆ‡çµ‚æ­¢æµç¨‹æœ‰æ›´ç²¾ç´°çš„æŒæ§ã€‚å¦‚åŒå‰å¹¾ç¯‡æ‰€èªªçš„ï¼Œå…ˆå è™›æ“¬æ©Ÿæœƒè¢«å…¬æœ‰é›²æ”¶å›ï¼Œä½†æ”¶å›çš„æ™‚å€™ä¸æœƒçªç„¶æ©Ÿå™¨å°± ben ä¸è¦‹ï¼Œæœƒæœ‰ä¸€å€‹å›ºå®šçš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„æ‡‰ç”¨å·²ç¶“å¸¶æœ‰å¯å®¹éŒ¯çš„æ©Ÿåˆ¶ï¼Œèƒ½å¤ æ‰¿å—æ©Ÿå™¨çªç„¶è®Šä¸è¦‹ï¼Œæœå‹™é‚„å¥½å¥½çš„ï¼Œä»ç„¶è¦èŠ±æ™‚é–“ç†è§£é€™é‚Šçš„æµç¨‹ï¼Œè—‰æ­¤ç²¾ç®—æ¯å¤©è™›æ“¬æ©Ÿçš„çµ‚æ­¢èˆ‡æ›¿æ›ï¼šæ‡‰ç”¨æœƒæœ‰ä»€éº¼åæ‡‰ï¼Œæœƒç”¢ç”Ÿå¤šå°‘è¡æ“Šï¼Œç¨å¾Œå¯ä»¥é‡åŒ–æœå‹™çš„å½±éŸ¿ã€‚ä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‡‰ç”¨é‡å•Ÿåˆå§‹åŒ–æ™‚ cpu memory çªç„¶æ‹‰é«˜&lt;/li&gt;
&lt;li&gt;æ‰¿å—ç¯€é»éŒ¯èª¤å¾Œçš„å¾©åŸæµç¨‹ï¼Œéœ€è¦æ¶ˆè€—é¡å¤–ç®—åŠ›ã€‚ä¾‹å¦‚éœ€è¦å¾ä¸Šå€‹ checkpoint æ¥çºŒåšï¼Œéœ€è¦å»è®€å–è³‡æ–™é€ æˆ IOï¼Œæˆ–æ˜¯è³‡æ–™éœ€è¦åš rebalance &amp;hellip;ç­‰ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½ çš„æ‡‰ç”¨éœ€è¦æœ‰ graceful shutdown çš„æ©Ÿåˆ¶ï¼Œé‚£ä½ å‹™å¿…è¦ç´°å¿ƒç†è§£é€™é‚Šçš„æ­¥é©Ÿã€‚ä¸¦ä»”ç´°å®‰æ’å®‰å…¨ä¸‹æ¨çš„æ­¥é©Ÿã€‚åˆæˆ–æ˜¯ç„¡æ³•ä¿è­‰åœ¨å…ˆå è™›æ“¬æ©Ÿå›æ”¶çš„ä½œæ¥­æ™‚é™å…§ï¼Œå®Œæˆå„ªé›…çµ‚æ­¢ï¼Œéœ€è¦è€ƒæ…®å…¶ä»–å¯èƒ½çš„å¯¦ä½œè§£æ³•ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šæœ‰å¹¾å€‹é¢å‘è¦æ³¨æ„&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;GCP å¦‚ä½•çµ‚æ­¢å…ˆå ç¯€é»&lt;/li&gt;
&lt;li&gt;GCP ç§»é™¤ç¯€é»å° GKE ã€ä»¥åŠåŸ·è¡Œä¸­æ‡‰ç”¨çš„å½±éŸ¿&lt;/li&gt;
&lt;li&gt;GKE é›†ç¾¤å¦‚ä½•æ‡‰å°çš„ç¯€é»å¤±æ•ˆ&lt;/li&gt;
&lt;li&gt;GCP è‡ªå‹•èª¿åº¦è£œè¶³æ–°çš„å…ˆå ç¯€é»&lt;/li&gt;
&lt;li&gt;GKE é›†ç¾¤å¦‚ä½•æ‡‰å°ç¯€é»è£œè¶³&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‰å€‹é‡é»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿçµ‚æ­¢å°é›†ç¾¤çš„å½±éŸ¿&lt;/li&gt;
&lt;li&gt;Pod éš¨ä¹‹çµ‚æ­¢å°æ‡‰ç”¨çš„å½±éŸ¿ï¼Œæ˜¯å¦èƒ½å¤ å„ªé›…çµ‚æ­¢&lt;/li&gt;
&lt;li&gt;æœ‰æ²’æœ‰æ–¹æ³•å¯ä»¥é¿å…ä¸Šé¢å…©è€…çš„å½±éŸ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŠ‡é€ä¸€ä¸‹ï¼šæœ‰çš„ï¼Œæœ‰ä¸€äº›æ‹›å¼å¯ä»¥è™•ç†ã€‚è®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;gcp-å¦‚ä½•çµ‚æ­¢è™›æ“¬æ©Ÿ&#34;&gt;GCP å¦‚ä½•çµ‚æ­¢è™›æ“¬æ©Ÿ&lt;/h3&gt;
&lt;p&gt;å…ˆå è™›æ“¬æ©Ÿçš„ç¡¬é«”çµ‚æ­¢æ­¥é©Ÿèˆ‡ä¸€èˆ¬éš¨é¸è™›æ“¬æ©Ÿç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘è¦å…ˆç†è§£&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/stop-start-instance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è™›æ“¬æ©Ÿçš„åœæ­¢æµç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€™è£¡æŒ‡çš„çµ‚æ­¢ (Stop) æ˜¯&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/instance-life-cycle&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è™›æ“¬æ©Ÿç”Ÿå‘½é€±æœŸ&lt;/a&gt; çš„ RUNNING -&amp;gt; instances.stop() -&amp;gt; STOPPING -&amp;gt; TERMINATED çš„æ­¥é©Ÿã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;instances.stop()&lt;/li&gt;
&lt;li&gt;ACPI shutdown&lt;/li&gt;
&lt;li&gt;OS æœƒé€²è¡Œ shutdown æµç¨‹ï¼Œä¸¦å˜—è©¦åŸ·è¡Œå„å€‹æœå‹™çš„çµ‚æ­¢æµç¨‹ï¼Œä»¥å®‰å…¨çš„çµ‚æ­¢æœå‹™ã€‚å¦‚æœè™›æ“¬æ©Ÿæœ‰è¨­å®š&lt;a href=&#34;https://cloud.google.com/compute/docs/shutdownscript&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Shtudown Script&lt;/a&gt; æœƒåœ¨é€™æ­¥é©Ÿè™•ç†&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/deleting-instance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç­‰å¾…è‡³å°‘ 90 ç§’&lt;/a&gt;ï¼Œè®“ OS å®Œæˆçµ‚æ­¢çš„æµç¨‹
&lt;ul&gt;
&lt;li&gt;é€¾æ™‚çš„çµ‚æ­¢æµç¨‹ï¼ŒGCP æœƒç›´æ¥å¼·åˆ¶çµ‚æ­¢ï¼Œå°±ç®— shutdown script é‚„æ²’è·‘å®Œ&lt;/li&gt;
&lt;li&gt;GCP ä¸ä¿è­‰çµ‚æ­¢æ™‚é™çš„æ™‚é–“ï¼Œå®˜æ–¹å»ºè­°ä¸è¦å¯«é‡è¦çš„ä¾è³´è…³æœ¬åœ¨çµ‚æ­¢æ™‚é™å…§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è™›æ“¬æ©Ÿè®Šæˆ TERMINATED ç‹€æ…‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;gcp-å¦‚ä½•çµ‚æ­¢å…ˆå è™›æ“¬æ©Ÿ&#34;&gt;GCP å¦‚ä½•çµ‚æ­¢å…ˆå è™›æ“¬æ©Ÿ&lt;/h3&gt;
&lt;p&gt;èˆ‡éš¨é¸è™›æ“¬æ©Ÿä¸åŒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿçš„æ™‚é–“ 30 ç§’&lt;/li&gt;
&lt;li&gt;æ­é… GKE ä½¿ç”¨ Managed Instance Groupï¼Œçµ‚æ­¢çš„è™›æ“¬æ©Ÿæœƒè¢«åˆªé™¤ï¼ŒAutoscaler æœƒå•Ÿå‹•æ–°çš„è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€æ¨£å…ˆçœ‹&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/preemptible?hl=zh-tw#preemption-process&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…ˆå è™›æ“¬æ©Ÿçš„èªªæ˜æ–‡ä»¶ï¼šçµ‚æ­¢æµç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è³‡æ–™ä¸­å¿ƒé–‹å§‹å›æ”¶å…ˆå è™›æ“¬æ©Ÿï¼Œé¸ä¸­æˆ‘å€‘å°ˆæ¡ˆå…¶ä¸­çš„ä¸€å°å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;Compute Engine å‚³é€ ACPI G2 Soft Offï¼Œé€™è£¡ OS æœƒè©¦åœ–å®‰å…¨é—œè®Šæœå‹™ï¼Œä¹ŸæœƒåŸ·è¡Œ &lt;a href=&#34;https://cloud.google.com/compute/docs/instances/create-start-preemptible-instance?hl=zh-tw#handle_preemption&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;shutdown script&lt;/a&gt;ï¼Œå¯ä»¥åšç°¡çŸ­çš„å„ªé›…çµ‚æ­¢&lt;/li&gt;
&lt;li&gt;30ç§’å¾Œï¼ŒACPI G3 Mechanical off&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½† 30 ç§’èƒ½åšä»€éº¼ï¼Ÿåªèƒ½å¿«é€Ÿçš„äº¤ä»£ç•¶å‰é€²åº¦ã€‚å¦‚æœæ‡‰ç”¨éœ€è¦èŠ±æ™‚é–“æ”¶å°¾ï¼Œä¿å­˜å·¥ä½œé€²åº¦ï¼Œå¯èƒ½æœƒç”¢ç”Ÿè¨±å¤šå•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCP ä¸ä¿è­‰çµ‚æ­¢æ™‚é™çš„æ™‚é–“ï¼Œå®˜æ–¹å»ºè­°ä¸è¦å¯«é‡è¦çš„ä¾è³´è…³æœ¬åœ¨çµ‚æ­¢æ™‚é™å…§&lt;/li&gt;
&lt;li&gt;åœ¨é¢å°å¤§é‡ IO çš„å·¥ä½œï¼Œå¯èƒ½æœƒå°è‡´è€…å°è™›æ“¬æ©Ÿçš„å¤§é‡æ‡‰ç”¨ä¸€èµ·é€²å…¥å„ªé›…çµ‚æ­¢ï¼Œå…ˆå è™›æ“¬æ©Ÿæœ€å¾Œè€—ç›¡è³‡æºï¼Œä¾†ä¸åŠåšå®Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœå¯èƒ½æœƒè¶…æ™‚ï¼Œæˆ–æ˜¯æ²’å®Œæˆæœƒæœ‰è³‡æ–™éºå¤±é¢¨éšªï¼Œå°±ä¸èƒ½åœ¨é€™å€‹éšæ®µè™•ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾è³´ shutdown script åšæ”¶å°¾æ˜¯å±éšªçš„ï¼Œæˆ‘å€‘ä¹‹å¾Œè¦æƒ³è¾¦æ³•è™•ç†é€™å€‹ä¸ä¿è­‰åšå®Œçš„å„ªé›…çµ‚æ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‡‰ç”¨æœ¬èº«æœ‰å®¹éŒ¯çš„æ¡†æ¶ï¼Œæˆ–æ˜¯æœ‰å®¹éŒ¯æ©Ÿåˆ¶ï¼Œæˆ‘å€‘é€™é‚Šè¦é¡å¤–åšçš„å·¥ä½œå°±æœƒå°‘å¾ˆå¤šã€‚ä¾‹å¦‚è¨±å¤šç¨‹å¼æ¡†æ¶æä¾›è‡ªå‹•é‡å•Ÿçš„åŠŸèƒ½ï¼Œåœ¨å¤–éƒ¨ä¿å­˜ checkpointï¼Œworker åªè² è²¬é‹ç®—ï¼Œçµ‚æ­¢ä¿¡è™Ÿä¸€é€²ä¾†ï¼Œä¹Ÿä¸ç”¨ä¿å­˜ï¼Œç›´æ¥æ‹‹æ£„æœªå®Œæˆçš„å·¥ä½œé€²åº¦ï¼Œç•™å¾…ç¹¼èµ·çš„ worker å¾ checkpoint æ¥æ‰‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;preemption-selection&#34;&gt;Preemption selection&lt;/h3&gt;
&lt;p&gt;é™¤äº† 24 å°æ™‚çš„å£½å‘½é™åˆ¶æœƒçµ‚æ­¢è™›æ“¬æ©Ÿï¼Œè³‡æ–™ä¸­å¿ƒçš„äº‹ä»¶ä¹Ÿæœƒè§¸ç™¼ä¸»å‹•çš„è™›æ“¬æ©Ÿå›æ”¶ï¼Œ&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/preemptible?hl=zh-tw#limitations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”± GCP ä¸»å‹•è§¸ç™¼çš„å›æ”¶æ©Ÿåˆ¶æ©Ÿç‡å¾ˆä½&lt;/a&gt;ï¼Œæœƒæ ¹æ“šæ¯æ—¥æ¯å€‹å€åŸŸ (zone)Â çš„ç‹€æ…‹è€Œå®šã€‚é€™è£¡æè¿°è³‡æ–™ä¸­å¿ƒå•Ÿå‹•çš„è‡¨æ™‚å›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;GCP ä¸æœƒæŠŠæ‰€ä½ æ‰‹ä¸Šçš„ preemptible æ©Ÿå™¨éƒ½æ”¶èµ°ï¼Œè€Œæ˜¯ä¾ç…§&lt;a href=&#34;https://cloud.google.com/compute/docs/instances/preemptible?hl=zh-tw#preemption-process&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€å®šçš„è¦å‰‡&lt;/a&gt;ï¼Œé¸æ“‡ä¸€å€‹æ¯”ä¾‹æ’¤æ›çš„æ©Ÿå™¨ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹æ–‡ä»¶æ•˜è¿°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Compute Engine æœƒé¿å…å¾å–®ä¸€å®¢æˆ¶ç§»é™¤å¤ªå¤šå…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;å„ªå…ˆç§»é™¤æ–°çš„è™›æ“¬æ©Ÿï¼Œåå‘ä¿ç•™èˆŠçš„è™›æ“¬æ©Ÿ (ä½†æœ€å¤šä»æ´»ä¸é 24hr)&lt;/li&gt;
&lt;li&gt;é–‹å•Ÿå¾Œé¦¬ä¸Šè¢«ç§»é™¤çš„å…ˆå è™›æ“¬æ©Ÿä¸è¨ˆè²»&lt;/li&gt;
&lt;li&gt;æ©Ÿå™¨å°ºå¯¸è¼ƒå°çš„æ©Ÿå™¨ï¼Œå¯ç”¨æ€§è¼ƒé«˜ã€‚ä¾‹å¦‚ï¼š16 cpu çš„å…ˆå è™›æ“¬æ©Ÿï¼Œæ¯” 128 cpu çš„å…ˆå è™›æ“¬æ©Ÿå®¹æ˜“å–å¾—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GCP æ¯å¤©å¹³å‡æœƒç§»é™¤ä¸€å€‹å°ˆæ¡ˆä¸­ 5% - 15% çš„è™›æ“¬æ©Ÿï¼Œå¾ç”¨æˆ¶çš„è§’åº¦æˆ‘å€‘éœ€è¦é æœŸè‡³å°‘é€™å€‹ç¨‹åº¦çš„å›æ”¶ã€‚ä¸éé€™å€‹æ¯”ä¾‹ï¼ŒGCP ä¹Ÿä¸çµ¦äºˆä»»ä½•ä¿è­‰ã€‚ä»¥ç­†è€…ç¶“é©—ï¼Œåªèƒ½èªªçµ•å¤§éƒ¨åˆ†çš„æ™‚å€™ï¼Œéƒ½ä¸æœƒæ“”å¿ƒè¶…éé€™å€‹æ¯”ä¾‹çš„å›æ”¶ï¼Œä½†æ˜¯é‚„æ˜¯è¦åšå¥½æœ€å£çš„æ‰“ç®—ï¼Œå¦‚æœè‡¨æ™‚ç„¡æ³•å–å¾—è¶³å¤ çš„å…ˆå è™›æ“¬æ©Ÿï¼Œè¦æœ‰æ–¹æ³•æš«æ™‚è£œè¶³éš¨é¸è™›æ“¬æ©Ÿã€‚&lt;/p&gt;
&lt;h3 id=&#34;gke&#34;&gt;GKE&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/preemptible-vms#kubernetes_constraint_violations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿæœƒé•å Kubernetes çš„è¨­è¨ˆ&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pod grace period æœƒè¢«å¿½ç•¥&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh/docs/concepts/workloads/pods/disruptions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod disreuption budget&lt;/a&gt;ï¼Œä¸æœƒè¢«éµå®ˆ (å¯èƒ½æœƒè¶…é)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å°æ‡‰ç”¨çš„å½±éŸ¿&#34;&gt;å°æ‡‰ç”¨çš„å½±éŸ¿&lt;/h3&gt;
&lt;p&gt;GCP è§¸ç™¼çš„ Preemptible processï¼Œå°æ‡‰ç”¨çš„å½±éŸ¿&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;involuntary disruptionsï¼ŒGCP é€ ACPI G2 Soft Off&lt;/li&gt;
&lt;li&gt;OS çµ‚æ­¢æœå‹™ï¼ŒåŒ…å«åŸ·è¡Œ Kubernetes çš„ container runtime&lt;/li&gt;
&lt;li&gt;å®¹å™¨å…§çš„æ‡‰ç”¨æœƒæ”¶åˆ° SIGTERMï¼Œå•Ÿå‹• graceful shutdown
&lt;ul&gt;
&lt;li&gt;Kubernetes æä¾›çš„ Graceful-shutdown å¯èƒ½æœƒè·‘ä¸å®Œ&lt;/li&gt;
&lt;li&gt;å¯¦å‹™ä¸Šåªæ˜¯ä¸­æ–·ç•¶å‰å·¥ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/solutions/scope-and-size-kubernetes-engine-clusters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cloud.google.com/solutions/scope-and-size-kubernetes-engine-clusters&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;å¤§é‡ç¯€é»åŒæ™‚å›æ”¶&#34;&gt;å¤§é‡ç¯€é»åŒæ™‚å›æ”¶&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼ GCP ä¸¦ä¸ä¿è­‰æ”¶å›çš„æ©Ÿå™¨çš„æ•¸é‡ï¼ŒåŒæ™‚å›æ”¶çš„æ©Ÿå™¨é‡å¤§ï¼Œé‚„æ˜¯æœƒè¡æ“Šåˆ°æœå‹™ã€‚ä¾‹å¦‚ï¼šä¸€æ¬¡æ”¶å› 15% çš„ç®—åŠ›ï¼Œç•¶ç„¶æœå‹™é‚„æ˜¯æœƒå—åˆ°è¡æ“Šã€‚ç•¶ç„¶é€™æ¨£äº‹ä»¶çš„æ©Ÿç‡ä¸¦ä¸é«˜ï¼Œä½†æˆ‘å€‘ä»æ˜¯éœ€è¦ç‚ºæ­¤æ‰“ç®—ã€‚é€™é‚Šæœ‰å¹¾å€‹åšæ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é ç•™æ›´å¤šçš„ç®—åŠ›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ regional clusterï¼Œåœ¨å¤šå€‹ zone ä¸Šåˆ†é…å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘è‡ªè¡Œæ§åˆ¶ï¼Œæå‰ä¸»å‹•å›æ”¶è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é ç•™æ›´å¤šè³‡æº&#34;&gt;é ç•™æ›´å¤šè³‡æº&lt;/h3&gt;
&lt;p&gt;é€™é»å¾ˆç›´è§€ï¼Œç”±æ–¼ä½¿ç”¨äº†æ›´åŠ ä¾¿å®œçš„æ©Ÿå™¨ï¼Œæˆ‘å€‘å¯ä»¥ç”¨åŒæ¨£çš„æˆæœ¬ï¼Œé–‹æ›´å¤šçš„æ©Ÿå™¨ã€‚&lt;/p&gt;
&lt;p&gt;é€€ä¸€æ­¥èªªï¼Œä½¿ç”¨æ‰“ä¸‰æŠ˜çš„å…ˆå è™›æ“¬æ©Ÿï¼Œç„¶å¾Œé–‹åŸæœ¬å…©å€çš„æ©Ÿå™¨æ•¸é‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¸½æˆæœ¬æ˜¯ 0.3 * 2 = 0.6 å€&lt;/li&gt;
&lt;li&gt;åŒæ™‚é–“å¯ç”¨è³‡æºæ˜¯ 2 å€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼å…ˆå ç¯€é»å›æ”¶çš„å–®ä½æ˜¯ä¸€å€‹ä¸€å€‹è™›æ“¬æ©Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰æ’åˆé©çš„æ©Ÿå™¨å°ºå¯¸&lt;/li&gt;
&lt;li&gt;å°ºå¯¸è¼ƒå°çš„å…ˆå è™›æ“¬æ©Ÿï¼Œå¯ç”¨æ€§è¼ƒé«˜ã€‚æ„æ€æ˜¯é›¶ç¢çš„å…ˆå è™›æ“¬æ©Ÿå®¹æ˜“å–å¾—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†ç•¶ç„¶ä¹Ÿä¸èƒ½éƒ½é–‹å¤ªå°çš„æ©Ÿå™¨ï¼Œé€™æœƒåš´é‡å½±éŸ¿æ‡‰ç”¨çš„åˆ†é…ã€‚è‡³æ–¼å…·é«”éœ€è¦é–‹å¤šå¤§ï¼Œå¯ä»¥æ ¹æ“šé è¨ˆåœ¨æ©Ÿå™¨ä¸Šé‹è¡Œçš„æ‡‰ç”¨ï¼Œåšç¶œåˆè€ƒé‡ï¼Œä¾‹å¦‚æœ‰ä»¥ä¸‹å½±ç”¨éœ€è¦åŸ·è¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;app A: 1 cpu 5 replica&lt;/li&gt;
&lt;li&gt;app B: 3 cpu 5 replica&lt;/li&gt;
&lt;li&gt;app C: 5 cpu 5 replica&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½å…±è‡³å°‘ 45 cpu ï¼Œé æœŸæ©Ÿå™¨è² è¼‰8 æˆçš„è©±ï¼Œéœ€è¦ç¸½å…± 45 / 0.8 = 56 cpuã€‚ä¹Ÿè¨±å¯ä»¥è€ƒæ…®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;8 cpu * 7 å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;4 cpu * 14&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹Ÿèˆ‰å¹¾å€‹æ¥µç«¯ä¸å¯è¡Œçš„ä¾‹å­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;56 cpu * 1
&lt;ul&gt;
&lt;li&gt;é€™æ¨£çš„è™›æ“¬æ©Ÿå›æ”¶æ™‚çš„å½±éŸ¿ç¯„åœ (blast radius) å°±æ˜¯ 100% æœå‹™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;1 cpu * 56
&lt;ul&gt;
&lt;li&gt;æ©Ÿå™¨å¤ªç‘£ç¢ï¼Œå¯èƒ½è¶…å‡º Qouta (ç¯€é»æ•¸é‡ï¼ŒIP æ•¸é‡&amp;hellip;)&lt;/li&gt;
&lt;li&gt;æ‡‰ç”¨æœƒæ›´åˆ†æ•£ï¼Œç¯€é»é–“çš„å…§éƒ¨ç¶²è·¯æµé‡æœƒå¢åŠ &lt;/li&gt;
&lt;li&gt;å‰å¹¾ç¯‡æåˆ°çš„ reserved resource æ¯”ä¾‹é«˜ï¼Œæœƒå½±éŸ¿æ‡‰ç”¨çš„éƒ¨ç½²&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå¸Œæœ›æ›´ä¿éšªï¼Œå¯ä»¥å†è£œä¸Šéš¨é¸è™›æ“¬æ©Ÿæ··åˆæ­é…ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;8 cpu * 7
&lt;ul&gt;
&lt;li&gt;5 å…ˆå è™›æ“¬æ©Ÿ 2 éš¨é¸è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;4 cpu * 14
&lt;ul&gt;
&lt;li&gt;10 å…ˆå è™›æ“¬æ©Ÿ 4 éš¨é¸è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è™›æ“¬æ©Ÿå€åŸŸ&#34;&gt;è™›æ“¬æ©Ÿå€åŸŸ&lt;/h3&gt;
&lt;p&gt;è™›æ“¬æ©Ÿçš„å›æ”¶è§¸ç™¼ï¼Œä¹Ÿæ˜¯æœƒä¾æ“šæœå‹™çš„å€åŸŸ (zone) å›æ”¶ã€‚æ„æ€æ˜¯ç¯€é»å›æ”¶ä¸æœƒåŒæ™‚è§¸ç™¼ asia-east1 ä¸­æ‰€æœ‰ zone çš„ç¯€é»å›æ”¶ï¼Œä¸€èˆ¬ä¾†èªªæ™‚é–“æ˜¯éŒ¯é–‹çš„ (ä¸éGCP ä¹Ÿä¸ä¿è­‰é€™é» XD)ã€‚ç‚ºäº†ç¶­æŒ GKE çš„å¯ç”¨æ€§ï¼Œæˆ‘å€‘éƒ½æœƒé–‹å¤šå€‹ node-pool åœ¨å¤šå€‹å€åŸŸä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹é¿å…æŠŠæ©Ÿå™¨éƒ½æ”¾åœ¨åŒå€‹å€åŸŸä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è‡ªè¡Œæ§åˆ¶çš„è™›æ“¬æ©Ÿæ±°æ›&#34;&gt;è‡ªè¡Œæ§åˆ¶çš„è™›æ“¬æ©Ÿæ±°æ›&lt;/h3&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªæˆ‘å€‘åœ¨ 24 hr æœŸé™ä¹‹å‰ï¼Œå…ˆåˆ†æ‰¹è‡ªç›¡ XDï¼Œæ‰“æ•£å€‹å„å€‹è™›æ“¬æ©Ÿçš„ 24 å°æ™‚é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨é€™å€‹æœ‰è¶£çš„å·¥å…· &lt;a href=&#34;https://github.com/estafette/estafette-gke-preemptible-killer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;estafette-gke-preemptible-killer&lt;/a&gt;ï¼Œè‡ªå‹•æ±°æ›å…ˆå è™›æ“¬æ©Ÿï¼Œè®“æ•´å€‹ç¹¼èµ·è™›æ“¬æ©Ÿéƒ½åˆ†æ•£åœ¨ 24 å°æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;estafette-gke-preemptible-killer ï¼Œä½¿ç”¨ä¸Šç°¡å–®ï¼Œå¤§å®¶è‡ªå·±çœ‹è‘—è¾¦ XDã€‚å¦‚æœå¤§å®¶æœ‰èˆˆè¶£ï¼Œç•™è¨€çš„äººå¤šçš„è©±ï¼Œæˆ‘å†å¦å¤–é–‹ä¸€ç¯‡ç´°è¬›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h3&gt;
&lt;p&gt;ç‚ºäº†ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿï¼Œæˆ‘å€‘è¦å¤šåšä»¥ä¸‹å¹¾ä»¶äº‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‚ºæ‡‰ç”¨è¨­è¨ˆå¯å®¹éŒ¯åˆ†æ•£å¼æ¶æ§‹ï¼Œä¾‹å¦‚æ‡‰ç”¨å¯ä»¥åŒæ™‚åŸ·è¡Œä¸€æ¨£çš„ API server 3 å€‹ replica&lt;/li&gt;
&lt;li&gt;åˆ†æ•£ Pod åˆ°åˆé©çš„æ©Ÿå™¨ä¸Šï¼Œä¾‹å¦‚è¨­ç½® PodAntiAffinity&lt;/li&gt;
&lt;li&gt;è¨­å®šåˆé©çš„è™›æ“¬æ©Ÿå¤§å°ï¼Œåˆé©çš„åˆ†æ•£æ‡‰ç”¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&#34;https://github.com/estafette/estafette-gke-preemptible-killer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;estafette-gke-preemptible-killer&lt;/a&gt;ï¼Œè‡ªå‹•æ±°æ›å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ä¾è³´æ‡‰ç”¨çš„ Graceful-shutdown æµç¨‹&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance Requirement Distributed</title>
      <link>https://chechia.net/zh-hant/post/2020-09-22-gcp-preemptible-instance-requirement-distributed/</link>
      <pubDate>Tue, 22 Sep 2020 14:39:00 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-22-gcp-preemptible-instance-requirement-distributed/</guid>
      <description>&lt;p&gt;æˆ‘å€‘ä»¥ä¸‹å¹¾å€‹éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸ·è¡ŒçŸ­æœŸçš„ batch job&lt;/li&gt;
&lt;li&gt;åŸ·è¡Œé•·æœŸçš„ user-facing API server&lt;/li&gt;
&lt;li&gt;åŸ·è¡Œé•·æœŸçš„ stateful è³‡æ–™åº«ã€å„²å­˜åº«&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è©²ä¸è©²åœ¨ Kubernetes ä¸Šé¢è·‘ databaseï¼Ÿ&lt;/p&gt;
&lt;p&gt;TL;DR ï¼Œå¦‚æœä½ å‰›é–‹å§‹è€ƒæ…®é€™ä»¶äº‹ï¼Œé€šå¸¸çš„ç­”æ¡ˆéƒ½æ˜¯å¦å®šçš„&lt;/p&gt;
&lt;p&gt;ç­‰ç­‰ï¼Œæˆ‘å€‘é€™é‚Šä¸æ˜¯è¨è«–è©²ä¸è©²ä¸Š Kuberentes ï¼Œè€Œæ˜¯è©²ä¸è©²ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿå§ã€‚ç„¶è€Œç”±æ–¼å…ˆå è™›æ“¬æ©Ÿç¯€é»çš„è«¸å¤šé™åˆ¶ï¼Œå…‰æ†‘å…ˆå è™›æ“¬æ©Ÿä¸¦ä¸é©åˆè·‘ä»»ä½•æŒä¹…æ€§çš„å„²å­˜åº«ã€‚æˆ‘å€‘é€™é‚Šä»°è³´ Kubernetes çš„ç¶²è·¯åŠŸèƒ½ (e.g. æœå‹™ç™¼ç¾)ï¼Œèˆ‡è‡ªå‹•ç®¡ç† (e.g. health checkï¼ŒHPAï¼Œauto-scaler)ï¼ŒåŸºæ–¼å…ˆå è™›æ“¬æ©Ÿï¼Œå»ºæ§‹é«˜å¯ç”¨æ€§çš„æœå‹™æ¶æ§‹ï¼Œä¾†æ”¯æ’é«˜å¯ç”¨ï¼Œä¸”æœ‰ç‹€æ…‹çš„çš„å„²å­˜åº«ã€‚&lt;/p&gt;
&lt;p&gt;æ‡‰ç”¨æ˜¯å¦é©åˆéƒ¨ç½²åˆ° Kubernetes ä¸Šï¼Œå¯ä»¥çœ‹é€™ç¯‡ &lt;a href=&#34;https://cloud.google.com/blog/products/databases/to-run-or-not-to-run-a-database-on-kubernetes-what-to-consider&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Blog: To run or not to run a database on Kubernetes: What to consider&lt;/a&gt;ï¼Œå¦‚æœå¤§å®¶æœ‰èˆˆè¶£ï¼Œå†ç•™è¨€å‘Šè¨´æˆ‘ï¼Œæˆ‘å†é€²è¡Œä¸­æ–‡ç¿»è­¯ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä¸­é‡å°ä¸‰å€‹å¯èƒ½çš„æ–¹æ¡ˆåšåˆ†æï¼Œä»¥ MySQL ç‚ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sassï¼ŒGCP çš„ Cloud SQL
&lt;ul&gt;
&lt;li&gt;æœ€ä½çš„ç®¡ç†ç¶­é‹æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è‡ªæ¶ MySQL åœ¨ GCP çš„ VM ä¸Šï¼Œè‡ªè¡Œç®¡ç†
&lt;ul&gt;
&lt;li&gt;è‡ªè² å®Œå…¨çš„ç®¡ç†è²¬ä»»ï¼ŒåŒ…å«å¯ç”¨æ€§ï¼Œå‚™ä»½ (backup)ï¼Œä»¥åŠå®¹éŒ¯ç§»è½‰ (failover)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è‡ªæ¶ MySQL åœ¨ Kubernetes ä¸Š
&lt;ul&gt;
&lt;li&gt;è‡ªè² å®Œå…¨çš„ç®¡ç†è²¬ä»»&lt;/li&gt;
&lt;li&gt;Kubernetes çš„è¤‡é›œæŠ½è±¡å±¤ï¼ŒæœƒåŠ é‡ç¶­é‹å·¥ä½œçš„è¤‡é›œç¨‹åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œ RDBMS çš„æä¾›å•†ï¼Œè‡ªå®¶ä¹Ÿæä¾› Operator&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/oracle/mysql-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Oracle è‡ªå®¶æä¾›çš„ MySQL Operator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/CrunchyData/postgres-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CrunchyData ä¹Ÿæœ‰æä¾›çš„ Postgres Operator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å°±æƒ³ï¼Œæ‰€ä»¥é€™äº›äººæ˜¯æƒ³æ€æ¨£ï¼ŒRDBMS æ”¾ Kubernetes ä¸Šåˆ°åº•æ˜¯è¡Œä¸è¡Œ XDã€‚Google çš„æ–‡ç« èªªæ˜ï¼šå¦‚æœæ‡‰ç”¨æœ¬èº«ä¸¦ä¸ç¬¦åˆ Kubernetes çš„å·¥ä½œæµç¨‹ (Pod life-cycle)ï¼Œå¯ä»¥é€éä¸Šè¿°çš„ Operator ä¾†è‡ªå‹•åŒ–è¨±å¤šç¶­é‹çš„ä½œæ¥­ï¼Œé™ä½ç¶­é‹çš„å›°é›£ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œ DB æœ‰åƒç™¾ç¨®ï¼Œé™¤äº† RDBMS ä»¥å¤–ï¼Œé‚„æœ‰å¦å¤–ä¸€æ‰¹ Database å¤©ç”Ÿå°±å…·æœ‰åˆ†æ•£å¼çš„æ¶æ§‹ï¼Œé€™äº›å„²å­˜åº«éƒ¨ç½²åˆ° Kubernetes ä¸Šï¼Œä¸¦ä¸æœƒå¤ªç—›è‹¦ (é‚„æ˜¯è¦ä»˜å‡ºä¸€å®šçš„æˆæœ¬XD)ï¼Œä½†æ˜¯å»å¯ä»¥å¾—ç›Šæ–¼ Kubernetes çš„è«¸å¤šåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åº•ä¸‹æˆ‘å€‘å…ˆæ ¹æ“šåˆ†æ•£å¼çš„å„²å­˜åº«åšæ¦‚è§€æè¿°ï¼Œæœ¬ç³»åˆ—æ–‡çš„æœ€å¾Œï¼Œæœƒæ ¹æ“šæ™‚é–“ç‹€æ³ï¼Œåšå¯¦ä¾‹åˆ†äº«ï¼šCassandra æˆ–æ˜¯ CockroachDBã€‚æä¾›å„ä½ä¸€é»ç™¼æƒ³ï¼Œä¸¦æ ¹æ“šéœ€æ±‚å»é¸æ“‡éœ€è¦çš„å„²å­˜åº«&lt;/p&gt;
&lt;p&gt;ã€Œè¡Œä¸è¡Œè¦å•ä½ è‡ªå·±äº†æ–½ä¸»ï¼ŒæŠ€è¡“ä¸Šéƒ½å¯ä»¥ï¼Œç¶­é‹ä¸Šè¦çœ‹çœ‹ä½ çš„åœ˜éšŠæœ‰æ²’æœ‰é‚£å€‹å±è‚¡åƒé€™ä»½è—¥ XDã€&lt;/p&gt;
&lt;h3 id=&#34;distributed-database&#34;&gt;Distributed Database&lt;/h3&gt;
&lt;p&gt;åº•ä¸‹éå¸¸ç²—æ·ºçš„ç°¡ä»‹åˆ†æ•£å¼å„²å­˜åº«çš„æ¦‚å¿µï¼Œæä¾›ä¸€å€‹åŸºæº–é»ï¼Œå¹«åŠ©æ¥ä¸‹ä¾†è¨è«–æ˜¯å¦å¯ä»¥ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿã€‚é€™é‚Šè¦å¼·èª¿ï¼Œå„²å­˜åº«çš„é¡å‹åƒç™¾ç¨®ï¼Œåº•å±¤çš„å„ç¨®å¯¦ä½œå·®ç•°éƒ½éå¸¸å¤§ï¼Œåº•ä¸‹çš„æ¨¡å‹æ˜¯åŸºæ–¼ cassandra ä½†ä¸æœƒèµ°å¤ªå¤šç´°ç¯€ã€‚ cassandra çš„è¦æ ¼æœ‰æ©Ÿæœƒå†ç´°èŠã€‚&lt;/p&gt;
&lt;p&gt;ç•¶å¾Œç«¯æ‡‰ç”¨å·²ç¶“é †åˆ©æ°´å¹³æ‹“å±•ä¹‹å¾Œï¼Œæ•´é«”æœå‹™çš„æ•ˆèƒ½ç“¶é ¸å¾€å¾€éƒ½å£“åœ¨å¾Œç«¯ DB ä¸Šã€‚é€™äº›ä¸åŒçš„ DB é¢å‘ä¸åŒçš„éœ€æ±‚ï¼Œç•¶éœ€æ±‚ç¬¦åˆæ™‚ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨é€™äº›è§£æ±ºæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šè¦å¼·èª¿ï¼Œä¸æ˜¯æ”¾æ£„ç¾æœ‰çš„ RDBMS ï¼Œå®Œå…¨ç§»è½‰åˆ°æ–°çš„è³‡æ–™åº«ï¼Œé€™æ¨£çš„æˆæœ¬å¤ªé«˜ï¼Œä¹Ÿæ²’æœ‰å¿…è¦æ€§ã€‚æ›´å¥½çš„åšæ³•ï¼Œæ˜¯æ­é…æ—¢æœ‰çš„é—œè¯æ€§è³‡æ–™åº«ï¼Œå°‡ä¸æ˜¯æ ¸å¿ƒæ¥­å‹™çš„è³‡æ–™è™•ç†æŠ½å‡ºï¼Œç§»è½‰åˆ°åˆé©çš„è³‡æ–™åº«ä¸Šã€‚è®“ä¸åŒéœ€æ±‚çš„è³‡æ–™å„²å­˜åˆ°æ›´åˆé©çš„å„²å­˜åº«ï¼Œæ˜¯é€™æ®µè©±è¦å¼·èª¿çš„é‡é»ï¼Œé—œé€£å¼è³‡æ–™åº«ä¹Ÿä¸æ˜¯å”¯ä¸€é¸æ“‡ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†æ•£å¼çš„è³‡æ–™åº«æœ‰ä»¥ä¸‹ç‰¹å¾µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†æ•£å¼ç¯€é»é›†ç¾¤ (Cluster)ï¼šè³‡æ–™åº«æ˜¯å¤šå€‹ç¯€é»å…±å­˜ï¼Œè€Œé single master, multiple slaves çš„æ¶æ§‹
&lt;ul&gt;
&lt;li&gt;é…åˆå…±è­˜ç®—æ³• (consensus algorithm) æºé€šç¯€é»ä¹‹é–“çš„è³‡è¨Š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç„¡å–®é»éŒ¯èª¤ (Single-point failure)ï¼še.g. ä¸æœƒå› ç‚º master éŒ¯èª¤å°è‡´æ•´å€‹æœå‹™å¤±æ•ˆ&lt;/li&gt;
&lt;li&gt;é«˜å¯ç”¨(High Availitilityï¼šå¯ä»¥æ‰¿å—é›†ç¾¤ä¸­ä¸€å®šæ•¸é‡è™›æ“¬æ©Ÿæ•…éšœï¼Œæœå‹™ä»ç„¶å¯ç”¨&lt;/li&gt;
&lt;li&gt;è³‡æ–™ sharding åˆ°ä¸åŒç¯€é»ä¸Š&lt;/li&gt;
&lt;li&gt;è¤‡æœ¬ (replica)
&lt;ul&gt;
&lt;li&gt;ç¯€é»è¤‡æœ¬ (node replicas)ï¼šå¤šå€‹ç¯€é»æä¾›æœå‹™ï¼Œæä¾›æµé‡çš„å¸¶å¯¬èˆ‡å¯ç”¨æ€§&lt;/li&gt;
&lt;li&gt;è³‡æ–™è¤‡æœ¬ (data replicas)ï¼šåœ¨å¤šå€‹ç¯€é»ä¸Šå„²å­˜è³‡æ–™ï¼Œæä¾›è³‡æ–™çš„å‚™ä»½ï¼ŒåŒæ™‚ä¹Ÿæä¾›è®€å–å¸¶å¯¬èˆ‡å¯ç”¨æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾ä»¥ä¸Šç‰¹å¾µä¾†èªªï¼Œä½¿ç”¨æ­¤æ¶æ§‹çš„æœå‹™å¯ä»¥æ‰¿å—å…ˆå è™›æ“¬æ©Ÿçš„ä¸å®šæ™‚çµ‚æ­¢ï¼Œæˆ–è¨±å¯ä»¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¯¦å‹™ä¸Šæœ‰éå¸¸å¤šéœ€è¦æ³¨æ„ï¼Œéœ€è¦ä¾æ“šå„è‡ªæœå‹™çš„æ€§è³ªï¼Œå„è‡ªè™•ç†ã€‚å¸¸è¦‹çš„å•é¡Œèˆ‰ä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‡‰ç”¨å¯ä»¥å®¹éŒ¯ (fault-tolerent)ï¼Œç„¶è€ŒéŒ¯èª¤ç™¼ç”Ÿå¾Œï¼Œæœƒéœ€è¦æ¶ˆè€—å¾©åŸæˆæœ¬ï¼Œä¾‹å¦‚é‡å•Ÿå¾Œéœ€è¦èŠ±æ™‚é–“åˆå§‹åŒ–ï¼Œæˆ–æ˜¯åœ¨å¤šç¯€é»ä¸Šé€²è¡Œ data rebalanceã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥æ‰¿å—çªç„¶çš„éŒ¯èª¤ï¼Œä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿï¼Œè®Šæˆæ¯æ—¥å›ºå®šæœƒæ‰¿å—å¿…ç„¶çš„éŒ¯èª¤ã€‚é€™è£¡çŠ§ç‰²äº†éƒ¨åˆ†ç®—åŠ›ï¼Œç”šè‡³é€ æˆéš±æ€§çš„ç¶­è­·æˆæœ¬ï¼Œæœ€å¾Œæ˜¯å¦ç¬¦åˆç¯€çœæˆæœ¬çš„éœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éƒ½æ˜¯éœ€è¦ä»”ç´°äº†è§£è§£æ±ºæ–¹æ¡ˆï¼Œä¸¦ä¸”åˆ†æéœ€æ±‚ï¼Œä¾†è©•ä¼°æ˜¯å¦æœ‰åˆä¹æˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&#34;gke&#34;&gt;GKE&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸Šåˆ†æäº†ä¸‰ç¨®å¸¸è¦‹éœ€æ±‚ä¾‹å­ï¼šå¾ batch jobï¼Œuser-facing serviceï¼Œèˆ‡ distributed databaseã€‚æ˜å¤©æœƒå¯¦éš›æ¬å‡º GKE èˆ‡ GCP Preemptible Instance çš„æŠ€è¡“è¦æ ¼ï¼Œèˆ‡å¤§å®¶å¯¦éš›è¨è«–ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gcp Preemptible Instance</title>
      <link>https://chechia.net/zh-hant/post/2020-09-21-gcp-preemptible-instance/</link>
      <pubDate>Mon, 21 Sep 2020 09:22:17 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-21-gcp-preemptible-instance/</guid>
      <description>&lt;h1 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h1&gt;
&lt;p&gt;éµäººè³½çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œè¦å¸¶ä¾†å…¬æœ‰é›²çœéŒ¢ç³»åˆ—æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;æ¶æ§‹çš„æˆæœ¬ï¼Œå¾ˆå¤šæ™‚å€™æœƒå½±éŸ¿æ¶æ§‹çš„è¨­è¨ˆèˆ‡éœ€æ±‚ã€‚å…¬å¸çš„ç‡Ÿé‹éƒ½éœ€è¦åœ¨æˆæœ¬èˆ‡éœ€æ±‚ä¹‹å‰å¹³è¡¡ï¼Œæˆæœ¬å…¶å¯¦æ˜¯å½±éŸ¿å…¬å¸æ±ºç­–çš„é‡è¦å› ç´ ã€‚èº«ç‚ºæ¶æ§‹ç®¡ç†å“¡ï¼Œæ‡‰è©²è¦è©¦è‘—é‡åŒ–ä¸¦ä¸”é€²è¡Œæˆæœ¬ç®¡ç†ï¼Œæå‡ºè§£æ±ºæ–¹æ¡ˆæ™‚ï¼Œä¹Ÿéœ€è¦æ€è€ƒå¦‚ä½•å¹«å…¬å¸é–‹æºç¯€æµã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ˜§æ¶ˆæ¸›æ¶æ§‹çš„æˆæœ¬ä¹Ÿæœªå¿…æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Œå¸³é¢ä¸Šæ¶ˆæ¸›çš„æˆæœ¬æœ‰æ™‚ä¹Ÿæœƒåæ˜ åœ¨å…¶ä»–åœ°æ–¹ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨æ¯”è¼ƒä¾¿å®œçš„è§£æ±ºæ–¹æ¡ˆï¼Œæˆ–æ˜¯è¼ƒä½çš„ç®—åŠ›ï¼Œä½†å»é€ æˆç¶­é‹éœ€è¦èŠ±æ›´å¤šæ™‚é–“ç¶­è­·ï¼Œé€ æˆéš±æ€§çš„äººåŠ›æˆæœ¬æ¶ˆè€—ã€‚ç”¨ä»€éº¼æ›¿ä»£æ–¹æ¡ˆ (trade-off) çœäº†é€™äº›éŒ¢ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes æ˜¯ä¸€å€‹å¾ˆå¥½çš„ä¾‹å­ï¼šä¾‹å¦‚ï¼šæœ‰äººèªªã€ŒKubernetes å¯ä»¥çœéŒ¢ã€ï¼Œä½†ä¹Ÿæœ‰äººèªªã€ŒKubernetes ç”¢ç”Ÿçš„ Overhead å¤ªé‡æœƒè™§éŒ¢ã€ã€‚&lt;/p&gt;
&lt;p&gt;ã€Œè¦ä¸è¦å°å…¥ Kubernetes æ˜¯ä¸€å€‹å¥½å•é¡Œã€ã€‚æ‡‰è©²å›æ­¸åŸºæœ¬çš„éœ€æ±‚ï¼Œäº†è§£éœ€æ±‚æ˜¯ä»€éº¼ã€‚ä¾‹å¦‚ï¼šGoogle ç•¶åˆé–‹ç™¼å®¹å™¨ç®¡ç†å¹³å°ï¼Œæ˜¯é¢å°ä»€éº¼æ¨£çš„ä½¿ç”¨éœ€æ±‚ï¼Œæœ€çµ‚é–‹ç™¼å‡º Kubernetesï¼Œå„ä½å¯ä»¥å›é¡§å‰ç¯‡æ–‡ç« ã€ŒBorg Omega and Kuberneteï¼ŒKubernetes çš„å‰æ—¥ä»Šç”Ÿï¼Œèˆ‡ Google åé¤˜å¹´çš„å®¹å™¨åŒ–æŠ€è¡“ã€ï¼Œå¾ Google çš„è§’åº¦ç†è§£å®¹å™¨ç®¡ç†å¹³å°ï¼Œåæ€è‡ªèº«åœ˜éšŠçš„å¯¦éš›éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;é€™å¥—è§£æ±ºæ–¹æ¡ˆæ˜¯å¦çœŸçš„é©åˆåœ˜éšŠï¼Œè§£æ±ºæ–¹æ¡ˆå¸¶ä¾†çš„æ•ˆæœåˆ°åº•æ˜¯æ€æ¨£å‘¢ï¼Ÿå¸Œæœ›çœ‹å®Œé€™ç³»åˆ—æ–‡ç« å¾Œï¼Œèƒ½å¹«åŠ©å„ä½ï¼Œå¾æˆæœ¬é¢æ€è€ƒé€™äº›é‡è¦çš„å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¯‡ä½¿ç”¨ GCP çš„åŸå› ï¼Œé™¤äº†æ˜¯æˆ‘æœ€ç†Ÿæ‚‰çš„å…¬æœ‰é›²å¤–ï¼Œä¹Ÿæ˜¯å› ç‚º GCP æä¾›çš„å…è²»é¡åº¦ï¼Œè®“æˆ‘å¯ä»¥å¾ˆè¼•é¬†åœ°ä½œç‚ºç¤¾ç¾¤æ–‡ç« çš„ Demoï¼Œå¦‚æœæœ‰åˆ¥å®¶é›²å¹³å°æœ‰æä¾›ç›¸åŒæ–¹æ¡ˆï¼Œè«‹ç•™è¨€å‘Šè¨´æˆ‘ï¼Œæˆ‘å¯èƒ½å°±æœƒå¤šé–‹å¹¾å®¶ä¸åŒçš„ç¯„ä¾‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…ˆå è™›æ“¬æ©Ÿ-tldr&#34;&gt;å…ˆå è™›æ“¬æ©Ÿ TL;DR&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿç‚ºéš¨é¸è™›æ“¬æ©Ÿå®šåƒ¹çš„ 2-3 æŠ˜ï¼Œä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿå¯èƒ½å¯ä»¥ç¯€çœ 7 æˆçš„é›²å¹³å°æ”¯å‡º&lt;/li&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿæ¯”èµ·éš¨é¸è™›æ“¬æ©Ÿï¼Œå¤–åŠ æœ‰è«¸å¤šé™åˆ¶ï¼Œe.g. æœ€é•·å£½å‘½ 24 hrã€é›²å¹³å°æœƒä¸»å‹•çµ‚æ­¢å…ˆå è™›æ“¬æ©Ÿ&amp;hellip;ç­‰&lt;/li&gt;
&lt;li&gt;é…åˆä½¿ç”¨è‡ªå‹•æ°´å¹³æ“´å±• (auto-scaler)ï¼Œè®“èˆŠçš„å…ˆå è™›æ“¬æ©Ÿå›æ”¶çš„åŒæ™‚ï¼Œå»è³¼è²·æ–°çš„å…ˆå è™›æ“¬æ©Ÿ&lt;/li&gt;
&lt;li&gt;é…åˆå¯å®¹éŒ¯ (fault-tolerent) çš„åˆ†æ•£å¼æ‡‰ç”¨ï¼Œè®“æ‡‰ç”¨å¯ä»¥ç„¡ç—›åœ¨è™›æ“¬æ©Ÿåˆ‡æ›è½‰ç§»ï¼Œä¸å½±éŸ¿æœå‹™&lt;/li&gt;
&lt;li&gt;è¦è®“æ‡‰ç”¨å¯ä»¥å®¹éŒ¯ï¼Œéœ€è¦åšéå¸¸å¤šäº‹æƒ…&lt;/li&gt;
&lt;li&gt;æ­é… kubernetes ï¼Œè‡ªå‹•åŒ–ç®¡ç†ä¾†ç°¡åŒ–å·¥ä½œ&lt;/li&gt;
&lt;li&gt;é…åˆæ­£ç¢ºçš„è¨­å®šï¼Œå¯ä»¥ç©©å®šçš„åŸ·è¡Œæœ‰ç‹€æ…‹çš„åˆ†æ•£å¼è³‡æ–™åº«æˆ–å„²å­˜åº«&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–æ˜¯çœ‹ Google å®˜æ–¹ Blogï¼š&lt;a href=&#34;https://cloud.google.com/blog/products/containers-kubernetes/cutting-costs-with-google-kubernetes-engine-using-the-cluster-autoscaler-and-preemptible-vms&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cutting costs with Google Kubernetes Engine: using the cluster autoscaler and Preemptible VMs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é è¨ˆå…§å®¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€æ±‚å‡è¨­ã€é‡æ¸…éœ€æ±‚ï¼Œä¸¦ä¸”ç²¾æº–è¨ˆåƒ¹&lt;/li&gt;
&lt;li&gt;ç²¾æº–è¨ˆåƒ¹ä½¿ç”¨å…ˆå è™›æ“¬æ©Ÿçš„ç¯€çœæˆæœ¬&lt;/li&gt;
&lt;li&gt;å…ˆå è™›æ“¬æ©Ÿçš„è¦æ ¼ã€é¡å¤–é™åˆ¶&lt;/li&gt;
&lt;li&gt;é¡å¤–é™åˆ¶ï¼Œé€ æˆæŠ€è¡“è¦å¤šåšå¾ˆå¤šé¡å¤–çš„äº‹æƒ…&lt;/li&gt;
&lt;li&gt;å¯¦å‹™ç¶“é©—åˆ†äº«ï¼šAPI server&lt;/li&gt;
&lt;li&gt;å¯¦å‹™ç¶“é©—ï¼šå¾ä½¿ç”¨éš¨é¸è™›æ“¬æ©Ÿï¼Œç§»è½‰åˆ°å…ˆå è™›æ“¬æ©Ÿï¼Œå…¬å¸å¯¦éš›å°å…¥ç¶“é©—&lt;/li&gt;
&lt;li&gt;å¯¦å‹™ç¶“é©—ï¼šElasticsearch&lt;/li&gt;
&lt;li&gt;å¯¦å‹™ç¶“é©—åˆ†äº«ï¼šå…¶ä»–åˆ†æ•£å¼è³‡æ–™åº«ï¼Œä¹Ÿè¨±æ˜¯ Cassandra æˆ–æ˜¯ cockroachDB&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šé¢çš„å…§å®¹ä¸æ›‰å¾—æœƒå¯«å¹¾ç¯‡çœ‹æ„Ÿè¦º XD&lt;/p&gt;
&lt;p&gt;æœ‰å¯«ééµäººè³½çš„éƒ½çŸ¥é“ 30 ç¯‡çœŸçš„å¾ˆæ¼«é•·ï¼Œä¸€ç¯‡æ–‡ç« å¹¾åƒå­—ï¼Œéƒ½è¦èŠ±å¥½å¹¾å€‹å°æ™‚ã€‚æˆ‘å»å¹´å¾ŒåŠï¼ŒçœŸçš„éƒ½æœƒçœ‹è®€è€…çš„ç•™è¨€è·ŸæŒ‰è®šï¼Œå–æš–ä¸€æ³¢ï¼Œæ‰æœ‰å‹•åŠ›ç¹¼çºŒå¯«ã€‚ç•™è¨€çš„äººå¤šå°±æœƒå¤šå¯«ï¼Œç•™è¨€çš„äººå°‘å°±æœƒå°‘å¯«ï¼Œå„ä½è¦ºå¾—æ–‡ç« é‚„çœ‹å¾—ä¸‹å»ï¼Œè«‹å‹™å¿…ä¾†æˆ‘ç²‰å°ˆæŒ‰è®šç•™å€‹è¨€ï¼Œä¸ç®¡æ˜¯æ¨æ¨ã€é­é­ã€æˆ–æ˜¯æœ‰æƒ³çœ‹çš„æ–‡ç« ä¾†è¨±é¡˜ï¼Œéƒ½ååˆ†æ­¡è¿ã€‚æœ‰ä½ å€‘çš„æ”¯æŒï¼Œæˆ‘æ‰æœ‰å‹•åŠ›ç¹¼çºŒå¯«ã€‚&lt;/p&gt;
&lt;p&gt;è«‹å¤§å®¶å‹™å¿…ä»¥å¯¦éš›è¡Œå‹•æ”¯æŒå¥½æ–‡ç« ï¼Œä¸è¦è®“åŠ£å¹£é©…é€è‰¯å¹£ã€‚ä¸ç„¶ iThome ä¸Šé¢ä¹‹å¾Œåªå‰©æ´—è§€çœ‹æ•¸çš„ç†±é–€æ–‡ç« äº† XD&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶ï¼Œæ²’äººç•™è¨€æˆ‘å°±æœƒç•¶ä½œè‡ªå·±æ‰æ˜¯åƒåœ¾æ–‡ (è‡ªçŸ¥ä¹‹æ˜XD)ï¼Œå°±æœƒæ”¶ä¸€æ”¶å›å®¶åš•è²“ç¡è¦ºï¼Œæ°æ°~&lt;/p&gt;
&lt;p&gt;-&amp;gt;æˆ‘çš„ç²‰å°ˆï¼Œç­‰ä½ ä¾†ç•™è¨€&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Borg Omega and Kubernetes Translation å…¨æ–‡ç¿»è­¯</title>
      <link>https://chechia.net/zh-hant/post/2020-09-12-borg-omega-and-kubernetes/</link>
      <pubDate>Sat, 12 Sep 2020 13:50:52 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-12-borg-omega-and-kubernetes/</guid>
      <description>&lt;h1 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h1&gt;
&lt;p&gt;é€™æ˜¯åŸæ–‡å®Œæ•´ç‰ˆæœ¬ã€‚å¤ªé•·ä¸è®€ (TL;DR) è«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-08-26-borg-omega-and-kubernetes-tldr/&#34;&gt;Borg Omega and Kubernetes å‰ä¸–ä»Šç”Ÿæ‘˜è¦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åŸæ–‡ï¼šhttps://storage.googleapis.com/pub-tools-public-publication-data/pdf/44843.pdf&lt;/p&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;p&gt;åœ¨ container æŠ€è¡“å¤¯èµ·ä¾†å‰ï¼ŒGoogle å·²ç¶“åšäº† container åå¹¾å¹´ï¼Œéç¨‹ä¸­ç™¼å±•å‡ºéœ€ä¸‰å¥—å®¹å™¨ç®¡ç†ç³»çµ±ã€‚é›–ç„¶æ¯ä¸€ä»£ç³»çµ±çš„é–‹ç™¼éœ€æ±‚ä¸åŒï¼Œä½†æ¯ä¸€ä»£éƒ½æ·±å—ä¸Šä¸€ä»£å½±éŸ¿ã€‚é€™ç¯‡æ–‡ç« æè¿° Google é–‹ç™¼é€™äº›ç³»çµ±æ™‚ï¼Œå­¸åˆ°çš„ç¶“é©—ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€å¥— container management ç³»çµ±æ˜¯ Borgï¼Œç‚ºäº†ç®¡ç† 1. é•·æœŸåŸ·è¡Œçš„æœå‹™ 2. æ‰¹æ¬¡çš„çŸ­æœŸå·¥ä½œ (batch job)ï¼ŒåŸæœ¬åˆ†åˆ¥æ˜¯ç”± Babysitter èˆ‡ Global Work Queue å…©å¥—ç³»çµ±åˆ†é–‹ç®¡ç†ã€‚å¾Œè€…çš„æ¶æ§‹æ·±åˆ»å½±éŸ¿ Borgï¼Œä½† Global Work Queue å°ˆæ³¨æ–¼ batch jobã€‚å…©å¥—ç³»çµ±éƒ½åœ¨ Linux control groups ä¹‹å‰ã€‚Borg å°‡ä¸Šè¿°å…©ç¨®æ‡‰ç”¨æ”¾åœ¨å…±äº«çš„æ©Ÿå™¨ä¸Šï¼Œä¾†å¢åŠ è³‡æºçš„ä½¿ç”¨ç‡ï¼Œä»¥ç¯€çœæˆæœ¬ã€‚é€™ç¨®å…±äº«åŸºæ–¼æ”¯æ´ container çš„ Linux Kernel (Google ä¹Ÿè²¢ç»è¨±å¤š Linux kernel container ç¨‹å¼ç¢¼)ï¼Œæä¾›æ›´å¥½çš„éš”é›¢ (isolation) çµ¦å»¶é²æ•æ„Ÿçš„ä½¿ç”¨è€…æœå‹™ (latency-sentitive user-facing services)ï¼Œä»¥åŠæ¶ˆè€—å¤§é‡ cpu çš„ batch ç¨‹å¼ã€‚&lt;/p&gt;
&lt;p&gt;è¶Šä¾†è¶Šå¤šæ‡‰ç”¨éƒ½åœ¨ Borg ä¸Šé–‹ç™¼åŸ·è¡Œï¼Œ Google çš„æ‡‰ç”¨èˆ‡ infratructure åœ˜éšŠé–‹ç™¼è¨±å¤šå·¥å…·èˆ‡æœå‹™ï¼Œå½¢æˆ Borg ç”Ÿæ…‹ç³»ã€‚é€™äº›ç³»çµ±æä¾›è¨­å®š (configure) èˆ‡æ›´æ–° (update) å·¥ä½œã€é æ¸¬è³‡æºéœ€æ±‚ã€å‹•æ…‹æ¨é€è¨­å®šåˆ°åŸ·è¡Œä¸­çš„å·¥ä½œã€æœå‹™ç™¼ç¾ (service discovery) èˆ‡è² è¼‰å‡è¡¡ (Load balancing)ï¼Œç­‰ç­‰åŠŸèƒ½ã€‚é€™äº›ç”Ÿæ…‹ç³»çš„é–‹ç™¼åŸºæ–¼ Google ä¸åŒåœ˜éšŠçš„éœ€æ±‚ï¼Œç”¢ç”Ÿä¸€å€‹ä¸åŒèµ·æº (heterogeneous)ã€åªé‡å°å„åˆ¥éœ€æ±‚çš„ (ad-hoc) ä¸€å€‹å †ä¸åŒç³»çµ±ï¼ŒBorg çš„ä½¿ç”¨è€…éœ€è¦ä½¿ç”¨ä¸åŒçš„ç¨‹å¼èªè¨€èˆ‡ç¨‹åºï¼Œä¾†èˆ‡é€™äº›ç³»çµ±äº’å‹•ã€‚Borg ä»ç„¶æ˜¯ Google ä¸»è¦çš„å®¹å™¨ç®¡ç†ç³»çµ±ï¼Œå› ç‚ºä»–è¦æ¨¡ (scale) å·¨å¤§ï¼ŒåŠŸèƒ½å¤šæ¨£ï¼Œè€Œä¸”æ¥µåº¦å …å›º (robustness)ã€‚&lt;/p&gt;
&lt;p&gt;Omega æ˜¯ Borg çš„ä¸‹ä¸€ä»£ï¼Œç›®çš„æ˜¯æ”¹å–„ Borg ç”Ÿæ…‹ç³»çš„è»Ÿé«”å·¥ç¨‹ã€‚Omega æ‰¿è¥²è¨±å¤š Borg æ¸¬è©¦æˆåŠŸçš„æ¨¡å¼ï¼Œä½†ä¸åŒæ–¼ Borgï¼ŒOmega æœ‰å®Œæ•´çš„æ¶æ§‹è¨­è¨ˆï¼Œæ•´é«”æ›´åŠ ä¸€è‡´ã€‚Omega å°‡é›†ç¾¤ç‹€æ…‹ (cluster state) å­˜æ”¾åœ¨ä¸­å¿ƒåŒ– (centralized)ã€åŸºæ–¼ Paxos ç®—æ³•ã€äº¤æ˜“å°å‘ (transaction-oriented) çš„å„²å­˜ç³»çµ±ï¼Œè®“é›†ç¾¤çš„æ§åˆ¶é¢æ¿ (control panel) å­˜å–ï¼Œä¾‹å¦‚ schedulerã€‚Omega ä½¿ç”¨æ¨‚è§€çš„ä½µç™¼æ§åˆ¶ (optimistic concurrency control) ä¾†è™•ç†å¶ç™¼çš„è¡çªï¼Œé€™ä¸€å±¤è§£è—• (decoupling) çš„è¨­è¨ˆï¼Œä½¿å¾—åŸå…ˆçš„ Borgmaster çš„åŠŸèƒ½å¯ä»¥æ‹†åˆ†æˆå¤šå€‹å…ƒä»¶ï¼Œå–ä»£åŸæœ¬å–®ä¸€ (monolithic) é›†ä¸­ (centralized) çš„ masterï¼Œè¢«æ‰€æœ‰è®Šæ›´è«‹æ±‚å µå¡ã€‚è¨±å¤š Omage æˆåŠŸçš„å‰µæ–°ä¹Ÿæœƒè¢«è¿­ä»£å›å» Borg ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰å¥— Google é–‹ç™¼çš„å®¹å™¨ç®¡ç†ç³»çµ±æ˜¯ Kubernetesï¼Œé€™æ™‚å¤–ç•Œå·¥ç¨‹å¸«ä¹Ÿé–‹å§‹å° Linux å®¹å™¨æœ‰èˆˆè¶£ï¼Œè€Œ Google åŒæ™‚åœ¨é–‹ç™¼ä¸¦æ¨å±•è‡ªå·±çš„å…¬æœ‰é›²æ¶æ§‹ã€‚Kubernetes åœ¨é€™æ¨£çš„èƒŒæ™¯ä¸‹æ§‹æ€ä¸¦é–‹ç™¼ã€‚èˆ‡ Borg åŠ Omega ä¸åŒï¼ŒKubernetes æ˜¯é–‹æºè»Ÿé«”ï¼Œä¸é™æ–¼ Google å…§éƒ¨é–‹ç™¼ã€‚Kubernetes å…§éƒ¨æœ‰å…±äº«çš„æŒä¹…å±¤å„²å­˜ (persistent store)ï¼Œæœå‹™å…ƒä»¶æŒçºŒç›£æ¸¬æœ‰é—œç‰©ä»¶ï¼Œèˆ‡ Omega é¡ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼ŒOmega å…è¨±ä¿¡ä»»çš„æ§åˆ¶é¢æ¿çš„å…ƒä»¶ç›´æ¥å­˜å–å„²å­˜åº«ï¼ŒKubernetes å‰‡é€é domain-specific çš„ REST API å­˜å–ï¼Œä¾†æä¾›é«˜éš (higher-level) çš„ API ç‰ˆæœ¬æ§åˆ¶ã€é©—è­‰ã€èªæ„è™•ç† (semantics)ã€ä»¥åŠå­˜å–æ”¿ç­– (policy)ï¼Œä¾†æ”¯æ´æ›´å»£æ³›çš„ç”¨æˆ¶ç«¯ã€‚æ›´é‡è¦çš„æ˜¯ Kubernetes è‘—é‡å·¥ç¨‹å¸«åœ¨ cluster ä¸Šé–‹ç™¼èˆ‡åŸ·è¡Œæ‡‰ç”¨çš„é«”é©—ï¼Œç°¡åŒ–è¤‡é›œåˆ†æ•£å¼ç³»çµ± (distributed system) çš„ç®¡ç†èˆ‡éƒ¨å±¬ (deploy)ï¼ŒåŒæ™‚ä»èƒ½é€éå®¹å™¨ä¾†æå‡è³‡æºçš„ä½¿ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« æè¿° Google å¾ Borg åˆ° Kubernetes ç²å¾—çš„çŸ¥è­˜èˆ‡ç¶“é©—ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å®¹å™¨-containers&#34;&gt;å®¹å™¨ (Containers)&lt;/h1&gt;
&lt;p&gt;å›é¡§æ­·å²ï¼Œç¬¬ä¸€å€‹å®¹å™¨åªæä¾› root file system (é€é chroot)ã€‚FreeBSD jail é€²ä¸€æ­¥å»¶ä¼¸å‡ºé¡å¤–çš„å‘½åç©ºé–“ (namespace) ä¾‹å¦‚ process IDã€‚Solaris å¤§å¹…åœ°æ¢ç´¢ç›¸é—œçš„æ–°åŠŸèƒ½ã€‚Linux control groups (cgroups) å¸æ”¶é€™äº›æƒ³æ³•ï¼Œç›´åˆ°ä»Šæ—¥ä»æŒçºŒé–‹ç™¼ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨æä¾›è³‡æºéš”é›¢ (resource isolation)ï¼ŒGoogle å¾—ä»¥å¤§å¹…æå‡è³‡æºä½¿ç”¨ç‡ (utilization) è¶…å‡ºç•¶æ™‚ç”¢æ¥­å¹³å‡å€¼ï¼Œä¾‹å¦‚ Borg ä½¿ç”¨å®¹å™¨ï¼Œå°‡æ‰¹æ¬¡æš«æ™‚å·¥ä½œã€èˆ‡é¢å°ç”¨æˆ¶éœ€è¦æ³¨æ„å»¶é²çš„æ‡‰ç”¨ï¼Œå…©è€…æ”¾åœ¨åŒæ¨£çš„ç‰©ç†æ©Ÿå™¨ä¸Šã€‚ç”¨æˆ¶æ‡‰ç”¨éœ€è¦é ç•™æ›´å¤šé¡å¤–çš„è³‡æºï¼Œä¾†è™•ç†çªç„¶ç”¢ç”Ÿçš„è² è¼‰é«˜å³° (load spikes) ä»¥åŠéŒ¯èª¤è™•ç† (fail-over) ï¼Œé€™äº›é ç•™çš„è³‡æºå¸¸å¸¸éƒ½ä¸æœƒç”¨åˆ°ï¼Œå¯ä»¥è½‰è®“æ‰¹æ¬¡å·¥ä½œä½¿ç”¨ã€‚å®¹å™¨æä¾›çš„è³‡æºç®¡ç†å·¥å…·å¯¦ç¾æ­¤é¡éœ€æ±‚ï¼Œkernel-level çš„è³‡æºéš”é›¢ä¹Ÿç¢ºä¿ç¨‹åºä¹‹é–“ä¸æœƒäº’ç›¸å¹²æ“¾ã€‚Google é–‹ç™¼ Borg ä¸­ï¼ŒåŒæ™‚ä¹Ÿæäº¤æ–°åŠŸèƒ½çµ¦ Linux å®¹å™¨ï¼Œä¾†æ»¿è¶³ä¸Šè¿°çš„éœ€æ±‚ã€‚ç„¶è€Œç›®å‰çš„éš”é›¢ä¸¦ä¸å®Œæ•´ï¼Œå¦‚æœ Linux kernel ä¸ç®¡ç†çš„è³‡æºï¼Œå®¹å™¨è‡ªç„¶ä¹Ÿç„¡æ³•æ ¼ç†ï¼Œä¾‹å¦‚ level-3 çš„è™•ç†å™¨å¿«å– (level-3 processor cache) èˆ‡è¨˜æ†¶é«”å¸¶å¯¬ (memory bandwith)ï¼Œå®¹å™¨é‚„éœ€è¦å¢åŠ ä¸€å±¤å®‰å…¨ä¿è­·å±¤ (ä¾‹å¦‚è™›æ“¬æ©Ÿå™¨ Virtual Machine) æ‰èƒ½å°ä»˜å…¬æœ‰é›²ä¸Šå‡ºç¾çš„æƒ¡æ„è¡Œç‚ºã€‚&lt;/p&gt;
&lt;p&gt;ç¾ä»£çš„å®¹å™¨ä¸åªæä¾›éš”é›¢æ©Ÿåˆ¶ï¼Œæ›´æä¾›æ˜ åƒæª” (image)ï¼Œåœ¨é€™å€‹æª”æ¡ˆä¸Šå»ºæ§‹å®¹å™¨çš„æ‡‰ç”¨ã€‚Google ä½¿ç”¨ Midas Package Manager (MPM) ä¾†å»ºæ§‹ä¸¦éƒ¨å±¬å®¹å™¨æ˜ åƒæª”ï¼Œéš”é›¢æ©Ÿåˆ¶èˆ‡ MPM package çš„é—œä¿‚ï¼Œå¯ä»¥å°æ¯” Docker daemon èˆ‡ Docker image registryã€‚é€™å€‹ç« ç¯€æè¿°çš„ã€Œå®¹å™¨ã€åŒæ™‚åŒ…å«å…©å€‹æ¦‚å¿µï¼šéš”é›¢ã€æ˜ åƒæª”ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ‡‰ç”¨å°å‘çš„æ¶æ§‹-application-oriented-infrastructure&#34;&gt;æ‡‰ç”¨å°å‘çš„æ¶æ§‹ (Application-oriented infrastructure)&lt;/h1&gt;
&lt;p&gt;éš¨è‘—æ™‚é–“è­‰æ˜ï¼Œå®¹å™¨ä¸åªèƒ½æä¾›é«˜éšçš„è³‡æºä½¿ç”¨ç‡ï¼Œå®¹å™¨åŒ– (containerization) ä½¿è³‡æ–™ä¸­å¿ƒ (data center) å¾åŸæœ¬æ©Ÿå™¨å°å‘ (machine-oriented) è®Šæˆæ‡‰ç”¨å°å‘ (application-oriented)ï¼Œé€™å€‹æ®µè½æä¾›å…©å€‹ä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¹å™¨å°è£ (encapsulate) æ‡‰ç”¨çš„ç’°å¢ƒ (environment)ï¼Œåœ¨æ©Ÿå™¨èˆ‡ä½œæ¥­ç³»çµ±çš„ç´°ç¯€ä¸Šï¼Œå¢åŠ ä¸€å±¤æŠ½è±¡å±¤ï¼Œè§£è—•å…©ä»¶äº‹æƒ…ï¼šæ‡‰ç”¨é–‹ç™¼ã€éƒ¨å±¬åˆ°æ¶æ§‹ã€‚&lt;/li&gt;
&lt;li&gt;è‰¯å¥½è¨­è¨ˆçš„å®¹å™¨èˆ‡æ˜ åƒæª”åªå°ˆæ³¨åœ¨å–®ä¸€å€‹æ‡‰ç”¨ï¼Œç®¡ç†å®¹å™¨æ„å‘³ç®¡ç†æ‡‰ç”¨ï¼Œè€Œä¸æ˜¯ç®¡ç†æ©Ÿå™¨ã€‚é€™é»å·®ç•°ä½¿å¾—ç®¡ç†çš„ APIï¼Œå¾æ©Ÿå™¨å°å‘è®Šæˆå½±ç”¨å°å‘ï¼Œå¤§å¹…åº¦çš„æ”¹å–„æ‡‰ç”¨çš„éƒ¨å±¬èˆ‡ç›£æ§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ‡‰ç”¨çš„ç’°å¢ƒ-application-environment&#34;&gt;æ‡‰ç”¨çš„ç’°å¢ƒ (Application environment)&lt;/h3&gt;
&lt;p&gt;åŸæœ¬ kernel å…§çš„ cgroupã€chrootã€èˆ‡å‘½åç©ºé–“ï¼Œæ˜¯ç”¨ä¾†ä¿è­·æ‡‰ç”¨ä¸è¢«æ—é‚Šå…¶ä»–æ‡‰ç”¨çš„é›œè¨Šå½±éŸ¿ã€‚å°‡é€™äº›å·¥å…·èˆ‡å®¹å™¨æ˜ åƒæª”ä¸€èµ·ä½¿ç”¨ï¼Œç”¢ç”Ÿä¸€å±¤æŠ½è±¡å±¤ï¼Œåˆ†é›¢æ‡‰ç”¨ã€èˆ‡åº•ä¸‹çš„ (å„ç¨®ä¸åŒå®¶çš„) ä½œæ¥­ç³»çµ±ã€‚è§£è—•æ˜ åƒæª”èˆ‡ä½œæ¥­ç³»çµ±ï¼Œé€²ä¸€æ­¥æä¾›ç›¸åŒçš„ç’°å¢ƒçµ¦é–‹ç™¼ç’°å¢ƒ (development) èˆ‡ç”Ÿç”¢ç’°å¢ƒ (production)ï¼Œé™ä½ç’°å¢ƒé–“çš„ä¸ä¸€è‡´æ€§é€ æˆçš„å•é¡Œï¼Œæœ€çµ‚æå‡é–‹ç™¼çš„å¯é ç¨‹åº¦ã€ä¸¦åŠ é€Ÿé–‹ç™¼çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å»ºæ§‹é€™å±¤æŠ½è±¡çš„é—œéµæ˜¯ï¼Œä½¿ç”¨å¯†é–‰çš„å®¹å™¨æ˜ è±¡æª” (hermetic container image) ï¼Œå°‡æ‰€æœ‰æ‡‰ç”¨æœ‰é—œçš„ä¾è³´ (dependencies) éƒ½æ‰“åŒ…ï¼Œæ•´åŒ…éƒ¨å±¬åˆ°å®¹å™¨ä¸­ã€‚æ­£ç¢ºåŸ·è¡Œçš„è©±ï¼Œå®¹å™¨å°å¤–éƒ¨çš„ä¾è³´åªå‰©ä¸‹ Linux kernel ç³»çµ±èª¿ç”¨ä»‹é¢ (system-call interface)ã€‚é€™å±¤ä»‹é¢å¤§å¹…æ”¹å–„æ˜ è±¡æª”çš„éƒ¨å±¬æ–¹ä¾¿æ€§ (protability)ï¼Œä½†ç›®å‰æ©Ÿåˆ¶ä»ä¸å®Œç¾ï¼Œæ‡‰ç”¨ä»ç„¶æš´éœ²åœ¨æŸäº›ä½œæ¥­ç³»çµ±çš„ä»‹é¢ä¸Šï¼Œç‰¹åˆ¥æ˜¯ socket optionsã€/procã€ä»¥åŠ ioctl çš„èª¿ç”¨åƒæ•¸ã€‚Google å¸Œæœ›é€éæ¨å»£é–‹æ”¾å®¹å™¨å€¡è­° (Open Container Initiative) ä¾†æ¸…æ¥šç•Œå®šï¼Œä¸Šè¿°ä»‹é¢èˆ‡å®¹å™¨çš„æŠ½è±¡å±¤ã€‚&lt;/p&gt;
&lt;p&gt;æ¬¡å¤–ï¼Œå®¹å™¨æä¾›çš„éš”é›¢èˆ‡æœ€å°ä¾è³´ï¼Œåœ¨ Google è­‰æ˜éå¸¸æœ‰æ•ˆï¼Œå®¹å™¨æ˜¯ Google æ¶æ§‹ä¸Šå”¯ä¸€çš„å¯åŸ·è¡Œå–®ä½ (runnable entity)ï¼Œé€²ä¸€æ­¥ä½¿ Google åªæä¾›å°‘æ•¸çš„ä½œæ¥­ç³»çµ±ç‰ˆæœ¬çµ¦æ‰€æœ‰æ©Ÿå™¨ï¼Œåªéœ€è¦å°‘æ•¸çš„ç¶­è­·äººå“¡ä¾†è² è²¬ç®¡ç†ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å¯†é–‰å®¹å™¨æ˜ æƒ³æª”æœ‰å¾ˆå¤šæ–¹å¼é”æˆï¼Œåœ¨ Borg å»ºæ§‹æ˜ æƒ³æª”æ™‚ï¼Œæ‡‰ç”¨çš„åŸ·è¡Œæª” (binary) éœæ…‹é€£çµåˆ°å¯ç”¨çš„ç¨‹åºåº« (library) ç‰ˆæœ¬ï¼Œç¨‹å¼åº«åœ¨å…¬å¸å…§éƒ¨å­˜æ”¾ã€‚è‡³æ­¤ Borg å®¹å™¨æ˜ åƒæª”é‚„ä¸æ˜¯å®Œå…¨å¯†é–‰ï¼Œåº•ä¸‹é‚„æœ‰ä¾è³´ä¸€å±¤åŸºåº•æ˜ è±¡æª” (base image)ï¼Œç›´æ¥äº‹å…ˆå®‰è£åˆ°æ©Ÿå™¨ä¸Šï¼Œè€Œä¸æ˜¯éš¨æ˜ åƒæª”éƒ¨å±¬ï¼ŒåŸºåº•æ˜ è±¡æª”åŒ…å«é€šç”¨å·¥å…·ä¾‹å¦‚ tar èˆ‡ libc ç¨‹å¼åº«ï¼Œå› æ­¤æ›´æ–°åŸºåº•æ˜ è±¡æª”ä»æœƒå½±éŸ¿æ‡‰ç”¨ï¼Œå¶çˆ¾æœƒç”¢ç”Ÿå¤§éº»ç…©ã€‚&lt;/p&gt;
&lt;p&gt;ç¾ä»£çš„å®¹å™¨æ˜ åƒæª”æ ¼å¼ï¼Œå¦‚ Docker èˆ‡ ACIï¼Œéƒ½åŠ å¼·é€™å±¤æŠ½è±¡ã€æä¾›æ›´ç·Šå¯†çš„å°è£ï¼Œç§»é™¤ç‰¹å®šä½œæ¥­ç³»çµ±çš„ä¾è³´æ€§ï¼Œä¸¦è¦æ±‚ä½¿ç”¨è€…åœ¨åˆ†äº«æ˜ è±¡æª”å…§å®¹æ™‚ï¼Œå¿…é ˆæ˜ç¢ºå®£å‘Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¹å™¨ä½œç‚ºç®¡ç†å–®ä½-container-as-the-unit-of-management&#34;&gt;å®¹å™¨ä½œç‚ºç®¡ç†å–®ä½ (Container as the unit of management)&lt;/h3&gt;
&lt;p&gt;åœç¹å®¹å™¨å»ºæ§‹ç®¡ç† APIï¼Œè€Œéåœç¹æ©Ÿå™¨ï¼Œä½¿å¾—è³‡æ–™ä¸­å¿ƒçš„ã€ŒPrimary keyã€å¾æ©Ÿå™¨è®Šæˆæ‡‰ç”¨ã€‚å¸¶ä¾†è¨±å¤šå¥½è™•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‡‰ç”¨å·¥ç¨‹å¸«èˆ‡ç¶­é‹åœ˜éšŠ (operation team) ä¸éœ€å†ç…©æƒ±æ©Ÿå™¨èˆ‡ä½œæ¥­ç³»çµ±çš„ç´°ç¯€&lt;/li&gt;
&lt;li&gt;æ¶æ§‹åœ˜éšŠ (infrastructure team) ç²å¾—æ›´å¤šå‡ç‰ˆæˆ–æ˜¯èª¿åº¦ç¡¬é«”çš„å½ˆæ€§ï¼Œå¯¦éš›å°æ‡‰ç”¨èˆ‡é–‹ç™¼åœ˜éšŠçš„å½±éŸ¿éå¸¸å°&lt;/li&gt;
&lt;li&gt;ç®¡ç†ç³»çµ±æ”¶é›†æ‡‰ç”¨çš„ç›£æ¸¬æ•¸æ“š (ä¾‹å¦‚ CPU èˆ‡ Memory ä½¿ç”¨ metrics)ï¼Œè€Œéæ©Ÿå™¨çš„ç›£æ¸¬æ•¸æ“šï¼Œç›´æ¥æå‡æ‡‰ç”¨çš„ç›£æ¸¬èˆ‡è‡ªæˆ‘æª¢æŸ¥ (introspection)ï¼Œç‰¹åˆ¥æ˜¯æ“´å±• (scale-up)ã€æ©Ÿå™¨éŒ¯èª¤ã€æˆ–æ˜¯ç¶­è­·æ™‚ï¼Œé€ æˆæ‡‰ç”¨ç§»åˆ°å…¶ä»–ä½ç½®æ™‚ï¼Œç›£æ¸¬ä¾ç„¶å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å®¹å™¨æä¾›è¨±å¤šåˆ‡å…¥é»çµ¦æ³›ç”¨ API (generic API)ï¼Œæ³›ç”¨ API ä½¿è³‡è¨Šåœ¨ç®¡ç†ç³»çµ±èˆ‡æ‡‰ç”¨ä¹‹é–“æµå‹•ï¼Œä½†å…¶å¯¦å…©è€…äº’ç›¸ä¸æ¸…æ¥šå°æ–¹çš„å¯¦ä½œç´°ç¯€ã€‚åœ¨ Borg ä¸­æœ‰ä¸€ç³»åˆ—çš„ API é€£çµåˆ°æ‰€æœ‰å®¹å™¨ï¼Œä¾‹å¦‚ /healthz ç«¯é»å›å ±æ‡‰ç”¨çš„å¥åº·ç¨‹åº¦çµ¦å”èª¿ç®¡ç†è€… (orchestrator)ï¼Œç•¶ç™¼ç¾ä¸å¥åº·çš„æ‡‰ç”¨ï¼Œè‡ªå‹•çµ‚æ­¢ä¸¦é‡å•Ÿæ‡‰ç”¨ã€‚é€™å€‹è‡ªå‹•ä¿®å¾©åŠŸèƒ½æ˜¯å¯é çš„åˆ†æ•£å¼ç³»çµ±çš„åŸºç¤ã€‚(Kubernetes ä¹Ÿæä¾›é¡ä¼¼åŠŸèƒ½ï¼Œé€é HTTP ç«¯é»æˆ–æ˜¯ exec command ä¾†æª¢æŸ¥å®¹å™¨å…§éƒ¨çš„æ‡‰ç”¨)&lt;/p&gt;
&lt;p&gt;å®¹å™¨æä¾›ã€æˆ–æ˜¯æä¾›çµ¦å®¹å™¨çš„è³‡è¨Šï¼Œå¯ä»¥é€éè¨±å¤šä½¿ç”¨è€…ä»‹é¢å‘ˆç¾ã€‚Borg æä¾›å¯ä»¥å‹•æ…‹æ›´æ–°çš„æ–‡å­—ç‹€æ…‹è¨Šæ¯ï¼ŒKubernetes æä¾› key-value çš„ annotation å­˜æ”¾åœ¨çµ¦å€‹ç‰©ä»¶çš„ metadataï¼Œé€™äº›éƒ½èƒ½æºé€šæ‡‰ç”¨ã€‚annotation å¯ä»¥æ˜¯å®¹å™¨è‡ªè¡Œè¨­å®šã€æˆ–æ˜¯ç”±ç®¡ç†ç³»çµ±è¨­å®š (ä¾‹å¦‚æ»¾å‹•æ›´æ–°ç‰ˆæœ¬æ™‚æ¨™è¨»æ–°ç‰ˆæœ¬)ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨ç®¡ç†ç³»çµ±å¯ä»¥å–å¾—å®¹å™¨å…§éƒ¨è¨Šæ¯ï¼Œä¾‹å¦‚è³‡æºä½¿ç”¨ç‹€æ³ã€å®¹å™¨çš„ metadataï¼Œä¸¦å‚³æ’­çµ¦æ—¥èªŒ (logging) æˆ–æ˜¯ç›£æ§ (monitoring)ï¼Œä¾‹å¦‚ä½¿ç”¨è€…åç¨±ã€ç›£æ§ä»»å‹™åç¨±ã€ç”¨æˆ¶èº«åˆ†ã€‚ç”šè‡³é€²ä¸€æ­¥åœ¨ç¯€é»ç¶­è­·æ™‚ï¼Œææ—©æä¾›å®‰å…¨çµ‚æ­¢ (graceful-termination) çš„è­¦ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨æœ‰å…¶ä»–æ–¹å¼å¯ä»¥æä¾›æ‡‰ç”¨å°å‘çš„ç›£æ¸¬ï¼Œä¾‹å¦‚ Linux Kernel cgroups æœƒæä¾›æ‡‰ç”¨çš„è³‡æºä½¿ç”¨ç‡ï¼Œé€™äº›è³‡è¨Šå¯ä»¥æ“´å±•ï¼Œä¸¦å°‡å®¢è£½åŒ–çš„ metrics æ§‹é HTTP API é€å‡ºã€‚åŸºæ–¼é€™äº›è³‡æ–™ï¼Œé€²ä¸€æ­¥é–‹ç™¼å‡ºæ³›ç”¨å·¥å…·å¦‚è‡ªå‹•æ“´å±• (auto-scaler) èˆ‡ cAdvisorï¼Œä»–å€‘ä¸éœ€è¦çŸ¥é“æ‡‰ç”¨çš„è¦æ ¼å°±å¯ä»¥è¨˜éŒ„ metricsã€‚ç”±æ–¼å®¹å™¨æœ¬èº«æ˜¯æ‡‰ç”¨ï¼Œå› æ¬¡ä¸éœ€è¦åœ¨å¯¦é«”æˆ–è™›æ“¬æ©Ÿå™¨ã€èˆ‡å¤šå€‹æ‡‰ç”¨ä¹‹é–“ï¼Œåšä¿¡è™Ÿå¤šå·¥è½‰ç™¼æˆ–å¤šè·¯åˆ†é… (multiplex / demultiplex signals)ã€‚é€™æ¨£æ›´ç°¡å–®ã€æ›´å …å›ºã€ä¸¦ä¸”å¯ä»¥ç”¢ç”Ÿç²¾åº¦æ›´é«˜çš„ metrics èˆ‡æ—¥èªŒï¼Œä¸¦æä¾›æ›´ç²¾ç´°çš„æ§åˆ¶æ“ä½œã€‚ä½ å¯ä»¥å°æ¯”ä½¿ç”¨ ssh ç™»å…¥æ©Ÿå™¨ï¼Œä¸¦ä¸”ä½¿ç”¨ top æŒ‡ä»¤ç›£æ¸¬ã€‚é›–ç„¶å·¥ç¨‹å¸«å¯ä»¥ ssh ç™»å…¥å®¹å™¨ï¼Œä½†å¾ˆå°‘éœ€è¦é€™æ¨£åšã€‚&lt;/p&gt;
&lt;p&gt;æ‡‰ç”¨å°å‘è®Šé·åœ¨ç®¡ç†æ¶æ§‹ä¸Šç”¢ç”Ÿæ›´å¤šå›éŸ¿ï¼Œç›£æ¸¬åªæ˜¯å…¶ä¸­ä¸€å€‹ã€‚Google çš„é™„è¼‰å‡è¡¡å™¨ (load balancer) ä¸å†æ ¹æ“šæ©Ÿå™¨åšé™„è¼‰å‡è¡¡ï¼Œè€Œæ˜¯æ ¹æ“šæ‡‰ç”¨å¯¦é«” (application instances)ã€‚æ—¥èªŒæœƒæ ¹æ“šæ‡‰ç”¨æ‰“ä¸Šæ¨™ç±¤ (key) è€Œä¸æ˜¯æ©Ÿå™¨ï¼Œå› æ­¤å¯ä»¥è·¨æ©Ÿå™¨çš„æ”¶é›†æ‰€æœ‰ç›¸åŒæ‡‰ç”¨çš„æ—¥èªŒï¼Œè€Œä¸æœƒå½±éŸ¿å…¶ä»–çš„æ‡‰ç”¨æ—¥èªŒæˆ–æ˜¯å½±åƒä½œæ¥­ç³»çµ±ã€‚æˆ‘å€‘å¯ä»¥æª¢æ¸¬æ‡‰ç”¨å¤±æ•ˆï¼Œæ›´å®¹æ˜“çš„æè¿°éŒ¯èª¤åŸå› ï¼Œä¸éœ€è¦å…ˆæ‹†è§£è™•ç†æ©Ÿå™¨çš„å„å±¤ä¿¡è™Ÿã€‚ç”±æ–¼å®¹å™¨å¯¦é«”çš„èº«åˆ†è³‡è¨Šï¼Œå¾åŸºç¤ä¸Šéƒ½æ˜¯ç”±å®¹å™¨ç®¡ç†ç³»çµ±æ§åˆ¶ï¼Œå·¥ç¨‹å¸«å¯ä»¥æ˜ç¢ºçš„æŒ‡å®šæ‡‰ç”¨çš„åŸ·è¡Œèº«åˆ†ï¼Œä½¿å¾—æ‡‰ç”¨æ›´å®¹æ˜“å»ºæ§‹ã€ç®¡ç†ã€é™¤éŒ¯ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œï¼Œé›–ç„¶ä¸Šè¿°éƒ½é‡å°å®¹å™¨èˆ‡æ‡‰ç”¨åœ¨ä¸€å°ä¸€çš„ç‹€æ³ä¸‹ï¼Œä½†å¯¦å‹™ä¸Šæˆ‘å€‘éœ€è¦å¥—è£çš„å®¹å™¨ç¾¤ (nested containers)ï¼Œé€™ç¾¤å®¹å™¨ä¸€èµ·æ’ç¨‹åˆ°ç›¸åŒæ©Ÿå™¨ä¸Šï¼Œæœ€å¤–å±¤çš„å®¹å™¨æä¾›è³‡æºï¼Œå…§å±¤çš„å®¹å™¨æä¾›éƒ¨å±¬çš„éš”é›¢ã€‚Borg ä¸­ï¼Œæœ€å¤–å±¤å®¹å™¨å«åšè³‡æºåˆ†é… (resource allocation or alloc)ï¼Œåœ¨ Kubernetes ä¸Šç¨±åš Podã€‚Borg å…è¨±æœ€ä¸Šå±¤çš„æ‡‰ç”¨ç›´æ¥è·‘åœ¨å¤–å±¤çš„ alloc ä¸Šï¼Œä½†é€™é»ç”¢ç”Ÿäº†ä¸€äº›ä¸ä¾¿ï¼Œæ‰€ä»¥é€™é»åœ¨ Kubernetes åšäº†èª¿æ•´ï¼Œæ‡‰ç”¨æ°¸é è·‘åœ¨æœ€å¤–å±¤ Pod çš„å…§éƒ¨ï¼Œå°±ç®—åªæœ‰å–®ä¸€ä¸€å€‹å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å€‹å¸¸è¦‹çš„ä½¿ç”¨æƒ…å¢ƒï¼Œæ˜¯ä¸€å€‹ Pod å…§éƒ¨è·‘ä¸€å€‹è¤‡é›œçš„æ‡‰ç”¨ï¼Œå¤§éƒ¨åˆ†çš„æ‡‰ç”¨éƒ½æ˜¯ä¸€å€‹ä¸€å€‹å­å®¹å™¨ (child containers)ï¼Œå…¶ä»–çš„å­å®¹å™¨å‰‡åŸ·è¡Œè¼”åŠ©å·¥å…·ï¼Œä¾‹å¦‚ log rotation æˆ–æ˜¯å°‡æ—¥èªŒç§»è½‰åˆ°åˆ†æ•£å¼æª”æ¡ˆç³»çµ±ã€‚å°æ¯”æŠŠä¸Šè¿°åŠŸèƒ½éƒ½æ‰“åŒ…åˆ° binary åŸ·è¡Œæª”ä¸­ï¼Œæ‹†åˆ†æ›´å®¹æ˜“è®“ä¸åŒåœ˜éšŠå„è‡ªé–‹ç™¼è² è²¬çš„åŠŸèƒ½ï¼Œæ‹†åˆ†é‚„æä¾›æ›´å¥½çš„è€ç”¨ç¨‹åº¦ (å°±ç®—ä¸»è¦æ‡‰ç”¨çµ‚æ­¢ï¼Œå­å®¹å™¨ä»èƒ½æˆåŠŸå°‡æ—¥èªŒç§»è½‰å‡ºå»)ï¼Œæ›´å®¹æ˜“çµ„è£æ‡‰ç”¨ (composability) (ç”±æ–¼æ¯å€‹æœå‹™éƒ½æ˜¯ç¨ç«‹é‹ä½œåœ¨å„è‡ªçš„å®¹å™¨ä¸­ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å¢åŠ æ–°çš„æ”¯æ´æœå‹™)ï¼Œæä¾›æ›´ç²¾ç´°çš„è³‡æºéš”é›¢ (æ‰€æœ‰å®¹å™¨è³‡æºéš”é›¢ï¼Œæ‰€ä»¥æ—¥èªŒæœå‹™ä¸æœƒæ¶å ä¸»è¦æ‡‰ç”¨çš„è³‡æºï¼Œåä¹‹äº¦ç„¶)ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å”èª¿ç®¡ç†åªæ˜¯é–‹å§‹è€Œä¸æ˜¯çµ‚é»-orchestration-is-the-beginning-not-the-end&#34;&gt;å”èª¿ç®¡ç†åªæ˜¯é–‹å§‹ï¼Œè€Œä¸æ˜¯çµ‚é» (Orchestration is the beginning, not the end)&lt;/h1&gt;
&lt;p&gt;Borg çš„åˆè¡·åªæ˜¯åˆ†é…ä¸åŒçš„å·¥ä½œé™„è¼‰ (workload) åˆ°ç›¸åŒçš„æ©Ÿå™¨ä¸Šï¼Œä¾†æå‡è³‡æºä½¿ç”¨ç‡ã€‚ç„¶è€Œ Borg ç”Ÿæ…‹ç³»ä¸­ï¼Œæ”¯æ´ç³»çµ±çš„å¿«é€Ÿæ¼”åŒ–ï¼Œè¡¨æ˜å®¹å™¨ç®¡ç†ç³»çµ±æœ¬èº«åªæ˜¯ä¸€å€‹èµ·é»ï¼šé€šå¾€ä¸€å€‹æ–°çš„åˆ†æ•£å¼ç³»çµ±é–‹ç™¼èˆ‡ç®¡ç†ç’°å¢ƒã€‚è¨±å¤šæ–°çš„ç³»çµ±åœ¨ Borg ä¸Šæ‰“é€ ã€åµŒå…¥ Borgã€æˆ–æ˜¯åœç¹ Borg æ‰“é€ ï¼Œæå‡ Borg çš„åŸºæœ¬å®¹å™¨ç®¡ç†æœå‹™ï¼Œåº•ä¸‹æ˜¯éƒ¨åˆ†æœå‹™æ¸…å–®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘½åèˆ‡æœå‹™ç™¼ç¾ (Naming and service discovery) Borg Name Service (BNS)&lt;/li&gt;
&lt;li&gt;ä¸»ç¯€é»é¸èˆ‰ (master election) ä½¿ç”¨ Chubby&lt;/li&gt;
&lt;li&gt;æ‡‰ç”¨æ„ŸçŸ¥çš„ (application-aware) çš„è² è¼‰å‡è¡¡&lt;/li&gt;
&lt;li&gt;è‡ªå‹•æ°´å¹³æ“´å±• (horizontal) èˆ‡å‚ç›´æ“´å±• (vertical)&lt;/li&gt;
&lt;li&gt;æ–°çš„åŸ·è¡Œæª”èˆ‡è¨­å®šæª”çš„æ»¾å‹•å‡ç´šå·¥å…· (rollout)&lt;/li&gt;
&lt;li&gt;å·¥ä½œæµç¨‹å·¥å…· (workflow) (ä¾‹å¦‚åœ¨ä¸åŒå·¥ä½œéšæ®µï¼ŒåŸ·è¡Œå¤šä»»å‹™çš„åˆ†æ pipeline)&lt;/li&gt;
&lt;li&gt;ç›£æ§å·¥å…·ï¼Œå¯ä»¥æ”¶é›†å®¹å™¨è³‡è¨Šã€æ•´åˆçµ±è¨ˆã€åœ¨ dashboard ä¸Šé¡¯ç¤ºã€ä¸¦å¯ä»¥è§¸ç™¼å‘Šè­¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›æœå‹™éƒ½æ˜¯ç”¨ä¾†è™•ç†é–‹ç™¼åœ˜éšŠé¢è‡¨çš„å•é¡Œï¼ŒGoogle é¸å‡ºæˆåŠŸçš„æœå‹™ä¸¦å»£æ³›çš„æ‡‰ç”¨ï¼Œè®“å·¥ç¨‹å¸«å·¥ä½œæ›´åŠ è¼•é¬†ã€‚ç„¶è€Œé€™äº›å·¥å…·å¤§å¤šå„è‡ªéœ€è¦ç‰¹åˆ¥çš„ (idiosyncratic) APIï¼Œä¾‹å¦‚éœ€è¦çŸ¥é“æª”æ¡ˆçš„ä½ç½®ï¼Œä¹Ÿéœ€è¦ Borg çš„æ·±åº¦æ•´åˆã€‚ç”¢ç”Ÿä¸€å€‹ä¸å¥½çš„å‰¯ä½œç”¨ï¼Œå°±æ˜¯éƒ¨å±¬ Borg ç”Ÿæ…‹ç³»è®Šå¾—æ›´è¤‡é›œäº†ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes è©¦åœ–é™ä½é€™äº›è¤‡é›œåº¦ï¼Œå› æ­¤å°å…¥ä¸€è‡´æ€§è¨­è¨ˆçš„ API (consistent API)ï¼Œä¾‹å¦‚æ¯å€‹ Kubernetes ç‰©ä»¶éƒ½æœƒæœ‰ä¸‰å€‹åŸºç¤å…§å®¹ï¼šObjectMetadataã€Specification (Spec)ã€ä»¥åŠ Statusã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ç‰©ä»¶çš„ ObjectMetadata éƒ½æ˜¯ä¸€æ¨£çš„ï¼ŒåŒ…å«ç‰©ä»¶çš„åç¨±ã€UIDã€ç‰©ä»¶çš„ç‰ˆæœ¬ (ä½œç‚ºæ¨‚è§€ä½µç™¼æ§åˆ¶ optimistic concurrency control æ™‚ä½¿ç”¨)ã€æ¨™ç±¤ (key-value label)ã€‚Spec èˆ‡ Status çš„å…§å®¹å› ç‰©ä»¶å‹åˆ¥æœ‰æ‰€ä¸åŒï¼Œä½†æ ¸å¿ƒæ¦‚å¿µä¸€è‡´ï¼šSpec æ˜¯æè¿°æœŸæœ›ç‹€æ…‹ (desired state)ï¼Œè€Œ Status æ˜¯ç´€éŒ„ç‰©ä»¶çš„ç•¶å‰ç‹€æ…‹ (current state)ã€‚&lt;/p&gt;
&lt;p&gt;çµ±ä¸€ API å¸¶ä¾†å¾ˆå¤šå¥½è™•ï¼Œå¾ç³»çµ±ç²å–è³‡è¨Šæ›´åŠ ç°¡å–®ï¼šæ‰€æœ‰ç‰©ä»¶éƒ½æœ‰ç›¸åŒçš„è³‡è¨Šï¼Œæ‰å¯ä»¥é–‹ç™¼æ‰€æœ‰ç‰©ä»¶éƒ½é©ç”¨çš„æ³›ç”¨å·¥å…·ï¼Œè€Œé€™é»æ›´é€²ä¸€æ­¥ï¼Œä½¿å·¥ç¨‹å¸«é–‹ç™¼çš„ä½¿ç”¨é«”é©—æ›´åŠ ä¸€è‡´ã€‚å¾ Borg èˆ‡ Omega ä¸­çš„ç¶“é©—å­¸ç¿’ï¼Œæ‰€ä»¥ Kubernetes æ˜¯ä¸€å †çµ„åˆçš„å€å¡Šæ‰“é€ è€Œæˆï¼Œä½¿ç”¨è€…é‚„å¯ä»¥è‡ªè¡Œæ“´å±•ã€‚æœ‰çµ±ä¸€çš„ API ä»¥åŠ object-metadata çµæ§‹è®“é€™ä»¶äº‹æ›´ç°¡å–®ã€‚ä¾‹å¦‚ Pod API ç”¨æˆ¶å¯ä»¥ä½¿ç”¨ã€Kubernetes å…§éƒ¨å…ƒä»¶ä¹Ÿä½¿ç”¨ã€å¤–éƒ¨çš„è‡ªå‹•åŒ–å·¥å…·ä¹Ÿä½¿ç”¨ã€‚ä¸€è‡´æ€§ç¹¼çºŒå»¶ä¼¸ï¼ŒKubernetes å…è¨±ç”¨æˆ¶å‹•æ…‹å¢åŠ å®¢è£½åŒ–çš„ APIï¼Œèˆ‡ Kubernetes æ ¸å¿ƒçš„ API ä¸€èµ·å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸€è‡´æ€§çš„ä¿ƒæˆä¹Ÿä»°è³´ Kubernetes è‡ªèº« API çš„è§£è—•ã€‚æŠŠå„è‡ªå…ƒä»¶çš„é¢å‘æ‹†é–‹ï¼Œè®“æ›´é«˜éšçš„æœå‹™å…±äº«ç›¸åŒçš„åº•å±¤åŸºç¤å¯¦ä½œã€‚ä¾‹å¦‚æ‹†åˆ† Kubernetes å‰¯æœ¬æ§åˆ¶å™¨ (replication controller) èˆ‡æ°´å¹³è‡ªå‹•æ“´å±•ç³»çµ± (horizontal auto-scaling system)ï¼Œå‰¯æœ¬æ§åˆ¶å™¨ç¢ºä¿ä¸€å€‹è…³è‰²çš„ (ex. å‰ç«¯ç¶²é ) å­˜åœ¨çš„æ•¸é‡ç¬¦åˆæœŸæœ›çš„æ•¸é‡ï¼Œè‡ªå‹•æ“´å±•å™¨å‰‡åŸºæ–¼å‰¯æœ¬æ§åˆ¶å™¨çš„åŠŸèƒ½ï¼Œåªå–®ç´”èª¿æ•´ Pods çš„æœŸæœ›ç‹€æ…‹ (desired state)ï¼Œè€Œä¸éœ€è² è²¬ Pod çš„å¢æ¸›ï¼Œè®“è‡ªå‹•æ“´å±•å™¨å¯ä»¥å¯¦ä½œæ›´å¤šä½¿ç”¨ä¸Šçš„éœ€æ±‚ï¼Œä¾‹å¦‚é æ¸¬ä½¿ç”¨ï¼Œä¸¦å¯ä»¥å¿½ç•¥åº•ä¸‹åŸ·è¡Œçš„å¯¦ä½œç´°ç¯€ã€‚&lt;/p&gt;
&lt;p&gt;API è§£è—•ä¹Ÿè®“è¨±å¤šé—œè¯ï¼Œä½†æ˜¯ä¸ç›¡ç›¸åŒçš„å…ƒä»¶æ§‹æˆè¿‘ä¼¼ã€‚ä¾‹å¦‚ Kubernetes æœ‰ä¸‰å€‹å½¢å¼çš„å‰¯æœ¬ Podï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ReplicationControllerï¼šæŒçºŒåŸ·è¡Œçš„å®¹å™¨å‰¯æœ¬ (ä¾‹å¦‚ web server)&lt;/li&gt;
&lt;li&gt;DaemonSetï¼šæ¯å€‹ç¯€é»éƒ½æœ‰ä¸€å€‹å¯¦é«” (ä¾‹å¦‚æ—¥èªŒæ”¶é›†å™¨)&lt;/li&gt;
&lt;li&gt;Jobï¼šåŸ·è¡Œåˆ°å·¥ä½œå®Œæˆçš„æ§åˆ¶å™¨ï¼ŒçŸ¥é“å¦‚ä½• (å¹³è¡Œçš„) å•Ÿå‹•å·¥ä½œåˆ°çµæŸå·¥ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é›–ç„¶æœ‰å„è‡ªçš„åŸ·è¡Œæ”¿ç­– (policy) ï¼Œä¸‰å€‹æ§åˆ¶å™¨éƒ½æœ‰ç›¸åŒçš„ Pod ç‰©ä»¶ï¼Œæè¿°å¸Œæœ›åŸ·è¡Œçš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€è‡´æ€§ä¹Ÿä»°è³´ Kubernetes å…§éƒ¨å…ƒä»¶çš„ç›¸åŒè¨­è¨ˆæ¨¡å¼ (design patterns)ã€‚æ§åˆ¶å™¨èª¿å’Œè¿´åœˆ (reconciliation controller loop) æ˜¯ Borgã€Omegaã€Kubernetes éƒ½å…±äº«çš„è¨­è¨ˆç†å¿µï¼Œç‚ºäº†æå‡ç³»çµ±çš„å½ˆæ€§ï¼šè¿´åœˆä¸æ–·æ¯”å°æœŸæœ›ç‹€æ…‹ (è¦æ±‚å¤šå°‘ç¬¦åˆ label-selector çš„ Pod å­˜åœ¨)ã€èˆ‡å¯¦éš›ç‹€æ…‹ (æ§åˆ¶å™¨å¯¦éš›è§€å¯Ÿåˆ°çš„æ•¸é‡)ï¼Œç„¶å¾Œæ§åˆ¶å™¨æ¡å–è¡Œå‹•ï¼Œç›¡é‡æ”¶æ–‚ (converge) å¯¦éš›ç‹€æ³èˆ‡æœŸæœ›ç‹€æ³ã€‚ç”±æ–¼æ‰€æœ‰è¡Œå‹•éƒ½åŸºæ–¼è§€å¯Ÿçµæœï¼Œè€Œéä¸€å€‹ç‹€æ…‹åœ–ï¼Œèª¿å’Œè¿´åœˆæ›´èƒ½æ‰¿å—éŒ¯èª¤ã€æ›´èƒ½æŠµæŠ—æ“¾äº‚ã€æ›´åŠ å …å›ºï¼šç•¶ä¸€å€‹æ§åˆ¶å™¨å‡ºéŒ¯ï¼Œåªè¦é‡å•Ÿï¼Œå°±å¯ä»¥ç¹¼çºŒä¸Šæ¬¡ä¸­æ–·çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes è¨­è¨ˆæˆä¸€å †å¾®æœå‹™ (microservice) çš„çµ„åˆï¼Œä¸¦é€éå„å€‹å°å‹çš„æ§åˆ¶è¿´åœˆ (control loop)ï¼Œä¾†é”æˆæ•´é«”çš„ç·¨æ’çµæœ (choreography) - ä¸€å€‹æœŸæœ›çš„ç‹€æ…‹ï¼Œç”±å„å€‹åˆ†æ•£çš„è‡ªå‹•å…ƒä»¶ï¼Œå”ä½œé”æˆã€‚é€™å€‹æ„è­˜çš„è¨­è¨ˆé¸æ“‡ï¼Œå°æ¯”ä¸€å€‹ä¸­å¿ƒåŒ–å”èª¿ç®¡ç†ç³»çµ± (centralized orchestration)ï¼Œå¾Œè€…æ›´å®¹æ˜“å»ºæ§‹ï¼Œä½†é¢å°ä¸å¯é æœŸçš„éŒ¯èª¤èˆ‡è®Šæ›´æ™‚ï¼Œæ›´é¡¯è„†å¼±èˆ‡åƒµåŒ–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å‰è»Šä¹‹é‘‘-things-to-avoid&#34;&gt;å‰è»Šä¹‹é‘‘ (Things to avoid)&lt;/h1&gt;
&lt;p&gt;Google åœ¨é–‹ç™¼é€™äº›ç³»çµ±æ™‚ï¼Œå­¸åˆ°ä¸€äº›æœ€å¥½åˆ¥åšçš„äº‹æƒ…ï¼Œæˆ‘å€‘æä¾›é€™äº›è³‡è¨Šï¼Œæ‰€ä»¥å…¶ä»–äººå¯ä»¥é¿å…é‡è¤‡çš„éŒ¯èª¤ï¼Œè€ŒæŠŠçŠ¯éŒ¯çš„æˆæœ¬æ”¾åœ¨æ–°çš„éŒ¯èª¤ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦ä½¿ç”¨å®¹å™¨ç®¡ç†ç³»çµ±ç®¡ç†-port-number&#34;&gt;ä¸è¦ä½¿ç”¨å®¹å™¨ç®¡ç†ç³»çµ±ç®¡ç† Port number&lt;/h3&gt;
&lt;p&gt;Borg ä¸Šæ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨å®¿ä¸»æ©Ÿå™¨çš„ IPï¼ŒBorg åœ¨åˆ†é…æ™‚ä¾¿æŒ‡æ´¾çµ¦æ¯å€‹å®¹å™¨å„è‡ªçš„ port numberã€‚æ¯å€‹å®¹å™¨ç§»å‹•åˆ°æ–°æ©Ÿå™¨æ™‚æœƒå–å¾—ä¸€å€‹æ–°çš„ port numberï¼Œæœ‰æ™‚åœ¨æœ¬æ©Ÿé‡å•Ÿä¹Ÿæœƒæ‹¿åˆ°æ–°çš„ã€‚é€™é»è¡¨ç¤ºæ—¢å­˜çš„ç¶²è·¯æœå‹™ (ä¾‹å¦‚ DNS) Google éƒ½å¿…é ˆè‡ªè¡Œæ”¹å‹•ä¸¦ä½¿ç”¨è‡ªç¶­è­·çš„ç‰ˆæœ¬ï¼›æœå‹™çš„å®¢æˆ¶ç«¯ä¸¦ä¸èƒ½ä¸»å‹•ç²å¾—æœå‹™çš„ port number è³‡è¨Šï¼Œéœ€è¦è¢«å‹•å‘ŠçŸ¥ï¼›port number ä¹Ÿä¸èƒ½æ”¾åœ¨ URLs ä¸­ï¼Œé‚„éœ€è¦é¡å¤–çš„è½‰å€æ©Ÿåˆ¶ï¼›æ‰€æœ‰åŸºæ–¼ IP é‹ä½œçš„å·¥å…·éƒ½éœ€è¦æ”¹æˆä½¿ç”¨ IP:Portã€‚&lt;/p&gt;
&lt;p&gt;æœ‰é‘‘æ–¼æ­¤ï¼ŒKubernetes ä¸Šæ¯å€‹ Pod åˆ†é…ä¸€å€‹ IPï¼Œè®“æ‡‰ç”¨çš„èº«åˆ†ç¬¦åˆç¶²è·¯èº«åˆ† (IP address)ï¼Œè®“ç¾æˆçš„æ‡‰ç”¨æ›´å®¹æ˜“åœ¨ Kubernetes ä¸ŠåŸ·è¡Œï¼Œæ‡‰ç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨éœæ…‹çš„å¸¸è¦ port number (ä¾‹å¦‚ HTTP æµé‡ä½¿ç”¨ 80 port)ï¼Œç¾æœ‰çš„å·¥å…·ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ç¶²æ®µåˆ‡åˆ† (network segmentation)ã€å¸¶å¯¬ç¯€æµ (bandwidth throttling) èˆ‡æ§åˆ¶ã€‚æ‰€æœ‰çš„å…¬æœ‰é›²éƒ½æä¾›æ¯å€‹ Pod ä¸€å€‹ IP çš„ç¶²è·¯åŸºåº•ï¼Œåœ¨å¯¦é«”æ©Ÿå™¨ (bare metal)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è»Ÿé«”å®šç¾©ç¶²è·¯ (Software defined network) çš„ overlay ç¶²è·¯ï¼Œæˆ–æ˜¯è¨­å®š L3 è·¯ç”±ä¾†é…ç½®æ©Ÿå™¨ä¸Šçš„ Pod IPsã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦å¹«å®¹å™¨ç·¨è™Ÿä½¿ç”¨-label-æ§åˆ¶å®¹å™¨&#34;&gt;ä¸è¦å¹«å®¹å™¨ç·¨è™Ÿï¼Œä½¿ç”¨ label æ§åˆ¶å®¹å™¨&lt;/h3&gt;
&lt;p&gt;å®¹å™¨å»ºæ§‹è®Šå¾—æ–¹ä¾¿å¾Œï¼Œä½¿ç”¨è€…æœƒç”¢ç”Ÿå¤§é‡å®¹å™¨ï¼Œå¾ˆå¿«å°±éœ€è¦ä¸€å€‹ç¾¤çµ„ç®¡ç†çš„æ–¹æ³•ã€‚Borg æä¾› job çµ¦ä¸€çµ„ç›¸åŒçš„ tasks (task ä½œç‚ºå®¹å™¨çš„åç¨±)ï¼Œä¸€å€‹ job æ˜¯ä¸€çµ„å‘é‡é›†åˆ (compact vector) å¯ä»¥æŒ‡å‘ä¸€å€‹æˆ–å¤šå€‹ tasksï¼Œå°‡ task å¾ 0 é–‹å§‹éå¢ç·¨è™Ÿï¼Œé€™å€‹åšæ³•å¾ˆç›´æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†ç­‰ç¨å¾Œéœ€è¦é‡å•Ÿå®¹å™¨æ™‚ï¼ŒGoogle å°±å¾Œæ‚”é€™å€‹å›ºå®šçš„è¨­è¨ˆï¼Œä¾‹å¦‚å…¶ä¸­ä¸€å€‹ task æ­»äº†éœ€è¦é‡å•Ÿåˆ€å¦å¤–ä¸€å°æ©Ÿå™¨ï¼ŒåŸæœ¬çš„ task å‘é‡çš„ç›¸åŒä½ç½®ï¼Œç¾åœ¨éœ€è¦åšå…©å€å·¥ä½œï¼šæ‰¾åˆ°æ–°çš„å‰¯æœ¬ï¼Œç„¶å¾ŒæŒ‡å‘èˆŠçš„å‰¯æœ¬ä»¥å…éœ€è¦é™¤éŒ¯ã€‚ç•¶å‘é‡é›†åˆä¸­çš„ task é›¢é–‹å¾Œï¼Œé€™å€‹å‘é‡ä¸Šå°±æœ‰å¾ˆå¤šç©ºæ´ï¼Œé€™è®“ Borg ä¸Šå±¤çš„ç®¡ç†ç³»çµ±åˆ†é…ï¼Œè·¨ç´šç¾¤çš„ job æ™‚è®Šå¾—å¾ˆå›°é›£ã€‚é€™ä¹Ÿé€ æˆ Borg çš„ job å‡ç´šèªæ³•ä¸­å‡ºç¾è¨±å¤šå±éšªä¸”ä¸å¯é æœŸçš„äº¤äº’ (ç•¶æ»¾å‹•å‡ç´šæ™‚ä¾ç…§ index é †åºé‡å•Ÿ task)ï¼Œè€Œæ‡‰ç”¨ä»°è³´ task index (ä¾‹å¦‚æ‡‰ç”¨ä½¿ç”¨ index åŸ·è¡Œè³‡æ–™ç´šçš„ sharding æˆ– paritioning)ï¼šå¦‚æœæ‡‰ç”¨ä½¿ç”¨ task index ä¾†åš shardingï¼ŒBorg é‡å•Ÿæ™‚æœƒç§»é™¤é„°è¿‘çš„ tasksï¼Œå°è‡´è³‡æ–™ä¸å¯ç”¨ã€‚Borg ä¹Ÿæ²’æœ‰å¥½æ–¹æ³•ä¾†å¢åŠ ä¾†è‡ªæ‡‰ç”¨çš„ metadata åˆ° task ä¸Šï¼Œä¾‹å¦‚è§’è‰² (e.g. å‰ç«¯ç¶²é )ã€æˆ–æ˜¯æ»¾å‹•å‡ç´šçš„ç‹€æ…‹ (e.g. canary)ï¼Œå·¥ç¨‹å¸«åªå¥½å°‡ metadata ç·¨ç¢¼ï¼Œå£“åœ¨ jobs çš„åç¨±ä¸Šï¼Œå†ä½¿ç”¨æ­£è¦è¡¨é”å¼ (regular expression) è§£ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ç›´æ¥ä½¿ç”¨ label ä¾†è¾¨è­˜å®¹å™¨ç¾¤ï¼Œlabel æ˜¯éµå€¼è³‡æ–™å° (key-value pair)ï¼ŒåŒ…å«å¯ä»¥è¾¨è­˜æ‡‰ç”¨çš„è³‡æ–™ï¼Œä¸€å€‹ Pod å¯èƒ½æœ‰ role=frontend èˆ‡ state=production è¡¨ç¤º Pod æ˜¯å±¬æ–¼ production ç’°å¢ƒçš„å‰ç«¯ç¶²é ã€‚label å¯ä»¥å‹•æ…‹å¢åŠ ï¼Œä¸¦ä½¿ç”¨è‡ªå‹•åŒ–å·¥å…·æ›´æ”¹ï¼Œå€‹åœ˜éšŠå¯ä»¥è‡ªè¡Œç¶­è­·ä¸€çµ„å„è‡ªçš„ labelã€‚ä½¿ç”¨ label-selector ä¾†å–å¾—ä¸€çµ„ç‰©ä»¶ (e.g. stage==production &amp;amp;&amp;amp; role==frontend)ã€‚å„çµ„ç‰©ä»¶å¯ä»¥é‡è¤‡ï¼Œä¸€å€‹ç‰©ä»¶ä¹Ÿå¯ä»¥å±¬æ–¼å¤šå€‹ç‰©ä»¶çµ„ï¼Œæ‰€ä»¥ label ä¹Ÿæ¯”éœæ…‹çš„ç‰©ä»¶æ¸…å–®æ›´æœ‰å½ˆæ€§ã€‚ç”±æ–¼ç‰©ä»¶çµ„éƒ½æ˜¯å‹•æ…‹æŸ¥è©¢æ™‚ç”¢ç”Ÿçš„ï¼Œä»»ä½•æ™‚å€™éƒ½å¯ä»¥å¢åŠ æ–°çš„ç‰©ä»¶çµ„ã€‚label-selector æ˜¯ Kubernetes çš„ç¾¤çµ„æ©Ÿåˆ¶ï¼Œä¸¦è—‰æ­¤åˆ†ç•Œç®¡ç†ç¶­é‹ï¼Œåˆå¯ä»¥åŒæ™‚è™•ç†å¤šå€‹å¯¦é«”ã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶æœ‰äº›ä½¿ç”¨æƒ…å½¢ï¼Œäº‹å…ˆæ˜ç¢ºçŸ¥é“ä¸€çµ„å…§æœ‰å“ªäº› task å¾ˆæœ‰ç”¨ (ä¾‹å¦‚éœæ…‹è…³è‰²æŒ‡æ´¾ã€å·¥ä½œ partitioning æˆ– sharding)ï¼Œåˆç†çš„ label ä¹Ÿèƒ½ç”¢ç”Ÿä¸€æ¨£çš„æ•ˆæœï¼Œåªæ˜¯æ‡‰ç”¨ (æˆ–æ˜¯å…¶ä»–å¤–éƒ¨ç®¡ç†ç³»çµ±) å°±éœ€è¦è² è²¬æä¾› labelingã€‚label èˆ‡ label-selector ç‚ºé›™é‚Šæä¾›æœ€é©çš„åšæ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ³¨æ„-pod-çš„æ‰€æœ‰æ¬Š&#34;&gt;æ³¨æ„ Pod çš„æ‰€æœ‰æ¬Š&lt;/h3&gt;
&lt;p&gt;Borg ä¸Š task ä¾è³´ jobï¼Œä¸æœƒç¨è‡ªå­˜åœ¨ï¼Œç”¢ç”Ÿ job æ™‚ç”¢ç”Ÿ tasksï¼Œé€™äº› tasks æ°¸é é€£çµç‰¹å®šçš„ jobï¼Œåˆªé™¤ job åŒæ™‚åˆªé™¤ tasksã€‚é€™é»å¾ˆæ–¹ä¾¿ï¼Œä½†æœ‰ä¸€å€‹ç¼ºé™·ï¼Œé€™å€‹å–®ä¸€çš„ç¾¤çµ„æ©Ÿåˆ¶ï¼Œéœ€è¦æ‡‰å°æ‰€æœ‰ä½¿ç”¨éœ€æ±‚ã€‚ä¾‹å¦‚ ä¸€å€‹ job éœ€è¦å„²å­˜åƒæ•¸ï¼Œæä¾›çµ¦æœå‹™æˆ–æ˜¯æä¾›çµ¦æ‡‰ç”¨ï¼Œä½†ä¸æœƒä¸€èµ·æä¾›ï¼Œä½¿ç”¨è€…å°±éœ€è¦é–‹ç™¼å–ä»£æ–¹æ¡ˆä¾†å”åŠ©è™•ç† (e.g. DaemonSet å°‡ Pod è¤‡è£½åˆ°æ‰€æœ‰ç¯€é»ä¸Š)&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­ Pod çš„ç”Ÿå‘½é€±æœŸç®¡ç†å…ƒä»¶ï¼Œä¾‹å¦‚ replication controllerï¼Œä½¿ç”¨ label selector æ±ºå®šé‚£äº› Pod è¦è² è²¬ç®¡ç†ï¼Œæ‰€ä»¥æœƒæœ‰ä¸€å€‹ä»¥ä¸Šçš„ controller èªç‚ºä»–å€‘éƒ½å°æŸå€‹ Pod æœ‰ç®¡è½„æ¬Šï¼Œé€™æ¨£çš„è¡çªéœ€è¦é€éæ˜ç¢ºè¨­å®šé¿å…çš„ã€‚ç”±æ–¼ label çš„å½ˆæ€§ä¹Ÿæœ‰è¨±å¤šå„ªé»ï¼Œä¾‹å¦‚å°‡ controller èˆ‡ Pod è§£è—•ï¼Œè¡¨ç¤ºå†ä¹Ÿä¸æœƒæœ‰ä»¥å¾€çš„å­¤å…’ Pod (orphan) æˆ–æ˜¯èªé ˜çš„ Pod (adopt)ã€‚è€ƒæ…®é™„è¼‰å‡è¡¡æœå‹™ï¼Œé€é label selector é¸æ“‡æµé‡çš„ç«¯é»ï¼Œå¦‚æœä¸€å€‹ Pod è¡Œç‚ºæœ‰ç•°ï¼Œé€™å€‹ Pod åªè¦ç§»é™¤å°æ‡‰çš„ labelï¼ŒKubernetes service load balancer å°±å¯ä»¥é¿å…æµé‡ï¼Œè¼•æ˜“çš„è¢«éš”é›¢é–‹ä¾†ï¼Œä½† Pod æœ¬èº«é‚„æœƒå­˜åœ¨ï¼Œæä¾›åŸåœ°é™¤éŒ¯ã€‚åŒæ™‚ï¼Œç®¡ç† Pod çš„ replication controller æœƒå¢åŠ ä¸€å€‹ Pod ä¾†å–ä»£è¡Œç‚ºæœ‰ç•°çš„ Podã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦æš´éœ²-raw-state&#34;&gt;ä¸è¦æš´éœ² raw state&lt;/h3&gt;
&lt;p&gt;Borgã€Omegaã€Kubernetes çš„é—œéµä¸åŒé»æ˜¯ API çš„æ¶æ§‹è¨­è¨ˆã€‚Borgmaster æ˜¯ä¸€å€‹é›†ä¸­å–®ä¸€çš„ (monolithic) å…ƒä»¶ï¼Œå¯è¦‹æ‰€æœ‰çš„ API è¡Œç‚ºï¼ŒåŒ…å«ç´šç¾¤ç®¡ç†é‚è¼¯ï¼Œä¾‹å¦‚ job èˆ‡ task çš„ç‹€æ…‹æ©Ÿåˆ¶ï¼Œä¸¦ä¸”ä½¿ç”¨åŸºæ–¼ Paxos ç®—æ³•çš„åˆ†æ•£å¼å„²å­˜åº«ã€‚Omega é™¤äº†å„²å­˜åº«ä»¥å¤–ï¼Œæ²’æœ‰é›†ä¸­å¼çš„å…ƒä»¶ï¼Œå„²å­˜åº«åªå„²å­˜è¢«å‹•çš„ç‹€æ…‹è³‡è¨Šï¼Œæä¾›æ¨‚è§€çš„å¹³è¡Œæ§åˆ¶ (optimistic concurrenty control)ï¼šæ‰€æœ‰é‚è¼¯èˆ‡èªæ³•éƒ½æ¨é€åˆ°å„²å­˜åº«çš„å®¢æˆ¶ç«¯ï¼Œæ‰€ä»¥æ‰€æœ‰å®¢æˆ¶ç«¯éƒ½å¯ä»¥è®€å– Omega çš„æ‰€æœ‰é‚è¼¯ã€‚å¯¦å‹™ä¸­ Omega çš„å…ƒä»¶éƒ½ä½¿ç”¨ç›¸åŒçš„å®¢æˆ¶ç«¯ç¨‹å¼åº«ï¼Œè² è²¬æ‰“åŒ…/è§£åŒ…è³‡æ–™çµæ§‹ã€è³‡æ–™é‡é€ã€ä¸¦ç¢ºä¿èªæ³•çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes é¸æ“‡ä¸­é–“ï¼Œé¡ä¼¼ Omega å…ƒä»¶åŒ–æ¶æ§‹çš„æ¶æ§‹ï¼Œç¢ºä¿å…¨åŸŸçš„å¸¸æ•¸ã€æ”¿ç­–æ§ç®¡ã€è³‡æ–™è½‰å‹ï¼Œä¾†æä¾›å½ˆæ€§èˆ‡æ“´å®¹æ€§ã€‚Kubernetes ç¢ºä¿æ‰€æœ‰çš„å„²å­˜åº«å­˜å–éƒ½é€é API serverï¼ŒAPI server éš±è—å„²å­˜åº«çš„å¯¦ä½œã€è² è²¬ç‰©ä»¶çš„é©—è­‰ã€é™¤éŒ¯ã€ç‰ˆæœ¬æ§åˆ¶ã€‚å¦‚åŒ Omegaï¼ŒKubernetes æä¾›å¤šç¨®ä¸åŒçš„å®¢æˆ¶ç«¯ (ç‰¹åˆ¥çµ¦æ˜¯é–‹æºçš„ç’°å¢ƒ)ï¼Œä½†æ˜¯é›†ä¸­åŒ–çš„ API serverï¼Œä»èƒ½ç¢ºä¿ç›¸åŒçš„èªæ³•ã€æ†é‡ã€èˆ‡æ”¿ç­–æ§ç®¡ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…¶ä»–å›°é›£çš„é–‹æ”¾å•é¡Œ&#34;&gt;å…¶ä»–å›°é›£çš„é–‹æ”¾å•é¡Œ&lt;/h1&gt;
&lt;p&gt;å¤šå¹´çš„å®¹å™¨é–‹ç™¼ç³»çµ±é–‹ç™¼ç«¶è±”ï¼ŒGoogle ä»ç„¶æœ‰ä¸€äº›å•é¡Œé‚„æ²’æ‰¾åˆ°åˆé©çš„ç­”æ¡ˆï¼Œé€™è£¡åˆ†äº«ä¸€äº›å•é¡Œï¼Œå¸Œæœ›èƒ½å¸¶ä¾†æ›´å¤šè¨è«–èˆ‡è§£æ±ºæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¨­å®š-configuration&#34;&gt;è¨­å®š (configuration)&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰é¢å°çš„å•é¡Œä¸­ï¼Œèˆ‡è¨­å®š (configuration) æœ‰é—œçš„å•é¡Œï¼Œç”¢ç”Ÿæœ€å¤šçš„è…¦åŠ›æ¿€ç›ªã€æ–‡ä»¶ã€èˆ‡è¨±å¤šç¨‹å¼ç¢¼ã€‚ä¸€çµ„æ•¸å€¼æä¾›çµ¦æ‡‰ç”¨ï¼Œä½†ä¸æ˜¯ç›´æ¥å¯«æ­»åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘å¯ä»¥å°±æ­¤å¯«ä¸€å¤§ç¯‡äº›ä¸å®Œï¼Œä½†é€™é‚Šå…ˆèšç„¦å¹¾å€‹é‡é»ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ï¼Œé—œæ–¼æ‡‰ç”¨çš„è¨­å®šï¼Œå®¹å™¨ç®¡ç†ç³»çµ±æ²’åšï¼Œä½†å·²ç¶“æœ‰åŒ…ç¾…è¬è±¡çš„å¯¦ä½œï¼ŒBorg çš„æ­·å²ä¸­åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¯„ç‰ˆ (boilerplate) çš„ç²¾ç°¡ (e.g. é‡å°ä¸åŒå·¥ä½œè² è¼‰ï¼Œä¾‹å¦‚æœå‹™æˆ–æ˜¯æ‰¹æ¬¡ä»»å‹™ï¼Œæä¾›é è¨­çš„ task é‡å•Ÿæ”¿ç­–)&lt;/li&gt;
&lt;li&gt;èª¿æ•´ä¸¦é©—è­‰æ‡‰ç”¨çš„åƒæ•¸èˆ‡å‘½ä»¤åˆ—æ¨™ç±¤ (command-line flags)&lt;/li&gt;
&lt;li&gt;å¯¦ä½œ workaround çµ¦é‚„æ²’æœ‰çš„ API æŠ½è±¡ï¼Œä¾‹å¦‚ package ç®¡ç†&lt;/li&gt;
&lt;li&gt;æ‡‰ç”¨çš„è¨­å®šæ¨£æœ¬ç¨‹å¼åº«&lt;/li&gt;
&lt;li&gt;ç™¼å¸ƒç®¡ç†å·¥å…· (release management)&lt;/li&gt;
&lt;li&gt;æ˜ è±¡æª”ç‰ˆæœ¬è¦æ ¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç‚ºäº†èˆ‡ä¸Šè¿°éœ€æ±‚å”ä½œï¼Œè¨­å®šç®¡ç†ç³»çµ±æœ€çµ‚ç”¢ç”Ÿä¸€å¥—é‡å°ç‰¹å®šé ˜åŸŸ (domain-specific) çš„è¨­å®šèªè¨€ï¼Œæœ€çµ‚è®Šæˆ Turing èªè¨€ï¼Œç‚ºäº†åœ¨è¨­å®šè³‡æ–™ä¸­é€²è¡Œé‹ç®— (e.g. é€éæœå‹™çš„ sharding æ•¸é‡ï¼Œé‚„æ±ºå®šèª¿æ•´æ©Ÿå™¨çš„ memory)ï¼Œé€™æœƒé€ æˆä¸€ç¨®é›£ä»¥ç†è§£çš„è¨­å®šç¨‹å¼ç¢¼ (configuration is code) ï¼Œè€Œé€™æ˜¯æ‡‰ç”¨å·¥ç¨‹å¸«ï¼Œé€éæ¶ˆæ»…åŸå§‹ç¢¼ä¸­å¯«æ­»çš„åƒæ•¸ï¼Œç›¡åŠ›é¿å…çš„ã€‚é€™é»ä¸¦æ²’æœ‰é™ä½ç¶­é‹çš„è¤‡é›œæ€§ï¼Œæ–°çš„èªè¨€åªæ˜¯å°‡è¨­å®šçš„é‹ç®—ï¼Œå¾æ‡‰ç”¨çš„ç¨‹å¼èªè¨€ä¸­ï¼Œç§»åˆ°å¦å¤–ä¸€å€‹æ–°çš„ç‰¹å®šèªè¨€ï¼Œè€Œé€™å€‹èªè¨€å¾€å¾€æ›´ç¼ºä¹é–‹ç™¼å·¥å…·ã€é™¤éŒ¯å·¥å…·ã€èˆ‡æ¸¬è©¦æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;Google èªç‚ºç›®å‰æœ€æœ‰æ•ˆçš„è¾¦æ³•ï¼Œæ˜¯æ¥å—ä¸€éƒ¨åˆ†ç„¡æ³•é¿å…çš„ç¨‹å¼è¨­å®šï¼Œä¸¦ä¸”æ¸…æ¥šçš„å€åˆ†é‹ç®—çš„ç¨‹å¼èˆ‡è³‡æ–™ã€‚å‘ˆç¾è³‡æ–™çš„èªè¨€æ‡‰è©²ç°¡å–®æ¸…æ¥šï¼Œä¾‹å¦‚ JSON æˆ–æ˜¯ YAMLï¼Œè¨­å®šé‹ç®—çš„é‚è¼¯å‰‡éœ€è¦ä½¿ç”¨å®Œæ•´çš„ç¨‹å¼èªè¨€ï¼Œæ‰æœ‰å®Œæ•´çš„èªæ³•ã€èˆ‡å¥½çš„å·¥å…·ã€‚é€™é»å¯è¦‹æ–¼ Angular å‰ç«¯æ¡†æ¶ï¼ŒåŠƒåˆ† markup è³‡æ–™èˆ‡ JavaScript é‹ç®—é‚è¼¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¾è³´ç®¡ç†-dependency-management&#34;&gt;ä¾è³´ç®¡ç† (dependency management)&lt;/h3&gt;
&lt;p&gt;å»ºç«‹æœå‹™å¾€å¾€æ„å‘³è‘—å»ºç«‹ä¸€å¥—ç›¸é—œæœå‹™ (ç›£æ§ã€CI/CDã€ç­‰ç­‰)ï¼Œå¦‚æœä¸€å€‹æ‡‰ç”¨ä¾è³´å…¶ä»–æ‡‰ç”¨ï¼Œæ˜¯å¦å®¹å™¨ç®¡ç†ç³»çµ±ä¹Ÿèƒ½è‡ªå‹•æä¾›ä¾è³´çš„æœå‹™å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è®“äº‹æƒ…æ›´è¤‡é›œï¼Œå•Ÿå‹•ä¾è³´æœå‹™å¾€å¾€ä¸åªæ˜¯å•Ÿå‹•æ–°çš„å‰¯æœ¬ï¼Œä¾‹å¦‚æœå‹™å•Ÿå‹•å¾Œé‚„éœ€è¦å‘ä½¿ç”¨è€…è¨»å†Š (ä¾‹å¦‚ BigTable æœå‹™)ï¼Œç„¶å¾Œå‚³é€èº«åˆ†èªè­‰ã€æ¬Šé™èªè­‰ã€ä»¥åŠå…¶ä»–ä¸­ä»‹æœå‹™çš„è¨ˆåƒ¹è³‡è¨Šã€‚æ²’æœ‰ä¸€å€‹ç³»çµ±å¯ä»¥æ•æ‰ã€ç®¡ç†ã€ç¶­è­·ã€æˆ–æ˜¯æš´éœ²é€™æ¨£çš„ä¾è³´ç³»çµ±è³‡è¨Šã€‚æ‰€ä»¥é–‹å•Ÿä¸€å€‹æ–°æœå‹™æ™‚ï¼Œç”¨æˆ¶ä»éœ€è¦è‡ªå·±ç…©æƒ±ã€éƒ¨å±¬æ–°æœå‹™ä»ç„¶å›°é›£ï¼Œè€Œé€™å¾€å¾€é€²ä¸€æ­¥å°è‡´ä½¿ç”¨è€…æ²’æœ‰è·Ÿéš¨æœ€ä½³å¯¦è¸ï¼Œé€²è€Œé™ä½æœå‹™çš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å€‹æ¨™æº–å•é¡Œæ˜¯ï¼Œå¦‚æœæœå‹™æ˜¯æ‰‹å‹•æä¾›çš„ï¼Œè·Ÿä¸Šä¾è³´æœå‹™æ›´æ–°æœƒå¾ˆå›°é›£ã€‚è©¦åœ–è‡ªå‹•åŒ–åˆ¤æ–· (e.g. ä½¿ç”¨ tracing accesses) å¤±æ•—ï¼Œå› ç‚ºç„¡æ³•å–å¾—åˆ¤è®€çµæœæ‰€éœ€è¦çš„èªæ³•è³‡è¨Šã€‚ä¸€å€‹å¯èƒ½çš„è§£æ±ºæ–¹æ³•ï¼Œæ˜¯è¦æ±‚æ‡‰ç”¨åˆ—èˆ‰æ‰€æœ‰ä¾è³´çš„æœå‹™ï¼Œä¸¦ä¸”é€éæ¶æ§‹æ§åˆ¶ï¼Œæ‹’çµ•å…¶ä»–æ‡‰ç”¨å­˜å– (å¦‚åŒç·¨è­¯æ™‚åŒ¯å…¥çš„ç¨‹å¼åº«)ã€‚é€™æ¨£å¯ä»¥è®“å®¹å™¨ç®¡ç†ç³»çµ±æä¾›è‡ªå‹•åŒ–çš„ç’°å¢ƒè¨­å®šã€æä¾›è‡ªå‹•èº«åˆ†èªè­‰ã€ä¸¦å¯«è‡ªå‹•é€£æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å¹¸çš„æ˜¯ï¼Œé€™æ¨£æè¿°ã€åˆ†æã€ä½¿ç”¨ä¾è³´æ€§çš„ç³»çµ±å¤ªéè¤‡é›œï¼Œé‚„æ²’è¢«å¢åŠ åˆ°ä¸»æµçš„å®¹å™¨ç®¡ç†ç³»çµ±ã€‚æˆ‘å€‘å¸Œæœ›æœ‰å¤© Kubernetes èƒ½å¤ å»ºç«‹èµ·é¡ä¼¼çš„å·¥å…·ï¼Œå–®ç›®å‰ä»æ˜¯ä¸€å€‹å°šæœªå®Œæˆçš„æŒ‘æˆ°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;çµè«–&#34;&gt;çµè«–&lt;/h1&gt;
&lt;p&gt;åå¹´çš„ç¶“é©—æ‰“æƒå®¹å™¨ç®¡ç†ç³»çµ±ï¼Œçµ¦äº†æˆ‘å€‘è¨±å¤šç¶“é©—ï¼Œæˆ‘å€‘å°‡å…¶å¯¦ä½œ Kubernetes ä¸Šï¼ŒKubernetes çš„ç›®çš„æ˜¯é€éå®¹å™¨ï¼Œæå‡å·¥ç¨‹å¸«çš„ç”Ÿç”¢åŠ›ï¼Œä¸¦æ¸›è¼•æ‰‹å‹•èˆ‡è‡ªå‹•ç®¡ç†ç³»çµ±çš„è² æ“”ï¼Œæˆ‘å€‘å¸Œæœ›ä½ ä¹Ÿèƒ½åŠ å…¥æ‹“å±•èˆ‡æ¢ç´¢çš„è¡Œåˆ—ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Borg Omega and Kubernetes TLDR æ‘˜è¦ç¿»è­¯</title>
      <link>https://chechia.net/zh-hant/post/2020-08-26-borg-omega-and-kubernetes-tldr/</link>
      <pubDate>Wed, 26 Aug 2020 13:50:52 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-08-26-borg-omega-and-kubernetes-tldr/</guid>
      <description>&lt;p&gt;é€™æ˜¯åŸæ–‡ç¿»è­¯çš„å¤ªé•·ä¸è®€ (TL;DR) ç‰ˆæœ¬ã€‚å®Œæ•´ç¿»è­¯è«‹è¦‹&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-09-12-borg-omega-and-kubernetes/&#34;&gt;Borg Omega and Kubernetes å‰ä¸–ä»Šç”Ÿæµ©æ–‡å®Œæ•´ç¿»è­¯&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åŸæ–‡ï¼šhttps://storage.googleapis.com/pub-tools-public-publication-data/pdf/44843.pdf&lt;/p&gt;
&lt;h1 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Borg ä»¥å‰å°±æœ‰æ‡‰ç”¨ç®¡ç†ç³»çµ±ï¼Œé‚£æ™‚é‚„æ²’æœ‰ Linux control group&lt;/li&gt;
&lt;li&gt;Borg
&lt;ul&gt;
&lt;li&gt;æ˜¯ç¬¬ä¸€å¥—çµ±ä¸€çš„ container-management system&lt;/li&gt;
&lt;li&gt;Borg ä»è¢«å¤§è¦æ¨¡çš„ä½¿ç”¨ï¼Œæœ‰è¨±å¤šåŠŸèƒ½è€Œä¸”éå¸¸å …å›º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Omega
&lt;ul&gt;
&lt;li&gt;ç¹¼æ‰¿ Borg ä¸ŠæˆåŠŸçš„è¨­è¨ˆï¼Œä¸¦å¸Œæœ›æ”¹é€² Borg çš„ç”Ÿæ…‹ç³»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes
&lt;ul&gt;
&lt;li&gt;é–‹æº&lt;/li&gt;
&lt;li&gt;é€é REST API æºé€š client&lt;/li&gt;
&lt;li&gt;æ‡‰ç”¨é–‹ç™¼å°å‘ï¼Œè‘—é‡æ–¼é–‹ç™¼è€…çš„éœ€æ±‚ï¼Œå¸Œæœ›èƒ½ç°¡å–®çš„éƒ¨ç½²è¤‡é›œçš„ç³»çµ±&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;container&#34;&gt;Container&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Google ä½¿ç”¨ Container ä¾†ææ˜‡ utilization
&lt;ul&gt;
&lt;li&gt;æŠŠ batch jobs è·Ÿé ç•™è³‡æºçš„æœå‹™ (user-facing app) æ”¾åœ¨ä¸€èµ·ï¼Œä½¿ç”¨é–’ç½®æ™‚çš„è³‡æºè·‘ batch job&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¾ä»£ container çš„å®šç¾©æ˜¯ runtime-isolation èˆ‡ image&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;application-oriented-infrastructure&#34;&gt;Application-oriented infrastructure&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;container ä½¿ç”¨ä¹…äº†ï¼Œä¸åªæ»¿è¶³ utilization çš„éœ€æ±‚
&lt;ul&gt;
&lt;li&gt;è³‡æ–™ä¸­å¿ƒå¾æ©Ÿå™¨å°å‘è®Šæˆæ‡‰ç”¨å°å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Container å°è£ç’°å¢ƒï¼ŒæŠŠæ©Ÿå™¨èˆ‡ OS çš„ä¾è³´æŠ½è±¡åŒ–
&lt;ul&gt;
&lt;li&gt;æ‡‰ç”¨ä¸ä¾è³´
&lt;ul&gt;
&lt;li&gt;éƒ¨ç½²æµç¨‹&lt;/li&gt;
&lt;li&gt;runtime infrastrcture&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Container scope åœ¨æ‡‰ç”¨ä¸Šï¼Œå°ˆæ³¨åœ¨æ‡‰ç”¨ç®¡ç†è€Œä¸æ˜¯æ©Ÿå™¨ç®¡ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;application-environment&#34;&gt;Application environment&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;cgroup, chroot, namespace åŸæœ¬çš„ç›®çš„æ˜¯ç‚ºäº†ä¿è­·æ‡‰ç”¨ï¼Œä¸è¢«å…¶ä»–æ‡‰ç”¨å½±éŸ¿
&lt;ul&gt;
&lt;li&gt;æ··åˆä½¿ç”¨å¯ä»¥åœ¨æ‡‰ç”¨èˆ‡ OS é–“ç”¢ç”ŸæŠ½è±¡å±¤ï¼Œè§£è€¦ app èˆ‡ OS
&lt;ul&gt;
&lt;li&gt;æä¾›å®Œå…¨ç›¸åŒçš„éƒ¨ç½²ç’°å¢ƒï¼Œé¿å…åˆ‡æ›ç’°å¢ƒ(ex. dev, prod)æ™‚é€ æˆç’°å¢ƒå·®ç•°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€²ä¸€æ­¥æŠŠ app çš„ä¾è³´ç¨‹å¼ä¹Ÿæ‰“åŒ… image
&lt;ul&gt;
&lt;li&gt;container å° OS å”¯ä¸€çš„ä¾è³´åªå‰© Linux kernel system-call interface
&lt;ul&gt;
&lt;li&gt;å¤§å¹…å¢åŠ  app èª¿åº¦çš„å½ˆæ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç„¶è€Œæœ‰äº› interface ä»é™„è‘— OS ä¸Šï¼Œex socket, /prod, ioctl calls
&lt;ul&gt;
&lt;li&gt;å¸Œæœ›é€é Open Container Initiativeï¼Œæ¸…æ¥šå®šç¾© interface èˆ‡æŠ½è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç›´æ¥çš„å¥½è™•ï¼Œå°‘æ•¸å¹¾ç¨® OS èˆ‡ OS Version å°±å¯ä»¥è·‘æ‰€æœ‰æ‡‰ç”¨ï¼Œæ–°ç‰ˆæœ¬ä¹Ÿä¸å½±éŸ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;container-as-the-unit-of-management&#34;&gt;Container as the unit of management&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;è³‡æ–™ä¸­å¿ƒçš„é‡å¿ƒï¼Œå¾ç®¡ç†æ©Ÿå™¨è®Šæˆç®¡ç†æ‡‰ç”¨
&lt;ul&gt;
&lt;li&gt;æä¾›å½ˆæ€§çµ¦ infrastructure team
&lt;ul&gt;
&lt;li&gt;æä¾›çµ±ä¸€çš„æ¶æ§‹&lt;/li&gt;
&lt;li&gt;æ”¶é›†çµ±ä¸€çš„ metrics&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Container çµ±ä¸€çš„ä»‹é¢ï¼Œè®“ management system (ex. k8s) å¯ä»¥æä¾› generic APIs
&lt;ul&gt;
&lt;li&gt;REST API, HTTP, /healthz, exec&amp;hellip;&lt;/li&gt;
&lt;li&gt;çµ±ä¸€çš„ health check ä»‹é¢ï¼Œæ›´æ–¹ä¾¿çš„çµ‚æ­¢èˆ‡é‡å•Ÿ&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§
&lt;ul&gt;
&lt;li&gt;å®¹å™¨æä¾›çµ±ä¸€çš„è³‡è¨Šï¼Œex. status, text message, &amp;hellip;&lt;/li&gt;
&lt;li&gt;ç®¡ç†å¹³å°æä¾›çµ±ä¸€è¨­å®š (ex. resource limits) ï¼Œä¸¦é€²è¡Œ logging èˆ‡ monitoring
&lt;ul&gt;
&lt;li&gt;æä¾›æ›´ç²¾ç´°çš„åŠŸèƒ½ ex. graceful-termination&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;cgroups æä¾› app çš„è³‡æºä½¿ç”¨è³‡è¨Šï¼Œè€Œä¸éœ€è¦çŸ¥é“ app specï¼Œå› ç‚º contaier æœ¬èº«å³æ˜¯ app
&lt;ul&gt;
&lt;li&gt;æä¾›æ›´ç°¡å–®ï¼Œå»æ›´ç²¾ç´°ä¸”å …å›ºçš„ logging èˆ‡ monitoring&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‡‰ç”¨å°å‘çš„ monitoring ï¼Œè€Œä¸æ˜¯æ©Ÿå™¨å°å‘çš„ monitoring
&lt;ul&gt;
&lt;li&gt;å¯ä»¥æ”¶é›†è·¨ OS çš„ app ç‹€æ…‹ï¼Œé€²è¡Œæ•´åˆåˆ†æï¼Œè€Œä¸æœƒæœ‰ OS ä¸åŒé€ æˆçš„é›œè¨Š&lt;/li&gt;
&lt;li&gt;æ›´å®¹æ˜“å°æ‡‰ç”¨é™¤éŒ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;nested contaiers
&lt;ul&gt;
&lt;li&gt;resource allocation (aka. alloc in Borg, Pod in Kubernetes)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;orchestration-is-the-beginning-not-the-end&#34;&gt;Orchestration is the beginning, not the end&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åŸæœ¬ Borg åªæ˜¯è¦æŠŠ workload åˆ†é…åˆ°å…±ç”¨çš„æ©Ÿå™¨ä¸Šï¼Œä¾†æ”¹å–„ utilization
&lt;ul&gt;
&lt;li&gt;çµæœç™¼ç¾å¯ä»¥åšæ›´å¤šäº‹æƒ…ï¼Œä¾†å¹«åŠ©é–‹ç™¼èˆ‡éƒ¨ç½²
&lt;ul&gt;
&lt;li&gt;Naming, service discovery&lt;/li&gt;
&lt;li&gt;Application-aware load balancing&lt;/li&gt;
&lt;li&gt;Rollout tool&lt;/li&gt;
&lt;li&gt;Workflow tool&lt;/li&gt;
&lt;li&gt;Monitoring tool&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æˆåŠŸçš„å·¥å…·è¢«ç•™ä¸‹
&lt;ul&gt;
&lt;li&gt;ç„¶è€Œå·¥å…·éƒ½éœ€è¦å„è‡ªçš„ APIï¼Œå‰¯ä½œç”¨æ˜¯å¢åŠ éƒ¨ç½²çš„è¤‡é›œåº¦åˆ° Borg çš„ç”Ÿæ…‹ç³»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetese è©¦åœ–é™ä½è¤‡é›œåº¦
&lt;ul&gt;
&lt;li&gt;æä¾›ä¸€è‡´çš„ API
&lt;ul&gt;
&lt;li&gt;ex. ObjectMetadata, Specification, Status&lt;/li&gt;
&lt;li&gt;Object metadata æ˜¯å…¨åŸŸå…±é€šçš„&lt;/li&gt;
&lt;li&gt;Spec èˆ‡ Status æ ¹æ“š Object æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯æ¦‚å¿µæ˜¯ä¸€è‡´çš„
&lt;ul&gt;
&lt;li&gt;Spec æè¿° desired state of object&lt;/li&gt;
&lt;li&gt;Status æä¾› read-only çš„ current state of object&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Uniform API æœ‰è¨±å¤šå¥½è™•
&lt;ul&gt;
&lt;li&gt;é™ä½å­¸ç¿’æˆæœ¬&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨ generic çš„å·¥å…·è®“æ‰€æœ‰ workflow ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;çµ±ä¸€ä½¿ç”¨è€…çš„é–‹ç™¼æµç¨‹èˆ‡é–‹ç™¼ç¶“é©—&lt;/li&gt;
&lt;li&gt;Kubernetes æœ¬èº«æ¨¡çµ„åŒ–ï¼Œå¯ä»¥ä½¿ç”¨å»¶ä¼¸æ¨¡çµ„
&lt;ul&gt;
&lt;li&gt;ex. pod API è®“ä½¿ç”¨è€…ä½¿ç”¨ï¼Œkubernetes å…§éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨è‡ªå‹•åŒ–å·¥å…·ä¹Ÿä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è€…å¯ä»¥è‡ªå·±å¢åŠ  customized API&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é”åˆ° Uniform API
&lt;ul&gt;
&lt;li&gt;decoupling API
&lt;ul&gt;
&lt;li&gt;åˆ‡åˆ† API é—œæ³¨çš„é¢å‘ï¼Œè®Šæˆä¸åŒ components API. ex.
&lt;ul&gt;
&lt;li&gt;replication controller ç¢ºä¿ desired æ•¸é‡çš„ Pod å­˜åœ¨&lt;/li&gt;
&lt;li&gt;autoscaler é—œæ³¨åœ¨éœ€æ±‚èˆ‡ä½¿ç”¨çš„é æ¸¬ï¼Œç„¶å¾Œæ§åˆ¶ replication controller API&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;higher-level æœå‹™éƒ½å…±ç”¨ç›¸åŒçš„ basic API&lt;/li&gt;
&lt;li&gt;åˆ‡åˆ† API è€Œå¤–çš„å¥½è™•
&lt;ul&gt;
&lt;li&gt;æœ‰é—œè¯ä½†æ˜¯ç”¨é€”ä¸åŒçš„ API çš„å…§å®¹èˆ‡ä½¿ç”¨æ–¹å¼ååˆ†ç›¸ä¼¼. ex.
&lt;ul&gt;
&lt;li&gt;ReplicationController: æ§åˆ¶é•·æ™‚é–“é‹è¡Œçš„ containers èˆ‡å…¶è¤‡æœ¬&lt;/li&gt;
&lt;li&gt;DeamonSet: æ¯å€‹æ©Ÿå™¨ä¸Šéƒ½è·‘ä¸€å€‹ container&lt;/li&gt;
&lt;li&gt;Job: ä¸€æ¬¡æ€§åŸ·è¡Œå®Œç•¢çš„ container&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Common design patterns
&lt;ul&gt;
&lt;li&gt;ex. reconciliation controller loop åœ¨ Borg, Omega, Kubernetes ä¸­å¤§é‡ä½¿ç”¨
&lt;ul&gt;
&lt;li&gt;éœ€æ±‚(desired state)&lt;/li&gt;
&lt;li&gt;è§€å¯Ÿç¾æ³(current state)&lt;/li&gt;
&lt;li&gt;åŸ·è¡Œå‹•ä½œï¼Œæ”¶æ–‚éœ€æ±‚èˆ‡ç¾æ³(reconcile)&lt;/li&gt;
&lt;li&gt;loop&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”±æ–¼ç‹€æ…‹æ˜¯åŸºæ–¼å¯¦éš›è§€æ¸¬ç”¢ç”Ÿï¼Œreconciliation loop éå¸¸å …å›ºï¼Œå¯ä»¥æ‰¿å—ç›¸ç•¶çš„ failure&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes è¨­è¨ˆç‚ºä¸€é€£ä¸²çš„ç‚ºæœå‹™ç³»çµ±ï¼Œä»¥åŠè¨±å¤šå°å‹çš„ control loop
&lt;ul&gt;
&lt;li&gt;å°æ¯”å¤§å‹çš„ centralized orchestration system&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;things-to-avoid&#34;&gt;Things to avoid&lt;/h1&gt;
&lt;p&gt;Google é–‹ç™¼éç¨‹ä¸­ï¼Œä¹Ÿç™¼ç¾è¨±å¤šä¸è©²åšçš„äº‹æƒ…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦ä½¿ç”¨ conainer system ä¾†ç®¡ç† port numbers
&lt;ul&gt;
&lt;li&gt;Borg æœƒæŒ‡å®š unique port number çµ¦æ¯å€‹ container
&lt;ul&gt;
&lt;li&gt;å¿…é ˆç”¨å…¶ä»–æ–¹æ³•å–ä»£ DNS&lt;/li&gt;
&lt;li&gt;port ä¹Ÿä¸æ˜“åµŒå…¥ URL ä¸­ï¼Œè¦å¦å¤–è™•ç†è½‰å€&lt;/li&gt;
&lt;li&gt;éœ€è¦è€Œå¤–çš„ç³»çµ±è™•ç† ip:port&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes é¸æ“‡æŒ‡æ´¾ IP çµ¦ Pod
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ç›´æ¥ä½¿ç”¨å¸¸ç”¨ port (ex. 80,443)&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨å…§éƒ¨ DNSï¼Œä½¿ç”¨ä¸€èˆ¬å¸¸ç”¨çš„å·¥å…·&lt;/li&gt;
&lt;li&gt;å¤§éƒ¨åˆ†å…¬æœ‰é›²éƒ½æä¾› networking underlaysï¼Œé”æˆ Ip-per-pod&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨ DNS overlay æˆ–æ˜¯ L3 routingï¼Œä¾†æ§åˆ¶ä¸€å°æ©Ÿå™¨ä¸Šçš„å¤šå€‹ IPs&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸è¦å¹« container ç·¨è™Ÿï¼Œä½¿ç”¨ label ä¾†ç®¡ç†å¤§é‡çš„ container
&lt;ul&gt;
&lt;li&gt;Borg æœƒå¹« job å¾ 0 é–‹å§‹ç·¨è™Ÿ
&lt;ul&gt;
&lt;li&gt;å¾ˆç›´è¦ºå¾ˆç›´æ¥ï¼Œä½†ç¨å¾Œå°±å¾Œæ‚”äº†
&lt;ul&gt;
&lt;li&gt;å¦‚æœ job æ­»äº†ï¼Œé‡å•Ÿæ–°çš„ job åœ¨æ©Ÿå™¨ä¸Šå¾Œï¼Œé‚„éœ€è¦å»æ‰¾ä¸Šå€‹æ­»æ‰çš„ job&lt;/li&gt;
&lt;li&gt;task ä¸­é–“æœƒæœ‰å¾ˆå¤šæ´ (æ­»æ‰çš„ job)&lt;/li&gt;
&lt;li&gt;æ›´æ–°ç‰ˆæœ¬ï¼Œè¦æ›´æ–° jobs æ™‚æœƒä¾åºé‡å•Ÿ jobs&lt;/li&gt;
&lt;li&gt;è³‡æ–™å¦‚æœä¹Ÿæ˜¯æ ¹æ“š index åš shardingï¼Œé‡å•Ÿæ™‚è¦å¾©åŸ indexï¼Œä¸ç„¶æœƒæœ‰è³‡æ–™éºå¤±&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes ä½¿ç”¨ label
&lt;ul&gt;
&lt;li&gt;å¯ä»¥é€é label ç®¡ç†ä¸€çµ„ container&lt;/li&gt;
&lt;li&gt;ä¸€å€‹ container å¯ä½¿ç”¨å¤šå€‹ labelsï¼Œæ›´æ–¹ä¾¿çš„èª¿åº¦&lt;/li&gt;
&lt;li&gt;éœ€è¦çš„è³‡è¨Šæ‰“åœ¨ label ä¸Š (ex. role assignments, work-partitioning, sharding&amp;hellip;)ï¼Œæ›´å®¹æ˜“ç®¡ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ³¨æ„æ‰€æœ‰æ¬Š
&lt;ul&gt;
&lt;li&gt;Borg ä¸Šï¼Œtasks éƒ½ç¶å®šåœ¨ job ä¸Šï¼Œç”¢ç”Ÿ job ä¹Ÿç”¢ç”Ÿ tasks
&lt;ul&gt;
&lt;li&gt;å¾ˆç›´è¦ºæ–¹ä¾¿&lt;/li&gt;
&lt;li&gt;åªå‰©ä¸‹ä¸€ç¨® group æ§åˆ¶æ©Ÿåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes çš„ pod-lifecycle management (ex. replication controller) ä½¿ç”¨ label selector ä¾†æ§åˆ¶ pod
&lt;ul&gt;
&lt;li&gt;å¯ä»¥å½ˆæ€§æ§åˆ¶å¤§é‡ pod&lt;/li&gt;
&lt;li&gt;å¯èƒ½æœ‰å¤šå€‹ä¸Šå±¤ controller æ§åˆ¶åŒä¸€å€‹ podï¼Œè¦ç›¡é‡é¿å…é€™ç¨®æƒ…æ³&lt;/li&gt;
&lt;li&gt;å¥½è™•æ˜¯ä¿ç•™å½ˆæ€§çš„åŒæ™‚ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šç•Œå®šç®¡ç†çš„ podï¼Œä¸æœƒæœ‰ orphan / adapt pod&lt;/li&gt;
&lt;li&gt;é€é label é€²è¡Œ service load balance
&lt;ul&gt;
&lt;li&gt;å¦‚æœ pod æœ‰å•é¡Œï¼Œå¯ä»¥è®Šæ›´ labelï¼Œè®“æµé‡ä¸è¦é€²ä¾†ï¼Œä½†åˆä¿ç•™ Pod debug&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸è¦æš´éœ² raw state
&lt;ul&gt;
&lt;li&gt;Borgmaster æ˜¯ monolithicï¼Œå¯è¦‹æ‰€æœ‰çš„ API Operation&lt;/li&gt;
&lt;li&gt;Omega ä¸æ˜¯ centralizedï¼Œåªä¿ç•™è¢«å‹•çš„è³‡è¨Šï¼Œä½¿ç”¨ optimistic concurrent control
&lt;ul&gt;
&lt;li&gt;state å­˜åˆ° client storeï¼Œä¸¦åŸºæ–¼ state é€²è¡Œ operation&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ client éœ€è¦ä½¿ç”¨ä¸€æ¨£çš„ client store library&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes èµ°ä¸­é–“
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰ state å­˜å–éœ€è¦é€é centralized API server&lt;/li&gt;
&lt;li&gt;client components å¯ä»¥ç¨ç«‹é‹ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;some-open-hard-problems&#34;&gt;Some open, hard problems&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;configuration&lt;/li&gt;
&lt;li&gt;dependency management&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2020 08 Season Review</title>
      <link>https://chechia.net/zh-hant/post/2020-08-19-season-review/</link>
      <pubDate>Wed, 19 Aug 2020 10:01:31 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-08-19-season-review/</guid>
      <description>&lt;p&gt;å­£ä¸­å›é¡§&lt;/p&gt;
&lt;p&gt;é€™ä¸€å­£é–‹äº†å¾ˆå¤šæ–°å‘ï¼Œå»ä¾†ä¸åŠå¯«æ–‡ç« å¡«ä¸Š&lt;/p&gt;
&lt;p&gt;å®Œæˆçš„æœ‰ Terraform çš„åŸºç¤èˆ‡å¯¦å‹™å°å…¥ç¶“é©—&lt;/p&gt;
&lt;p&gt;æ­£åœ¨è¶•å·¥çš„æœ‰ hashicorp vaultï¼ŒGitopsï¼Œèˆ‡ tlsã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ GitOps å·²ç¶“æœ‰å¼·è€…æˆ‘æœ‹å‹ Hwchiu å·¨å·¨å¡«å‘äº†ï¼Œæˆ‘é€™é‚Šå°±æœƒå·æ‡¶è·³éã€‚&lt;a href=&#34;https://hwchiu.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‹æƒ…é€£çµ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‰©ä¸‹çš„å¸Œæœ›æœ¬å­£çµæŸå‰èƒ½å¡«å®Œ(æ©é¢)&lt;/p&gt;
&lt;h1 id=&#34;å·²å¡«å‘&#34;&gt;å·²å¡«å‘&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch/posts/185733642920123&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾é›¶é–‹å§‹å°å…¥ Terraform&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;DevOps Taiwan Meetup&lt;/li&gt;
&lt;li&gt;iThome Cloud Summit&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ–°å‘ç¢¼è¾²æ­£åœ¨è€•ç”°æŒ–å‘è‡ªå·±è·³&#34;&gt;æ–°å‘ï¼Œç¢¼è¾²æ­£åœ¨è€•ç”°ï¼ŒæŒ–å‘è‡ªå·±è·³&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;hashicorp vault
&lt;ul&gt;
&lt;li&gt;install&lt;/li&gt;
&lt;li&gt;basic operation&lt;/li&gt;
&lt;li&gt;Sign &amp;amp; manage x509 certificate with pki secret engine&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¡«å‘ä¸­æ–‡ç« å°šæœªå®Œæˆ&#34;&gt;å¡«å‘ä¸­ï¼Œæ–‡ç« å°šæœªå®Œæˆ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;aws&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;post/play-aws-eks-with-low-cost: ç²¾ç®—å°ç¥ç«¥ï¼Œå¦‚ä½•ç”¨æœ€å°‘çš„ credits ç© aws eks æœå‹™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;tls&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;post/openssl-self-sign-tls-with-own-ca&lt;/li&gt;
&lt;li&gt;post/k8s-manage-tls-certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;gitOps&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;post/gitops-with-argo-cd&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;terraform&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;post/terraform-infrastructure-as-code-module&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kubernetes&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;borg, omega, and kubernetes&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä½œè€…å¤–å‡ºå–æä¸­&#34;&gt;ä½œè€…å¤–å‡ºå–æä¸­&amp;hellip;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;MIT 6.824 Distributed System Learning Note&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Terraform Infrastructure as Code Transcript</title>
      <link>https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/</link>
      <pubDate>Mon, 15 Jun 2020 10:58:56 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å„ä½å¥½&lt;/p&gt;
&lt;h1 id=&#34;about-this-presentation&#34;&gt;About this presentation&lt;/h1&gt;
&lt;p&gt;é–‹å§‹ä¹‹å‰ï¼Œå…ˆåˆ†äº«ä¸€äº›è³‡æº&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ•å½±ç‰‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¬›ç¨¿&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¨‹å¼ç¢¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground/blob/master/SOP.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOP ç¯„æœ¬&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Facebook ç²‰å°ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éƒ½æ”¾åœ¨é€™è£¡ï¼Œå› ç‚ºæœ‰é™„é€å­—ç¨¿ï¼Œæ‰€ä»¥å¦‚æœå¾ˆå¿™çš„æœ‹å‹ï¼Œæƒäº† QR code å°±å¯ä»¥å›å®¶è‡ªå·±çœ‹äº†ï¼Œä¸ç”¨å®¢æ°£ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œæœ‰èˆˆè¶£åœ¨è¿½é€™ç³»åˆ—æ–‡ç« çš„ï¼Œå¯ä»¥å¹«æˆ‘ facebook ç²‰å°ˆæŒ‰å€‹è®šè·Ÿè¿½è¹¤ï¼Œæ¯å‘¨æ–°æ–‡ç« å‡ºä¾†ï¼Œæœƒæ¨æ’­é€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ç« åœ¨ chechia.net ä¸Šï¼Œæ–°æ–‡ç« é€šçŸ¥é  facebook ç²‰å°ˆé€™æ¨£ã€‚ä¹Ÿå¯ä»¥åªè¿½è¹¤ä¸æŒ‰è®šã€‚æˆ‘è‡ªå·±çœ‹åˆ¥äººæŠ€è¡“ blog ä¹Ÿå¾ˆå¸¸é€™æ¨£(XD&lt;/p&gt;
&lt;h2 id=&#34;éœ€æ±‚&#34;&gt;éœ€æ±‚&lt;/h2&gt;
&lt;p&gt;å¥½ï¼Œä»Šå¤©ä¾†è¬›å¾—é€™å€‹ Terraform&lt;/p&gt;
&lt;p&gt;æˆ‘æœƒå¯¦éš›åˆ†äº«æˆ‘å€‘å…¬å¸ç‚ºé›²åœ˜éšŠå°å…¥çš„ç¶“é©—ï¼Œå‰åŠéƒ¨æœƒæœ‰é»åƒè³¼ç‰©é »é“çš„å»£å‘Š&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹çš„å°è©±æ˜¯ä¸æ˜¯å¸¸å‡ºç¾åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;ä»¥ä¸‹é€™æ®µå°è©±å¾ˆè€³ç†Ÿ&#34;&gt;ä»¥ä¸‹é€™æ®µå°è©±å¾ˆè€³ç†Ÿï¼Ÿ&lt;/h1&gt;
&lt;p&gt;ã€Œæ˜¯èª°æ”¹äº†é€™å€‹è¨­å®šï¼Ÿã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;by é€±ä¸€ä¸Šç­çš„ DevOps èˆ‡é€±å…­å€¼ç­çš„ç¶­é‹åœ˜éšŠ&lt;/li&gt;
&lt;li&gt;å°å•Ÿç”¨çš„ç’°å¢ƒçš„æŒæ¡å¦‚ä½•&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒçš„è®Šæ›´èƒ½å¦æ°¸ä¹…ä¿å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ã€Œé€™å€‹ç’°å¢ƒæ€éº¼å°‘ä¸€å€‹è¨­å®šï¼Ÿã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¶²ç«™å™´éŒ¯å¾Œï¼Œæ•´å€‹åœ˜éšŠä¸€æ­¥æ­¥é‡æ¸…å•é¡Œï¼Œä¸æ˜¯ codeï¼Œä¸æ˜¯è®Šæ•¸configï¼Œæ˜¯ infra æœ‰ä¸€å€‹å°åœ°æ–¹æ²’è¨­å®š&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒè¤‡é›œï¼Œä»¥æˆ‘å€‘çš„ä¾‹å­æ˜¯è¤‡é›œå¾—å¤šé›²ç¶²è·¯ï¼Œå¸¸å‡ºé€™ç¨®å•é¡Œ&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒè¨­å®šçš„é™¤éŒ¯å¾ˆè²»æ™‚&lt;/li&gt;
&lt;li&gt;å®Œå…¨å¯ä»¥é¿å…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ã€Œæœƒå‹•å°±å¥½ï¼Œæ²’äº‹ä¸è¦æ”¹ç’°å¢ƒï¼ˆæŠ–ï¼‰ã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Legacy site&lt;/li&gt;
&lt;li&gt;èª¿æ•´ production ç’°å¢ƒæ˜¯å¦æœ‰ä¿¡å¿ƒ&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘çœ‹ä¸æ…£ç„¡äººæ•´ç†çš„èˆŠæ¶æ§‹ï¼Œå°å…¥ terraform å¾Œï¼Œï¼ˆå¾ˆä¸è¦å‘½çš„ï¼‰æŠŠ production site æ¬éä¸€é&lt;/li&gt;
&lt;li&gt;æˆ‘æœ‰åæˆçš„ä¿¡å¿ƒè·Ÿä½ èªªæ–°èˆŠå…©å€‹ site å®Œå…¨ä¸€æ¨£&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;our-stories&#34;&gt;Our stories&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘æ˜¯æ€è¯ç§‘æŠ€(ï¼¸ï¼¤)&lt;/li&gt;
&lt;li&gt;é–‹ç™¼åœ˜éšŠå¤§æ¦‚ 100+ å€‹å·¦å³&lt;/li&gt;
&lt;li&gt;å°ˆæ¡ˆå¾ˆå¤šï¼Œè€Œä¸”è€é—†å¾ˆå–œæ­¡é–‹æ–°å°ˆæ¡ˆæ¸¬è©¦å•†æ¥­æ¨¡å‹&lt;/li&gt;
&lt;li&gt;ç’°å¢ƒä¹Ÿè¶Šé–‹è¶Šå¤šï¼Œå¤§å¤§å°å°å¹¾ç™¾å° vmï¼Œå¹¾åå€‹è³‡æ–™åº«ï¼Œéƒ½æ˜¯ä¸åŒå°ˆæ¡ˆåœ¨è·‘ï¼Œè¦æ¨¡å¤§æ¦‚é€™æ¨£&lt;/li&gt;
&lt;li&gt;æ¯é€±éƒ½æœ‰æ–°ç’°å¢ƒè¦äº¤ä»˜&lt;/li&gt;
&lt;li&gt;äº¤æ¥ç¼ºå£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å€‘å…¬å¸æ±è¥¿å¤šï¼Œä½†æ±è¥¿å¤šä¸æ˜¯å•é¡Œï¼Œå•é¡Œæ˜¯ä»€éº¼å‘¢?&lt;/p&gt;
&lt;h1 id=&#34;å•é¡Œ&#34;&gt;å•é¡Œ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ‰‹å‹•éƒ¨å±¬æœ¬ä¾†ä¸æ˜¯å•é¡Œï¼Œä½†æ¼¸æ¼¸æˆç‚ºå•é¡Œ
&lt;ul&gt;
&lt;li&gt;é–‹ infrastructure çš„æ–¹æ³•ï¼Œè·Ÿè‘— SOP ä¸Šå» GCP GUI ä»‹é¢ï¼Œé»ä¸€é»ï¼Œå¡«ä¸€å¡«ã€‚å…¬æœ‰é›²é–‹æ©Ÿå™¨å¾ˆæ–¹ä¾¿ã€‚&lt;/li&gt;
&lt;li&gt;å¯æ˜¯ä¸åŒäººé–‹çš„ç’°å¢ƒæ¼¸æ¼¸å‡ºç¾ä¸€äº›ä¸åŒï¼Œå¯èƒ½å·®ä¸€å€‹è¨­å®šã€ä¸€å€‹åƒæ•¸ã€æˆ–æ˜¯å‘½åè¦å‰‡å·®ä¸€é»ã€‚é€™äº›ç´°ç¯€çš„ä¸åŒï¼Œå·®ä¸€å€‹ config æœ‰æ™‚å€™å°±æœƒé›·åˆ°äººã€‚ã€Œé€™æ©Ÿå™¨èª°å»ºçš„é˜¿ï¼Œæ ¹æœ¬æœ‰å•é¡Œå•Šã€ï¼Œè€Œä¸”é€™ç¨®é›·å¾ˆå¤šæ™‚å€™éƒ½æ˜¯è·‘ä¸‹å»å‡ºäº‹äº†ï¼Œæ‰ç™¼ç¾ã€Œé˜¿é åŸä¾†è¨­å®šä¸ä¸€æ¨£ã€&lt;/li&gt;
&lt;li&gt;å‘½åå·®ä¸€é»ä¸å½±éŸ¿åŠŸèƒ½ï¼Œä½†çœ‹ä¹…äº†å°±å¾ˆç…©ï¼Œã€Œé˜¿å°±å°ä¸é½Šé˜¿ã€ï¼Œæœ‰å¼·è¿«ç—‡å°±å¾ˆç—›è‹¦ã€‚ç„¶å¾Œä½ ç¶­é‹çš„è‡ªå‹•åŒ–è…³æœ¬å°±çˆ†æ‰ï¼Œå‘½åå·®ä¸€å€‹å­—ï¼Œregex å°±è¦å¤§æ”¹ã€‚çªç„¶å¢åŠ ç¶­é‹æˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”Ÿç”¢ç’°å¢ƒå¤§å®¶éƒ½ä¸å¤ªæ•¢å‹•ã€‚æ¶æ§‹èª¿æ•´å¾ˆæ²’ä¿¡å¿ƒ
&lt;ul&gt;
&lt;li&gt;èª°çŸ¥é“ç•¶åˆç’°å¢ƒè¨­å®šäº†é‚£äº›æ±è¥¿ï¼Œé–‹æ©Ÿå™¨çš„äººé›¢è·äº†ï¼Œä¹Ÿä¸çŸ¥é“ä»–ç‚ºå•¥è¨­å®šï¼Œã€Œä½ çŸ¥é“ä»–ç•¶åˆç‚ºä»€éº¼è¦è¨­å®šé€™å€‹å—?ã€ï¼Œä½ å•æˆ‘æˆ‘æ˜¯è¦å»æ“²èŒ­å–”ã€‚
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘é€™ä¸€å­£æŠŠæ‰€æœ‰ç¾æœ‰ç’°å¢ƒéƒ½æ¬åˆ°æ–°çš„æ¶æ§‹ä¸Šï¼Œå› ç‚ºæˆ‘å€‘å°èˆŠæ¶æ§‹ä¸çˆ½å¾ˆä¹…äº†(XD)ï¼Œé€™å€‹èƒ½åšåˆ°ç•¶ç„¶æœ‰ä½œæ³•ï¼Œå¾Œé¢ç´°è¬›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰å¯¦éš›éœ€æ±‚æ‰æ‰¾è§£æ±ºæ–¹æ¡ˆï¼Œæ²’æœ‰éœ€æ±‚å°±ä¸ç”¨è¡å‹•å°å…¥æ–°æŠ€è¡“ï¼Œå°å…¥éç¨‹ä¸­é‚„æ˜¯è »ç´¯çš„&lt;/p&gt;
&lt;h1 id=&#34;éœ€æ±‚-1&#34;&gt;éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;å¾ç¶­é‹çš„è§’åº¦ï¼Œéœ€æ±‚å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æå‡ç©©å®šåº¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;infra äº¤ä»˜æ¨™æº–åŒ–&lt;/li&gt;
&lt;li&gt;äº¤ä»˜è‡ªå‹•åŒ–&lt;/li&gt;
&lt;li&gt;æ¸¬è©¦ç’°å¢ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;infra æäº¤è¦èƒ½å¤  review&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æå‡æ•ˆç‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è€é—†è¦çš„ã€‚è¶…å¿«éƒ¨å±¬ï¼Œè…³æœ¬è·‘ä¸‹å»è¦å¿«ï¼Œé‚„è¦æ›´å¿«&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¬¡è¦ç›®æ¨™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆæœ¬ï¼Œæ•ˆèƒ½æœ€ä½³åŒ–ï¼Œå¸Œæœ›èƒ½åœ¨æ•´ç†éç¨‹ä¸­ï¼Œæ‰¾åˆ°æœ€é©åˆçš„å¯è¡Œæ¶æ§‹&lt;/li&gt;
&lt;li&gt;æ–°äººå¥½ä¸Šæ‰‹ï¼ŒJunior åŒäº‹ä¹Ÿèƒ½ã€Œå®‰å…¨ã€çš„æ“ä½œï¼Œçœ‹åˆ°é€™å€‹å®‰å…¨å…©å€‹å­—äº†å—? å®‰å…¨ç¬¬ä¸€ï¼Œåœ¨è¨“ç·´æ–°çš„ op æ™‚è¦æ³¨æ„å®‰å…¨ï¼Œä¸ç„¶ä»–ä¸Šå» GUI é»ä¸€é»ï¼Œä¸€å€‹æ‰‹èµ·åˆ€è½ DB å°±ä¸è¦‹äº†ï¼Œæ•´å€‹ç¶­é‹åœ˜éšŠä¸€å‘¨ä¸ç”¨ç¡è¦ºã€‚å®‰å…¨ç¬¬ä¸€å¼ã€‚&lt;/li&gt;
&lt;li&gt;æ¬Šé™æ§ç®¡ï¼ŒIAM ä¹Ÿç”¨ terraform ç®¡ç†ï¼Œæ¬Šé™ç®¡ç†äººå¤šæ‰‹é›œè¶Šç”¨è¶Šäº‚ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ IaCï¼Œä¸€è¦½ç„¡éº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;programatical-approach-for-infra&#34;&gt;Programatical approach for infra&lt;/h1&gt;
&lt;p&gt;å•Šä¸å°±æ˜¯ Infrastructure as code XD&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å…¥å‰ï¼Œå¤§å®¶éƒ½æœ‰è½éï¼Œå¤§å®¶éƒ½è¦ºå¾—å¾ˆæƒ³å°å…¥ï¼Œä½†æ²’äººæœ‰ç¶“é©—ï¼Œæ¯å€‹äººéƒ½è¶…æ€•ï¼Œä½†åˆä¸çŸ¥é“åœ¨æ€•ä¸‰å°&lt;/li&gt;
&lt;li&gt;é€™è¡¨æ˜äº†ä¸€ä»¶äº‹ï¼Œå¤§å®¶éƒ½çŸ¥é“è¦åšå°çš„äº‹æƒ…ï¼Œä½†ä¸æ˜¯æ¯å€‹äººéƒ½èƒ½æ”¹è®Šç¾æ³ï¼Œè®“åœ˜éšŠå°å‘å°çš„äº‹æƒ…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¨ˆç•«&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¢ºå®šéœ€æ±‚&lt;/li&gt;
&lt;li&gt;é–‹å§‹ survey&lt;/li&gt;
&lt;li&gt;ã€Œå°å¿ƒã€å°å…¥&lt;/li&gt;
&lt;li&gt;æœ‰ç¶“é©—é ˜é ­ç¾Šå¾ˆæ£’ï¼Œä½†ä¸æ˜¯å¿…é ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æŠ€è¡“ç´°ç¯€&#34;&gt;æŠ€è¡“ç´°ç¯€&lt;/h2&gt;
&lt;p&gt;å…ˆç°¡å–®è¬›ä¸€ä¸‹ IaC (Yeah çµ‚æ–¼è¦è¬›æŠ€è¡“äº†)&lt;/p&gt;
&lt;h1 id=&#34;iac&#34;&gt;IaC&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢éƒ½è¬›æ¦‚å¿µè·Ÿå¿ƒæ³•ï¼Œç¾åœ¨å¯¦éš›è¬›ç”¨åˆ°çš„æŠ€è¡“ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯ Infrastructure as Codeï¼Œé€™å€‹æ¦‚å¿µå¾ˆä¹…äº†ï¼Œä½†å°å…¥çš„å…¬å¸å¥½åƒä¸æ˜¯é‚£éº¼å¤šã€‚æ‰€ä»¥æˆ‘ä»Šå¤©è¦ä¾†å‚³æ•™ï¼Œæ´—è…¦å¤§å®¶(XDï¼Œè·Ÿä½ æ¨è–¦é€™å€‹é…æ–¹ä¿è­‰å¿«åˆæœ‰æ•ˆ(XD)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡å–®ä¾†èªªå°±æ˜¯ç”¨ç¨‹å¼ä¾†æ“ä½œ infrastructureï¼Œä»Šå¤©ä¸»è¬›çš„ terraform æ˜¯ IaC å·¥å…·ä¸­çš„ä¸€å€‹&lt;/li&gt;
&lt;li&gt;IaC å·¥å…·å¯ä»¥æ˜¯å®£å‘Šå¼ï¼Œæˆ–æ˜¯å‘½ä»¤å¼ï¼Œæˆ–æ˜¯å…©ç¨®éƒ½æ”¯æ´
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹æ˜¯æˆ‘å‘Šè¨´ä½ çµæœï¼Œæ­¥é©Ÿæˆ‘ä¸ç®¡ï¼Œè«‹ä½ å¹«æˆ‘ç”Ÿå‡ºé€™æ¨£çš„çµæœã€‚&lt;/li&gt;
&lt;li&gt;ä¸€å€‹æ˜¯æˆ‘å‘Šè¨´ä½ æ­¥é©Ÿï¼Œä½ ä¸€æ­¥ä¸€æ­¥å¹«æˆ‘åšå®Œï¼Œå°±æœƒå¾—åˆ°æˆ‘è¦çš„çµæœ&lt;/li&gt;
&lt;li&gt;terraform æ˜¯å®£å‘Šå¼ï¼Œèªªæ˜é‚è¼¯è·Ÿçµæœï¼Œä¾‹å¦‚æˆ‘è¦ 1 2 3 å°æ©Ÿå™¨ï¼Œterraform è‡ªå·±å»å¹«æˆ‘æ‰“ Google API é€™æ¨£ï¼ŒæŠŠæ©Ÿå™¨ç”Ÿå‡ºä¾†&lt;/li&gt;
&lt;li&gt;ansible æ˜¯å‘½ä»¤å¼ï¼Œæˆ‘æŠŠæ­¥é©Ÿå¯«æˆä¸€å †å‘½ä»¤è…³æœ¬ playbook ï¼Œansible å¹«æˆ‘ç…§è‘—è·‘ä¸‹å»ï¼Œç†è«–ä¸Šè·‘å®Œå¾Œæˆ‘çš„æ©Ÿå™¨ä¹Ÿæº–å‚™å¥½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;terraform&#34;&gt;Terraform&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å®˜ç¶²åœ¨é€™é‚Šï¼Œè‡ªå·±çœ‹ &lt;a href=&#34;https://www.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å®£å‘Šå¼çš„ Iac å·¥å…·&lt;/li&gt;
&lt;li&gt;å–®ä¸€èªæ³•æè¿°å„å®¶ API&lt;/li&gt;
&lt;li&gt;é€é provider è½‰æ› tf æˆç‚º API call&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;terraform-core-workflow&#34;&gt;Terraform Core Workflow&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/guides/core-workflow.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/guides/core-workflow.html&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Write æ’°å¯«æœŸå¾…ç‹€æ…‹ tf file&lt;/li&gt;
&lt;li&gt;plan è¨ˆç•«è©¦ç®—çµæœ&lt;/li&gt;
&lt;li&gt;apply ç”¨æœŸå¾…ç‹€æ…‹å»æ›´æ–°é ç«¯
&lt;ul&gt;
&lt;li&gt;tf fileï¼Œå°±æ˜¯å®£å‘Šå¼çš„è¡¨é” infra ï¼Œæè¿°æœŸå¾…çš„infraé•·é€™æ¨£ï¼Œex. tf file è£¡æœ‰é€™äº›æ©Ÿå™¨ 1 2 3 å°é€™æ¨£
&lt;ul&gt;
&lt;li&gt;resource ä¸€å€‹ä¸€å€‹ç‰©ä»¶æè¿°ï¼Œå¾Œé¢å¯èƒ½æ˜¯å°æ˜  provider çš„ API Endpoint (ex. GCP GKE API)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;remote resourcesï¼Œæ˜¯çœŸå¯¦å­˜åœ¨é ç«¯çš„æ©Ÿå™¨ï¼Œä¾‹å¦‚ GCP é›²ç«¯å¯¦éš›ä¸Šåªæœ‰ 1 2 å…©å°é€™æ¨£ã€‚&lt;/li&gt;
&lt;li&gt;terraform diff tf vs remoteï¼Œç®—å‡º planï¼Œå°‘çš„ç”Ÿå‡ºä¾†ï¼Œå¤šçš„ä¸Šå»ç æ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;demo-1&#34;&gt;Demo 1&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;(empty project)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;add my-gce.tf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git diff&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;state&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;check GUI remote&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;existing my-gce&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;remove my-gce.tf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plan&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€™é‚Šä¸ apply æˆ‘ demo é‚„è¦ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šé€™æ¨£æœ‰ç†è§£ terraform çš„åŸºæœ¬æµç¨‹å—ï¼Ÿç·¨å¯«ï¼Œè¨ˆç•«ï¼Œapply ä¸‰æ­¥é©Ÿ
å¾ˆå–®ç´”
ç„¶å¾Œè¬›ä¸€é»ç´°ç¯€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;state&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;remove (out of scope)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plan -&amp;gt; addd&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apply (deplicated ID)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mv state (Danger)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;rename state with the same ID -&amp;gt; destroy and recreate (Danger)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;state&#34;&gt;State&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;terraform ç¶“æ‰‹(apply) éçš„ resource æœƒç´å…¥ state (scope)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸åœ¨ scope è£¡çš„ resource ä¸æœƒç´å…¥ planï¼Œä¸æœƒè¢« destroyï¼Œä½†å¯èƒ½æœƒ create duplicated ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;terraform å…è¨±ç›´æ¥æ“ä½œ state&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;import&lt;/li&gt;
&lt;li&gt;remove&lt;/li&gt;
&lt;li&gt;ä½†æˆ‘ä¸å…è¨±XD&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„æ˜¯ diff state å–”ï¼Œæ‰€ä»¥æ¯æ¬¡ plan æ™‚å€™æœƒè‡ªå‹• refresh state&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;state åˆæ˜¯ä»€éº¼? remote æ˜¯ä¸€å€‹å‹•æ…‹ç’°å¢ƒï¼Œå¯èƒ½æœƒå¤šæœƒå°‘ï¼Œé€™æ¨£æ²’è¾¦æ³• diffï¼Œstate æ˜¯æŠŠæˆ‘åŸ·è¡Œç•¶ä¸‹ï¼Œé ç«¯ç›¸é—œè³‡æºçš„ç‹€æ…‹å¿«ç…§å­˜èµ·ä¾†ï¼Œç„¶å¾Œæ ¹æ“šé€™å€‹ snapshop å» diff&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apply åªæ˜¯æ‹¿ä½ çš„æœŸå¾…å» diff stateï¼Œterraform å¹«ä½ ç®—å‡ºä¾†å·®å¤šå°‘ï¼Œä¾‹å¦‚æˆ‘å€‘é€™é‚Šå°±æ˜¯é ç«¯å°‘ä¸€å°ã€‚terraform é€é provider å»çŸ¥é“ï¼Œå–”é€™ä¸€å°è¦å»æ‰“é‚£äº› GCP APIï¼ŒæŠŠé€™å°ç”Ÿå‡ºä¾†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Stateï¼Œæ˜¯æ ¸å¿ƒæ¦‚å¿µï¼Œæˆ‘ç•¶åˆè‡ªå·±å¡è§€å¿µæ˜¯å¡é€™é‚Šï¼Œæ‰€ä»¥æˆ‘ç‰¹åˆ¥æ‹‰å‡ºä¾†è¬›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›²ç«¯ç©ºè•©è•©ï¼Œrefresh state ä¹Ÿæ˜¯ç©ºçš„ï¼Œtf file å¤šåŠ ä¸€å€‹ VMï¼Œplan è¦ºå¾—è¦ create&lt;/li&gt;
&lt;li&gt;é›²ç«¯æœ‰æ±è¥¿ï¼Œrefresh state æœªå¿…æœƒ refresh åˆ°
&lt;ul&gt;
&lt;li&gt;ç›¸åŒ ID çš„è³‡æºä¹‹å‰ import åœ¨ state ä¸­ï¼Œrefresh stateï¼Œtf file æ²’æ±è¥¿ï¼Œplan è¦ºå¾—è¦ destroy&lt;/li&gt;
&lt;li&gt;ç›¸åŒ ID çš„è³‡æºä¸åœ¨ state ä¸­ï¼Œé€™äº› resource ä¸åœ¨ç•¶å‰ state çš„ scopor ä¸­ï¼Œrefresh state æ˜¯ç©ºçš„ï¼Œtf file æ²’æ±è¥¿ï¼Œplan è¦ºå¾—æ²’å¢æ²’æ¸›&lt;/li&gt;
&lt;li&gt;ç›¸åŒ ID çš„è³‡æºä¸åœ¨ state ä¸­ï¼Œé€™äº› resource ä¸åœ¨ç•¶å‰ state çš„ scopor ä¸­ï¼Œrefresh state æ˜¯ç©ºçš„ï¼Œtf file æœ‰ç›¸åŒ ID çš„è³‡æºï¼Œplan è¦ºå¾—è¦ createï¼Œä½†å¯¦éš› applyï¼ŒAPI error é ç«¯å·²ç¶“æœ‰ç›¸åŒ ID çš„è³‡æºå­˜åœ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Write -&amp;gt; Plan -&amp;gt; Apply&lt;/li&gt;
&lt;li&gt;State&lt;/li&gt;
&lt;li&gt;å¤§å®¶éƒ½æœƒ terraform æƒ¹&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;åˆæ­¥ä½¿ç”¨æ„Ÿæƒ³&#34;&gt;åˆæ­¥ä½¿ç”¨æ„Ÿæƒ³&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;IaC åœ°ç«¯è·Ÿé›²ç«¯éƒ½èƒ½åšï¼Œä½†é›²ç«¯åšèµ·ä¾†æ•ˆæœè¶…ç´šå¥½
&lt;ul&gt;
&lt;li&gt;å®Œå…¨å±•ç¾é›²ç«¯é‹ç®—çš„ç‰¹æ€§ï¼Œè¿…é€Ÿã€å½ˆæ€§ã€éš¨ç”¨éš¨å«ï¼Œèª¿åº¦å¤§é‡çš„è™›æ“¬åŒ–è³‡æº&lt;/li&gt;
&lt;li&gt;æ–°å¢æ±è¥¿å¾ˆå¿«ï¼Œä¸è¦çš„è³‡æºï¼Œè¦åˆªæ‰ä¹Ÿå¾ˆå¿«
&lt;ul&gt;
&lt;li&gt;ä¸å°å¿ƒåˆªéŒ¯ä¹Ÿå¾ˆå¿«(å¤§èª¤)ï¼Œæ‰€ä»¥æˆ‘èªªæ–°äººä¸€å€‹æ‰‹èµ·åˆ€è½å…¬å¸æ•´å€‹é›²å¼„ä¸è¦‹ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼Œã€Œå•Šæˆ‘çš„é›²å‹’ã€ã€Œè¢« terraform ç äº†ã€ã€‚ä¸è¦ç¬‘ï¼Œé‚£å€‹æ–°äººå°±æ˜¯æˆ‘ï¼Œæˆ‘è‡ªå·±å‰›å­¸çš„æ™‚å€™å°±æœ‰æŠŠæ•´å€‹ db è®Šä¸è¦‹éï¼Œå·®é»ä¸€åˆ°è·å°±å¼•å’è¾­è·(XDã€‚ç”¨é€™äº›æŠ€è¡“é‚„æ˜¯æœ‰å¾ˆå¤šå®‰å…¨è¦æ³¨æ„ï¼Œç¨å¾Œæœƒç´°è¬›æ³¨æ„çš„å®‰å…¨äº‹é …ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½ä¹‹ï¼ŒIac å°±æ˜¯ç”¨ç¨‹å¼åŒ–çš„èªæ³•ï¼Œç²¾æº–çš„æè¿°é›²ç«¯çš„ç‹€æ…‹æˆ–æ˜¯æ­¥é©Ÿï¼Œå®Œå…¨æ²’æœ‰æ¨¡ç³Šçš„åœ°å¸¶ã€‚å¸¶ä¾†çš„å¥½è™•ï¼Œé™ä½ç¶­é‹çš„éŒ¯èª¤é¢¨éšªï¼ŒåŠ å¿«ç¶­é‹æ•ˆç‡ï¼Œæœ€ä½³åŒ–ç¯€çœæˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ–°æ‰‹-state-çš„é›·&#34;&gt;æ–°æ‰‹ state çš„é›·&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¤šäººå”ä½œï¼ŒåŒæ™‚è®Šæ›´ state æœƒé€ æˆä¸å¯é æœŸçš„éŒ¯èª¤
&lt;ul&gt;
&lt;li&gt;é¿å…ç›´æ¥æ“ä½œ state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;state å¯èƒ½æœ‰ sensitive è³‡æ–™&lt;/li&gt;
&lt;li&gt;æ¨è–¦ä½¿ç”¨å¤–éƒ¨å¸¶æœ‰ lock çš„ state storage&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å°å…¥&#34;&gt;å°å…¥&lt;/h2&gt;
&lt;h1 id=&#34;å°å…¥å·¥å…·ä¹‹å¾Œ&#34;&gt;å°å…¥å·¥å…·ä¹‹å¾Œ&lt;/h1&gt;
&lt;p&gt;æ–°å·¥å…·å°å…¥æ™‚è¦åšå¥½é¢¨éšªè©•ä¼°ï¼Œæ¯å€‹äººéƒ½æ˜¯ç¬¬ä¸€æ¬¡ç”¨ terraform ï¼Œç”¨èµ·ä¾†å¾ˆå¿«å¾ˆçˆ½çš„åŒæ™‚ä¹Ÿè¦ä¸æ–·å®£å°å®‰å…¨æ¦‚å¿µï¼Œé›·åœ¨å“ªè£¡å‘åœ¨å“ªè£¡ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ terraform çš„é¢¨éšª&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“ DELET API è¶…å¿«ï¼Œç èµ·ä¾†å¾ˆæ–¹ä¾¿ï¼Œä½†å¾ˆå¤šæ™‚å€™æ–¹ä¾¿ = å±éšªã€‚çœ¼çœ‹å°æ˜ä¸€å€‹æ‰‹èµ·åˆ€è½ï¼Œè«‡ç¬‘é–“ï¼Œå…¬æœ‰é›²ç°é£›ç…™æ»…(XDï¼Œé€šé€šè®Šä¸è¦‹ã€‚ç¾åœ¨åœ¨è¬›æ•…äº‹å¾ˆé–‹å¿ƒï¼Œå¯¦éš›ç™¼ç”Ÿçš„è©±å¤§å®¶éƒ½ç¬‘ä¸å‡ºä¾†ï¼Œå…¨å…¬å¸ RD éƒ½è·‘ä¾†ç¶­é‹éƒ¨é–€æ’éšŠç›¯è‘—ä½ çœ‹ï¼Œå°±ç®—ä¿®å¥½ä¹Ÿè¦æ‡²è™•ã€‚å£“åŠ›è¶…å¤§ã€‚ä½†å°æ˜ç éŒ¯æ±è¥¿ä¸æ˜¯å°æ˜çš„éŒ¯ï¼Œæ˜¯å¤§ç’°å¢ƒçš„éŒ¯æ˜¯ SOP çš„éŒ¯(XDã€‚èªçœŸçš„ï¼Œåœ˜éšŠæ²’æœ‰æä¾› SOPï¼Œæ–°äººç éŒ¯æ±è¥¿ç•¶ç„¶æ˜¯åœ˜éšŠè² è²¬ã€‚æ‰€ä»¥æˆ‘å€‘ SOP ç¬¬ä¸€è¡Œå°±å¯«å¾—å¾ˆæ¸…æ¥šã€‚&lt;/li&gt;
&lt;li&gt;çœ‹è¦‹ destroy å°±é›™æ‰‹é›¢é–‹éµç›¤ï¼Œç›´æ¥æ±‚æ•‘ï¼Œé€™æ¨£é‚„èƒ½å‡ºäº‹å—&lt;/li&gt;
&lt;li&gt;å†ä¾†ï¼Œçµ¦äºˆç‰¹æ®Šçš„ IAM æ¬Šé™ï¼Œä¾‹å¦‚åªèƒ½æ–°å¢ä¸èƒ½åˆªé™¤çš„æ¬Šé™&lt;/li&gt;
&lt;li&gt;é€²ä¸€æ­¥å°å…¥ git-flowï¼Œpushã€reviewã€PRï¼Œè®“ä»–é€£çŠ¯éŒ¯çš„æ©Ÿæœƒéƒ½æ²’æœ‰&lt;/li&gt;
&lt;li&gt;æ ¹æœ¬é‚„æ˜¯è¦çµ¦äºˆæ–°äººè¶³å¤ çš„è¨“ç·´ï¼Œç„¶å¾ŒåŒæ™‚ä¿éšœå…¬å¸å®‰å…¨ã€‚
&lt;ul&gt;
&lt;li&gt;çµ¦æ–°äººéå¤§æ¬Šé™ç éŒ¯æ±è¥¿ï¼Œæˆ–æ˜¯å·¥ä½œæµç¨‹ä¸€å †å‘ï¼Œæ ¹æœ¬æ˜¯åœ¨èª˜å°æ–°äººçŠ¯éŒ¯ï¼Œåœ˜éšŠçš„è³‡æ·±æˆå“¡è¦æª¢è¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é€æ¼¸å°å…¥&#34;&gt;é€æ¼¸å°å…¥&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å°å…¥çš„éç¨‹ä¸æ–·æª¢è¨è·Ÿä¿®æ”¹ï¼Œæœ€å¾Œæ‰¾å‡ºé©åˆæˆ‘å€‘å…¬å¸çš„æµç¨‹&lt;/li&gt;
&lt;li&gt;æª¢è¨é€æ˜ï¼Œæœ‰éŒ¯å°±ä¿® SOPï¼Œä¿®å·¥ä½œæµç¨‹ã€‚è®“ä½ çš„å·¥ä½œæµç¨‹è·Ÿå·¥ä½œç’°å¢ƒï¼Œå›ºè‹¥é‡‘æ¹¯ï¼Œæˆå“¡å¾ˆé›£åœ¨è£¡é¢çŠ¯éŒ¯ï¼Œé€™æ‰æ˜¯ DevOps åœ¨åšé€™çš„äº‹ã€‚&lt;/li&gt;
&lt;li&gt;å®˜æ–¹å»ºè­°çš„æœ€ä½³å¯¦ä½œ &lt;a href=&#34;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è‡³æ–¼æˆ‘å€‘æ˜¯å¦‚ä½•é€æ¼¸å°å…¥ IaC åˆ°å…¬å¸çš„é–‹ç™¼æµç¨‹ä¸­ï¼Ÿå…·é«”çš„å°å…¥æ­¥é©Ÿå¦‚ä¸‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;introduction-iac&#34;&gt;Introduction: IaC&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;èˆŠæ¶æ§‹ä¿å­˜ã€‚å…ˆæŠŠé›²ç«¯ä¸Šå·²ç¶“æœ‰çš„æ©Ÿå™¨ï¼Œterraform è£¡é¢å«è³‡æºï¼Œimport æˆä»£ç¢¼&lt;/li&gt;
&lt;li&gt;æª¢æŸ¥èˆŠæ¶æ§‹ã€‚æ‰€æœ‰è¨­å®šéƒ½è®Šæˆä»£ç¢¼äº†ï¼Œè·Ÿä½ çœ‹ç¨‹å¼ç¢¼ä¸€æ¨£ï¼Œä¸€æ‹å…©çªçœ¼æ²’æœ‰ä»»ä½•æ¨¡ç¨œå…©å¯ã€‚æ•´ç†éç¨‹ä¸­æ‰¾å‡ºåˆç†è·Ÿä¸åˆç†çš„è¨­å®šã€‚æœ‰å¯èƒ½æœƒç™¼ç¾ä¸€äº›é›·ï¼Œåªæ˜¯é‚„æ²’çˆ†ç‚¸ï¼Œä¹Ÿè¶æ©Ÿä¿®ä¸€ä¿®ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œï¼Œä¾ç…§é€™äº›ç¾è¡Œçš„è³‡æºï¼Œå»æ•´ç†ä¸€ä»½é©åˆå…¬å¸çš„ç’°å¢ƒç¯„æœ¬ï¼Œä¹‹å¾Œæ‰€æœ‰çš„æ–°ç’°å¢ƒéƒ½é€™é€™å€‹ç¯„æœ¬éƒ¨å±¬ï¼Œç¢ºå®šæ–°çš„ç’°å¢ƒéƒ½æœ‰åˆç†çš„è¦åŠƒã€‚&lt;/li&gt;
&lt;li&gt;åˆ°æ­¤ï¼Œæ‰€æœ‰æ–°ç’°å¢ƒéƒ½æ˜¯åŒä¸€ä»½ç¯„æœ¬ç”Ÿå‡ºä¾†çš„ï¼Œç’°å¢ƒå·²ç¶“æ¨™æº–åŒ–äº†ã€‚ä¸æœƒå†æœ‰é›¶ç¢çš„å°éŒ¯èª¤ã€‚è½èµ·ä¾†è¶…è®šï¼Œä½†æœ‰æ™‚å€™å‡ºéŒ¯å°±æ˜¯ä¸€èµ·å…¨éŒ¯ï¼Œè¶…æ…˜(XDã€‚ç•¶ç„¶æœ‰éŒ¯å°±ä¿®ç¯„æœ¬ï¼Œä¿® SOPã€‚åŒæ¨£çš„éŒ¯æ°¸ä¸å†çŠ¯ï¼Œä¸ç”¨å†ä¿®ç¬¬äºŒæ¬¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;introduction-git-flow&#34;&gt;Introduction: Git-flow&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ç„¶å¾Œï¼Œå°å…¥ç‰ˆæœ¬æ§ç®¡ï¼Œæ•´åˆ git-flow çš„é–‹ç™¼æµç¨‹ã€‚å¯« SOPï¼Œä¹‹å¾Œæ‰€æœ‰è®Šæ›´éƒ½è¦&lt;/li&gt;
&lt;li&gt;å…ˆæŠŠ master å°èµ·ä¾†ï¼Œæ‰€æœ‰äººéƒ½ä¸å‡†ç›´æ¥æ”¹æ¶æ§‹&lt;/li&gt;
&lt;li&gt;é–‹æ–° branchï¼Œcommit&lt;/li&gt;
&lt;li&gt;é–‹ PR å¤§å®¶ reviewï¼Œå¤§å®¶éƒ½çœ‹éäº†å¼ï¼Œå† merge é€²å»ï¼Œé€™æ¨£æœ‰éŒ¯å°±ä¸æ˜¯ä¸€å€‹äººçš„é‹è€Œæ˜¯å¤§å®¶ä¸€èµ·èƒŒé‹(XDã€‚ä¸æ˜¯æ‹‰ï¼Œreview èƒ½å¤§å¹…é™ä½éŒ¯èª¤ï¼Œåˆ†äº«åœ˜éšŠç¶“é©—åŠ é€Ÿæ–°äººè¨“ç·´ï¼Œä¸¦ä¸”è®“æ‰€æœ‰äºº on the same pageï¼Œä¸æœƒå†æœ‰ã€Œé˜¿é é€™æ©Ÿå™¨èª°é–‹çš„ã€æœ‰äººä¸çŸ¥æƒ…çš„äº‹æƒ…ã€‚&lt;/li&gt;
&lt;li&gt;æ°¸é åªä½¿ç”¨ master ä¾†éƒ¨å±¬é›²ç«¯è³‡æºï¼Œä¹Ÿæ˜¯ç¢ºå®šæ‰€æœ‰æ¶æ§‹éƒ½ç¶“éå¤šäºº reviewã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;introduction-pipeline-automation&#34;&gt;Introduction: Pipeline Automation&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;æœ€å¾Œï¼Œæ•´åˆ CICDï¼Œè®“æ¶æ§‹çš„éƒ¨å±¬å®Œå…¨è‡ªå‹•åŒ–ã€‚æŠŠäººå·¥é™åˆ°æœ€ä½ï¼ŒåŒæ™‚ä¹ŸæŠŠäººå·¥éŒ¯èª¤çš„æ©Ÿç‡é™åˆ°æœ€ä½ï¼Œç•¶ç„¶é€™å€‹ä¹Ÿæ˜¯æ²’éŒ¯éƒ½æ²’éŒ¯ï¼Œè¦éŒ¯ä¸€èµ·éŒ¯çš„ç‹€æ…‹(XDï¼Œä½¿ç”¨æ™‚é‚„æ˜¯è¦æ³¨æ„ã€‚ä½†å¦‚æœåŸ·è¡Œçš„å¾ˆç©©å®šçš„è©±ï¼Œè‡ªå‹•åŒ–çµ•å°æ˜¯å€¼å¾—æŠ•è³‡çš„ã€‚å› ç‚ºç¾åœ¨æŠŠæ¶æ§‹ç•¶ä½œç”¢å“åšï¼Œéƒ¨å±¬å®Œè¦æ¸¬è©¦åŠŸèƒ½ï¼Œç¶²è·¯è¨­å®šæ˜¯å¦æ­£ç¢ºï¼Œç›£æ§æ˜¯å¦å®Œæ•´ï¼Œproxy æ˜¯ä¸æ˜¯è¦æ‰“çœ‹çœ‹ã€‚é€™äº›éƒ½æ•´åˆé€² infra è‡ªå‹• pipelineã€‚éƒ¨å±¬å®Œå°±æ˜¯æ¸¬è©¦ï¼Œç„¶å¾Œäº¤ä»˜çµ¦å…¶ä»–åœ˜éšŠã€‚&lt;/li&gt;
&lt;li&gt;ä¹‹å¾Œå°±æ˜¯ä¸æ–·èª¿æ•´ SOPï¼Œè·Ÿ CI/CD pipelineã€‚æŠŠç¶­é‹æ­¥é©Ÿè½‰æˆç¨‹å¼ç¶­è­·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çŠ¯éŒ¯éä¸€æ¬¡ï¼Œæ°¸ä¸å†çŠ¯ã€‚é€™å€‹å°æ–¼é•·æœŸåœ˜éšŠç¶“ç‡Ÿéå¸¸é‡è¦ï¼Œè®“ç¶“é©—è·ŸçŸ¥è­˜ç´¯ç©ï¼Œåœ˜éšŠè³ªé‡æ‰æœƒæˆé•·ã€‚IaC åœ¨é€™é»å¹«åŠ©å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;demo-2&#34;&gt;Demo 2&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;NAME=terraform-devops make gke redis sql&lt;/li&gt;
&lt;li&gt;module&lt;/li&gt;
&lt;li&gt;git commit&lt;/li&gt;
&lt;li&gt;Review on github&lt;/li&gt;
&lt;li&gt;Merge request&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;repo&#34;&gt;Repo&lt;/h1&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨çš„åŸç¢¼éƒ½é–‹æºåœ¨ github ä¸Šï¼Œå› ç‚ºæ˜¯çœŸçš„æ‹¿ä¾†å°å…¥æˆ‘å€‘å…¬å¸çš„æ¶æ§‹ï¼Œä¿è­‰å¯ä»¥ç”¨ã€‚é˜¿ä¸èƒ½ç”¨çš„è©±ï¼Œå¹«æˆ‘ç™¼ issue çµ¦æˆ‘ï¼Œæˆ–æ˜¯ä½ äººæ›´å¥½ç™¼å€‹ PR çµ¦æˆ‘éƒ½å¯ä»¥(XDã€‚æŠŠ repo æ‹‰ä¸‹ä¾†ï¼Œé€™é‚Šæœ‰ gcp / azure / awsï¼Œé›–ç„¶æœ‰ä¸‰å€‹ä½†æˆ‘å€‘å…¬å¸ä¸»è¦æ˜¯ç”¨ gcpï¼Œå‰©ä¸‹å…©å€‹æˆ‘è‡ªå·±åšèˆˆè¶£çš„ã€‚è£¡é¢ templates è·Ÿ modules ï¼Œä½†ä½ ä¸ç”¨ç®¡ï¼Œæˆ‘ makefile éƒ½å¯«å¥½äº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘é€™é‚Šè¦æ–°å¢ä¸€å€‹ kubernetes é›†ç¾¤&lt;/li&gt;
&lt;li&gt;æˆ‘ç›´æ¥é€²ä¾†æˆ‘çš„å°ˆæ¡ˆï¼Œ NAME=my-new-k8s make gkeï¼Œæ±è¥¿å°±ç”Ÿå‡ºä¾†ï¼Œå…·é«”åšçš„äº‹æƒ…å°±æ˜¯æ–°å¢å…©å€‹ç¨‹å¼å€å¡Šï¼Œæ¯å€‹å€å¡Šæè¿°ä¸€å€‹æ©Ÿå™¨&lt;/li&gt;
&lt;li&gt;git diff çœ‹å¤šäº†ä»€éº¼ï¼Œé€™é‚Šå¤šä¸€å€‹ k8s è·Ÿå¤šä¸€å€‹ node-pool&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œæˆ‘ planï¼Œè®“ terraform é æ¸¬ä¸€ä¸‹è©¦è·‘çµæœï¼Œæˆ‘å€‘ä¾æ“šçµæœå¥½å¥½ reviewï¼Œä¾‹å¦‚é€™é‚Š 2 to add 0 to destroy æˆ‘çš„æƒ³åƒæ˜¯ä¸æ˜¯çœŸçš„è·Ÿ terraform è¨ˆç•«ä¸€æ¨£ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œ terraform applyï¼Œé€™é‚Šè¦çœ‹æ¸…æ¥šï¼Œæˆ‘å€‘æ˜¯ 2 to add 0 to destroyï¼Œå¦‚æœçœ‹åˆ°æœ‰ destroy å°±è¦é›™æ‰‹é›¢é–‹éµç›¤ï¼Œå¤§å®¶ä¸è¦è¡å‹•ï¼Œçœ‹æ¸…æ¥šï¼Œå› ç‚ºå¥¹çœŸçš„æœƒä¸Šå»æŠŠæ±è¥¿ç æ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;P.S. å°ˆæ¡ˆå¯ä»¥æŒ‰ç…§å…¬å¸éœ€æ±‚åˆ†ï¼Œè³‡æºå¤ªå¤šå¤ªæ“ å°±æ‹†åˆ†æˆå¹¾å€‹è³‡æ–™å¤¾å¥½ç®¡ç†ï¼Œç„¶å¾Œåˆ†æ¬Šè²¬ç®¡ç†ï¼Œä¾‹å¦‚é¤¨ iam çš„ã€ç®¡ç¶²è·¯ã€ç®¡æ‡‰ç”¨æ©Ÿå™¨çš„å¯ä»¥åˆ†é–‹ä¾†&lt;/p&gt;
&lt;h1 id=&#34;git-flow&#34;&gt;Git-flow&lt;/h1&gt;
&lt;p&gt;ç„¶å¾Œå› ç‚ºæˆ‘å¾Œé¢æœƒè¬› git-flow å·¥ä½œæµç¨‹æ•´åˆï¼Œæ‰€ä»¥æˆ‘é †ä¾¿åšå®Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°çš„è®Šæ›´ commit ï¼Œplan ä½†æ˜¯é‚„æ²’ applyã€‚æˆ‘è¦æ±‚æ‰€æœ‰æ–°çš„ commit æ¨ä¸Šå»&lt;/li&gt;
&lt;li&gt;ç™¼ PRï¼Œå…¶ä»–åœ˜éšŠæˆå“¡ä¾†å¹«æˆ‘ reviewã€‚PR ç”¨çš„ template ï¼Œæè¿°ä¸€ä¸‹æ–°æ¶æ§‹çš„ç›®çš„ï¼Œè®Šæ›´çš„åœ°æ–¹ï¼Œæœ‰æ²’æœ‰é›·ï¼Œç„¶å¾Œå¹¾å€‹ checklist æª¢æŸ¥&lt;/li&gt;
&lt;li&gt;å…¶ä»–éšŠå“¡ review éƒ½ lgtm æ‰ merge å› master&lt;/li&gt;
&lt;li&gt;apply æ°¸é åœ¨æœ€æ–°çš„ master ä¸Š applyï¼Œç¢ºä¿æ‰€æœ‰æ¨åˆ°é›²ç«¯çš„æ¶æ§‹éƒ½æ˜¯å¤šäºº review éçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰ review æ‰æœ‰å“è³ªå¯è¨€ï¼Œcode éƒ½è¦ reviewï¼Œinfra è‡ªç„¶ä¹Ÿéœ€è¦ reviewã€‚IaC + git-flow æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;demo-2-1&#34;&gt;Demo 2&lt;/h1&gt;
&lt;h1 id=&#34;å·¥å…·--æµç¨‹&#34;&gt;å·¥å…· + æµç¨‹&lt;/h1&gt;
&lt;p&gt;å°å…¥çš„æˆåŠŸèˆ‡å¦ï¼Œä¸æ˜¯æœ€ä½³å¯¦è¸ï¼Œè€Œæ˜¯å„å€‹éšæ®µï¼Œéƒ½çµ¦äºˆåœ˜éšŠé©åˆçš„æŒ‘æˆ°èˆ‡å”åŠ©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Git-flow SOP ç¯„ä¾‹
&lt;ul&gt;
&lt;li&gt;ä¸­æ–‡ç‰ˆï¼Œè¶…é•·ï¼Œä¸Šé¢æ“ä½œéäº†ï¼Œé€™é‚Šä¸ç´°è¬›ï¼Œå¤§å®¶è‡ªå·±ä¸Šå»çœ‹&lt;/li&gt;
&lt;li&gt;ä½†å¦‚æœåœ˜éšŠæ˜¯ç¬¬ä¸€æ¬¡å°å…¥ terraformï¼Œæˆ‘å¼·çƒˆå»ºè­°è¦æœ‰é¡ä¼¼çš„æ±è¥¿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Provide template&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;demo æ™‚ä¸æ˜¯æœ‰ makefileï¼Œmakefile è£¡é¢å¯«çš„å°è…³æœ¬è·Ÿæœ¬èº« IaC æ²’æœ‰é—œä¿‚ï¼Œæä¾›ä¸€äº›è€Œå¤–çš„å°è…³æœ¬è¼”åŠ©ï¼Œå¯ä»¥é€²ä¸€æ­¥é™ä½äººå·¥æ“ä½œï¼Œæå‡æ•ˆç‡ï¼Œåˆå¢åŠ å®‰å…¨ã€‚å·¥å…·ä¸ä¸€å®šå®Œå…¨é©åˆåœ˜éšŠå§ï¼Œé€™æ™‚å€™å°±éœ€è¦è£œè¶³åœ˜éšŠæ–‡åŒ–è·Ÿå·¥å…·é–“çš„è½å·®ï¼Œæ½¤æ»‘ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å†èªªä¸€æ¬¡ï¼Œæ–°äººåšéŒ¯ï¼Œä¸æ˜¯ä»–åšéŒ¯ï¼Œè€Œæ˜¯åœ˜éšŠæ²’æœ‰æä¾›ä»–è¶³å¤ çš„å”åŠ©ã€‚å¦‚ä½•è®“æ–°äººä¹Ÿèƒ½æœ‰é«˜ç”¢å‡ºåŒæ™‚åˆé¡§åŠå®‰å…¨ï¼Œè³‡æ·±å·¥ç¨‹å¸«æ˜¯é€™é‚Šåœ¨è³‡æ·±ã€‚æä¾›ä¸€äº›ä¸€ç”¨æ€§å·¥å…·æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Terraform module&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆæ˜¯ä¸€å€‹ terraform çš„åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªï¼ŒGKE ä¹Ÿè¨±å®šç¾©äº† 2 å€‹å­ç‰©ä»¶(ex. Clusterï¼ŒNode-pool)ï¼Œç¸½å…±æœ‰ 30 å€‹åƒæ•¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ å…¶å¯¦ä¸éœ€è¦é‚£éº¼å¤šåƒæ•¸ XD&lt;/li&gt;
&lt;li&gt;å»ºç«‹ä¸€å€‹ my-gke-moduleï¼Œä¸€å€‹ç‰©ä»¶ï¼Œ5 å€‹å¿…å¡«åƒæ•¸ï¼Œ5 å€‹æœ‰é è¨­å€¼çš„é¸å¡«åƒæ•¸&lt;/li&gt;
&lt;li&gt;ä¹Ÿè¨±å¯«éŒ¯çš„æ©Ÿæœƒåªå‰© 5 å€‹ï¼Œä¹Ÿè¨±å·¥æ™‚åªéœ€è¦ 5/30&lt;/li&gt;
&lt;li&gt;éœ€æ±‚è®Šæ›´å°±æ”¹ moduleï¼Œè®“ä½ çš„æ“ä½œç‰©ä»¶æœ¬èº«å°±æ˜¯ç¬¦åˆå¯¦éš›éœ€æ±‚çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;èƒ½æ‰‹å‹•æ”¹çš„åœ°æ–¹å°±æ˜¯èƒ½çŠ¯éŒ¯çš„åœ°æ–¹ï¼Œé»‘ç®±å°è£å¯ä»¥ä¿è­·æ•´é«”æ¶æ§‹ï¼Œä¸¦æé«˜æ˜“ç”¨æ€§&lt;/p&gt;
&lt;h2 id=&#34;é›œé …&#34;&gt;é›œé …&lt;/h2&gt;
&lt;h1 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸Šé¢æ˜¯ IaC åœ¨æˆ‘å€‘å…¬å¸çš„æµç¨‹&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘é¸ terraformã„¨&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ç”¨ terraform ä»¥å¤–çš„å·¥å…·ï¼Œå¯ä»¥åƒè€ƒæµç¨‹ï¼Œä¹Ÿè¨±æ®Šé€”åŒæ­¸&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/intro/vs/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.terraform.io/intro/vs/index.html&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å„ªç¼ºé»&#34;&gt;å„ªç¼ºé»&lt;/h1&gt;
&lt;p&gt;å¥½ï¼Œè·Ÿåœ˜éšŠä¸€æ­¥ä¸€æ­¥æºé€šæ”¹é€²ï¼ŒèŠ±äº†ä¸€å…©å€‹æœˆï¼ŒæˆåŠŸå°å…¥ã€‚æ˜¯å¦æœ‰è§£æ±ºç•¶åˆçš„å•é¡Œï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™ä½äººå·¥æ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…äººå·¥å¤±èª¤&lt;/li&gt;
&lt;li&gt;infra äº¤ä»˜æ¨™æº–åŒ–ï¼Œæ²’æœ‰å¥‡æ€ªçš„è¨­å®šï¼Œå†ä¹Ÿæ²’æœ‰ã€Œå•Šæˆ‘æ©Ÿå™¨é–‹éŒ¯äº†ã€é€™å›äº‹&lt;/li&gt;
&lt;li&gt;å¿«ï¼ŒçœŸä½å¿«ã€‚é–‹ä¸€å€‹æ©Ÿå™¨å°±æ˜¯æˆ‘å‰›å‰› demo é€™æ¨£ï¼Œè€Œä¸”ä¿è­‰æœƒå‹•ã€‚é€™æ¨£é–‹å‡ºä¾†çš„æ©Ÿå™¨ï¼Œå°å¥¹è¶…æœ‰ä¿¡å¿ƒï¼Œè¦è¤‡è£½å®Œå…¨ä¸€æ¨¡ä¸€æ¨£çš„ç’°å¢ƒä¹Ÿè¶…æœ‰ä¿¡å¿ƒã€‚å¦‚æœå†åŠ ä¸Šè‡ªå‹•åŒ–æ¸¬è©¦å°±æ›´æ•¢ä¿è­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æº–ç¢º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§å®¶éƒ½ review éï¼Œæ¯”è¼ƒä¸æœƒæœ‰ã€Œå•Šæˆ‘ç•¶æ™‚æ²’æƒ³åˆ°ã€çš„ç‹€æ³ï¼Œinfra å‡ºé€™ç¨®è¬è¬æ²’æƒ³åˆ°çš„å•é¡Œï¼Œå¾ˆæœ‰æ©Ÿç‡è¦å¹¹æ‰é‡ä¾†ã€‚èœé³¥è·Ÿè‘— review ï¼Œè©¦è‘—ç™¼ PRï¼Œé€™æ¨£æ–°äººè¨“ç·´æ‰æœƒæœ‰æ•ˆç‡ï¼Œä»–ä¹‹å¾Œæ‰èƒ½è‡ªå·±æ“ä½œï¼Œè³‡æ·±å·¥ç¨‹å¸«åªè¦ review å°±å¥½ã€‚è¦çµ¦æ–°äººè¶³å¤ çš„è¨“ç·´ï¼Œåˆè¦é¡§æ…®å®‰å…¨ï¼Œ review èŠ±çš„æ™‚é–“éå¸¸å€¼å¾—ã€‚&lt;/li&gt;
&lt;li&gt;ä¿è­‰é–‹ç™¼ã€æ¸¬è©¦ã€stagingã€production ç’°å¢ƒé•·çš„ä¸€æ¨¡ä¸€æ¨£ã€‚terraform ç¨‹å¼ä¿è­‰çš„ä¸æ˜¯æˆ‘ä¿è­‰çš„(XD)ã€‚ä½†ä»–çš„ä¿è­‰æ˜¯æœ‰æ ¹æ“šçš„ï¼Œè®“åœ˜éšŠå¾é–‹ç™¼åˆ°ä¸Šé™ä¿é‡ç›¸åŒç’°å¢ƒã€‚ã€Œé˜¿åœ¨æˆ‘çš„æ©Ÿå™¨ä¸Šæœƒè·‘æ€éº¼ä¸Š production å°±å£æ‰ã€ä¸å¥½æ„æ€æ²’é€™å›äº‹ï¼Œå£æ‰å°±æ˜¯ä½ æ‰£å¯«éŒ¯(å…‡ã€‚èªçœŸåœ°èªªï¼Œæ’é™¤ä¸€äº› infra çš„å•é¡Œï¼Œå¯ä»¥å¤§å¹…å¢åŠ é™¤éŒ¯çš„æ•ˆç‡ï¼Œåªè¦æª¢æŸ¥é‚„æ²’è‡ªå‹•åŒ–çš„åœ°æ–¹å°±å¥½ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ–æ¸¬è©¦ï¼Œæ‰£è¦æ¸¬è©¦ç’°å¢ƒä¹Ÿè¦æ¸¬è©¦ï¼Œé€™é‚Šç›´æ¥æ•´é€²å»ï¼Œç’°å¢ƒäº¤å‡ºå»ä¿è­‰æ˜¯å¥½çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿç”¢ç’°å¢ƒè®Šå‹•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºå·²ç¶“è½‰æˆç¨‹å¼ç¢¼ï¼Œè¦æœ‰ä»€éº¼æ”¹å‹•éƒ½å¾ˆç²¾ç¢ºï¼Œå¤§å®¶ä¹Ÿæ¯”è¼ƒæ•¢å‹•ç’°å¢ƒï¼Œç‰¹åˆ¥æ˜¯ production ç’°å¢ƒã€‚å†ä¾†å› ç‚ºä¿ç•™æ‰€æœ‰ç’°å¢ƒç”¢ç”Ÿçš„ç¨‹å¼ç¢¼ï¼Œè¦è¤‡è£½ç’°å¢ƒä¹Ÿå¾ˆå®¹æ˜“ï¼Œè€Œä¸”æœ‰ä¿¡å¿ƒä¿è­‰ä¸€æ¨£ã€‚æˆ‘å€‘å°±æŠŠå°±æ¶æ§‹çš„ production è¤‡è£½ï¼Œç„¶å¾Œæ¬å®¶ã€‚å®‰å…¨ä¸‹åº„æ²’å‡ºäº‹ã€‚å¾Œé¢å°±æ¬ä¸Šç™®ï¼Œæ•´å€‹å…¬å¸æœå‹™å¤§æ¬å®¶ï¼Œæ¬æˆåœ˜éšŠç†æƒ³çš„æ¶æ§‹ã€‚æ¬å®¶å·²ç¶“ä¸Šç·šçš„æœå‹™ï¼Œé€™å€‹éœ€è¦å¤šå°‘ä¿¡å¿ƒè·Ÿå‹‡æ°£ä½ å€‘çŸ¥é“å—ï¼Œç¶­é‹çœŸçš„æ˜¯æ„›èˆ‡å‹‡æ°£çš„å†’éšªã€‚æ–°æ¶æ§‹æˆ‘å€‘ä¹Ÿå¾ˆæ»¿æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªå‹•åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå‹•åŒ–å°±æ˜¯è®“ä½ ç”¨é›¶å€çš„æ™‚é–“åšåå€çš„äº‹æƒ…å˜›ã€‚è½èµ·ä¾†æ€ªæ€ªçš„è›‹æ˜¯æ˜¯çœŸçš„ã€‚&lt;/li&gt;
&lt;li&gt;å› ç‚ºæˆ‘å€‘ç›®æ¨™æ˜¯ç¶­é‹èººè‘—ä¸Šç­å˜›(XD)ï¼Œæˆ‘å€‘æ‰èƒ½æŠŠæ™‚é–“æ‹¿å»åšæ”¹é€²ï¼Œä¸ç„¶ä»¥å…‰æ˜¯é–‹æ©Ÿå™¨ï¼Œæ¸¬è©¦ç’°å¢ƒå¯ç”¨æ€§ï¼Œç¶­é‹å°±é£½äº†ï¼Œæ ¹æœ¬æ²’æ™‚é–“æ”¹é€²è·Ÿæå‡ã€‚é€™æ¨£å°å…¬å¸é•·æœŸéå¸¸ä¸å¥½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯è®€æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GUI æ²’è¾¦æ³•æ‰“ comment é˜¿ï¼Œèª°çŸ¥é“é€™å€‹æ©Ÿå™¨ç•¶åˆç‚ºä»€æ˜¯é€™å€‹è¨­å®šã€‚IaC å¾Œåˆ°è™•éƒ½å¯ä»¥å¯« commentï¼Œæ€•ä½ ä¸å¯«è€Œå·²ã€‚ç„¶å¾Œ code çš„è¡¨é”æ€§é‚„æ˜¯å¾ˆå¼·å¤§ï¼Œæ¯”èµ· GUIï¼Œè³‡æ·±å·¥ç¨‹å¸«å¯ä»¥æŠŠæ¡æ•´å€‹å…¬å¸çš„æ¶æ§‹ç‹€æ³ï¼Œæ¯”èµ·å»é›²å¹³å°ä¸‹ä¸€å †æœç´¢ï¼Œæ‰‹å‹•æ¯”å°ï¼Œç¨‹å¼ç¢¼çš„å¯ç¶­è­·æ€§çœŸçš„è¶…é«˜ã€‚è€Œ GCP å·²ç¶“æ˜¯ GUI åšå¾—å¾ˆå¥½çš„å…¬æœ‰é›²äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™ä½äººå·¥ï¼Œå¿«é€Ÿï¼Œæº–ç¢ºï¼Œè‡ªå‹•åŒ–ï¼Œæœ‰ä¿¡å¿ƒ&lt;/p&gt;
&lt;h2 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h2&gt;
&lt;p&gt;é‚„æœ‰ç©ºæˆ‘å€‘å†ä¾†è¬› terraform çš„ç´°ç¯€&lt;/p&gt;
&lt;p&gt;æœ‰äº‹æ­¡è¿é€éç²‰å°ˆç§æ•²ï¼Œå› ç‚ºæˆ‘ä¹Ÿéœ€è¦äººè¨è«–&lt;/p&gt;
&lt;h2 id=&#34;é‚„æœ‰æ™‚é–“å†èŠ&#34;&gt;é‚„æœ‰æ™‚é–“å†èŠ&lt;/h2&gt;
&lt;h1 id=&#34;terraform-1&#34;&gt;terraform&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;validate æ—¢ç„¶æ˜¯ codeï¼Œé€™é‚Šå¹«ä½ åš lintã€èªæ³•æª¢æ¸¬ã€type checkï¼Œéæ¿¾ç¬¬ä¸€å±¤éŒ¯èª¤&lt;/li&gt;
&lt;li&gt;import å¯ä»¥æŠŠé ç«¯çš„è³‡æºåŒ¯å…¥æˆ stateï¼Œä¸€å€‹é»è®š follow è¿½è¹¤çš„æ¦‚å¿µ(XD)ï¼Œä¸æ˜¯æ‰€æœ‰çš„é ç«¯è³‡æºéƒ½éœ€è¦è¿½è¹¤åˆ° stateï¼Œæˆ‘å€‘åªéœ€è¦åœ¨å°çš„ scope è£¡é¢é—œæ³¨éœ€è¦çš„æ©Ÿå™¨&lt;/li&gt;
&lt;li&gt;module å¯ä»¥è‡ªç”±æ’°å¯«ï¼ŒæŠŠæœ‰ç›¸ä¾æ€§çš„è³‡æºæ‰“åŒ…ï¼Œä¾ç…§åœ˜éšŠä½¿ç”¨ç¿’æ…£èª¿æ•´ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;cloud å¯ä»¥ç®¡ç† stateï¼Œterraform cloud å¹«ä½ ç¶­è­·å…¨åŸŸåŒä¸€ä»½ stateï¼Œæœ‰äººåœ¨ä½¿ç”¨æ™‚æœƒ lock stateï¼Œé¿å…å¤šäººåŒæ™‚ä¿®æ”¹ï¼Œæ‰“äº‚ API é€ æˆè³‡æºéŒ¯èª¤&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;state-conflicts&#34;&gt;state conflicts&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰å¤šä»½ stateï¼Œä½ é›»è…¦ä¸Šä¸€ä»½ local stateï¼Œæˆ‘é›»è…¦ä¸Šä¸€ä»½ local stateï¼Œå…¶å¯¦æœƒé€ æˆè¡çª&lt;/li&gt;
&lt;li&gt;æ›´æ€•åŒæ™‚å¤šäººæ†¶èµ· applyï¼ŒGCP API ç›´æ¥è¢«æ‰“äº‚ï¼Œæœƒæœ‰ä¸å¯é æœŸçš„éŒ¯èª¤&lt;/li&gt;
&lt;li&gt;è§£æ³•æ˜¯ä½¿ç”¨ terraform remote backendï¼Œä¸è¦ç”¨ local stateï¼Œä½¿ç”¨ DB ã€storage æˆ–æ˜¯ terraform cloudï¼Œé€éä¸€éš» lock ä¾†ä¿è­‰ synchronized state&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é–“æ¥ç†è§£-api&#34;&gt;é–“æ¥ç†è§£ API&lt;/h1&gt;
&lt;p&gt;ex.  GCP Load Balancer&lt;/p&gt;
&lt;p&gt;é€™å€‹è¬›ä¸‹å»å°±å¤ªå¤šäº†ï¼ŒåŸºæœ¬ä¸Šé€éçˆ¬ terraform google provider çš„æ–‡ä»¶ï¼Œç„¶å¾Œå»æ¯”å°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºå»é» GUI å…¶å¯¦æ„Ÿå—ä¸åˆ° GCP API çš„èª¿ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ terraform è½‰å¯«è³‡æºæ™‚å€™å°±å¾ˆæœ‰æ„Ÿï¼Œæ‰“é€™å€‹ API è·Ÿæ‰“é€™å€‹ APIï¼Œtf æª”æ¡ˆä¸Šå…¶å¯¦çœ‹å¾—å‡ºä¾†ã€‚&lt;/li&gt;
&lt;li&gt;é€²ä¸€æ­¥å»æŸ¥ï¼Œæ‰ç™¼ç¾ GCP Load Balancer å…§ç¶²æˆ–å¤–ç¶²ã€http æˆ– tcpã€å…¨çƒæˆ–å€åŸŸï¼Œä½¿ç”¨çš„ Load Balancer è¡Œç‚ºä¸ä¸€æ¨£ï¼Œå› ç‚ºåº•ä¸‹çš„å¯¦ä½œä¸ä¸€æ¨£ã€‚ä½†ä¹‹å‰ä½¿ç”¨ GUI æ™‚å…¶å¯¦ä¸æœƒå»æƒ³ç‚ºå•¥è¨­å®šä¸ä¸€æ¨£ï¼Œä½¿ç”¨ terraform å°±æœƒè¢«è¿«å»äº†è§£ï¼Œå¼·è¿«å­¸ç¿’XDã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åƒåœ¾è©±&#34;&gt;åƒåœ¾è©±&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æœ€ä½³å¯¦è¸ä¸æ˜¯å•é¡Œ ï¼Œå¦‚ä½•å°å…¥æ‰æ˜¯å•é¡Œ&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä¸ç”¨èººè‘—ä¸Šç­ï¼Œä½†æ˜¯ä¸èƒ½è·ªè‘—ä¸Šç­&lt;/li&gt;
&lt;li&gt;é¡˜æ„å¤šå¹¾å€‹äººä¾†çœ‹æˆ‘ç²‰å°ˆæ¯”è¼ƒå¯¦åœ¨&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¾é›¶é–‹å§‹çš„ Infrastructure as Code: Terraform - 01</title>
      <link>https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/</link>
      <pubDate>Sun, 14 Jun 2020 16:46:09 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/</guid>
      <description>&lt;p&gt;This article is part of &lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-14-terraform-infrastructure-as-code/&#34;&gt;å¾é›¶é–‹å§‹çš„ Infrastructu as Code: Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Get-started examples / SOP on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2020-06-15-terraform-infrastructure-as-code-transcript/&#34;&gt;Introducation to Terraform Iac: Speaker transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slides.com/chechiachang/terraform-introduction/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Presentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check my website &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; for other blog. &lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;. Like my page if you really like it :)&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;outlline&#34;&gt;Outlline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;our story: issues, steps, &amp;amp; results&lt;/li&gt;
&lt;li&gt;basics IaC, terraform&lt;/li&gt;
&lt;li&gt;benefits&lt;/li&gt;
&lt;li&gt;risks and å‘&lt;/li&gt;
&lt;li&gt;to be or not to be&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;experience oriented&lt;/p&gt;
&lt;h1 id=&#34;our-stories&#34;&gt;Our stories&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;100+ devs, many teams&lt;/li&gt;
&lt;li&gt;25+ projects&lt;/li&gt;
&lt;li&gt;50+ GKEs&lt;/li&gt;
&lt;li&gt;80+ SQLs&lt;/li&gt;
&lt;li&gt;IAMs, redis, VPCs, load-balancers, &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;issues&#34;&gt;Issues&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Ops manually create resources through GUI by SOP.&lt;/li&gt;
&lt;li&gt;We have many isolated, separeated resources, VPCs. It&amp;rsquo;s our culture, and we (devops) want to change.&lt;/li&gt;
&lt;li&gt;Some projects have short life-cycle. Rapid resources created &amp;amp; destroy.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;our-user-story&#34;&gt;Our user story&lt;/h1&gt;
&lt;p&gt;As a devops,
I would like to introduce terraform (IaC)
so that I can&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;review all existing resources&lt;/li&gt;
&lt;li&gt;minimize error from manual operation&lt;/li&gt;
&lt;li&gt;ASAP!!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As a devops,
I would like to fully enforce terraform (IaC)
so that I can&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;minimize efforts to operate infra&lt;/li&gt;
&lt;li&gt;delegate infra operations to junior team members&lt;/li&gt;
&lt;li&gt;minimize IAM privilges&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;import existing resources&lt;/li&gt;
&lt;li&gt;review existing resources code&lt;/li&gt;
&lt;li&gt;plan best practice resource templates&lt;/li&gt;
&lt;li&gt;create new resources with templates&lt;/li&gt;
&lt;li&gt;introduce git workflow, plan, commit, PR, and review&lt;/li&gt;
&lt;li&gt;add wrapper handler&lt;/li&gt;
&lt;li&gt;automation pipeline&lt;/li&gt;
&lt;li&gt;repeat 2-4&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;iac&#34;&gt;IaC&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Programatic way to operate infra&lt;/li&gt;
&lt;li&gt;declarative (functional) vs. imperative (procedural)&lt;/li&gt;
&lt;li&gt;Perfect for public cloud, cloud native, virtualized resources&lt;/li&gt;
&lt;li&gt;Benefits: cost (reduction), speed (faster execution) and risk (remove errors and security violations)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;terraform&#34;&gt;Terraform&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.terraform.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Terraform&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Declarative (functional) IaC&lt;/li&gt;
&lt;li&gt;Invoke API delegation&lt;/li&gt;
&lt;li&gt;State management&lt;/li&gt;
&lt;li&gt;providers: azure / aws / gcp /alicloud / &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;demo&#34;&gt;Demo&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/terraform-playground&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;scope&#34;&gt;Scope&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Compute Instances&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Databases&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IAM&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Networking&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Load Balancer&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;expected-benefits&#34;&gt;Expected benefits&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Minimize manual operation.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zero manual operation error&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Standarized infra. Infra as a (stable) product.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;fast, really fast to duplicate envs&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Infra workflow with infra review&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Easy to create identical dev, staging, prod envs&lt;/li&gt;
&lt;li&gt;Reviewed infra. Better workflow. Code needs reviews, so do infra.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fully automized infra pipeline.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;other-benefits&#34;&gt;Other Benefits&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Don&amp;rsquo;t afraid to change prod sites anymore
&lt;ul&gt;
&lt;li&gt;We made a massive infra migration in this quater!!&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Better readability to GUI. Allow comment everywhere.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;risks&#34;&gt;Risks&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Incorrect usage could cause massive destruction.
&lt;ul&gt;
&lt;li&gt;å¦‚æœçœ‹è¦‹ destroy çš„æç¤ºï¼Œè«‹é›™æ‰‹é›¢é–‹éµç›¤ã€‚ ~ first line in our SOP&lt;/li&gt;
&lt;li&gt;If see &amp;ldquo;destroy&amp;rdquo;, cancel operation &amp;amp; call for help.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;State management&lt;/li&gt;
&lt;li&gt;A little latency between infra version and terraform provider version&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;reduce-risks&#34;&gt;Reduce Risks&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Sufficient understanding to infra &amp;amp; terraform&lt;/li&gt;
&lt;li&gt;Sufficient training to juniors&lt;/li&gt;
&lt;li&gt;Minimize IAM privilege: remove update / delete permissions&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;git-flow&#34;&gt;Git-flow&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/terraform-playground/blob/master/SOP.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Our SOP&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;edit tf&lt;/li&gt;
&lt;li&gt;push new branch commit&lt;/li&gt;
&lt;li&gt;PR, review &amp;amp; discussion&lt;/li&gt;
&lt;li&gt;merge &amp;amp; apply&lt;/li&gt;
&lt;li&gt;revert to previous tag if necessary&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;utility-provide-template&#34;&gt;(Utility) Provide template&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;wrap resources for
&lt;ul&gt;
&lt;li&gt;better accesibility&lt;/li&gt;
&lt;li&gt;lower operation risks&lt;/li&gt;
&lt;li&gt;uniform naming convention&lt;/li&gt;
&lt;li&gt;best practice&lt;/li&gt;
&lt;li&gt;suggested default value&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;about-introducing-new-tool&#34;&gt;About introducing new tool&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;The hardest part is always people
&lt;ul&gt;
&lt;li&gt;Focus on critical issues (ç—›é») instead of tool itself. &amp;ldquo;We introduce tool to solve&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Put result into statistics &amp;ldquo;The outage due to misconfig is reduced by&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;overall-my-iac-experience-is-great&#34;&gt;Overall, my IaC experience is GREAT!&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;IaC to automation.&lt;/li&gt;
&lt;li&gt;Comment (for infra) is important. You have to write doc anyway. Why not put in IaC?&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;Full transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;Presentation file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/post/terraform-infrastructure-as-code/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Source Code on Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chechia.net&lt;/a&gt; &amp;lt;- full contents&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Follow my page to get notification&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;Like it if you really like it :)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;appendixi-more-about-terraform&#34;&gt;Appendix.I more about terraform&lt;/h1&gt;
&lt;p&gt;terraform validate
terraform import
terraform module
terraform cloud &amp;amp; state management&lt;/p&gt;
&lt;h1 id=&#34;appendixi-understand-state-conflict&#34;&gt;Appendix.I understand State conflict&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Shared but synced&lt;/li&gt;
&lt;li&gt;watch out for state conflicts when colaborating
&lt;ul&gt;
&lt;li&gt;state diff. could cause terraform mis-plan&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Solution: synced state lock
&lt;ul&gt;
&lt;li&gt;Colatorative edit (git branch &amp;amp; PR), synchronized terraform plan &amp;amp; apply&lt;/li&gt;
&lt;li&gt;or better: automation&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;appendixii-understand-resources-from-api-aspect&#34;&gt;Appendix.II understand resources from API aspect&lt;/h1&gt;
&lt;p&gt;GCP Load Balancer&lt;/p&gt;
&lt;h3 id=&#34;gcp-load-balancing&#34;&gt;GCP Load Balancing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;understand resources from API aspect&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;how terraform work with GCP API&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;internal&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;regional
&lt;ul&gt;
&lt;li&gt;pass-through: tcp / udp   -&amp;gt; internal TCP/UDP&lt;/li&gt;
&lt;li&gt;proxy: http / https       -&amp;gt; internal HTTP(S)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;external&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;regional
&lt;ul&gt;
&lt;li&gt;pass-through: tcp / udp   -&amp;gt; tcp/udp network&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;global / effective regional
&lt;ul&gt;
&lt;li&gt;proxy
&lt;ul&gt;
&lt;li&gt;tcp                     -&amp;gt; TCP Proxy&lt;/li&gt;
&lt;li&gt;ssl                     -&amp;gt; SSL Proxy&lt;/li&gt;
&lt;li&gt;http / https            -&amp;gt; External HTTP(S)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;terraform-resource&#34;&gt;Terraform Resource&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;forwarding_rule&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;forwarding_rule: tcp &amp;amp; http&lt;/li&gt;
&lt;li&gt;global_forwarding_rule: only http&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;backend_service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;backend_service
&lt;ul&gt;
&lt;li&gt;health_check&lt;/li&gt;
&lt;li&gt;http_health_check&lt;/li&gt;
&lt;li&gt;https_health_check&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;region_backend_service
&lt;ul&gt;
&lt;li&gt;region_health_check&lt;/li&gt;
&lt;li&gt;region_http_health_check&lt;/li&gt;
&lt;li&gt;region_https_health_check&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;some-ways-to-do-iac&#34;&gt;Some ways to do IaC&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Cloud Formation&lt;/li&gt;
&lt;li&gt;bash script with API / client&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¼•è¨€-infrastructure-as-code&#34;&gt;å¼•è¨€ Infrastructure as Code&lt;/h1&gt;
&lt;p&gt;å¾å­—é¢ä¸Šè§£é‡‹ï¼ŒIaC å°±æ˜¯ç”¨ç¨‹å¼ç¢¼æè¿° infrastructureã€‚é‚£ç‚ºä½•æœƒå‡ºç¾é€™å€‹æ¦‚å¿µï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸ IaC æ˜¯ä»€éº¼ç‹€æ³ï¼Ÿæˆ‘å€‘é‚„æ˜¯å¯ä»¥é€é GUI æˆ–æ˜¯ API æ“ä½œã€‚éš¨å«éš¨ç”¨&lt;/p&gt;
&lt;p&gt;é›²ç«¯é‹ç®—é¢¨è¡Œï¼Œå·¥ç¨‹å¸«å¯ä»¥å¾ˆåœ¨ GUI ä»‹é¢ä¸Šï¼Œå¾ˆè¼•æ˜“çš„éƒ¨ç½²è³‡æ–™ä¸­å¿ƒçš„æ¶æ§‹ã€‚è¼¸å…¥åŸºæœ¬è³‡è¨Šï¼Œæ»‘é¼ é»å€‹ä¸€å…©ä¸‹ï¼Œå°±å¯ä»¥åœ¨é ç«¯å•Ÿç”¨é‹ç®—æ©Ÿå™¨ï¼Œå•Ÿç”¨è³‡æ–™åº«ï¼Œè¨­ç½®è™›æ“¬ç¶²è·¯èˆ‡è·¯ç”±ï¼Œå¹¾åˆ†é˜å°±å¯ä»¥å®Œæˆæ¶è¨­æœå‹™çš„åŸºç¤å»ºè¨­(infrastructure)ï¼Œé–‹å§‹é‹è¡Œæœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œéš¨è‘—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›²å¹³å°æä¾›æ›´å¤šæ–°çš„ï¼ˆè¤‡é›œçš„ï¼‰æœå‹™
&lt;ul&gt;
&lt;li&gt;æœå‹™å½¼æ­¤å¯èƒ½æ˜¯æœ‰ç›¸ä¾æ€§ï¼ˆdependencyï¼‰ï¼Œæœå‹™éœ€è¦ä»°è³´å…¶ä»–æœå‹™&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯å‹•æ…‹è€¦åˆï¼Œæ›´æ”¹æœå‹™æœƒé€£å‹•å…¶ä»–æœå‹™ï¼Œä¸€é«®å‹•å…¨èº«&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éœ€è¦ç¸å¯†çš„å­˜å–æ§ç®¡ï¼ˆaccess controlï¼‰
&lt;ul&gt;
&lt;li&gt;é˜²ç«ç‰†ï¼Œè·¯ç”±è¦å‰‡&lt;/li&gt;
&lt;li&gt;é›²å¹³å°ä¸Šï¼Œåœ˜éšŠæˆå“¡çš„å­˜å–æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°ˆæ¡ˆçš„è¦æ¨¡èˆ‡è¤‡é›œåº¦å¢åŠ 
&lt;ul&gt;
&lt;li&gt;å¤šç’°å¢ƒçš„éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;å¤šå€‹å‚™æ´å‰¯æœ¬è¨­å®š&lt;/li&gt;
&lt;li&gt;å¤§é‡æ©Ÿå™¨å½¢æˆçš„é›†ç¾¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;iac-çš„å¯¦éš›éœ€æ±‚&#34;&gt;IaC çš„å¯¦éš›éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸‹é€™äº›å°è©±æ˜¯ä¸æ˜¯å¾ˆè€³ç†Ÿï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;iac-çš„å¯¦éš›éœ€æ±‚-1&#34;&gt;IaC çš„å¯¦éš›éœ€æ±‚&lt;/h1&gt;
&lt;p&gt;æ²’æœ‰éœ€æ±‚ï¼Œå°±ä¸éœ€è¦æ‰¾å°‹æ–°çš„è§£æ±ºæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æœ‰çœ‹ä¸Šé¢ç›®éŒ„çš„æœ‹å‹ï¼Œæ‡‰è©²çŸ¥é“é€™ç³»åˆ—æ–‡ç« çš„å¾Œé¢ï¼Œæˆ‘æœƒå¯¦éš›åˆ†äº«æ–¼å…¬å¸å…§éƒ¨å°å…¥ Terraform èˆ‡ IaC æ–¹æ³•çš„éç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å„ä½è®€è€…æœƒæ‰¾åˆ°é€™ç¯‡æ–‡ï¼Œå¤§æ¦‚éƒ½æ˜¯å› ç‚ºå¯¦éš›æœå°‹äº† Terraform æˆ–æ˜¯ IaC çš„é—œéµå­—æ‰æ‰¾åˆ°é€™ç¯‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰éœ€æ±‚ï¼Œè‡ªå·±å› ç‚ºè¦ºå¾—æœ‰è¶£è€Œæ‹‰ä¸‹ä¾†ç ”ç©¶ï¼Œ&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰æ˜ç¢ºéœ€æ±‚ï¼Œå°±è²¿ç„¶å°å…¥
ç„¡è¬‚å¢åŠ äº‚åº¦&lt;/p&gt;
&lt;h1 id=&#34;iac-çš„å¯¦ç¾å·¥å…·&#34;&gt;IaC çš„å¯¦ç¾å·¥å…·&lt;/h1&gt;
&lt;h1 id=&#34;ç‚ºä½•é¸æ“‡-terraform&#34;&gt;ç‚ºä½•é¸æ“‡ Terraform&lt;/h1&gt;
&lt;h1 id=&#34;å»ºè­°&#34;&gt;å»ºè­°&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœä¸ç†Ÿï¼Œå¾ import ç¾æœ‰æœ€å¥½çš„è³‡æºé–‹å§‹ã€‚æŠŠ 70 åˆ†ä¿ä½ï¼Œå†å‘ 80 90 é‚é€²ã€‚&lt;/li&gt;
&lt;li&gt;å–„ç”¨ module å°è£ï¼Œåªéœ²å‡ºæœƒç”¨åˆ°çš„åƒæ•¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Say Goodbye 2019</title>
      <link>https://chechia.net/zh-hant/post/2019-12-31-say-goodbye-2019/</link>
      <pubDate>Tue, 31 Dec 2019 18:38:51 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-12-31-say-goodbye-2019/</guid>
      <description>&lt;p&gt;ä»Šå¹´çµæŸäº†ï¼Œå›é¡§ä¸€ä¸‹ä»Šå¹´åšçš„äº‹æƒ…&lt;/p&gt;
&lt;p&gt;&amp;ndash; æˆ‘æ˜¯è»Ÿé«”å·¥ç¨‹å¸« &amp;ndash;&lt;/p&gt;
&lt;p&gt;6 å ´å…¬é–‹æ¼”è¬›ï¼Œä¸¦ä¸”è¸å‡ºç†Ÿæ‚‰çš„ç¤¾ç¾¤èˆ’é©åœˆï¼Œå—ä¸‹é€²è»é«˜é›„XD&lt;/p&gt;
&lt;p&gt;37 ç¯‡æŠ€è¡“æ–‡ç« 
å…¶ä¸­åŒ…å« 30 ç¯‡ Ithome 30å¤©(åƒè³½å°±ä¸ç”¨ç¡è¦º)éµäººè³½åƒè³½æ–‡ç« 
çµè³½æ’¿åˆ°è³€å„ªé¸ç‹‚è³€?&lt;/p&gt;
&lt;p&gt;æ­£è·å·¥ä½œæ–¹é¢ï¼Œé€²äº†å¹£åœˆï¼Œåˆ‡èº«äº†è§£æ•åœˆçœŸäº‚å¾Œï¼Œåˆè¸å‡ºäº†å¹£åœˆ&lt;/p&gt;
&lt;p&gt;é–‹å‘ç¿»è­¯éº»çœç†å·¥å­¸é™¢çš„èª²ç¨‹ã€åˆ†æ•£å¼ç³»çµ±ã€ï¼Œå¥½èª²æªåœ˜ä¸€èµ·ä¿®
é è¨ˆæœƒæœ‰ 22 ç¯‡æ–‡ç« ï¼Œæº–å‚™åœ¨å¯è¦‹çš„æœªä¾†ï¼ŒçŠ§ç‰²ç„¡æ•¸å€‹å¤œæ™šï¼Œé‚å‘ 2020&lt;/p&gt;
&lt;p&gt;&amp;ndash; æˆ‘æ˜¯å°ˆæ¥­æ°´è‚ºæ½›æ°´æ•™ç·´ &amp;ndash;
ä¹Ÿæ˜¯è‡ªç”±æ½›æ°´å“¡&lt;/p&gt;
&lt;p&gt;å¹´æœ«çš„å¹¾å¤©ï¼Œæ­£å¼é–‹å§‹åŸ·æ¥­ï¼Œå¸¶å­¸ç”Ÿä¸‹æµ·(?)
å­¸ç¿’æ•™å°å­¸ç”Ÿï¼Œä¹Ÿå­¸ç¿’å°å­¸ç”Ÿçš„å®‰å…¨è² è²¬&lt;/p&gt;
&lt;p&gt;æ–°å¹´å¾©å·¥å¾Œï¼Œæ­£è·ç¢¼è¾²ï¼Œå‰¯æ¥­æ½›æ°´
æœ‰äººè¦æ½›è«‹æ‰¾æˆ‘ï¼Œä¿è­‰å„ªæƒ ä¸è—ç§&lt;/p&gt;
&lt;p&gt;&amp;ndash; æˆ‘æ˜¯æ•¸ä½è¡ŒéŠ·å¯¦ç¿’ç”Ÿ &amp;ndash;&lt;/p&gt;
&lt;p&gt;è·Ÿå‰å…¬å¸ (é›–ç„¶éƒ½ä¸æ˜¯MKä½†å») è¶…å¼·çš„è¡ŒéŠ·åœ˜éšŠ&amp;lt;3å­¸ç¿’æ•¸ä½è¡ŒéŠ·
å¾é›¶é–‹å§‹å¤§é€ å€‹äººå“ç‰Œï¼Œé‚Šå­¸é‚Šå¯¦ç¿’
é–‹äº†å…©å€‹ç²‰çµ²å°ˆé 
ä¸€å€‹æ˜¯æŠ€è¡“æ–‡ç« åˆ†äº«ï¼Œä¸€å€‹åšæ½›æ°´å½±ç‰‡åˆ†äº«
æ‰“é€ å€‹äººå“ç‰Œï¼Œè‡ªå·±æ¨å»£è¡ŒéŠ·ï¼Œå­¸ç¿’æ•¸ä½è¡ŒéŠ·&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MIT 6.824 Distributed System Learning Note</title>
      <link>https://chechia.net/zh-hant/post/2019-12-16-mit-6.824-distributed-system/</link>
      <pubDate>Mon, 16 Dec 2019 23:46:46 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-12-16-mit-6.824-distributed-system/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/mit-6.824-distributed-system&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/mit-6.824-distributed-system&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èª²ç¨‹è¬›ç¾©ä¸­æ–‡ç¿»è­¯&lt;/li&gt;
&lt;li&gt;å€‹äººå¿ƒå¾—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è·Ÿè‘— MIT 6.824 å­¸ç¿’åˆ†æ•£å¼ç³»çµ±&lt;/p&gt;
&lt;p&gt;é€™å€‹å°ˆæ¡ˆå„²å­˜ MIT 6.824 åˆ†æ•£å¼ç³»çµ±ç·¨ç¨‹çš„ä¸Šèª²å…§å®¹ï¼Œæˆ‘å°‡å…§å®¹ç¿»è­¯ç¨‹ä¸­æ–‡ï¼ŒåŠ ä¸Šå€‹äººå­¸ç¿’ç­†è¨˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘æœƒåœ¨æˆ‘çš„å­¸ç¿’éç¨‹ä¸­ï¼ŒæŒçºŒç¿»è­¯èª²ç¨‹å…§å®¹
&lt;ul&gt;
&lt;li&gt;ä¸€æ–¹é¢æ·±å…¥å€‹äººå­¸ç¿’&lt;/li&gt;
&lt;li&gt;å¦ä¸€æ–¹é¢ä¹Ÿå›é¥‹ç¤¾ç¾¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¾ç…§èª²ç¨‹çš„é€²åº¦é€²è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‹¥æœ‰é¤˜åŠ›ï¼Œæœƒå˜—è©¦ç¿»è­¯ä»¥ä¸‹å…§å®¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èª²å ‚ Q &amp;amp; A&lt;/li&gt;
&lt;li&gt;è«–æ–‡&lt;/li&gt;
&lt;li&gt;lab å¯¦åš&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Ablockchain Atomic Swap</title>
      <link>https://chechia.net/zh-hant/post/2019-11-08-blockchain-atomic-swap/</link>
      <pubDate>Fri, 08 Nov 2019 08:03:30 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-11-08-blockchain-atomic-swap/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://en.bitcoin.it/wiki/Atomic_swap&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://en.bitcoin.it/wiki/Atomic_swap&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;algorithm&#34;&gt;Algorithm&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;2 pay txs and 2 claim tx&lt;/li&gt;
&lt;li&gt;claim txs are singed at first, locked with time&lt;/li&gt;
&lt;li&gt;2 pay txs are encrypted by x, affects only when x is reveal on the network&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;0&#34;&gt;
&lt;li&gt;Initialization&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A: random number x&lt;/p&gt;
&lt;p&gt;tx1: A pay B
A Pay BTC to B&amp;rsquo;s public key
if x known &amp;amp; singed by B
or Signed by A &amp;amp; B&lt;/p&gt;
&lt;p&gt;tx2: A claim
tx1 pay BTC to A&amp;rsquo;s public key
locked 48 hours
signed by A&lt;/p&gt;
&lt;p&gt;A -&amp;gt; B tx2
B -&amp;gt; A tx2 signed by A &amp;amp; B&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A -&amp;gt; submit tx1&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;tx3: B pay A alt-coin
B Pay A alt-coin
if x known &amp;amp; singed by A
or signed by A &amp;amp; B&lt;/p&gt;
&lt;p&gt;tx4: B claim
tx3 pay B alt-coins
locked 48 hours
signed by B&lt;/p&gt;
&lt;p&gt;B -&amp;gt; A tx4
A -&amp;gt; B tx4 signed by A &amp;amp; B&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;B submit tx3&lt;/li&gt;
&lt;li&gt;A spends tx3, reveal x&lt;/li&gt;
&lt;li&gt;B spends tx1 using x&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;specialized-alt-chain&#34;&gt;Specialized Alt-chain&lt;/h1&gt;
</description>
    </item>
    
    <item>
      <title>Blockchain Bep3 Atomic Swap</title>
      <link>https://chechia.net/zh-hant/post/2019-10-22-blockchain-bep3-atomic-swap/</link>
      <pubDate>Tue, 22 Oct 2019 10:35:20 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-22-blockchain-bep3-atomic-swap/</guid>
      <description>&lt;h1 id=&#34;bep3-atomic-swap&#34;&gt;BEP3 Atomic Swap&lt;/h1&gt;
&lt;p&gt;Binance åœ¨ &lt;a href=&#34;https://github.com/binance-chain/BEPs/blob/master/BEP3.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BEP3: HTLC and Atomic Peg&lt;/a&gt; æåˆ°ï¼ŒBEP å³å°‡åœ¨ binance chain ä¸Šæ”¯æ´åŸç”Ÿçš„ Hash Timer Locked Transfer (HTLT) ï¼Œé€™ä½¿è·¨éˆçš„åŸå­æ€§äº¤æ› (atomic swap) è®Šå¾—å¯è¡Œï¼Œé€é HTLC åœ¨å…©é‚Šçš„éˆä¸Šé–ä½ (peg) tokensï¼Œç„¶å¾Œåªæœ‰åœ¨åŸ·è¡Œäº¤æ›çš„æ™‚å€™ï¼Œé€é hash äº¤æ›ï¼Œä¸€æ¬¡åŸ·è¡Œé›™é‚Šçš„äº¤æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;é—œæ–¼ Atomic Swap ç¶²è·¯æœ‰éå¸¸å¤šçš„è¨Šæ¯ï¼Œæœ‰èˆˆè¶£çš„è©±å¯ä»¥çœ‹&lt;a href=&#34;https://en.bitcoin.it/wiki/Atomic_swap&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€™ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº¤æ˜“åªæœ‰åœ¨é›™é‚Šå®Œæˆå¾Œæ‰å®Œæˆï¼Œå®Œæˆä¹‹å‰ä¸èƒ½å‹•ç”¨äº¤æ›çš„è³‡ç”¢&lt;/li&gt;
&lt;li&gt;åœ¨ä»»ä½•éšæ®µå¤±æ•ˆéƒ½å¯ä»¥å®Œå…¨ fallbackï¼Œä¸¦é€²è¡Œ refund&lt;/li&gt;
&lt;li&gt;äº¤æ˜“çš„èªè­‰æ˜¯å»ä¸­å¿ƒåŒ–çš„
&lt;ul&gt;
&lt;li&gt;é€™é‚Šæœ‰å€‹ä½†æ›¸ï¼ŒEthereum ä¸Šæ˜¯é€é smart contract å¯¦ç¾ï¼Œä½† Binance chain ä¸Šé‚„æ˜¯é  Binance èªè­‰ XD&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Binance åœ¨ BEP3 ä¸­æ”¯æ´ HTLCï¼Œæˆ‘å€‘é€™é‚Šä¸»è¦çš„è³‡è¨Šä¾†æºæ˜¯ binance.org çš„&lt;a href=&#34;https://docs.binance.org/atomic-swap.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹èªªæ˜æ–‡ä»¶&lt;/a&gt;ï¼Œé€™é‚Šé‡å°æ–‡ç« é€²è¡Œé©—è­‰ï¼Œä¸¦ä¸”è£œè¶³æ–‡ä»¶ç¼ºæ¼çš„éƒ¨åˆ†ï¼Œæé†’éç¨‹ä¸­å¯èƒ½æœƒè¸©åˆ°çš„é›·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è·¨éŠcross-chain-äº¤æ˜“&#34;&gt;è·¨éŠ(Cross Chain) äº¤æ˜“&lt;/h3&gt;
&lt;p&gt;åœ¨éƒ¨ç½² asset / token çš„æ™‚å€™ï¼Œæˆ‘å€‘æœƒé¸æ“‡åˆé©çš„éˆä½œç‚ºç™¼å¸ƒè³‡ç”¢ä¸¦é‹è¡Œ block chain appã€‚å¸¸ç”¨çš„æ‡‰ç”¨éˆå¦‚ ethereum èˆ‡ binance chain ç­‰ç­‰ã€‚ä¸åŒçš„ä¸»éˆä¸Šæœ‰å„è‡ªçš„å„ªç¼ºé»ï¼Œä¾‹å¦‚ä½¿ç”¨ ethereum ï¼Œå¯ä»¥èˆ‡è¨±å¤š token èˆ‡æ‡‰ç”¨äº’å‹•ï¼Œä¹Ÿæ˜¯æœ€å¤šäººä½¿ç”¨çš„æ‡‰ç”¨ä¸»éˆã€‚è€Œåœ¨ binance éˆä¸ŠåŸ·è¡Œï¼Œå‰‡èƒ½å¤ å¿«é€Ÿçš„ç™¼ç”Ÿ transactionsï¼Œä¸¦ä¸”å¯ä»¥èˆ‡ binance ä¸Šçš„è³‡ç”¢èˆ‡äº¤æ˜“æ‰€äº’å‹•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æŸäº›æ‡‰ç”¨å ´æ™¯ï¼Œæˆ‘å€‘æœƒå¸Œæœ›å…©å€‹ç¨ç«‹ä¸»éˆä¸Šçš„è³‡ç”¢èƒ½å¾Œäº’å‹•ï¼Œä¾‹å¦‚åœ¨ binance chain ä¸ŠåŸ·è¡Œå¿«é€Ÿçš„ transactionï¼Œç„¶è€Œä¹Ÿè¦ä½¿ç”¨ etheruem ä¸Šæ—¢æœ‰çš„ ERC-20 tokensï¼Œé€™æ™‚ä¾¿éœ€è¦ä¸€å€‹æºé€šå…©æ¢éˆçš„æ©Ÿåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–‡ç« åˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†&#34;&gt;æ–‡ç« åˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#swap-on-binance-chain&#34;&gt;åœ¨ Binance Chain ä¸Šäº’æ›å…©å€‹ address çš„ binance asset&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#from-ethereum-to-binance-chain&#34;&gt;å¾ ethereum token åˆ° binance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#from-binance-chain-to-ethereum&#34;&gt;å¾ binance chain åˆ° ethereum&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;swap-on-binance-chain&#34;&gt;Atomic Swap on Binance Chain&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©æœƒå¯¦ä½œ Atomic Peg Swapï¼Œé€é HTLT é–ä½ Binance Chain ä¸Šå…©å€‹ address çš„è³‡ç”¢ï¼Œä¸¦é€²è¡ŒåŸå­æ€§çš„ä¸€æ¬¡äº¤æ˜“ï¼Œä¾†é”æˆéˆä¸Šçš„è³‡ç”¢äº’æ›ã€‚é€™é‚Šç›´æ¥ä½¿ç”¨ binance æä¾›çš„ bnbcli ä¾†åŸ·è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨æƒ…å¢ƒ&#34;&gt;ä½¿ç”¨æƒ…å¢ƒ&lt;/h3&gt;
&lt;p&gt;å…©å€‹åœ¨ Binance Chain ä¸Šçš„ address æƒ³äº¤æ›è³‡ç”¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Client: HTLT çš„ç™¼èµ·æ–¹ï¼Œæ“æœ‰ä¸€éƒ¨åˆ† assetï¼Œç™¼èµ· HTLT å¸Œæœ›åŸ·è¡Œè³‡ç”¢äº’æ›&lt;/li&gt;
&lt;li&gt;Recipient: HTLT çš„æ”¶å—æ–¹ï¼Œæ”¶åˆ° HTLTï¼Œéœ€è¦æ–¼æ™‚é™å…§ deposit æŒ‡å®šæ•¸é‡çš„è³‡ç”¢åˆ° swap ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æœå‹™å…ƒä»¶&#34;&gt;æœå‹™å…ƒä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;HTLT transactions on binance chain: ä¾†é–ä½ä¸¦ claim assets&lt;/li&gt;
&lt;li&gt;Client tooling: tbnbcli è®“å®¢æˆ¶å¯ä»¥æ“ä½œï¼Œç›£æ¸¬éˆä¸Š swap çš„ç‹€æ³&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æµç¨‹&#34;&gt;æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Client ä½¿ç”¨ tbnbcli ç™¼èµ· HTLT&lt;/li&gt;
&lt;li&gt;Recipient æ”¶åˆ°ç™¼èµ·æ–¹é€ä¾†çš„ swap info èˆ‡ asset (frozen)&lt;/li&gt;
&lt;li&gt;Recipient Deposit æŒ‡å®šæ•¸é‡çš„ asset åˆ° swap ä¸­&lt;/li&gt;
&lt;li&gt;Binance Chain è‡ªå‹•å®Œæˆ swapï¼Œå®Œæˆäº¤æ›ï¼Œè§£é–å…©é‚Šäº¤æ›çš„è³‡ç”¢&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å–å¾—-tbnbcli&#34;&gt;å–å¾— tbnbcli&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.binance.org/api-reference/cli.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tbnbcli çš„èªªæ˜æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç”±æ–¼ bnbcli repo ä¸­ä½¿ç”¨ Git Large File Storage ä¾†å­˜æ”¾ binaryï¼Œé€™é‚Šè¦å•Ÿç”¨ git-lfs ä¾†ä¸‹è¼‰ binary&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Mac port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo port install git-lfs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Git clone repo&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:binance-chain/node-binary.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; node-binary
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git chechout v0.6.2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git lfs pull --include cli/testnet/0.6.2/mac/tbnbcli
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo copy cli/testnet/0.6.2/mac/tbnbcli /usr/local/bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šè¦æ³¨æ„ä½¿ç”¨ v0.6.2+ çš„ç‰ˆæœ¬ï¼Œä¸ç„¶æœƒæ²’æœ‰ HTLT çš„ subcommands&lt;/p&gt;
&lt;h3 id=&#34;æ¸¬è©¦-tbnbcli&#34;&gt;æ¸¬è©¦ tbnbcli&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli status --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s2&#34;&gt;&amp;#34;node_info&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;protocol_version&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;p2p&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;7&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;block&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;10&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;app&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;34ac6eb6cd914014995b5929be8d7bc9c16f724d&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;listen_addr&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;aa13359cd244f11e988520ad55ba7f5a-c3963b80c9b991b7.elb.us-east-1.amazonaws.com:27146&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;network&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;Binance-Chain-Nile&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.31.5&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;channels&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;36402021222330380041&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;moniker&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;data-seed-0&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;other&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;tx_index&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;on&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;rpc_address&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;tcp://0.0.0.0:27147&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s2&#34;&gt;&amp;#34;sync_info&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;latest_block_hash&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;359AD9BF36B7DEEB069A86D53D3B65D9F4BB77A1A65E40E1289B5798D4C1094F&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;latest_app_hash&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;E748CFA5806B587D9678F55DFDDB336E3669CDF421191CDA6D2DF8AA7A3461F3&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;latest_block_height&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;45868456&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;latest_block_time&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2019-10-23T07:36:38.176957281Z&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;catching_up&amp;#34;&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s2&#34;&gt;&amp;#34;validator_info&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;1C360E22E04035E22A71A3765E4A8C5A6D586132&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;pub_key&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;tendermint/PubKeyEd25519&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;s2&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;T56yDoH+B+OY8PP2tmeFtJtk+9ftnBUVHykKfLS45Es=&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s2&#34;&gt;&amp;#34;voting_power&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;acquire-valid-binance-testnet-account&#34;&gt;Acquire Valid Binance Testnet Account&lt;/h3&gt;
&lt;p&gt;Check &lt;a href=&#34;https://www.binance.com/en/support/articles/360023912272&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Testnet Doc&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go to &lt;a href=&#34;https://testnet.binance.org/en/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Binance Testnet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Create a wallet&lt;/li&gt;
&lt;li&gt;Save address, mn, keystore, private key&lt;/li&gt;
&lt;li&gt;Use &lt;a href=&#34;https://www.binance.vision/tutorials/binance-dex-funding-your-testnet-account&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;testnet faucet&lt;/a&gt; to fund testnet account&lt;/li&gt;
&lt;li&gt;Receive 200 BNB on testnet&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;client-create-htlt&#34;&gt;Client Create HTLT&lt;/h3&gt;
&lt;p&gt;é€™é‚Šä½¿ç”¨ç°¡å–®çš„ç¯„ä¾‹ï¼Œé–ä½å…©å€‹ BEP2 tokens ä¾†é€²è¡Œäº¤æ›ï¼Œå±•ç¤ºä¸€ä¸‹ tbnbcli çš„ HTLT&lt;/p&gt;
&lt;p&gt;æº–å‚™å…©å€‹ addressï¼Œé€™é‚Šæ˜¯æˆ‘è‡ªå·±çš„å…©å€‹ testnet address&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p (179 BNB) &lt;a href=&#34;https://testnet-explorer.binance.org/address/tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Explorer ä¸ŠæŸ¥çœ‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce (20 BNB) &lt;a href=&#34;https://testnet-explorer.binance.org/address/tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Exporler ä¸ŠæŸ¥çœ‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®æ¨™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTLT&lt;/li&gt;
&lt;li&gt;tbnb&amp;hellip;j9p -&amp;gt; 0.3 BNB -&amp;gt; tbnb&amp;hellip;7ce&lt;/li&gt;
&lt;li&gt;tbnb&amp;hellip;j9p &amp;lt;- 0.1 BNB &amp;lt;- tbnb&amp;hellip;7ce&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;tbnbcli åŸ·è¡Œ HTLTï¼Œå¾ from address åŸ·è¡Œ HTLTï¼Œçµ¦ recipient-addr 0.3 BNBï¼Œä¸¦é æœŸå°æ–¹å› 0.1 BNBï¼Œç­‰å¾… height-span å€‹ block æ™‚é–“(360 &amp;gt; 2 minutes)&lt;/p&gt;
&lt;h3 id=&#34;tbnbcli-key&#34;&gt;tbnbcli key&lt;/h3&gt;
&lt;p&gt;å¯¦éš›åŸ·è¡Œå‰ï¼Œç”±æ–¼æˆ‘å€‘éœ€è¦é€é tbnbcli æ“ä½œ from-addressï¼Œè¦å…ˆ&lt;a href=&#34;https://docs.binance.org/keys.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€é tbnbcli æŠŠ address çš„ key åŠ é€²åˆ°æœ¬åœ°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli keys add tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce --recover
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli keys list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME:	                                      TYPE:	ADDRESS:						                        PUBKEY:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	&lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;	tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	bnbp1addwnpepq0pw06d3y7ykg2j33pc604j3awgqgl5vhd88wdjhjg5sptnsfpqyx2rmhl4
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¯¦éš›åŸ·è¡Œ&#34;&gt;å¯¦éš›åŸ·è¡Œ&lt;/h3&gt;
&lt;p&gt;åƒæ•¸ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;FROM ADDR: tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RECIPIENT ADDR: tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hightspan: 3600ï¼Œheight-span æ˜¯ç™¼èµ· HTLTï¼Œå—æ–¹ depositï¼Œç™¼èµ·æ–¹å» claim çš„æ™‚é™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;amount: asset * 10^8&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p åŸ·è¡Œ HTLT&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çµ¦ tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce 0.3 BNB&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é æœŸå°æ–¹å› 0.1 BNB&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç­‰å¾… 3600 å€‹ block æ™‚é–“&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;FROM_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;RECIPIENT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HEIGHT_SPAN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token HTLT &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --recipient-addr &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RECIPIENT_ADDR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --amount 30000000:BNB &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --expected-income 10000000:BNB &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --height-span &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HEIGHT_SPAN&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --from &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FROM_ADDR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”¢ç”Ÿ swap çš„çµæœï¼Œå¯ä»¥æ–¼&lt;a href=&#34;https://testnet-explorer.binance.org/tx/8F865C5C9E5CD06239DE99746BCE73AACA2F3AD881C26765FB90C9465EF06EF0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Testnet Explorer ä¸Šçœ‹åˆ°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Committed at block &lt;span class=&#34;m&#34;&gt;47218942&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;tx hash: 8F865C5C9E5CD06239DE99746BCE73AACA2F3AD881C26765FB90C9465EF06EF0, response: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Code:0 Data:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;77&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;138&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;186&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;65&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;213&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;125&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;217&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;170&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;194&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;248&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;149&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;189&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;188&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;208&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;166&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;93&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;48&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;159&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;188&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;196&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;143&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;31&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;66&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;151&lt;/span&gt; 249&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Log:Msg 0: swapID: 4d8a1d33ba41d57d69d90566aac2f895bdbc38d0a65d309fbcc48f6f1f4297f9 Info: GasWanted:0 GasUsed:0 Tags:&lt;span class=&#34;o&#34;&gt;[{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; 114&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;103&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;117&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; 112&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; 116&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; 100&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111&lt;/span&gt; 110&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;72&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;84&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;76&lt;/span&gt; 84&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}]&lt;/span&gt; Codespace: XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;query-atomic-swap&#34;&gt;Query Atomic Swap&lt;/h3&gt;
&lt;p&gt;ç”¢ç”Ÿäº† atomic swapï¼Œé€™é‚Šå¯ä»¥ä½¿ç”¨ tbnbcli æŸ¥è©¢ swap çš„ç‹€æ…‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;4d8a1d33ba41d57d69d90566aac2f895bdbc38d0a65d309fbcc48f6f1f4297f9
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token query-swap &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›å‚³ swap çš„ç‹€æ…‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;from&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;out_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:[{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;denom&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;30000000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;in_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;expected_income&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10000000:BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;recipient_other_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number_hash&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;4cf88f1acf8bcbc628609f3257406913f67e009e5c61f2671b601e40f4e5cc6a&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1572506189&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;cross_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;expire_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;47222542&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2254&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;closed_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Open&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;deposit-htlt&#34;&gt;Deposit HTLT&lt;/h3&gt;
&lt;p&gt;å—æ–¹ reciept-address é€™é‚Šè¦æŠŠ 1 BNB æ‰“é€²å» swap ä¸­&lt;/p&gt;
&lt;p&gt;æ³¨æ„é€™é‚Šçš„ from-address å·²ç¶“è®Šæˆç•¶åˆçš„ recipient-addr tbnb&amp;hellip;j9p&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶é€™é‚Šè¦å­˜å–ï¼Œä¹Ÿè¦æœ‰ tbnb&amp;hellip;j9p çš„ keyï¼Œé€™æ¨£æˆ‘å€‘æœ¬åœ°å°±æœƒæœ‰ç™¼å—å…©æ–¹çš„ keyï¼Œä½†ä¸€èˆ¬ä¾†èªªæ‡‰è©²æ˜¯å…©å€‹ä¸åŒçš„äºº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli keys add tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p--recover
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli keys list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME:	                                      TYPE:	ADDRESS:						                        PUBKEY:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	&lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;	tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	bnbp1addwnpepq0pw06d3y7ykg2j33pc604j3awgqgl5vhd88wdjhjg5sptnsfpqyx2rmhl4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p	&lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;	tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p	bnbp1addwnpepqwk5zx3jnrq5guxc9tsgrte9aw9knla0ahunwynypkm0jvst6y7l2q83ueq
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å—æ–¹æŠŠç´„å¥½çš„éŒ¢å­˜é€²å»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token deposit &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --amount 10000000:BNB &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --from &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RECIPIENT_ADDR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥æˆåŠŸ depositï¼Œ&lt;a href=&#34;https://testnet-explorer.binance.org/tx/FDCC528B9F98E9CEEDCB113A398A747F440666061340535D44C526D79F9CD667&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æª¢æŸ¥é€™æ¬¡ tx Deposit swap çš„å…§å®¹&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password to sign with &lt;span class=&#34;s1&#34;&gt;&amp;#39;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#39;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Committed at block &lt;span class=&#34;m&#34;&gt;47219070&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;tx hash: FDCC528B9F98E9CEEDCB113A398A747F440666061340535D44C526D79F9CD667, response: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Code:0 Data:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; Log:Msg 0:  Info: GasWanted:0 GasUsed:0 Tags:&lt;span class=&#34;o&#34;&gt;[{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; 114&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;103&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;48&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;122&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; 101&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; 116&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; 100&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111&lt;/span&gt; 110&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;72&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;84&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;76&lt;/span&gt; 84&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}]&lt;/span&gt; Codespace: XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç™¼èµ·æ–¹-claim-htlt&#34;&gt;ç™¼èµ·æ–¹ Claim HTLT&lt;/h3&gt;
&lt;p&gt;é‡å°æ¯ç­† HTLT ï¼Œè§£é–é–ä½çš„ assetsã€‚æ¯å€‹ HTLT åªèƒ½è¢«è§£é–ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token claim &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id  &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --random-number &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RANDOM_NUMBER&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --from &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FROM_ADDR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥æˆåŠŸ claimï¼Œ&lt;a href=&#34;https://testnet-explorer.binance.org/tx/D08F81D0315F0A7B13E510782F6E56804803B5198F4914C8EB10E3A5084F2BAA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æª¢æŸ¥é€™æ¬¡ tx Deposit swap çš„å…§å®¹&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password to sign with &lt;span class=&#34;s1&#34;&gt;&amp;#39;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&amp;#39;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Committed at block &lt;span class=&#34;m&#34;&gt;47219128&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;tx hash: D08F81D0315F0A7B13E510782F6E56804803B5198F4914C8EB10E3A5084F2BAA, response: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Code:0 Data:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; Log:Msg 0:  Info: GasWanted:0 GasUsed:0 Tags:&lt;span class=&#34;o&#34;&gt;[{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; 114&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; 100&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; 116&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;103&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;48&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;122&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; 101&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; 114&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; 100&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; 116&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;103&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;117&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; 112&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111&lt;/span&gt; 110&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;72&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;84&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;76&lt;/span&gt; 84&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}]&lt;/span&gt; Codespace: XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æŸ¥è©¢-swap-ç‹€æ…‹&#34;&gt;æŸ¥è©¢ swap ç‹€æ…‹&lt;/h3&gt;
&lt;p&gt;å¾ open è®Šæˆ completed&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token query-swap &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;from&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;out_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:[{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;denom&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;30000000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;in_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:[{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;denom&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10000000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;expected_income&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10000000:BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;recipient_other_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number_hash&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;4cf88f1acf8bcbc628609f3257406913f67e009e5c61f2671b601e40f4e5cc6a&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cb5f6296078fd73b86d03eb58bc8a6e0af8d4b60c1cd678b71f8c185e206db53&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1572506189&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;cross_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;expire_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;47222542&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2254&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;closed_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1572506323&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Completed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ¨£ swap å°±å®Œæˆäº†&lt;/p&gt;
&lt;h3 id=&#34;è¶…æ™‚-expired-è™•ç†&#34;&gt;è¶…æ™‚ (Expired) è™•ç†&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼ HTLT æ˜¯æœ‰æ™‚é–“é™åˆ¶ï¼Œæœ‰å¯èƒ½æœƒè¶…æ™‚ï¼Œæœƒç„¡æ³•ç¹¼çºŒæ“ä½œï¼Œä¾‹å¦‚å¦å¤–ä¸€ç­† HTLT åœ¨å—æ–¹ deposit æ™‚ç„¡æ³• deposit&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token deposit &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --amount 1:BNB &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --from &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RECIPIENT_ADDR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;ERROR:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;codespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;abci_code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;524302&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Current block height is 46046996, the swap expire height(46043293) is passed&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¶…é swap block height äº†ï¼Œå—æ–¹é€™é‚Šé€¾æ™‚å»å­˜éŒ¢ï¼Œå°è‡´æ•´å€‹ swap expiredï¼Œä¸èƒ½åœ¨åšä»€éº¼äº‹&lt;/p&gt;
&lt;p&gt;ç™¼èµ·æ–¹å»é€é refund è§£é–&lt;/p&gt;
&lt;h3 id=&#34;refund-htlt&#34;&gt;Refund HTLT&lt;/h3&gt;
&lt;p&gt;è‹¥æ˜¯å·²ç¶“ complete æˆ–æ˜¯ timeout expiredï¼Œç™¼èµ· HTLT çš„ address å¯ä»¥é€é refund ä¾†å–å›è³‡ç”¢&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token refund &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --from &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FROM_ADDR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›è¦† tx çš„ç‹€æ…‹ï¼Œ&lt;a href=&#34;https://testnet-explorer.binance.org/tx/F0F5AB40EF7B1CCFE54EBAE0B8022E9B3C381D0029C55A8FE7C3C87E8ACF800D&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯ä»¥åœ¨explorer ä¸Šçœ‹åˆ°&lt;/a&gt;ï¼Œtransaction type ç‚º refund swap&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Committed at block &lt;span class=&#34;m&#34;&gt;46047771&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tx hash: F0F5AB40EF7B1CCFE54EBAE0B8022E9B3C381D0029C55A8FE7C3C87E8ACF800D, 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  response: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Code:0 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Data:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Log:Msg 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    0:  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Info: 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        GasWanted:0 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        GasUsed:0 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Tags:&lt;span class=&#34;o&#34;&gt;[{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; 114&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;104&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;119&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;113&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; 100&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; 116&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;98&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;112&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;103&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;115&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;118&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;48&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;109&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;108&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;122&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;57&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;54&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; 101&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;Key:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;99&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;116&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111&lt;/span&gt; 110&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Value:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;114&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;117&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;72&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;84&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;76&lt;/span&gt; 84&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; XXX_sizecache:0&lt;span class=&#34;o&#34;&gt;}]&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Codespace: 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          XXX_NoUnkeyedLiteral:&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          XXX_unrecognized:&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          XXX_sizecache:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°æŸ¥è©¢ swap ç‹€æ…‹ï¼Œå·²ç¶“è®Šæˆ expired&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token query-swap &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --swap-id &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SWAP_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;from&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;out_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nt&#34;&gt;&amp;#34;denom&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nt&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;in_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;expected_income&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1:BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;recipient_other_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number_hash&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2c2588c81a5f08bf55a183cc2d61a123368405638741169933e200c90f4532e5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1571905650&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;cross_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;expire_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;46043293&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2239&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;closed_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1571908256&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Expired&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;from-ethereum-to-binance-chain&#34;&gt;å¾ Ethereum swap åˆ° Binance Chain&lt;/h1&gt;
&lt;p&gt;é€™é‚Šæˆ‘å€‘è¦å¾ ethereum ä¸Šï¼Œå°‡ ERC-20 token èˆ‡ binance chain ä¸Šçš„ BNB åšäº¤æ›ï¼Œå…ˆæº–å‚™éœ€è¦ç”¨åˆ°çš„æ±è¥¿&lt;/p&gt;
&lt;h3 id=&#34;binance-testnet&#34;&gt;binance testnet&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æº–å‚™å¥½ address èˆ‡ BNBï¼Œé€™é‚Šæ²¿ç”¨æˆ‘å€‘ä¸Šç¯‡ä½¿ç”¨çš„ address &lt;a href=&#34;https://testnet-explorer.binance.org/address/tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ethereum-testnet-ropsten&#34;&gt;ethereum testnet (ropsten)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Admin Address &lt;a href=&#34;https://ropsten.etherscan.io/address/0x938a452d293c23c2cdeae0bf01760d8ecc4f826b&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;[ropsten etherscan]&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éƒ¨ç½² ERC20 token &lt;a href=&#34;https://ropsten.etherscan.io/address/0xDec348688B060fB44144971461b3BAaC8BD1e571&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;[ropsten etherscan]&lt;/a&gt;ï¼Œæˆ‘è‡ªå·±ç™¼è¡Œçš„ &lt;a href=&#34;https://ropsten.etherscan.io/token/0xDec348688B060fB44144971461b3BAaC8BD1e571&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Party Parrot Token (PPT)&lt;/a&gt; 















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://cultofthepartyparrot.com/parrots/hd/parrot.gif&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;éƒ¨ç½² ERC20 Atomic Swapper æ™ºèƒ½åˆç´„
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chechiachang/bep3-smartcontracts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;binance-chain/bep3-smartcontract&lt;/a&gt; æä¾›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;nodevm&#34;&gt;Node/VM&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ä¾†åŸ·è¡Œ bep3 deputy process
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/binance-chain/bep3-deputy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/binance-chain/bep3-deputy&lt;/a&gt; æä¾›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;workflow&#34;&gt;workflow&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘çœ‹ä¸€ä¸‹å®˜æ–¹æä¾›çš„é€™å¼µåœ–&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://docs.binance.org/assets/eth2bnc.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Wallet Address åœ¨ ERC20 Token (PPToken) approve() Swap Contract ä¸€éƒ¨åˆ† Token&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– Swap Transaction(tx)&lt;/li&gt;
&lt;li&gt;Deputy ç›£æ¸¬åˆ° Ethereum éˆä¸Šçš„ swap txï¼Œå‘ Binance Chain ç™¼èµ·ä¸€å€‹å°æ‡‰çš„ HTLT txï¼Œç­‰å¾… Binance ä¸Šçš„ claim tx&lt;/li&gt;
&lt;li&gt;Wallet Address å‘ Binance Chain åŸ·è¡Œ HTLT claim()&lt;/li&gt;
&lt;li&gt;Deputy ç›£æ¸¬åˆ° Binance Chain ä¸Šçš„ claim tx èˆ‡ swap completeï¼Œä»£ç‚ºå‘ Ethereum claim ERC-20&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŸ·è¡Œ-deputy&#34;&gt;åŸ·è¡Œ deputy&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å¯ä»¥å…ˆå°‡ deputy ç¨‹åºè·‘èµ·ä¾†ï¼Œé€™é‚Šä½¿ç”¨çš„æ˜¯ &lt;a href=&#34;https://github.com/binance-chain/bep3-deputy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Binance Chaing/bep3-deputy&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go get github.com/binance-chain/bep3-deputy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;GOPATH&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;/src/github.com/binance-chain/bep3-deputy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ go mod download
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ make build
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go build  -o build/deputy main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿå‹•æœ¬åœ° MySQLï¼Œé€™é‚Šç›´æ¥ç”¨ docker èµ·ä¸€å€‹ç„¡å¯†ç¢¼çš„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker run \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --name some-mysql \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -e MYSQL_ALLOW_EMPTY_PASSWORD=yes \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -e MYSQL_DATABASE=deputy \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -d \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  mysql:5.7.27
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨­å®š config/confg.json&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;db_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;dialect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;mysql&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;db_path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;root:@(localhost:3306)/deputy?charset=utf8&amp;amp;parseTime=True&amp;amp;loc=Local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;chain_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;bnb_start_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;42516056&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;other_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ETH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;other_chain_start_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6495598&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;admin_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;listen_addr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1:8080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;bnb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;key_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;mnemonic&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;mnemonic&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;my-mnemonic&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;rpc_addr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tcp://data-seed-pre-0-s1.binance.org:80&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;symbol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;deputy_addr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;fetch_interval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;eth_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;swap_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;erc20_swap&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;key_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;private_key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;private_key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;my-private-key&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;provider&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://ropsten.infura.io/v3/cd9643b1870b489b93477921cb767882&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;swap_contract_addr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0xA08E0F38462eCd107adE62Ee3004850f2448f3d6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;token_contract_addr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0xDec348688B060fB44144971461b3BAaC8BD1e571&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;deputy_addr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;gas_limit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;gas_price&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20000000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ¨£æ³¨æ„å¹¾å€‹åœ°æ–¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;db_config å¡«ä¸Š mysql urlï¼Œæœ‰è¨­å¯†ç¢¼çš„è©±ä¸€ä½µå¸¶å…¥&lt;/li&gt;
&lt;li&gt;chain_config.bnb_start_height å¯ä»¥å…ˆè¿½åˆ°ç›®å‰çš„ block heightï¼Œç•¢ç«Ÿæˆ‘å€‘çš„ swap tx éƒ½åœ¨ deputy èµ·ä¾†ä¹‹å¾Œæ‰æœƒç”¢ç”Ÿï¼Œå¯ä»¥è·³éå•Ÿå‹•æ™‚ sync block çš„æ™‚é–“ã€‚å¦‚æœæ˜¯è¦è¿½éå»çš„ txï¼Œå°±è¦èª¿æ•´ block çš„é«˜åº¦ï¼Œä¸¦ä¸”çµ¦äºˆè¶³å¤ çš„æ™‚é–“ä¸Š deputy å» sync blockã€‚å¯ä»¥åˆ° &lt;a href=&#34;https://testnet-explorer.binance.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;testnet-explorer&lt;/a&gt; æŸ¥ç›®å‰çš„ block heightã€‚&lt;/li&gt;
&lt;li&gt;chain_config.other_chain_start_height ä¹Ÿè¿½åˆ°æœ€æ–°çš„ eth block heightï¼Œå¯ä»¥åˆ° &lt;a href=&#34;https://ropsten.etherscan.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Etherscan&lt;/a&gt; æŸ¥ç›®å‰çš„ block height&lt;/li&gt;
&lt;li&gt;bnb_config å¡«ä¸Š bnb addr èˆ‡åŠ©è¨˜ç¥ &lt;/li&gt;
&lt;li&gt;eth_config å¡«ä¸Š eth addr èˆ‡ private key&lt;/li&gt;
&lt;li&gt;eth_config.deupty_addr ä½¿ç”¨ Admin addrï¼Œä¸¦å¡«ä¸Š private key&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŠŠ deputy ä»¥ testnet ç‚ºç›®æ¨™åŸ·è¡Œèµ·ä¾†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./build/deputy --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./build/deputy &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --bnb-network &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --config-type &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --config-path config/config.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 DEBUG Debug sent a request
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 INFO fetch ETH cur height: &lt;span class=&#34;m&#34;&gt;6641795&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 DEBUG Debug sent a request
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 DEBUG Debug sent a request
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 INFO fetch BNB cur height: &lt;span class=&#34;m&#34;&gt;46215517&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 DEBUG Debug sent a request
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-10-25 17:16:48 INFO fetch try to get ahead block, &lt;span class=&#34;nv&#34;&gt;chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;BNB, &lt;span class=&#34;nv&#34;&gt;height&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;46215518&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;deputy å•Ÿå‹•å¾Œï¼Œå°±æœƒä¾æ“š db ä¸­çš„ block è³‡æ–™ï¼Œé–‹å§‹ä¸€è·¯è¿½ blockï¼Œç™¼ç¾æ˜¯ç›¸é—œçš„ addr å°±æŠŠ tx æ‹‰ä¸‹ä¾†è™•ç†ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘å€‘é€™é‚Šæ˜¯æ–° dbï¼Œæˆ‘å€‘åˆç›´æ¥è·³åˆ°æœ€æ–°çš„ blockï¼Œæ‡‰è©²ä¸æœƒéœ€è¦å¤ªå¤šæ™‚é–“å°±èƒ½è¿½ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;deputy æœ‰ admin api å¯ä»¥ä½¿ç”¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:8080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:8080/failed_swaps/1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;the number of total failed swaps is 0, the offset of query is &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:8080/status
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;mode&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;NormalMode&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;bnb_chain_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;46215719&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;bnb_sync_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;46215718&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;other_chain_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6641804&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;other_chain_sync_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6641804&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;bnb_chain_last_block_fetched_at&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2019-10-25T17:18:52+08:00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;other_chain_last_block_fetched_at&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2019-10-25T17:18:40+08:00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;bnb_status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;balance&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;symbol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;free&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;18.99812504&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;locked&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.00000000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;frozen&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.00000000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;other_chain_status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;allowance&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9.8e+13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;erc20_balance&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9.999999969e+20&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;eth_balance&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;6.982922764&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ° deputy ä¸Šè¨­å®šçš„ bnb_addr, eth_addr çš„ç‹€æ…‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;other_chain_status.allowance: 9.8e+13&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;é–‹å§‹-swap&#34;&gt;é–‹å§‹ Swap&lt;/h1&gt;
&lt;p&gt;è¤‡ç¿’ä¸€ä¸‹æµç¨‹&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://docs.binance.org/assets/eth2bnc.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol start=&#34;0&#34;&gt;
&lt;li&gt;éƒ¨ç½²å¥½ swap contract &amp;amp; deputyï¼Œå•Ÿå‹• deputy process&lt;/li&gt;
&lt;li&gt;Wallet Address åœ¨ ERC20 Token (PPToken) approve()ï¼Œçµ¦ Swap Contract ä¸€éƒ¨åˆ† Token&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– Swap Transaction(tx)&lt;/li&gt;
&lt;li&gt;Deputy ç›£æ¸¬åˆ° Ethereum éˆä¸Šçš„ swap txï¼Œå‘ Binance Chain ç™¼èµ·ä¸€å€‹å°æ‡‰çš„ HTLT txï¼Œç­‰å¾… Binance ä¸Šçš„ claim tx&lt;/li&gt;
&lt;li&gt;Wallet Address å‘ Binance Chain åŸ·è¡Œ HTLT claim()&lt;/li&gt;
&lt;li&gt;Deputy ç›£æ¸¬åˆ° Binance Chain ä¸Šçš„ claim tx èˆ‡ swap completeï¼Œä»£ç‚ºå‘ Ethereum claim ERC-20&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;erc20-contract-approve&#34;&gt;ERC20 contract Approve()&lt;/h3&gt;
&lt;p&gt;åˆ° ERC20 contract çš„é é¢ï¼Œé¸æ“‡ approve&lt;/p&gt;
&lt;p&gt;spender: swap contract address
value: 10000 PPToken (ä¹˜ä¸Š 10^18)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ropsten.etherscan.io/address/0xdec348688b060fb44144971461b3baac8bd1e571#events&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ° etherscan ä¸ŠæŸ¥çœ‹&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;call-htlt-function&#34;&gt;Call HTLT function&lt;/h3&gt;
&lt;p&gt;Go to swap contractï¼Œcall  htlt()&lt;/p&gt;
&lt;p&gt;ç”¨ etherscan é€ä¸Šå»ï¼Œç„¶å¾Œå°±å£æ‰äº†ï¼Œ&lt;a href=&#34;https://ropsten.etherscan.io/tx/0xbd0c829ad2466fcd6e49a12bbac1849827fb9e7a251271816401ed4c9bfe2fa8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Etherscan ä¸Šå£æ‰çš„ tx&lt;/a&gt; ä¸çŸ¥ç‚ºä»€éº¼ QAQ&lt;/p&gt;
&lt;p&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;bep3-atomic-swap-failure-01.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;



















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;bep3-atomic-swap-failure-02.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é–‹ remix IDEï¼Œé‡æ–°å˜—è©¦åƒæ•¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;randomNumberHash:
&lt;ul&gt;
&lt;li&gt;SHA256(randomNumber||timestamp), randomNumber is 32-length random byte array.&lt;/li&gt;
&lt;li&gt;0x0000000000000000000000000000000000000000000000000000000000000000&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;timestamp:
&lt;ul&gt;
&lt;li&gt;it should be about 10 mins span around current timestamp. &lt;a href=&#34;https://www.unixtimestamp.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;unix timestamp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1572250902 (now + 60 sec * 10 min)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;heightSpan:
&lt;ul&gt;
&lt;li&gt;it&amp;rsquo;s a customized filed for deputy operator. it should be more than 200 for this deputy.&lt;/li&gt;
&lt;li&gt;10000&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;recipientAddr:
&lt;ul&gt;
&lt;li&gt;deputy address on Ethereum.&lt;/li&gt;
&lt;li&gt;0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;bep2SenderAddr:
&lt;ul&gt;
&lt;li&gt;omit this field with 0x0&lt;/li&gt;
&lt;li&gt;0x0000000000000000000000000000000000000000&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;bep2RecipientAddr:
&lt;ul&gt;
&lt;li&gt;Decode your testnet address from bech32 encoded to hex&lt;/li&gt;
&lt;li&gt;0xee82ca237387495e9603f4d8d7efed128bdd59a6&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;outAmount:
&lt;ul&gt;
&lt;li&gt;approved amount, should be bumped by e^10.&lt;/li&gt;
&lt;li&gt;10 0000000000&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;bep2Amount:
&lt;ul&gt;
&lt;li&gt;outAmount * exchange rate, the default rate is 1.&lt;/li&gt;
&lt;li&gt;10 0000000000&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;deputy-call-htlt-on-binance-chain&#34;&gt;Deputy Call HTLT on Binance Chain&lt;/h3&gt;
&lt;p&gt;Deputy ç›£æ¸¬ Ethereum ä¸Šçš„ block ç‹€æ…‹ï¼Œç‰¹åˆ¥æ˜¯æœƒå–å¾— Swap contract address çš„ swap txï¼Œä¸¦åœ¨ Binance Chain ä¸Šç”¢ç”Ÿå°æ‡‰çš„ HTLTã€‚&lt;/p&gt;
&lt;h3 id=&#34;claim-htlt-on-binance-chain&#34;&gt;Claim HTLT on Binance Chain&lt;/h3&gt;
&lt;p&gt;Binance Chain ä¸Šç”¢ç”Ÿ HTLT å¾Œï¼Œå®¢æˆ¶ç«¯é€™é‚Šå¯ä»¥ä½¿ç”¨ tbnb ä»¥ recipient addr æŸ¥è©¢ Binance Chain ä¸Šçš„ Swap ID&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token query-swapIDs-by-recipient  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --recipient-addr tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --chain-id Binance-Chain-Nile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --trust-node &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç²å¾—éå»ç”¢ç”Ÿçš„ swap list&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;c2be98ac3b9ee7153e5ba84edfefca1917b6e2ec72d2576bf6cce584cbd6095e&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;18c938b994c62bcce9e8cedcb426a603863d95565a246c323a1df89d5c4226c1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;5c4fdd60ce44fa4be6de70e65df3f8295df88178fd381b4242a8c2d047663a1b&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;a47c89dfca910cbb34dec92acebebb59d2c62e7f90bf216a87c2c23c84e48d4f&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ½æ˜¯éå»ä½¿ç”¨çš„ swap idï¼Œå¦‚æœéƒ½æ²’æœ‰æ–°çš„ swap å‡ºä¾†ï¼Œå¯èƒ½æ˜¯ height span å¤ªé«˜ï¼Œå°è‡´ä¸€ç›´éƒ½çˆ¬ä¸åˆ°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SWAP_ID=c2be98ac3b9ee7153e5ba84edfefca1917b6e2ec72d2576bf6cce584cbd6095e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token query-swap \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --swap-id ${SWAP_ID} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --chain-id Binance-Chain-Nile \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --trust-node \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šè¦å°ä¸€ä¸‹ random number, to wallet addr, out amount ç­‰åƒæ•¸ï¼Œå¦‚æœ HTLT ç¬¦åˆï¼Œå®¢æˆ¶å°±å¯ä»¥åŸ·è¡Œ Claim HTLT&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token claim \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --swap-id ${SWAP_ID} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --random-number ${RANDOM_NUMBER} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from ${FROM_KEY} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --chain-id Binance-Chain-Nile \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --trust-node \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;deputy-claim-erc20-token&#34;&gt;Deputy Claim ERC20 Token&lt;/h3&gt;
&lt;p&gt;å®¢æˆ¶ç«¯åœ¨ Binance Chain ä¸Š Claim HTLTï¼ŒDeputy åœ¨ Ethereuem ä¸Š Claim HTLTï¼Œè‡³æ­¤å®Œæˆ Atomic Swap å…©é‚Šçš„æµç¨‹ã€‚å®¢æˆ¶ç«¯å¾ Binance Chain Claimï¼ŒDeputy å¾ Ethereuem ä¸Š Claimã€‚å®Œæ•´æµç¨‹
å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Client Call HTLT on Ethereum -&amp;gt; Deputy Call HTLT on Binance Chain&lt;/li&gt;
&lt;li&gt;Client Check HTLT Status on Binance Chain&lt;/li&gt;
&lt;li&gt;Client Call Claim HTLT on Binance Chain -&amp;gt; Deputy Call Claim HTLT on Ethereum&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;client-app-javascript-demo&#34;&gt;Client APP javascript Demo&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.binance.org/atomic-swap.html#6-demo-for-client-app-swap-erc20-to-bep2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸Œæœ›ç›´æ¥å¯«æˆ javascript app å¯ä»¥åƒè€ƒé€™ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;from-binance-chaing-to-ethereum&#34;&gt;Swap Tokens from Binance Chain to Ethereum&lt;/h1&gt;
&lt;p&gt;é€™é‚Šé€²è¡Œåå‘æ“ä½œï¼Œå®¢æˆ¶ç™¼èµ·å¾ Binance Chain æ›åˆ° Ethereum ä¸Šçš„è«‹æ±‚ï¼ŒDeputy åšå°æ‡‰çš„è™•ç†ï¼ŒæŠŠ Token Swap åˆ° Ethereumã€‚æˆ‘å€‘ä¾æ¨£ä¾ç…§&lt;a href=&#34;https://docs.binance.org/atomic-swap.html#swap-tokens-from-binance-chain-to-ethereum&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€™ä»½æ–‡ä»¶&lt;/a&gt;æ“ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ¶ç«¯åœ¨ Binance Chain ä¸Š Call HTLT()&lt;/li&gt;
&lt;li&gt;Deputy åœ¨ Ethereum ä¸Š Init Swap tx&lt;/li&gt;
&lt;li&gt;Deputy Call Approve() åˆ° ethereum swap contract&lt;/li&gt;
&lt;li&gt;å®¢æˆ¶ç«¯å–å¾— swap è³‡è¨Š&lt;/li&gt;
&lt;li&gt;å®¢æˆ¶ç«¯åœ¨ Ethereum ä¸Š Call Claim()ï¼Œå–å¾— ERC-20 Token&lt;/li&gt;
&lt;li&gt;Deputy åœ¨ Binance ä¸Š Call Claim()ï¼Œå–å¾— Binance Chain Token&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åœ¨-binance-chain-ä¸Š-htlt&#34;&gt;åœ¨ Binance Chain ä¸Š HTLT&lt;/h3&gt;
&lt;p&gt;å®¢æˆ¶ç«¯ç™¼èµ· HTLT è«‹æ±‚ï¼Œéœ€è¦å¾å®¢æˆ¶ç«¯ Wallet é€å‡ºï¼ˆä½†å› ç‚ºæˆ‘å€‘é€™é‚Šåªä½¿ç”¨ä¸€å€‹ Binance Addressï¼Œæ‰€ä»¥ç™¼èµ·çš„ Addr è·Ÿ Deputy Binance addr æ˜¯ä¸€æ¨£çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šé–é€² 10:BNBï¼Œç­‰å¾… 100:PPT å¾ ethereum è¿‘ä¾†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DEPUTY_BNB_WALLET_ADDR=tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CLIENT_BNB_WALLET_ADDR=${DEPUTY_BNB_WALLET_ADDR}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CLIENT_ETHEREUM_ADDR=0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token HTLT \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from ${CLIENT_BNB_WALLET_ADDR} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --recipient-addr ${DEPUTY_BNB_WALLET_ADDR}  \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --chain-id Binance-Chain-Nile  \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --height-span 500 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --amount  10:BNB  \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --expected-income 100:PPT  \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --recipient-other-chain ${CLIENT_ETHEREUM_ADDR}  \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --cross-chain \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --trust-node \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;HTLT å›å¾©çš„çµæœå¦‚ä¸‹ï¼Œå¯ä»¥åœ¨&lt;a href=&#34;https://testnet-explorer.binance.org/tx/D653FC7B5D2048A2A165F49426CDCAD733703CF534367133819091892E3A1F14&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Binance Testnet Explorer&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Random number: 75267ba4cc4f2d9ddbf9f90dc1ea813ae2a4d2114eb2ef2cb7ff0a5d285c7396
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Timestamp: 1572337686
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Random number hash: dabd990af86582969d47218012ecdb09899b9ad2b069c05be94ef82bea889a1b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password to sign with &amp;#39;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#39;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Committed at block 46889130 (tx hash: D653FC7B5D2048A2A165F49426CDCAD733703CF534367133819091892E3A1F14, response: {Code:0 Data:[119 24 196 176 181 1 29 177 60 107 100 166 55 16 253 136 159 3 204 56 109 46 63 87 93 9 239 158 138 172 21 129] Log:Msg 0: swapID: 7718c4b0b5011db13c6b64a63710fd889f03cc386d2e3f575d09ef9e8aac1581 Info: GasWanted:0 GasUsed:0 Tags:[{Key:[115 101 110 100 101 114] Value:[116 98 110 98 49 97 54 112 118 53 103 109 110 115 97 121 52 97 57 115 114 55 110 118 100 48 109 108 100 122 50 57 97 54 107 100 120 121 101 51 55 99 101] XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {Key:[114 101 99 105 112 105 101 110 116] Value:[116 98 110 98 49 119 120 101 112 108 121 119 55 120 56 97 97 104 121 57 51 119 57 54 121 104 119 109 55 120 99 113 51 107 101 52 102 102 97 115 112 51 100] XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {Key:[97 99 116 105 111 110] Value:[72 84 76 84] XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0}] Codespace: XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å–å¾— swap id èˆ‡ random numberï¼Œä½¿ç”¨ swap ip æŸ¥è©¢&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SWAP_ID=7718c4b0b5011db13c6b64a63710fd889f03cc386d2e3f575d09ef9e8aac1581
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tbnbcli token query-swap \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --swap-id ${SWAP_ID} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --chain-id Binance-Chain-Nile \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --trust-node \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --node http://data-seed-pre-0-s3.binance.org:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›å¾©ç•¶å‰çš„ç‹€æ…‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;from&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;out_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;denom&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;BNB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;in_amount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;expected_income&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;100:PPT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;recipient_other_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number_hash&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;dabd990af86582969d47218012ecdb09899b9ad2b069c05be94ef82bea889a1b&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;random_number&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1572337686&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;cross_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;expire_height&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;46889630&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2245&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;closed_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Open&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;deputy-appove-token&#34;&gt;Deputy Appove Token&lt;/h3&gt;
&lt;p&gt;Deputy å·²ç¶“æŠ“åˆ° Binance Chain ä¸Šçš„ txï¼Œæœƒè¨˜éŒ„åœ¨ Mysql å…§&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;use deputy;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;select * from tx_log limit 10;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| id | chain | swap_id                                                          | tx_type   | tx_hash                                                          | contract_addr | sender_addr                                 | receiver_addr                               | sender_other_chain                         | other_chain_addr                           | in_amount | out_amount | out_coin | random_number_hash                                               | expire_height | timestamp  | random_number | block_hash                                                       | height   | status    | confirmed_num | create_time | update_time |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;|  2 | BNB   | 7718c4b0b5011db13c6b64a63710fd889f03cc386d2e3f575d09ef9e8aac1581 | BEP2_HTLT | d653fc7b5d2048a2a165f49426cdcad733703cf534367133819091892e3a1f14 |               | tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce | tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce |                                            | 0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b | 100:PPT   | 10         | BNB      | dabd990af86582969d47218012ecdb09899b9ad2b069c05be94ef82bea889a1b |      46889630 | 1572337686 |               | 6948f34e4013da29c9922306b60b2c12f174925c63ff2a46d6b2fc3acd7a3774 | 46889130 | CONFIRMED |             6 |  1572337694 |  1572337695 |
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;deputy-send-htlt-on-ethereum&#34;&gt;Deputy Send HTLT on Ethereum&lt;/h3&gt;
&lt;p&gt;æŸ¥è©¢ Ethereum ä¸Šçš„ HTLT&lt;/p&gt;
&lt;h3 id=&#34;å®¢æˆ¶ç«¯-call-claim-å–å¾—-erc-20-token&#34;&gt;å®¢æˆ¶ç«¯ Call Claim å–å¾— ERC-20 Token&lt;/h3&gt;
&lt;p&gt;å®¢æˆ¶ç«¯å–å¾— 100:PPT&lt;/p&gt;
&lt;h3 id=&#34;deputy-call-htlt-claim-å–å¾—-binance-token&#34;&gt;Deputy Call HTLT Claim å–å¾— Binance Token&lt;/h3&gt;
&lt;p&gt;Deputy å–å¾— 10:BNB&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;gce&#34;&gt;GCE&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud compute ssh dep3-deputy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install mysql-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo cat /etc/mysql/debian.cnf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://dl.google.com/go/go1.13.3.linux-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tar -C /usr/local -xzf go1.13.3.linux-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;export PATH=$PATH:/usr/local/go/bin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go get github.com/binance-chain/bep3-deputy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go mod tidy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go build  -o build/deputy main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;references&#34;&gt;References&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.binance.org/atomic-swap.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Binace Chain Doc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/binance-chain/BEPs/blob/master/BEP3.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Binance BEP3 spec&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Deploy Kafka on Kubernetes</title>
      <link>https://chechia.net/zh-hant/slides/2019-10-18-kafka-on-k8s/</link>
      <pubDate>Fri, 18 Oct 2019 00:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/slides/2019-10-18-kafka-on-k8s/</guid>
      <description>&lt;h3 id=&#34;deploy-kafka-on-kubernetes&#34;&gt;Deploy Kafka on Kubernetes&lt;/h3&gt;
&lt;p&gt;Che-Chia Chang&lt;/p&gt;
&lt;p&gt;QRCode&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;about-me&#34;&gt;About Me&lt;/h3&gt;
&lt;p&gt;David (Che-Chia) Chang&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Backend / Devops @ &lt;a href=&#34;https://machix.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MachiX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.meetup.com/golang-taipei-meetup/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Golang Taipei Meetup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/2444&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ithelp Ironman Challenge&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://t.me/chechiachang&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://t.me/chechiachang&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;outline&#34;&gt;Outline&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Introduction to Kafka&lt;/li&gt;
&lt;li&gt;Deploy Kafka with Helm&lt;/li&gt;
&lt;li&gt;Kafka Topology&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/articles/10219040&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ithelp Ironman 30 days Challenge (7th-12nd day)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;introduction&#34;&gt;Introduction&lt;/h3&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/images/logo.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&#34;https://kafka.apache.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kafka.apache.org/&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;distributed-streaming-platform&#34;&gt;Distributed streaming platform&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Publish &amp;amp; Subscribe: r/w data like messaging system&lt;/li&gt;
&lt;li&gt;Store data in distributed, replicated, fault-tolerant cluster&lt;/li&gt;
&lt;li&gt;Scalable&lt;/li&gt;
&lt;li&gt;Realtime&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;concepts&#34;&gt;Concepts&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Kafka run as a cluster&lt;/li&gt;
&lt;li&gt;Kafka cluster stores streams of &lt;strong&gt;records&lt;/strong&gt; in categories called &lt;strong&gt;topics&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;record = (key, value, timestamp)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;kafka-diagram&#34;&gt;Kafka Diagram&lt;/h3&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/kafka-apis.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h3 id=&#34;topic-partitions&#34;&gt;Topic Partitions&lt;/h3&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/log_anatomy.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h3 id=&#34;topic-partitions-1&#34;&gt;Topic Partitions&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Data categorized by topic&lt;/li&gt;
&lt;li&gt;Data replicated in partitions&lt;/li&gt;
&lt;li&gt;Durability
&lt;ul&gt;
&lt;li&gt;consumer able to r/w complete data from at least 1 partition&lt;/li&gt;
&lt;li&gt;in order&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;distributed-data-streaming&#34;&gt;Distributed Data Streaming&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Scalible r/w bandwith&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Data Durability&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Consistency&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Availability&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Partition Tolerance&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;multi-consumer&#34;&gt;Multi Consumer&lt;/h3&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/log_consumer.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h3 id=&#34;consumer-group&#34;&gt;Consumer Group&lt;/h3&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/consumer-groups.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;70%&#34; height=&#34;70%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h3 id=&#34;consumer-group-1&#34;&gt;Consumer Group&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Partition deliver record to one consumer within each subscribing consumer group&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;deployment&#34;&gt;Deployment&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/helm/charts/tree/master/incubator/kafka&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm Kafka&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;deployment-1&#34;&gt;Deployment&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/kafka-on-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/kafka-on-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat install.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# https://github.com/helm/charts/tree/master/incubator/kafka&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kafka-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; incubator/kafka --version 0.16.2 -f values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Check values-staging.yaml before deployment&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;helm-chart-values&#34;&gt;Helm Chart Values&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Kafka:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The StatefulSet installs 3 pods by default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replicas: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The kafka image repository
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;image: &amp;#34;confluentinc/cp-kafka&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The kafka image tag
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;imageTag: &amp;#34;5.0.1&amp;#34;  # Confluent image for Kafka 2.0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Specify a imagePullPolicy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: http://kubernetes.io/docs/user-guide/images/#pre-pulling-images
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;imagePullPolicy: &amp;#34;IfNotPresent&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Configure resource requests and limits
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: http://kubernetes.io/docs/user-guide/compute-resources/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;resources: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # limits:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   cpu: 200m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   memory: 1536Mi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # requests:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   cpu: 100m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   memory: 1024Mi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafkaHeapOptions: &amp;#34;-Xmx4G -Xms1G&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The StatefulSet Update Strategy which Kafka will use when changes are applied.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;updateStrategy:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type: &amp;#34;OnDelete&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Start and stop pods in Parallel or OrderedReady (one-by-one.)  Note - Can not change after first release.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#pod-management-policy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;podManagementPolicy: OrderedReady
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## If RBAC is enabled on the cluster, the Kafka init container needs a service account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## with permissisions sufficient to apply pod labels
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rbac:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;affinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   podAntiAffinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     requiredDuringSchedulingIgnoredDuringExecution:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     - labelSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         matchExpressions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         - key: app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           operator: In
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           values:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           - kafka
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       topologyKey: &amp;#34;kubernetes.io/hostname&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   podAffinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     preferredDuringSchedulingIgnoredDuringExecution:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - weight: 50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        podAffinityTerm:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          labelSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            matchExpressions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - key: app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              operator: In
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              values:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                - zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          topologyKey: &amp;#34;kubernetes.io/hostname&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Configuration Overrides. Specify any Kafka settings you would like set on the StatefulSet
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## here in map format, as defined in the official docs.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: https://kafka.apache.org/documentation/#brokerconfigs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;configurationOverrides:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;default.replication.factor&amp;#34;: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;offsets.topic.replication.factor&amp;#34;: 1 # Increased from 1 to 2 for higher output
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;offsets.topic.num.partitions&amp;#34;: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;confluent.support.metrics.enable&amp;#34;: false  # Disables confluent metric submission
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;auto.leader.rebalance.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;auto.create.topics.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;controlled.shutdown.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;controlled.shutdown.max.retries&amp;#34;: 100
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;message.max.bytes&amp;#34;: &amp;#34;16000000&amp;#34; # Extend global topic max message bytes to 16 Mb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Persistence configuration. Specify if and how to persist data to a persistent volume.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;persistence:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Prometheus Exporters / Metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## Prometheus JMX Exporter: exposes the majority of Kafkas metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  jmx:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## Prometheus Kafka Exporter: exposes complimentary metrics to JMX Exporter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  kafka:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;topics: []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Zookeeper:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;zookeeper:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## If true, install the Zookeeper chart alongside Kafka
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## ref: https://github.com/kubernetes/charts/tree/master/incubator/zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;kubernetes-configurations&#34;&gt;Kubernetes Configurations&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;replicas&lt;/li&gt;
&lt;li&gt;resource&lt;/li&gt;
&lt;li&gt;pod affinity&lt;/li&gt;
&lt;li&gt;persistence&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;kafka-configurations&#34;&gt;Kafka Configurations&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;zookeeper&lt;/li&gt;
&lt;li&gt;configurationOverrides&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;default.replication.factor&amp;#34;: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;offsets.topic.replication.factor&amp;#34;: 1 # Increased from 1 to 2 for higher output
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;offsets.topic.num.partitions&amp;#34;: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;auto.leader.rebalance.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # &amp;#34;auto.create.topics.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;message.max.bytes&amp;#34;: &amp;#34;16000000&amp;#34; # Extend global topic max message bytes to 16 Mb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;monitoring-configurations&#34;&gt;Monitoring Configurations&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;prometheus exporter&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;monitoring is the key to production&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;deploy-after-understande-configs&#34;&gt;Deploy after Understande Configs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;All Kafka garantees are based on a correctly configured cluster&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Incorrect configs will cause cluster unstable and data loss&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Now we can deploy :)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;pods&#34;&gt;Pods&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po | grep kafka
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                                     READY   STATUS      RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-0                                                1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-1                                                1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-2                                                1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-exporter-88786d84b-z954z                         1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-zookeeper-0                                      1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-zookeeper-1                                      1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-zookeeper-2                                      1/1     Running     0          224d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id=&#34;availability&#34;&gt;Availability&lt;/h3&gt;
&lt;p&gt;ex. replication factor=3&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;3 partitions, each 1 in a kafka-broker&lt;/li&gt;
&lt;li&gt;1 master partition 2 slave partitions (readonly)&lt;/li&gt;
&lt;li&gt;data &lt;strong&gt;sync&lt;/strong&gt; from master to slave&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;availability-1&#34;&gt;Availability&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;kafka keep a number of slave in-synced
&lt;ul&gt;
&lt;li&gt;too many in-sync -&amp;gt; slow down write confirm&lt;/li&gt;
&lt;li&gt;not enough will -&amp;gt; data loss&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;on-slave-failure&#34;&gt;On slave failure&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;client not affected&lt;/li&gt;
&lt;li&gt;keep enough in-sync slaves&lt;/li&gt;
&lt;li&gt;wait dead slave to back online&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;on-master-failure&#34;&gt;On master failure&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;slave select new master within in-synced slaves&lt;/li&gt;
&lt;li&gt;new master sync to slaves&lt;/li&gt;
&lt;li&gt;new master serve clients&lt;/li&gt;
&lt;li&gt;wait dead master to back online and become slave&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;configs-availability&#34;&gt;Configs Availability&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Metadata are stored in zookeeper
&lt;ul&gt;
&lt;li&gt;topic configs&lt;/li&gt;
&lt;li&gt;partition configs&lt;/li&gt;
&lt;li&gt;consumer offsets&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;é‡é»&#34;&gt;é‡é»&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¦ä»”ç´°çœ‹å®Œ helm chart values çš„è¨­å®šï¼Œè¨­éŒ¯å°±å¹¹æ‰é‡ä¾†&lt;/li&gt;
&lt;li&gt;kafka çš„æ¦‚å¿µèˆ‡è¨­å®šï¼Œè¦èŠ±æ™‚é–“ç ”ç©¶æ¸…æ¥š&lt;/li&gt;
&lt;li&gt;resource &amp;amp; JVM heap size&lt;/li&gt;
&lt;li&gt;prometheus is a must&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ithelp-ironman-challenge&#34;&gt;Ithelp Ironman Challenge&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;30 å¤©å…§å®¹éƒ½æ˜¯ step-by-step&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…§å®¹åªæ˜¯ä»”ç´°çœ‹å®˜æ–¹æ–‡ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;challenge -&amp;gt; è‡ªæˆ‘æˆé•·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çµ¦è¼¸åœ¨èµ·è·‘é»çš„äºº&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;thank-you&#34;&gt;Thank you&lt;/h3&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Custom Resources with Operator SDK</title>
      <link>https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/</link>
      <pubDate>Tue, 15 Oct 2019 17:28:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;è¶…ç°¡çŸ­æ¨å‘ oeprator-sdk&lt;/li&gt;
&lt;li&gt;éµäººè³½å¿ƒå¾—&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‰¿ä¸Š&#34;&gt;æ‰¿ä¸Š&lt;/h1&gt;
&lt;p&gt;ä¸Šç¯‡ä»‹ç´¹äº† crd èˆ‡ controllerï¼Œç„¶è€Œæ²’æœ‰èªªæ˜ controller çš„ç·¨å¯«èˆ‡æ“ä½œï¼Œå› ç‚º controller çš„éƒ¨åˆ†æ¯”è¼ƒè¤‡é›œï¼Œæˆ‘å€‘éµäººæŒ‘æˆ°è³½å°¾è²ï¼Œç¯‡å¹…èªªå¯¦åœ¨æ˜¯ä¸å¤ªå¤ ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰èˆˆè¶£è©³ç´°äº†è§£çš„å¤§å¾·ï¼Œè«‹åƒè€ƒç›¸åŒéµäººæŒ‘æˆ°åœ˜éšŠçš„éšŠå‹æ–‡ç« ï¼Œè£é ­å° controller æœ‰è©³ç´°ä»‹ç´¹ï¼Œé€™é‚Šå°±ä¸è´…è¿°ã€‚ç›´æ¥æä¾›å€‹äººä½¿ç”¨è¦ºå¾—æœ€ç°¡å–®ä¸Šæ‰‹çš„ &lt;a href=&#34;https://github.com/operator-framework/operator-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;operator sdk&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;operator-sdk&#34;&gt;Operator SDK&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/operator-framework/operator-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Operator SDK&lt;/a&gt; æ˜¯ &lt;a href=&#34;https://github.com/operator-framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Operator framework&lt;/a&gt; ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½æœ‰æ•ˆä¸”è‡ªå‹•åŒ–çš„ç®¡ç† kubernetes native apps, operator çš„ç®¡ç†å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;è¤‡é›œçš„ kubernetes application æ˜¯éå¸¸é›£ç®¡ç†çš„ï¼Œå¯« operator ä¹Ÿæ˜¯å¾ˆæœ‰æŒ‘æˆ°ï¼Œä¸åƒ…è¦è™•ç†å¤§é‡ kubernetes åº•å±¤çš„ APIï¼Œè¦å¯«å¾ˆå¤šæ¨£ç‰ˆã€‚ operator SDK ä½¿ç”¨ controller-runtime çš„ library è®“ç·¨å¯« native application è®Šå¾—ç°¡å–®è¨±å¤š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨ä¸Šå±¤çš„ API èˆ‡æŠ½è±¡ä¾†ç·¨å¯« operator é‚è¼¯&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿä½¿ç”¨ code generation&lt;/li&gt;
&lt;li&gt;æœ‰æ“´å……å¥—ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;workflow&#34;&gt;Workflow&lt;/h1&gt;
&lt;p&gt;é€™é‚Šä»¥ golang ç‚ºä¾‹èªªæ˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£ operator sdk&lt;/li&gt;
&lt;li&gt;å®šç¾©æ–°çš„ API resource (custom resource definition)&lt;/li&gt;
&lt;li&gt;å®šç¾© controller ä¾†ç›£æ¸¬ custom resource&lt;/li&gt;
&lt;li&gt;ç·¨å¯« reconciling é‚è¼¯ä¾† sync desired state èˆ‡ current state&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ sdk cli é€²è¡Œæ¸¬è©¦&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ sdk cli ä¾† buildï¼Œä¸¦ç”¢ç”Ÿéƒ¨å±¬ç”¨çš„ manifests&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®‰è£è«‹ä¾ç…§ &lt;a href=&#34;https://github.com/operator-framework/operator-sdk/blob/master/doc/user/install-operator-sdk.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£èªªæ˜&lt;/a&gt; æ“ä½œå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä½¿ç”¨ sdk cli ä¾†å¢åŠ æ–°çš„ crd&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add a new API for the custom resource AppService
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ operator-sdk add api --api-version=app.example.com/v1alpha1 --kind=AppService
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”¢ç”Ÿçš„ go æºç¢¼æœƒæ”¾åœ¨ pkg ä¸­ï¼Œå¯ä»¥ä¾è‡ªå·±éœ€æ±‚èª¿æ•´ crd çš„çµæ§‹&lt;/p&gt;
&lt;p&gt;é€™é‚Šä½¿ç”¨ sdk cli ç”¢ç”Ÿå°æ‡‰ crd çš„ controllerï¼Œè£é ­å·²ç¶“å¯«å¥½å¤§éƒ¨åˆ†çš„ code gene èˆ‡ reconcile çš„æ¨£æ¿ï¼Œç›´æ¥ä¿®æ”¹å°±å¯ä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add a new controller that watches for AppService
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ operator-sdk add controller --api-version=app.example.com/v1alpha1 --kind=AppService
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹å®Œï¼Œç›´æ¥ä½¿ç”¨ sdk cli build æˆ imageï¼Œç„¶å¾Œæ¨åˆ° image hub ä¸Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Build and push the app-operator image to a public registry such as quay.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ operator-sdk build quay.io/example/app-operator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker push quay.io/example/app-operator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨å±¬å‰æª¢æŸ¥ä¸€ä¸‹ manefests æª”æ¡ˆï¼Œç‰¹åˆ¥æ˜¯ crd.yaml èˆ‡ operator.yamlï¼Œå¦‚æœæºç¢¼æœ‰èª¿æ•´è¨˜å¾—åšå°æ‡‰çš„ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Setup Service Account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f deploy/service_account.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Setup RBAC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f deploy/role.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f deploy/role_binding.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Setup the CRD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f deploy/crds/app.example.com_appservices_crd.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Deploy the app-operator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f deploy/operator.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ¨£ä¾¿éƒ¨å±¬äº† operatorï¼Œoperator æœƒç›£çœ‹æŒ‡å®šçš„ custom resourceï¼Œä¸¦ä¾ç…§ controller çš„é‚è¼¯é€²è¡Œ reconcileã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä»¥å¢åŠ  custom resource ç‚ºä¾‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Create an AppService CR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# The default controller will watch for AppService objects and create a pod for each CR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f deploy/crds/app.example.com_v1alpha1_appservice_cr.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¢åŠ ä¸€å€‹ cr åˆ° kubernetes ä¸Šï¼Œé€™æ™‚ operator æœƒåµæ¸¬åˆ° cr çš„è®ŠåŒ–ï¼Œä¸¦ä¸”ä¾ç…§ reconcile çš„é‚è¼¯ sync&lt;/p&gt;
&lt;p&gt;æª¢æŸ¥ä¸€ä¸‹ cr èˆ‡ operator çš„ç‹€æ…‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Verify that a pod is created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pod -l app=example-appservice
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                     READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;example-appservice-pod   1/1       Running   0          1m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è©³ç´°çš„æ“ä½œæ­¥é©Ÿå¯ä»¥çœ‹ &lt;a href=&#34;https://github.com/operator-framework/getting-started/blob/master/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€™é‚Š&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;p&gt;äº‹å¯¦ä¸Šï¼Œoperator sdk çš„åŠŸèƒ½é‚„æœ‰éå¸¸å¤šï¼Œç´°è¬›åˆè¦èŠ±å¥½å¹¾ç¯‡æ–‡ç« è¬›ï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒæœƒæ”¾åœ¨æˆ‘çš„å€‹äººç¶²ç«™ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤– operator sdk ä¹Ÿæ­¡è¿å¤–éƒ¨çš„ Issue èˆ‡ PRï¼Œåœ˜éšŠçš„äººéå¸¸ nice æœƒé¡˜æ„èŠ±æ™‚é–“è·Ÿç¤¾ç¾¤æœ‹å‹æºé€šï¼Œæœ‰èˆˆè¶£è«‹ä¾† contributeã€‚&lt;/p&gt;
&lt;p&gt;é€™ç³»åˆ—éµäººæ–‡ç« ï¼Œèªªå¯¦åœ¨æ²’æœ‰ä»€éº¼å¾ˆæ·±å…¥çš„æŠ€è¡“è¨è«–ï¼Œå¤šåŠè³‡æ–™éƒ½æ˜¯å„å€‹é …ç›®çš„å®˜æ–¹æ–‡ä»¶ç¿»è­¯ï¼ŒåŠ ä¸Šä¸€äº›å€‹äººçš„ç¶“é©—èˆ‡è§£è®€ï¼Œä¸¦ä¸æ˜¯å«é‡‘é‡å¾ˆé«˜çš„æ–‡ç« ã€‚ç„¶è€Œæˆ‘å€‹äººåœ¨æ¥è§¸é€™äº›é …ç›®æ™‚ï¼Œå»å¾€å¾€å› ç‚ºæ‰¾ä¸åˆ°ç´°ç¯€æ“ä½œçš„æ­¥é©Ÿåˆ†äº«æ–‡ç« ï¼Œåœ¨è¨±å¤šå°ç´°ç¯€ä¸Šæ’ç‰†å¾ˆä¹…ï¼Œä¹Ÿå› æ­¤æ‰æœ‰äº†é€™ç³»åˆ—æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç³»åˆ—æ–‡å°±åªæ˜¯è¸©é›·ä¹‹æ—…ï¼Œè®“å¾Œäººå¦‚æœæœ‰ç”¨åˆ°é€™äº›æ–‡ç« ï¼Œç”Ÿæ´»èƒ½éå¾—é–‹å¿ƒä¸€é»ï¼Œé€™ 30 å¤©çš„æ™‚é–“å°±æœ‰äº†åƒ¹å€¼ã€‚&lt;/p&gt;
&lt;p&gt;éµäººæŒ‘æˆ°è³½çš„æœ€å¾Œä¸€å¤©ï¼Œæ„Ÿè¬å„è·¯å¤§å¾·ä¸€è·¯ç›¸éš¨ï¼Œè®“æˆ‘åœ¨å‡æ—¥ä¹Ÿèƒ½å¿ƒç”˜æƒ…é¡˜åœ°åä¸‹ä¾†å¯«æ–‡ç« ã€‚æ¸¸æ–¼è—å¤©ä¸€ç¯‡çœŸçš„å¾ˆé€¼äººï¼Œæœ‰å¹¾å¤©çš„æ–‡ç« å“è³ªæ˜¯æœ‰è »å¤šå•é¡Œçš„ï¼Œä¹Ÿæ„Ÿè¬å¤§å¾·å€‘å”åŠ©æ‰éŒ¯ï¼Œçµ¦äºˆå¾ˆå¤šå»ºè­°ã€‚&lt;/p&gt;
&lt;p&gt;è¬è¬å„ä½ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Custom Resource Deployment</title>
      <link>https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resource-deployment/</link>
      <pubDate>Sun, 13 Oct 2019 22:03:08 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resource-deployment/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;CRD å…§å®¹&lt;/li&gt;
&lt;li&gt;Deploy CRD&lt;/li&gt;
&lt;li&gt;Use custom resource&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;recap&#34;&gt;Recap&lt;/h1&gt;
&lt;p&gt;åœ¨ä¸Šæ¬¡çš„ cert-manager å…§å®¹ä¸­æˆ‘å€‘èµ°é cert-manager çš„å®‰è£æ­¥é©Ÿï¼Œå…¶ä¸­æœ‰ä¸€å€‹æ­¥é©Ÿæ˜¯ apply cert-manager çš„ manigests æª”æ¡ˆ &lt;code&gt;*.yaml&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/jetstack/cert-manager/tree/release-0.11/deploy/manifests&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/jetstack/cert-manager/tree/release-0.11/deploy/manifests&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ git clone https://github.com/jetstack/cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ git checkout release-0.11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls deploy/manifest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;00-crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;01-namespace.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;BUILD.bazel	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;README.md	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm-values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å€‘å¿«é€Ÿçœ‹ä¸€ä¸‹é€™å€‹ 00-crds.yamlï¼Œé€™å€‹ yaml éå¸¸é•·ï¼Œç›´æ¥&lt;a href=&#34;https://github.com/jetstack/cert-manager/blob/release-0.11/deploy/manifests/00-crds.yaml#L1786&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·³åˆ° certificates.certmanager.k8s.io&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¸Œæœ›çœ‹ golang æºç¢¼æ–‡ä»¶çš„è©±ï¼Œå¯ä»¥æ­é…&lt;a href=&#34;https://godoc.org/k8s.io/apiextensions-apiserver/pkg/apis/apiextensions#CustomResourceDefinitionSpec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;godoc.org/k8s.io/apiextensions&lt;/a&gt; ä¾†é–±è®€ï¼Œæ›´èƒ½ç†è§£ definitionã€‚&lt;/p&gt;
&lt;p&gt;åœ¨çœ‹ä¹‹å‰å…ˆæ³¨æ„å¹¾ä»¶äº‹ï¼ŒCRD å…§é™¤äº† schema å¤–ï¼Œé‚„å®šç¾©äº†è¨±å¤šä¸åŒæƒ…å¢ƒçš„ä½¿ç”¨è³‡æ–™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CRD å…§å®šç¾©äº† custom resource çš„è³‡æ–™å„²å­˜ .spec.validation.openAPIV3Schemaï¼Œä½¿ç”¨ custom resource æœƒé€é validator é©—è­‰&lt;/li&gt;
&lt;li&gt;.openAPIV3Schema å…§å®šç¾©äº† .specï¼Œä»¥åŠ rumtime ä¸­ç´€éŒ„ .status çš„è³‡æ–™
&lt;ul&gt;
&lt;li&gt;controller å¯ä»¥æŠŠç‹€æ…‹ sync åˆ° custom resource çš„ .status ä¸­ç´€éŒ„&lt;/li&gt;
&lt;li&gt;controller å¯ä»¥æ¯”å° .spec èˆ‡ .status ä¾†æ±ºå®šæ˜¯å¦è¦ sync ä»¥åŠå¦‚ä½• sync&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CRD å…§å®šç¾©äº†èˆ‡ server ä»¥åŠ client äº’å‹•çš„æ–¹å¼ï¼Œ
&lt;ul&gt;
&lt;li&gt;names ä¸­å®šç¾©å„ç¨®ä½¿ç”¨æƒ…å¢ƒçš„ custom resource åç¨±&lt;/li&gt;
&lt;li&gt;additionalPrinterColumns ä¸­æ·»åŠ  kubectl ä¸­çš„é¡¯ç¤ºå…§å®¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// é€™é‚Šä½¿ç”¨çš„æ˜¯ v1beta1 çš„ API (deprecated at v1.16) ï¼Œæ–°ç‰ˆé–‹ç™¼å»ºè­°ä½¿ç”¨ apiextension.k8s.io/v1 çš„ api
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: apiextensions.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: CustomResourceDefinition
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  creationTimestamp: null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: certificates.cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  // ä½¿ç”¨ kubectl æœƒé¡å¤–é¡¯ç¤ºçš„è³‡è¨Šå…§å®¹ï¼Œé€é jsonpath å» parse é¡¯ç¤º
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  additionalPrinterColumns:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - JSONPath: .status.conditions[?(@.type==&amp;#34;Ready&amp;#34;)].status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: Ready
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    type: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - JSONPath: .spec.secretName
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: Secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    type: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - JSONPath: .spec.issuerRef.name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    priority: 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    type: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - JSONPath: .status.conditions[?(@.type==&amp;#34;Ready&amp;#34;)].message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: Status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    priority: 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    type: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - JSONPath: .metadata.creationTimestamp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    description: CreationTimestamp is a timestamp representing the server time when
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      this object was created. It is not guaranteed to be set in happens-before order
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      across separate operations. Clients may not set this value. It is represented
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      in RFC3339 form and is in UTC.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: Age
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    type: date
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  group: cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  // å®šç¾© CRD åœ¨ä¸åŒæƒ…å¢ƒä¸‹ä½¿ç”¨çš„åç¨±
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  names:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    listKind: CertificateList
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    plural: certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    shortNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - cert
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - certs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    singular: certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  scope: Namespaced
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  subresources:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    status: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  validation:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    // openAPIV3Schema ä¸­æ˜¯ custom resource å¯¦éš›æ“ä½œæœƒä½¿ç”¨çš„å…§å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    // properties ä½¿ç”¨ . .description .type ï¼Œåˆ†åˆ¥å®šç¾©åç¨±ï¼Œæè¿°ï¼Œæª¢æŸ¥å‹åˆ¥
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    openAPIV3Schema:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      description: Certificate is a type to represent a Certificate from ACME
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      properties:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        apiVersion:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          description: &amp;#39;APIVersion defines the versioned schema of this representation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            of an object. Servers should convert recognized schemas to the latest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          type: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        kind:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          description: &amp;#39;Kind is a string value representing the REST resource this
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            object represents. Servers may infer this from the endpoint the client
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          type: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        // custom resource runtime ä¸­çš„ metadata
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          type: object
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        // custom resource ä½¿ç”¨æ™‚çš„ specï¼Œå®šç¾© custom resoure çš„ desired status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        // custom controller ç›£æ¸¬ custom resource çš„ current statusï¼Œé€™é‚Šçš„è³‡æ–™å®Œå…¨è¦– controller å¯¦ä½œä¾†ç”¢ç”Ÿï¼Œå¦‚æœæ²’æœ‰å¯¦ä½œ sync statusï¼Œä¹Ÿå¯ä»¥æ²’æœ‰è³‡æ–™
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        status:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      type: object
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  // é€™å€‹æ˜¯ CRD ç‰©ä»¶çš„ versionï¼Œå¯ä»¥å®šç¾©å¤šå€‹ä¸åŒ version çš„ CRDï¼Œèª¿ç”¨æ™‚éœ€è¦è¨»æ˜ç‰ˆæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  version: v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  versions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    served: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    storage: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// é€™å€‹æ˜¯ CRD ç‰©ä»¶çš„ statusï¼Œæè¿° CRD éƒ¨ç½²åˆ° API server çš„ç‹€æ…‹ï¼Œä¾‹å¦‚ CRD å„²å­˜é©ç”¨ configmap çš„å„²å­˜ç©ºé–“ï¼Œé€™é‚Šé¡¯ç¤ºåœ¨ API server ä¸Šçš„å„²å­˜ç‹€æ…‹ã€‚ä¸è¦è·Ÿ custom resource çš„ status å¼„æ··äº†
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;status:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  acceptedNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kind: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    plural: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  conditions: []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  storedVersions: []
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;helm-values.yaml èˆ‡ 01-namespace.yaml å¾ˆå–®ç´”ï¼Œå‰è€…æ˜¯ä½¿ç”¨ helm éƒ¨ç½²çš„å¯è¨­å®šåƒæ•¸ï¼Œé è¨­åªæœ‰ kubernetes resourcesï¼Œå¾Œè€…å‰‡æ˜¯ç‚ºä¹‹å¾Œçš„ cert-manager å…ƒä»¶æ–°å¢ä¸€å€‹ kubernetes namespaceã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ-crd-å…§å®¹-apiextensionsv1beta1&#34;&gt;å°çµ CRD å…§å®¹ (apiextensions/v1beta1)&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;CRD é¡¯ç¤ºåç¨±ï¼Œå…§å®¹&lt;/li&gt;
&lt;li&gt;CRD spec é©—è­‰
&lt;ul&gt;
&lt;li&gt;custom resource&lt;/li&gt;
&lt;li&gt;custom resource schema&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CRD è‡ªèº«éƒ¨ç½²ç‹€æ…‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;éƒ¨ç½²&#34;&gt;éƒ¨ç½²&lt;/h1&gt;
&lt;p&gt;éƒ¨ç½²ç›¸è¼ƒå®šç¾©æœ¬èº«å°±éå¸¸ç°¡å–®ï¼Œç›´æ¥ kubectl apply åˆ° kubernetes ä¸Š&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨-custom-resource&#34;&gt;ä½¿ç”¨ custom resource&lt;/h1&gt;
&lt;p&gt;æœ‰äº† CRDï¼Œæˆ‘å€‘ä¾¿å¯ä»¥ä½¿ç”¨ CRUD APIï¼Œäº’å‹•æ¨¡å¼èˆ‡å…¶ä»– build-in kubernetes resources ç›¸åŒï¼Œåªæ˜¯å…§å®¹æœƒç…§ CRD ä¸Šçš„å®šç¾©èª¿æ•´&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get certificates.certmanager.k8s.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get certs --all-namespaces
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get cert -n cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAMESPACE          NAME                READY   SECRET              AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager       ingress-nginx-tls   True    ingress-nginx-tls   221d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šçœ‹åˆ°çš„å…§å®¹å¯èƒ½æœƒæœ‰äº›è½å·®ï¼Œå› ç‚ºæˆ‘ç•¶åˆç”¨çš„ç‰ˆæœ¬æ¯”è¼ƒèˆŠï¼Œä½†å…§å®¹å¤§åŒå°ç•°ã€‚&lt;/p&gt;
&lt;p&gt;åº•ä¸‹çš„ describe å…§å®¹å·²ç¶“è·Ÿä¸Šé¢çš„ CRD ç‰ˆæœ¬å·®å¤ªå¤šï¼Œå°ä¸èµ·ä¾†äº†ã€‚ä½†æˆ‘ä¹Ÿæ‡¶å¾—å†ä½ˆä¸€çµ„ï¼Œé‚„è¦é‡åš dnsName èˆ‡ authotization challenge&lt;/p&gt;
&lt;p&gt;ç›´æ¥è®“å¤§å®¶æ„Ÿå—ä¸€ä¸‹èˆŠç‰ˆçš„å…§å®¹XD&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl describe cert ingress-nginx-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name:         ingress-nginx-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Namespace:    cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;API Version:  certmanager.k8s.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Kind:         Certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Creation Timestamp:  2019-03-06T06:48:26Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Generation:          4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Owner References:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    API Version:           extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Block Owner Deletion:  true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Controller:            true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Kind:                  Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Name:                  ingress-nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Self Link:               /apis/certmanager.k8s.io/v1alpha1/namespaces/default/certificates/ingress-nginx-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Acme:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Config:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Domains:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        chechiachang.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Http 01:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Ingress:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Ingress Class:  nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Dns Names:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    chechiachang.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Issuer Ref:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Kind:       ClusterIssuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Name:       letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Secret Name:  ingress-nginx-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// ç•¶å‰çš„ statusï¼Œcontroller sync ä¸Šä¾†
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// controller æœƒæ¯”å° .spec èˆ‡ .statusï¼Œåˆ¤æ–·æ˜¯å¦éœ€è¦åšäº‹ï¼Œex. renew
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Status:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Acme:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Order:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      URL:  https://acme-v02.api.letsencrypt.org/acme/order/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Conditions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Last Transition Time:  2019-09-02T03:52:03Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Message:               Certificate renewed successfully
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reason:                CertRenewed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Status:                True
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Type:                  Ready
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Last Transition Time:  2019-09-02T03:52:01Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Message:               Order validated
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reason:                OrderValidated
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Status:                False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Type:                  ValidateFailed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Events:                    &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æƒ³è¦æ–°å¢ï¼Œå¯ä»¥å›å»çœ‹ &lt;a href=&#34;https://docs.cert-manager.io/en/latest/getting-started/install/kubernetes.html#verifying-the-installation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager tutorial&lt;/a&gt;ï¼Œé€™å€‹æ˜¯æ–°ç‰ˆçš„æ–‡ä»¶&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶ï¼Œä¸çˆ½é€™å€‹ cert resource ä¹Ÿå¯ä»¥å¹¹æ‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete cert ingress-nginx-tls -n cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Š&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ CRD èˆ‡ CRD å…§å®¹&lt;/li&gt;
&lt;li&gt;æ“ä½œ custom resource&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Custom Resources Basic</title>
      <link>https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/</link>
      <pubDate>Sun, 13 Oct 2019 17:28:12 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;custom resources&lt;/li&gt;
&lt;li&gt;custom controllers&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç°¡ä»‹-custom-resources&#34;&gt;ç°¡ä»‹ custom resources&lt;/h1&gt;
&lt;p&gt;Kubernetes é å…ˆå®šç¾©è¨±å¤š resource ï¼Œé€™äº› resource æ˜¯ &lt;a href=&#34;https://kubernetes.io/docs/reference/using-api/api-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes API&lt;/a&gt; é å…ˆè¨­ç½®çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;API objects&lt;/a&gt;ï¼Œä¾‹å¦‚ kubernetes pods resource åŒ…å«è¨±å¤š pods ç‰©ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Custom resoure å‰‡æ˜¯é€éæ“´å…… kubernetes API ï¼Œè®“è‡ªå®šç¾©çš„ç‰©ä»¶ä¹Ÿå¯ä»¥åœ¨ kubernetes ä¸Šä½¿ç”¨ã€‚ä¸Šç¯‡ cert-manager å°±ä½¿ç”¨äº†è¨±å¤š custom resourceï¼Œé€™äº› resource åœ¨ä¸€èˆ¬å®‰è£çš„ kubernetes ä¸Šæ²’æœ‰å®‰è£ï¼Œéœ€è¦å®‰è£ custom resource difinitionï¼Œå‘ kubernetes cluster å®šç¾©æ–°çš„ custom resourceã€‚ä¾‹å¦‚ certificates.certmanager.k8s.io å°±æ˜¯ cert-manager è‡ªå®šç¾©çš„è³‡æºï¼Œç”¨ä¾†ä»£è¡¨ç”¢ç”Ÿ x509 certificate çš„å…§å®¹ã€‚&lt;/p&gt;
&lt;p&gt;è¶Šä¾†è¶Šå¤šçš„ kubernetes core æ–¹æ³•ï¼Œå¦‚ä»Šä¹Ÿä½¿ç”¨ custom resources ä¾†å®šç¾©ï¼Œè®“ kubernetes æ ¸å¿ƒå…ƒä»¶æ›´åŠ æ¨¡çµ„åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;custom resource å¯ä»¥åœ¨é‹è¡Œä¸­çš„ kubernetes é›†ç¾¤ä¸­è¨»å†Š (registration) ï¼Œä¹Ÿå¯ä»¥å‹•æ…‹è¨»éŠ·ï¼Œcustom resource ä¸¦ä¸æœƒå½±éŸ¿é›†ç¾¤æœ¬èº«çš„é‹ä½œã€‚åªè¦å‘ kubernetes è¨»å†Šå®Œ custom resourceï¼Œå°±å¯ä»¥é€é API èˆ‡ kubectl æ§åˆ¶ custom resourceï¼Œå°±åƒæ“ä½œ Pod resource ä¸€æ¨£ã€‚&lt;/p&gt;
&lt;h1 id=&#34;custom-controllers&#34;&gt;Custom controllers&lt;/h1&gt;
&lt;p&gt;custom resource ä¸€ä½†è¨»å†Šï¼Œå°±å¯ä»¥ä¾æ“š resource çš„ CRD (custom resource definition) ä¾†æ“ä½œï¼Œå› æ¬¡å¯ä»¥å„²å­˜å®¢è£½åŒ–çš„è³‡æ–™å…§å®¹ã€‚ç„¶è€Œåœ¨å¾ˆå¤šæƒ…å½¢ï¼Œæˆ‘å€‘ä¸¦ä¸åªè¦ custom resource ä¾†è®€å¯«ï¼Œè€Œæ˜¯å¸Œæœ› custom resource èƒ½åŸ·è¡Œå®šç¾©çš„å·¥ä½œï¼Œå¦‚åŒ Pod resource å¯ä»¥åœ¨ kubernetes é›†ç¾¤ä¸Šæ§åˆ¶ Podï¼Œåœ¨ Pod resource ä¸Šæè¿°çš„ desired state kubernetes æœƒé€éå®šç¾©åœ¨ Pod API ä¸­çš„ sync é‚è¼¯ï¼Œä¾†é”åˆ° current state èˆ‡ desired state çš„å¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å¸Œæœ› custom resource ä¹Ÿèƒ½åšåˆ°ä¸Šè¿°çš„åŠŸèƒ½ï¼Œæä¾› declarative APIï¼Œè®“ä½¿ç”¨è€…ä¸éœ€ç·¨å¯«å®Œæ•´çš„ç¨‹å¼é‚è¼¯ï¼Œåªè¦é€éæ§åˆ¶ custom resourceï¼Œå°±å¯ä»¥é€é controller å…§å®šç¾©çš„é‚è¼¯ï¼Œä¾†å¯¦ç¾ desired stateã€‚ä½¿ç”¨è€…åªéœ€è¦å°ˆæ³¨åœ¨æ§åˆ¶ custom resource ä¸Šçš„ desired stateï¼Œè®“ controller è™•ç†ç´°ç¯€å¯¦ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šæˆ‘å€‘åœ¨ cert-manager ä¸­è¨­å®š certificates.certmanager.k8s.io è³‡æºï¼Œä¾†æè¿°æˆ‘å€‘å¸Œæœ›å–å¾— x509 certificate çš„ desired stateï¼Œä½†æˆ‘å€‘åœ¨ certificates.certmanager ä¸Šé¢æ²’æœ‰å¯«ã€é€é Let&amp;rsquo;s Encrypt å–å¾— x509 certificateã€çš„å¯¦ç¾é‚è¼¯ï¼Œä»ç„¶èƒ½é€é cert-manager ç”¢ç”Ÿ x509 certiticateï¼Œå› ç‚º cert-manager å…§éƒ¨å·²ç¶“å®šç¾© certificates.certmanager.k8s.io çš„ custom controllerã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬çš„ custom resource æ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨»å†Š custom resource definitionï¼Œè®“ kubernetes API çœ‹å¾—æ‡‚ custom resource
&lt;ul&gt;
&lt;li&gt;ä¸ç„¶ API æœƒå›è¦† error: the server doesn&amp;rsquo;t have a resource type&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ‰ CRD ä¾¿å¯ä»¥ apply custom resource åˆ°é›†ç¾¤ä¸­&lt;/li&gt;
&lt;li&gt;éƒ¨ç½² custom controllerï¼Œç›£æ¸¬ custom resource çš„ desired state å…§å®¹ï¼Œä¸¦å¯¦ç¾é”åˆ° desired state çš„æ¥­å‹™é‚è¼¯
&lt;ul&gt;
&lt;li&gt;æ²’æœ‰ custom controllerï¼Œcustom resource å°±åªæ˜¯å¯ä»¥ apply èˆ‡ update çš„è³‡æ–™å„²å­˜çµæ§‹ï¼Œæ²’æœ‰ cert-manager ä¸­ controller çš„é‚è¼¯ï¼Œä¹Ÿé‚„æ˜¯ç”Ÿä¸å‡º x509 certificateã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get chechiachang
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;error: the server doesn&amp;#39;t have a resource type &amp;#34;chechiachang&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;custom controller ä¹Ÿå¯ä»¥è·Ÿå…¶ä»–çš„ kubernetes resource äº’å‹•ï¼Œä¾‹å¦‚ cert-manager åœ¨ç”¢ç”Ÿ certificate çš„æ™‚å€™ï¼ŒæœƒæŠŠç”¢ç”Ÿçš„ certificate æª”æ¡ˆæ”¾åœ¨ secret ä¸­ï¼Œcert-manager æœƒä¾æ“š order ä¸­å®šç¾©çš„ lifecycle ï¼ŒæŒçºŒæª¢æŸ¥ certificate çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæ¥è¿‘éæœŸï¼Œå‰‡æœƒè§¸ç™¼æ–°çš„ä¸€è¼ª orderã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä¹Ÿå¯ä»¥å¯«ä¸€å€‹æ“ä½œ Configmap èˆ‡ Deployment Resource çš„ custom controllerï¼Œä¾†é€²è¡Œ deploymnet çš„ Image æ›´æ–°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æˆ‘éœ€è¦-custom-resource-å—&#34;&gt;æˆ‘éœ€è¦ custom resource å—&lt;/h1&gt;
&lt;p&gt;kubernetes åœ¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#should-i-add-a-custom-resource-to-my-kubernetes-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;should I add custom resource&lt;/a&gt; æœ‰åˆ—è¡¨åˆ†æè©²ä¸è©²ä½¿ç”¨ custom resource ï¼Œå°‡ä½ çš„ API é‚è¼¯æ•´åˆåˆ° kubernetes API ä¸Šã€‚å¹¾å€‹åˆ¤æ–·åƒè€ƒ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;API æ˜¯ &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#declarative-apis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;declarative model&lt;/a&gt;ï¼Œå¦‚æœä¸æ˜¯å¯èƒ½ä¸é©åˆè·Ÿ kubernetes API æ•´åˆï¼Œç¨ç«‹æˆç‚ºä¸€å€‹è‡ªå·±é‹è¡Œçš„æœå‹™å³å¯&lt;/li&gt;
&lt;li&gt;éœ€è¦ä½¿ç”¨ kubernetes&lt;/li&gt;
&lt;li&gt;éœ€è¦ä½¿ç”¨ kubectl æ§åˆ¶&lt;/li&gt;
&lt;li&gt;API éœ€è¦ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#common-features&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes æ”¯æ´çš„åŠŸèƒ½&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ­£å“‰é–‹ç™¼å…¨æ–°åŠŸèƒ½ï¼Œå› ç‚ºæ•´åˆèˆŠçš„æœå‹™åˆ° kubernetes API å·¥ç¨‹æµ©å¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¹Ÿè¨±-configmapsecret-å°±å¯ä»¥è§£æ±º&#34;&gt;ä¹Ÿè¨± configmap/secret å°±å¯ä»¥è§£æ±º&lt;/h1&gt;
&lt;p&gt;å¦‚æœåªæ˜¯éœ€è¦å°‡è³‡æ–™å„²å­˜åœ¨ kubernetes ä¸Šï¼Œæœ‰ä¸€å€‹ build-int çš„ kubernetes resource å¾ˆé©åˆï¼Œå°±æ˜¯ configmapã€‚å¯ä»¥ç˜€è€ƒä»¥ä¸‹æ¢ä»¶ï¼Œåˆ¤æ–·æ˜¯å¦ configmap æ­é…èƒ½ç›£çœ‹ configmap çš„ controller å°±å¯ä»¥é”æˆéœ€æ±‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·²ç¶“æœ‰å®Œæ•´çš„ config fileï¼Œä¾‹å¦‚ mysql.cnf, nginx.conf&amp;hellip;&lt;/li&gt;
&lt;li&gt;ä¸»è¦ç”¨é€”æ˜¯æŠŠæª”æ¡ˆæ›è¼‰åˆ° Pod ä¸­çš„ process ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ™‚çš„æ ¼å¼ï¼Œæ˜¯æ•´å€‹æª”æ¡ˆæ”¾åœ¨ Pod ä¸­ï¼Œæˆ–æ˜¯ä½¿ç”¨ç’°å¢ƒè®Šæ•¸å¡åˆ° Pod è£¡é¢ï¼Œè€Œä¸æ˜¯é€é kubernetes API å­˜å– (ex ä½¿ç”¨ kubectl)&lt;/li&gt;
&lt;li&gt;æ›´æ–° configmpa æ™‚æ›´æ–° Podï¼Œæœƒæ¯”æ›´æ–° custom resource æ™‚æ›´æ–° Pod å®¹æ˜“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ CRD æˆ– Aggregated kubernetes APIï¼Œå¤§å¤šç¬¦åˆä¸‹åˆ—æ¢ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ kubernetes libraries èˆ‡å®¢æˆ¶ç«¯ (ex kubectl) æ“ä½œ custom resource&lt;/li&gt;
&lt;li&gt;éœ€è¦ top level çš„ kubernetes æ”¯æ´ï¼Œä¾‹å¦‚å¯ä»¥ kubectl get cheachiachang&lt;/li&gt;
&lt;li&gt;è‡ªå‹•åŒ– kubernetes ç‰©ä»¶&lt;/li&gt;
&lt;li&gt;éœ€è¦ç”¨åˆ° .spec, .status, .metadataï¼Œé€™äº›æ¯”è¼ƒ desired state èˆ‡ currenty state çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;éœ€è¦æŠ½è±¡é¡åˆ¥ä¾†ç®¡ç†ä¸€ç¾¤ controlled resource&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;custom-resource-definition&#34;&gt;Custom Resource Definition&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Custom Resoure Definition&lt;/a&gt; è®“ä½¿ç”¨è€…å¯ä»¥å®šç¾© custom resourceï¼Œå®šç¾© custom resource çš„æ ¼å¼åŒ…æ‹¬åç¨±èˆ‡ data schemaï¼Œç„¶å¾Œäº¤çµ¦ kubernetes API å»è™•ç† custom resource çš„å„²å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯èªªï¼Œé€é CRD æˆ‘å€‘ä¸ç”¨å¯« custom resource çš„ APIï¼Œä¾‹å¦‚ cert-manager ä¸ç”¨å¯« certificates.certmanager.k8s.io çš„ APIï¼Œè€Œæ˜¯å‘ kubernetes API server è¨»å†Š CRDï¼Œè®“ kubernetes API server çœ‹å¾—æ‡‚ custom source çš„å®šç¾©ï¼Œä¸¦ä¸”ç›´æ¥ä½¿ç”¨ kubernetes API serverï¼Œé€²è¡Œ custom resource çš„ CRUDã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å¯ä»¥é€é kubectl (API server) æ“ä½œ certificates.certmanager.k8s.ioï¼Œé€™å€‹è«‹æ±‚ä¹Ÿæ˜¯é€åˆ° kubernetes API serverã€‚&lt;/p&gt;
&lt;h1 id=&#34;api-server-aggregation&#34;&gt;API server aggregation&lt;/h1&gt;
&lt;p&gt;èƒ½å¤ é€éè¨»å†Š CRD ï¼Œå°±å¯ä»¥ä½¿ç”¨åŸä¾†çš„ kubernetes API ä¾†é€²è¡Œ CRUD ï¼Œæ˜¯å› ç‚º kubernetes API å°æ–¼æ™®é€šçš„ API æ“ä½œæä¾›æ³›å‹ (generic) ä»‹é¢ï¼Œç›´æ¥ä½¿ç”¨ CRUD çš„é‚è¼¯ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æ˜¯ kubernetes Aggregated API ï¼Œæ‰€æœ‰ kubernetes çš„ clients éƒ½ä¸€èµ·å…¼å®¹æ–°è¨»å†Šçš„ custom resourceï¼Œä¸ç”¨åœ¨ API è¦å®šç¾©ï¼Œåœ¨å†Šæˆ¶ç«¯ä¹Ÿè¦å®šç¾©ã€‚è¨»å†Šå®Œçš„ custom resource definitionï¼Œå¯ä»¥ç›´æ¥é€é kubectl å­˜å–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;custom resource ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;custom resource ä½¿ç”¨çš„æƒ…å¢ƒèˆ‡æ¢ä»¶&lt;/li&gt;
&lt;li&gt;custom resource definition èˆ‡ Aggregated API&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Cert Manager Complete Workflow</title>
      <link>https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/</link>
      <pubDate>Sat, 12 Oct 2019 17:41:25 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;recap&#34;&gt;Recap&lt;/h1&gt;
&lt;p&gt;æ˜¨å¤©æˆ‘å€‘å¯¦éš›ä½¿ç”¨ cert-managerï¼Œç‚º nginx ingress controller ç”¢ç”Ÿ certificatesï¼Œéç¨‹ä¸­æˆ‘å€‘åšäº†å¹¾ä»¶äº‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­ç½® Let&amp;rsquo;s Encript prod site çš„ Issuer&lt;/li&gt;
&lt;li&gt;è¨­ç½® certificates.certmanager.k8s.io è³‡æºä¾†å®šç¾© certificate çš„å–å¾—æ–¹å¼&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯åœ¨ ingress ä¸­é…ç½® tlsï¼Œè®“ cert-manager è‡ªå‹•é€é ingress-shim ç”¢ç”Ÿ certifcates.cert-managerï¼Œä¸¦ä¸”ç”¢ç”Ÿ certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯ä½¿ç”¨ cert-manager ç”¢ç”Ÿ certificate çš„åŸºæœ¬æ“ä½œï¼Œå‰©ä¸‹çš„æ˜¯ç”± cert-manager å®Œæˆã€‚å¯¦éš›ä¸Š cert-manager åœ¨ç”¢ç”Ÿå‡º certificate ä¹‹å‰é‚„åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œæˆ‘å€‘ä»Šå¤©å°±è©³ç´°èµ°éå®Œæ•´æµç¨‹ï¼Œè—‰æ­¤äº†è§£ cert-manager é…åˆ issuing certificate çš„æµç¨‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è€…è¨­ç½® Issuer&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è€…è¨­å®š certificate -&amp;gt; cert-manager æ ¹æ“š certificate -&amp;gt; ç”¢ç”Ÿ certificate&lt;/p&gt;
&lt;h1 id=&#34;certificaterequests&#34;&gt;CertificateRequests&lt;/h1&gt;
&lt;p&gt;certificaterequests.certmanager æ˜¯ cert-manager ç”¢ç”Ÿ certificate éç¨‹ä¸­æœƒä½¿ç”¨çš„è³‡æºï¼Œä¸æ˜¯è¨­è¨ˆä¾†è®“äººé¡æ“ä½œçš„è³‡æºã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ cert-manager ç›£æ¸¬åˆ° certificate ç”¢ç”Ÿå¾Œï¼Œæœƒç”¢ç”Ÿ certificaterequests.certmanager.k8s.io è³‡æºï¼Œä¾†å‘ issuer request certificateï¼Œé€™å€‹éç¨‹èˆ‡ä½¿ç”¨å…¶ä»–å®¢æˆ¶ç«¯ (ex. certbot) ä¾†å‘ 3rd party CA server request certificate æ™‚çš„å…§å®¹ç›¸åŒï¼Œåªæ˜¯é€™é‚Šæˆ‘å€‘ä½¿ç”¨ kubernetes resource ä¾†å®šç¾©ã€‚&lt;/p&gt;
&lt;p&gt;åŒ…å«çš„ certificate requestï¼Œæœƒä»¥ pem encoded çš„å½¢å¼ï¼Œå†è®Šæˆ base64 encoded å­˜æ”¾åœ¨ resource ä¸­ã€‚é€™å€‹ pem key ä¹Ÿæœƒå¾åˆ°é æ–¹çš„ CA sercer (Let&amp;rsquo;s Encrypt prod) ä¾† request certificate&lt;/p&gt;
&lt;p&gt;å¦‚æœ issuance æˆåŠŸï¼Œcertificaterequest è³‡æºæ‡‰è©²æœƒè¢« cert-manager åƒæ‰ï¼Œä¸æœƒè¢«äººé¡çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å€‹ certificaterequests.certmanager å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: cert-manager.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: CertificateRequest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: my-ca-cr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  csr: LS0tLS1CRUdJTiBDRVJUSUZJQ0FUR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ..................................
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  LQo=
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  isCA: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  duraton: 90d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: ca-issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # We can reference ClusterIssuers by changing the kind here.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # The default value is Issuer (i.e. a locally namespaced Issuer)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    group: cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ certificaterequests.certmanager æœƒè®“ cert-manager å˜—è©¦å‘ Issuer (lets-encrypt-prod) request certificateã€‚&lt;/p&gt;
&lt;h1 id=&#34;order&#34;&gt;Order&lt;/h1&gt;
&lt;p&gt;orders.certmanager.k8s.io è¢« ACME çš„ Issuer ä½¿ç”¨ï¼Œç”¨ä¾†ç®¡ç† signed TLD certificate çš„ ACME orderï¼Œé€™å€‹ resource ä¹Ÿæ˜¯ cert-manager è‡ªè¡Œç”¢ç”Ÿç®¡ç†çš„ resourceï¼Œä¸éœ€è¦äººé¡ä¾†æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ä¸€å€‹ certificates.certmanager ç”¢ç”Ÿï¼Œä¸”éœ€è¦ä½¿å‹‡ ACME isser æ™‚ï¼Œcertmanager æœƒç”¢ç”Ÿ orders.certmanager ï¼Œä¾†å–å¾— certificateã€‚&lt;/p&gt;
&lt;h1 id=&#34;challenges&#34;&gt;Challenges&lt;/h1&gt;
&lt;p&gt;challenges.certmanager è³‡æºæ˜¯ ACME Issuer ç®¡ç† issuing lifecycle æ™‚ï¼Œç”¨ä¾†å®Œæˆå–®ä¸€å€‹ DNS name/identifier authorization æ™‚æ‰€ä½¿ç”¨çš„ã€‚ç”¨ä¾†ç¢ºå®š issue certiticate çš„å®¢æˆ¶ç«¯çœŸçš„æ˜¯ DNS name çš„æ“æœ‰è€…ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ cert-manager ç”¢ç”Ÿ order æ™‚ï¼Œorder controller æ¥åˆ° order ï¼Œå°±æœƒç‚ºæ¯ä¸€å€‹éœ€è¦ DNS certificate çš„ DNSname ï¼Œç”¢ç”Ÿ challenges.certmanagerã€‚&lt;/p&gt;
&lt;p&gt;é€™æ®µä¹Ÿæ˜¯ order controller è‡ªå‹•ç”¢ç”Ÿï¼Œä¸¦ä¸éœ€è¦ä½¿ç”¨è€…åƒèˆ‡ã€‚&lt;/p&gt;
&lt;h1 id=&#34;acme-certificate-issuing&#34;&gt;ACME certificate issuing&lt;/h1&gt;
&lt;p&gt;user -&amp;gt; è¨­å®šå¥½ issuers.certmanager&lt;/p&gt;
&lt;p&gt;user -&amp;gt; ç”¢ç”Ÿ certificates.certmanager -&amp;gt; é¸æ“‡ Issuer -&amp;gt;&lt;/p&gt;
&lt;p&gt;cert-manager -&amp;gt; ç”¢ç”Ÿ certificaterequest -&amp;gt;&lt;/p&gt;
&lt;p&gt;cert-manager æ ¹æ“š certiticfates.certmanager ç”¢ç”Ÿ orders.certmanager -&amp;gt;&lt;/p&gt;
&lt;p&gt;order controller æ ¹æ“š order ï¼Œä¸¦ä¸”è·Ÿæ¯ä¸€å€‹ DNS name targetï¼Œç”¢ç”Ÿä¸€å€‹ challenges.certmanager&lt;/p&gt;
&lt;p&gt;challenges.certmanager ç”¢ç”Ÿå¾Œï¼Œæœƒé–‹å•Ÿé€™å€‹ DNS name challenge çš„ lifecycle&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;challenges ç‹€æ…‹ç‚º queued for processingï¼Œåœ¨ä½‡åˆ—ä¸­ç­‰å¾…ï¼Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²’æœ‰åˆ¥çš„ chellenges åœ¨é€²è¡Œï¼Œchallenges ç‹€æ…‹è®Šæˆ scheduledï¼Œé€™æ¨£å¯ä»¥é¿å…å¤šå€‹ DNS challenge åŒæ™‚ç™¼ç”Ÿï¼Œæˆ–æ˜¯ç›¸åŒåç¨±çš„ DNS challenge é‡è¤‡&lt;/li&gt;
&lt;li&gt;challenges èˆ‡é ç«¯çš„ ACME server &amp;lsquo;synced&amp;rsquo; ç•¶å‰çš„ç‹€æ…‹ï¼Œæ˜¯å¦ valid
&lt;ul&gt;
&lt;li&gt;å¦‚æœ ACME å›æ‡‰é€™å€‹ DNS name çš„ challenge é‚„æ˜¯æœ‰æ•ˆçš„ï¼Œå‰‡ç›´æ¥æŠŠ challenges çš„ç‹€æ…‹æ”¹æˆ validï¼Œç„¶å¾Œç§»å‡ºæ’ç¨‹ä½‡åˆ—ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ challenges ç‹€æ…‹ä»ç„¶ç‚º pendingï¼Œchallenge controller æœƒä¾ç…§è¨­å®š present é€™å€‹ challengeï¼Œä½¿ç”¨ HTTP01 æˆ–æ˜¯ DNS01ï¼Œchallenges è¢«æ¨™è¨˜ç‚º presented&lt;/li&gt;
&lt;li&gt;challenges å…ˆåŸ·è¡Œ self checkï¼Œç¢ºå®š challenge ç‹€æ…‹å·²ç¶“å‚³æ’­çµ¦ dns serversï¼Œå¦‚æœ self check å¤±æ•—ï¼Œå‰‡æœƒä¾ç…§ interval retry&lt;/li&gt;
&lt;li&gt;ACME authorization é—œè¯åˆ° challenge&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;cert-manager è™•ç† &amp;lsquo;scheduled&amp;rsquo; challenges.certmanager -&amp;gt; ACME challenge&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cert Manager How It Work</title>
      <link>https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/</link>
      <pubDate>Fri, 11 Oct 2019 11:24:34 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»Šå¤©æˆ‘å€‘ä¾†å¯¦éš›ä½¿ç”¨ cert-managerï¼Œç‚º nginx ingress controller ç”¢ç”Ÿ certificates with ACME Issuer&lt;/p&gt;
&lt;h1 id=&#34;ca-terminology&#34;&gt;CA Terminology&lt;/h1&gt;
&lt;p&gt;å…ˆæŠŠå¯¦éš›åŸ·è¡Œ CA ç°½ç™¼çš„åè©å®šç¾©ä¸€ä¸‹ï¼Œä»¥å…è·Ÿ cert-manager çš„è³‡æºææ··&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Certificate: æ†‘è­‰ï¼Œx509 certificateï¼Œcert-manager è‡ªå‹•ç®¡ç†çš„ç›®æ¨™ï¼Œé€é let&amp;rsquo;s encript å–å¾—çš„ x509 certificates&lt;/li&gt;
&lt;li&gt;CA (Certificate Authority): issue signed certificate çš„æ©Ÿæ§‹&lt;/li&gt;
&lt;li&gt;issue: é ’ç™¼ï¼ŒæŒ‡ CA ç”¢ç”Ÿ certificate èˆ‡ key (ä»Šå¤©çš„ç¯„ä¾‹æ ¼å¼æ˜¯ .crt èˆ‡ .key)&lt;/li&gt;
&lt;li&gt;Sign vs self-signed: ç°½æ ¸ï¼Œè‡ªå·±ç°½æ ¸ï¼Œä½¿ç”¨ä¿¡ä»»çš„ CA issue certificateï¼Œæˆ–æ˜¯ä½¿ç”¨è‡ªå·±ç”¢ç”Ÿçš„ CA self-signï¼Œç„¶å¾ŒæŠŠ CA åŠ åˆ°å¯ä»¥è¢«ä¿¡ä»»çš„ CA æ¸…å–®ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let&amp;rsquo;s Encript CA issues signed certificates&lt;/p&gt;
&lt;p&gt;Kubernetes in-cluster CA issues self-signed certificates&lt;/p&gt;
&lt;p&gt;cert-manager çš„ CRD è³‡æºï¼Œä½¿ç”¨ä¾†æè¿° cert-manager å¦‚ä½•åŸ·è¡Œä¸Šè¿°æ“ä½œï¼ŒCRD åº•ä¸‹éƒ½æœƒåŠ ä¸Š ``*.certmanager.k8s.io` æ–¹ä¾¿è¾¨è­˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;è¨­å®š-issuer&#34;&gt;è¨­å®š Issuer&lt;/h1&gt;
&lt;p&gt;Issuer è¦æ€éº¼ç¿»æˆä¸­æ–‡XDï¼Œæ†‘è­‰é ’ç™¼æ©Ÿæ§‹ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹åœ¨é–‹å§‹ç°½ç™¼ certificates å‰ï¼Œè¦å…ˆå®šç¾© issuers.certmanager.k8s.io ï¼Œä»£è¡¨ä¸€å€‹èƒ½ç°½ç™¼ certificate CAï¼Œä¾‹å¦‚ Let&amp;rsquo;s Encriptï¼Œæˆ–æ˜¯ kubernetes å…§éƒ¨ä¹Ÿæœ‰å…§éƒ¨ä½¿ç”¨çš„æ†‘è­‰ç°½ç™¼ï¼Œæ”¾åœ¨ secrets ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é€™äº› Issuer æœƒè®“ certificates.certmanager.k8s.i8o ä½¿ç”¨ï¼Œå®šç¾©å¦‚ä½•å–å¾— certificate æ™‚ï¼Œé¸æ“‡ Issuerã€‚&lt;/p&gt;
&lt;p&gt;cert-manager ä¸Šå¯ä»¥å®šç¾©å–®ä¸€ namespace çš„ issuers.certmanager èˆ‡é›†ç¾¤éƒ½å¯ä½¿ç”¨çš„ clusterissuers.certmanager&lt;/p&gt;
&lt;p&gt;cert-manager æœ‰æ”¯æ´å¹¾ç¨®çš„ issuer type&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CA: ä½¿ç”¨ x509 keypair ç”¢ç”Ÿcertificateï¼Œå­˜åœ¨ kubernetes secret&lt;/li&gt;
&lt;li&gt;Self signed: è‡ªç°½ certificate&lt;/li&gt;
&lt;li&gt;ACME: å¾ ACME (ex. Let&amp;rsquo;s Encrypt) server å–å¾— ceritificate&lt;/li&gt;
&lt;li&gt;Vault: å¾ Vault PKI backend é ’ç™¼ certificate&lt;/li&gt;
&lt;li&gt;Venafi: Venafi Cloud&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;certificate&#34;&gt;Certificate&lt;/h1&gt;
&lt;p&gt;æœ‰äº†ç°½ç™¼æ†‘è­‰çš„å–®ä½ï¼Œæ¥ä¸‹ä¾†è¦å®šç¾©å¦‚ä½•å–å¾— certificateã€‚certificates.certmanager.k8s.io æ˜¯ CRDï¼Œç”¨ä¾†å‘Šè¨´ cert-manager è¦å¦‚ä½•å–å¾— certificate&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.cert-manager.io/en/latest/reference/certificates.html#certificates&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;certifcates.certmanager.k8s.io&lt;/a&gt; æä¾›äº†ç°¡å–®ç¯„ä¾‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: cert-manager.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: acme-crt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  secretName: acme-crt-secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  duration: 90d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  renewBefore: 30d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  dnsNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - bar.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  acme:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    config:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - http01:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ingressClass: nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      domains:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - bar.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # We can reference ClusterIssuers by changing the kind here.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # The default value is Issuer (i.e. a locally namespaced Issuer)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢é€™å€‹ certificate.certmanger å‘Šè¨´ cert-manager&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å° foo.example.com èˆ‡ bar.example.com å…©å€‹ domainsc&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ letsencript-prd Issuer å»å–å¾— certificate key pair&lt;/li&gt;
&lt;li&gt;æˆåŠŸå¾ŒæŠŠ ceritifcate èˆ‡ key å­˜åœ¨ secret/acme-crt-secret ä¸­(ä»¥ tls.key, tls.crt çš„å½¢å¼)&lt;/li&gt;
&lt;li&gt;èˆ‡ certificate.certmanager éƒ½æ”¾åœ¨ç›¸åŒ namespace ä¸­ï¼Œç”¢ç”Ÿ certificate.certmanager çš„æ™‚å€™è¦æ³¨æ„æ‰ä¸æœƒæ‰¾ä¸åˆ° secret&lt;/li&gt;
&lt;li&gt;é€™é‚ŠæŒ‡å®šäº† certificate çš„æœ‰æ•ˆæœŸé–“èˆ‡ renew æ™‚é–“ (é è¨­å€¼)ï¼Œæœ‰éœ€è¦å¯ä»¥æ›´æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é…åˆ-ingress-è¨­ç½®-tls&#34;&gt;é…åˆ Ingress è¨­ç½® tls&lt;/h1&gt;
&lt;p&gt;æœ‰ä¸Šè¿°çš„è¨­å®šï¼Œæ¥ä¸‹ä¾†å¯ä»¥è«‹æ±‚ tls certificate&lt;/p&gt;
&lt;p&gt;è¨˜å¾—æˆ‘å€‘ä¸Šç¯‡ Nginx Ingress Controller æåˆ°çš„ ingreess è¨­å®šå—ï¼Ÿé€™é‚Šæº–å‚™äº†ä¸€å€‹é©åˆé…åˆ nginx ingress ä½¿ç”¨çš„ tls è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/ingress.class: &amp;#34;nginx&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    cert-manager.io/issuer: &amp;#34;letsencrypt-prod&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tls:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - hosts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    secretName: my-nginx-ingrss-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  rules:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - host: foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    http:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      paths:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - path: /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        backend:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          serviceName: chechiachang-backend
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          servicePort: 80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ ingress apply å¾Œï¼Œå°±æœƒæ ¹æ“š spec.tls çš„ hosts è¨­å®šï¼Œè‡ªå‹•ç”¢ç”Ÿä¸€å€‹ certificate.certmanager è³‡æºï¼Œä¸¦åœ¨é€™å€‹è³‡æºä½¿ç”¨ letsencryp-prodã€‚&lt;/p&gt;
&lt;p&gt;ä¸ç”¨æˆ‘å€‘æ‰‹å‹• apply æ–°çš„ ceritificateï¼Œé€™é‚Šæ˜¯ cert-manager ä½¿ç”¨äº† annotation ä¾†è§¸ç™¼ &lt;a href=&#34;https://docs.cert-manager.io/en/latest/tasks/issuing-certificates/ingress-shim.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress-shim&lt;/a&gt;ï¼Œç°¡å–®ä¾†èªªï¼Œç•¶ ingress ä¸Šæœ‰ä½¿ç”¨ cert-manager.io çš„ annotation æ™‚ï¼Œcert-manager å°±æœƒæ ¹æ“š ingress è¨­å®šå…§å®¹ï¼ŒæŠ½å‡º spec.tls èˆ‡ isuer annotationï¼Œä¾†ç”¢ç”ŸåŒåçš„ certificates.certmanagerï¼Œé€™å€‹ certificateas.certmanager æœƒè§¸ç™¼æ¥ä¸‹çš„ certificate é ’ç™¼éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åªè¦éƒ¨ç½² Issuer èˆ‡ Ingress å°±å¯ä»¥è‡ªå‹•ç”¢ç”Ÿ certificateã€‚ç•¶ç„¶ï¼Œå¸Œæœ›æ‰‹å‹• apply certificates.certmanager ä¹Ÿæ˜¯è¡Œå¾—é€šã€‚&lt;/p&gt;
&lt;p&gt;æŠŠç”¢ç”Ÿäº† certificate.certmanager æ‹‰å‡ºä¾†çœ‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe certificate my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name:         my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Namespace:    default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; API Version:  cert-manager.io/v1alpha2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Kind:         Certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Cluster Name:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Creation Timestamp:  2019-10-10T17:58:37Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Generation:          0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Owner References:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     API Version:           extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Block Owner Deletion:  true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Controller:            true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Kind:                  Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Name:                  my-nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Resource Version:        9295
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Dns Names:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     example.your-domain.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Issuer Ref:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Kind:       Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Name:       letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Secret Name:  my-nginx-ingress-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Status:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Acme:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Order:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       URL:  https://acme-prod-v02.api.letsencrypt.org/acme/order/7374163/13665676
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Conditions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Last Transition Time:  2019-10-10T18:05:57Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Message:               Certificate issued successfully
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Reason:                CertIssued
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Status:                True
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Type:                  Ready
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Events:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Type     Reason          Age                From          Message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----     ------          ----               ----          -------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   CreateOrder     1d                 cert-manager  Created new ACME order, attempting validation...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   DomainVerified  1d                 cert-manager  Domain &amp;#34;foo.example.com&amp;#34; verified with &amp;#34;http-01&amp;#34; validation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   IssueCert       1d                 cert-manager  Issuing certificate...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   CertObtained    1d                 cert-manager  Obtained certificate from ACME server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Normal   CertIssued      1d                 cert-manager  Certificate issued Successfully
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŠŠ certificate å¾ secret æ’ˆå‡ºä¾†çœ‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl describe secret my-nginx-ingress-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name:         my-nginx-ingress-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Namespace:    default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Labels:       cert-manager.io/certificate-name=my-nginx-ingrsss-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Annotations:  cert-manager.io/alt-names=foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              cert-manager.io/common-name=foo.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              cert-manager.io/issuer-kind=Issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              cert-manager.io/issuer-name=letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Type:  kubernetes.io/tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;====
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tls.crt:  3566 bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tls.key:  1675 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æ­¤ä¾¿å¯ä»¥é€é ingress è¨­å®š nginx ä½¿ç”¨ https&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£ *.certmanager.k8s.io CRD å®šç¾©èˆ‡æ„ç¾©&lt;/li&gt;
&lt;li&gt;è¨­å®š Issuer èˆ‡ certificate&lt;/li&gt;
&lt;li&gt;é€é ingress-shim ç›´æ¥éƒ¨ç½² ingress ä¾†ç”¢ç”Ÿ certificate&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Cert Manager Deployment on Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/</link>
      <pubDate>Thu, 10 Oct 2019 16:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Cert-manager Introduction&lt;/li&gt;
&lt;li&gt;Deploy cert-manager&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç°¡ä»‹-cert-manager&#34;&gt;ç°¡ä»‹ cert-manager&lt;/h1&gt;
&lt;p&gt;TLS certificate ç®¡ç†å¾ˆé‡è¦ï¼Œä½†åœ¨ kubernetes ä¸Šç®¡ç† TLS certificates å¾ˆéº»ç…©ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å¾€æˆ‘å€‘ä½¿ç”¨ &lt;a href=&#34;https://letsencrypt.org/zh-tw/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; æä¾›çš„å…è²»è‡ªå‹•åŒ–æ†‘è­‰é ’ç™¼ï¼Œæ­é… &lt;a href=&#34;https://github.com/jetstack/kube-lego&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-lego&lt;/a&gt; ä¾†è‡ªå‹•è™•ç† certificate issuingï¼Œç„¶è€Œéš¨è‘— kube-lego å·²ä¸å†æ›´æ–°å¾Œï¼Œå®˜æ–¹å»ºè­°æ”¹ä½¿ç”¨ &lt;a href=&#34;https://github.com/jetstack/cert-manager/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cert-manager&lt;/a&gt; ä¾†é€²è¡Œ kubernetes ä¸Šçš„æ†‘è­‰è‡ªå‹•åŒ–ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;cert-manager æ˜¯ kubernetes åŸç”Ÿçš„æ†‘è­‰ç®¡ç† controllerã€‚æ˜¯çš„ä»–çš„æ ¸å¿ƒä¹Ÿæ˜¯ä¸€å€‹ controllerï¼Œé€é kubernetes object å®šç¾© desired stateï¼Œç›£æ§é›†ç¾¤ä¸Šçš„å¯¦éš›ç‹€æ…‹ï¼Œç„¶å¾Œæ ¹æ“š resource object ç”¢ç”Ÿæ†‘è­‰ã€‚cert-manager åšå¹¾ä»¶äº‹æƒ…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ kubernetes ä¸Š ä½¿ç”¨ CRD (Customized Resource Definition) ä¾†å®šç¾© certificate issuing çš„ desired state&lt;/li&gt;
&lt;li&gt;å‘ let&amp;rsquo;s encrypt å–å¾—å…¬é–‹çš„æ†‘è­‰&lt;/li&gt;
&lt;li&gt;åœ¨ kubernetes ä¸Šè‡ªå‹•æª¢æŸ¥æ†‘è­‰çš„æœ‰æ•ˆæœŸé™ï¼Œä¸¦è‡ªå‹•åœ¨æœ‰æ•ˆæ™‚é™å…§ renew certificateã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å®‰è£&#34;&gt;å®‰è£&lt;/h1&gt;
&lt;p&gt;å®˜æ–¹æ–‡ä»¶æœ‰æä¾› &lt;a href=&#34;https://docs.cert-manager.io/en/latest/getting-started/install/kubernetes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è©³ç´°æ­¥é©Ÿ&lt;/a&gt; å¯ä»¥ç›´æ¥ä½¿ç”¨ release çš„ yaml éƒ¨å±¬ï¼Œä¹Ÿå¯ä»¥é€é helmã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-yaml-éƒ¨å±¬&#34;&gt;ä½¿ç”¨ yaml éƒ¨å±¬&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Create a namespace to run cert-manager in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Disable resource validation on the cert-manager namespace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace cert-manager certmanager.k8s.io/disable-validation=true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é–‹ä¸€å€‹ç¨ç«‹çš„ namespace ä¾†ç®¡ç† cert-manager resources&lt;/p&gt;
&lt;p&gt;å–æ¶ˆ namespcae ä¸­çš„ kubernetes validating webhookã€‚ç”±æ–¼ cert-manager æœ¬èº«å°±æœƒä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ValidatingWebhookConfiguration&lt;/a&gt; ä¾†ç‚º cert-manager å®šç¾©çš„ Issuer, Certificate resource åš validatingã€‚ç„¶è€Œé€™æœƒé€ æˆ cert-manager èˆ‡ webhook çš„å¾ªç’°ä¾è³´ (circling dependency)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Install the CustomResourceDefinitions and cert-manager itself
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.10.1/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Install the CustomResourceDefinitions and cert-manager itself
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.10.1/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹ yaml è£¡é¢é‚„æœ‰å¹¾å€‹å…ƒä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cluster Role-bindings&lt;/li&gt;
&lt;li&gt;CustomResourceDefinition
&lt;ul&gt;
&lt;li&gt;certificaterequests.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;certificates.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;challenges.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;clusterissuers.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;issuers.certmanager.k8s.io&lt;/li&gt;
&lt;li&gt;orders.certmanager.k8s.io&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›å…ƒä»¶çš„ç´°ç¯€ï¼Œç•™å¾…é‹ä½œåŸç†åˆ†ææ™‚å†è©³è§£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;helm-deployment&#34;&gt;helm deployment&lt;/h3&gt;
&lt;p&gt;é€™é‚Šä¹Ÿé™„ä¸Šä½¿ç”¨ helm å®‰è£çš„æ­¥é©Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install the CustomResourceDefinition resources separately&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/jetstack/cert-manager/release-0.10/deploy/manifests/00-crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Create the namespace for cert-manager&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Label the cert-manager namespace to disable resource validation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace cert-manager certmanager.k8s.io/disable-validation&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Add the Jetstack Helm repository&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add jetstack https://charts.jetstack.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Update your local Helm chart repository cache&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Install the cert-manager Helm chart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --name cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --version v0.10.1 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  jetstack/cert-managerNAMESPACE&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨å±¬å®Œæª¢æŸ¥ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --namespace cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager-5c6866597-zw7kh               1/1     Running   0          2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager-cainjector-577f6d9fd7-tr77l   1/1     Running   0          2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cert-manager-webhook-787858fcdb-nlzsq      1/1     Running   0          2m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šéƒ¨å±¬å®Œï¼Œæœƒç²å¾—å®Œæ•´çš„ cert-manager èˆ‡ cert-manager CRDï¼Œä½† certificate çš„ desired state object é‚„æ²’éƒ¨å±¬ã€‚ä¹Ÿå°±æ˜¯é—œæ–¼æˆ‘å€‘è¦å¦‚ä½• issue certificate çš„ç›¸é—œæè¿°ï¼Œéƒ½é‚„æ²’æœ‰ deployï¼Œ cert-manager è‡ªç„¶ä¸æœƒå·¥ä½œã€‚é—œæ–¼ issuing resources configurationï¼Œæˆ‘å€‘ä¸‹æ¬¡å†èŠã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Nginx Ingress Controller</title>
      <link>https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/</link>
      <pubDate>Tue, 08 Oct 2019 08:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šè©²äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nginx-ingress-controller&#34;&gt;Nginx Ingress Controller&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ nginx &amp;amp; Ingress Controller&lt;/li&gt;
&lt;li&gt;éƒ¨å±¬ä¸¦è¨­å®š nginx ingress controller&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;nginx-introduction&#34;&gt;Nginx Introduction&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://nginx.org/en/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nginx&lt;/a&gt; æ˜¯ä¸€æ¬¾é«˜æ•ˆèƒ½ã€è€ç”¨ã€ä¸”åŠŸèƒ½å¼·å¤§çš„ load balancer ä»¥åŠ web serverï¼Œä¹Ÿæ˜¯å¸‚å ç‡æœ€é«˜çš„ web server ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ•ˆèƒ½çš„ web serverï¼Œé å‹å‚³çµ± apache server çš„è³‡æºèˆ‡æ•ˆèƒ½&lt;/li&gt;
&lt;li&gt;å¤§é‡çš„æ¨¡çµ„èˆ‡æ“´å……åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;æœ‰å……è¶³çš„å®‰å…¨æ€§åŠŸèƒ½èˆ‡è¨­å®š&lt;/li&gt;
&lt;li&gt;è¼•é‡&lt;/li&gt;
&lt;li&gt;å®¹æ˜“æ°´å¹³æ“´å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ingress--ingress-controller&#34;&gt;Ingress &amp;amp; Ingress Controller&lt;/h1&gt;
&lt;p&gt;é€™é‚Šç°¡å–®è¬›ä¸€ä¸‹ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes ingress&lt;/a&gt;ã€‚ç•¶æˆ‘å€‘åœ¨ä½¿ç”¨ kubernetes æ™‚éœ€è¦å°‡å¤–éƒ¨æµé‡ route åˆ°é›†ç¾¤å…§éƒ¨ï¼Œé€™é‚Šä½¿ç”¨ Ingress é€™å€‹ api resourceï¼Œä¾†å®šç¾©å¤–éƒ¨åˆ°å…§éƒ¨çš„è¨­å®šï¼Œä¾‹å¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;service é€£æ¥&lt;/li&gt;
&lt;li&gt;load balance è¨­å®š&lt;/li&gt;
&lt;li&gt;SSL/TLS çµ‚ç«¯&lt;/li&gt;
&lt;li&gt;è™›æ“¬ä¸»æ©Ÿè¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€å€‹ç°¡å–®çš„ ingress å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: test-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/rewrite-target: /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  rules:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - http:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      paths:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - path: /testpath
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        backend:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          serviceName: test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          servicePort: 80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™¤äº†ä¸€èˆ¬çš„ k8s è³‡æºï¼Œnginx ä¸»è¦çš„è¨­å®šæœƒè½åœ¨ specï¼Œä»¥åŠä¾è³´åº•ä¸‹å¯¦ä½œä¸åŒï¼Œé¡å¤–è¨­å®šçš„ annotationã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šå¯ä»¥çœ‹åˆ° spec.rule å®šç¾©äº†å¤–éƒ¨ http æµé‡ï¼Œå¼•å°åˆ° backend service çš„è·¯å¾‘ã€‚&lt;/p&gt;
&lt;p&gt;annotations ä¸‹å·²ç¶“æ¨™è¨»çš„ nginx.ingress çš„ annotationï¼Œä¾†å¿«é€Ÿå¢åŠ é¡å¤–çš„è¨­å®šã€‚&lt;/p&gt;
&lt;h1 id=&#34;ingress--ingress-controller-1&#34;&gt;Ingress &amp;amp; Ingress Controller&lt;/h1&gt;
&lt;p&gt;é›–ç„¶å·²ç¶“æŒ‡å®š nginx çš„ annotationï¼Œä½†é€™é‚Šè¦æ³¨æ„ï¼Œingress resource æœ¬èº«æ˜¯ä¸æŒ‡å®šåº•å±¤çš„å¯¦ç¾ (ingress controller)ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œåº•ä¸‹æ˜¯ nginx ä¹Ÿå¥½ï¼Œtraefik ä¹Ÿè¡Œï¼Œåªè¦èƒ½å¤ å¯¦ç¾ ingress è£é ­è¨­å®šçš„ routing rules å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;åªè¨­å®šå¥½ ingressï¼Œé›†ç¾¤ä¸Šæ˜¯ä¸æœƒæœ‰ä»»ä½•ä½œç”¨çš„ï¼Œé‚„éœ€è¦åœ¨é›†ç¾¤ä¸Šå®‰è£ ingress controller çš„å¯¦ä½œï¼Œå¯¦ä½œå®‰è£å®Œäº†ä»¥å¾Œï¼Œæœƒä¾æ“š ingress çš„è¨­å®šï¼Œåœ¨ controller è£é ­å¯¦ç¾ï¼Œä¸ç®¡æ˜¯ routingã€ssl/tls terminationã€load balancing ç­‰ç­‰åŠŸèƒ½ã€‚å¦‚åŒè¨±å¤š Kubernetes resource çš„è¨­è¨ˆç†å¿µä¸€æ¨£ï¼Œé€™é‚Šä¹Ÿå¾ˆå„ªé›…çš„ç”¨ ingress èˆ‡ ingress controllerï¼Œæ‹†åˆ†çš„éœ€æ±‚è¨­å®šèˆ‡å¯¦ä½œå¯¦ç¾å…©é‚Šçš„è·è²¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä»¥ nginx ingress controllerï¼Œå®‰è£å®Œå¾Œæœƒä¾æ“š ingress çš„è¨­å®šï¼Œåœ¨ nginx pod è£¡è¨­å®šå°æ‡‰çš„ routing rulesï¼Œå¦‚æœæœ‰ ssl/tls è¨­å®šï¼Œä¹Ÿä¸€ä½µè¼‰å…¥ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes å®˜æ–¹æ–‡ä»¶æä¾›äº†&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/#additional-controllers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¨±å¤šä¸åŒçš„ controller&lt;/a&gt; å¯ä»¥ä¾ç…§éœ€æ±‚é¸æ“‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å¦‚æœä¸çŸ¥é“å¦‚ä½•é¸æ“‡ï¼Œå€‹äººæœƒæ¨è–¦ä½¿ç”¨ nginx ingress controllerï¼Œç©©å®šã€åŠŸèƒ½å¼·å¤§ã€è¨­å®šåˆä¸è‡³æ–¼å¤ªéè¤‡é›œï¼ŒåŸºæœ¬çš„è¨­å®šå°±èƒ½å¾ˆå¥½çš„æ”¯æ’æœå‹™ï¼Œä¸ç†Ÿæ‚‰çš„å¤§å¾·å€‘æ¯”è¼ƒä¸å®¹æ˜“è¢«é›·åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;åº•ä¸‹æˆ‘å€‘å°±è¦ä¾†é–‹å§‹ä½¿ç”¨ nginx ingress controllerã€‚&lt;/p&gt;
&lt;h1 id=&#34;deployment&#34;&gt;Deployment&lt;/h1&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šä½¿ç”¨çš„ &lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress-nginx&lt;/a&gt; æ˜¯ kubernetes org å…§ç¶­è­·çš„å°ˆæ¡ˆï¼Œå°ˆæ¡ˆå…§å®¹ä¸»è¦æ˜¯å† k8s ä¸ŠåŸ·è¡Œ nginxï¼ŒæŠ½è±¡èˆ‡å¯¦ä½œçš„æ•´åˆï¼Œä¸¦é€é configmap ä¾†è¨­å®š nginxã€‚é‡å° nginx ingress kubernetes å®˜æ–¹æœ‰æä¾›&lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éå¸¸è©³ç´°çš„èªªæ˜æ–‡ä»¶&lt;/a&gt; ï¼Œå‰›æ¥è§¸ nginx çš„å¤§å¾·å¯ä»¥é€éé€™ä»½æ–‡ä»¶ï¼Œå¿«é€Ÿçš„æ“ä½œ nginx çš„è¨­å®šï¼Œè€Œä¸ç”¨ç›´æ¥å¯« nginx.conf çš„è¨­å®šæª”æ¡ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;repo ç‰ˆæœ¬æ˜¯ nginx-0.26.1&lt;/li&gt;
&lt;li&gt;Image ç‰ˆæœ¬æ˜¯ quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;helm&#34;&gt;Helm&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç”¨ helm éƒ¨å±¬ï¼Œ&lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/nginx-ingress&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nginx Ingress Controller Stable Chart&lt;/a&gt;ï¼Œè®“å„ä½å¤§å¾·ç”¨æœ€ç°¡å–®çš„æ­¥é©Ÿï¼Œç²å¾—ä¸€å€‹åŠŸèƒ½å®Œæ•´çš„ nginx ingress controllerã€‚&lt;/p&gt;
&lt;p&gt;èˆ‡å‰é¢å¹¾å€‹ helm chart ä¸€æ¨£ï¼Œæˆ‘å€‘å¯ä»¥å…ˆå–å¾— default values.yaml è¨­å®šæª”ï¼Œå†é€²è¡Œæ›´æ”¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ wget https://raw.githubusercontent.com/helm/charts/master/stable/nginx-ingress/values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ vim values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£æ™‚ä¹Ÿå¯ä»¥ä½¿ç”¨ &amp;ndash;set ä¾†è®Šæ›´&lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/nginx-ingress#configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£ chart æ™‚çš„ parameters&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ helm install stable/nginx-ingress \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	--set controller.metrics.enabled=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	-f values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£å®Œå¾Œï¼Œresource å¾ˆå¿«å°±èµ·ä¾†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get all --selector app=nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                                 READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pod/nginx-ingress-controller-7bbcbdcf7f-tx69n        1/1     Running   0          216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pod/nginx-ingress-default-backend-544cfb69fc-rnn6h   1/1     Running   0          216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    TYPE           CLUSTER-IP     EXTERNAL-IP    PORT(S)                      AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/nginx-ingress-controller        LoadBalancer   10.15.246.22   34.35.36.37    80:30782/TCP,443:31933/TCP   216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/nginx-ingress-default-backend   ClusterIP      10.15.243.19   &amp;lt;none&amp;gt;         80/TCP                       216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                            READY   UP-TO-DATE   AVAILABLE   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/nginx-ingress-controller        1/1     1            1           216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/nginx-ingress-default-backend   1/1     1            1           216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                                       DESIRED   CURRENT   READY   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replicaset.apps/nginx-ingress-controller-7bbcbdcf7f        1         1         1       216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replicaset.apps/nginx-ingress-default-backend-544cfb69fc   1         1         1       216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get configmap -l app=nginx-ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       DATA   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx-ingress-controller   2      216d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME            HOSTS                  ADDRESS       PORTS     AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ingress-nginx   api.chechiachang.com   34.35.36.37   80, 443   216d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…©å€‹ Pods&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx ingress controller æ˜¯ä¸»è¦çš„ nginx podï¼Œè£¡é¢è·‘çš„æ˜¯ nginx&lt;/li&gt;
&lt;li&gt;Nginx default backend è·‘çš„æ˜¯ default backendï¼Œnginx çœ‹ä¸æ‡‚äº† route request éƒ½å¾€é€™é‚Šé€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nginx-ingress-contrller æ˜¯æˆ‘å€‘åœ¨ GCP ä¸Šï¼Œåœ¨é›†ç¾¤å¤–éƒ¨çš„ GCP ä¸Šçš„å°å¤–æ¥å£ã€‚å¦‚æœåœ¨ä¸åŒå¹³å°ä¸Šï¼Œä¾æ“šé è¨­ service load balancer æœ‰ä¸åŒå¯¦ä½œã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ gcp ä¸Šï¼Œæœƒéœ€è¦æ™‚é–“ä¾†å•Ÿå‹• load balancerï¼Œç­‰ load balancer å•Ÿå‹•å®Œæˆï¼Œservice é€™é‚Šå°±å¯ä»¥å–å¾—å¤–éƒ¨çš„ ipï¼Œæ¥å— load balancer ä¾†çš„æµé‡&lt;/li&gt;
&lt;li&gt;å¦å¤–ä¸€å€‹ service å°±æ˜¯ default backend çš„ service&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è¸©é›·&#34;&gt;è¸©é›·&lt;/h1&gt;
&lt;p&gt;ç¬¬ä¸€å€‹é›·é»æ˜¯ helm chart install å¸¶å…¥çš„ &lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/nginx-ingress#configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;parameters&lt;/a&gt;ï¼Œæœ‰äº› parameter æ˜¯ç›´æ¥å½±éŸ¿ deployment çš„è¨­å®šï¼Œå¦‚æœæ²’æ³¨æ„åˆ°ï¼Œå®‰è£å®Œå¾Œæ²’è¾¦æ³•é€é hot reload ä¾†è™•ç†ï¼Œåªèƒ½å¹¹æ‰é‡ä¾†ã€‚å»ºè­°æŠŠé€™ä»½è¡¨æ ¼éƒ½çœ‹éä¸€æ¬¡ï¼Œå†ä¾ç…§ç’°å¢ƒèˆ‡éœ€æ±‚è£œä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ helm install stable/nginx-ingress \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	--set controller.metrics.enabled=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	--set controller.service.externalTrafficPolicy=Local \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	-f values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šé–‹äº† prometheus metrics exporterï¼Œä»¥åŠ source IP preservationã€‚&lt;/p&gt;
&lt;h1 id=&#34;nginx-config&#34;&gt;Nginx Config&lt;/h1&gt;
&lt;p&gt;å†å®‰è£å®Œå¾Œï¼Œå¤–éƒ¨çš„ load balancer å•Ÿç”¨å¾Œï¼Œå°±å¯ä»¥é€é GCP çš„ external ip é€£å…¥ nginxï¼Œnginx ä¾ç…§è¨­å®šçš„ rule å‘å¾Œç«¯æœå‹™åšé›†ç¾¤å…§çš„ load balancing èˆ‡ routingã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ¨ä½¿ç”¨éç¨‹ä¸­ï¼Œæœ‰éœ€è¦åŸ·è¡Œæ›´æ”¹è¨­å®šï¼Œæˆ–æ˜¯ hot reload configï¼Œåœ¨ kubernetes ä¸Šè¦å¦‚ä½•åšå‘¢? æˆ‘å€‘ä¸‹å›åˆ†è§£ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Nginx Ingress Controller Config</title>
      <link>https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/</link>
      <pubDate>Tue, 08 Oct 2019 08:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;p&gt;é€™é‚Šæ”¹äº†ä¸€äº›å¤§ç¶±ï¼ŒåŸæœ¬çš„å…§å®¹é‚„æœ‰ä¸€äº› kubernetes çš„è¨­å®šï¼Œä»¥åŠ GCP ç›¸é—œæœå‹™çš„ä»‹ç´¹ã€‚ä½†æ—¢ç„¶æˆ‘å€‘çš„ä¸»é¡Œæ˜¯æŠŠæ±è¥¿æ¬ä¸Š k8s çš„è¸©é›·æ—…ç¨‹ï¼Œé‚£æˆ‘å€‘å°±ç¹¼çºŒæ¬ï¼Œç¹¼çºŒè¸©ã€‚å‰©ä¸‹çš„æ™‚é–“å¤§æ¦‚æœƒæœ‰å››å€‹é¡Œç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress Controller é‹ä½œåŸç†&lt;/li&gt;
&lt;li&gt;è¨­å®š Nginx Ingress Controller&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é‹ä½œåŸç†&#34;&gt;é‹ä½œåŸç†&lt;/h1&gt;
&lt;p&gt;æ˜¨å¤©è¬›å®Œ nginx ingress controller éƒ¨å±¬ï¼Œä»Šå¤©ä¾†è«‡è«‡ controller æ˜¯å¦‚ä½•é‹ä½œçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx ä½¿ç”¨ config file (nginx.conf) åšå…¨åŸŸè¨­å®šï¼Œç‚ºäº†è®“ nginx èƒ½éš¨ config file æ›´æ–°ï¼Œcontroller è¦åµæ¸¬ config file è®Šæ›´ï¼Œä¸¦ä¸” reload nginx&lt;/li&gt;
&lt;li&gt;é‡å° upstream (å¾Œç«¯ app çš„ endpoint) è®Šæ›´ï¼Œä½¿ç”¨ lua-nginx-module ä¾†æ›´æ–°ã€‚å› ç‚º kubernetes ä¸Šï¼Œservice å¾Œçš„æœå‹™å¸¸å¸¸æœƒå‹•æ…‹çš„è®Šæ›´ï¼Œscalingï¼Œä½† endpint ip list åˆéœ€è¦æ›´æ–°åˆ° nginxï¼Œæ‰€ä»¥ä½¿ç”¨ lua é¡å¤–è™•ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ kubernetes ä¸Šè¦å¦‚ä½•åšåˆ°ä¸Šè¿°å…©ä»¶äº‹å‘¢?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬ controller éƒ½ä½¿ç”¨åŒæ­¥ loop ä¾†æª¢æŸ¥ current state æ˜¯å¦èˆ‡ desired state&lt;/li&gt;
&lt;li&gt;desired state ä½¿ç”¨ k8s object æè¿°ï¼Œä¾‹å¦‚ ingress, services, configmap ç­‰ç­‰ object&lt;/li&gt;
&lt;li&gt;Nginx ingress controller é€™é‚Šä½¿ç”¨çš„æ˜¯ client-go ä¸­çš„ Kubernetes Informer çš„ &lt;a href=&#34;https://godoc.org/k8s.io/client-go/informers#SharedInformerFactory&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SharedInformer&lt;/a&gt;ï¼Œå¯ä»¥æ ¹æ“š object çš„æ›´æ–°åŸ·è¡Œ callback&lt;/li&gt;
&lt;li&gt;ç”±æ–¼ç„¡æ³•æª¢æŸ¥æ¯ä¸€æ¬¡çš„ object æ›´å‹•ï¼Œæ˜¯å¦å° config ç”¢ç”Ÿå½±éŸ¿ï¼Œé€™é‚Šç›´æ¥æ¯æ¬¡æ›´å‹•éƒ½ç”¢ç”Ÿå…¨æ–°çš„ model&lt;/li&gt;
&lt;li&gt;å¦‚æœæ–°ç”¢ç”Ÿçš„ model èˆ‡ç¾æœ‰ç›¸åŒï¼Œå°±è·³é reload&lt;/li&gt;
&lt;li&gt;å¦‚æœ model åªå½±éŸ¿ endpointï¼Œä½¿ç”¨ nginx å…§éƒ¨çš„ lua handler ç”¢ç”Ÿæ–°çš„ endpoint listï¼Œä¾†é¿å…å› ç‚º upstream æœå‹™è®Šæ›´é€ æˆçš„é »ç¹ reload&lt;/li&gt;
&lt;li&gt;å¦‚æœæ–° Model å½±éŸ¿ä¸åª endpointï¼Œå‰‡å–ä»£ç¾æœ‰ modelï¼Œç„¶å¾Œè§¸ç™¼ reload&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…·é«”æœƒè§¸ç™¼ reload çš„äº‹ä»¶ï¼Œ&lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/how-it-works/#when-a-reload-is-required&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è«‹è¦‹å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é™¤äº†ç›£æ¸¬ objectsï¼Œbuild modelï¼Œè§¸ç™¼ reloadï¼Œä¹‹å‰ controller é‚„æœƒå°‡ ingress é€åˆ° &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes validating admission webhook server&lt;/a&gt; åšé©—è­‰ï¼Œé¿å…æè¿° desired state çš„ ingress æœ‰ syntax errorï¼Œå°è‡´æ•´å€‹ controller çˆ†ç‚¸ã€‚&lt;/p&gt;
&lt;h1 id=&#34;configuration&#34;&gt;Configuration&lt;/h1&gt;
&lt;p&gt;è¦é€é controller æ›´æ”¹ nginx è¨­å®šï¼Œæœ‰ä»¥ä¸‹ä¸‰ç¨®æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ”¹ configmapï¼Œå°å…¨åŸŸçš„ controller è¨­å®š&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ ingress ä¸Šçš„ annotationï¼Œé€™äº› annotation é‡å°ç¨ç«‹ ingress ç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;æœ‰æ›´æ·±å…¥çš„å®¢è£½åŒ–ï¼Œæ˜¯ä¸Šè¿°å…©è€…é”ä¸åˆ°æˆ–å°šæœªå¯¦ä½œï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/custom-template/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Custom Template&lt;/a&gt; ä¾†åšåˆ°ï¼ŒæŠŠ nginx.tmpl mount é€² controller&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;configmap&#34;&gt;Configmap&lt;/h1&gt;
&lt;p&gt;ç”±æ–¼æŠŠå…¨åŸŸè¨­å®šæ”¾åˆ° configmap ä¸Šï¼Œnginx ingress controller éå¸¸å¥½èª¿åº¦èˆ‡æ“´å±•ï¼Œ&lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;controller å®˜æ–¹èªªæ˜æ–‡ä»¶&lt;/a&gt; é™¤äº†åˆ—å‡ºç›®å‰å·²ç¶“æ”¯æ´çš„è¨­å®šå¤–ï¼Œä¹Ÿç›´æ¥é™„ä¸Š nginx å®˜æ–¹çš„æ–‡ä»¶èªªæ˜é€£çµï¼Œè®“ä½¿ç”¨è€…æŸ¥è©¢æ™‚æ–¹ä¾¿æ¯”å°ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶éœ€è¦æ›´æ”¹éœ€æ±‚ï¼Œå¯ä»¥ google nginx çš„é—œéµå­—ï¼Œæ‰¾åˆ° nginx ä¸Šè¨­å®šçš„åŠŸèƒ½é¸é …å¾Œï¼Œä¾† controller çš„æ–‡ä»¶ï¼Œæ‰¾çœ‹çœ‹ç›®å‰æ˜¯å¦å·²ç¶“æ”¯æ´ã€‚æœ‰æ™‚å€™æœ‰éœ€è¦å°ç…§ nginx å®˜æ–¹æ–‡ä»¶ï¼Œä¾†æ­£ç¢ºè¨­å®š controllerã€‚&lt;/p&gt;
&lt;h1 id=&#34;annotation&#34;&gt;Annotation&lt;/h1&gt;
&lt;p&gt;æœ‰å¾ˆå¤š Nginx çš„è¨­å®šæ˜¯æ ¹æ“š ingress ä¸åŒè€Œæœ‰èª¿æ•´ï¼Œä¾‹å¦‚é‡å°é€™å€‹ ingress åšç™½åå–®ï¼Œè¨­å®š sessionï¼Œè¨­å®š ssl ç­‰ç­‰ï¼Œé€™äº›é‡å°ç‰¹å®š ingress æ‰€åšçš„è¨­å®šï¼Œå¯ä»¥ç›´æ¥å¯«åœ¨ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress annotation&lt;/a&gt; è£¡é¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä¸‹é¢é€™å€‹ Ingress&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: ingress-nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/ingress.class: nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/tls-acme: &amp;#39;true&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    certmanager.k8s.io/cluster-issuer: letsencrypt-prod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kubernetes.io/ingress.allow-http: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ingress.kubernetes.io/force-ssl-redirect: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/whitelist-source-range: &amp;#34;34.35.36.37&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/proxy-body-size: &amp;#34;20m&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ingress.kubernetes.io/proxy-body-size: &amp;#34;20m&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # https://github.com/Shopify/ingress/blob/master/docs/user-guide/nginx-configuration/annotations.md#custom-nginx-upstream-hashing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/load-balance: &amp;#34;ip_hash&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # https://kubernetes.github.io/ingress-nginx/examples/affinity/cookie/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.org/server-snippets: gzip on;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/affinity: &amp;#34;cookie&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/session-cookie-name: &amp;#34;route&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/session-cookie-hash: &amp;#34;sha1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/session-cookie-expires: &amp;#34;3600&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    nginx.ingress.kubernetes.io/session-cookie-max-age: &amp;#34;3600&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;nginx.ingress.kubernetes.io
&lt;ul&gt;
&lt;li&gt;whitelist-source-range: åªå…è¨±ç™½åå–® ip&lt;/li&gt;
&lt;li&gt;load-balance: &amp;ldquo;ip_hash&amp;rdquo;: æ›´æ”¹é è¨­ round_robin çš„ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#load-balance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;load balance&lt;/a&gt;ï¼Œç‚ºäº†åš session cookie&lt;/li&gt;
&lt;li&gt;affinity: &amp;ldquo;cookie&amp;rdquo;: è¨­å®š upstream çš„ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#session-affinity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;session affinity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;session-cookie-name: &amp;ldquo;route&amp;rdquo;&lt;/li&gt;
&lt;li&gt;session-cookie-hash: &amp;ldquo;sha1&amp;rdquo;&lt;/li&gt;
&lt;li&gt;session-cookie-expires: &amp;ldquo;3600&amp;rdquo;&lt;/li&gt;
&lt;li&gt;session-cookie-max-age: &amp;ldquo;3600&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå¾Œç«¯ server æœ‰ session éœ€æ±‚ï¼Œå¸Œæœ›ç›¸åŒ source ip ä¾†çš„ request èƒ½æŒçºŒåˆ°ç›¸åŒçš„ endpointã€‚æ‰åšäº†ä»¥ä¸Šè¨­å®šã€‚&lt;/p&gt;
&lt;h1 id=&#34;helm-configuration&#34;&gt;helm configuration&lt;/h1&gt;
&lt;p&gt;helm çš„ configuration ä¹Ÿæ˜¯é‡è¦çš„è¨­å®šï¼Œé€™è£¡åœ¨å®‰è£æ™‚æ±ºå®šäº† nginx ingress controller çš„ topologyã€replicasã€resourceã€k8s runtime è¨­å®šå¦‚ healthz &amp;amp; readinessã€å…¶å¯¦éƒ½æœƒå½±éŸ¿ nginx å…·é«”çš„è¨­å®šã€‚é€™éƒ¨åˆ†å°±æœƒæœ‰å¾ˆå¤šè€ƒé‡ã€‚æœ‰æ©Ÿæœƒæˆ‘å€‘å†ä¾†åˆ†äº«ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Prometheus &amp; Kubernetes State Metrics Exporter</title>
      <link>https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/</link>
      <pubDate>Mon, 07 Oct 2019 08:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus / Grafana (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/&#34;&gt;GKE ä¸Šè‡ªæ¶ Prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/&#34;&gt;GKE ä¸Šè‡ªæ¶ Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/&#34;&gt;scrape config &amp;amp; exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/&#34;&gt;Dive into Redis Exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/&#34;&gt;è¼¸å‡º kube-state çš„ç›£æ¸¬æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¦‚æœè¦é€é prometheus ä¾†ç›£æ§é›†ç¾¤çš„é‹è¡Œç‹€æ³ï¼Œæœ‰å…©å€‹ exporter æ˜¯å¿…è£çš„ï¼Œä¸€å€‹æ˜¯æŠŠ node ç‹€æ…‹ export å‡ºä¾†çš„ node exporterï¼Œä¸€å€‹æ˜¯æŠŠ kubernetes é›†ç¾¤ç‹€æ…‹ export å‡ºä¾†çš„ kube state metrics exporterã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Node Exporter ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;kube metrics exporter å®‰è£èˆ‡è¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;node-exporter&#34;&gt;Node Exporter&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Node Exporter&lt;/a&gt; æ˜¯ prometheus å®˜æ–¹ç¶­è­·çš„ä¸€å€‹å­é …ç›®ï¼Œä¸»è¦åœ¨æŠŠé¡ unix ç¡¬é«” kernel çš„ metrics é€å‡ºä¾†ã€‚å®˜æ–¹ä¹Ÿæ”¯æ´ windows node èˆ‡ nvidia gpu metricsï¼Œå¯ä»¥èªªæ˜¯åŠŸèƒ½å¼·å¤§ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†èƒ½å¤ ç›£æ¸¬ kubernetes node çš„åŸºç¤è¨­æ–½ç‹€æ…‹ï¼Œé€šå¸¸éƒ½æœƒä½¿ç”¨ node exporterã€‚&lt;/p&gt;
&lt;p&gt;node exporter å®‰è£ï¼Œæˆ‘å€‘åœ¨å®‰è£ prometheus helm chart æ™‚å°±ä¸€ä¸¦å®‰è£äº†ã€‚é€™é‚Šçœ‹ä¸€ä¸‹è¨­å®šèˆ‡é‹è¡Œã€‚&lt;/p&gt;
&lt;h1 id=&#34;collectors&#34;&gt;Collectors&lt;/h1&gt;
&lt;p&gt;Node exporter æŠŠä¸åŒä½ç½®æ”¶é›†åˆ°çš„ä¸åŒé¡å‹çš„ metrics ï¼Œåšæˆå„è‡ªç¨ç«‹çš„ colletorï¼Œä½¿ç”¨è€…å¯ä»¥æ ¹æ“šæ±‚éœ€æ±‚ä¾†å•Ÿç”¨æˆ–æ˜¯ä¸å•Ÿç”¨ collectorï¼Œ&lt;a href=&#34;https://github.com/prometheus/node_exporter#enabled-by-default&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´çš„ collector ç›®éŒ„&lt;/a&gt; åœ¨é€™é‚Šã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰çœ‹æˆ‘å€‘ç¬¬ä¸€éƒ¨ä»½çš„ ELK partï¼Œæ‡‰è©²æœƒè¦ºå¾—é€™è£¡çš„è¨­å®šï¼Œè·Ÿ metricbeat éå¸¸åƒï¼ŒåŸºæœ¬ä¸Šé€™å…©è€…åšçš„äº‹æƒ…æ˜¯å¤§åŒå°ç•°çš„ï¼Œæ”¶é›† metrics ä¾†æºéƒ½æ˜¯åŒæ¨£çš„é¡ unix ç³»çµ±ï¼Œåªæ˜¯å¾€å¾Œé€çš„ç›®æ¨™ä¸ä¸€æ¨£ (é›–ç„¶ç¾åœ¨å…©è€…éƒ½å¯ä»¥å…¼å®¹æ··æ­äº†)ã€‚å¦‚æœæœ‰æ¥è§¸éå…¶ä»–å¹³å°çš„ metrics collectorï¼Œä¹Ÿæœƒç™¼ç¾å…¶å¯¦å¤§å®¶åšçš„éƒ½å·®ä¸å¤šã€‚&lt;/p&gt;
&lt;h1 id=&#34;textfile-collector&#34;&gt;Textfile Collector&lt;/h1&gt;
&lt;p&gt;Prometheus é™¤äº†æœ‰ scrape æ©Ÿåˆ¶ï¼Œè®“ prometheus å» exporter æ’ˆè³‡æ–™å¤–ï¼Œé‚„æœ‰å¦å¤–ä¸€å€‹æ©Ÿåˆ¶ï¼Œå«åš &lt;a href=&#34;https://github.com/prometheus/pushgateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pushgateway&lt;/a&gt;ï¼Œé€™å€‹æˆ‘å€‘åœ¨éƒ¨å±¬ prometheus æ™‚ä¹Ÿéƒ¨å±¬äº†ä¸€å€‹ã€‚é€™é‚Šç°¡å–®èªªæ˜ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ç¶“å¸¸æ€§åŸ·è¡Œçš„æœå‹™(redis, kafka,&amp;hellip;)æœƒä¸€ç›´é‹è¡Œï¼Œprometheus é€éé€™äº›æœå‹™çš„ metrics å–å¾— runtime metricsï¼Œä½œç‚ºç›£æ§è³‡æ–™ã€‚å¯æ˜¯æœ‰ä¸€äº› job æ˜¯æš«æ™‚æ€§çš„ä»»å‹™ï¼Œä¾‹å¦‚æœä¸€å€‹ batch jobï¼Œé€™äº›æœå‹™ä¸æœƒæœ‰ä¸€ç›´é‹è¡Œçš„ runtime metricsï¼Œä¹Ÿä¸æœƒæœ‰ exporterã€‚ä½†é€™æ™‚åˆå¸Œæœ›ç›£æ§é€™äº› job çš„ç‹€æ…‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ Pushgatewayã€‚&lt;/p&gt;
&lt;p&gt;Pushgateway çš„ä½œç”¨æ©Ÿåˆ¶ï¼Œå°±æ˜¯æŒ‡å®šæ”¶é›†çš„ç›®æ¨™è³‡æ–™å¤¾ï¼Œéœ€è¦ç›£æ¸¬çš„ batch jobï¼Œåªè¦æŠŠå¸Œæœ›ç›£æ¸¬çš„è³‡æ–™ï¼Œå¯«åˆ°è©²è³‡æ–™å¤¾ã€‚Pushgateway æœƒä¾æ“šå¯«å…¥çš„è³‡æ–™ï¼Œè½‰æˆ time series metricsï¼Œä¸¦ä¸” export å‡ºä¾†ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¨®å» tail æŒ‡å®šç›®éŒ„æª”æ¡ˆï¼Œç„¶å¾ŒæŠŠ metrics å¾Œé€çš„æ©Ÿåˆ¶ï¼Œæ˜¯å¦è·Ÿ filebeat æœ‰ä¸€é»é¡ä¼¼? åªæ˜¯ filebeat ä¸€èˆ¬å–å¾—è³‡æ–™å¾Œï¼Œæœƒä¸»å‹•æ¨é€åˆ° ELK ä¸Šï¼Œprometheus pushgateway æœƒæš´éœ²å‡º metrics å¾Œï¼Œè®“ prometheus server ä¾† scrapeã€‚&lt;/p&gt;
&lt;p&gt;Pushgateway ä¹Ÿæœƒåœ¨æ”¶é›†è³‡æ–™æ™‚æ‰“ä¸Šéœ€è¦çš„ labelï¼Œæ–¹é¢å¾Œæ®µè™•ç†è³‡æ–™ã€‚&lt;/p&gt;
&lt;h1 id=&#34;kubernetes-state-metrics-exporter&#34;&gt;Kubernetes State Metrics (Exporter)&lt;/h1&gt;
&lt;p&gt;Node Exporter å°‡ kubernetes é›†ç¾¤åº•ä¸‹çš„ Node çš„ç¡¬é«”ç‹€æ…‹ï¼Œä¾‹å¦‚ cpu, memory, storage,&amp;hellip; expose å‡ºä¾†ï¼Œç„¶è€Œæˆ‘å€‘åœ¨ç¶­é‹ kubernetes é‚„éœ€è¦å¾ api server ç²å¾—é›†ç¾¤å…§éƒ¨çš„è³‡æ–™ï¼Œä¾‹å¦‚èªª pod state, container state, endpoints, service, &amp;hellip;ç­‰ï¼Œé€™é‚Šå¯ä»¥ä½¿ç”¨ kube-state-metrics ä¾†è™•ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/kube-state-metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-state-metrics&lt;/a&gt; æ˜¯ kubernetes å®˜æ–¹ç¶­è­·çš„å°ˆæ¡ˆï¼Œåšçš„äº‹æƒ…å°±æ˜¯å‘ api server è©¢å• kubernetes çš„ stateï¼Œä¾‹å¦‚ pod state, deployment stateï¼Œç„¶å¾Œè·Ÿ prometheus exporter ä¸€ï¼Œé–‹æ”¾ä¸€å€‹ http endpointï¼Œè®“éœ€è¦çš„æœå‹™ä¾† scrape metricsã€‚&lt;/p&gt;
&lt;p&gt;å·¥ä½œé›²è£¡ä¹Ÿå¾ˆå–®ç´”ï¼Œkubernetes api server å¯ä»¥æŸ¥è©¢ pod ç•¶ä¸‹çš„ç‹€æ…‹ï¼Œkube-state-metrics å‰‡æœƒæŠŠç•¶ä¸‹çš„ç‹€æ…‹ä¾ç…§æ™‚é–“åºï¼Œåšæˆ time series çš„ metricsï¼Œä¾‹å¦‚é€™å€‹ pod ä»€éº¼æ™‚å€™æ˜¯æ´»è‘—ï¼Œä»€éº¼æ™‚å€™å› ç‚ºæ•…éšœè€Œ errorã€‚&lt;/p&gt;
&lt;p&gt;kube-state-metrics é è¨­çš„è¼¸å‡ºæ ¼å¼æ˜¯ plaintextï¼Œç›´æ¥ç¬¦åˆ Prometheus client endpoint çš„æ ¼å¼&lt;/p&gt;
&lt;h1 id=&#34;deployment&#34;&gt;Deployment&lt;/h1&gt;
&lt;p&gt;å¦‚æœä¾ç…§ç¬¬ä¸€ç¯‡å®‰è£ prometheus helm çš„æ­¥é©Ÿï¼Œç¾åœ¨æ‡‰è©²å·²ç¶“å®‰è£å®Œ kube-state-metrics äº†ã€‚å¦‚æœæ²’æœ‰å®‰è£ï¼Œä¹Ÿå¯ä»¥ä¾ç…§å®˜æ–¹èªªæ˜çš„åŸºæœ¬ç¯„ä¾‹å®‰è£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:kubernetes/kube-state-metrics.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd kube-state-metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f examples/standard/*.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£å®Œå¯ä»¥çœ‹åˆ°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods --selector &amp;#39;app=prometheus,component=kube-state-metrics&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                             READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-kube-state-metrics-85f6d75f8b-7vlkp   1/1     Running   0          201d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get svc --selector &amp;#39;app=prometheus,component=kube-state-metrics&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                            TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-kube-state-metrics   ClusterIP   None         &amp;lt;none&amp;gt;        80/TCP    201d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å€‘å¯ä»¥é€é service æ‰“åˆ° pod çš„ /metrics ä¾†å–å¾— metricsã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it busybox sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl prometheus-kube-state-metrics:8080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Kube Metrics Server&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;body&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;h1&amp;gt;Kube Metrics&amp;lt;/h1&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;ul&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&amp;lt;li&amp;gt;&amp;lt;a href=&amp;#39;/metrics&amp;#39;&amp;gt;metrics&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&amp;lt;li&amp;gt;&amp;lt;a href=&amp;#39;/healthz&amp;#39;&amp;gt;healthz&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;/ul&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;/body&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl prometheus-kube-state-metrics:8081
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Kube-State-Metrics Metrics Server&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;body&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;h1&amp;gt;Kube-State-Metrics Metrics&amp;lt;/h1&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;ul&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&amp;lt;li&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&amp;lt;a href=&amp;#39;/metrics&amp;#39;&amp;gt;metrics&amp;lt;/a&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&amp;lt;/li&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;/ul&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;/body&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šæœ‰å…©å¥— metricsï¼Œä¸€å€‹æ˜¯ kube-state-metrics è‡ªå·±è‡ªæˆ‘ç›£æ¸¬çš„ metricsï¼Œåœ¨ 8081ï¼Œå¦å¤–ä¸€å€‹æ‰æ˜¯ kube metricsï¼Œåœ¨ 8080ï¼Œå…©å€‹éƒ½è¦æ”¶ï¼Œè¨˜å¾—ä¸è¦æ”¶éŒ¯äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl prometheus-kube-state-metrics:8080/metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æ‰“ä¸‹å»å°±å¯ä»¥çœ‹åˆ°è¶…å¤š metrics ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/kube-state-metrics/tree/master/docs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Metrics çš„æ¸…å–®èˆ‡èªªæ˜æ–‡ä»¶&lt;/a&gt;ï¼Œæœ‰ç”¨åˆ°çš„ metrics ä½¿ç”¨å‰éƒ½å¯ä»¥ä¾†æŸ¥ä¸€ä¸‹å®šç¾©è§£é‡‹ã€‚&lt;/p&gt;
&lt;p&gt;ç†è«–ä¸Šä¸ç”¨æ¯å€‹ metrics éƒ½ expose å‡ºä¾†ï¼Œæœ‰éœ€è¦å¯ä»¥æŠŠä¸æœƒç”¨åˆ°çš„ metrics é—œä¸€é—œï¼Œå¯ä»¥ç¯€çœ kube-state-metrics çš„ cpu æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;h1 id=&#34;resource-recommendation&#34;&gt;Resource Recommendation&lt;/h1&gt;
&lt;p&gt;kube-state-metrics å¾ˆè²¼å¿ƒçš„é‚„é™„ä¸Š&lt;a href=&#34;https://github.com/kubernetes/kube-state-metrics#scaling-kube-state-metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å»ºè­°çš„è³‡æºåˆ†é…&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;As a general rule, you should allocate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;200MiB memory
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.1 cores
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;For clusters of more than 100 nodes, allocate at least
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2MiB memory per node
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.001 cores per node
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;scaling&#34;&gt;Scaling&lt;/h1&gt;
&lt;p&gt;kube-state-metrics é‚„æœ‰æä¾› horizontal scaling çš„è§£æ±ºæ–¹æ¡ˆï¼Œå¦‚æœä½ çš„é›†ç¾¤å¾ˆå¤§ï¼Œnode æ•¸é‡å·²ç¶“è®“ kube-state-metrics ç„¡æ³•è² è·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ sharding çš„æ©Ÿåˆ¶ï¼ŒæŠŠ metrics çš„å·¥ä½œæ•£å¸ƒåˆ°å¤šå€‹ kube-state-metricsï¼Œå†è®“ prometheus å»æ”¶é›†çµ±æ•´ã€‚é€™éƒ¨åˆ†æˆ‘è¦ºå¾—å¾ˆæœ‰è¶£ï¼Œä½†é‚„æ²’å¯¦ä½œéï¼Œæˆ‘æŠŠ&lt;a href=&#34;https://github.com/kubernetes/kube-state-metrics#horizontal-scaling-sharding&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶&lt;/a&gt; æ”¾åœ¨é€™é‚Šï¼Œæœ‰ç·£å¤§å¾·æœ‰æ™‚åšéè«‹ä¾†è¨è«–åˆ†äº«ã€‚&lt;/p&gt;
&lt;h1 id=&#34;dashboard&#34;&gt;Dashboard&lt;/h1&gt;
&lt;p&gt;metrics æŠ“å‡ºä¾†ï¼Œç•¶ç„¶è¦é–‹ä¸€ä¸‹ dashboardï¼Œé€™é‚Šä½¿ç”¨çš„æ˜¯é€™å€‹&lt;a href=&#34;https://grafana.com/grafana/dashboards/7249&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes cluster&lt;/a&gt;ï¼Œæ”¯æ´&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node exporter&lt;/li&gt;
&lt;li&gt;kube state metrics&lt;/li&gt;
&lt;li&gt;nginx ingress controller&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‰å€‹é¡˜æœ›ä¸€æ¬¡æ»¿è¶³~&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;è·‘ kubernetes å‹™å¿…ä½¿ç”¨é€™å…©å€‹ exporter&lt;/li&gt;
&lt;li&gt;kube-state-metrics æ•´ç†å¾—å¾ˆèˆ’æœï¼Œæœ‰æ™‚é–“å¯ä»¥å¤šçœ‹çœ‹é€™å€‹å°ˆæ¡ˆ&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Prometheus Exporter Library &amp; Redis Exporter</title>
      <link>https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/</link>
      <pubDate>Sun, 06 Oct 2019 08:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus / Grafana (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/&#34;&gt;GKE ä¸Šè‡ªæ¶ Prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/&#34;&gt;GKE ä¸Šè‡ªæ¶ Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/&#34;&gt;scrape config &amp;amp; exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/&#34;&gt;Dive into Redis Exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/&#34;&gt;è¼¸å‡º kube-state çš„ç›£æ¸¬æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Exporter å·¥ä½œåŸç†ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;Prometheus exporter library&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;exporter-workflow&#34;&gt;Exporter workflow&lt;/h1&gt;
&lt;p&gt;ä¸Šæ¬¡è¬›åˆ° exporter å¯ä»¥å¾æœå‹™ç«¯æŠŠé‹è¡Œè³‡æ–™æŠ½å‡ºä¾†ï¼Œä¸¦é–‹æˆ http endpointï¼Œè®“ prometheus ä¾† scrape metricsã€‚é‚£ exporter æœ¬èº«æ˜¯å¦‚ä½•å–å¾—æœå‹™å…§éƒ¨çš„ metrics å‘¢? æˆ‘å€‘ä»Šå¤©å°±ç¨å¾®çœ‹ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redis-exporter&#34;&gt;Redis Exporter&lt;/h1&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©ä»¥ &lt;a href=&#34;https://github.com/oliver006/redis_exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Redis Exporter&lt;/a&gt; ç‚ºä¾‹ï¼Œç ”ç©¶ä¸€ä¸‹å¤–éƒ¨çš„ exporter æ˜¯å¦‚ä½•å–å¾— redis å…§éƒ¨çš„ metrcsã€‚&lt;/p&gt;
&lt;p&gt;Redis exporter æ˜¯ç”¨ golang å¯«çš„ä¸€å€‹å°ç¨‹å¼ï¼Œç¸½å…±ç®—ç®—æ‰ 1000 è¡Œï¼Œè€Œä¸”å¾ˆå¤šéƒ½æ˜¯å° redis å…§éƒ¨ metrics çš„æ¸…å–®ï¼Œä»¥åŠè½‰åŒ–æˆ prometheus metrics çš„ tool functionsï¼Œä¸»è¦çš„é‚è¼¯éå¸¸ç°¡å–®ã€‚æˆ‘å€‘ç°¡å–®çœ‹ä¸€ä¸‹æºç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/oliver006/redis_exporter/blob/master/exporter.go#L386&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Collect&lt;/a&gt; æ˜¯ä¸»è¦çš„æ”¶é›†é‚è¼¯ï¼Œå°±æ˜¯åŸ·è¡Œ scrapeRedisHost(ch) ï¼Œç„¶å¾ŒæŠŠæ”¶é›†åˆ°çš„è³‡è¨Šï¼Œä½¿ç”¨ &lt;a href=&#34;https://github.com/prometheus/client_golang&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Go Client Library&lt;/a&gt; çš„å·¥å…·å°‡è³‡æ–™è¨»å†Šæˆ prometheus metrics&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;func (e *Exporter) Collect(ch chan&amp;lt;- prometheus.Metric) {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	e.Lock()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	defer e.Unlock()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	e.totalScrapes.Inc()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	if e.redisAddr != &amp;#34;&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		start := time.Now().UnixNano()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		var up float64 = 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    // å¾ host scrape è³‡æ–™ï¼Œç„¶å¾Œå¡é€² channel streaming å‡ºä¾†ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		if err := e.scrapeRedisHost(ch); err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			up = 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			e.registerConstMetricGauge(ch, &amp;#34;exporter_last_scrape_error&amp;#34;, 1.0, fmt.Sprintf(&amp;#34;%s&amp;#34;, err))
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		} else {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			e.registerConstMetricGauge(ch, &amp;#34;exporter_last_scrape_error&amp;#34;, 0, &amp;#34;&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		e.registerConstMetricGauge(ch, &amp;#34;up&amp;#34;, up)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		e.registerConstMetricGauge(ch, &amp;#34;exporter_last_scrape_duration_seconds&amp;#34;, float64(time.Now().UnixNano()-start)/1000000000)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	ch &amp;lt;- e.totalScrapes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	ch &amp;lt;- e.scrapeDuration
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	ch &amp;lt;- e.targetScrapeRequestErrors
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;scrapeRedisHost å…§éƒ¨çš„ä¸»è¦é‚è¼¯ï¼Œåˆé›†ä¸­åœ¨&lt;a href=&#34;https://github.com/oliver006/redis_exporter/blob/master/exporter.go#L1144&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸ·è¡Œ Info&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  // åŸ·è¡Œ info 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	infoAll, err := redis.String(doRedisCmd(c, &amp;#34;INFO&amp;#34;, &amp;#34;ALL&amp;#34;))
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	if err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		infoAll, err = redis.String(doRedisCmd(c, &amp;#34;INFO&amp;#34;))
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		if err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			log.Errorf(&amp;#34;Redis INFO err: %s&amp;#34;, err)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			return err
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯èªªç•¶æˆ‘å€‘åœ¨ redis-cli é€£å…¥ redis æ™‚ï¼Œå¯ä»¥åŸ·è¡Œ Info commandï¼Œå–å¾— redis å…§éƒ¨çš„è³‡è¨Šï¼ŒåŒ…å«ç¯€é»è¨­åº—èˆ‡ç‹€æ…‹ï¼Œé›†ç¾¤è¨­å®šï¼Œè³‡æ–™çš„çµ±è¨ˆæ•¸æ“šç­‰ç­‰ã€‚ç„¶å¾Œ exporter é€™é‚Šç¶­è­·æŒçºŒå»å‘ redis æ›´æ–° info ï¼Œä¸¦ä¸”æŠŠ info data è½‰åŒ–æˆ time series çš„ metrcsï¼Œå†é€é &lt;a href=&#34;https://github.com/prometheus/client_golang/tree/master/prometheus/promhttp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Client promhttp&lt;/a&gt; æä¾›çš„ http endpoint libraryï¼Œè®Šæˆ http endpointã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçœ‹ä¸€ä¸‹ &lt;a href=&#34;https://redis.io/commands/info&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redis info command çš„æ–‡ä»¶&lt;/a&gt;ï¼Œé€™é‚Šæœ‰èªªæ˜ info çš„ option ï¼Œä»¥åŠ option å„è‡ªæä¾›çš„è³‡æ–™ï¼ŒåŒ…æ‹¬ server ç‹€æ…‹ï¼Œè³€æˆ¶ç«¯é€£ç·šç‹€æ³ï¼Œç³»çµ±è³‡æºï¼Œè¤‡æœ¬ç‹€æ…‹ç­‰ç­‰ã€‚æˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±é€é info å–å¾—è³‡æ–™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po | grep redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-2-redis-ha-server-0                                3/3     Running     0          11d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-2-redis-ha-server-1                                3/3     Running     0          11d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-2-redis-ha-server-2                                3/3     Running     0          11d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl exec -it redis-2-redis-ha-server-0  sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ redis-cli -h haproxy-service  -a REDIS_PASSWORD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ haproxy-service:6379&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ haproxy-service:6379&amp;gt; info server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis_version:5.0.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis_git_sha1:00000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis_git_dirty:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis_build_id:4d072dc1c62d5672
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis_mode:standalone
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;os:Linux 4.14.127+ x86_64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;arch_bits:64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;multiplexing_api:epoll
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;atomicvar_api:atomic-builtin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcc_version:8.3.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_id:1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;run_id:63a97460b7c3745577931dad406df9609c4e2464
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp_port:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;uptime_in_seconds:976082
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;uptime_in_days:11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ haproxy-service:6379&amp;gt; info clients
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Clients
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;connected_clients:100
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;client_recent_max_input_buffer:2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;client_recent_max_output_buffer:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;blocked_clients:1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Redis exporter æ”¶é›†é€™äº›æ•¸æ“šï¼Œé€é prometheus client library æŠŠè³‡æ–™è½‰æˆ time series prometheus metricsã€‚ç„¶å¾Œé€é library æ”¾åœ¨ http enpoint ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;é…åˆä¸Šæ¬¡èªªéçš„ redis overview dashboardï¼Œå¯ä»¥ç›´æ¥åœ¨ Grafana ä¸Šä½¿ç”¨&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://cloud.githubusercontent.com/assets/1222339/19412031/897549c6-92da-11e6-84a0-b091f9deb81d.png&#34; alt=&#34;Redis Overvies library&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€™é‚Š dashboard é¡¯ç¤ºå¹¾å€‹é‡è¦çš„ metrics&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Uptime&lt;/li&gt;
&lt;li&gt;Memory Usageï¼Œè¦è¨­å®šç”¨é‡å¤ªé«˜è‡ªå‹•å ±è­¦&lt;/li&gt;
&lt;li&gt;Command çš„åŸ·è¡Œç‹€æ³ï¼Œå›æ‡‰æ™‚é–“&lt;/li&gt;
&lt;li&gt;è¨Šæ¯çš„æµé‡ï¼Œä»¥åŠè¶…å‡º time-to-live çš„è³‡æ–™æ¸…é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éƒ½æ˜¯éœ€è¦å¥½å¥½åŠ ä¸Š alert çš„æ ¸å¿ƒ metrics&lt;/p&gt;
&lt;h1 id=&#34;è²¢ç»-exporter&#34;&gt;è²¢ç» exporter&lt;/h1&gt;
&lt;p&gt;å…¶ä»–æœå‹™çš„ exporter å·¥ä½œåŸç†ä¹Ÿç›¸ä¼¼ï¼Œå¦‚æœæœå‹™æœ¬èº«æœ‰å…§éƒ¨çš„ metricsï¼Œå¯ä»¥é€é client command æˆ–æ˜¯ API å–å¾—ï¼Œexporter çš„å·¥ä½œå°±åªæ˜¯è½‰æˆ time series dataã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰æ¯”è¼ƒç‰¹æ®Šçš„ metrics æ²’æœ‰åŒ¯å‡ºï¼Œä¾‹å¦‚èªªè‡ªå®¶çš„ metrics ï¼Œä½†åˆå¸Œæœ›èƒ½æ”¾åˆ° prometheus ä¸Šç›£æ¸¬ï¼Œä¾‹å¦‚æ¯ç§’æ”¶åˆ°å¤šå°‘ request countï¼Œå›æ‡‰é€Ÿåº¦ï¼ŒéŒ¯èª¤è¨Šæ¯çš„çµ±è¨ˆ&amp;hellip;&amp;hellip;ç­‰ï¼Œé€™é»ä¹Ÿå¯ä»¥ä½¿ç”¨ client library è‡ªå¹¹ exporter ç„¶å¾Œ expose http endpointï¼Œé€™æ¨£åœ¨ prometheus ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°è‡ªå®¶ç”¢å“çš„ metricsï¼Œéå¸¸å¥½ç”¨ã€‚æœ‰æ©Ÿæœƒæˆ‘å€‘ä¾†èŠè‡ªå¹¹ exporterã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Prometheus Deployment on Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/</link>
      <pubDate>Fri, 04 Oct 2019 16:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus / Grafana (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/&#34;&gt;GKE ä¸Šè‡ªæ¶ Prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/&#34;&gt;GKE ä¸Šè‡ªæ¶ Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/&#34;&gt;scrape config &amp;amp; exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/&#34;&gt;Dive into Redis Exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/&#34;&gt;è¼¸å‡º kube-state çš„ç›£æ¸¬æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus Introduction&lt;/li&gt;
&lt;li&gt;Deploy Prometheus&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;prometheus-introduction&#34;&gt;Prometheus Introduction&lt;/h1&gt;
&lt;p&gt;ç”Ÿç”¢ç’°å¢ƒèˆ‡éç”Ÿç”¢ç’°å¢ƒï¼Œå…¶ä¸­çš„ä¸€æŒ‡æ¨™å°±æ˜¯æœ‰æ²’æœ‰è¶³å¤ å®Œæ•´çš„æœå‹™ç›£æ¸¬ç³»çµ±ï¼Œé€™å¥è©±å¯ä»¥çœ‹å‡ºæœå‹™ç›£æ¸¬å°æ–¼ç”¢å“åŒ–æ˜¯å¤šéº¼é‡è¦ã€‚è€Œç›£æ§è³‡æ–™ (metrics) çš„æ”¶é›†èˆ‡å¯è¦–åŒ–å·¥å…·å…¶å¯¦éå¸¸å¤šï¼Œä¾‹å¦‚ä¸Šå‘¨ä»‹ç´¹çš„ ELK Stackï¼Œé€™æ¬¡æˆ‘å€‘è¦ä¾†ä»‹ç´¹å¦å¤–ä¸€å€‹å¾ˆå¤šäººä½¿ç”¨çš„ prometheusã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Promethues åœ¨å®˜ç¶²ä¸Šæåˆ°&lt;/a&gt; æ˜¯ä¸€å€‹ Monitoring system and time series database&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥æ”¶é›†é«˜ç¶­åº¦çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è‡ªå·±çš„ PromQL åšæœ‰æ•ˆä¸”ç²¾ç°¡çš„è³‡æ–™æŸ¥è©¢&lt;/li&gt;
&lt;li&gt;å…§å»ºè³‡æ–™ç€è¦½å™¨ï¼Œä¸¦ä¸”èˆ‡ Grafana é«˜åº¦æ•´åˆ&lt;/li&gt;
&lt;li&gt;æ”¯æ´ sharding èˆ‡ federationï¼Œä¾†é”åˆ°æ°´å¹³æ“´å±•&lt;/li&gt;
&lt;li&gt;æœ‰è¨±å¤šéš¨æ’å³ç”¨çš„æ•´åˆ exporterï¼Œä¾‹å¦‚ redis-exporter, kafka-exporterï¼Œkubernetes-exporter ï¼Œéƒ½å¯ä»¥ç›´æ¥å–å¾—è³‡æ–™&lt;/li&gt;
&lt;li&gt;æ”¯æ´ alertï¼Œä½¿ç”¨ PromQL ä»¥åŠå¤šåŠŸèƒ½çš„å‘Šè­¦ï¼Œå¯ä»¥è¨­å®šç²¾æº–çš„å‘Šè­¦æ¢ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;èˆ‡-elk-åšæ¯”è¼ƒ&#34;&gt;èˆ‡ ELK åšæ¯”è¼ƒ&lt;/h1&gt;
&lt;p&gt;åŸºæœ¬ä¸Š Prometheus è·Ÿ ELK æ¯”ï¼Œå…¶å¯¦æ˜¯å¾ˆå¥‡æ€ªçš„ä¸€ä»¶äº‹ï¼Œä½†é€™ä¹Ÿæ˜¯æœ€å¸¸è¢«å•çš„ä¸€å€‹å•é¡Œã€‚å…©è€…åœ¨æœ¬è³ªä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ç³»çµ±ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus æ˜¯ based on time series database çš„è³‡æ–™æ”¶é›†ç³»çµ±&lt;/li&gt;
&lt;li&gt;ELK æ˜¯åŸºæ–¼å…¨æ–‡æœç´¢å¼•æ“çš„è³‡æ–™æŸ¥è©¢ç³»çµ±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ˜¯çš„ï¼Œä»–å€‘éƒ½èƒ½åš metrics æ”¶é›†ï¼Œåœ¨æœ‰é™çš„å°ºåº¦ä¸‹ï¼Œèƒ½é”åˆ°ä¸€æ¨£çš„æ•ˆæœã€‚ä½†é€™æ¨£èªªçš„æ„æ€å°±ç­‰æ–¼æ˜¯åœ¨èªª mesos DC/OS èˆ‡ kubenetes éƒ½èƒ½è·‘ container cluster ä¸€æ¨£ï¼Œåº•ä¸‹æ˜¯å®Œå…¨ä¸ä¸€æ¨£çš„æ±è¥¿ã€‚&lt;/p&gt;
&lt;p&gt;å…©è€…çš„å·®ç•°ä½¿ç”¨ä¸Šå·®éå¸¸å¤š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;metrics çµæ§‹: ELK å€ŸåŠ©å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºæœ¬ä¸Šé€ä»€éº¼è³‡æ–™è¿‘ä¾†éƒ½å¯ä»¥æŸ¥æ‰¾ã€‚Prometheus metrics æ‹‰é€²ä¾†æ˜¯ time series çš„ key-value pairsã€‚&lt;/li&gt;
&lt;li&gt;ç¶­è­·åŒæ¨£çš„ metricsï¼Œprometheus çš„ä½¿ç”¨çš„å„²å­˜ç©ºé–“é å°æ–¼ elasticsearch&lt;/li&gt;
&lt;li&gt;prometheus é‡å° time based çš„æœå°‹åšäº†å¾ˆå¤šå„ªåŒ–ï¼Œæ•ˆèƒ½å¾ˆé«˜&lt;/li&gt;
&lt;li&gt;Prometheus å°æ–¼è¨˜æ†¶é«”èˆ‡ cpu çš„æ¶ˆè€—ä¹Ÿå°‘å¾ˆå¤š&lt;/li&gt;
&lt;li&gt;Elasticsearch è³‡æºä¸Šå¾ˆè²´ï¼Œæ˜¯å› ç‚ºåœ¨è™•ç†å¤§é‡ text log çš„æ™‚å€™ï¼Œä»–èƒ½å¤ ç”¨å¾Œæ®µçš„ pipeline è™•ç†å…§å®¹ï¼Œå†é€²è¡Œäº¤å‰æ¯”å°ï¼Œå¯ä»¥å¾ text è£¡é¢æå–å¾ˆå¤šæœªäº‹å…ˆå®šç¾©çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;Elasticsearch çš„ç¶­è­·å·¥ä½œä¹Ÿæ¯”è¼ƒè¤‡é›œå›°é›£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¦æ”¶é›†æœå‹™é‹è¡Œè³‡æ–™ï¼Œå¯ä»¥ç›´æ¥é¸ prometheusã€‚å¦‚æœæœ‰æ”¶é›† log é€²è¡Œäº¤å‰æ¯”å°ï¼Œå¯ä»¥è€ƒæ…® elkã€‚&lt;/p&gt;
&lt;h3 id=&#34;helm&#34;&gt;Helm&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç”¨ helm éƒ¨å±¬ï¼Œä¹‹æ‰€ä»¥ç”¨ helm ï¼Œå› ç‚ºé€™æ˜¯æˆ‘æƒ³åˆ°æœ€ç°¡å–®çš„æ–¹æ³•ï¼Œèƒ½è®“è¼•é¬†æ“æœ‰ä¸€å¥—åŠŸèƒ½å®Œæ•´çš„ prometheusã€‚æ‰€ä»¥æˆ‘å€‘å…ˆç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ²’ç”¨é helm çš„å¤§å¾·å¯ä»¥åƒè€ƒ &lt;a href=&#34;https://helm.sh/docs/using_helm/#quickstart&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm Quickstart&lt;/a&gt;ï¼Œå…ˆæŠŠ helm cli èˆ‡ kubernetes ä¸Šçš„ helm tiller éƒ½è¨­å®šå¥½&lt;/p&gt;
&lt;h1 id=&#34;deploy-prometheus&#34;&gt;Deploy Prometheus&lt;/h1&gt;
&lt;p&gt;æˆ‘æŠŠæˆ‘çš„å¯¶è—éƒ½æ”¾åœ¨é€™äº†&lt;a href=&#34;https://github.com/chechiachang/prometheus-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/prometheus-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰ä¸‹ä¾†çš„ .sh ï¼Œè·‘ä¹‹å‰é¤Šæˆç¿’æ…£è²“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat install.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;prometheus-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; stable/prometheus &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace default &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --values values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;configuration&#34;&gt;Configuration&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Stable Chart&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;values.yaml å¾ˆé•·ï¼Œä½†å…¶å¯¦å„å€‹å…ƒä»¶è¨­å®šæ˜¯é‡è¤‡çš„,è¨­å®šå¥½å„è‡ªçš„ image,
replicas, service, topology ç­‰ç­‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;alertmanager:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubeStateMetrics:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nodeExporter:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pushgateway:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº•ä¸‹æœ‰æ›´å¤š runtime çš„è¨­å®šæª”&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šç¾©å¥½ global çš„ scrape é–“è·ï¼Œè¶ŠçŸ­ metrics ç¶­åº¦å°±è¶Šç²¾æº–&lt;/li&gt;
&lt;li&gt;PersistenVolume å¼·è¬å»ºè­°é–‹èµ·ä¾†ï¼Œç¶­æŒæ­·å²çš„è³‡æ–™
&lt;ul&gt;
&lt;li&gt;åŠ ä¸Š storage usage çš„ self monitoringï¼ˆä¹‹å¾Œæœƒè¬›) æ‰ä¸æœƒæ»¿å‡ºä¾† server æ›æ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;server çš„ scrapeConfigs æ˜¯ server å»æ”¶é›†çš„ job è¨­å®šã€‚ç¨å¾Œå†ä¾†ç´°è¬›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  global:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## How frequently to scrape targets by default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    scrape_interval: 10s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## How long until a scrape request times out
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    scrape_timeout: 10s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## How frequently to evaluate rules
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    evaluation_interval: 10s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  persistentVolume:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## If true, Prometheus server will create/use a Persistent Volume Claim
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## If false, use emptyDir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Prometheus server data Persistent Volume access modes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Must match those of existing PV or dynamic provisioner
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Ref: http://kubernetes.io/docs/user-guide/persistent-volumes/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    accessModes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - ReadWriteOnce
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Prometheus server data Persistent Volume annotations
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    annotations: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Prometheus server data Persistent Volume existing claim name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Requires server.persistentVolume.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## If defined, PVC must be created manually before volume will be bound
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    existingClaim: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Prometheus server data Persistent Volume mount root path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    mountPath: /data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Prometheus server data Persistent Volume size
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    size: 80Gi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;alertmanagerFiles:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serverFiles:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨å±¬å®Œçœ‹ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --selector=&amp;#39;app=prometheus&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                             READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-alertmanager-694d6694c6-dvkwd         2/2     Running   0          8d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-kube-state-metrics-85f6d75f8b-7vlkp   1/1     Running   0          8d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-node-exporter-2mpjc                   1/1     Running   0          8d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-node-exporter-kg7fj                   1/1     Running   0          51d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-node-exporter-snnn5                   1/1     Running   0          8d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-pushgateway-5cdfb4979c-dnmjn          1/1     Running   0          8d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-server-59b8b8ccb4-bplkx               2/2     Running   0          8d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get services --selector=&amp;#39;app=prometheus&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-alertmanager         ClusterIP   10.15.241.66   &amp;lt;none&amp;gt;        80/TCP     197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-kube-state-metrics   ClusterIP   None           &amp;lt;none&amp;gt;        80/TCP     197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-node-exporter        ClusterIP   None           &amp;lt;none&amp;gt;        9100/TCP   197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-pushgateway          ClusterIP   10.15.254.0    &amp;lt;none&amp;gt;        9091/TCP   197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-server               ClusterIP   10.15.245.10   &amp;lt;none&amp;gt;        80/TCP     197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get endpoints --selector=&amp;#39;app=prometheus&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                            ENDPOINTS                                             AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-alertmanager         10.12.6.220:9093                                      197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-kube-state-metrics   10.12.6.222:8080                                      197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-node-exporter        10.140.0.30:9100,10.140.0.9:9100,10.140.15.212:9100   197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-pushgateway          10.12.6.211:9091                                      197d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-server               10.12.3.14:9090                                       197d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°¡å–®èªªæ˜ä¸€ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;prometheus-server æ˜¯ä¸»è¦çš„ api-server ä»¥åŠ time series database&lt;/li&gt;
&lt;li&gt;alertmanager è² è²¬å‘Šè­¦å·¥ä½œ&lt;/li&gt;
&lt;li&gt;pushgateway æä¾› client ç«¯ä¸»å‹•æ¨é€ metrics çµ¦ server çš„ endpoint&lt;/li&gt;
&lt;li&gt;kube-state-metrics æ˜¯é–‹ä¾†æ”¶é›† cluster wide çš„ metrics, åƒæ˜¯ pods running counts, deployment ready count, total pods number ç­‰ç­‰ metrics&lt;/li&gt;
&lt;li&gt;node-exporter æ˜¯ daemonsets, æŠŠæ¯ä¸€å€‹ node çš„ metrics, åƒæ˜¯ memory, cpu, disk&amp;hellip;ç­‰è³‡æ–™,æ”¶é›†å‡ºä¾†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸»è¦æœå‹™å­˜å–å°±æ˜¯é€é prometheus-server&lt;/p&gt;
&lt;h1 id=&#34;access-prometheus-server&#34;&gt;Access Prometheus server&lt;/h1&gt;
&lt;p&gt;é™¤äº†ç›´æ¥ exec -it é€²å» prometheus-server ä»¥å¤–ï¼Œç”±æ–¼ prometheus æœ¬èº«æœ‰æä¾› web portal, æ‰€ä»¥æˆ‘å€‘é€™é‚Šé€é port forwarding æ‰“åˆ°æœ¬æ©Ÿä¸Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PROMETHEUS_POD_NAME=$(kc get po -n default --selector=&amp;#39;app=prometheus,component=server&amp;#39; -o=jsonpath=&amp;#39;{.items[0].metadata.name}&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --namespace default port-forward ${PROMETHEUS_POD_NAME} 9090
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€é browser å°±å¯ä»¥é€£å…¥æ“ä½œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://localhost:9090
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥é€é &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP API&lt;/a&gt; ç”¨ç¨‹å¼æ¥å…¥æ§åˆ¶&lt;/p&gt;
&lt;h1 id=&#34;prometheus-web&#34;&gt;Prometheus Web&lt;/h1&gt;
&lt;p&gt;Prometheus æœ¬æ…æä¾›çš„ UI å…¶å¯¦åŠŸèƒ½å°±å¾ˆå¼·å¤§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥æŸ¥åˆ° (å·²ç¶“åŒ¯å…¥å­˜åœ¨) çš„ metrics&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨ä¸Šé¢åŸ·è¡Œ PromQL æŸ¥è©¢èªæ³•&lt;/li&gt;
&lt;li&gt;æŸ¥è©¢é‹è¡Œçš„ status&lt;/li&gt;
&lt;li&gt;æŸ¥è©¢ç›®å‰æ‰€æœ‰æ”¶é›†çš„ targets çš„ç‹€æ…‹,æœ‰æ”¶é›†å™¨æ›äº†ä¹Ÿå¯ä»¥åœ¨é€™é‚Šçœ‹åˆ°&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;è¼•é¬†è‡ªæ¶ prometheus&lt;/li&gt;
&lt;li&gt;Prometheus é é¢æœ‰ç²¾ç°¡ï¼Œä½†æ˜¯åŠŸèƒ½å®Œæ•´çš„ graph è£½åœ–&lt;/li&gt;
&lt;li&gt;ä½†å¤§å®¶é€šå¸¸æœƒä½¿ç”¨ Grafana æ­é…ä½¿ç”¨, ç”¨ééƒ½èªªè®š, æˆ‘å€‘æ˜å¤©ç¹¼çºŒ&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Prometheus Deploy Grafana</title>
      <link>https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/</link>
      <pubDate>Fri, 04 Oct 2019 08:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus / Grafana (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/&#34;&gt;GKE ä¸Šè‡ªæ¶ Prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/&#34;&gt;GKE ä¸Šè‡ªæ¶ Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/&#34;&gt;scrape config &amp;amp; exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/&#34;&gt;Dive into Redis Exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/&#34;&gt;è¼¸å‡º kube-state çš„ç›£æ¸¬æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Grafana Introduction&lt;/li&gt;
&lt;li&gt;Deploy Grafana&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;grafana-introduction&#34;&gt;Grafana Introduction&lt;/h1&gt;
&lt;p&gt;ä¸Šåæˆ‘å€‘ç°¡å–®ä»‹ç´¹äº† Prometheusï¼Œprometheus çš„ Web Portol å·²ç¶“é™„ä¸Šç°¡å–®çš„ Query èˆ‡ Graph å·¥å…·ï¼Œä½†ä¸€èˆ¬æˆ‘å€‘åœ¨ä½¿ç”¨æ™‚ï¼Œé‚„æ˜¯æœƒæ­é… Grafana ä¾†ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana åœ¨å®˜ç¶²ä¸Šæåˆ°&lt;/a&gt; æ˜¯ä¸€å€‹ Analytics systemï¼Œå¯ä»¥å”åŠ©äº†è§£é‹è¡Œè³‡æ–™ï¼Œå»ºç«‹å®Œæ•´çš„ dashboardã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æ´è¨±å¤šåœ–è¡¨ï¼Œç›´ç·šåœ–ï¼Œé•·æ¢åœ–ï¼Œå€åŸŸåˆ†æï¼ŒåŸºæœ¬ä¸Šéœ€è¦çš„éƒ½æœ‰&lt;/li&gt;
&lt;li&gt;åœ¨åœ–è¡¨ä¸Šå®šç¾© alterï¼Œä¸¦ä¸”ä¸»å‹•å‘Šè­¦ï¼Œæ•´åˆå…¶ä»–é€šè¨Šè»Ÿé«”&lt;/li&gt;
&lt;li&gt;å°å¾Œç«¯ data source çš„æ•´åˆï¼Œå¯ä»¥åŒæ™‚ä½¿ç”¨ ELK, prometheus, influxdb ç­‰ 30 å¤šç¨®çš„è³‡æ–™ä¾†æº&lt;/li&gt;
&lt;li&gt;æœ‰è¨±å¤šå…¬é–‹çš„ plugin èˆ‡ dashboard å¯ä»¥åŒ¯å…¥ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½ä¹‹åŠŸèƒ½å¼·å¤§ï¼Œè‡³æ–¼ç”¨èµ·ä¾†çš„æ„Ÿè¦ºï¼Œå€‹äººæ˜¯éå¸¸æ¨è–¦ã€‚å¦‚æœæœ‰å¤§å¾—æƒ³è¦è©¦ç©çœ‹çœ‹ï¼Œå¯ä»¥ç›´æ¥åˆ° &lt;a href=&#34;https://play.grafana.org/d/000000029/prometheus-demo-dashboard?orgId=1&amp;amp;refresh=5m&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana Live Demo&lt;/a&gt; ä¸Šé¢è©¦ç©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬ä½¿ç”¨éƒ½æœƒåœç¹ dashboard ç‚ºæ ¸å¿ƒï¼Œé€éå–®ä¸€ç•«é¢ï¼Œä¸€è¦½ç›®å‰ä½¿ç”¨è€…éœ€è¦è®€å–çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;å·¦ä¸Šè§’çš„ä¸‹æ‹‰é¸å–®ï¼Œå¯ä»¥é¸æ“‡ä¸åŒçš„ dashboards&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;èˆ‡-kibana-åšæ¯”è¼ƒ&#34;&gt;èˆ‡ Kibana åšæ¯”è¼ƒ&lt;/h1&gt;
&lt;p&gt;é›–ç„¶å¤§éƒ¨åˆ†ä½¿ç”¨ä¸Šï¼Œæˆ‘å€‘éƒ½æœƒä½¿ç”¨ ELK ä¸€å¥—ï¼Œè€Œ Prometheus + Grafana å¦ä¸€å¥—ã€‚ä½†å…¶å¯¦å…©é‚Šçš„ data source éƒ½å¯ä»¥äº’æ¥ã€‚ä¾‹å¦‚ grafana å¯ä»¥åƒ elasticsearch çš„ data sourceï¼Œè€Œ kibana æœ‰ prometheus moduleã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚ŠåŸºæ–¼å…©æ¬¾å‰ç«¯åˆ†æå·¥å…·ï¼Œç¨å¾®åšå€‹æ¯”è¼ƒï¼Œåº•å±¤çš„ data source å·®ç•°é€™é‚Šå…ˆä¸æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éƒ½æ˜¯é–‹æº: å…©è€…çš„é–‹æºç¤¾ç¾¤éƒ½éå¸¸å¼·å¤§&lt;/li&gt;
&lt;li&gt;å…©è€…å…§å»ºçš„ dashboard éƒ½éå¸¸å®Œæ•´ï¼Œè€Œä¸”ä¸æ–·æ¨å‡ºæ–°åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;Log vs Metrics:
&lt;ul&gt;
&lt;li&gt;Kibana çš„ metrics ä¹Ÿæ˜¯åƒ log ä¸€æ¨£çš„ key value pairsï¼Œèƒ½å¤  explore æœªå®šç¾©çš„ log&lt;/li&gt;
&lt;li&gt;Grafana çš„ UI å°ˆæ³¨æ–¼å‘ˆç¾ time series çš„ metricsï¼Œä¸¦æ²’æœ‰æä¾› data çš„æ¬„ä½æœå°‹ï¼Œè€Œæ˜¯ä½¿ç”¨èªæ³• Query ä¾†å–å¾—æ•¸æ“š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Data source:
&lt;ul&gt;
&lt;li&gt;Grafana å¯ä»¥æ”¶é›†å„ç¨®ä¸åŒçš„å¾Œç«¯è³‡æ–™ä¾†æº&lt;/li&gt;
&lt;li&gt;ELK ä¸»è¦æ ¸å¿ƒé‚„æ˜¯ ELK stackï¼Œç”¨å…¶ä»– Module è¼”åŠ©å…¶ä»–è³‡æ–™æº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;deploy-grafana&#34;&gt;Deploy Grafana&lt;/h1&gt;
&lt;p&gt;æˆ‘æŠŠæˆ‘çš„å¯¶è—éƒ½æ”¾åœ¨é€™äº†&lt;a href=&#34;https://github.com/chechiachang/prometheus-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/prometheus-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰ä¸‹ä¾†çš„ .sh ï¼Œè·‘ä¹‹å‰é¤Šæˆç¿’æ…£è²“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat install.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grafana-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install grafana stable/grafana &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace default &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --values values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;helm&#34;&gt;Helm&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç”¨ helm éƒ¨å±¬ï¼Œ&lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/grafana&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana Stable Chart&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;configuration&#34;&gt;Configuration&lt;/h3&gt;
&lt;p&gt;ç°¡å–®çœ‹ä¸€ä¸‹è¨­å®šæª”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replicas: 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deploymentStrategy: RollingUpdate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Grafana æ˜¯æ”¯æ´ &lt;a href=&#34;https://grafana.com/docs/tutorials/ha_setup/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana HA&lt;/a&gt; ï¼Œå…¶å¯¦ä¹Ÿéå¸¸ç°¡å–®ï¼Œå°±æ˜¯æŠŠ grafana æœ¬èº«çš„ dashboard database å¾æ¯å€‹ grafana ä¸€å° SQLiteï¼Œè®Šæˆå¤–éƒ¨çµ±ä¸€çš„ MySQLï¼Œçµ±ä¸€è®€å–å¾Œç«¯è³‡æ–™ï¼Œå‰ç«¯å°±å¯æ°´å¹³æ“´å±•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;readinessProbe:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  httpGet:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    path: /api/health
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    port: 3000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;livenessProbe:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  httpGet:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    path: /api/health
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    port: 3000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  initialDelaySeconds: 60
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  timeoutSeconds: 30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  failureThreshold: 10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;image:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  repository: grafana/grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tag: 6.0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pullPolicy: IfNotPresent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## Optionally specify an array of imagePullSecrets.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## Secrets must be manually created in the namespace.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # pullSecrets:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   - myRegistrKeySecretName
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€äº› Pod çš„åŸºæœ¬é…ç½®ï¼Œ health check ä½¿ç”¨å…§å»ºçš„ apiï¼Œæœ‰éœ€è¦ä¹Ÿå¯ä»¥ç›´æ¥æ‰“ api&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;securityContext:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  runAsUser: 472
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  fsGroup: 472
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;extraConfigmapMounts: []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # - name: certs-configmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   mountPath: /etc/grafana/ssl/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   configMap: certs-configmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #   readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰è¦é–‹å¤–éƒ¨ ingressï¼Œéœ€è¦ ssl çš„è©±å¯ä»¥å¾é€™é‚Šæ›é€²å»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Expose the grafana service to be accessed from outside the cluster (LoadBalancer service).
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## or access it from within the cluster (ClusterIP service). Set the service type and the port to serve it.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: http://kubernetes.io/docs/user-guide/services/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  type: LoadBalancer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  port: 80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  targetPort: 3000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # targetPort: 4181 To be used with a proxy extraContainer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  labels: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ingress:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  annotations: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # kubernetes.io/ingress.class: nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # kubernetes.io/tls-acme: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  labels: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  path: /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - chart-example.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tls: []
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #  - secretName: chart-example-tls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #    hosts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #      - chart-example.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šå¯ä»¥é–‹ service load balancer, ä»¥åŠ ingressï¼Œçœ‹å¯¦éš›ä½¿ç”¨çš„éœ€æ±‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;persistence:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  initChownData: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # storageClassName: default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  accessModes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - ReadWriteOnce
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  size: 10Gi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # annotations: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # subPath: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # existingClaim:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Persistent Volume ä½œç‚ºæœ¬åœ°å„²å­˜å»ºè­°éƒ½é–‹èµ·ä¾†ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Administrator credentials when not using an existing secret (see below)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;adminUser: admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# adminPassword: strongpassword
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Use an existing secret for the admin user.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;admin:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  existingSecret: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  userKey: admin-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  passwordKey: admin-password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¸³è™Ÿå¯†ç¢¼å»ºè­°ä½¿ç”¨ secret æ›é€²å»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;datasources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#  datasources.yaml:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#    apiVersion: 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#    datasources:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#    - name: Prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      type: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      url: http://prometheus-prometheus-server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      access: proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      isDefault: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Configure grafana dashboard providers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## ref: http://docs.grafana.org/administration/provisioning/#dashboards
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## `path` must be /var/lib/grafana/dashboards/&amp;lt;provider_name&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dashboardProviders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#  dashboardproviders.yaml:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#    apiVersion: 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#    providers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#    - name: &amp;#39;default&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      orgId: 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      folder: &amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      type: file
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      disableDeletion: false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      editable: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#      options:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#        path: /var/lib/grafana/dashboards/default
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Configure grafana dashboard to import
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## NOTE: To use dashboards you must also enable/configure dashboardProviders
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## ref: https://grafana.com/dashboards
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## dashboards per provider, use provider name as key.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dashboards&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# default:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#   some-dashboard:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     json: |
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#       $RAW_JSON
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#   custom-dashboard:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     file: dashboards/custom-dashboard.json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#   prometheus-stats:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     gnetId: 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     revision: 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     datasource: Prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#   local-dashboard:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     url: https://example.com/repository/test.json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#   local-dashboard-base64:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     url: https://example.com/repository/test-b64.json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#     b64content: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Data source, Dashboard æƒ³è¦ç›´æ¥è¼‰å…¥ï¼Œå¯ä»¥åœ¨é€™é‚Šè¨­å®šï¼Œæˆ–æ˜¯ grafana èµ·ä¾†å¾Œï¼Œé€é Web UI é€²å»æ–°å¢ä¹Ÿå¯ä»¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## Grafana&amp;#39;s primary configuration
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## NOTE: values in map will be converted to ini format
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## ref: http://docs.grafana.org/installation/configuration/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grafana.ini:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  paths:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    data: /var/lib/grafana/data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    logs: /var/log/grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    plugins: /var/lib/grafana/plugins
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    provisioning: /etc/grafana/provisioning
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  analytics:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    check_for_updates: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  log:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    mode: console
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  grafana_net:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    url: https://grafana.net
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œæ˜¯ grafana.ini æ ¸å¿ƒ runtime è¨­å®šï¼Œæ›´å¤šè¨­å®šå¯ä»¥åƒè€ƒ&lt;a href=&#34;http://docs.grafana.org/installation/configuration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;deployment&#34;&gt;Deployment&lt;/h1&gt;
&lt;p&gt;éƒ¨å±¬å®Œçœ‹ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get po --selector=&amp;#39;app=grafana&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;access&#34;&gt;Access&lt;/h1&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰é€é service load balancer æ‰“å‡ºä¾†ï¼Œä¸€æ¨£å¯ä»¥ä½¿ç”¨ kubectl åš port forwardingï¼Œæ¬Šé™å°±æ˜¯ context çš„æ¬Šé™ï¼Œæ²’æœ‰ cluster context çš„ä½¿ç”¨è€…å°±æœƒé€²æ­¥ä¾†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GRAFANA_POD_NAME=$(kc get po -n default --selector=&amp;#39;app=grafana&amp;#39; -o=jsonpath=&amp;#39;{.items[0].metadata.name}&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --namespace default port-forward ${GRAFANA_POD_NAME} 3000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://localhost:3000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±æ–¼æˆ‘å€‘é€é service load balancerï¼Œgcp æœƒåœ¨å¤–éƒ¨å¹«å¿™æ¶ä¸€å€‹ load balancerï¼Œ
å¯ä»¥ç›´æ¥é€é load balancer ip å­˜å–ï¼Œå¦‚æœæƒ³è¨­å®š dnsï¼ŒæŒ‡å‘é€™å€‹ ip å¾Œè¨˜å¾—å»èª¿æ•´ grafana çš„ server hostnameã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ secret çš„å¯†ç¢¼ç™»å…¥ï¼Œusername: grafanaï¼Œé€™å€‹æ˜¯ç³»çµ±ç®¡ç†å“¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get secret --namespace default grafana -o jsonpath=&amp;#34;{.data.admin-password}&amp;#34; | base64 --decode ; echo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;configuration-1&#34;&gt;Configuration&lt;/h1&gt;
&lt;p&gt;è¿‘ä¾†ç•«é¢å¾Œå…ˆåˆ°å·¦é‚Šçš„&lt;a href=&#34;https://play.grafana.org/plugins&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Configuration&lt;/a&gt; èª¿æ•´&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¢ç”Ÿæ–°çš„ user org èˆ‡ userï¼ŒæŠŠ admin æ¬Šé™æ§åˆ¶åœ¨éœ€è¦çš„äººæ‰‹ä¸Š&lt;/li&gt;
&lt;li&gt;æŠŠ prometheus data source åŠ é€²ä¾†ï¼Œå°±å¯ä»¥ç›´æ¥çœ‹åˆ° prometheus è£¡é¢çš„è³‡æ–™ã€‚&lt;/li&gt;
&lt;li&gt;åˆ‡æ›åˆ°éç®¡ç†å“¡çš„ user ç¹¼çºŒæ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;import-dashboard&#34;&gt;Import Dashboard&lt;/h3&gt;
&lt;p&gt;Grafana ç¶²ç«™ä¸Šå·²ç¶“æœ‰&lt;a href=&#34;https://grafana.com/grafana/dashboards&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¶…å¤šè¨­ç½®å¥½çš„ Dashboard&lt;/a&gt; å¯ä»¥ç›´æ¥ importï¼Œå¤§éƒ¨åˆ†çš„æœå‹™éƒ½å·²ç¶“æœ‰åˆ¥äººå¹«æˆ‘å€‘æŠŠè¦–è¦ºç•«åœ–è¡¨æ‹‰å¥½ï¼Œä½¿ç”¨ç¤¾ç¾¤ä¸»æµçš„ exporter çš„è©±ï¼Œåƒæ•¸ç›´æ¥æ¥å¥½ã€‚æˆ‘å€‘åŒ¯å…¥å¾Œå†é€²è¡Œç°¡å–®çš„å®¢è£½åŒ–èª¿æ•´å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘éµäººè³½æœ‰ç”¨åˆ°çš„æœå‹™ï¼Œéƒ½å·²ç¶“æœ‰ dashboard&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kubernetes Cluster: 6417
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://grafana.com/dashboards/6417&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/dashboards/6417&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka Exporter Overview: 7589
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://grafana.com/dashboards/7589&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/dashboards/7589&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Prometheus Redis: 763
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://grafana.com/dashboards/763&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/dashboards/763&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes Deployment Statefulset Daemonset metrics: 8588
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://grafana.com/dashboards/8588&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/dashboards/8588&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Haproxy Metrics Servers: 367
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://grafana.com/dashboards/367&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grafana.com/dashboards/367&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Go to grafana lab to find more dashboards&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;export-dashboard&#34;&gt;Export Dashboard&lt;/h3&gt;
&lt;p&gt;dashboard æœƒä¾ç…§ç™»å…¥ä½¿ç”¨è€…çš„éœ€æ±‚åšèª¿æ•´ï¼Œæ¯å€‹è…³è‰²éœ€è¦çœ‹åˆ°çš„åœ–è¡¨éƒ½ä¸åŒï¼ŒåŸºæœ¬ä¸Šè®“å„å€‹è…³è‰²éƒ½èƒ½ä¸€çœ¼çœ‹åˆ°æ‰€éœ€çš„è¡¨æ ¼å³å¯&lt;/p&gt;
&lt;p&gt;è‡ªå·±çš„èª¿æ•´éçš„ dashboard ä¹Ÿå¯ä»¥åŒ¯å‡ºåˆ†äº«&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;p&gt;åˆ°é€™é‚Šå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ grafanaäº†ï¼Œè³‡æ–™ä¾†æºçš„ exporter æˆ‘å€‘æœƒæ­é…å‰å¹¾å‘¨åˆ†äº«éçš„æœå‹™ï¼Œä¸€èµ·ä¾†è¬›&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Prometheus Scrape</title>
      <link>https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/</link>
      <pubDate>Fri, 04 Oct 2019 08:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus / Grafana (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/&#34;&gt;GKE ä¸Šè‡ªæ¶ Prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/&#34;&gt;GKE ä¸Šè‡ªæ¶ Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/&#34;&gt;scrape config &amp;amp; exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/&#34;&gt;Dive into Redis Exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/&#34;&gt;è¼¸å‡º kube-state çš„ç›£æ¸¬æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus scrape&lt;/li&gt;
&lt;li&gt;scrape_configs&lt;/li&gt;
&lt;li&gt;Node exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;scrape&#34;&gt;Scrape&lt;/h1&gt;
&lt;p&gt;Prometheus æ”¶é›† metrics çš„æ–¹å¼ï¼Œæ˜¯å¾è¢«ç›£æ¸¬çš„ç›®æ¨™çš„ http endpoints æ”¶é›† (scrape) metricsï¼Œç›®æ¨™æœå‹™æœ‰æä¾› export metrics çš„ endpoint çš„è©±ï¼Œç¨±ä½œ exporterã€‚ä¾‹å¦‚ kafka-exporter å°±æœƒæ”¶é›† kafka é‹è¡Œçš„ metricsï¼Œè®Šæˆ http endpoint instanceï¼Œprometheus å¾ instance ä¸Šé¢æ”¶é›†è³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;Promethesu è‡ªå·±ä¹Ÿæ˜¯ä¹Ÿæä¾› metrics endpointï¼Œä¸¦ä¸”è‡ªå·±é€é scrape è‡ªå·±çš„ metrics endpoint ä¾†å–å¾— self-monitoring çš„ metricsã€‚æŠŠè‡ªå·±ç•¶ä½œå¤–éƒ¨æœå‹™ç›£æ¸¬ã€‚ä¸‹é¢çš„è¨­å®šå°±æ˜¯ç›´æ¥é€é http://localhost:9090/metrics å–å¾—ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;global:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  scrape_interval:     15s # By default, scrape targets every 15 seconds.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Attach these labels to any time series or alerts when communicating with
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # external systems (federation, remote storage, Alertmanager).
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  external_labels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    monitor: &amp;#39;codelab-monitor&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# A scrape configuration containing exactly one endpoint to scrape:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Here it&amp;#39;s Prometheus itself.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;scrape_configs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # The job name is added as a label `job=&amp;lt;job_name&amp;gt;` to any timeseries scraped from this config.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - job_name: &amp;#39;prometheus&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Override the global default and scrape targets from this job every 5 seconds.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    scrape_interval: 5s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    static_configs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - targets: [&amp;#39;localhost:9090&amp;#39;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€é Grafana -&amp;gt; explore å°±å¯ä»¥çœ‹åˆ° Prometheus çš„ metrics&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;static/img/prometheus-self-metrics.jpg&#34; alt=&#34;Prometheus Self Metrics&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è€Œä½¿ç”¨ metrics æ™‚æœ€å¥½å…ˆæŸ¥åˆ°èªªæ˜æ–‡ä»¶ï¼Œç¢ºå®š metrics çš„å®šç¾©èˆ‡è¨ˆç®—æ–¹æ³•ï¼Œæ‰å¯ä»¥æœ‰æ•ˆçš„è£½åœ–ã€‚é—œæ–¼ &lt;a href=&#34;https://wiki.lnd.bz/display/LFTC/Prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Exporter çš„ metrics èªªæ˜&lt;/a&gt; å¯ä»¥åˆ°é€™è£¡ä¾†æ‰¾ã€‚&lt;/p&gt;
&lt;h1 id=&#34;dashboard&#34;&gt;Dashboard&lt;/h1&gt;
&lt;p&gt;æ”¶é›†åˆ° metrics ä¹‹å¾Œå°±å¯ä»¥åœ¨ prometheus ä¸­ queryï¼Œä½†ä¸€èˆ¬ä½¿ç”¨ä¸æœƒä¸€ç›´è·‘é€²ä¾†ä¸‹ queryï¼Œè€Œæ˜¯æœƒç›´æ¥æ­é… dashboard è£½åœ–å‘ˆç¾ï¼Œè®“è³‡æ–™ä¸€è¦½ç„¡éºã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ prometheus è‡ªèº«çš„ metrics ä¹Ÿå·²ç¶“æœ‰æ­é…å¥½çš„ &lt;a href=&#34;https://grafana.com/grafana/dashboards/3662&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus overview dashboard&lt;/a&gt; å¯ä»¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•éå¸¸ç°¡å–®ï¼Œç›´æ¥é€é Grafana import dashboardï¼Œè£¡é¢å°±æŠŠé‡è¦çš„ prometheus metrics éƒ½æ”¾åœ¨ dashboard ä¸Šäº†ã€‚ä¸èƒ½æ›´æ–¹ä¾¿äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;exporters&#34;&gt;Exporters&lt;/h1&gt;
&lt;p&gt;Prometheus æ”¯æ´è¶…ç´šå¤š exporterï¼ŒåŒ…å« prometheus è‡ªèº«ç›´æ¥ç¶­è­·çš„ exporterï¼Œé‚„æœ‰éå¸¸å¤šå¤–éƒ¨æœå‹™å‹ä¹Ÿé–‹æºçš„ exporter å¯ä»¥ä½¿ç”¨ï¼Œ&lt;a href=&#34;https://prometheus.io/docs/instrumenting/exporters/#exporters-and-integrations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¸…å–®å¯ä»¥åˆ°é€™è£¡çœ‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ‰å¸Œæœ›è‡ªå·±å…¬å¸çš„æœå‹™ï¼Œä¹Ÿä½¿ç”¨ prometheus&lt;/p&gt;
&lt;h1 id=&#34;node-exporter&#34;&gt;Node Exporter&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus/node_exporter&lt;/a&gt; æ˜¯ Prometheus ç›´æ¥ç¶­è­·çš„ projectï¼Œä¸»è¦ç”¨é€”å°±æ˜¯å°‡ node / vm çš„é‹è¡Œ metrics export å‡ºä¾†ã€‚æœ‰é»é¡ä¼¼ ELK çš„ metricbeatã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šæ˜¯åœ¨ kubernetes ä¸ŠåŸ·è¡Œï¼Œæ‰€ä»¥ç›´æ¥åšæˆ daemonsets åœ¨ k8s ä¸Šè·‘ï¼Œéƒ¨å±¬æ–¹é¢åœ¨ deploy prometheus-server çš„ helm chart ä¸­ï¼Œå°±å·²ç¶“é™„å¸¶æ•´åˆï¼Œéƒ¨å±¬åˆ°æ¯ä¸€å° node ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯åœ¨ kubernetes å¤–çš„ç’°å¢ƒï¼Œä¾‹å¦‚èªª on premise serverï¼Œæˆ–æ˜¯ gcp instanceï¼Œå¸Œæœ›è‡ªå·±éƒ¨å±¬ node exporter çš„è©±ï¼Œå¯ä»¥åƒè€ƒ&lt;a href=&#34;https://prometheus.io/docs/guides/node-exporter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€™ç¯‡æ•™å­¸æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šå¯ä»¥çœ‹ä¸€ä¸‹ configï¼Œä»¥åŠ job å®šç¾©ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;vim&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;staging&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Enable nodeExporter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nodeExporter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prometheus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;yml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rule_files&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;etc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;etc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scrape_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Add kubernetes node job
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;job_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;kubernetes-nodes&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Default to scraping over https. If required, just disable this or change to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# `http`.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# This TLS &amp;amp; bearer token file config is used to connect to the actual scrape
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# endpoints for cluster components. This is separate to discovery auth
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# configuration because discovery &amp;amp; scraping are two separate concerns in
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Prometheus. The discovery auth config is automatic if Prometheus runs inside
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# the cluster. Otherwise, more config options have to be provided within the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# &amp;lt;kubernetes_sd_config&amp;gt;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tls_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ca_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;serviceaccount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;crt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# If your node certificates are self-signed or use a different CA to the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# master CA, then disable certificate verification below. Note that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# certificate verification is an integral part of a secure infrastructure
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# so this should only be disabled in a controlled environment. You can
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# disable certificate verification by uncommenting the line below.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;insecure_skip_verify&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bearer_token_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;serviceaccount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubernetes_sd_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;role&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;relabel_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;labelmap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;__meta_kubernetes_node_label_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__address__&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;replacement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;svc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__meta_kubernetes_node_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__metrics_path__&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;replacement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nodes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;kubernetes_sd_config: å¯ä»¥é€é kubernetes API ä¾†å–å¾— scrape targetï¼Œä»¥é€™é‚Šçš„è¨­å®šï¼Œæ˜¯ä½¿ç”¨ node role å»é›†ç¾¤å–å¾— nodeï¼Œä¸¦ä¸”æ¯ä¸€å° node éƒ½ç•¶æˆä¸€å€‹ targetï¼Œé€™æ¨£å°±ä¸ç”¨æŠŠæ‰€æœ‰ node éƒ½æ‰‹å‹•åŠ åˆ° job çš„ instance list è£¡é¢ã€‚&lt;/p&gt;
&lt;p&gt;å¾ node role å–å¾—çš„ instance æœƒä½¿ç”¨ ip æ¨™è¨»æˆ–æ˜¯ hostname æ¨™è¨»ã€‚node role æœ‰æä¾› node ç¯„åœçš„ meta labelsï¼Œä¾‹å¦‚ __meta_kubernetes_node_name, _&lt;em&gt;meta_kubernetes_node_address&lt;/em&gt; ç­‰ç­‰ï¼Œæ–¹ä¾¿æŸ¥æ‰¾æ•´ç†è³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;relabel_configs: é‡å°è³‡æ–™åšé¡å¤–æ¨™è¨˜ï¼Œæ–¹ä¾¿ä¹‹å¾Œåœ¨ grafana ä¸Šé¢ä¾æ“šéœ€æ±‚ queryã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Redis Ha Failure Recovery</title>
      <link>https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/</link>
      <pubDate>Thu, 03 Oct 2019 16:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸Šéƒ¨ç½² Redis HA (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/&#34;&gt;ä½¿ç”¨ helm éƒ¨ç½² redis-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/&#34;&gt;Redis HA with sentinel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/&#34;&gt;Redis sentinel topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/&#34;&gt;Redis HA with HAproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/&#34;&gt;Redis HA Failure Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Failure Case&lt;/li&gt;
&lt;li&gt;Recovery&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;topology&#34;&gt;Topology&lt;/h1&gt;
&lt;p&gt;ä¸Šç¯‡çš„ä¾‹å­å®Œæˆæ‡‰è©²æ˜¯é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   +-------+   +--------+    +------------+    +---------+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   |Clients|---|HAProxys|----|redis master|----|sentinels|
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   +-------+   +--------+    +------------+    +---------+
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;HAproxy ä½œç‚ºå¾Œç«¯ redis çš„ gateway&lt;/li&gt;
&lt;li&gt;Client é€é HAproxy é€£å…¥ redis master&lt;/li&gt;
&lt;li&gt;sentinel è² è²¬ç›£æ¸¬ redis ç‹€æ…‹èˆ‡ failoverï¼Œåªæ˜¯ client ä¸å†é€é sentinel å»å–å¾— masterï¼Œè€Œæ˜¯é€é HAProxyã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ç¾åœ¨å°±ä¾†èŠèŠé€™äº›æœå‹™å¯èƒ½æ€éº¼æ­»çš„ï¼Œå›å¾©çš„æ©Ÿåˆ¶åˆæ˜¯å¦‚ä½•&lt;/p&gt;
&lt;h1 id=&#34;failure-recovery&#34;&gt;Failure Recovery&lt;/h1&gt;
&lt;h3 id=&#34;redis-master-æ•…éšœ&#34;&gt;Redis master æ•…éšœ&lt;/h3&gt;
&lt;p&gt;é€™å€‹æ˜¯ç›®å‰æˆ‘å€‘é€™å€‹ Redis HAProxy é…ç½®ä¸»è¦æƒ³è§£æ±ºçš„å•é¡Œï¼Œæ•…éšœèˆ‡å›è¦†çš„æµç¨‹å¤§æ¦‚æ˜¯é€™æ¨£&lt;/p&gt;
&lt;ol start=&#34;0&#34;&gt;
&lt;li&gt;Redis Master failing&lt;/li&gt;
&lt;li&gt;Sentinels detect master failure&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;sentinel ç­‰å¾… down-after-millisecondsï¼Œè¶…éæ‰åˆ¤å®š master failure&lt;/li&gt;
&lt;li&gt;sentinel å½¼æ­¤å–å¾— quorumï¼Œæˆæ¬Šå…¶ä¸­ä¸€å° sentinel åŸ·è¡Œ failover&lt;/li&gt;
&lt;li&gt;sentinel æŒ‡æ´¾æ–°çš„ master&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;master æ•…éšœåŒæ™‚ï¼ŒHAProxy ä¹Ÿåµæ¸¬ master failure&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;HAProxy ç™¼ç¾æ²’æœ‰å¯ç”¨çš„ master&lt;/li&gt;
&lt;li&gt;tcp checklist å†æ¬¡åŸ·è¡Œæ™‚ï¼Œç”±æ–¼æ–°çš„ master å°šæœªé¸å‡ºä¾†ï¼Œä»æœƒé¡¯ç¤ºä¸‰å° server éƒ½é›¢ç·š&lt;/li&gt;
&lt;li&gt;ç›´åˆ° master é¸å‡ºï¼Œrole:master çš„ tcp check æœ‰å›æ‡‰å¾Œï¼Œæ‰æœƒå°‡å¾Œç«¯æ¥åˆ°æ–°çš„ master&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Client ç”±æ–¼ HAProxy æ²’æœ‰å¯ç”¨çš„ masterï¼Œæ‰€ä»¥é€£ç·šæ–·æ‰&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æŒçºŒä¸­æ–·åˆ° HAProxy å›å¾©&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šçš„å¹¾å€‹é‡è¦çš„åƒæ•¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;sentinel&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;down-after-milliseconds: æ–·ç·šå¤šä¹…æ‰æœƒè¦ºå¾— master æ­»äº†éœ€è¦ failoverï¼Œå¯ä»¥ç›¡é‡ç¸®çŸ­ï¼ŒåŠ é€Ÿ failure ç™¼ç”Ÿ failover çš„æ™‚é–“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;haproxy.cfg&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;server check inter 1s: å¤šä¹…è·‘ä¸€æ¬¡ tcp-check
&lt;ul&gt;
&lt;li&gt;è¶ŠçŸ­ï¼Œä¾¿èƒ½è¶Šæ—©æ¥å—åˆ° redis instance failure çš„ç™¼ç”Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾é€™å€‹ä¾‹å­ä¾†çœ‹ï¼Œé€™å€‹é…ç½®çš„ HA å…¶å¯¦é‚„æ˜¯æœ‰é›¢ç·šæ™‚é–“&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;down-after-milliseconds è¨­å®šç‚º 2s ï¼Œé‚£å¾ failure ç™¼ç”Ÿï¼Œåˆ° sentinel é–‹å§‹ failover çš„æ™‚é–“å°±æœƒè¶…é 2sï¼Œé€™å…©ç§’å®¢æˆ¶ç«¯ç„¡æ³•å¯«å…¥ã€‚&lt;/li&gt;
&lt;li&gt;äº‹å¯¦ä¸Šï¼Œé€™ä¹Ÿæ˜¯ redis master-slave çš„æ¨¡å¼çš„å•é¡Œï¼Œä¸¦ç„¡æ³•ç¢ºä¿ zero downtime&lt;/li&gt;
&lt;li&gt;èƒ½åšåˆ°çš„æ˜¯ç§’ç´šçš„ auto-recovery&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;sentinel-failure&#34;&gt;Sentinel Failure&lt;/h3&gt;
&lt;p&gt;é€™å€‹æ˜¯å¾ˆå¥½è§£æ±ºçš„éŒ¯èª¤ï¼Œå¦‚åŒæˆ‘å€‘åœ¨ topology é€™ç¯‡æåˆ°çš„ï¼ŒåŸå‰‡ä¸Šåªè¦èƒ½ç¶­æŒ quorum ä»¥ä¸Šçš„ sentinel æ­£å¸¸é‹ä½œï¼Œå°±å¯ä»¥å®¹å¿å¤šå€‹ sentinel çš„éŒ¯èª¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ 5 sentinelï¼Œquorum 3ï¼Œå°±å¯ä»¥å…è¨±å…©å€‹ sentinel éŒ¯èª¤
&lt;ul&gt;
&lt;li&gt;æœå‹™éƒ½æ­£å¸¸ zero downtime&lt;/li&gt;
&lt;li&gt;ç­‰å¾…éŒ¯èª¤çš„ sentinels å¾©åŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éŒ¯èª¤ä¸ä¸€å®šæ˜¯å…©å€‹ sentinel æ­»äº†ï¼Œå¯èƒ½æ˜¯ç¶²è·¯æ–·é–‹ï¼ŒæŠŠ 3 sentinels èˆ‡ 2 sentinels éš”é–‹ï¼Œç„¡æ³•æºé€šã€‚
&lt;ul&gt;
&lt;li&gt;é€™æ™‚ä¹Ÿä¸ç”¨æœƒæœ‰è¤‡æ•¸ failover ç”¢ç”Ÿï¼Œå› ç‚º quorum åªæœ‰ 3 sentinels çš„é€™ç«¯å¯ä»¥å–å¾—æˆæ¬Šï¼Œæ­£å¸¸åŸ·è¡Œ failover&lt;/li&gt;
&lt;li&gt;2 sentinels çš„é€™é‚Šåªæœƒéœå¾…ç¶²è·¯å›å¾©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;haproxy-failure&#34;&gt;HAProxy Failure&lt;/h3&gt;
&lt;p&gt;é€™å€‹åœ¨ kubernetes ä¸Šä¹Ÿæ˜¯å¾ˆå¥½è§£æ±º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;HAProxy ä¸ç”¨çŸ¥é“å½¼æ­¤ï¼Œåªè¦èƒ½å¤ ç›£æ¸¬å¾Œç«¯æœå‹™ï¼Œä¸¦ä¸” proxy request å³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆ‘å€‘å•Ÿå‹• HAProxy æ™‚æœƒä¸€æ¬¡å•Ÿå‹•å¤šå€‹ HAProxy&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HAProxy æ˜¯ç„¡ç‹€æ…‹çš„æœå‹™ï¼Œå¯ä»¥ç›´æ¥æ°´å¹³æ“´å±• (Horizontal Scale)&lt;/li&gt;
&lt;li&gt;ç®—æ˜¯æˆæœ¬çš„åœ°æ–¹ï¼Œå°±æ˜¯ HAProxy instance æœƒå„è‡ªå°å¾Œç«¯ redis åš tcp-checkï¼Œé »ç¹çš„ checkï¼Œé‚„æ˜¯æœƒæœ‰æˆæœ¬ï¼Œä½†ç›¸è¼ƒæ–¼ client request æ‡‰è©²æ˜¯æ¯”è¼ƒè¼•&lt;/li&gt;
&lt;li&gt;HAProxy æ˜¯é«˜æ•ˆèƒ½ï¼Œè€Œä¸”åªåš proxyï¼Œä¸€å¥”ä¾†èªªåªè¦ç¶­æŒæœ‰å¤šé¤˜çš„å‰¯æœ¬å‚™ç”¨å³å¯ï¼Œä¸ç”¨é–‹å¤ªå¤š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes æœƒè‡ªå‹•é€é stats portï¼Œå° HAPRoxy åš liveness checkï¼Œcheck å¤±æ•—å°±ä¸æœƒæŠŠæµé‡å°è¿‘ä¾†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HAproxy å‰ç«¯çš„ kubernetes service æœƒè‡ªå‹• load balance client åˆ°æ­£å¸¸é‹ä½œçš„ HAProxy ä¸Š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¾‹å¦‚èµ·äº† 3 HAProxy&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;3 HAProxy éƒ½å„è‡ªå‘ redis instance åš tcp-checkï¼Œæ¯ç§’ 3 * 3 çµ„ check&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¢æˆ¶ç«¯é€£å…¥ä»»ä¸€ HAProxyï¼Œéƒ½å¯ä»¥é€£å…¥æ­£ç¢ºçš„ master&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HAProxy åªè¦è‡³å°‘æœ‰ä¸€å€‹æ´»è‘—å°±å¯ä»¥ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ­» 2 å€‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes service æœƒè‡ªå‹•å°å‘æ´»è‘—çš„ HAProxy&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2 HAPRoxy å›å¾©çš„æ™‚å€™ï¼Œå°±æ˜¯ HAProxy é‡å•Ÿå¾Œé‡æ–°é–‹å§‹æœå‹™&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‹†åˆ†-read-write-client&#34;&gt;æ‹†åˆ† read write client&lt;/h1&gt;
&lt;p&gt;ç”±æ–¼æ•ˆèƒ½ç“¶é ¸é‚„æ˜¯åœ¨ redis masterï¼Œç‚ºäº†èƒ½æ”¯æ’å¤ å¤š clientï¼Œæœ€å¥½æŠŠ client éœ€è¦è®€å¯«çš„æ‹†åˆ†é–‹ä¾†&lt;/p&gt;
&lt;p&gt;HAProxy çš„è¨­å®šï¼Œå°±æœƒéœ€è¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠŠ frontend redis_gate æ‹†æˆ
&lt;ul&gt;
&lt;li&gt;redis_slaves_gate: æ¥æ”¶è®€å–çš„ client&lt;/li&gt;
&lt;li&gt;redis_master_gate: æ¥æ”¶å¯«å…¥çš„ client&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æŠŠ redis_servers æ‹†æˆ
&lt;ul&gt;
&lt;li&gt;redis_slaves: æ›´æ”¹ tcp-check å»æ‰¾ role:slave çš„ redisï¼Œæ‡‰è©²æœ‰å…©å°&lt;/li&gt;
&lt;li&gt;redis_master: ç¶­æŒæ‰¾å°‹ role:master çš„ redis&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™æ¨£å¯ä»¥è¼•æ˜“åœ°é€é scale slave ä¾†æ“´å¤§è®€å–çš„æµé‡å¸¶å¯¬&lt;/p&gt;
&lt;h1 id=&#34;redis-cluster&#34;&gt;Redis Cluster&lt;/h1&gt;
&lt;p&gt;Intro çš„æ™‚å€™æœ‰æåˆ°ï¼Œredis cluster æ˜¯å¦ä¸€å€‹é¢å‘çš„ redis solutionã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href=&#34;https://redis.io/topics/cluster-tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redis cluster&lt;/a&gt; å°‡è³‡æ–™åš shardingï¼Œåˆ†æ•£åˆ°ä¸åŒç¾¤çµ„å…§ï¼Œpartitions ç”±è¤‡æ•¸çš„ master ä¾†å­˜å–&lt;/p&gt;
&lt;p&gt;é€™éƒ¨ä»½æˆ‘å€‘ä¸‹å›å¾…çºŒ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Redis Ha HAProxy</title>
      <link>https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/</link>
      <pubDate>Wed, 02 Oct 2019 16:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸Šéƒ¨ç½² Redis HA (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/&#34;&gt;ä½¿ç”¨ helm éƒ¨ç½² redis-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/&#34;&gt;Redis HA with sentinel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/&#34;&gt;Redis sentinel topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/&#34;&gt;Redis HA with HAproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/&#34;&gt;Redis HA Failure Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;HAProxy Introduction&lt;/li&gt;
&lt;li&gt;Redis Sentinel with HAProxy&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;haproxy-intro&#34;&gt;HAProxy Intro&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;http://www.haproxy.org/#docs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAproxy&lt;/a&gt; å…¨åæ˜¯ High Availability Proxyï¼Œæ˜¯ä¸€æ¬¾é–‹æº TCP/HTTP load balancerï¼Œä»–å¯ä»¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è½ tcp socketï¼Œé€£ serverï¼Œç„¶å¾ŒæŠŠ socket æ¥åœ¨ä¸€èµ·è®“é›™å‘æµé€š&lt;/li&gt;
&lt;li&gt;å¯åš Http reverse-proxy (Http gateway)ï¼Œè‡ªå·±ä½œç‚ºä»£ç† serverï¼ŒæŠŠæ¥å—åˆ°çš„ connection å‚³åˆ°å¾Œç«¯çš„ serverã€‚&lt;/li&gt;
&lt;li&gt;SSL çµ‚ç«¯ï¼Œå¯æ”¯æ´ client-side èˆ‡ server-side çš„ ssl/tls&lt;/li&gt;
&lt;li&gt;ç•¶ tcp/http normalizer&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ http çš„ request èˆ‡ response&lt;/li&gt;
&lt;li&gt;ç•¶ switchï¼Œæ±ºå®š request å¾Œé€çš„ç›®æ¨™&lt;/li&gt;
&lt;li&gt;åš load balancerï¼Œç‚ºå¾Œç«¯ server åšè² è¼‰å‡è¡¡&lt;/li&gt;
&lt;li&gt;èª¿ç¯€æµé‡ï¼Œè¨­å®š rate limitï¼Œæˆ–æ˜¯æ ¹æ“šå…§å®¹èª¿æ•´æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HAProxy é‚„æœ‰å…¶ä»–éå¸¸å¤šçš„åŠŸèƒ½ï¼Œæƒ³äº†è§£ç´°ç¯€å¯ä»¥ä¾†çœ‹&lt;a href=&#34;http://cbonte.github.io/haproxy-dconv/1.9/intro.html#3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸç†è§£èªªæ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;topology&#34;&gt;Topology&lt;/h1&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©çš„ç¯„ä¾‹æ˜¯åœ¨å¾Œç«¯çš„ redis èˆ‡ clients ä¸­é–“å¤šæ”¾ä¸€å±¤ HAProxys&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   +-------+   +--------+    +------------+    +---------+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   |Clients|---|HAProxys|----|redis master|----|sentinels|
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   +-------+   +--------+    +------------+    +---------+
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯èƒ½æœ‰äººæœƒå•èªªï¼Œé‚£å‰å…©å¤©è¬›çš„ redis sentinelï¼Œè·‘å»å“ªè£¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;sentinel é‚„åœ¨æ­£å¸¸é‹ä½œï¼Œè² è²¬ç›£æ¸¬ redis ç‹€æ…‹èˆ‡ failoverï¼Œåªæ˜¯ client ä¸å†é€é sentinel å»å–å¾— masterï¼Œè€Œæ˜¯é€é HAProxyã€‚&lt;/p&gt;
&lt;h1 id=&#34;deploy-haproxy&#34;&gt;Deploy HAProxy&lt;/h1&gt;
&lt;p&gt;æˆ‘æŠŠæˆ‘çš„å¯¶è—éƒ½åœ¨é€™äº†&lt;a href=&#34;https://github.com/chechiachang/haproxy-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/haproxy-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰ä¸‹ä¾†çš„ .sh ï¼Œè·‘ä¹‹å‰é¤Šæˆç¿’æ…£è²“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat install.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# redis-db-credentials should already exists&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#kubectl create secret generic redis-db-credentials \&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   --from-literal&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REDIS_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;123456&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Update haproxy.cfg as configmap&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create configmap haproxy-config &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --from-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;haproxy.cfg &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --output yaml &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --dry-run &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šåšçš„äº‹æƒ…æœ‰å¹¾ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å–å¾— redis çš„ auth REDIS_PASSWORD æ”¾åœ¨ secret ä¸­ï¼Œå¦‚æœå‰é¢æ˜¯ç…§æˆ‘å€‘çš„ç¯„ä¾‹ï¼Œé‚£éƒ½å·²ç¶“è¨­å®šäº†&lt;/li&gt;
&lt;li&gt;æŠŠ haproxy.cfg çš„è¨­å®šæª”ï¼Œä½¿ç”¨ configmap çš„æ–¹å¼æ”¾åˆ° kubernetes ä¸Š&lt;/li&gt;
&lt;li&gt;éƒ¨å±¬ HAProxy deployment&lt;/li&gt;
&lt;li&gt;éƒ¨å±¬ HAProxy service&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç°¡å–®çœ‹ä¸€ä¸‹ deployment&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: apps/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Deployment
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  replicas: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  template:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      labels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        app: haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        app.kubernetes.io/name: haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        component: haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      volumes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - name: haproxy-config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        configMap:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          name: haproxy-config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      affinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        podAntiAffinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          preferredDuringSchedulingIgnoredDuringExecution:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          - weight: 100
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            podAffinityTerm:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              labelSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                matchExpressions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                - key: &amp;#34;app&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  operator: &amp;#34;In&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  values:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  - &amp;#34;haproxy&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              topologyKey: kubernetes.io/hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      containers:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - name: haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        image: haproxy:2.0.3-alpine
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        command: [&amp;#34;haproxy&amp;#34;, &amp;#34;-f&amp;#34;, &amp;#34;/usr/local/etc/haproxy/config/haproxy.cfg&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        readinessProbe:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          initialDelaySeconds: 15
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          periodSeconds: 5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          timeoutSeconds: 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          successThreshold: 2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          failureThreshold: 2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          tcpSocket:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            port: 26999
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            port: 6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - name: haproxy-config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          mountPath: /usr/local/etc/haproxy/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        resources:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          requests:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            cpu: 10m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            memory: 30Mi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        env:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - name: REDIS_PASSWORD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          valueFrom:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            secretKeyRef:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              name: redis-db-credentials
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              key: REDIS_PASSWORD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ports:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - containerPort: 8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          name: http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - containerPort: 9000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          name: https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - containerPort: 26999
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          name: stats
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        - containerPort: 6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          name: redis
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Replicas: 3 ï¼Œé–‹èµ·ä¾†æ˜¯ä¸‰å€‹ HAProxy&lt;/li&gt;
&lt;li&gt;podAntiAffinityï¼Œä¸‰å€‹åˆ†å¸ƒåˆ°ä¸åŒ node ä¸Šï¼Œç›¡é‡ç¶­æŒ HA&lt;/li&gt;
&lt;li&gt;readinessProbeï¼Œç­‰ tcpSocket 26999 (HAProxy Stats) èˆ‡ 6370 (Redis Proxy) é€šäº†æ‰ READY&lt;/li&gt;
&lt;li&gt;æŠŠ redis password æ›é€²å»&lt;/li&gt;
&lt;li&gt;æŠŠ haproxy.cfg æ›é€²å»&lt;/li&gt;
&lt;li&gt;é–‹å¹¾å€‹ port&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹ service&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: haproxy-service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  sessionAffinity: ClientIP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  sessionAffinityConfig:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    clientIP:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      timeoutSeconds: 10800 # 3 hr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  selector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    app: haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ports:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - name: http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protocol: TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: 8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - name: https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protocol: TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: 9000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - name: stats
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protocol: TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: 26999
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - name: redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protocol: TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: 6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - name: redis-exporter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protocol: TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: 8404
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;å¾ˆå–®ç´”ï¼Œå°±æ˜¯æŠŠå¹¾å€‹ port æ¥å‡ºä¾†&lt;/li&gt;
&lt;li&gt;æŠŠ sessionAffinity é–‹èµ·ä¾†
&lt;ul&gt;
&lt;li&gt;é€™é‚Šå¸Œæœ›ä¾†è‡ªç›¸åŒ clientIP (kubernetes å…§éƒ¨ app clients) çš„ session èƒ½æŒçºŒèµ°åŒä¸€å€‹ server&lt;/li&gt;
&lt;li&gt;å¯ä»¥é™ä½é€²åˆ° service å¾€å¾Œé€åˆ°ä¸€ç›´é‡é€£æµªè²»è³‡æº&lt;/li&gt;
&lt;li&gt;ä½†ä¸€ç›´é€£è‘—ä¹Ÿä¸å¥½ï¼Œå¯èƒ½æœƒ connection not closed ä¸€ç›´ä½”è‘—&lt;/li&gt;
&lt;li&gt;HAProxy1 HAProxy2 HAProxy3ï¼Œä¸Šæ¬¡ Client1 é€£ HAProxy1ï¼Œservice ä¹Ÿç›¡é‡è®“ä½ ä¸‹å€‹ request ä¹Ÿèµ° HAPRoxy1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get po | grep haproxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;haproxy-56d94f857f-gmd4s                                 1/1     Running     0          47d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;haproxy-56d94f857f-p2vj6                                 1/1     Running     0          47d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;haproxy-56d94f857f-vhz8b                                 1/1     Running     0          47d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;haproxy-config&#34;&gt;HAProxy Config&lt;/h1&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹ haproxy.cfg&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# https://cbonte.github.io/haproxy-dconv/2.0/configuration.html
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# https://github.com/prometheus/haproxy_exporter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# https://www.haproxy.com/blog/haproxy-exposes-a-prometheus-metrics-endpoint/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# curl http://localhost:8404/metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# curl http://localhost:8404/stats
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;frontend stats
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; mode http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; timeout client 30s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; bind *:8404
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; option http-use-htx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; http-request use-service prometheus-exporter if { path /metrics }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; stats enable
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; stats uri /stats
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; stats refresh 10s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;frontend redis_gate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; mode tcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; timeout client 7d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; bind 0.0.0.0:6379 name redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; default_backend redis_servers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;backend redis_servers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; mode tcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; timeout connect 3s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; timeout server 7d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; option tcp-check
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check connect
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check send AUTH\ &amp;#34;${REDIS_PASSWORD}&amp;#34;\r\n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check send PING\r\n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check expect string PONG
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check send info\ replication\r\n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check expect string role:master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check send QUIT\r\n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tcp-check expect string +OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; server R1 redis-2-redis-ha-announce-0:6379 check inter 1s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; server R2 redis-2-redis-ha-announce-1:6379 check inter 1s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; server R3 redis-2-redis-ha-announce-2:6379 check inter 1s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;å…©å€‹ frontendï¼Œåƒå‰ç«¯ (client) ä¾†çš„ request
&lt;ul&gt;
&lt;li&gt;frontend stats æ˜¯ HAProxy æœ¬èº«æœå‹™çš„ stats
&lt;ul&gt;
&lt;li&gt;æŠŠ prometheus-exporter é–‹èµ·ä¾†ï¼Œè®“ prometheus é€²ä¾† scrape metrics&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;frontend redis_gate æ˜¯ç”¨ä¾†æœå‹™ redis client
&lt;ul&gt;
&lt;li&gt;é‚è¼¯å¾ˆç°¡å–®ï¼Œé€²ä¾†çš„ request å¾€æœ‰æ•ˆçš„ backend redis_server é€ï¼Œé€™é‚Šçš„æœ‰æ•ˆæŒ‡çš„æ˜¯ redis master&lt;/li&gt;
&lt;li&gt;timeout 7dï¼Œå› ç‚ºæˆ‘å€‘çš„æœå‹™æœ‰é•·æ™‚é–“ä¸é–“æ–·çš„ pubsubï¼Œå¯ä»¥è¦–éœ€æ±‚èª¿æ•´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸€å€‹ backendï¼ŒHAProxy æœƒç¶­è­·ä¸¦ç›£æ¸¬ç‹€æ…‹ï¼Œç„¶å¾ŒæŠŠ frontend proxy éå»
&lt;ul&gt;
&lt;li&gt;mode tcpï¼Œä½¿ç”¨ tcp å» probe&lt;/li&gt;
&lt;li&gt;option tcp-checkï¼Œä¸‹é¢æ˜¯ä¸€ä¸² tcp checklistï¼Œé…åˆ redis çš„ tcp auth protocol å»å–å¾—
&lt;ul&gt;
&lt;li&gt;tcp connect é€£ä¸Š&lt;/li&gt;
&lt;li&gt;send AUTH å¯†ç¢¼ åˆ° redis&lt;/li&gt;
&lt;li&gt;send pingï¼Œredis è¦å› pong&lt;/li&gt;
&lt;li&gt;send info replication ç›´æ¥æ‰“ redis tcp info API&lt;/li&gt;
&lt;li&gt;é æœŸ string å…§æœ‰ role:master æ„æ€æ˜¯é€™å° redis æ˜¯ master&lt;/li&gt;
&lt;li&gt;é€€å‡ºï¼Œredis è¦å› ok&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;server æœ‰ä¸‰å°ï¼Œé€é redis å„è‡ªçš„ ha-announce service å»æ‰“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HAProxy æœƒç¶­è­· backend çš„ proxy statsï¼Œæ‰¾åˆ°ä¸‰å° redis ä¸­ï¼Œæ˜¯ master çš„é€™å°&lt;/p&gt;
&lt;p&gt;Running Log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -f haproxy-123-123456789
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[WARNING] 273/153936 (1) : Server redis_servers/R2 is DOWN, reason: Layer7 timeout, info: &amp;#34; at step 6 of tcp-check (expect string &amp;#39;role:master&amp;#39;)&amp;#34;, check duration: 1000ms. 2 active and 0 backup servers left. 0 sessions active, 0 requeued, 0 remaining in queue.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[WARNING] 273/153937 (1) : Server redis_servers/R3 is DOWN, reason: Layer7 timeout, info: &amp;#34; at step 6 of tcp-check (expect string &amp;#39;role:master&amp;#39;)&amp;#34;, check duration: 1001ms. 1 active and 0 backup servers left. 0 sessions active, 0 requeued, 0 remaining in queue.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;HAProxy å» redis å•ï¼Œä½ æ˜¯ master å—ï¼Œå…©å€‹äººå›ä¸æ˜¯ï¼Œåªæœ‰ä¸€å€‹å› role:masterï¼Œæ‰€ä»¥æŠŠ client å°éå»&lt;/p&gt;
&lt;h1 id=&#34;haproxy-vs-sentinel&#34;&gt;HAProxy vs Sentinel&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Client ä¸ç”¨çŸ¥é“ä¸­é–“çš„ proxyï¼Œåªè¦çŸ¥é“é€é HAproxy service å°±æœƒè¢« proxy åˆ° master&lt;/li&gt;
&lt;li&gt;HAproxy æ˜¯ statelessï¼Œéå¸¸å¥½ scale&lt;/li&gt;
&lt;li&gt;Client ä¸ç”¨æ”¯æ´ sentinelï¼Œåªè¦ä¸€èˆ¬çš„ redis-cli å°±å¯ä»¥é€£å…¥&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Redis Ha Topology</title>
      <link>https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/</link>
      <pubDate>Mon, 30 Sep 2019 16:12:10 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸Šéƒ¨ç½² Redis HA (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/&#34;&gt;ä½¿ç”¨ helm éƒ¨ç½² redis-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/&#34;&gt;Redis HA with sentinel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/&#34;&gt;Redis sentinel topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/&#34;&gt;Redis HA with HAproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/&#34;&gt;Redis HA Failure Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Redis Sentinel Topology&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;topology&#34;&gt;Topology&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Masters: M1, M2, M3, &amp;hellip;, Mn.&lt;/li&gt;
&lt;li&gt;Slaves: R1, R2, R3, &amp;hellip;, Rn (R stands for replica).&lt;/li&gt;
&lt;li&gt;Sentinels: S1, S2, S3, &amp;hellip;, Sn.&lt;/li&gt;
&lt;li&gt;Clients: C1, C2, C3, &amp;hellip;, Cn.&lt;/li&gt;
&lt;li&gt;æ¯å€‹æ–¹æ ¼ä»£è¡¨ä¸€å°æ©Ÿå™¨æˆ–æ˜¯ VM&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-sentinels&#34;&gt;2 Sentinels&lt;/h3&gt;
&lt;p&gt;DON&amp;rsquo;T DO THIS&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+----+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| M1 |---------| R1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| S1 |         | S2 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+----+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Configuration: quorum = 1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™å€‹è¨­å®šä¸‹ï¼Œå¦‚æœ M1 æ›äº†éœ€è¦ failoverï¼Œå¾ˆæœ‰å¯èƒ½ S1 è·Ÿè‘—æ©Ÿå™¨ä¸€èµ·æ›äº†ï¼ŒS2 æœƒæ²’æœ‰è¾¦æ³•å–å¾—å¤šæ•¸ä¾†åŸ·è¡Œ failoverï¼Œæ•´å€‹ç³»çµ±æ›æ‰&lt;/p&gt;
&lt;h3 id=&#34;3-vm&#34;&gt;3 VM&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       | M1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       | S1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+----+    |    +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| R2 |----+----| R3 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| S2 |         | S3 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+----+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Configuration: quorum = 2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ˜¯æœ€åŸºæœ¬çš„è›‹åˆå…¼é¡§å®‰å…¨è¨­å®šçš„è¨­ç½®&lt;/p&gt;
&lt;p&gt;å¦‚æœ M1 æ­»äº† S1 è·Ÿè‘—æ©Ÿå™¨æ•…éšœï¼ŒS2 èˆ‡ S3 é‚„å¯ä»¥å–å¾—å¤šæ•¸ï¼Œé †åˆ© failover åˆ° R2 æˆ–æ˜¯ R3ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯«å…¥è³‡æ–™éºå¤±&#34;&gt;å¯«å…¥è³‡æ–™éºå¤±&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         | M1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         | S1 | &amp;lt;- C1 (writes will be lost)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+------+    |    +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| [M2] |----+----| R3 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;| S2   |         | S3 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+------+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;failover ä¹‹å‰ï¼ŒM1 æ˜¯ masterï¼ŒClient çš„å¯«å…¥å¾€ M1 å¯«&lt;/li&gt;
&lt;li&gt;M1 ç¶²è·¯æ•…éšœï¼ŒM2 failover å¾Œæˆç‚ºæ–°çš„ masterï¼Œå¯æ˜¯ Client å¾€ M1 å¯«å…¥çš„è³‡æ–™ä¸¦ç„¡æ³• sync å› M2&lt;/li&gt;
&lt;li&gt;ç­‰ç¶²è·¯ä¿®å¾©å¾Œï¼ŒM1 å›è¦†å¾Œæœƒè®Šæˆ R1 è®Šæˆ slaveï¼Œç”± M2 å» sync R1ï¼Œè®Šæˆ R1 åœ¨ master æ™‚æ”¶åˆ°çš„å¯«å…¥è³‡æ–™éºå¤±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç‚ºäº†é¿å…é€™ç¨®æƒ…å½¢ï¼Œåšé¡å¤–çš„è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;min-slaves-to-write 1&lt;/li&gt;
&lt;li&gt;min-slaves-max-lag 10&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç•¶ master ç™¼ç¾è‡ªå·±å†ä¹Ÿç„¡æ³• sync åˆ°è¶³å¤ çš„ slaveï¼Œè¡¨ç¤º master å¯èƒ½è¢«å­¤ç«‹ï¼Œé€™æ™‚ä¸»å‹•æ‹’çµ•å®¢æˆ¶ç«¯çš„å¯«å…¥è«‹æ±‚ã€‚å®¢æˆ¶ç«¯è¢«æ‹’çµ•å¾Œï¼Œæœƒå†å‘ sentinel å–å¾—æœ‰æ•ˆçš„ masterï¼Œé‡æ–°åŸ·è¡Œå¯«å…¥è«‹æ±‚ï¼Œç¢ºä¿è³‡æ–™å¯«åˆ°æœ‰æ•ˆçš„ master ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;sentinel-æ”¾åœ¨-client-ç«¯&#34;&gt;Sentinel æ”¾åœ¨ Client ç«¯&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | M1 |----+----| R1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            |    |    |    |    |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+    |    +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         +------------+------------+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         |            |            |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         |            |            |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      +----+        +----+      +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      | C1 |        | C2 |      | C3 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      | S1 |        | S2 |      | S3 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      +----+        +----+      +----+
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº›æƒ…å½¢ï¼Œredis é€™ç«¯åªæœ‰å…©å°å¯ç”¨æ©Ÿå™¨ï¼Œé€™ç¨®æƒ…å½¢å¯ä»¥è€ƒæ…®æŠŠ sentinel æ”¾åœ¨å®¢æˆ¶ç«¯çš„æ©Ÿå™¨ä¸Š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»ç„¶ç¶­æŒäº†ç¨ç«‹çš„ 3 sentinels çš„ç©©å®š&lt;/li&gt;
&lt;li&gt;sentinel èˆ‡ client æ‰€è§€å¯Ÿåˆ°çš„ redis ç‹€æ…‹æ˜¯ç›¸åŒçš„&lt;/li&gt;
&lt;li&gt;å¦‚æœ M1 æ­»äº†ï¼Œè¦ failover ï¼Œå®¢æˆ¶ç«¯çš„ 3 sentinel å¯ä»¥æ­£ç¢ºåœ°åŸ·è¡Œ failoverï¼Œä¸å—æ•…éšœå½±éŸ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å®¢æˆ¶ç«¯åˆä¸è¶³-3-å€‹&#34;&gt;å®¢æˆ¶ç«¯åˆä¸è¶³ 3 å€‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | M1 |----+----| R1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | S1 |    |    | S2 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+    |    +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               +------+-----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               |            |  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               |            |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+        +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | C1 |        | C2 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | S3 |        | S4 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+        +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Configuration: quorum = 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+         +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | M1 |----+----| R1 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            | S1 |    |    | S2 |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            +----+    |    +----+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      |        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      |        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   +----+      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   | C1 |      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   | S3 |      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   +----+      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Configuration: quorum = 2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;è·Ÿä¸Šå€‹ä¾‹å­é¡ä¼¼ï¼Œä½†åˆé¡å¤–ç¢ºä¿ 3 sentinels&lt;/li&gt;
&lt;li&gt;å¦‚æœ M1 æ­»äº†ï¼Œå‰©ä¸‹çš„ sentinel å¯ä»¥æ­£ç¢º failover&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Redis Ha Sentinel</title>
      <link>https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/</link>
      <pubDate>Sun, 29 Sep 2019 17:14:38 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸Šéƒ¨ç½² Redis HA (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/&#34;&gt;ä½¿ç”¨ helm éƒ¨ç½² redis-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/&#34;&gt;Redis HA with sentinel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/&#34;&gt;Redis sentinel topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/&#34;&gt;Redis HA with HAproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/&#34;&gt;Redis HA Failure Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;redis-sentinel&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;redis sentinel èˆ‡ redis ä½¿ç”¨ç›¸å®¹çš„ apiï¼Œç›´æ¥ä½¿ç”¨ redis-cli é€é 26479 port é€£å…¥ï¼Œå¯ä»¥é€£åˆ° sentinelï¼Œé€é sentinel å¯ä»¥å–å¾— redis master çš„ç‹€æ…‹èˆ‡é€£ç·šè¨­å®šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha -p 26479
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šç¯‡æˆ‘å€‘çš„ redis-ha å®‰è£å®Œè®Šé€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po | grep redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                                     READY   STATUS      RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-1-redis-ha-server-0                                3/3     Running     0          3d4h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-1-redis-ha-server-1                                3/3     Running     0          3d5h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-1-redis-ha-server-2                                3/3     Running     0          3d4h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ä¸‰å€‹ Podï¼Œè£¡é¢éƒ½æ˜¯ä¸€å€‹ redis, sentinel, è·Ÿ exporterï¼Œé€™ç¯‡æ–‡ç« æœƒå°ˆæ³¨è¬› sentinel çš„åŠŸèƒ½èˆ‡æ©Ÿåˆ¶&lt;/p&gt;
&lt;h1 id=&#34;redis-sentinel&#34;&gt;Redis Sentinel&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://redis.io/topics/sentinel&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redis-sentinel&lt;/a&gt; ç‚º Redis æä¾›é«˜å¯ç”¨æœå‹™ï¼Œå¯¦å‹™ä¸Šå¯ä»¥é€é sentinel åœ¨éŒ¯èª¤ç™¼ç”Ÿæ™‚ï¼Œè‡ªå‹•é€²è¡Œ failoverã€‚é™¤æ­¤ä¹‹å¤– sentinel ä¹Ÿæä¾›ç›£æ¸¬ï¼Œé€šçŸ¥ï¼Œèˆ‡ redis çš„è¨­å®šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Monitoring: æŒçºŒæª¢æ¸¬ master èˆ‡ slave instances çš„ç‹€æ…‹&lt;/li&gt;
&lt;li&gt;Notification: æœ‰äº‹ä»¶ç™¼ç”Ÿå¯ä»¥ç™¼å‡ºé€šçŸ¥&lt;/li&gt;
&lt;li&gt;Automatic failover: å¦‚æœ master å¤±æ•ˆè‡ªå‹•å•Ÿå‹• failover ç¨‹åºï¼Œå°‡ä¸€å€‹ slave æŒ‡æ’ç‚º masterï¼Œä¸¦è¨­å®šå…¶ä»– slave ä½¿ç”¨æ–°çš„ master&lt;/li&gt;
&lt;li&gt;Configuration provider: ç‚ºå®¢æˆ¶ç«¯æä¾› service discoveryï¼Œå®¢æˆ¶å¯ä»¥é€šé sentinel å–å¾— master çš„é€£ç·šè³‡æ–™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;distributed&#34;&gt;Distributed&lt;/h1&gt;
&lt;p&gt;Sentinel æœ¬èº«æ˜¯ä¸€å€‹åˆ†æ•£å¼ç³»çµ±ï¼Œå¦‚æˆ‘å€‘çš„ç¯„ä¾‹æ‰€ç¤ºï¼Œä¸‰å€‹ Pod ç«‹é¢å€‹å«æœ‰ä¸€å€‹ sentinelï¼Œçµ„æˆ 3 å€‹ instace çš„ sentinel clusterã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éŒ¯èª¤æª¢æ¸¬æ˜¯ç”±å¤šå€‹ sentinel åˆ¤å®šï¼Œè¦æœ‰å¤šå€‹ sentinel éƒ½æ¥æ”¶ master å·²å¤±æ•ˆçš„è¨Šæ¯ï¼Œæ‰æœƒåˆ¤å®šæˆå¤±æ•ˆã€‚é€™æ¨£å¯ä»¥é™ä½ false positive çš„æ©Ÿç‡ã€‚&lt;/li&gt;
&lt;li&gt;åˆ†æ•£è®“ sentinel æœ¬èº«ä¹Ÿå…·å‚™é«˜å¯ç”¨æ€§ï¼Œå¯ä»¥æ‰¿å—ä¸€å®šç¨‹åº¦çš„éŒ¯èª¤ã€‚ç”¨ä¾† fail over çš„ç³»çµ±ï¼Œä¸èƒ½å› ç‚ºè‡ªèº«çš„å–®é»éŒ¯èª¤(single point failure) è€Œå€’æ˜¯æ•´å€‹ redis å¤±æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;fundamental&#34;&gt;Fundamental&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹è€ç”¨çš„ sentinel éœ€è¦è‡³å°‘ä¸‰å€‹ instance&lt;/li&gt;
&lt;li&gt;æœ€å¥½æŠŠ instance åˆ†æ•£åœ¨å¤šå€‹ç¨ç«‹çš„éš”é›¢å€åŸŸï¼Œæ„æ€æ˜¯èªªï¼Œä¸‰å€‹ä¸æœƒæ”¾åœ¨åŒä¸€å°æ©Ÿå™¨ä¸Šï¼Œæˆ–æ˜¯æ”¾åœ¨åŒä¸€å€‹å€åŸŸå…§ï¼Œå› ç‚ºä¸€å€‹å€åŸŸç¶²è·¯æ•…éšœå°±å…¨æ­»ã€‚&lt;/li&gt;
&lt;li&gt;app ä½¿ç”¨ sentinel çš„è©±ï¼Œå®¢æˆ¶ç«¯è¦æ”¯æ´&lt;/li&gt;
&lt;li&gt;æœ‰æ™‚å¸¸æ¸¬è©¦çš„ HA ç’°å¢ƒï¼Œæ‰æ˜¯æœ‰æ•ˆçš„ HA&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;configuration&#34;&gt;Configuration&lt;/h1&gt;
&lt;h2 id=&#34;sentinel-specific-configuration-options&#34;&gt;Sentinel specific configuration options&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸Šç¯‡æˆ‘å€‘è·³é sentinel çš„è¨­å®šï¼Œé€™é‚Šèªªæ˜ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sentinel:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  port: 26379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  quorum: 2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  config:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Additional sentinel conf options can be added below. Only options that
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## are expressed in the format simialar to &amp;#39;sentinel xxx mymaster xxx&amp;#39; will
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## be properly templated.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## For available options see http://download.redis.io/redis-stable/sentinel.conf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    down-after-milliseconds: 10000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ## Failover timeout value in milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    failover-timeout: 180000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    parallel-syncs: 5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## Custom sentinel.conf files used to override default settings. If this file is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## specified then the sentinel.config above will be ignored.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # customConfig: |-
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      # Define configuration here
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  resources: {}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #  requests:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #    memory: 200Mi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #    cpu: 100m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #  limits:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  #    memory: 200Mi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;quorum&#34;&gt;Quorum&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;quorum æ˜¯æ¯æ¬¡ç¢ºå®š master å¤±æ•ˆæ™‚ï¼Œéœ€è¦é”æˆå…±è­˜çš„ sentinel æ•¸é‡ã€‚&lt;/li&gt;
&lt;li&gt;Quorum ä½¿ç”¨åœ¨éŒ¯èª¤æª¢æ¸¬ï¼Œç¢ºå®šéŒ¯èª¤çœŸçš„ç™¼ç”Ÿå¾Œï¼Œsentinel æœƒä»¥å¤šæ•¸æ±º(majority) çš„æ–¹å¼é¸å‡º sentinel leaderï¼Œè®“ leader è™•ç† failoverã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥æˆ‘å€‘çš„ä¾‹å­ç‚ºä¾‹ï¼Œç¸½å…±ä¸‰å€‹ï¼Œç¢ºèª master æ­»æ‰åªè¦å…©å€‹ sentinel é”æˆå…±è­˜å³å¯å•Ÿå‹• failover ç¨‹åºã€‚å¯ä»¥ç›´æ¥æ¸¬è©¦ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -f redis-1-redis-ha-server-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete po redis-1-redis-ha-server-1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;log ä¸€å€‹ Pod ï¼Œç„¶å¾Œç›´æ¥æŠŠå¦ä¸€å€‹ Pod å¹¹æ‰ é€™æ¨£æœƒæœ‰ 1/3 çš„æ©Ÿç‡ç åˆ° masterï¼Œç ä¸­çš„è©±å¯ä»¥çœ‹åˆ° redis failover ï¼Œé¸å‡ºæ–°çš„ master çš„éç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šè¦æ³¨æ„ï¼Œç”±æ–¼æˆ‘å€‘çš„ sentinel èˆ‡ redis æ˜¯æ”¾åœ¨åŒæ¨£ä¸€å€‹ Podï¼Œå¹¹æ‰çš„åŒæ™‚ä¹Ÿæ®ºäº†ä¸€å€‹ sentinelï¼Œåªå‰© 2 å€‹ï¼Œå‰›å¥½é”æˆå…±è­˜ã€‚å¦‚æœ quorum æ˜¯ä¸‰ï¼Œå°±è¦ç­‰ç¬¬ä¸‰å€‹ sentinel å›ä¾†æ‰èƒ½å–å¾— quorumã€‚&lt;/p&gt;
&lt;p&gt;sentinel èˆ‡ redis çš„é…ç½®ä½ç½®ï¼Œä¹‹å¾Œçš„ topology æœƒè¨è«–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;configurations&#34;&gt;Configurations&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;down-after-milliseconds: è¶…éå¤šå°‘æ™‚é–“æ²’å›æ‡‰ ping æˆ–æ­£ç¢ºå›æ‡‰ï¼Œæ‰è¦ºå¾— master å£äº†&lt;/li&gt;
&lt;li&gt;parallel-syncs: failover æ™‚ï¼Œè¦é‡æ–°èˆ‡æ–° master sync çš„ slave æ•¸é‡ã€‚æ•¸é‡è¶Šå¤š sync æ™‚é–“å°±è¶Šä¹…ï¼Œæ•¸é‡å°‘å°±æœ‰è¼ƒå¤š slave æ²’ sync è³‡æ–™ï¼Œå¯èƒ½æœƒè®“ client read åˆ°èˆŠçš„è³‡æ–™
&lt;ul&gt;
&lt;li&gt;é›–ç„¶ sync æ˜¯ non-blockingÂ ï¼Œä½†åœ¨ sync å¤§ç­†è³‡æ–™æ™‚ï¼Œslave å¯èƒ½æœƒæ²’æœ‰å›æ‡‰ã€‚è¨­å®šç‚º 1 çš„è©±ï¼Œæœ€å¤šåªæœƒæœ‰ä¸€å€‹ slave ä¸‹ç·š syncã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›åƒæ•¸ä¹Ÿå¯ä»¥é€é redis-cli ç›´æ¥é€£å…¥æ›´æ”¹ï¼Œä½†æˆ‘å€‘æ˜¯åœ¨ kubernetes ä¸Šè·‘ï¼Œè‡¨æ™‚çš„æ›´æ”¹ä¸æ˜“ä¿å­˜ï¼Œæ‰€ä»¥ç›¡å¯èƒ½æŠŠé€™äº›configurations æ”¾åœ¨ configmap è£¡é¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;sentinel-command&#34;&gt;Sentinel command&lt;/h1&gt;
&lt;p&gt;6379 port é€£å…¥ redisï¼Œ26379 é€£å…¥ redis sentinelã€‚éƒ½æ˜¯ä½¿ç”¨ redis-cliï¼Œå…©è€…å…¼å®¹çš„ protocolã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ä½¿ç”¨ kubectl é€£å…¥ï¼Œå¤šå€‹ container è¦æ˜ç¢ºæŒ‡å‡ºé€£å…¥çš„ container
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it redis-1-redis-ha-server-0 --container redis sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha -p 26479
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# è¿‘ä¾†å…ˆ ping ä¸€ä¸‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ping
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PONG
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# åˆ—å‡ºæ‰€æœ‰ master çš„è³‡è¨Šï¼Œä»¥åŠè¨­å®šè³‡è¨Š
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sentinel master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-2-redis-ha:26379&amp;gt; sentinel masters
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1)  1) &amp;#34;name&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    2) &amp;#34;mymaster&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    3) &amp;#34;ip&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    4) &amp;#34;10.15.242.245&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    5) &amp;#34;port&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    6) &amp;#34;6379&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    7) &amp;#34;runid&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    8) &amp;#34;63a97460b7c3745577931dad406df9609c4e2464&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    9) &amp;#34;flags&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   10) &amp;#34;master&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   11) &amp;#34;link-pending-commands&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   12) &amp;#34;0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   13) &amp;#34;link-refcount&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   14) &amp;#34;1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   15) &amp;#34;last-ping-sent&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   16) &amp;#34;0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   17) &amp;#34;last-ok-ping-reply&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   18) &amp;#34;479&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   19) &amp;#34;last-ping-reply&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   20) &amp;#34;479&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   21) &amp;#34;down-after-milliseconds&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   22) &amp;#34;5000&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   23) &amp;#34;info-refresh&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   24) &amp;#34;5756&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   25) &amp;#34;role-reported&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   26) &amp;#34;master&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   27) &amp;#34;role-reported-time&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   28) &amp;#34;348144787&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   29) &amp;#34;config-epoch&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   30) &amp;#34;13&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   31) &amp;#34;num-slaves&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   32) &amp;#34;2&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   33) &amp;#34;num-other-sentinels&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   34) &amp;#34;2&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   35) &amp;#34;quorum&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   36) &amp;#34;2&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   37) &amp;#34;failover-timeout&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   38) &amp;#34;180000&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   39) &amp;#34;parallel-syncs&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   40) &amp;#34;5&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å–å¾—é›†ç¾¤ä¸­çš„ master è¨Šæ¯ï¼Œç›®å‰æœ‰ä¸€å€‹ master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sentinel master mymaster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å–å¾—é›†ç¾¤ä¸­çš„ slaves è¨Šæ¯ï¼Œç›®å‰æœ‰å…©å€‹ slave
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sentinel slaves mymaster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å–å¾—é›†ç¾¤ä¸­çš„ master è¨Šæ¯
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sentinel sentinels mymaster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# æª¢æŸ¥ sentinel çš„ quorum
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sentinel ckquorum mymaster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK 3 usable Sentinels. Quorum and failover authorization can be reached
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# å¼·è¿«è§¸ç™¼ä¸€æ¬¡ failover
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sentinel failover mymaster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;sentinel-connection&#34;&gt;Sentinel Connection&lt;/h1&gt;
&lt;p&gt;æœ‰æ”¯æ´çš„å®¢æˆ¶ç«¯è¨­å®šï¼Œä»¥&lt;a href=&#34;https://github.com/FZambia/sentinel/blob/master/sentinel.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Golang FZambia/sentinel&lt;/a&gt; ç‚ºä¾‹ï¼Œé€é sentinel å–å¾— redis-poolã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ä½¿ç”¨ç¨ç«‹çš„ pod service é€£å…¥ sentinelï¼Œå”åŠ©å½¼æ­¤è­˜åˆ¥
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sntnl := &amp;amp;sentinel.Sentinel{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	Addrs:      []string{&amp;#34;redis-2-redis-ha-announce-0:26379&amp;#34;, &amp;#34;redis-2-redis-ha-announce-0:26379&amp;#34;, &amp;#34;redis-2-redis-ha-announce-0:26379&amp;#34;},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	MasterName: &amp;#34;mymaster&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	Dial: func(addr string) (redis.Conn, error) {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		timeout := 500 * time.Millisecond
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		c, err := redis.DialTimeout(&amp;#34;tcp&amp;#34;, addr, timeout, timeout, timeout)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		if err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			return nil, err
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		return c, nil
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ç”¢ç”Ÿ connection pool
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;return &amp;amp;redis.Pool{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	MaxIdle:     3,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	MaxActive:   64,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	Wait:        true,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	IdleTimeout: 240 * time.Second,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	Dial: func() (redis.Conn, error) {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # é€é sentinel å–å¾— master addressï¼Œå¦‚æœ master æ­»äº†ï¼Œå†åŸ·è¡Œå¯ä»¥æ‹¿åˆ°æ–°çš„ master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		masterAddr, err := sntnl.MasterAddr()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		if err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			return nil, err
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		c, err := redis.Dial(&amp;#34;tcp&amp;#34;, masterAddr)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		if err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			return nil, err
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		return c, nil
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	TestOnBorrow: func(c redis.Conn, t time.Time) error {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		if !sentinel.TestRole(c, &amp;#34;master&amp;#34;) {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			return errors.New(&amp;#34;Role check failed&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		} else {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			return nil
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	},
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šè¦æ³¨æ„ï¼Œå®¢æˆ¶ç«¯ (golang) è™•ç† connection çš„ exceptionï¼Œè¦è¨˜å¾—é‡æ–°åŸ·è¡Œ sntnl.MasterAddr() ä¾†å–å¾— failover å¾Œæ–°æŒ‡æ´¾çš„ masterã€‚&lt;/p&gt;
&lt;h1 id=&#34;client-æ¸¬è©¦&#34;&gt;Client æ¸¬è©¦&lt;/h1&gt;
&lt;p&gt;å¯«ä¸€å€‹ golang redis çš„ client è·‘èµ·ä¾†ã€‚é€™å€‹éƒ¨åˆ†æˆ‘å€‘åœ¨ &lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafkaçš„ç« ç¯€&lt;/a&gt;åšéé¡ä¼¼çš„äº‹æƒ…ï¼Œå¯ä»¥ç°¡å–®æ¹Šä¸€å€‹ç©ç©ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å»¶ä¼¸å•é¡Œ&#34;&gt;å»¶ä¼¸å•é¡Œ&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢çš„ golang ç¯„ä¾‹ï¼Œç¢ºå¯¦æ˜¯èƒ½é€é sentinel å–å¾— masterï¼Œå†å‘ master å–å¾—é€£ç·šã€‚ä½†é€™é‚Šæœ‰å…©å€‹å•é¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ¶ç«¯éœ€è¦æ”¯æ´ sentinel&lt;/li&gt;
&lt;li&gt;å®¢æˆ¶ç«¯è¦æ„ŸçŸ¥ sentinel çš„ä½å€é€£ç·šï¼Œæ‰èƒ½çŸ¥é“æ‰€æœ‰ sentinel çš„ä½ç½®ï¼Œè¨­å®šåˆç”¢ç”Ÿè€¦åˆ
&lt;ul&gt;
&lt;li&gt;ä¸èƒ½å½ˆæ€§çš„èª¿åº¦ sentinelï¼Œå¦‚æœéœ€è¦å¢åŠ æˆ–æ˜¯æ¸›å°‘ sentinelï¼Œå®¢æˆ¶ç«¯éœ€è¦é‡æ–°è¨­å®š&lt;/li&gt;
&lt;li&gt;é›–ç„¶ sentinel æœ‰ HAï¼Œå¯æ˜¯å®¢æˆ¶ç«¯å° sentinel çš„è¨­å®šæ²’æœ‰ HAï¼Œè¬ä¸€å·²çŸ¥çš„æ‰€æœ‰ sentinel æ›äº†å°±å…¨æ›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰æ²’æœ‰æ›´å„ªé›…çš„æ–¹å¼ä½¿ç”¨ sentinelï¼Œæˆ‘å€‘ä¸‹ç¯‡æœƒè¨è«–ä½¿ç”¨ HAProxy ä¾†å®Œæˆ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Redis Ha Deployment</title>
      <link>https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/</link>
      <pubDate>Sat, 28 Sep 2019 15:14:23 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸Šéƒ¨ç½² Redis HA (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/&#34;&gt;ä½¿ç”¨ helm éƒ¨ç½² redis-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/&#34;&gt;Redis HA with sentinel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/&#34;&gt;Redis sentinel topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/&#34;&gt;Redis HA with HAproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/&#34;&gt;Redis HA Failure Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©çš„æ–‡æœƒæ¯”è¼ƒçŸ­ï¼Œå› ç‚ºæˆ‘æ—©ä¸Šåœ¨ç¶ å³¶å·²ç¶“æ°´è‚ºæ½›æ°´æ½›äº†ä¸‰è¶Ÿï¼Œæœ‰é»ç´¯å“ˆå“ˆ&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;redis-introduction&#34;&gt;Redis introduction&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://redis.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Redis&lt;/a&gt; æ˜¯å¸¸ç”¨çš„ in-memory çš„è³‡æ–™å„²å­˜åº«ï¼Œå¯ä½œç‚ºè³‡æ–™åº«ï¼Œå¿«å–ï¼Œmessage broker ä½¿ç”¨ï¼Œéƒ½éå¸¸å¥½ç”¨ã€‚Redis å®˜æ–¹æ”¯æ´ high availabilityï¼Œä½¿ç”¨çš„æ˜¯ &lt;a href=&#34;https://redis.io/topics/sentinel&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redis-sentinel&lt;/a&gt;
ï¼Œä»Šå¤©æˆ‘å€‘å°±ä¾†éƒ¨ç½²ä¸€å€‹æœ‰å®Œæ•´ sentinel çš„ redis-haã€‚&lt;/p&gt;
&lt;p&gt;Redis å¦å¤–æä¾›äº†ä¸€å€‹ solution &lt;a href=&#34;https://redis.io/topics/cluster-tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Redis cluster (multiple writer solution)&lt;/a&gt;ï¼Œä½œç‚ºå¢åŠ è³‡æ–™è¼¸å‡ºå¸¶å¯¬ï¼Œèˆ‡å¢åŠ è³‡æ–™è€ç”¨åº¦çš„åˆ†æ•£å¼è§£æ±ºæ–¹æ¡ˆï¼Œèˆ‡ redis sentinel  æ‰€è™•ç†çš„ ha å•é¡Œæ˜¯ä¸ç›¸åŒçš„ã€‚æœ‰æ©Ÿæœƒæˆ‘å€‘ä¹Ÿä¾†è«‡ã€‚&lt;/p&gt;
&lt;h1 id=&#34;deploy&#34;&gt;Deploy&lt;/h1&gt;
&lt;p&gt;æˆ‘æŠŠæˆ‘çš„å¯¶è—éƒ½åœ¨é€™äº†&lt;a href=&#34;https://github.com/chechiachang/go-redis-ha&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/go-redis-ha&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰ä¸‹ä¾†çš„ .sh ï¼Œè·‘ä¹‹å‰é¤Šæˆç¿’æ…£è²“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat install.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;redis-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Stable: chart version: redis-ha-3.6.1	app version: 5.0.5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; stable/redis-ha --version 3.6.1 -f values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;helm&#34;&gt;Helm&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç”¨ helm éƒ¨å±¬ï¼Œä¹‹æ‰€ä»¥ç”¨ helm ï¼Œå› ç‚ºé€™æ˜¯æˆ‘æƒ³åˆ°æœ€ç°¡å–®çš„æ–¹æ³•ï¼Œèƒ½è®“è¼•é¬†æ“æœ‰ä¸€å¥—åŠŸèƒ½å®Œæ•´çš„ kafkaã€‚æ‰€ä»¥æˆ‘å€‘å…ˆç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ²’ç”¨é helm çš„å¤§å¾·å¯ä»¥åƒè€ƒ &lt;a href=&#34;https://helm.sh/docs/using_helm/#quickstart&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm Quickstart&lt;/a&gt;ï¼Œå…ˆæŠŠ helm cli èˆ‡ kubernetes ä¸Šçš„ helm tiller éƒ½è¨­å®šå¥½&lt;/p&gt;
&lt;h3 id=&#34;redis-ha&#34;&gt;Redis-ha&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/redis-ha&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm chart github&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;install&#34;&gt;Install&lt;/h1&gt;
&lt;p&gt;é€™é‚Šæ˜¯ç”¨ upgrade &amp;ndash;installï¼Œå·²å®‰è£å°± upgradeï¼Œæ²’å®‰è£å°± installï¼Œä¹‹å¾Œå¯ä»¥ç”¨é€™å€‹æŒ‡ä»¤å‡ç‰ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install ${HELM_NAME} incubator/kafka --version 0.16.2 -f values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;values-staging&#34;&gt;values-staging&lt;/h3&gt;
&lt;p&gt;å®Œæ•´çš„ values.yaml åœ¨ &lt;a href=&#34;https://github.com/helm/charts/blob/master/stable/redis-ha/values.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm chart github&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;repository&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpine&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## replicas number for each component
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;serviceType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# [ClusterIP|LoadBalancer]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Redis password
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## Defaults to a random 10-character alphanumeric string if not set and auth is true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## ref: https://github.com/kubernetes/charts/blob/master/stable/redis-ha/templates/redis-auth-secret.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;##
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#redisPassword:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Use existing secret containing key `authKey` (ignores redisPassword)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;existingSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Defines the key holding the redis password in existing secret.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šæœ‰æº–å‚™ secret/redis-credentials è£¡é¢çš„ key[auth] å­˜æ”¾ redis å¯†ç¢¼ï¼Œè¦é€£å…¥çš„ pod éœ€è¦æ›è¼‰ secret ä¸¦æŠŠ auth åŒ¯å…¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;version&#34;&gt;Version&lt;/h3&gt;
&lt;p&gt;é€™é‚Šä½¿ç”¨çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chart version:    redis-ha-3.6.1&lt;/li&gt;
&lt;li&gt;app version:      5.0.5&lt;/li&gt;
&lt;li&gt;Redis Image:      redis:5.0.5-alpine&lt;/li&gt;
&lt;li&gt;Redis exporter:   oliver006/redis_exporter:v0.31.0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®‰è£å®Œè®Šé€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po | grep redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                                     READY   STATUS      RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-1-redis-ha-server-0                                3/3     Running     0          3d4h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-1-redis-ha-server-1                                3/3     Running     0          3d5h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-1-redis-ha-server-2                                3/3     Running     0          3d4h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;describe pod å¯ä»¥çœ‹åˆ°è£¡é¢æœ‰ä¸‰å€‹ container&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;redis: ä¸»è¦çš„ redis&lt;/li&gt;
&lt;li&gt;sentinel: ç¶­è­· redis å¯ç”¨æ€§çš„æœå‹™ï¼Œæœƒç›£æ¸¬ redis ç‹€æ…‹ï¼Œä¸¦æŠŠé€£ç·šæŒ‡æ´¾åˆ°æ–°çš„ master&lt;/li&gt;
&lt;li&gt;redis-exporter: æŠŠ redis çš„é‹è¡Œè³‡æ–™(metrics) é€å‡ºåˆ° promethues&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;networking&#34;&gt;Networking&lt;/h1&gt;
&lt;p&gt;Service&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                       AGE    SELECTOR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-redis-ha              ClusterIP   None           &amp;lt;none&amp;gt;        6379/TCP,26379/TCP,9121/TCP   46m    app=redis-ha,release=redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-redis-ha-announce-0   ClusterIP   10.3.243.81    &amp;lt;none&amp;gt;        6379/TCP,26379/TCP            46m    app=redis-ha,release=redis,statefulset.kubernetes.io/pod-name=redis-redis-ha-server-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-redis-ha-announce-1   ClusterIP   10.3.250.151   &amp;lt;none&amp;gt;        6379/TCP,26379/TCP            46m    app=redis-ha,release=redis,statefulset.kubernetes.io/pod-name=redis-redis-ha-server-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-redis-ha-announce-2   ClusterIP   10.3.242.59    &amp;lt;none&amp;gt;        6379/TCP,26379/TCP            46m    app=redis-ha,release=redis,statefulset.kubernetes.io/pod-name=redis-redis-ha-server-2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nslookup redis-redis-ha
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name:      redis-redis-ha
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Address 1: 10.0.0.42 redis-redis-ha-server-1.redis-redis-ha.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Address 2: 10.0.1.13 redis-redis-ha-server-2.redis-redis-ha.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Address 3: 10.0.2.8 redis-redis-ha-server-0.redis-redis-ha.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name:      redis-redis-ha-server-1.redis-redis-ha.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Address 1: 10.0.0.43 redis-redis-ha-server-1.redis-redis-ha.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;é€£ç·š&#34;&gt;é€£ç·š&lt;/h1&gt;
&lt;p&gt;æ‰€æœ‰é€£ç·šé€é redis-redis-ha service é€£å…¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha -p 6479 -a &amp;lt;password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–æ˜¯ç›´æ¥æŒ‡å®š redis instance é€£å…¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha-announce-0 -p 6479 -a &amp;lt;password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha-announce-1 -p 6479 -a &amp;lt;password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha-announce-2 -p 6479 -a &amp;lt;password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†ä¸Šé¢å…©è€…æœƒæœ‰å•é¡Œï¼Œredis åªæœ‰ master æ˜¯ writableï¼Œé€£å…¥ slave æœƒè®Šæˆ readonlyï¼Œå¦‚æœæ²’æœ‰ä»»ä½• probe æ©Ÿæ™ºï¼Œé‚£å°±æ˜¯æ¯æ¬¡é€£ç·šæ™‚æœ‰ 2/3 æ©Ÿç‡æœƒé€£åˆ° readonly çš„ redis slave ã€‚æ‰€ä»¥é€£ç·šå‰è¦å…ˆæ‰¾åˆ°æ­£ç¢ºçš„ master&lt;/p&gt;
&lt;h1 id=&#34;sentinel&#34;&gt;Sentinel&lt;/h1&gt;
&lt;p&gt;Sentinel æ˜¯ redis å®˜æ–¹æä¾›çš„ HA solutionï¼Œä¸»è¦è² è²¬ç›£æ§ redis çš„ç‹€æ…‹ï¼Œä¸¦æ§åˆ¶ redis master çš„ failover æ©Ÿåˆ¶ï¼Œä¸€ä½†è¶…é thresholdï¼Œsentinel å°±æœƒæŠŠ master failover åˆ°å…¶ä»– slave ä¸Šã€‚ä¸¦æŠŠ master é€£ç·šæŒ‡å‘æ–° masterã€‚&lt;/p&gt;
&lt;p&gt;redis sentinel èˆ‡ redis ä½¿ç”¨ç›¸å®¹çš„ apiï¼Œç›´æ¥ä½¿ç”¨ redis-cli é€é 26479 port é€£å…¥ï¼Œå¯ä»¥é€£åˆ° sentinelï¼Œé€é sentinel å¯ä»¥å–å¾— redis master çš„ç‹€æ…‹èˆ‡é€£ç·šè¨­å®šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cli -h redis-redis-ha -p 26479
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;app-ç«¯æ”¯æ´-sentinel&#34;&gt;App ç«¯æ”¯æ´ sentinel&lt;/h1&gt;
&lt;p&gt;éœ€è¦æœ‰æ”¯æ´ sentinel çš„ redis client libraryï¼Œä¾‹å¦‚: python redis-py æœ‰æ”¯æ´ sentinel çš„è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šå°±æœƒæ¯”è¼ƒéº»ç…©ï¼Œå› ç‚ºä¸æ˜¯æ‰€æœ‰çš„èªè¨€å° redis-sentinel çš„æ”¯æ´æ€§éƒ½å¤ å¥½ï¼Œæˆ–æ˜¯æ²’è¾¦æ³•è¨­å®šåˆ°å¦®æ—ºä½¿ç”¨çš„æƒ…å¢ƒä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ‰¾å¾—åˆ°æ”¯æ´æ€§è‰¯å¥½çš„å¥—ä»¶ï¼Œæ­å–œä½ ã€‚ä¸ç„¶å°±åƒæˆ‘å€‘å…¬å¸ï¼Œèˆ‡æˆ‘å€‘çš„éœ€æ±‚æœ‰è¡çªï¼Œåªå¥½è‡ªå·± fork libraryã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥èªªç›´æ¥ä½¿ç”¨æœ‰æ”¯æ´ redis-sentinel å¯èƒ½æœƒé‡åˆ°ä¸€äº›å•é¡Œã€‚é‚£ä¹Ÿæ²’æœ‰æ›´å¥½çš„è§£æ±ºæ–¹æ³•ï¼Ÿæˆ‘å€‘ä¸‹æ¬¡èªªæ˜ä½¿ç”¨ HAproxy çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h1 id=&#34;benchmark&#34;&gt;Benchmark&lt;/h1&gt;
&lt;p&gt;éƒ¨ç½²å®Œå¾Œï¼Œå¯ä»¥è·‘ä¸€ä¸‹ benchmarkï¼Œçœ‹çœ‹åœ¨ kubernetes ä¸Šé‹è¡Œçš„æ•ˆèƒ½æœ‰æ²’æœ‰ç¬¦åˆéœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Run a redis pod with sleep command
NOTE: CPU usage (rapidly) increasing during benchmark
DON&amp;rsquo;T DO THIS on PRODUCTION&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl run test-redis --image redis:5.0.5-alpine --command sleep 36000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it test-redis-xxxxxxxxx-xxxxx sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Benchmark&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-benchmark --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-benchmark \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -h haproxy-service.local \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p 6379 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -c 100 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -d 30 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -n 1000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;====== MSET (10 keys) ======
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;100000 requests completed in 2.32 seconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;50 parallel clients
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;3 bytes payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keep alive: 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;85.37% &amp;lt;= 1 milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;98.06% &amp;lt;= 2 milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;99.18% &amp;lt;= 3 milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;99.62% &amp;lt;= 4 milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;99.93% &amp;lt;= 5 milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;100.00% &amp;lt;= 5 milliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;43066.32 requests per second
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Kafka HA Continued</title>
      <link>https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/</link>
      <pubDate>Thu, 26 Sep 2019 22:50:32 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Kafka&amp;rsquo;s quorum set&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;kafka-çš„-quorum-set&#34;&gt;Kafka çš„ quorum set&lt;/h1&gt;
&lt;p&gt;é€™ç¯‡è·Ÿä¸Šç¯‡å…¶å¯¦å†è¬› quorumï¼Œæ‡‰è©²é€£åœ¨ä¸€èµ·ï¼Œä½†ç¤™æ–¼ç¯‡å¹…ï¼ˆä»¥åŠæˆ‘å€‹äººçš„æ™‚é–“ï¼±ï¼±ï¼‰æ‹†æˆäº†å…©ç¯‡ã€‚å„ä½æœ‰éœ€è¦å¯ä»¥å›é¡§ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;replicated-log-commit-decision&#34;&gt;Replicated log commit decision&lt;/h3&gt;
&lt;p&gt;ä¸Šç¯‡æåˆ°äº†å…©å€‹ç¶­æŒ replicated log çš„ model&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰æ›´æ–°é€²ä¾†ï¼Œleader ç­‰å¾…æ‰€æœ‰ follower éƒ½ ackï¼Œæ‰ commitã€‚&lt;/li&gt;
&lt;li&gt;æœ‰æ›´æ–°é€²ä¾†ï¼Œleader å–å¾—æ‰€æœ‰ node (2n+1) ä¸­çš„å¤šæ•¸ node å›æ‡‰(n+1)ï¼Œå°± commitã€‚è€Œ leader election æ™‚ï¼Œå¿…é ˆæ¯”å° node ä¸Šçš„ logï¼Œæ±ºå®šèª°æ˜¯ electable leader(æœ‰æœ€å®Œæ•´ log çš„ follower)ï¼Œé€™æ¨£ç¨±ç‚ºå…±è­˜(Quorum)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰è€…çš„å¥½è™•æ˜¯ï¼Œæ‰€æœ‰ node éƒ½æœ‰å®Œæ•´çš„ log å¾Œï¼Œleader æ‰æœƒ commitï¼Œå›è¦†çµ¦å®¢æˆ¶ commit  çš„è³‡è¨Šï¼Œæ‰€ä»¥æ¯å€‹ follower éƒ½æ˜¯ leader electable äººäººéƒ½å¯ä»¥ç•¶ leaderï¼Œleader ä¸€æ•…éšœå°±é¸æ“‡æ–°çš„ leader å³å¯ã€‚å£è™•å°±æ˜¯ leader åœ¨ç­‰å¾…æ‰€æœ‰ follow ack çš„æ™‚é–“æœƒéå¸¸ä¹…ï¼Œè€Œä¸”æ™‚é–“è¤‡é›œåº¦å¯èƒ½æœƒéš¨ cluster size scaleï¼Œæˆ–æ˜¯è®Šæˆè¦ç­‰æœ€æ…¢çš„ node å›æ‡‰(worst case)ã€‚é€™æ¨£åœ¨ node æ•¸é‡å¤šçš„æ™‚å€™éå¸¸ä¸ç¶“æ¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¾Œè€…çš„å¥½è™•æ˜¯ï¼Œn+1 node ack å¾Œå°± commitï¼Œleader commit çš„é€Ÿåº¦æ˜¯ç”±å‰æ®µç­çš„å›æ‡‰é€Ÿåº¦æ±ºå®šã€‚leader å‡ºç¾æ•…éšœï¼Œä»èƒ½ç¶­æŒå¤šæ•¸ node çš„è³‡æ–™æ­£ç¢ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;leader-election-decision&#34;&gt;Leader election decision&lt;/h3&gt;
&lt;p&gt;Leader Election çš„å•é¡Œä¹Ÿæ˜¯é¡ä¼¼ï¼Œå¦‚æœé¸æ“‡ leader æ™‚ï¼Œæ‰€æœ‰çš„ follower éƒ½æ¯”å°é logï¼Œé€™æ¨£èŠ±çš„æ™‚é–“æœƒå¾ˆä¹…ã€‚è¦çŸ¥é“ï¼Œé€™æ˜¯å€‹åˆ†æ•£å¼çš„æ¶æ§‹ï¼Œæ²’æœ‰ä¸­å¿ƒåŒ–çš„ controllerï¼Œä¹Ÿå°±æ˜¯ follower å½¼æ­¤éœ€è¦äº¤äº’æ¯”å°ã€‚è€Œä¸”æ™‚é–“éš¨ follower æ•¸é‡ scaleã€‚ é€ æˆtopic partition æ²’æœ‰ leader çš„æ™‚é–“(downtime)å¤ªé•·ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ majorityï¼Œä¹Ÿå°±æ˜¯ç•¶ leader æ­»æ‰ï¼Œç”¢ç”Ÿæ–°çš„ leader election æ™‚ï¼Œåªè©¢å• n+1 å€‹ follower ï¼Œç„¶å¾Œå¾é¸å‡º log æœ€å®Œæ•´çš„äººç•¶ leaderï¼Œ é€™æ¨£éç¨‹ä¸­æ¯å€‹ follower å½¼æ­¤æ¯”å°ï¼Œç¢ºèªï¼Œç„¶å¾Œæ‰é¸å‡º leaderï¼Œç¢ºèª leader çš„çµæœï¼Œæ‰€èŠ±çš„æ™‚é–“æœƒå¤§å¹…ç¸®çŸ­ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶ï¼Œé€™éº¼åšç”¢ç”Ÿçš„ tradeoffï¼Œå°±æ˜¯è¬ä¸€å–å¾—å¤šæ•¸æ±ºçš„ n+1 å€‹ follower è£¡é¢ï¼Œæ²’æœ‰æœ€å®Œæ•´çš„ log ï¼Œé‚£å¾è£¡é ­é¸å‡ºä¾†çš„ leader è‡ªç„¶ä¹Ÿæ²’æœ‰å®Œæ•´ logï¼Œé¸å‡ºä¾†çš„ leader å°±æœƒéºå¤±è³‡æ–™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€å€‹å®Œæ•´çš„-quorum-æ©Ÿåˆ¶&#34;&gt;ä¸€å€‹å®Œæ•´çš„ Quorum æ©Ÿåˆ¶&lt;/h3&gt;
&lt;p&gt;é€™ä¸æ˜¯ kafka çš„æ©Ÿåˆ¶ï¼Œä½†æˆ‘å€‘é †å¸¶èŠèŠã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;commit decision ä½¿ç”¨å¤šæ•¸æ±º(majority)&lt;/li&gt;
&lt;li&gt;leader election ä¹Ÿä½¿ç”¨å¤šæ•¸æ±º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½å…±æœ‰ 2n+1 replicasï¼Œleader å–å¾— n+1 ack æ‰èƒ½ commit messageã€‚ç„¶å¾Œ leader election æ™‚ï¼Œå¾è‡³å°‘ n+1 å€‹ follower ä¸­å–å¾—å¤šæ•¸æ±ºæ‰èƒ½é¸å‡º leaderã€‚æœ‰éåŠçš„å®Œæ•´logï¼ŒåŠ ä¸Šå–å¾—éåŠæ•¸çš„äººç¢ºèªï¼Œå…©è€…ç”¢ç”Ÿ overlapã€‚é€™æ¨£çš„å…±è­˜å°±ç¢ºä¿æœ‰å®Œæ•´çš„ log çš„ follower ä¸€å®šæœƒå‡ºç¾åœ¨ leader election ä¸­ï¼Œç¢ºä¿é¸å‡ºä¾†çš„ leader æœ‰å®Œæ•´ logã€‚&lt;/p&gt;
&lt;p&gt;å¥½è™•å¦‚å‰é¢æè¿°ï¼Œæ•´é«”æ•ˆèƒ½ç”±å‰æ®µç­çš„é€Ÿåº¦æ±ºå®šã€‚&lt;/p&gt;
&lt;p&gt;å£è™•æ˜¯ï¼Œå¾ˆå®¹æ˜“å°±æ²’æœ‰è¶³å¤ çš„ electable leaderã€‚è¦å®¹å¿ 1 å€‹éŒ¯èª¤ï¼Œéœ€è¦ 3 å€‹å®Œæ•´å‚™ä»½ï¼Œè¦å®¹å¿ 2 å€‹éŒ¯èª¤éœ€è¦ 5 å€‹å‚™ä»½ã€‚åœ¨å¯¦å‹™ä¸Šï¼Œåªé ä¾è³´å¤ å¤šçš„ redundency å®¹éŒ¯éå¸¸çš„ä¸å¯¦éš›ï¼šæ¯ä¸€æ¬¡å¯«å…¥éœ€è¦ 5 å€å¯«å…¥è·Ÿç¡¬ç¢Ÿç©ºé–“ï¼Œä½†æ•´é«”æ•ˆèƒ½åªæœ‰ 1/5ã€‚è³‡æ–™é‡å¤§å°±ç›´æ¥ï¼§ï¼§ã€‚æ‰€ä»¥ quorum æ‰æœƒåªå­˜åœ¨åˆ†æ•£å¼é›†ç¾¤(ex. zookeeper)ï¼Œè€Œä¸æœƒç›´æ¥ç”¨åœ¨å„²å­˜ç³»çµ±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kafkas-approach&#34;&gt;Kafka&amp;rsquo;s approach&lt;/h3&gt;
&lt;p&gt;Kafka ä¸ä½¿ç”¨ majority voteï¼Œè€Œæ˜¯å»å‹•æ…‹ç¶­è­·ä¸€å¥— in-sync replicas(ISR) ï¼Œé€™äº› ISR æœƒè·Ÿä¸Š leader çš„é€²åº¦ï¼Œè€Œåªæœ‰é€™äº› ISR æ‰èƒ½æ˜¯ leader eligibleã€‚ä¸€å€‹ update åªæœ‰åœ¨æ‰€æœ‰ ISR éƒ½ ack å¾Œæ‰æœƒ commitã€‚&lt;/p&gt;
&lt;p&gt;ISR çš„ç‹€æ…‹ä¸æ”¾åœ¨ kafka è€Œæ”¾åœ¨ zookeeper ä¸Šï¼Œä¹Ÿå°±æ˜¯ç›®å‰å“ªäº› node æ˜¯ ISR çš„è¨˜éŒ„å­˜åœ¨ zookeeperã€‚é€™ä»¶äº‹å°ç¶­æŒ kafka ç¯€é»ä¸Šï¼Œleader èƒ½å¤ åˆ†æ•£åœ¨å„å€‹ kafka node ä¸Š(leader rebalance)æ˜¯å¾ˆé‡è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;kafka&amp;rsquo;s approach èˆ‡ majority voteï¼Œåœ¨ç­‰å¾… message commit ack ä¸Šæ‰€èŠ±çš„æˆæœ¬æ˜¯ä¸€æ¨£çš„ã€‚ ç„¶è€Œåœ¨ leader election ä¸Šï¼Œkafka çš„ ISR ç¢ºä¿äº†æ›´å¤šå€‹ eligiable leader çš„æ•¸é‡ï¼ŒæŒçºŒç¶­æŒåœ¨åˆç†çš„æ•¸é‡ï¼Œè€Œä¸æœƒè¦ç¶­æŒå¤§é‡å€‹ redundencyã€‚ISR æ”¾åœ¨å¤–éƒ¨ï¼Œæ›´æ–¹ä¾¿ kafka åš leader rebalanceï¼Œå¢åŠ ç©©å®šåº¦ã€‚&lt;/p&gt;
&lt;h1 id=&#34;unclean-leader-election&#34;&gt;Unclean leader election&lt;/h1&gt;
&lt;p&gt;å¦‚æœ leaders éƒ½æ­»å…‰äº†æœƒæ€æ¨£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åªè¦æœ‰ä¸€å€‹ replica in-syncï¼ŒKafka å°±ä¿è­‰è³‡æ–™çš„å®Œæ•´æ€§ã€‚ç„¶è€Œæ‰€æœ‰å¯ç”¨çš„ leaders éƒ½æ­»äº†ï¼Œé€™å€‹å°±ç„¡æ³•ä¿è­‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé€™å€‹æƒ…å½¢ç™¼ç”Ÿäº†ï¼Œkafka æœƒåšä»¥ä¸‹è™•ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç­‰ ISR ä¸­æœ‰äººå®Œå…¨å›å¾©éä¾†ï¼Œç„¶å¾Œé¸é€™å€‹ node ä½œç‚º leader(æœ‰è³‡æ–™éºå¤±çš„é¢¨éšª)&lt;/li&gt;
&lt;li&gt;ç›´æ¥é¸æ“‡ç¬¬ä¸€å€‹å›è¦†çš„ node (ä¸ä¸€å®šåœ¨ ISR ä¸­)ï¼Œå…ˆå›è¦†çš„å°±æŒ‡æ´¾ç‚º leader&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰è€…çŠ§ç‰² availability ï¼ˆå›è¦†å‰æ²’æœ‰ leader å¯ä½œè®€å¯«ï¼‰ä¾†ç¢ºä¿è³‡æ–™æ˜¯ä¾†è‡ª ISRï¼Œé›–ç„¶éŒ¯èª¤ä¸­ç„¡æ³•è®€å¯«(downtime)ï¼Œä½†å¯ä»¥ç¢ºå®šéŒ¯èª¤å‰è·ŸéŒ¯èª¤å¾Œçš„è³‡æ–™éƒ½ä¾†è‡ª ISR&lt;/p&gt;
&lt;p&gt;å¾Œè€…çŠ§ç‰² consistency ï¼ˆä¾†è‡ªé ISR çš„ leader å¯èƒ½å°è‡´è³‡æ–™ä¸æ­£ç¢ºï¼‰ï¼Œç„¶è€Œå»èƒ½æ›´å¿«çš„å¾éŒ¯èª¤ä¸­å›è¦†ï¼Œæ¸›å°‘ downtime&lt;/p&gt;
&lt;p&gt;0.11.0.0  å¾Œçš„ kafka é è¨­æ˜¯é¸æ“‡å‰è€…ï¼Œä¹Ÿå°±æ˜¯ consistency over availabilityï¼Œç•¶ç„¶é€™å¯ä»¥åœ¨è¨­å®šæ›´æ”¹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;availability-and-durability-guarantees&#34;&gt;Availability and Durability Guarantees&lt;/h1&gt;
&lt;p&gt;è¿‘ä¸€æ­¥è€ƒæ…® client çš„å½±éŸ¿ã€‚&lt;/p&gt;
&lt;p&gt;Producer åœ¨å¯«å…¥æ™‚å¯ä»¥é¸æ“‡ message éœ€è¦å¤šå°‘ acknowledgeï¼Œ0, 1 or allï¼Œack=all æŒ‡çš„æ˜¯ message æ”¶åˆ°æ‰€æœ‰ in-sync replicas çš„ ack&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ 2 replicas ä¸­æœ‰ 1 å€‹æ•…éšœï¼Œé€™æ™‚å¯«å…¥åªè¦æ”¶åˆ° 1 å€‹ ISR çš„ ackï¼Œå°±é”æˆ ack=all&lt;/li&gt;
&lt;li&gt;ä½†å¦‚æœä¸å¹¸å‰©ä¸‹ä¸€å€‹ replicas ä¹Ÿæ­»äº† (0/0 ack)ï¼Œå¯«å…¥çš„è³‡æ–™å°±æœƒéºå¤±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰äº›ä½¿ç”¨æƒ…å¢ƒï¼Œæœƒå¸Œæœ›è³‡æ–™çš„è€ç”¨åº¦(Durability)å„ªå…ˆæ–¼å¯ç”¨æ€§(Availability)ï¼Œå¯ä»¥é€éä»¥ä¸‹å…©å€‹æ–¹å¼è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¦ç”¨ unclean leader electionï¼Œæ•ˆæœæ˜¯å¦‚æœæ‰€æœ‰çš„ replicas éƒ½å¤±æ•ˆï¼Œå‰‡æ•´å€‹ partition éƒ½å¤±æ•ˆï¼Œç›´åˆ°å‰ä¸€å€‹ leader å›å¾©æ­£å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;æŒ‡å®šå¯æ¥å—çš„æœ€å°‘ ISRï¼Œå¦‚æœ partition ä¸­çš„ ISR ä½æ–¼é€™å€‹æ•¸é‡ï¼Œå°±åœæ­¢å¯«å…¥é€™å€‹ partitionï¼Œç›´åˆ° ISR çš„æ•¸é‡å›è¦†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™æ¨£é›–ç„¶çŠ§ç‰²äº†å¯ç”¨æ€§ï¼Œå»å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°ç¢ºä¿è³‡æ–™çš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;è¤‡æœ¬ç®¡ç†&#34;&gt;è¤‡æœ¬ç®¡ç†&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢çš„è¨è«–éƒ½åªæ˜¯å†èªªä¸€å€‹ topicï¼Œå¯¦å‹™ä¸­ kafka ä¸­æœƒæœ‰å¤§é‡çš„ topic ï¼Œä¹˜ä¸Š partition number èˆ‡ replication factorï¼Œæˆåƒä¸Šè¬çš„è¤‡æœ¬åˆ†æ•£åœ¨é›†ç¾¤ä¸­ï¼Œkafka æœƒè©¦åœ–åˆ†æ•£ replicas åˆ°é›†ç¾¤ä¸­ï¼Œä¸¦è®“ leader çš„æ•¸é‡å¹³å‡åœ¨ node ä¸Š&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kafka HA Topology</title>
      <link>https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/</link>
      <pubDate>Wed, 25 Sep 2019 22:50:32 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Zookeeper Multi-server setup&lt;/li&gt;
&lt;li&gt;Kafka Multi-broker setup&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;zookeeper-multi-server&#34;&gt;Zookeeper Multi-Server&lt;/h1&gt;
&lt;p&gt;ç‚ºäº†ç¶­æŒ zookeeper æœ‰æ•ˆé‹ä½œï¼Œcluster å¿…é ˆç¶­æŒ majority (å¤šæ•¸)ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘ä¸€åŠçš„æ©Ÿå™¨åœ¨ç·šã€‚å¦‚æœç¸½å…± 3 å°ï¼Œä¾¿å¯ä»¥å¿å— 1 å°æ•…éšœä»ä¿æœ‰ majorityã€‚å¦‚æœæ˜¯ 5 å°å°±å¯ä»¥å®¹å¿ 2 å°æ•…éšœã€‚ä¸€èˆ¬ä¾†èªªéƒ½å»ºè­°ä½¿ç”¨åŸºæ•¸æ•¸é‡ã€‚&lt;a href=&#34;https://zookeeper.apache.org/doc/r3.4.12/zookeeperAdmin.html#sc_zkMulitServerSetup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Zookeeper Multi Server Setup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ™®éæƒ…æ³ï¼Œ3 å° zookeeper å·²ç¶“æ˜¯ production ready çš„ç‹€æ…‹ï¼Œä½†å¦‚æœç‚ºäº†æ›´é«˜çš„å¯ç”¨æ€§ï¼Œä»¥æ–¹ä¾¿é€²è¡Œå–®ç¯€é»åœæ©Ÿç¶­è­·ï¼Œå¯ä»¥å¢åŠ ç¯€é»æ•¸é‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;topology&#34;&gt;Topology&lt;/h3&gt;
&lt;p&gt;éœ€è¦å°‡ zookeeper æ”¾åœ¨ä¸åŒçš„æ©Ÿå™¨ä¸Šï¼Œä¸åŒçš„ç¶²è·¯ç’°å¢ƒï¼Œç”šè‡³æ˜¯ä¸åŒçš„é›²å¹³å°å€åŸŸä¸Šï¼Œä»¥æ‰¿å—ä¸åŒç¨‹åº¦çš„æ•…éšœã€‚ä¾‹å¦‚å–®å°æ©Ÿå™¨æ•…éšœï¼Œæˆ–æ˜¯å€åŸŸæ€§çš„ç¶²è·¯æ•…éšœã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šæœƒä½¿ç”¨ Kubernetes PodAntiAffinityï¼Œè¦æ±‚ scheduler åœ¨éƒ¨å±¬æ™‚ï¼Œå¿…é ˆå°‡ zookeeper åˆ†æ•£åˆ°ä¸åŒçš„æ©Ÿå™¨ä¸Šã€‚è¨­å®šå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;zookeeper:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  resources: ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  env:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ZK_HEAP_SIZE: &amp;#34;1G&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  persistence:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  image:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    PullPolicy: &amp;#34;IfNotPresent&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  url: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  port: 2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## Pod scheduling preferences (by default keep pods within a release on separate nodes).
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ## By default we don&amp;#39;t set affinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  affinity: # Criteria by which pod label-values influence scheduling for zookeeper pods.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   podAntiAffinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     requiredDuringSchedulingIgnoredDuringExecution:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       - topologyKey: &amp;#34;kubernetes.io/hostname&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         labelSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             release: zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecutionï¼Œå¦‚æœ topologyKey å·²ç¶“æœ‰æŒ‡å®š label çš„ pod å­˜åœ¨ï¼Œå‰‡ç„¡æ³•éƒ¨ç½²ï¼Œéœ€è¦æ•¸åˆ°å…¶ä»–å°æ©Ÿå™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --output wide | grep zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                  READY   STATUS      RESTARTS   AGE     IP              NODE                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-0-zookeeper-0   1/1     Running     0          42d     10.8.12.4       gke-chechiachang-pool-1-e06e6d00-pc98   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-0-zookeeper-1   1/1     Running     0          42d     10.8.4.4        gke-chechiachang-pool-1-e06e6d00-c29q   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-0-zookeeper-2   1/1     Running     0          42d     10.8.3.6        gke-chechiachang-pool-1-e06e6d00-krwc   
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ•ˆæœæ˜¯ zookeeper éƒ½åˆ†é…åˆ°ä¸åŒçš„æ©Ÿå™¨ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;guarantees&#34;&gt;Guarantees&lt;/h3&gt;
&lt;p&gt;Zookeeper å°æ–¼è³‡æ–™ä¸€è‡´æ€§ï¼Œæœ‰é€™äº›ä¿éšœ &lt;a href=&#34;https://zookeeper.apache.org/doc/r3.5.5/zookeeperProgrammers.html#ch_zkGuarantees&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consistency Guarantees&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é †åºä¸€è‡´æ€§ï¼šè³‡æ–™æ›´æ–°çš„é †åºï¼Œèˆ‡ç™¼é€çš„é †åºä¸€è‡´&lt;/li&gt;
&lt;li&gt;åŸå­æ€§ï¼šè³‡æ–™æ›´æ–°åªæœ‰æˆåŠŸæˆ–å¤±æ•—ï¼Œæ²’æœ‰éƒ¨ä»½æ•ˆæœ&lt;/li&gt;
&lt;li&gt;ç³»çµ±ä¸€è‡´æ€§ï¼šå¯æˆ¶ç«¯é€£åˆ° server çœ‹åˆ°çš„æ±è¥¿éƒ½æ˜¯ä¸€æ¨£ï¼Œç„¡é—œé€£å…¥å“ªå€‹ server&lt;/li&gt;
&lt;li&gt;å¯é æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;å®¢æˆ¶ç«¯çš„æ›´æ–°è«‹æ±‚ï¼Œä¸€ä½†æ”¶åˆ° server å›è¦†æ›´æ–°æˆåŠŸï¼Œä¾¿æœƒæŒçºŒä¿å­˜ç‹€æ…‹ã€‚æŸäº›éŒ¯èª¤æœƒé€ æˆå®¢æˆ¶ç«¯æ”¶ä¸åˆ°å›è¦†ï¼ŒÂ å¯èƒ½æ˜¯ç¶²è·¯å•é¡Œï¼Œæˆ–æ˜¯ server å…§éƒ¨å•é¡Œï¼Œé€™é‚Šå°±ç„¡æ³•ç¢ºå®š server ä¸Šçš„ç‹€æ…‹ï¼Œæ˜¯å¦è¢«æ›´æ–°äº†ï¼Œæˆ–æ˜¯è«‹æ±‚å·²ç¶“éºå¤±äº†ã€‚&lt;/li&gt;
&lt;li&gt;å¾å®¢æˆ¶è®€å–åˆ°çš„è³‡æ–™éƒ½æ˜¯ä»¥ç¢ºèªçš„è³‡æ–™ï¼Œä¸æœƒå› ç‚º server æ•…éšœå›æ»¾(Roll back)è€Œå›åˆ°èˆŠçš„ç‹€æ…‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;kafka-çš„è¨­å®š&#34;&gt;Kafka çš„è¨­å®š&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The StatefulSet installs 3 pods by default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replicas: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;resources:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   limits:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     cpu: 200m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     memory: 4096Mi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   requests:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     cpu: 100m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     memory: 1024Mi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafkaHeapOptions: &amp;#34;-Xmx4G -Xms1G&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨­å®š broker çš„æ•¸é‡ï¼Œä»¥åŠ Pod æä¾›çš„ resourceï¼Œä¸¦ä¸”é€é heapOption æŠŠè¨˜æ†¶é«”è¨­å®šå¡é€² JVM&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;affinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; affinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   podAntiAffinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     requiredDuringSchedulingIgnoredDuringExecution:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     - labelSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         matchExpressions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         - key: app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           operator: In
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           values:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           - kafka
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       topologyKey: &amp;#34;kubernetes.io/hostname&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   podAffinity:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     preferredDuringSchedulingIgnoredDuringExecution:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      - weight: 50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        podAffinityTerm:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          labelSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            matchExpressions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            - key: app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              operator: In
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              values:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                - zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šä¸‹äº†å…©å€‹ affinity&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;podAntiAffinity ç›¡é‡è®“ kafka-broker åˆ†æ•£åˆ°ä¸åŒæ©Ÿå™¨ä¸Š&lt;/li&gt;
&lt;li&gt;podAffinity è®“ broker prefer è·Ÿ zookeeper æ”¾åœ¨ä¸€èµ·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ†æ•£çš„ç†ç”±åŒä¸Šï¼Œä¸å¸Œæœ›ä¸€å°æ©Ÿå™¨æ­»äº†ï¼Œå°±è®“å¤šå€‹ broker è·Ÿè‘—æ­»&lt;/p&gt;
&lt;p&gt;è¦å’Œ zookeeper æ”¾åœ¨ä¸€èµ·ï¼Œå°±è¦çœ‹éœ€æ±‚èˆ‡å¯¦éš›ç’°å¢ƒèª¿æ•´&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;configurationOverrides:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;default.replication.factor&amp;#34;: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;offsets.topic.replication.factor&amp;#34;: 2 # Increased from 1 to 2 for higher output
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;offsets.topic.num.partitions&amp;#34;: 3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;confluent.support.metrics.enable&amp;#34;: false  # Disables confluent metric submission
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;auto.leader.rebalance.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;auto.create.topics.enable&amp;#34;: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;message.max.bytes&amp;#34;: &amp;#34;16000000&amp;#34; # Extend global topic max message bytes to 16 Mb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šå†æŠŠ broker é‹è¡Œçš„è¨­å®šåƒæ•¸å¡é€²å»ï¼Œåƒæ•¸çš„ç”¨é€”å¤§å¤šèˆ‡è¤‡æœ¬èˆ‡é«˜å¯ç”¨æ©Ÿåˆ¶æœ‰é—œä¸‹é¢éƒ½æœƒæåˆ°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;kafka-çš„è¤‡æœ¬æ©Ÿåˆ¶&#34;&gt;Kafka çš„è¤‡æœ¬æ©Ÿåˆ¶&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://kafka.apache.org/documentation/#replication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kafka çš„å‰¯æœ¬æ©Ÿåˆ¶&lt;/a&gt; é è¨­å°‡å„å€‹ topic partition çš„ log åˆ†æ•£åˆ° server ä¸Šï¼Œå¦‚æœå…¶ä¸­ä¸€å° server æ•…éšœï¼Œè³‡æ–™ä»ç„¶å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å…©å€‹é‡è¦çš„è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;num.partitions=N&lt;/li&gt;
&lt;li&gt;default.replication.factor=M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;kafka é è¨­ä½¿ç”¨è¤‡æœ¬ï¼Œæ‰€æœ‰æ©Ÿåˆ¶èˆ‡è¨­è¨ˆéƒ½åœç¹è‘—è¤‡æœ¬ã€‚å¦‚æœï¼ˆå› ç‚ºæŸäº›åŸå› ï¼‰ä¸å¸Œæœ›ä½¿ç”¨è¤‡æœ¬ï¼Œå¯å°‡ replication factor è¨­ç‚º 1ã€‚&lt;/p&gt;
&lt;p&gt;replication çš„å–®ä½æ˜¯ topic partitionï¼Œæ­£å¸¸ç‹€æ³ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹ partition æœƒæœ‰ä¸€å€‹ leaderï¼Œä»¥åŠé›¶å€‹æˆ–ä»¥ä¸Šå€‹ follower&lt;/li&gt;
&lt;li&gt;leader + follower ç¸½æ•¸æ˜¯ replication factor&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰è®€å¯«éƒ½æ˜¯å° leader è®€å¯«&lt;/li&gt;
&lt;li&gt;leader çš„ log æœƒåŒæ­¥åˆ° follower ä¸Šï¼Œleader èˆ‡ follower ç‹€æ…‹æ˜¯ä¸€æ¨£çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;election--load-balance&#34;&gt;Election &amp;amp; Load balance&lt;/h3&gt;
&lt;p&gt;é€šå¸¸ä¸€å€‹ topic æœƒæœ‰å¤šå€‹ partitionï¼Œä¹Ÿå°±æ˜¯èªªï¼Œæ¯å€‹ topic æœƒæœ‰å¤šå€‹ partition leaderï¼Œåˆ†æ•£è² è¼‰&lt;/p&gt;
&lt;p&gt;é€šå¸¸ topic partition çš„ç¸½æ•¸æœƒæ¯” broker çš„æ•¸é‡å¤š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥ä¸Šä¸€ç¯‡ç¯„ä¾‹ï¼Œæˆ‘å€‘æœ‰ä¸‰å€‹ kafka-0-broker å„è‡ªæ˜¯ä¸€å€‹ Pod&lt;/li&gt;
&lt;li&gt;æœ‰ topic: ticker è·Ÿé è¨­çš„ &lt;code&gt;__consumer_offset__&lt;/code&gt;ï¼Œä¹˜ä¸Š partition number çš„è¨­å®šå€¼(N)ï¼Œæœƒæœ‰ 2N å€‹ partitions&lt;/li&gt;
&lt;li&gt;partitiion æœƒæœ‰å„è‡ªçš„è¤‡æœ¬ï¼Œkafka æœƒç›¡é‡å°‡ç›¸åŒ topic çš„è¤‡æœ¬åˆ†æ•£åˆ°ä¸åŒ broker ä¸Š&lt;/li&gt;
&lt;li&gt;kafka ä¹Ÿæœƒç›¡é‡ç¶­æŒ partition çš„ leader åˆ†æ•£åœ¨ä¸åŒçš„ broker ä¸Šï¼Œé€™å€‹éƒ¨åˆ† kafka æœƒé€éç®—æ³•åš leader electionï¼Œä¹Ÿå¯æ‰‹å‹•ä½¿ç”¨è…³æœ¬åš &lt;a href=&#34;https://kafka.apache.org/documentation/#basic_ops_leader_balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Balancing leadership&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¸½ä¹‹ï¼Œtopic çš„ partition èˆ‡ leader æœƒåˆ†æ•£åˆ° broker ä¸Šï¼Œç¶­æŒ partition çš„å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sync&#34;&gt;sync&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;node è¦èƒ½å¤ ç¶­æŒ zookeeper çš„ session (zookeeper æœ‰ heartbeat æ©Ÿåˆ¶)&lt;/li&gt;
&lt;li&gt;follower ä¸èƒ½è½å¾Œ leader å¤ªå¤š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;kafka èƒ½ä¿éšœè³‡æ–™ä¸æœƒéºå¤±ï¼Œåªè¦è‡³å°‘ä¸€å€‹ node æ˜¯åœ¨ sync çš„ç‹€æ…‹ã€‚ä¾‹å¦‚æœ¬ä¾†æœ‰ä¸‰å€‹ partitionï¼Œå…¶ä¸­å…©å€‹ partition ä¸åŒæ­¥ï¼Œåªè¦å…¶ä¸­ä¸€å€‹ partition æ˜¯åŒæ­¥ï¼Œä¾¿èƒ½ä½œç‚º leader æŒçºŒæä¾›æ­£ç¢ºçš„ messageã€‚&lt;/p&gt;
&lt;h1 id=&#34;replicated-logs&#34;&gt;Replicated Logs&lt;/h1&gt;
&lt;p&gt;kafka é€é &lt;a href=&#34;https://kafka.apache.org/documentation/#design_replicatedlog&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;replicated log&lt;/a&gt; ç¶­æŒåˆ†æ•£å¼çš„ partition&lt;/p&gt;
&lt;p&gt;è¤‡æœ¬é–“è¦ç¶­æŒå…±è­˜(consensus)çš„æœ€ç°¡å–®æ©Ÿåˆ¶ï¼Œå°±æ˜¯å–®ä¸€ leader æ±ºå®šï¼Œå…¶ä»– follower è·Ÿéš¨ã€‚ç„¶è€Œè¬ä¸€ leader æ­»äº†ï¼Œé¸å‡ºçš„æ–° leader å»é‚„æ²’è·Ÿä¸ŠåŸå…ˆ leader çš„è³‡æ–™ã€‚é€™æ™‚ä¾¿ä½¿ç”¨ replicated logï¼Œä¾†ç¢ºä¿æ–°çš„ leader å°±ç®—åŸå…ˆæ²’è·Ÿä¸Šï¼Œä¹Ÿèƒ½é€é replicated log éš¨å¾Œè·Ÿä¸Šä¸”ä¸éºå¤±è³‡æ–™ã€‚ç¶­æŒ log ä¸€ç›´éƒ½åŒæ­¥çš„å‰æï¼Œå°±æ˜¯ leader è¦ä¸€ç›´ç¢ºèª followers çš„ log éƒ½æœ‰è·Ÿä¸Šï¼Œé€™å€‹å…¶å¯¦å°±æ˜¯è®Šç›¸çš„å¤š leaderï¼Œæ•ˆèƒ½æ¶ˆè€—è¼ƒå¤§ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€å€‹ç¶­æŒ log æ©Ÿåˆ¶ï¼Œå¦‚æœå¸Œæœ› follower å½¼æ­¤çš„ log æ‡‰è©²å…ˆé€²è¡Œæ¯”å°ï¼Œè®“è³‡æ–™äº¤æ¥éç¨‹æœ‰ overlapï¼Œé€™å€‹éç¨‹ç¨±ç‚º Quorumã€‚ä¸€å€‹å¸¸ç”¨çš„æ–¹å¼æ˜¯å¤šæ•¸æ±º(majority)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç¸½å…±æœ‰ 2n+1 çš„ nodeï¼Œleader è¦å‘ n+1 å€‹ follower å–å¾—å…±è­˜ï¼Œæ‰ç¢ºå®šé€™å€‹ log å·²ç¶“ commit äº†&lt;/li&gt;
&lt;li&gt;leader ç¸½æ˜¯ç¶­æŒ n+1 follower çš„ log æœ‰è·Ÿä¸Šï¼Œå› æ­¤å¯ä»¥å®¹å¿æœ€å¤š n å€‹ node æ­»äº†ï¼Œé›†ç¾¤æ•´é«”èƒ½æœ‰ n+1 çš„ node ç¶­æŒè‘—æ­£ç¢ºçš„ commited log&lt;/li&gt;
&lt;li&gt;ä¸ç”¨å‘æ‰€æœ‰ node ç¢ºèªæ‰ commit ï¼Œç¯€çœäº†ä¸€åŠçš„ ack&lt;/li&gt;
&lt;li&gt;majarity çš„å¦ä¸€å€‹å¥½è™•æ˜¯ï¼Œn+1 å…±è­˜çš„é€Ÿåº¦æ˜¯ç”±å‰ 1/2 å¿«çš„ node æ±ºå®šçš„ã€‚ç”±æ–¼åªè¦å…ˆå–å¾— n+1 å°±å¯ä»¥ commitï¼Œé€Ÿåº¦å¿«çš„ node æœƒå…ˆå›æ‡‰ï¼Œè®“æ•´é«”é€Ÿåº¦æå‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kafka Operation Scripts</title>
      <link>https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/</link>
      <pubDate>Wed, 25 Sep 2019 22:50:32 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¾ Zookeeper ç²å–è³‡è¨Š&lt;/li&gt;
&lt;li&gt;å–å¾—ä¸¦è™•ç† topic&lt;/li&gt;
&lt;li&gt;benchmark kafka&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;zookeeper&#34;&gt;zookeeper&lt;/h1&gt;
&lt;p&gt;zookeeper æ˜¯ kafka çš„åˆ†æ•£å¼å”èª¿ç³»çµ±ï¼Œåœ¨ kafka ä¸Šå¤šå€‹ç¯€é»é–“éœ€è¦å”èª¿çš„å…§å®¹ï¼Œä¾‹å¦‚ï¼šå½¼æ­¤ç¯€é»çš„IDï¼Œä½ç½®èˆ‡ç•¶å‰ç‹€æ…‹ï¼Œæˆ–æ˜¯è·¨ç¯€é» topic çš„è¨­å®šèˆ‡ç‹€æ…‹ã€‚å–åå«åš zookeeper å°±æ˜¯åœ¨å”èª¿æ··äº‚çš„åˆ†æ•£å¼ç³»çµ±ï¼Œ,è£¡é¢å„ç¨®ä¸åŒç¨®é¡çš„æœå‹™éƒ½è¦å”èª¿ï¼Œè±¡å€‹å‹•ç‰©åœ’ç®¡ç†å“¡ã€‚&lt;a href=&#34;https://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Zookeeper çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt; æœ‰æ›´è©³ç´°çš„èªªæ˜ã€‚&lt;/p&gt;
&lt;p&gt;Kafka çš„ç¯€é»è³‡è¨Šï¼Œèˆ‡ç•¶å‰ç‹€æ…‹ï¼Œæ˜¯æ”¾åœ¨ zookeeper ä¸Šï¼Œæˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹æŒ‡ä»¤å–å¾—&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# é¦–å…ˆå…ˆå–å¾— zkCli çš„ cliï¼Œé€™å€‹åªæœ‰é€£é€²ä»»ä½•ä¸€å° zookeeper å…§éƒ¨éƒ½æœ‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it kafka-0-zookeeper-0 --container kafka-broker bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ç”±æ–¼æ˜¯åœ¨ Pod å…§éƒ¨ï¼Œç›´æ¥ localhost è©¢å•æœ¬åœ°
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/zkCli.sh -server localhost:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Connecting to localhost:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,089 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.10-39d3a4f269333c922ed3db283be479f9deacaa0f, built on 03/23/2017 10:13 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,096 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka-0-zookeeper-0.kafka-0-zookeeper-headless.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,096 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_131
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,100 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,100 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/lib/jvm/java-8-openjdk-amd64/jre
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,100 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/usr/bin/../build/classes:/usr/bin/../build/lib/*.jar:/usr/bin/../share/zookeeper/zookeeper-3.4.10.jar:/usr/bin/../share/zookeeper/slf4j-log4j12-1.6.1.jar:/usr/bin/../share/zookeeper/slf4j-api-1.6.1.jar:/usr/bin/../share/zookeeper/netty-3.10.5.Final.jar:/usr/bin/../share/zookeeper/log4j-1.2.16.jar:/usr/bin/../share/zookeeper/jline-0.9.94.jar:/usr/bin/../src/java/lib/*.jar:/usr/bin/../etc/zookeeper:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,100 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,100 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,100 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&amp;lt;NA&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,101 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,101 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,101 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.14.127+
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,101 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,102 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/home/zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,102 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,105 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@42110406
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Welcome to ZooKeeper!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,160 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1032] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;JLine support is enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,374 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@876] - Socket connection established to localhost/127.0.0.1:2181, initiating session
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-25 15:02:36,393 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1299] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x16d67baf1310001, negotiated timeout = 30000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WATCHER::
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WatchedEvent state:SyncConnected type:None path:null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[zk: localhost:2181(CONNECTED) 0]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å–å¾— kafka broker è³‡æ–™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# List root Nodes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[cluster, controller, controller_epoch, brokers, zookeeper, admin, isr_change_notification, consumers, log_dir_event_notification, latest_producer_id_block, config]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Brokers çš„è³‡æ–™ç¯€é»
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /brokers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[ids, topics, seqid]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# List /brokers/ids å¾—åˆ°ä¸‰å€‹ kafka broker
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /brokers/ids
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[0, 1, 2]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# åˆ—å‡ºæ‰€æœ‰ topic åç¨±
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls /brokers/topics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[ticker]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ticker æ˜¯ä¸Šç¯‡ç¯„åˆ©ç”¨åˆ°çš„ topic&lt;/p&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªï¼Œzookeeper å­˜æ”¾é€™äº›ç‹€æ…‹èˆ‡ topic çš„ metadata&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å„²å­˜æ ¸å¿ƒçš„ç‹€æ…‹èˆ‡è³‡æ–™ï¼Œç‰¹åˆ¥æ˜¯ broker è¬ä¸€æ›æ‰ï¼Œä¹Ÿé‚„éœ€è¦ç¶­æŒçš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;å”èª¿å·¥ä½œï¼Œä¾‹å¦‚å”åŠ© broker è™•ç† quorumï¼Œç´€éŒ„ partition master ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# é›¢é–‹ zkCli
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;quit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;kafka&#34;&gt;Kafka&lt;/h1&gt;
&lt;p&gt;é€™é‚Šä¸€æ¨£å…ˆé€£ç·šé€²å»ä¸€å° brokerï¼Œå–å¾— kafka binary&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it kafka-0-0 --container kafka-broker bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ls /usr/bin/ | grep kafka
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-acls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-broker-api-versions
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-configs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-console-consumer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-console-producer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-consumer-groups
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-consumer-perf-test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-delegation-tokens
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-delete-records
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-dump-log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-log-dirs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-mirror-maker
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-preferred-replica-election
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-producer-perf-test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-reassign-partitions
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-replica-verification
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-run-class
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-server-start
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-server-stop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-streams-application-reset
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-topics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-verifiable-consumer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-verifiable-producer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¾ˆå¤šå·¥å…·ï¼Œæˆ‘å€‘é€™é‚Šåªæœƒçœ‹å…¶ä¸­å¹¾å€‹&lt;/p&gt;
&lt;h3 id=&#34;topic-è³‡è¨Š&#34;&gt;topic è³‡è¨Š&lt;/h3&gt;
&lt;p&gt;Topic çš„è³‡è¨Šï¼Œè·Ÿ zookeeper è¦&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# List topics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-topics --list --zookeeper kafka-0-zookeeper
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ticker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ“ä½œ-message&#34;&gt;æ“ä½œ message&lt;/h3&gt;
&lt;p&gt;å¾ topic å–å¾— message&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# This will create a new console-consumer and start consuming message to stdout
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-console-consumer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--bootstrap-server localhost:9092 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--topic engine_topic_soundwave_USD \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--timeout 0 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--from-beginning
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœ ticker é‚£å€‹ example pod é‚„åœ¨åŸ·è¡Œï¼Œé€™é‚Šå°±æœƒæ”¶åˆ° ticker çš„æ¯ç§’ message&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²’æœ‰ï¼Œä¹Ÿå¯ä»¥é–‹å•Ÿå¦ä¸€å€‹ broker çš„é€£ç·š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it kafka-0-1 --container kafka-broker bash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# ä½¿ç”¨ producer çš„ console é€£å…¥ï¼Œtopic æŠŠ message å¡é€²å»
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-console-producer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--broker-list localhost:9092\
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --topic ticker
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tick [enter]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tick [enter]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;kafka-console-consumer é‚£å€‹ terminal å°±æœƒæ”¶åˆ° message&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tick
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tick
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ consumer group&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Use consumer to check ticker topics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-console-consumer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--bootstrap-server localhost:9092 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--topic ticker \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--group test
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰åšéä¸Šé¢çš„æ“ä½œç”¢ç”Ÿ consumer groupï¼Œå°±å¯ä»¥é€é consumer APIï¼Œå–å¾— consumer group ç‹€æ…‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Check consumer group
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-consumer-groups \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--bootstrap-server localhost:9092 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--group ticker \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--describe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Consumer group &amp;#39;test&amp;#39; has no active members.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ticker          0          23              23              0               -               -               -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;topic-è¨­å®šæ“ä½œ&#34;&gt;Topic è¨­å®šæ“ä½œ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://kafka.apache.org/documentation/#topicconfigs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Topic è¨­å®šæ–‡ä»¶&lt;/a&gt; åœ¨æ­¤&lt;/p&gt;
&lt;p&gt;é€™é‚Šé€é kafka-configs å¾ zookeeper å–å¾— topic è¨­å®šï¼Œé€™é‚Šçš„ max.message.bytesï¼Œæ˜¯é€™å€‹ topic æ¯å€‹ message çš„æœ€å¤§ä¸Šé™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-configs --zookeeper kafka-0-zookeeper:2181 --describe max.message.bytes --entity-type topics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Configs for topic &amp;#39;__consumer_offsets&amp;#39; are segment.bytes=104857600,cleanup.policy=compact,compression.type=producer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Configs for topic &amp;#39;ticker&amp;#39; are
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;__consumer__offsets&lt;/code&gt; æ˜¯ç³»çµ±çš„ topic ï¼Œç´€éŒ„ç›®å‰ consumer è®€å–çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ticker æ²’æœ‰è¨­å®šï¼Œå°±æ˜¯ producer ç•¶åˆç”¢ç”Ÿ topic æ™‚æ²’æœ‰æŒ‡å®šï¼Œä½¿ç”¨ default å€¼&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘å€‘å…¬å¸çš„ä½¿ç”¨æƒ…å¢ƒå¸¸å¸¸æœƒè¶…éï¼Œæ‰€ä»¥å¯ä»¥æª¢æŸ¥ producer app é‚£ç«¯é€å‡ºçš„ message å¤§å°ï¼Œåœ¨æ¯”è¼ƒé€™é‚Šçš„è¨­å®šã€‚ç•¶ç„¶ç¾åœ¨ ticker çš„ç¯„ä¾‹ï¼Œåªæœ‰ä¸€å€‹ 0-60 çš„æ•¸å€¼ï¼Œä¸¦ä¸æœƒè¶…éã€‚é€™å€‹å¯ä»¥åœ¨ helm install çš„æ™‚å€™ï¼Œä½¿ç”¨ value.yaml å‚³å…¥æ™‚æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å–œæ­¡é€™å€‹å€¼ï¼Œå¯ä»¥æ›´æ”¹ï¼Œé€™é‚Šå¢åŠ åˆ° 16MB&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TOPIC=ticker
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-configs \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --zookeeper kafka-3-zookeeper:2181 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --entity-type topics \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --alter \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --entity-name ${TOPIC} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --add-config max.message.bytes=16000000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;benchmark&#34;&gt;Benchmark&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨å…§å»ºå·¥å…·è·‘ benchmark&lt;/p&gt;
&lt;p&gt;Producer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-producer-perf-test \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --num-records 100 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --record-size 100 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --topic performance-test \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --throughput 100 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --producer-props bootstrap.servers=kafka:9092 max.in.flight.requests.per.connection=5 batch.size=100 compression.type=none
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;100 records sent, 99.108028 records/sec (0.01 MB/sec), 26.09 ms avg latency, 334.00 ms max latency, 5 ms 50th, 70 ms 95th, 334 ms 99th, 334 ms 99.9th.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Consumer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/bin/kafka-consumer-perf-test \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --messages 100 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --broker-list=kafka:9092 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --topic performance-test \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --group performance-test \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --num-fetch-threads 1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Kafka-basic-usage</title>
      <link>https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/</link>
      <pubDate>Tue, 24 Sep 2019 21:59:49 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes ä¸­é€£ç·š kafka&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ golang library é€£ç·šåˆ° Kafka&lt;/li&gt;
&lt;li&gt;é€é kafka script æ“ä½œ kafka&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;kubernetes-ä¸­é€£ç·š-kafka&#34;&gt;kubernetes ä¸­é€£ç·š kafka&lt;/h1&gt;
&lt;p&gt;å…ˆçœ‹ä¸€çœ‹ kafka pods&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods --selector=&amp;#39;app=kafka&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME        READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-0   1/1     Running   1          26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-1   1/1     Running   0          26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-2   1/1     Running   0          26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -l &amp;#39;app=zookeeper&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                  READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-zookeeper-0   1/1     Running   0          26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-zookeeper-1   1/1     Running   0          26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-zookeeper-2   1/1     Running   0          26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -l &amp;#39;app=kafka-exporter&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                               READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-exporter-88786d84b-z954z   1/1     Running   5          26d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe pods kafka-1-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name:           kafka-1-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Namespace:      default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Priority:       0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Node:           gke-chechiachang-pool-1-e4622744-wcq0/10.140.15.212
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Labels:         app=kafka
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                controller-revision-hash=kafka-1-69986d7477
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                release=kafka-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                statefulset.kubernetes.io/pod-name=kafka-1-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Annotations:    kubernetes.io/limit-ranger: LimitRanger plugin set: cpu request for container kafka-broker
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Status:         Running
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP:             10.12.6.178
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Controlled By:  StatefulSet/kafka-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Containers:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  kafka-broker:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Image:         confluentinc/cp-kafka:5.0.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Port:          9092/TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Host Port:     0/TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Command:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      -exc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      unset KAFKA_PORT &amp;amp;&amp;amp; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      export KAFKA_BROKER_ID=${POD_NAME##*-} &amp;amp;&amp;amp; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      export KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://${POD_IP}:9092 &amp;amp;&amp;amp; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      exec /etc/confluent/docker/run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Requests:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      cpu:      100m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Liveness:   exec [sh -ec /usr/bin/jps | /bin/grep -q SupportedKafka] delay=30s timeout=5s period=10s #success=1 #failure=3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Readiness:  tcp-socket :kafka delay=30s timeout=5s period=10s #success=1 #failure=3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Environment:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      POD_IP:                                   (v1:status.podIP)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      POD_NAME:                                kafka-1-0 (v1:metadata.name)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      POD_NAMESPACE:                           default (v1:metadata.namespace)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_HEAP_OPTS:                         -Xmx4G -Xms1G
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_ZOOKEEPER_CONNECT:                 kafka-1-zookeeper:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_LOG_DIRS:                          /opt/kafka/data/logs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_CONFLUENT_SUPPORT_METRICS_ENABLE:  false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_DEFAULT_REPLICATION_FACTOR:        3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_MESSAGE_MAX_BYTES:                 16000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:  1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KAFKA_JMX_PORT:                          5555
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Mounts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      /opt/kafka/data from datadir (rw)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      /var/run/secrets/kubernetes.io/serviceaccount from default-token-2tm8c (ro)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Conditions:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Volumes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  datadir:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ClaimName:  datadir-kafka-1-0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ReadOnly:   false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  default-token-2tm8c:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Type:        Secret (a volume populated by a Secret)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    SecretName:  default-token-2tm8c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Optional:    false
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¬›å¹¾å€‹é‡é»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€™é‚Šè·‘èµ·ä¾†çš„æ˜¯ kafka-brokerï¼Œæ¥æ”¶ producer èˆ‡ consumer ä¾†çš„ request&lt;/li&gt;
&lt;li&gt;é€™é‚Šç”¨çš„æ˜¯ statefulsetsï¼Œä¸æ˜¯å®Œå…¨ç„¡ç‹€æ…‹çš„ kafka brokerï¼Œè€ŒæŠŠ message è¨˜åœ¨ datadir ä¸Šï¼Œé™ä½æ•…éšœé‡å•Ÿæ™‚å¯èƒ½éºå¤±è³‡æ–™çš„é¢¨éšªã€‚&lt;/li&gt;
&lt;li&gt;å•Ÿå‹•æ™‚ï¼ŒæŠŠ kubernetes æŒ‡å®šçš„ pod name å¡é€²ç’°å¢ƒè®Šæ•¸ï¼Œç„¶å¾Œä½œç‚ºç•¶å‰ broker çš„ ID&lt;/li&gt;
&lt;li&gt;æ²’æœ‰è¨­å®š Pod antiAffinityï¼Œæ‰€ä»¥æœ‰å¯èƒ½æœƒå•Ÿä¸‰å€‹ kafka çµæœä¸‰å€‹è·‘åœ¨åŒä¸€å° node ä¸Šï¼Œé€™æ¨£ node æ•…éšœå°±å…¨æ­»ï¼Œæ²’æœ‰HA&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;service--endpoints&#34;&gt;Service &amp;amp; Endpoints&lt;/h3&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹ service èˆ‡ endpoints
zookeeper èˆ‡ exporter æˆ‘å€‘é€™é‚Šå…ˆæ éä¸è«‡ï¼Œåˆ°å°ˆç« è¬›é«˜å¯ç”¨æ€§èˆ‡æœå‹™ç›£æ¸¬æ™‚ï¼Œå†ä¾†è¨è«–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get service -l &amp;#39;app=kafka&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1            ClusterIP   10.15.242.178   &amp;lt;none&amp;gt;        9092/TCP   26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-headless   ClusterIP   None            &amp;lt;none&amp;gt;        9092/TCP   26d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…©å€‹ services&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹æ˜¯ cluster-ip serviceï¼Œæœ‰ single cluster IP èˆ‡ load-balanceï¼ŒDNS æœƒé kube-proxyã€‚&lt;/li&gt;
&lt;li&gt;ä¸€å€‹æ˜¯ headless serviceï¼ŒDNS æ²’æœ‰é kube-proxyï¼Œè€Œæ˜¯ç”± endpoint controller ç›´æ¥ address recordï¼ŒæŒ‡å‘æŠŠç¬¦åˆ service selector çš„ podã€‚é©åˆåš service discoveryï¼Œä¸æœƒä¾è³´æ–¼ kubernetes çš„å¯¦ç¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/#headless-services&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è©³ç´°èªªæ˜åœ¨å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªï¼Œkafka broker æœƒåš auto service discoveryï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ headless serviceã€‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ¶ç«¯(consumer &amp;amp; producer) é€£å…¥æ™‚ï¼Œå‰‡ä½¿ç”¨ cluster-ip serviceï¼Œåš load balancingã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get endpoints -l &amp;#39;app=kafka&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                            ENDPOINTS                                                          AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1                         10.12.1.14:9092,10.12.5.133:9092,10.12.6.178:9092                  26d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kafka-1-headless                10.12.1.14:9092,10.12.5.133:9092,10.12.6.178:9092                  26d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;golang-example&#34;&gt;Golang Example&lt;/h1&gt;
&lt;p&gt;é™„ä¸Šç°¡å–®çš„ Golang å®¢æˆ¶ç«¯ï¼Œ&lt;a href=&#34;https://github.com/chechiachang/kafka-on-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´ Github Repository åœ¨é€™é‚Š&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/segmentio/kafka-go&amp;#34;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨çš„å¥—ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;topic&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ticker&amp;#34;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æŒ‡å®š message è¦ä½¿ç”¨çš„ topic
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;partition&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æŒ‡å®š partitionï¼Œç”±æ–¼åº•ä¸‹é€£ç·šæŒ‡å®šé€£ç·šåˆ° partition çš„ leaderï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š partition
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;kafkaURL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;kafka-0:9092&amp;#34;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æŒ‡å®š kafkaURLï¼Œä¹Ÿå¯ä»¥é€é os.GetEnv() å¾ç’°å¢ƒè®Šæ•¸è£¡æ‹¿åˆ°ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// producer å°æŒ‡å®š topic, partition çš„ leader ç”¢ç”Ÿé€£ç·š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;producerConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kafka&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DialLeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kafkaURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;topic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;partition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ç¨‹å¼çµæŸæœ€å¾ŒæŠŠ connection é—œæ‰ã€‚ä¸é—œæœƒé€ æˆ broker ç´¯ç©å¤§é‡ connectionï¼Œéœ€è¦ç­‰å¾… broker ç«¯ timeout æ‰æœƒé‡‹æ”¾ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;producerConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//producerConn.SetWriteDeadline(time.Now().Add(10 * time.Second))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨ go routine è·‘ä¸€å€‹ subprocess for loopï¼Œä¸€ç›´ç”¢ç”Ÿ message åˆ° kafka topicï¼Œé€™é‚Šçš„ç¯„ä¾‹æ˜¯æ¯ç§’æ¨ä¸€å€‹ç§’æ•¸ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;producerConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteMessages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;kafka&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// make a new reader that consumes from topic-A, partition 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kafka&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kafka&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ReaderConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Brokers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kafkaURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Topic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;topic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Partition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;MinBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mf&#34;&gt;10e2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 1KB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;MaxBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mf&#34;&gt;10e3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 10KB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//r.SetOffset(42)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å°å‡º reader æ”¶åˆ°çš„ message
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%v message at offset %d: %s = %s\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šå¯ä»¥ä½¿ç”¨ Dockerfile åŒ…æˆä¸€å€‹ container imageï¼Œç„¶å¾Œä¸Ÿä¸Š kubernetes&lt;/p&gt;
&lt;p&gt;æˆ‘ç¨æ™šè£œä¸€ä¸‹ docker image è·Ÿ deployment æ–¹ä¾¿å¤§å®¶æ“ä½œå¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–æ˜¯æ”‹äººæ¸¬è©¦ï¼Œç›´æ¥ kubectl run ä¸€å€‹ golang base image è®“å®ƒ sleepï¼Œç„¶å¾Œåœ¨é€£é€²å»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl run DEPLOYMENT_NAME --image=golang:1.13.0-alpine3.10 sleep 3600
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl exec -it POD_NAME sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# è£¡é¢æ²’æœ‰ Git è·Ÿ vim è£ä¸€ä¸‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apk add git vim
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go get github.com/chechiachang/kafka-on-kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd src/github.com/chechiachang/kafka-on-kubernetes/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim main.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go build .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./kafka-on-kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:46.872554693 +0000 UTC m=+9.154112787 message at offset 1:  = 46
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:47.872563087 +0000 UTC m=+9.154121166 message at offset 2:  = 47
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:48.872568848 +0000 UTC m=+9.154126926 message at offset 3:  = 48
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:49.872574499 +0000 UTC m=+9.154132576 message at offset 4:  = 49
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:50.872579957 +0000 UTC m=+9.154138032 message at offset 5:  = 50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:51.872588823 +0000 UTC m=+9.154146892 message at offset 6:  = 51
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:52.872594672 +0000 UTC m=+9.154152748 message at offset 7:  = 52
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2019-09-24 14:20:53.872599986 +0000 UTC m=+9.154158060 message at offset 8:  = 53
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ¨£å°±é€£ä¸Šäº†ï¼Œå®Œæˆä¸€å€‹æœ€ç°¡å–®çš„ä½¿ç”¨ç¯„ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ä¾‹å­å¤ªéç°¡å–®ï¼Œä¸Šä¸€ç¯‡è¬›çš„ consumer group, partitions, offset ä»€éº¼è¨­å®šå…¨éƒ½æ²’ç”¨ä¸Šã€‚å¯¦å‹™ä¸Šé€™äº›éƒ½éœ€è¦å¥½å¥½æ€è€ƒï¼Œä¸¦ä¸”ä¾æ“šéœ€æ±‚åšèª¿æ•´è¨­å®šã€‚&lt;/p&gt;
&lt;h3 id=&#34;clean-up&#34;&gt;Clean up&lt;/h3&gt;
&lt;p&gt;æŠŠæ¸¬è©¦ç”¨çš„ deployment å¹¹æ‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete deployment DEPLOYMENT_NAME
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡è¿° kafka åœ¨ kubernetes ä¸Šé‹è¡Œçš„ç‹€æ³ï¼Œé€£ç·šæ–¹æ³•&lt;/li&gt;
&lt;li&gt;Demo ä¸€å€‹å°ç¨‹å¼&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kafka-introduction</title>
      <link>https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/</link>
      <pubDate>Mon, 23 Sep 2019 21:59:49 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¯«äº†éƒ¨å±¬ï¼Œæœ¬æƒ³è«‡ä¸€ä¸‹ kafka çš„é«˜å¯ç”¨æ€§é…ç½®ï¼Œçœ‹åˆ°å¤§å¾·çš„ç•™è¨€ï¼Œæ‰æƒ³åˆ°æ‡‰è©²è¦å…ˆè·Ÿå„ä½ä»‹ç´¹ä¸€ä¸‹ kafkaï¼Œè·Ÿ kafka çš„ç”¨é€”ã€‚ä¹Ÿæ„Ÿè¬å¤§å¾·è·¯éç™¼å•ï¼Œæˆ‘ä¹Ÿæœƒé †ä»£èª¿æ•´å…§å®¹ã€‚ä»Šå¤©å°±èªªæ˜ä½•ç‚º kafkaï¼Œä»¥åŠåœ¨ä»€éº¼æ¨£çš„ç‹€æ³ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ kafka&lt;/li&gt;
&lt;li&gt;åŸºæœ¬å…ƒä»¶&lt;/li&gt;
&lt;li&gt;Kafka çš„å·¥ä½œæµç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç°¡ä»‹-kafka&#34;&gt;ç°¡ä»‹ Kafka&lt;/h1&gt;
&lt;p&gt;Kafka æ˜¯åˆ†æ•£å¼çš„ streaming platformï¼Œå¯ä»¥ subscribe &amp;amp; publish è¨Šæ¯ï¼Œå¯ä»¥ç•¶ä½œæ˜¯ä¸€å€‹åŠŸèƒ½å¼·å¤§çš„ message queue ç³»çµ±ï¼Œç”±æ–¼åˆ†æ•£å¼çš„æ¶æ§‹ï¼Œè®“ kafka æœ‰å¾ˆå¤§ç¨‹åº¦çš„ fault toleranceã€‚&lt;a href=&#34;https://kafka.apache.org/documentation/#gettingStarted&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸç‰ˆçš„èªªæ˜åœ¨é€™é‚Š&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€™é‚Šæœ‰å¹¾å€‹æ±è¥¿è¦è§£é‡‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;message-queue-system&#34;&gt;Message Queue System&lt;/h1&gt;
&lt;p&gt;ç•¶ä¸€å€‹ç³»çµ±é–‹å§‹é‹ä½œæ™‚ï¼Œè£¡é ­æœƒæœ‰å¾ˆå¤šè®Šæ•¸ï¼Œé€™äº›è®Šæ•¸å…¶å¯¦å°±æ˜¯åœ¨ä¸€å®šçš„ç¯„åœ(scopeï¼‰å…§ï¼Œåšè¨Šæ¯(message)çš„å‚³éã€‚ä¾‹å¦‚åœ¨ app å¯«äº†ä¸€å€‹ function ï¼Œå‚³å…¥ä¸€å€‹è®Šæ•¸çš„å€¼çµ¦ functionã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¤‡é›œçš„ç³»çµ±ä¸­ï¼Œæœå‹™å…ƒä»¶å½¼æ­¤ä¹Ÿæœƒæœ‰å‚³éè¨Šæ¯çš„éœ€æ±‚ã€‚ä¾‹å¦‚æˆ‘åŸæœ¬æœ‰ä¸€å€‹ api-serverï¼Œå…¶ä¸­ä¸€æ®µç¨‹å¼ç¢¼æ˜¯æ•ˆèƒ½ç“¶é ¸ï¼Œæˆ‘æŠŠå®ƒåˆ‡å‡ºä¾†ç¨ç«‹æˆä¸€å€‹ worker çš„å…ƒä»¶ï¼Œè®“å®ƒå¯ä»¥åœ¨æ›´é«˜æ•ˆèƒ½åœ°æ–¹åŸ·è¡Œï¼Œç”šè‡³ horizontal scalingã€‚é€™ç¨®æƒ…å¢ƒï¼Œè¾¨å¯èƒ½æ­²éœ€è¦æŠŠä¸€éƒ¨åˆ†çš„ message å¾ api-server å‚³åˆ° workerï¼Œworker æŠŠåƒæ•ˆèƒ½çš„å·¥ä½œåšå®Œï¼Œå†æŠŠçµæœå›å‚³çµ¦ api-serverã€‚é€™æ™‚å°±æœƒéœ€è¦ä¸€å€‹ç©©å®šçš„ message queue systemï¼Œä¾†ç©©å®šï¼Œä¸”é«˜æ•ˆèƒ½çš„å‚³éé€™äº› messageã€‚&lt;/p&gt;
&lt;p&gt;Message Queue System å¯¦åšå¾ˆå¤šï¼ŒActiveMQ, RabbitMQ, &amp;hellip; ç­‰ï¼Œä¸€äº› database åš message queue åœ¨æŸäº›æ‡‰ç”¨å ´æ™¯ä¸‹ä¹Ÿååˆ†é©åˆï¼Œä¾‹å¦‚ Redis æ˜¯ in-memory key-value databaseï¼Œå…§éƒ¨ä¹Ÿå¯¦åš pubsubï¼Œèƒ½å¤ åœ¨æŸäº›ç’°å¢ƒç©©å®šçš„å‚³é€ messageã€‚&lt;/p&gt;
&lt;h1 id=&#34;request-response-vs-publish-subscribe&#34;&gt;Request-Response vs Publish-Subscribe&lt;/h1&gt;
&lt;p&gt;è¨Šæ¯çš„å‚³é€æœ‰å¾ˆå¤šæ–¹å¼ï¼Œä¾‹å¦‚ Http request-response å¾ˆé©åˆ server åœ¨ç„¡ç‹€æ…‹(stateless) ä¸‹æ¥å—ä¾†è‡ªå®¢æˆ¶ç«¯çš„è¨Šæ¯ï¼Œæ¯æ¬¡å‚³é€éƒ½é‡æ–°å»ºç«‹æ–°çš„ http connectionï¼Œé€™æ¨£åšæœ‰å¾ˆå¤šå¥½è™•ä¹Ÿå¾ˆå¤šå£è™•ã€‚å…¶ä¸­æ˜é¡¯çš„å£è™•æ˜¯ç¶²è·¯è³‡æºçš„æµªè²»ï¼Œä»¥åŠè¨Šæ¯çš„ä¸å¤ å³æ™‚ï¼ŒæŒ‡å®šç‰¹å®šæ”¶ä»¶äººæ™‚ç™¼ä»¶äººæœƒé€ æˆé¡å¤–è² æ“”ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Pub-sub patternçš„å¥½è™•ï¼Œæ˜¯ publisher ä¸éœ€è¦é¡å¤–è™•ç†ã€é€™å€‹è¨Šæ¯è¦é€çµ¦èª°ã€çš„å·¥ä½œï¼Œè€Œæ˜¯è®“ subscriber ä¾†è¨‚é–±éœ€è¦çš„è¨Šæ¯é¡åˆ¥ï¼Œä¸€æœ‰æ–°çš„ event é€åˆ°è©²è¨Šæ¯é¡åˆ¥ï¼Œç›´æ¥é€é broker æ¨æ’­çµ¦ subscriberã€‚ä¸åƒ…å³æ™‚ï¼Œç¯€çœæ•ˆèƒ½ï¼Œè€Œä¸”è¨‚é–±çš„å½ˆæ€§å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;kafka-producer--consumer-api&#34;&gt;Kafka producer &amp;amp; Consumer API&lt;/h1&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/kafka-apis.png&#34; alt=&#34;kafka diagram&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Kafka ä½œç‚º client èˆ‡ server å…©é‚Šçš„æºé€šå¹³å°ï¼Œæä¾›äº†è¨±å¤š API è‘›ä¸åŒè§’è‰²ä½¿ç”¨ã€‚Producer ç”¢ç”Ÿ message åˆ°ç‰¹å®š topic ä¸Šï¼Œconsumer è¨‚é–±ç‰¹å®š topicsï¼Œkafak æŠŠç¬¦åˆæ¢ä»¶çš„è¨Šæ¯æ¨æ’­çµ¦ consumerã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Producer API: è®“ app publish ä¸€é€£çš„è¨Šæ¯&lt;/li&gt;
&lt;li&gt;Consumer API: è®“ app subscribe è¨±å¤šç‰¹å®š topicï¼Œä¸¦è™•ç†è¨Šæ¯ä¸²æµ(stream)&lt;/li&gt;
&lt;li&gt;Stream API: è®“ app ä½œç‚ºä¸²æµä¸­ä»‹è™•ç†(stream processor)&lt;/li&gt;
&lt;li&gt;Connect API: èˆ‡ producer èˆ‡ consumer å¯ä»¥å°å¤–éƒ¨æœå‹™é€£çµ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;topics--logs&#34;&gt;Topics &amp;amp; Logs&lt;/h1&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/log_anatomy.png&#34; alt=&#34;kafka-topics&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Topic æ˜¯ kafka ç‚ºè¨Šæ¯ä¸²æµæä¾›çš„æŠ½è±¡ï¼Œtopic æ˜¯è¨Šæ¯å‚³é€åˆ° kafka æ™‚è³¦äºˆçš„é¡åˆ¥(category)ï¼Œä½œç‚º publish èˆ‡ consume çš„åˆ¤æ–·ä¾æ“šã€‚&lt;/p&gt;
&lt;h1 id=&#34;partition&#34;&gt;Partition&lt;/h1&gt;
&lt;p&gt;è¨Šæ¯ä¾æ“š topic åˆ†é¡å­˜æ”¾ï¼Œä¸¦å¯ä»¥ä¾æ“š replication factor è¨­å®šï¼Œåœ¨ kafka ä¸­å­˜æ”¾å¤šå€‹è¨Šæ¯åˆ†å‰²(partition)ã€‚partition å¯ä»¥æƒ³æˆæ˜¯ message queue çš„å¹³è¡ŒåŒ– (parallel)ï¼Œä½µç™¼è™•ç†è¨Šæ¯å¯ä»¥å¤§å¹…ææ˜‡è¨Šæ¯æ¥æ”¶èˆ‡ç™¼é€çš„é€Ÿåº¦ï¼Œä¸¦ä¸”å¤šå€‹å‰¯æœ¬ä¹Ÿæé«˜è³‡æ–™çš„å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼è¨Šæ¯ç™¼é€è·Ÿæ¥æ”¶éç¨‹å¯èƒ½å› ç‚ºç¶²è·¯èˆ‡ç’°å¢ƒè€Œä¸ç©©å®šï¼Œé€™äº›ç›¸åŒ topic çš„ partition ä¸ä¸€å®šæœƒå®Œå…¨ä¸€æ¨£ã€‚ä½† kafka ç¢ºä¿äº†ä»¥ä¸‹å¹¾é»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;guarantees&#34;&gt;Guarantees&lt;/h1&gt;
&lt;p&gt;è‰¯å¥½é…ç½®çš„ kafka æœ‰ä»¥ä¸‹ä¿è­‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨Šæ¯åœ¨ç³»çµ±ä¸­é€å‡ºè·Ÿè¢«æ”¶åˆ°çš„æ™‚é–“ä¸ä¸€å®šï¼Œä½†kafakä¸­ï¼Œå¾ç›¸åŒ producer é€å‡ºçš„è¨Šæ¯ï¼Œé€åˆ° topic partition æœƒç¶­æŒé€å‡ºçš„é †åº&lt;/li&gt;
&lt;li&gt;Consumer çœ‹è¦‹çš„è¨Šæ¯æ˜¯èˆ‡ kafka ä¸­çš„å­˜æ”¾é †åºä¸€è‡´&lt;/li&gt;
&lt;li&gt;æœ‰ replication factor ç‚º N çš„ topic ï¼Œå¯ä»¥å®¹å¿(fault-tolerance) N-1 å€‹ kafka-server å£æ‰ï¼Œè€Œä¸å½±éŸ¿è³‡æ–™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç•¶ç„¶ï¼Œé€™é‚Šçš„å‰ææ˜¯æœ‰è‰¯å¥½é…ç½®ã€‚éŒ¯èª¤çš„é…ç½®å¯èƒ½æœƒå°è‡´è¨Šæ¯ä¸ç©©å®šï¼Œæ•ˆèƒ½ä½è½ï¼Œç”šè‡³éºå¤±ã€‚&lt;/p&gt;
&lt;h1 id=&#34;producer&#34;&gt;Producer&lt;/h1&gt;
&lt;p&gt;Producer è² è²¬æŠŠè¨Šæ¯æ¨å‘ä¸€å€‹ topicï¼Œä¸¦æŒ‡å®šè¨Šæ¯æ‡‰è©²æ”¾åœ¨ topic çš„å“ªå€‹ partitionã€‚&lt;/p&gt;
&lt;h1 id=&#34;consumer&#34;&gt;Consumer&lt;/h1&gt;
&lt;p&gt;Consumer æœƒè‡ªè¡Œæ¨™è¨˜ï¼Œå½¢æˆ consumer groupï¼Œé€é consumer group ä¾†ä¿éšœè¨Šæ¯å‚³éçš„æ¬¡åºï¼Œå®¹éŒ¯ï¼Œä»¥åŠæ“´å±•çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://kafka.apache.org/23/images/consumer-groups.png&#34; alt=&#34;consumer group&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Consumer é€é consumer group å…±äº«ä¸€å€‹ group.idã€‚&lt;/li&gt;
&lt;li&gt;Consumer group å»æ‰€æœ‰ partitions è£¡æ‹¿è¨Šæ¯ï¼Œæ‰€æœ‰ partitions çš„è¨Šæ¯åˆ†é…åˆ° consumer group ä¸­çš„ consumerã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;app åœ¨æ¥æ”¶è¨Šæ¯æ™‚ï¼Œè¨­ç½®æ­£ç¢ºçš„åŒ–ï¼Œåœ¨ä¸€å€‹ consumer group ä¸­ï¼Œå¯ä»¥å®¹å¿ consumer å¤±æ•ˆï¼Œä»èƒ½ç¢ºä¿è¨Šæ¯ä¸€æŒ‡å®šçš„æ¬¡åºé€é”ã€‚åœ¨éœ€è¦å¤§æµé‡æ™‚ï¼Œä¹Ÿå¯èª¿æ•´ consumer çš„æ•¸é‡æé«˜è² è¼‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç”¨ä¾‹&#34;&gt;ç”¨ä¾‹&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://kafka.apache.org/documentation/#uses&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kafka çš„ä½¿ç”¨ä¾‹å­&lt;/a&gt;éå¸¸çš„å¤šï¼Œä½¿ç”¨ç¯„åœéå¸¸å»£æ³›ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šæ˜¯è¨Šæ¯å‚³éçš„ä½¿ç”¨ä¾‹å­ï¼Œkafka å¤§å¤šèƒ½å‹ä»»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;p&gt;é€™é‚Šåªæäº† kafka çš„åŸºæœ¬æ¦‚å¿µï¼ŒåŸºæœ¬å…ƒä»¶ï¼Œä»¥åŠ consumer group æ©Ÿåˆ¶ï¼Œç‚ºæˆ‘å€‘åº•ä¸‹è¦è«‡çš„ configuration èˆ‡ topology é‹ªè·¯ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kafka Helm Configuration</title>
      <link>https://chechia.net/zh-hant/post/2019-09-23-kafka-helm-configuration/</link>
      <pubDate>Mon, 23 Sep 2019 21:55:29 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-23-kafka-helm-configuration/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kafka Deployment on Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/</link>
      <pubDate>Sun, 22 Sep 2019 09:58:41 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;ç¢å¿µ&#34;&gt;ç¢å¿µ&lt;/h1&gt;
&lt;p&gt;30 å¤©æ¯å¤©ä¸€æ–‡çœŸçš„è »é€¼äººçš„ï¼Œæ¯ä¸€ç¯‡éƒ½æ˜¯æ–°å¯«ï¼Œé‚„è¦ç›¡å¯èƒ½é¡§åŠæ–‡ç« å“è³ªï¼Œä¸‹ç­è¶•æ–‡ç« ï¼Œå„ä½å¤§å¾·å¯«çœ‹çœ‹å°±çŸ¥é“&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€™é‚Šèª¿æ•´äº†ç•¶åˆæƒ³å¯«çš„æ–‡ç« ï¼Œå…§å®¹æ‡‰è©²éƒ½æœƒå¸¶åˆ°
&lt;ul&gt;
&lt;li&gt;elk&lt;/li&gt;
&lt;li&gt;kafka-ha&lt;/li&gt;
&lt;li&gt;reids-ha&lt;/li&gt;
&lt;li&gt;prometheus&lt;/li&gt;
&lt;li&gt;kubernetes on gcp&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½†ä¸æœƒå†ä¸€ç¯‡ 10000 å­—äº†ï¼Œé€¼æ­»æˆ‘å§&amp;hellip;&lt;/li&gt;
&lt;li&gt;å¯«ä¸å®Œçš„éƒ¨ä»½ 30 å¤©å€™æœƒåœ¨ITé‚¦å¹«å¿™ï¼Œæˆ–æ˜¯&lt;a href=&#34;https:/chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ Github Page https://chechia.net/&lt;/a&gt;è£œå®Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯«æ–‡ç« çœŸçš„æ˜¯é«”åŠ›æ´»ï¼Œè¦ºå¾—æˆ‘çš„æ–‡ç« é‚„æœ‰åƒè€ƒåƒ¹å€¼ï¼Œè«‹å·¦é‚Šå¹«æˆ‘é»è®šæŒ‰å€‹å–œæ­¡ï¼Œå³ä¸Šè§’å¹«æˆ‘æŒ‰å€‹è¿½ç¸±ï¼Œåº•ä¸‹æ­¡è¿ç•™è¨€è¨è«–ã€‚çµ¦æˆ‘ä¸€é»ç¹¼çºŒèµ°ä¸‹å»çš„å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://d32l83enj9u8rg.cloudfront.net/wp-content/uploads/iStock-966846550-cat-overheating-simonkr-1-940x470.jpg&#34; alt=&#34;Exausted Cat Face&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ kafka&lt;/li&gt;
&lt;li&gt;éƒ¨å±¬ kafka åˆ° kubernetes ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç°¡ä»‹-kafka&#34;&gt;ç°¡ä»‹ kafka&lt;/h1&gt;
&lt;p&gt;Kafka æ˜¯åˆ†æ•£å¼çš„ streaming platformï¼Œå¯ä»¥ subscribe &amp;amp; publish è¨Šæ¯ï¼Œå¯ä»¥ç•¶ä½œæ˜¯ä¸€å€‹åŠŸèƒ½å¼·å¤§çš„ message queue ç³»çµ±ï¼Œç”±æ–¼åˆ†æ•£å¼çš„æ¶æ§‹ï¼Œè®“ kafka æœ‰å¾ˆå¤§ç¨‹åº¦çš„ fault toleranceã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä»Šå¤©å°±ä¾†éƒ¨å±¬ä¸€å€‹ kafkaã€‚&lt;/p&gt;
&lt;h1 id=&#34;deploy&#34;&gt;Deploy&lt;/h1&gt;
&lt;p&gt;æˆ‘æŠŠæˆ‘çš„å¯¶è—éƒ½åœ¨é€™äº†&lt;a href=&#34;https://github.com/chechiachang/kafka-on-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/kafka-on-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰ä¸‹ä¾†çš„ .sh ï¼Œè·‘ä¹‹å‰é¤Šæˆç¿’æ…£è²“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat install.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# https://github.com/helm/charts/tree/master/incubator/kafka&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#HELM_NAME=kafka&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kafka-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Stable: chart version: kafka-0.16.2	app version: 5.0.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;HELM_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; incubator/kafka --version 0.16.2 -f values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;helm&#34;&gt;Helm&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç”¨ helm éƒ¨å±¬ï¼Œä¹‹æ‰€ä»¥ç”¨ helm ï¼Œå› ç‚ºé€™æ˜¯æˆ‘æƒ³åˆ°æœ€ç°¡å–®çš„æ–¹æ³•ï¼Œèƒ½è®“è¼•é¬†æ“æœ‰ä¸€å¥—åŠŸèƒ½å®Œæ•´çš„ kafkaã€‚æ‰€ä»¥æˆ‘å€‘å…ˆç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ²’ç”¨é helm çš„å¤§å¾·å¯ä»¥åƒè€ƒ &lt;a href=&#34;https://helm.sh/docs/using_helm/#quickstart&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm Quickstart&lt;/a&gt;ï¼Œå…ˆæŠŠ helm cli èˆ‡ kubernetes ä¸Šçš„ helm tiller éƒ½è¨­å®šå¥½&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm init
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;helm-chart&#34;&gt;Helm Chart&lt;/h3&gt;
&lt;p&gt;ä¸€å€‹ helm chart å¯ä»¥ç•¶æˆä¸€å€‹ç¨ç«‹çš„å°ˆæ¡ˆï¼Œä¸åŒçš„ chart å¯ä»¥åœ¨ kubernetes ä¸Šå”åŠ©éƒ¨å±¬ä¸åŒçš„é …ç›®ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä½¿ç”¨äº†é‚„åœ¨ incubator çš„chartï¼Œé›–ç„¶æ˜¯ prod readyï¼Œä¸éä½¿ç”¨ä¸Šé‚„æ˜¯è¦æ³¨æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å‰å…ˆæŠŠ incubator çš„ helm repo åŠ é€²ä¾†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;install&#34;&gt;Install&lt;/h3&gt;
&lt;p&gt;é€™é‚Šæ˜¯ç”¨ upgrade &amp;ndash;installï¼Œå·²å®‰è£å°± upgradeï¼Œæ²’å®‰è£å°± installï¼Œä¹‹å¾Œå¯ä»¥ç”¨é€™å€‹æŒ‡ä»¤å‡ç‰ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install ${HELM_NAME} incubator/kafka --version 0.16.2 -f values-staging.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;version&#34;&gt;Version&lt;/h3&gt;
&lt;p&gt;é€™é‚Šä½¿ç”¨çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chart version:    kafka-0.16.2&lt;/li&gt;
&lt;li&gt;app version:      5.0.1&lt;/li&gt;
&lt;li&gt;kafka Image:      confluentinc/cp-kafka:5.0.1&lt;/li&gt;
&lt;li&gt;zookeeper Image:  gcr.io/google_samples/k8szk:v3&lt;/li&gt;
&lt;li&gt;kafka exporter:   danielqsj/kafka-exporter:v1.2.0&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;values-staging&#34;&gt;values-staging&lt;/h3&gt;
&lt;p&gt;é€é helm chartï¼ŒæŠŠå•Ÿå‹•åƒæ•¸å¸¶é€²å»ï¼Œé€™é‚Šæˆ‘å€‘çœ‹å¹¾å€‹æ¯”è¼ƒé‡è¦çš„ï¼Œç´°ç¯€ä¹‹å¾Œçš„æ–‡ç« åœ¨ä¸€èµ·è¨è«–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/chechiachang/kafka-on-kubernetes/blob/master/values-staging.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/chechiachang/kafka-on-kubernetes/blob/master/values-staging.yaml&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replicas: 3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£ä¸‰å€‹ kafkaï¼Œtopology çš„æ±è¥¿ä¹Ÿæ˜¯æ•¬å¾…ä¸‹ç¯‡XD&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The kafka image repository
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;image: &amp;#34;confluentinc/cp-kafka&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;## The kafka image tag
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;åº•å±¤åŸ·è¡Œçš„ kafka æ˜¯ conluent kafka
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;configure-resource-requests-and-limits&#34;&gt;Configure resource requests and limits&lt;/h2&gt;
&lt;h2 id=&#34;ref-httpkubernetesiodocsuser-guidecompute-resources&#34;&gt;ref: &lt;a href=&#34;http://kubernetes.io/docs/user-guide/compute-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://kubernetes.io/docs/user-guide/compute-resources/&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;resources: {}&lt;/p&gt;
&lt;h1 id=&#34;limits&#34;&gt;limits:&lt;/h1&gt;
&lt;h1 id=&#34;cpu-200m&#34;&gt;cpu: 200m&lt;/h1&gt;
&lt;h1 id=&#34;memory-4096mi&#34;&gt;memory: 4096Mi&lt;/h1&gt;
&lt;h1 id=&#34;requests&#34;&gt;requests:&lt;/h1&gt;
&lt;h1 id=&#34;cpu-100m&#34;&gt;cpu: 100m&lt;/h1&gt;
&lt;h1 id=&#34;memory-1024mi&#34;&gt;memory: 1024Mi&lt;/h1&gt;
&lt;p&gt;kafkaHeapOptions: &amp;ldquo;-Xmx4G -Xms1G&amp;rdquo;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;é€™é‚Šå¯ä»¥èª¿æ•´åœ¨ kubernetes ä¸Šé¢çš„ limit è·Ÿ request
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Deploy æœƒå…ˆå»è·Ÿ node å•å¤ ä¸å¤ ï¼Œå¤ çš„è©±è¦æ±‚ node ä¿ç•™é€™äº›è³‡æºçµ¦ Pod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Runtime è¶…é limitï¼ŒPod æœƒè¢« kubernetes å¹¹æ‰ï¼Œä¸éæˆ‘å€‘æ˜¯ JVMï¼Œå¤–éƒ¨ resource çˆ†æ‰å‰ï¼Œæ‡‰è©²æœƒå…ˆå›  heap æ»¿è€Œæ­»ã€‚ä¸€å€‹æ–½ä¸»è‡ªç›¡çš„æ„Ÿè¦ºã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* CPU è »çœçš„ï¼Œåƒæ¯”è¼ƒå¤šæ˜¯ memoryã€‚ä½†ä¹Ÿè¦çœ‹ä½ çš„ä½¿ç”¨æƒ…å¢ƒ
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;prometheus&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å°æˆ‘å€‘æœ‰ä¸Š promethuesï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ kafka-exporter æŠŠ kafka metrics å€’å‡ºå» prometheusï¼Œé€™å€‹ä¹Ÿæ˜¯è©³è¦‹ä¸‹å›åˆ†è§£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# è·‘èµ·ä¾†äº†
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;$ kubectl get po | grep kafka&lt;/p&gt;
&lt;p&gt;NAME                                                     READY   STATUS      RESTARTS   AGE
kafka-1-0                                                1/1     Running     0          224d
kafka-1-1                                                1/1     Running     0          224d
kafka-1-2                                                1/1     Running     0          224d
kafka-1-exporter-88786d84b-z954z                         1/1     Running     0          224d
kafka-1-zookeeper-0                                      1/1     Running     0          224d
kafka-1-zookeeper-1                                      1/1     Running     0          224d
kafka-1-zookeeper-2                                      1/1     Running     0          224d&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Logstash on GKE</title>
      <link>https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/</link>
      <pubDate>Sat, 21 Sep 2019 15:22:23 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹ logstash&lt;/li&gt;
&lt;li&gt;å°‡ logstash éƒ¨å±¬åˆ° kubernetes ä¸Š&lt;/li&gt;
&lt;li&gt;è¨­å®š logstash pipeline è™•ç† nginx access log&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä»‹ç´¹-logstash&#34;&gt;ä»‹ç´¹ Logstash&lt;/h1&gt;
&lt;p&gt;Logstash æ˜¯é–‹å…ƒçš„è³‡æ–™è™•ç†å¼•æ“ï¼Œå¯ä»¥å‹•æ…‹çš„å°‡è¼¸å…¥çš„è³‡æ–™åšå¤§é‡çš„è™•è£¡ã€‚åŸå…ˆçš„ç›®çš„æ˜¯è™•ç† log ï¼Œä½†ç›®å‰ä»¥ä¸é™æ–¼è™•ç† log ï¼Œå„ç¨® ELK beat æˆ–æ˜¯å…¶ä»–ä¾†æºçš„ä¸åŒç›£æ¸¬æ•¸æ“šï¼Œéƒ½èƒ½è™•ç†ã€‚&lt;/p&gt;
&lt;p&gt;Logastash å…§éƒ¨çš„åŠŸèƒ½ä¹Ÿå¤§å¤šæ¨¡çµ„åŒ–ï¼Œå› æ­¤å¯ä»¥çµ„è£ä¸åŒçš„ pluginï¼Œä¾†å¿«é€Ÿè™•ç†ä¸åŒä¾†æºè³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šå¸¸è¦‹çš„è³‡æ–™ä¾†æºï¼Œlogstash éƒ½èƒ½å¤ è™•ç†ï¼Œä¸¦ä¸”æœ‰å¯«å¥½çš„ plugin å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç´°ç¯€è«‹è¦‹&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/current/introduction.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;logstash å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://www.elastic.co/guide/en/logstash/current/static/images/logstash.png&#34; alt=&#34;å®˜æ–¹æ¶æ§‹åœ–&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h1 id=&#34;å¾Œé€è³‡æ–™åº«èˆ‡æœ€çµ‚å„²å­˜åº«&#34;&gt;å¾Œé€è³‡æ–™åº«èˆ‡æœ€çµ‚å„²å­˜åº«&lt;/h1&gt;
&lt;p&gt;åœ¨é–‹å§‹æ¶è¨­ logstash è¦å…ˆè€ƒæ…® pipeline è™•ç†éå¾Œé€çš„è³‡æ–™åº«ï¼Œ&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/current/introduction.html#_choose_your_stash&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯ä½¿ç”¨çš„è³‡æ–™åº«éå¸¸å¤š&lt;/a&gt;ï¼Œé€™é‚Šæœƒå±•ç¤ºçš„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stack æ¨™æº–é…å‚™é€åˆ° Elasticsearch
&lt;ul&gt;
&lt;li&gt;å­˜æ”¾æœƒæ™‚å¸¸æŸ¥è©¢çš„ç†±è³‡æ–™ï¼Œåªå­˜æ”¾ä¸€æ®µæ™‚é–“å‰çš„è³‡æ–™&lt;/li&gt;
&lt;li&gt;å¤ªèˆŠçš„è³‡æ–™è‡ªå‹• Rollout&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€çµ‚ archieving çš„è³‡æ–™åº«ï¼Œé€™é‚Šä½¿ç”¨ GCP çš„ Big Query
&lt;ul&gt;
&lt;li&gt;å­˜æ”¾æŸ¥æ‰¾æ¬¡æ•¸å°‘ï¼Œä½†éå¸¸å¤§é‡çš„æ­·å²ç´€éŒ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Elasticsearch åœ¨å‰å¹¾ç¯‡å·²ç¶“æ¶è¨­å¥½ï¼Œ&lt;a href=&#34;https://cloud.google.com/bigquery/docs/?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Big Query&lt;/a&gt; çš„è¨­å®šä¹Ÿäº‹å…ˆé–‹å¥½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;éƒ¨å±¬-logstash&#34;&gt;éƒ¨å±¬ Logstash&lt;/h1&gt;
&lt;p&gt;kubernetes resource çš„ yaml è«‹åƒè€ƒ &lt;a href=&#34;https://github.com/chechiachang/elk-kubernetes/tree/master/logstash&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ github elk-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f config-configmap.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f pipelines-configmap.yam
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”¾ä¸Šå»çš„ resource&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;config-configmap:
&lt;ul&gt;
&lt;li&gt;Logstash æœå‹™æœ¬èº«å•Ÿå‹•çš„è¨­å®šåƒæ•¸&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;pipelines-configmap:
&lt;ul&gt;
&lt;li&gt;Logstash çš„ pipelines è¨­å®šæª”æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Lostagh Deployment
&lt;ul&gt;
&lt;li&gt;Logastash çš„æœå‹™ instance&lt;/li&gt;
&lt;li&gt;å¯ä»¥å‹•æ…‹ scalingï¼Œä¹Ÿå°±æ˜¯æœƒæœ‰è¤‡æ•¸ Logstash instance åšè² è¼‰å‡è¡¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Logstash service
&lt;ul&gt;
&lt;li&gt;å¯é€é kubernetes å…§éƒ¨çš„ kube-dns æœå‹™&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å…§çš„ filebeat å¯ä»¥ç›´æ¥é€é logstash.default.svc.chechiachang-cluster.local çš„ dns é€£ç·š logstash&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å…§çš„ç¶²è·¯ï¼Œç›´æ¥ä½¿ç”¨ httpï¼ˆç•¶ç„¶ä½¿ç”¨ https ä¹Ÿæ˜¯å¯ä»¥ï¼Œç›¸é—œæ­¥é©Ÿè«‹è¦‹å‰å¹¾ç¯‡æ–‡ç« ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç°¡å–®è¬›ä¸€ä¸‹ kubernetes service çš„è² è¼‰å‡è¡¡ï¼Œé—œæ–¼ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes service ç´°ç¯€é€™ç¯‡é™„ä¸Šæ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get services
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;logstash          ClusterIP      10.15.254.47    &amp;lt;none&amp;gt;          5044/TCP   182d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get endpoints
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME              ENDPOINTS                                                          AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;logstash          10.12.0.132:5044,10.12.10.162:5044,10.12.9.167:5044 + 12 more...   182d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes å…§éƒ¨æ¯å€‹ Pod éƒ½èƒ½çœ‹åˆ° logstash, logstash.default.svc.chechiachang-cluster.local é€™å…©å€‹ dns&lt;/li&gt;
&lt;li&gt;DNS ç›´æ¥æŒ‡å‘è¤‡æ•¸çš„ logstash endpointsï¼Œ æ¯ä¸€å€‹ ip éƒ½æ˜¯ kubernetes å…§éƒ¨é…ç½®çš„ä¸€å€‹ Pod çš„ IPï¼Œé–‹å•Ÿ 5044 çš„ logstash port&lt;/li&gt;
&lt;li&gt;Service çš„ load balance æ©Ÿåˆ¶è¦– service è¨­å®šï¼Œç´°ç¯€å¯ä»¥çœ‹&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€™é‚Š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¬›åˆ°æœ€ç™½ï¼Œå°±æ˜¯ filebeat LOGSTASH URL è¨­å®šç‚º http://logstash å°±æœƒæ‰“åˆ°å…¶ä¸­ä¸€å° logstash&lt;/p&gt;
&lt;p&gt;æ›´æ”¹ filebeat configmap&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl edit configmap filebeat-configmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Disable output to elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Output to logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.logstash:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: [&amp;#34;logstash:5044&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;http&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è¨­å®š-logstash&#34;&gt;è¨­å®š logstash&lt;/h1&gt;
&lt;p&gt;é€™é‚Šè¦å…ˆèªªï¼Œlogstash ä¹Ÿæ”¯æ´ &lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/configuring-centralized-pipelines.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;centralized configuration&lt;/a&gt;ï¼Œå¦‚æœä½ çš„ logstash ä¸æ˜¯è·‘åœ¨ Kubernetes ä¸Šï¼Œæ²’è¾¦æ³•é…ç½®ä¸€å¥— configmap å°±æ‡‰ç”¨åˆ°å…¨éƒ¨çš„ instanceï¼Œè¨˜çš„ä¸€å®šè¦ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Logastash çš„é‹è¡Œè¨­å®š logstash.ymlï¼Œé€™é‚Šæˆ‘å€‘æ²’æœ‰åšè¨­å®šï¼Œéƒ½æ˜¯é è¨­å€¼ï¼Œæœ‰éœ€æ±‚å¯ä»¥è‡ªè¡Œæ›´æ”¹&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶ä¹‹å¾Œè¦èª¿æ•´ batch size æˆ–æ˜¯ queue, cache ç­‰ç­‰æ•ˆèƒ½èª¿æ ¡ï¼Œä¹Ÿæ˜¯ä¾†é€™é‚Šæ”¹ï¼Œæ”¹å®Œ configmap ï¼Œrolling update logstash å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä¸»è¦æ˜¯ä¾†è¬› pipeline è¨­å®šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl describe configmap pipelines-configmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: ConfigMap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: logstash-pipelines
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  labels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    k8s-app: logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;data:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Nginx Template
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # https://www.elastic.co/guide/en/logstash/7.3/logstash-config-for-filebeat-modules.html#parsing-nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  nginx.conf: |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Configmap è£¡é¢åªæœ‰ä¸€å€‹ pipelineï¼Œå°±æ˜¯ &lt;code&gt;nginx.conf&lt;/code&gt;ï¼Œæˆ‘å€‘é€™é‚Šå°±åªæœ‰ä¸€æ¢ï¼Œé€™é‚Šä¸€æ®µä¸€æ®µçœ‹&lt;/p&gt;
&lt;h3 id=&#34;input&#34;&gt;Input&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;input {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  beats {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # The lisening port of logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    port =&amp;gt; 5044
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    host =&amp;gt; &amp;#34;0.0.0.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨­å®š Input ä¾†æºï¼Œæ˜¯ beat å¾ 5044 é€²ä¾†&lt;/p&gt;
&lt;h3 id=&#34;filter&#34;&gt;Filter&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹ä¾†ä¸€å¤§æ®µæ˜¯ filterï¼Œæ¯å€‹ filter ä¸­é–“çš„ block éƒ½æ˜¯ä¸€å€‹ pluginï¼Œlogstash æ”¯æ´éå¸¸å¤šæœ‰è¶£çš„ plugin ï¼Œè™•ç†ä¸åŒä¾†æºçš„å·¥ä½œï¼Œ&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/filter-plugins.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç´°ç¯€è«‹çœ‹é€™ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filter {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Ignore data from other source in case filebeat input is incorrectly configured.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  if [kubernetes][container][name] == &amp;#34;nginx-ingress-controller&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Parse message with grok
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Use grok debugger in kibana -&amp;gt; dev_tools -&amp;gt; grok_debugger
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    grok {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      match =&amp;gt; { &amp;#34;message&amp;#34; =&amp;gt; &amp;#34;%{IPORHOST:[nginx][access][remote_ip]} - \[%{IPORHOST:[nginx][access][remote_ip_list]}\] - %{DATA:[nginx][access][user_name]} \[%{HTTPDATE:[nginx][access][time]}\] \&amp;#34;%{WORD:[nginx][access][method]} %{DATA:[nginx][access][request_url]} HTTP/%{NUMBER:[nginx][access][http_version]}\&amp;#34; %{NUMBER:[nginx][access][response_code]} %{NUMBER:[nginx][access][body_sent][bytes]} \&amp;#34;%{DATA:[nginx][access][referrer]}\&amp;#34; \&amp;#34;%{DATA:[nginx][access][agent]}\&amp;#34; %{NUMBER:[nginx][access][request_length]} %{NUMBER:[nginx][access][request_time]} \[%{DATA:[nginx][access][proxy_upstream_name]}\] %{DATA:[nginx][access][upstream_addr]} %{NUMBER:[nginx][access][upstream_response_length]} %{NUMBER:[nginx][access][upstream_response_time]} %{NUMBER:[nginx][access][upstream_status]} %{DATA:[nginx][access][req_id]}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Match url parameters if has params
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    grok {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      match =&amp;gt; { &amp;#34;[nginx][access][request_url]&amp;#34; =&amp;gt; &amp;#34;%{DATA:[nginx][access][url]}\?%{DATA:[nginx][access][url_params]}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Remove and add fields
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    mutate {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      remove_field =&amp;gt; &amp;#34;[nginx][access][request_url]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      add_field =&amp;gt; { &amp;#34;read_timestamp&amp;#34; =&amp;gt; &amp;#34;%{@timestamp}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      # Add fileset.module:nginx to fit nginx dashboard
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      add_field =&amp;gt; { &amp;#34;[fileset][module]&amp;#34; =&amp;gt; &amp;#34;nginx&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      add_field =&amp;gt; { &amp;#34;[fileset][name]&amp;#34; =&amp;gt; &amp;#34;access&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Parse date string into timestamp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    date {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      match =&amp;gt; [ &amp;#34;[nginx][access][time]&amp;#34;, &amp;#34;dd/MMM/YYYY:H:m:s Z&amp;#34; ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      remove_field =&amp;gt; &amp;#34;[nginx][access][time]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Split url_parameters with &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # /api?uuid=123&amp;amp;query=456 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # become 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # nginx.access.url_params.uuid=123 nginx.access.url_params.query=456
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    kv {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source =&amp;gt; &amp;#34;[nginx][access][url_params]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      field_split =&amp;gt; &amp;#34;&amp;amp;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Parse useragent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    useragent {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source =&amp;gt; &amp;#34;[nginx][access][agent]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      target =&amp;gt; &amp;#34;[nginx][access][user_agent]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      remove_field =&amp;gt; &amp;#34;[nginx][access][agent]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Search remote_ip with GeoIP database, output geoip information for map drawing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    geoip {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      source =&amp;gt; &amp;#34;[nginx][access][remote_ip]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      target =&amp;gt; &amp;#34;[nginx][access][geoip]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      #fields =&amp;gt; [&amp;#34;country_name&amp;#34;,&amp;#34;city_name&amp;#34;,&amp;#34;real_region_name&amp;#34;,&amp;#34;latitude&amp;#34;,&amp;#34;longitude&amp;#34;,&amp;#34;ip&amp;#34;,&amp;#34;location&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # ==============
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Remove message to reduce data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # ==============
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    if [nginx][access][url] {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      mutate {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # source:/var/lib/docker/containers/6e608bfc0a437c038a1dbdf2e3d28619648b58a1d1ac58635f8178fc5f871109/6e608bfc0a437c038a1dbdf2e3d28619648b58a1d1ac58635f8178fc5f871109-json.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[source]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # Origin message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[message]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        #add_field =&amp;gt; { &amp;#34;[nginx][access][message]&amp;#34; =&amp;gt; &amp;#34;[message]&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[nginx][access][message]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        # url_params:client_id=1d5ffd378296c154d3e32e5890d6f4eb&amp;amp;timestamp=1546849955&amp;amp;nonce=9a52e3e6283f2a9263e5301b6724e2c0d723def860c4724c9121470152a42318
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        remove_field =&amp;gt; &amp;#34;[nginx][access][url_params]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  } # nginx-ingress-controller
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;} # filter
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;grok&#34;&gt;Grok&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/plugins-filters-grok.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grok æœ¬èº«çš„æ–‡ä»¶&lt;/a&gt;åˆæ˜¯ä¸€å¤§æ®µï¼Œå€‹äººå»ºè­°å„è·¯å¤§å¾·ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œè«‹ç›´æ¥æœå°‹äººå®¶é…ç½®å¥½çš„è¨­å®šï¼Œä¸è¦è‡ªå·±å¯«&lt;/p&gt;
&lt;p&gt;çœŸçš„è¦å¯«çš„è©±è¦å–„ç”¨å·¥å…·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kibana Grok Debugger &lt;code&gt;YOUR_KIBANA_HOST/app/kibana#/dev_tools/grokdebugger&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯ä¸çŸ¥åå¤§å¾·è²¢ç»&lt;a href=&#34;https://grokdebug.herokuapp.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç·šä¸Š Debugger&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grok {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  match =&amp;gt; { &amp;#34;message&amp;#34; =&amp;gt; &amp;#34;%{IPORHOST:[nginx][access][remote_ip]} - \[%{IPORHOST:[nginx][access][remote_ip_list]}\] - %{DATA:[nginx][access][user_name]} \[%{HTTPDATE:[nginx][access][time]}\] \&amp;#34;%{WORD:[nginx][access][method]} %{DATA:[nginx][access][request_url]} HTTP/%{NUMBER:[nginx][access][http_version]}\&amp;#34; %{NUMBER:[nginx][access][response_code]} %{NUMBER:[nginx][access][body_sent][bytes]} \&amp;#34;%{DATA:[nginx][access][referrer]}\&amp;#34; \&amp;#34;%{DATA:[nginx][access][agent]}\&amp;#34; %{NUMBER:[nginx][access][request_length]} %{NUMBER:[nginx][access][request_time]} \[%{DATA:[nginx][access][proxy_upstream_name]}\] %{DATA:[nginx][access][upstream_addr]} %{NUMBER:[nginx][access][upstream_response_length]} %{NUMBER:[nginx][access][upstream_response_time]} %{NUMBER:[nginx][access][upstream_status]} %{DATA:[nginx][access][req_id]}&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶å¯¦å°±æ˜¯ nginx çš„ access log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1.2.3.4 - [1.2.3.4] - - [21/Sep/2019:07:21:21 +0000] &amp;#34;GET /v1/core/api/list?type=queued&amp;amp;timestamp=1569050481&amp;amp;nonce=d1e80e00381e0ba6e42d4601912befcf03fbf291748e77b178230c19cd1fdbe2 HTTP/1.1&amp;#34; 200 3 &amp;#34;-&amp;#34; &amp;#34;python-requests/2.18.4&amp;#34; 425 0.031 [default-chechiachang-server-80] 10.12.10.124:8003 3 0.031 200 f43db228afe66da67b2c7417d0ad2c04
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é è¨­çš„ log é€ä»¶ä¾†ï¼Œæ ¼å¼æ˜¯ textï¼Œç¶“é pattern matching å¾Œè®Šæˆ json-like formatï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾è³‡æ–™çµæ§‹å–å¾— &lt;code&gt;.nginx.access.remote_ip&lt;/code&gt; é€™æ¨£çš„æ¬„ä½ï¼Œè®“åŸæœ¬çš„ access log å¾ text è®Šæˆå¯ä»¥æŸ¥æ‰¾çš„å…§å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åŸæœ¬çš„ text é€é€² elasticsearch ç•¶ç„¶ä¹Ÿå¯ä»¥æŸ¥æ‰¾ï¼Œä½†å°±æœƒåœ¨ text è£¡é¢åšå…¨æ–‡æª¢ç´¢ï¼ŒåŠŸèƒ½å¾ˆä¾·é™ï¼Œæ•ˆç‡å¾ˆå·®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;output&#34;&gt;Output&lt;/h3&gt;
&lt;p&gt;logstash æ”¯æ´çš„ output ä»¥åŠè¨­å®š&lt;a href=&#34;https://www.elastic.co/guide/en/logstash/7.3/output-plugins.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨é€™é‚Š&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  elasticsearch {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    hosts =&amp;gt; [&amp;#34;https://${ELASTICSEARCH_HOST}:${ELASTICSEARCH_PORT}&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    user =&amp;gt; &amp;#34;${ELASTICSEARCH_USERNAME}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    password =&amp;gt; &amp;#34;${ELASTICSEARCH_PASSWORD}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    index =&amp;gt; &amp;#34;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    manage_template =&amp;gt; false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Elasticsearch çš„é…ç½®å¾ˆå–®ç´”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  google_bigquery {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    project_id =&amp;gt; ${GCP_PROJECT_ID}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    dataset =&amp;gt; ${GCP_BIG_QUERY_DATASET_NAME}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    csv_schema =&amp;gt; &amp;#34;path:STRING,status:INTEGER,score:FLOAT&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    json_key_file =&amp;gt; ${GCP_JSON_KEY_FILE_PATH}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    error_directory =&amp;gt; &amp;#34;/tmp/bigquery-errors&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    date_pattern =&amp;gt; &amp;#34;%Y-%m-%dT%H:00&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    flush_interval_secs =&amp;gt; 30
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­çš„è®Šæ•¸ï¼Œæˆ‘å€‘å…¨éƒ½ç”¨ç’°å¢ƒè®Šæ•¸ï¼Œåœ¨ deployment.yaml é…ç½®ï¼Œå•Ÿå‹• logstash pods æ™‚ä»£å…¥&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GCP_JSON_KEY_FILE_PATH&lt;/code&gt; é€™é‚Šè¦é…ç½®ä¸€éš» GCP çš„æœå‹™å¸³è™Ÿé‡‘é‘°ï¼Œä¸€å€‹æœ‰ Big Query å¯«å…¥æ¬Šé™çš„ service accountï¼ŒæŠŠ json ä½¿ç”¨ kubernetes secret æ”¾åˆ°é›†ç¾¤ä¸Šï¼Œç„¶å¾Œåœ¨ pod ä¸Šä½¿ç”¨ volume from secret æ›è¼‰é€²ä¾†ã€‚
&lt;code&gt;csv_schema =&amp;gt; &amp;quot;path:STRING,status:INTEGER,score:FLOAT&amp;quot;&lt;/code&gt; é€™é‚Šè¦é…ç½®ä¹‹å¾Œæœƒå­˜å…¥ Big Query çš„ csv çµæ§‹&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;éƒ¨å±¬ Logstash deployment åˆ° kubernetes ä¸Š&lt;/li&gt;
&lt;li&gt;è¨­å®š pipelineï¼Œè¶…å¤š pluginï¼Œæ—ç¹ä¸åŠå‚™è¼‰&lt;/li&gt;
&lt;li&gt;Grok é…ç½®&lt;/li&gt;
&lt;li&gt;Big Query output é…ç½®&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Monitoring GKE With Elk</title>
      <link>https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/</link>
      <pubDate>Thu, 19 Sep 2019 17:06:29 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é€™ç¯‡ä¾†è¦ Kubernetes ç’°å¢ƒ(GKE)è£¡é¢çš„ log æŠ“å‡ºä¾†ï¼Œé€åˆ° ELK ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/running-on-kubernetes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt; ï¼Œå¯«å¾—å¾ˆç°¡æ˜“ï¼Œå¦‚æœå·²ç¶“å¾ˆç†Ÿ kubernetes çš„äººå¯ä»¥ç›´æ¥è…¦è£œå…¶ä»–çš„éƒ¨å±¬è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šæœ‰å¹¾å€‹åšæ³•ï¼Œä¾ç…§ filebeat éƒ¨ç½²çš„ä½ç½®èˆ‡æ”¶é›†ç›®æ¨™ç°¡å–®åˆ†ç‚ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node: è™•ç†æ¯ä¸€å° node çš„ log ï¼ŒåŒ…å« system log èˆ‡ node ç›£æ¸¬è³‡æ–™(metrics)&lt;/li&gt;
&lt;li&gt;cluster: è™•ç† cluster ç­‰ç´šçš„ log,  event æˆ–æ˜¯ metrics&lt;/li&gt;
&lt;li&gt;pod: é‡å°ç‰¹å®š pod ç›´æ¥å»æ›ä¸€å€‹ sidecar&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„æ–¹æ³•æ˜¯å¯ä»¥æ··æ­çš„ï¼Œkubernetes å€‹å€‹å±¤ç´šæœ‰&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/logging/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;log è™•ç†æµç¨‹&lt;/a&gt;ï¼Œæˆ‘å€‘é€™é‚ŠæŠŠ log é€å¾€ç¬¬ä¸‰æ–¹å¹³å°ï¼Œä¹Ÿæ˜¯éœ€è¦ä¾ç…§åŸæœ¬çš„ log æµç¨‹ï¼Œå»æ”¶å–æˆ‘å€‘æƒ³æ”¶é›†çš„ logã€‚&lt;/p&gt;
&lt;p&gt;ç°¡å–®ä¾†èªªï¼Œæ˜¯å»å°çš„åœ°æ–¹æ‰¾å°çš„ logã€‚åœ¨æ¶æ§‹ä¸Šè¦æ³¨æ„ scalability èˆ‡ resource åˆ†é…ï¼Œä¸è¦å½±éŸ¿æœ¬èº«æä¾›æœå‹™çš„ GKE ï¼Œä½†åˆèƒ½ç²å¾—ç›¡é‡å³æ™‚çš„ logã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç›´æ¥é€²å…¥ kubernetes resource çš„è¨­å®šï¼Œåº•ä¸‹æœƒé™„ä¸Šåœ¨ GKE æ‰¾ log çš„éç¨‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;node-level-log-harvest&#34;&gt;Node level log harvest&lt;/h1&gt;
&lt;p&gt;ç‚ºæ¯ä¸€å€‹ node é…ç½® filebeatï¼Œç„¶å¾Œåœ¨ node ä¸Šé¢å°‹æ‰¾ logï¼Œç„¶å¾Œå¦‚æˆ‘å€‘ä¸Šç¯‡æ‰€æ•˜è¿°åŠ åˆ° input ï¼Œå°±å¯ä»¥æŠŠ log å€’å‡ºä¾†ã€‚&lt;/p&gt;
&lt;p&gt;ç›´è¦ºæƒ³åˆ°å°±æ˜¯é€é daemonsets ç‚ºæ¯å€‹ node éƒ¨ç½²ä¸€å€‹ filebeat podï¼Œç„¶å¾Œ mount node çš„ log è³‡æ–™å¤¾ï¼Œåœ¨è¨­ç½® inputã€‚&lt;/p&gt;
&lt;h1 id=&#34;deploy-daemonsets&#34;&gt;Deploy daemonsets&lt;/h1&gt;
&lt;p&gt;kubernetes resource çš„ yaml è«‹åƒè€ƒ &lt;a href=&#34;https://github.com/chechiachang/elk-kubernetes/tree/master/filebeat/7.3.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ github elk-kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;çµ¦äºˆè¶³å¤ çš„ clusterrolebinding åˆ° elk&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f filebeat/7.3.1/clusterrolebinding.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…ˆæ›´æ”¹ filebeat çš„è¨­å®šï¼Œå¦‚ä½•è¨­å®š elasticsearch èˆ‡ kibanaï¼Œè«‹åƒè€ƒä¸Šç¯‡ã€‚è‡³æ–¼ input çš„éƒ¨ä»½å·²ç¶“é…ç½®å¥½äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim filebeat/7.3.1/daemonsets-config-configmap.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f filebeat/7.3.1/daemonsets-config-configmap.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨å±¬ filebeat daemonsetsï¼Œæœƒæ¯ä¸€å€‹ node éƒ¨å±¬ä¸€å€‹ filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f filebeat/7.3.1/daemonsets.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å–å¾— daemonsets çš„ç‹€æ…‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --namespcae elk get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME             READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat-bjfp9   1/1     Running   0          6m56s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat-fzr9n   1/1     Running   0          6m56s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat-vpkm7   1/1     Running   0          6m56s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰è¨­å®šæˆåŠŸçš„è©±ï¼Œkibana é€™é‚Šå°±æœƒæ”¶åˆ° kubernetes ä¸Šé¢ pod çš„ log&lt;/p&gt;
&lt;h1 id=&#34;log-havest-for-specific-pods&#34;&gt;log havest for specific pods&lt;/h1&gt;
&lt;p&gt;ç”±æ–¼ kubernetes ä¸Šæˆ‘å€‘å¯ä»¥ä¾¿åˆ©çš„èª¿åº¦ filebeat çš„éƒ¨å±¬æ–¹å¼ï¼Œé€™é‚Šä¹Ÿå¯ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨ deployment ï¼Œé…åˆ pod affinityï¼ŒæŠŠ filebeat æ”¾åˆ°æŸå€‹æƒ³è¦ç›£æ¸¬çš„ podï¼Œé€™é‚Šçš„ä¾‹å­æ˜¯ nginx-ingress-controllerã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes ä¸Šæœ‰ä¸€å€‹æˆ–å¤šå€‹ nginx ingress controller&lt;/li&gt;
&lt;li&gt;éƒ¨å±¬ä¸€å€‹æˆ–å¤šå€‹ filebeat åˆ°æœ‰ nginx çš„ node ä¸Š&lt;/li&gt;
&lt;li&gt;filebeat å»æŠ“å– nginx çš„ inputï¼Œ ä¸¦ä½¿ç”¨ filebeat çš„ nginx module åšé è™•ç†
&lt;ul&gt;
&lt;li&gt;nginx module é è¨­è·¯å¾‘éœ€è¦èª¿æ•´ï¼Œé€™é‚Šä½¿ç”¨ filebeat autodiscover ä¾†è™•ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€æ¨£ apply å‰è¨˜å¾—å…ˆæª¢æŸ¥è·Ÿè¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim filebeat/7.3.1/nginx-config-configmap.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f filebeat/7.3.1/nginx-config-configmap.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨å±¬ filebeat deployment
ç”±æ–¼æœ‰è¨­å®š pod affinity ï¼Œé€™å€‹ filebeat åªæœƒè¢«æ”¾åˆ°æœ‰ nginx ingress controller çš„é€™å€‹ç¯€é»ä¸Šï¼Œä¸¦ä¸”ä¾ç…§ autodiscover è¨­å®šçš„æ¢ä»¶å»è’é›† nginx çš„ log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f filebeat/7.3.1/nginx-deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰è¨­å®šæˆåŠŸçš„è©±ï¼Œkibana é€™é‚Šå°±æœƒæ”¶åˆ° kubernetes ä¸Šé¢ pod çš„ log&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œç”±æ–¼æœ‰å•Ÿå‹• nginx moduleï¼Œlogstash æ”¶åˆ°çš„å…§å®¹å·²ç¶“æ˜¯è™•ç†éå¾—å…§å®¹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;gcp-fluentd&#34;&gt;GCP fluentd&lt;/h1&gt;
&lt;p&gt;å¦‚æœæ˜¯ä½¿ç”¨ GKE çš„æœ‹å‹ï¼Œå¯ä»¥æŠ•éé–‹å•Ÿ stackdriver logging çš„åŠŸèƒ½ï¼ŒæŠŠé›†ç¾¤ä¸­æœå‹™çš„ log å€’åˆ° stackdriverï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ node -&amp;gt; (daemonsets) fluentd -&amp;gt; stackdriverã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ fluentd æ˜¯ GCP å¦‚æœæœ‰å•Ÿå‹• Stackdriver Logging çš„è©±ï¼Œè‡ªå‹•å¹«ä½ ç¶­è­·çš„ daemonsetsï¼Œè¨­å®šä¸å¯æ”¹ï¼Œæ”¹äº†æœƒè¢« overwrite æœƒå»ï¼Œæ‰€ä»¥ä¸å¤ªæ–¹ä¾¿å¾é€™é‚Šå‹•æ‰‹è…³ã€‚&lt;/p&gt;
&lt;p&gt;Btw stackdriver æœ€è¿‘å¥½åƒæ”¹ç‰ˆï¼Œç›®å‰åš example çš„ç‰ˆæœ¬å·²ç¶“è®Šæˆ lagency ï¼ˆæ·š&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘å€‘å…ˆå‡è¨­æˆ‘å€‘å°é€™å€‹ pod çš„ log å¾ˆæœ‰èˆˆè¶£ï¼Œç„¶å¾ŒæŠŠé€™é‚Šçš„ log é€é filebeat é€åˆ° ELK ä¸ŠXD&lt;/p&gt;
&lt;p&gt;å› ç‚º GKE é€é fluentd æŠŠ GKE ä¸Šé¢çš„ log å€’åˆ° stackdriverï¼Œè€Œæˆ‘å€‘æ˜¯æƒ³æŠŠ log å€’åˆ° ELKï¼Œæ—¢ç„¶é€™æ¨£æˆ‘å€‘çš„ input ä¾†æºæ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”å¾ˆå¤šè™•ç†æ­¥é©Ÿéƒ½å¯ä»¥åœ¨ ELK ä¸Šé¢äº’é€šï¼ŒçœŸçš„å¯ä»¥å·çœ‹ä¸€ä¸‹ fluentd æ˜¯å»å“ªæ”¶é›† log ï¼Œæ€éº¼è™•ç† log pipelineï¼Œæˆ‘å€‘åªè¦åšç›¸æ‡‰è¨­å®šå°±å¥½ã€‚&lt;/p&gt;
&lt;p&gt;ç•¢ç«Ÿ google éƒ½å¹«æˆ‘å€‘å¼„å¾—å¦¥å¦¥çš„ï¼Œä¸åƒè€ƒä¸€ä¸‹ä»–çš„æµç¨‹å¤ªå¯æƒœã€‚&lt;/p&gt;
&lt;p&gt;å·çœ‹ä¸€ä¸‹ GKE ä¸Š fluentd æ˜¯å»å“ªæ‰¾ log ï¼Œé€™å€‹æ˜¯ &lt;a href=&#34;https://github.com/kubernetes/kubernetes/blob/master/cluster/addons/fluentd-gcp/fluentd-gcp-configmap.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;fluentd gcp configmap&lt;/a&gt;ï¼Œé›–ç„¶çœ‹åˆ°é€™é‚Šæ„Ÿè¦ºæ‰¯é äº†ï¼Œä½†å› ç‚ºå¾ˆæœ‰è¶£æ‰€æœ‰æˆ‘å°±ç¹¼çºŒçœ‹ä¸‹å»ï¼Œå„ä½å¤§å¾·å¯ä»¥è·³éXD&lt;/p&gt;
&lt;p&gt;configmap ä¸­çš„é€™å€‹ input è¨­å®šæª”ï¼Œå…¶ä¸­ä¸€å€‹ source å°±æ˜¯ä¸€å€‹è³‡æ–™ä¾†æºï¼Œç›¸ç•¶æ–¼ filebeat çš„ inputã€‚é€™é‚Šé€™å€‹ source å°±æ˜¯å» &lt;code&gt;/var/log/containers/*.log&lt;/code&gt;  æ”¶ log&lt;/p&gt;
&lt;p&gt;é€™é‚Šé‚„åšäº†å¹¾ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“ä¸Š &lt;code&gt;reform.*&lt;/code&gt; tagï¼Œè®“ä¸‹å€‹ match å¯ä»¥ æ”¶é€²å» pipeline è™•ç†&lt;/li&gt;
&lt;li&gt;é™„å¸¶ parse å‡º time&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;containers.input.conf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;source&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  @type tail
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  path /var/log/containers/*.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pos_file /var/log/gcp-containers.log.pos
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Tags at this point are in the format of:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # reform.var.log.containers.&amp;lt;POD_NAME&amp;gt;_&amp;lt;NAMESPACE_NAME&amp;gt;_&amp;lt;CONTAINER_NAME&amp;gt;-&amp;lt;CONTAINER_ID&amp;gt;.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tag reform.*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  read_from_head true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;lt;parse&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @type multi_format
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;pattern&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      format json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      time_key time
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      time_format %Y-%m-%dT%H:%M:%S.%NZ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;/pattern&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;pattern&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      format /^(?&amp;lt;time&amp;gt;.+) (?&amp;lt;stream&amp;gt;stdout|stderr) [^ ]* (?&amp;lt;log&amp;gt;.*)$/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      time_format %Y-%m-%dT%H:%M:%S.%N%:z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;lt;/pattern&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;lt;/parse&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/source&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»–é€™é‚Šåšä¸€äº› error handlingï¼Œç„¶å¾Œç”¨ ruby (!) parseï¼Œé€™é‚Šå°±çœŸçš„å¤ªé ï¼Œç´°ç¯€å¤§å®¶å¯ä»¥ google ï¼¸ï¼¤ã€‚ä¸éé€™é‚Šä½¿ç”¨çš„ pattern matching æˆ‘å€‘å¾Œå¹¾ç¯‡åœ¨ logstash pipeline ä¸Šï¼Œä¹Ÿæœƒæœ‰æ©Ÿæœƒæåˆ°ï¼Œæ©Ÿåˆ¶æ˜¯é¡ä¼¼çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;filter reform.**&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  @type parser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  format /^(?&amp;lt;severity&amp;gt;\w)(?&amp;lt;time&amp;gt;\d{4} [^\s]*)\s+(?&amp;lt;pid&amp;gt;\d+)\s+(?&amp;lt;source&amp;gt;[^ \]]+)\] (?&amp;lt;log&amp;gt;.*)/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  reserve_data true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  suppress_parse_error_log true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  emit_invalid_record_to_error false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  key_name log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/filter&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;match reform.**&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  @type record_reformer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enable_ruby true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;lt;record&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Extract local_resource_id from tag for &amp;#39;k8s_container&amp;#39; monitored
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # resource. The format is:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # &amp;#39;k8s_container.&amp;lt;namespace_name&amp;gt;.&amp;lt;pod_name&amp;gt;.&amp;lt;container_name&amp;gt;&amp;#39;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;logging.googleapis.com/local_resource_id&amp;#34; ${&amp;#34;k8s_container.#{tag_suffix[4].rpartition(&amp;#39;.&amp;#39;)[0].split(&amp;#39;_&amp;#39;)[1]}.#{tag_suffix[4].rpartition(&amp;#39;.&amp;#39;)[0].split(&amp;#39;_&amp;#39;)[0]}.#{tag_suffix[4].rpartition(&amp;#39;.&amp;#39;)[0].split(&amp;#39;_&amp;#39;)[2].rpartition(&amp;#39;-&amp;#39;)[0]}&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # Rename the field &amp;#39;log&amp;#39; to a more generic field &amp;#39;message&amp;#39;. This way the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # fluent-plugin-google-cloud knows to flatten the field as textPayload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # instead of jsonPayload after extracting &amp;#39;time&amp;#39;, &amp;#39;severity&amp;#39; and
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # &amp;#39;stream&amp;#39; from the record.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    message ${record[&amp;#39;log&amp;#39;]}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # If &amp;#39;severity&amp;#39; is not set, assume stderr is ERROR and stdout is INFO.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    severity ${record[&amp;#39;severity&amp;#39;] || if record[&amp;#39;stream&amp;#39;] == &amp;#39;stderr&amp;#39; then &amp;#39;ERROR&amp;#39; else &amp;#39;INFO&amp;#39; end}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;lt;/record&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tag ${if record[&amp;#39;stream&amp;#39;] == &amp;#39;stderr&amp;#39; then &amp;#39;raw.stderr&amp;#39; else &amp;#39;raw.stdout&amp;#39; end}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  remove_keys stream,log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/match&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ssh-é€²å»é€›&#34;&gt;ssh é€²å»é€›&lt;/h3&gt;
&lt;p&gt;æƒ³çœ‹æ©Ÿå™¨ä¸Šå¯¦éš›çš„ log ç‹€æ³ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç›´æ¥ ssh é€²å»&lt;/p&gt;
&lt;p&gt;å…ˆé€é kubectl çœ‹ä¸€ä¸‹ pod&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get daemonsets --namespace kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                                  AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fluentd-gcp-v3.2.0         7         7         7       7            7           beta.kubernetes.io/fluentd-ds-ready=true       196d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods --output wide --namespace kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                      READY   STATUS    RESTARTS   AGE   IP          NODE                                     NOMINATED NODE   READINESS GATES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fluentd-gcp-scaler-1234567890-vfbhc       1/1     Running   0          37d   10.140.0.   gke-chechiachang-pool-1-123456789-5gqn   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fluentd-gcp-v3.2.0-44tl7                  2/2     Running   0          37d   10.140.0.   gke-chechiachang-pool-1-123456789-wcq0   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fluentd-gcp-v3.2.0-5vc6l                  2/2     Running   0          37d   10.140.0.   gke-chechiachang-pool-1-123456789-tp05   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fluentd-gcp-v3.2.0-6rqvc                  2/2     Running   0          37d   10.140.0.   gke-chechiachang-pool-1-123456789-5gqn   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fluentd-gcp-v3.2.0-mmwk4                  2/2     Running   0          37d   10.140.0.   gke-chechiachang-pool-1-123456789-vxld   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…ˆé€é kubectl çœ‹ä¸€ä¸‹ node&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get node
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                     STATUS   ROLES    AGE   VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gke-chechaichang-pool-1-123456789-3bzp   Ready    &amp;lt;none&amp;gt;   37d   v1.13.7-gke.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gke-chechaichang-pool-1-123456789-5gqn   Ready    &amp;lt;none&amp;gt;   37d   v1.13.7-gke.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gke-chechaichang-pool-1-123456789-8n8z   Ready    &amp;lt;none&amp;gt;   37d   v1.13.7-gke.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud compute ssh gke-chechaichang-pool-1-123456789-3bzp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä½¿ç”¨å…¶ä»–é›²å¹³å°çš„ kubernetes serviceï¼Œæˆ–æ˜¯ bare metal çš„é›†ç¾¤ï¼Œè«‹ä¾ç…§å„è‡ªç³»çµ±çš„æ–¹å¼é€£é€²å»çœ‹çœ‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ssh-node-æ‰¾-log&#34;&gt;ssh node æ‰¾ log&lt;/h1&gt;
&lt;p&gt;ssh é€²å»å¾Œå°±å¯ä»¥åˆ°è™•ä¾†æ¢éšªï¼Œé †ä¾¿çœ‹çœ‹ GKE è·‘åœ¨æ©Ÿå™¨ä¸Šåˆ°åº•åšäº†ä»€éº¼äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå®˜æ–¹æœ‰å‡ºæ–‡ä»¶ï¼Œå¯èƒ½å¯ä»¥ä¸ç”¨é€²ä¾†çœ‹ã€‚å„ä½å¤§å¾·æœ‰ç™¼ç¾æ–‡ä»¶è«‹ç•™è¨€è·Ÿæˆ‘èªªã€‚æˆ‘å€‹äººå¾ˆå–œæ­¡è‡ªå·±æ¶é›†ç¾¤èµ·ä¾†é€£å°±å»çœ‹ï¼Œé¢å°ç…§å®˜æ–¹æ–‡ä»¶ä¸Šå¯«çš„æ±è¥¿ï¼Œç•¶ç„¶å¤§éƒ¨ä»½æ™‚å€™éƒ½æ˜¯æ–‡ä»¶æ²’æœ‰å¸¶åˆ°ï¼Œæœ‰å¾ˆå¤šç™¼ç¾ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /var/log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcp-*-log.pos
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-proxy.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;containers/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metrics/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pods/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;/var/log/containers çœ‹ä¸€ä¸‹ï¼Œæ ¼å¼æ˜¯ &lt;code&gt;pod_namespace_container&lt;/code&gt; é€™é‚Šæ˜¯ link åˆ° /var/log/pods/&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls -al /var/log/containers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lrwxrwxrwx 1 root root   105 Aug 12 07:42 fluentd-gcp-v3.2.0-st6cl_kube-system_fluentd-gcp-5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac.log -&amp;gt; /var/log/pods/kube-system_fluentd-gcp-v3.2.0-st6cl_b76bed0b-bcd4-11e9-a55c-42010a8c0008/fluentd-gcp/0.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹åˆ° pods å°±è¦ºå¾—æ˜¯ä½ äº†ï¼Œè£¡é¢æœ‰ pod è³‡æ–™å¤¾ï¼Œæ ¼å¼æ˜¯ &lt;code&gt;namespace_pod_uuid&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls /var/log/pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default_pod-1-1234567890-fxxhp_uuid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-system_fluentd-gcp-v3.2.0-st6cl_b76bed0b-bcd4-11e9-a55c-42010a8c0008
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-system_heapster-v1.6.0-beta.1-
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-system_kube-proxy-gke-
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-system_l7-default-backend-
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-system_prometheus-to-sd-
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†é€²å»æœ‰ container logï¼Œæ ¼å¼æ˜¯ &lt;code&gt;pod_namespace_container.log&lt;/code&gt;ï¼Œä¹Ÿæ˜¯ link&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls -al /var/log/pods/kube-system_fluentd-gcp-v3.2.0-st6cl_b76bed0b-bcd4-11e9-a55c-42010a8c0008/fluentd-gcp/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lrwxrwxrwx 1 root root  165 Aug 12 07:42 0.log -&amp;gt; /var/lib/docker/containers/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac-json.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€çµ‚ link åˆ°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo su
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls -alh /var/lib/docker/containers/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;total 3.9M
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwx------  4 root root 4.0K Aug 12 07:42 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwx------ 92 root root  20K Sep 18 11:28 ..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r-----  1 root root 3.8M Sep 18 11:29 5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac-json.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwx------  2 root root 4.0K Aug 12 07:42 checkpoints
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-------  1 root root 7.8K Aug 12 07:42 config.v2.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r--r--  1 root root 2.3K Aug 12 07:42 hostconfig.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwx------  2 root root 4.0K Aug 12 07:42 mounts
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é ­å°¾å·å–µä¸€ä¸‹ï¼Œç¢ºå®šæ˜¯æˆ‘å€‘åœ¨æ‰¾çš„æ±è¥¿&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;head /var/lib/docker/containers/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac-json.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tail /var/lib/docker/containers/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac/5e38c9b63c8d767091b122a9aa48c576a88cc20b4470d9ca18a820afa5c168ac-json.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™æ¨£å°±æ‰¾åˆ°æˆ‘å€‘çš„ log äº†&lt;/p&gt;
&lt;h1 id=&#34;å°ç¯€&#34;&gt;å°ç¯€&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ filebeat å»æŸ¥æ‰¾&lt;/li&gt;
&lt;li&gt;é€é kubernetes daemonsets å¯ä»¥å¿«é€Ÿä½ˆç½®ä¸€ä»½ filebeat åˆ°æ‰€æœ‰ nodeï¼Œä¸”è¨­å®šéƒ½æ˜¯ä¸€èµ·æ›´æ–°&lt;/li&gt;
&lt;li&gt;é€é kubernetes deployment å¯ä»¥æŒ‡å®š filebeat çš„ä½ç½®ï¼Œå»è·Ÿéš¨æƒ³è¦ç›£æ¸¬çš„æœå‹™&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸ç†Ÿ log è™•ç†æµç¨‹ï¼Œå¯ä»¥ç›´æ¥çœ‹å·çœ‹å¤§å» çš„æœå‹™ï¼Œæœƒæœ‰å¾ˆå¤šéˆæ„Ÿ&lt;/li&gt;
&lt;li&gt;æ²’äº‹å¯ä»¥å¤šè·‘é€² Kubernetes æœå‹™ç¯€é»é€›é€›ï¼Œæœ‰å¾ˆå¤šæœ‰è¶£çš„æ±è¥¿&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Monitoring GCE With ELK</title>
      <link>https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/</link>
      <pubDate>Wed, 18 Sep 2019 19:10:50 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ELK çš„ beats æ˜¯è¼•é‡ç´šçš„ç³»çµ±ç›£æ¸¬æ”¶é›†å™¨ï¼Œbeats æ”¶é›†åˆ°çš„ data ç¶“é mapping å¯ä»¥é€åˆ° Elasticsearch å¾Œï¼Œé€²è¡Œå½ˆæ€§çš„æœå°‹æ¯”å°ã€‚&lt;/p&gt;
&lt;p&gt;beat æœ‰è¨±å¤šç¨®é¡ï¼Œä¾æ“šæ”¶é›†çš„ data å€åˆ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Auditbeat: Audit data&lt;/li&gt;
&lt;li&gt;Filebeat: Log files&lt;/li&gt;
&lt;li&gt;Functionbeat: Cloud data&lt;/li&gt;
&lt;li&gt;Heartbeat: Availability&lt;/li&gt;
&lt;li&gt;Journalbeat: Systemd journals&lt;/li&gt;
&lt;li&gt;Metricbeat: Metrics&lt;/li&gt;
&lt;li&gt;Packetbeat: Network traffic&lt;/li&gt;
&lt;li&gt;Winlogbeat: Windows event logs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šå…ˆä»¥ filebeat ç‚ºä¾‹ï¼Œåœ¨ GCE ä¸Šæ”¶é›†åœ“ç«¯æœå‹™ç¯€é»ä¸Šçš„æœå‹™æ—¥èªŒèˆ‡ç³»çµ±æ—¥èªŒï¼Œä¸¦åœ¨ ELK ä¸­å‘ˆç¾ã€‚&lt;/p&gt;
&lt;h1 id=&#34;installation&#34;&gt;Installation&lt;/h1&gt;
&lt;p&gt;å®‰è£åŠ filebeat å®‰å…¨æ€§è¨­å®šçš„æ­¥é©Ÿï¼Œåœ¨é€™ç¯‡&lt;a href=&#34;&#34;&gt;Secure ELK Stack&lt;/a&gt; ä¸­å·²ç¶“èªªæ˜ã€‚é€™é‚ŠæŒ‡é™„ä¸Šé€£çµï¼Œä»¥åŠ&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-getting-started.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt; æä¾›åƒè€ƒã€‚&lt;/p&gt;
&lt;h1 id=&#34;configuration&#34;&gt;Configuration&lt;/h1&gt;
&lt;p&gt;é€™é‚Šè«‡å¹¾å€‹ä½¿ç”¨æ–¹é¢çš„è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œapt å®‰è£çš„ filebeat é è¨­çš„ /etc/filebeat/filebeat.yml ä¸å¤ å®Œæ•´ï¼Œæˆ‘å€‘å…ˆåˆ° github æŠŠå°æ‡‰ç‰ˆæœ¬çš„å®Œæ•´è¼‰ä¸‹ä¾†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://raw.githubusercontent.com/elastic/beats/master/filebeat/filebeat.reference.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mv filebeat.reference.yml /etc/filebeat/filebeat.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;beats-central-management&#34;&gt;Beats central management&lt;/h1&gt;
&lt;p&gt;beats é€éæ‰‹å‹•æ›´æ”¹ config éƒ½å¯ä»¥ç›´æ¥è¨­å®šï¼Œä½†é€™é‚Šä¸æ¨è–¦åœ¨æ­¤è¨­å®šï¼Œç†ç”±æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç³»çµ±ä¸­é€šå¸¸æœƒæœ‰å¤§é‡çš„ filebeatï¼Œæ¯å€‹éƒ½è¦è¨­å®šï¼Œæ•¸é‡å¤šæ™‚æ ¹æœ¬ä¸å¯èƒ½&lt;/li&gt;
&lt;li&gt;æ›´æ”¹è¨­å®šæ™‚ï¼Œå¦‚æœä¸ä¸€èµ·æ›´æ”¹ï¼Œæœƒé€ æˆè³‡æ–™æ ¼å¼ä¸çµ±ä¸€ï¼Œä¹‹å¾Œæ¸…ç†ä¹Ÿå¾ˆéº»ç…©&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨è–¦çš„æ–¹å¼æ˜¯é€é Kibana å°æ‰€æœ‰ filebeat åšé›†ä¸­å¼çš„çš„ç®¡ç†é…ç½®ï¼Œåªè¦åˆå§‹è¨­å®šé€£ä¸Š kibanaï¼Œå‰©ä¸‹çš„éƒ½é€é kibana è¨­å®šã€‚&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/configuration-central-management.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶åœ¨æ­¤&lt;/a&gt;ï¼Œæˆ‘å€‘æœ‰ç©ºæœ‰å¯ä»¥åˆ†ç¯‡è«‡é€™å€‹ä¸»é¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸éé€™é‚Šé‚„æ˜¯å¾…å¤§å®¶éä¸€ä¸‹å¹¾å€‹é‡è¦çš„è¨­å®šã€‚ç•¢ç«Ÿè¦åœ¨ kibana ä¸Šé…ç½®ï¼Œfilebeat çš„è¨­å®šæ¦‚å¿µé‚„æ˜¯è¦æœ‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;modules&#34;&gt;modules&lt;/h3&gt;
&lt;p&gt;filebeat æœ‰è¨±å¤š&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¨¡çµ„&lt;/a&gt;ï¼Œè£¡é¢å·²ç¶“åŒ…å«è¨±å¤šé è¨­çš„ template ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ default çš„è¨­å®šå»ç³»çµ±é è¨­çš„è·¯å¾‘æŠ“å–æª”æ¡ˆï¼Œä¸¦ä¸”å…ˆé€²ä¸€æ­¥è™•ç†ï¼Œæ¸›å°‘æˆ‘å€‘è¼¸å‡ºåˆ° logstash é‚„è¦å†åš pipeline é è™•ç†ï¼Œéå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚é€™å€‹ system module æœƒè™•ç†ç³»çµ±é è¨­çš„ log è·¯å¾‘ï¼Œåªè¦é–‹å•Ÿ module ï¼Œå°±æœƒè‡ªå‹•è™•ç†å°æ‡‰çš„ inputã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  syslog:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‰©ä¸‹çš„å°±æ˜¯ç…§éœ€æ±‚å•Ÿç”¨ module ï¼Œä¸¦ä¸”çµ¦äºˆå°æ‡‰çš„ inputã€‚&lt;/p&gt;
&lt;p&gt;ELK ç‚ºè‡ªå·±çš„æœå‹™è¨­å®šäº†ä¸å°‘ module ï¼Œç›´æ¥å•Ÿç”¨å°±å¯ä»¥ç²å–é€™å”æœå‹™å…ƒä»¶é‹è¡Œçš„ log èˆ‡ç›£æ¸¬æ•¸å€¼ã€‚é€™ä¹Ÿæ˜¯ self-monitoring ç›£æ¸¬æ•¸æ“šçš„ä¸»è¦ä¾†æºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: logstash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;input&#34;&gt;input&lt;/h3&gt;
&lt;p&gt;filebeat æ”¯æ´è¤‡æ•¸ inputsï¼Œæ¯å€‹ input æœƒå•Ÿå‹•ä¸€å€‹æ”¶é›†å™¨ï¼Œè€Œ filebeat æ”¶é›†ç›®æ¨™æ˜¯ log æª”æ¡ˆã€‚åŸºæœ¬ä¸Šå¯ä»¥ç°¡å–®ç†è§£ç‚º filebeat å»è®€å–é€™äº› log æª”æ¡ˆï¼Œä¸¦ä¸”åœ¨ç³»çµ±ä¸Šç´€éŒ„è®€å–çš„é€²åº¦ï¼Œåµæ¸¬åˆ° log æœ‰å¢åŠ ï¼Œè®Šç¹¼çºŒè®€å–æ–°çš„ logã€‚&lt;/p&gt;
&lt;p&gt;filebeat å…·é«”çš„å·¥ä½œæ©Ÿåˆ¶ï¼Œå¯ä»¥çœ‹é€™ç¯‡&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/current/how-filebeat-works.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How Filebeat works?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€™ç¯‡æ–‡ä»¶ä¹Ÿæåˆ° filebeat æ˜¯ç¢ºä¿è‡³å°‘ä¸€æ¬¡(at-least-once delivery)çš„æ•¸æ“šè®€å–ï¼Œä½¿ç”¨æ™‚è¦ç‰¹åˆ¥æ³¨æ„é‡è¤‡ç²å–çš„å¯èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæŠŠ input åŠ ä¸Š ubuntu é è¨­çš„ log è·¯å¾‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat.inputs:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- type: log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  paths:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - /var/log/*.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€™é‚Šæ³¨æ„ input æ”¯æ´å¤šç¨® typeï¼Œåƒç…§å®Œæ•´è¨­å®šæª”æ¡ˆçš„èªªæ˜é…åˆè‡ªå·±çš„éœ€æ±‚ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;processor&#34;&gt;Processor&lt;/h3&gt;
&lt;p&gt;åœ¨ filebeat ç«¯å…ˆé€²è¡Œè³‡æ–™çš„ç¬¬ä¸€å±¤è™•ç†ï¼Œå¯ä»¥å¤§å¹…è¬›å°‘ä¸å¿…è¦çš„è³‡æ–™ï¼Œé™ä½æª”æ¡ˆå‚³è¼¸ï¼Œä»¥åŠå° elasticsearch server çš„è² æ“”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;output&#34;&gt;output&lt;/h3&gt;
&lt;p&gt;output ä¹Ÿæ˜¯ filebeat ååˆ†é‡è¦çš„ä¸€ç’°ï¼Œå¥½çš„ filebeat output è¨­å®šï¼Œå¯ä»¥å¤§å¹…é™ä½æ•´é«” ELK stack çš„è² æ“”ã€‚å£çš„è¨­å®šä¹Ÿæœƒç›´æ¥å¡çˆ† ELK staskã€‚&lt;/p&gt;
&lt;p&gt;output.elasticsearch: ç›´æ¥å‘å¾Œé€é€² elasticsearch
output.logstash: å…ˆå‘å¾Œé€åˆ° logstash&lt;/p&gt;
&lt;p&gt;é€™é‚Šéå¸¸æ¨è–¦å¤§å®¶ï¼Œæ‰€æœ‰çš„ beat å¾€å¾Œé€é€² elasticsearch ä¹‹å‰éƒ½å…ˆéä¸€å±¤ logstashï¼Œå°±ç®—ä½ çš„ logstash å…§éƒ¨å®Œå…¨ä¸æ›´æ”¹ dataï¼Œæ²’æœ‰ pipeline mutationï¼Œé‚„æ˜¯ä¸è¦çœé€™ä¸€å±¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;beat çš„æ•¸é‡æœƒéš¨æ‡‰ç”¨æ„ˆä¾†è¶Šå¤šè€Œç·šæ€§å¢åŠ ï¼Œelasticsearch å¾ˆé›£ç·šæ€§ scaleï¼Œæˆ–æ˜¯ scale æˆæœ¬å¾ˆå¤§&lt;/li&gt;
&lt;li&gt;filebeat æ²’æœ‰å¥½å¥½èª¿æ ¡çš„è©±ï¼Œå°æ–¼è¼¸å‡ºç«¯çš„ç¶²è·¯è² æ“”å¾ˆå¤§ï¼Œä¸åƒ…ä½”ç”¨å¤§é‡é€£ç·šï¼Œå‚³è¼¸æª”æ¡ˆçš„å¤§å°ä¹Ÿå¾ˆå¤§ã€‚&lt;/li&gt;
&lt;li&gt;logstash çš„ queue èˆ‡å¾Œé€çš„ batch æ©Ÿåˆ¶æ¯” filebeat å¥½ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;filebeat æ˜¯æ”¶ log çš„ï¼Œé€šå¸¸ log çˆ†ç‚¸çš„æ™‚å€™ï¼Œæ˜¯æ‡‰ç”¨å‡ºå•é¡Œçš„æ™‚å€™ï¼Œé€™æ™‚å€™éœ€è¦ log äº¤å‰æ¯”å°ï¼Œç™¼ç¾ elasticsearch æµé‡ä¹Ÿçˆ†è¡ï¼Œåæ‡‰å¾ˆæ‡‰ç”¨&lt;/li&gt;
&lt;li&gt;logstash é€éä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥å¾ˆè¼•æ˜“çš„ scaleï¼Œç”±æ–¼ pipeline æœ¬èº«å¯ä»¥åˆ†æ•£æ˜¯å¹³è¡Œè™•ç†ï¼Œscale logstash ä¸¦ä¸æœƒå½±éŸ¿è³‡æ–™æœ€çµ‚ç‹€æ…‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;load-balance&#34;&gt;load balance&lt;/h3&gt;
&lt;p&gt;æœ‰ç¶²å‹ç•™è¨€è©¢å• logstash å‰é¢çš„ load balance å¦‚ä½•è™•ç†æ¯”è¼ƒå¥½ï¼Œæˆ‘é€™é‚Šä¹Ÿé †ä¾¿é™„ä¸Šã€‚ä¸åªæ˜¯ logstash ï¼Œæ‰€æœ‰è‡ªèº«ç„¡ç‹€æ…‹(stateless) çš„æœå‹™éƒ½å¯ä»¥ç…§é€™æ¨£å» scaleã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ kubernetes ä¸Šå¾ˆå¥½è™•ç†ï¼Œä½¿ç”¨ k8s é è¨­çš„ service å°±è¼•æ˜“ä½œåˆ°ç°¡æ˜“çš„ load balance&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­ç½®è¤‡æ•¸ logstash instances&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ kubernetes å…§éƒ¨ç¶²è·¯ service å¯¦ç¾ load balancingã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ GCE ä¸Šå¯¦ç¾çš„è©±ï¼Œæˆ‘èªªå¯¦è©±æ²’å¯¦ä½œéï¼Œæ‰€ä»¥ä»¥ä¸‹æ˜¯éµç›¤å¯¦ç¾XDã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/load-balancing.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt; å»ºè­°ä½¿ç”¨ beats ç«¯è¨­å®šå¤šå€‹ logstash url ä¾†åš load balancingã€‚&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä¸æ˜¯å¾ˆå–œæ­¡ beat å»é…ç½®å¤šå€‹ logstash url çš„ä½œæ³•ï¼šbeat è¦æ„ŸçŸ¥ logstash æ•¸é‡è·Ÿ url ï¼Œå¢åŠ æ¸›å°‘ logstash instance é‚„è¦æ›´æ”¹ beats é…ç½®ï¼Œç”¢ç”Ÿé…ç½®çš„ä¾è³´è·Ÿè€¦åˆã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¥½æ˜¯åœ¨ logstash å‰éä¸€å±¤ HAproxy æˆ–æ˜¯é›²ç«¯æœå‹™çš„ Load balancerï¼ˆex. GCP https/tcp load balancerï¼‰ï¼Œbeat ç›´æ¥é€é€² load balance çš„ç«¯é»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;autodiscover&#34;&gt;autodiscover&lt;/h1&gt;
&lt;p&gt;å¦‚æœæœ‰ä½¿ç”¨ container ï¼Œä¾‹å¦‚ docker æˆ– kubernetesï¼Œç”±æ–¼ container å…§çš„ log åœ¨ä¸»æ©Ÿä¸Šçš„ä½ç½®æ˜¯å‹•æ…‹è·¯å¾‘ï¼Œé€™é‚Šå¯ä»¥ä½¿ç”¨ autodiscover å»å°‹æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ kubernetes ä¸Šé¢çš„è¨­å®šï¼Œä¹‹å¾Œæœƒå¦é–‹ä¸€å¤©è¨è«–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;dashboard&#34;&gt;dashboard&lt;/h1&gt;
&lt;p&gt;kibana é è¨­æ˜¯ç©ºçš„ï¼Œæ²’æœ‰é å…ˆè¼‰å…¥ dashboardï¼Œä½†æˆ‘å€‘æœƒå¸Œæœ›è³‡æ–™é€é€²å»ï¼Œå°±æœ‰è¨­å®šå¥½çš„ dashboard ï¼Œåœ–åƒåŒ–æŠŠè³‡æ–™å‘ˆç¾å‡ºä¾†ã€‚é€™éƒ¨ä»½éœ€è¦å¾ beat é€™é‚Šå‘ kibana å¯«å…¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„éƒ¨ä»½è¨­å®šå¥½ kibana çš„é€£ç·šè³‡æ–™ï¼Œæ²’æœ‰è¨­å®šçš„è©± beat å•Ÿå‹•æœƒè­¦å‘Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setup.dashboards.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€èµ·ä¸­å°±æœƒæª¢æŸ¥ kibana æ˜¯å¦æœ‰åŒ¯å…¥ dashboardï¼Œæ²’æœ‰çš„è©±å°±åŒ¯å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿæœƒä¸€ä½µåŒ¯å…¥ modules çš„ dashboardï¼Œä¾‹å¦‚å¦‚æœæœ‰å•Ÿç”¨ nginx module è™•ç† nginx çš„ access logï¼Œnginx module æœƒè™•ç† request source ip ï¼Œä¸¦é€é geoip database, å°‡ ip è½‰æœƒæˆç¶“ç·¯åº¦åº§æ¨™ã€‚é€™æ™‚å¦‚æœåœ¨ kibana ä¸Šæœ‰åŒ¯å…¥ nginx dashboardï¼Œå°±å¯ä»¥çœ‹åˆ°åœ–åƒåŒ–çš„å…¨çƒ request åˆ†ä½ˆåœ–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å–å¾—å®Œæ•´ filebeat è¨­å®šæª”æ¡ˆä¸¦è¨­å®š filebeat&lt;/li&gt;
&lt;li&gt;ç›¡é‡é€é beat central management ä¾†ç®¡ç† beat çš„è¨­å®šæª”&lt;/li&gt;
&lt;li&gt;å•Ÿç”¨å°æ‡‰ module ä¾†æ›´å„ªé›…çš„è™•ç† log&lt;/li&gt;
&lt;li&gt;å¾Œé€åˆ° elasticsearch å‰çš„è³‡æ–™éƒ½å¿…é ˆç¶“éç²¾ç´°çš„è™•ç†ï¼Œé€é€²å»å¾Œå°±ä¸å¥½åˆªæ”¹äº†&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ELK or Not ELK</title>
      <link>https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/</link>
      <pubDate>Wed, 18 Sep 2019 18:51:40 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ‰æ¿å‹å•åˆ°ï¼Œè¦å¦‚ä½•é¸æ“‡è¦ä¸è¦ç”¨ ELKï¼Œå…¶å¯¦ä¹Ÿé€™æ˜¯æ•´ç¯‡ ELK çš„åˆè¡·ã€‚é€™é‚Šåˆ†äº«ä¸€ä¸‹ ELK èˆ‡å…¶ä»–é¸æ“‡ï¼Œä»¥åŠé¸æ“‡è§£æ±ºæ–¹æ¡ˆæ‡‰è©²è€ƒæ…®çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…¶ä»–å¸¸ç”¨çš„æœå‹™&#34;&gt;å…¶ä»–å¸¸ç”¨çš„æœå‹™&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus&lt;/a&gt;: é–‹æºçš„ time series metrics æ”¶é›†ç³»çµ±&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/stackdriver/?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stackdriver&lt;/a&gt;: GCP çš„ log èˆ‡ metrics å¹³å°&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/cloud/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Elastic Cloud&lt;/a&gt;: ELK çš„ Sass&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chechia.net/post/self-host-elk-stack-on-gcp/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Self-hosted ELK&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ–æ˜¯ä¾ç…§éœ€æ±‚æ··æ­ï¼Œå„å€‹æœå‹™ä½¿ç”¨çš„å„å±¤å¥—ä»¶æ˜¯å¯ä»¥ç›¸å®¹ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ GKE ä¸Šä¸ç”¨ beat å¯ä»¥ç”¨ fluentd&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Prometheus -&amp;gt; Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ELK -&amp;gt; Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fluentd -&amp;gt; Prometheus
&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sass vs cloud self-hosted vs on-premised&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Metrics: ELK vs Prometheus vs Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Logging: ELK vs Stackdriver&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å–æ¨åŸå‰‡&#34;&gt;å–æ¨åŸå‰‡&lt;/h1&gt;
&lt;p&gt;å„å€‹æ–¹æ³•éƒ½å„æœ‰åˆ©å¼Šï¼Œå®Œå…¨å–æ±ºæ–¼éœ€æ±‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·²çŸ¥æ¢ä»¶é™åˆ¶ï¼Œä¾‹å¦‚å®‰å…¨æ€§è€ƒé‡å°±æ˜¯è¦æ”¾åœ¨ç§æœ‰ç¶²è·¯é˜²ç«ç‰†å…§ï¼Œæˆ–æ˜¯é ç®—&lt;/li&gt;
&lt;li&gt;è³‡æ–™è®€å–æ–¹å¼ï¼Œæœ‰æ²’æœ‰è¦äº¤å‰æ¯”å°æ”¶é›†çš„è³‡æ–™ï¼Œé‚„æ˜¯å–®ç´”ä¾ç…§æ™‚é–“åºæŸ¥è©¢&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯è³‡æ–™é‡éå¸¸å¤§ï¼Œæ‡‰ç”¨æ•¸é‡éå¸¸å¤š&lt;/li&gt;
&lt;li&gt;ç¶­è­·çš„åœ˜éšŠï¼Œæœ‰æ²’æœ‰æƒ³ï¼Œæˆ–æœ‰æ²’æœ‰èƒ½åŠ›è‡ªå·±é¤Š self-host æœå‹™&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;sass-vs-self-hosted-vs-on-premised&#34;&gt;Sass vs Self-hosted vs On-premised&lt;/h1&gt;
&lt;p&gt;Sass: æŒ‡çš„æ˜¯ç›´æ¥ç”¨ Elasitc Cloudï¼Œæˆ–æ˜¯ç›´æ¥ä½¿ç”¨å…¬æœ‰é›²çš„æœå‹™(ex. åœ¨ GCP ä¸Šä½¿ç”¨ stackdriver)&lt;/p&gt;
&lt;p&gt;Cloud Self-hosted: åœ¨å…¬æœ‰é›²ä¸Šä½¿ç”¨ ELK&lt;/p&gt;
&lt;p&gt;On-Premised: è‡ªå·±åœ¨æ©Ÿæˆ¿æ­è¨­&lt;/p&gt;
&lt;h3 id=&#34;å®‰å…¨æ€§&#34;&gt;å®‰å…¨æ€§&lt;/h3&gt;
&lt;p&gt;çœ‹å…¬å¸çš„å®‰å…¨æ”¿ç­–ï¼Œå…è¨±å°‡æ—¥èªŒåŠç›£æ§æ•¸æ“šï¼Œé€åˆ°ç§æœ‰ç¶²è·¯ä»¥å¤–çš„åœ°æ–¹å—ï¼Ÿå¦‚æœåœ¨é˜²ç«ç‰†å…§ï¼Œæä¸å¥½ port æ ¹æœ¬å°±ä¸é–‹çµ¦ä½ ï¼Œæ ¹æœ¬ä¸ç”¨è€ƒæ…®ä½¿ç”¨å¤–éƒ¨æœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;è¦çŸ¥é“æœå‹™çš„ log å…¶å¯¦å¯ä»¥çœ‹å‡ºå¾ˆå¤šæ±è¥¿ï¼å¦‚æœæœ‰ç‰¹åˆ¥åšè³‡æ–™åˆ†æï¼Œæ•æ„Ÿçš„è³‡æ–™ï¼Œé‡‘æµç›¸é—œæ•¸æ“šï¼Œé€šå¸¸ä¸æœƒæƒ³è¦å€’åˆ°ç¬¬ä¸‰æ–¹æœå‹™å¹³å°ã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½æœ‰åšé‡‘æµçš„ï¼Œå…‰æ˜¯å®‰å…¨æ€§é€™é»ï¼Œå°±å¿…é ˆé¸æ“‡è‡ªæ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆæœ¬&#34;&gt;æˆæœ¬&lt;/h3&gt;
&lt;p&gt;é‡‘éŒ¢æˆæœ¬ + ç¶­è­·æˆæœ¬&lt;/p&gt;
&lt;p&gt;é‡‘éŒ¢æˆæœ¬å°±çœ‹å„å€‹æœå‹™çš„è¨ˆè²»æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/products/elasticsearch/service/pricing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Elastic Cloud Pricing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Self-hosted ELK &amp;amp; Prometheusï¼šæ©Ÿå™¨æˆæœ¬&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²æœå‹™(ex. &lt;a href=&#34;https://cloud.google.com/stackdriver/pricing?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Stackdriver&lt;/a&gt;): ç”¨é‡è¨ˆè²»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¶­è­·æˆæœ¬: å·¥ç¨‹å¸«çš„æœˆè–ª * æ¯å€‹æœˆè¦èŠ±åœ¨ç¶­è­·æœå‹™çš„å·¥æ™‚æ¯”ä¾‹&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ Sass ä»£ç®¡çš„æœå‹™ï¼Œæœƒé™ä½ç¶­è­·æˆæœ¬ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åšåˆ°ç¶²é é»ä¸€é»å°±å¯ä»¥ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå…¬å¸æœ‰å®Œæ•´çš„ç¶­è­·åœ˜éšŠï¼Œæœ‰æ©Ÿæˆ¿ï¼Œæœå‹™çš„ä½¿ç”¨é‡ä¹Ÿå¾ˆå¤§ï¼Œç•¶ç„¶ self-hosted æ˜¯æ¯”è¼ƒçœã€‚
ä¸­å°å‹ä¼æ¥­ä»¥åŠæ–°å‰µï¼Œæœå‹™åœ¨å…¬æœ‰é›²ä¸Šçš„ï¼Œç›´æ¥ä½¿ç”¨Sass æœå‹™å¾€å¾€æ¯”è¼ƒç¯€çœæˆæœ¬ï¼Œæœå‹™ç›´æ¥ç”± Sass ç¶­è­·ï¼Œç¯€çœå¾ˆå¤šæ©Ÿå™¨ä¸Šç®¡ç†è·Ÿæ—¥å¸¸ç¶­è­·ã€‚&lt;/p&gt;
&lt;p&gt;é¿å…è¿·æ€ï¼Œè²·å¤–éƒ¨æœå‹™çš„å¸³å–®æ˜¯é¡¯æ€§çš„ï¼Œå ±å¸³æ™‚çœ‹å¾—åˆ°ï¼Œè€Œå·¥ç¨‹å¸«ç¶­è­·çš„æ™‚é–“æˆæœ¬æ˜¯éš±æ€§çš„ã€‚self-host å¯èƒ½çœä¸‹ Sass è²»ç”¨ï¼Œä½†å·¥ç¨‹å› ç‚ºåˆ†äº†æ™‚é–“å»ç¶­è­·ï¼Œè€Œå½±éŸ¿é€²åº¦ã€‚é€™éƒ¨åˆ†å°±çœ‹åœ˜éšŠå¦‚ä½•å–æ¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ˜“ç”¨æ€§&#34;&gt;æ˜“ç”¨æ€§&lt;/h3&gt;
&lt;p&gt;å¦‚æœæ‡‰ç”¨éƒ½è·‘åœ¨å…¬æœ‰é›²ä¸Šï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨é›²å¹³å°æä¾›çš„ç›£æ¸¬æœå‹™ï¼Œä½¿ç”¨ä¾¿åˆ©ï¼Œè€Œä¸”æ•´åˆåº¦é«˜ã€‚ex  GCP ä¸Šï¼Œè¦å•Ÿç”¨ Stackdriver æ˜¯éå¸¸è¼•é¬†çš„äº‹æƒ…ï¼Œåªæ˜¯æ”¹ä¸€å…©å€‹é¸é …ï¼Œå°±å¯ä»¥é–‹å•Ÿ / é—œé–‰ logging èˆ‡ metrics&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ On-premised è‡ªå®¶æ©Ÿæˆ¿ï¼Œä¹Ÿè¨± self-hosted æœƒæ›´ç‚ºé©åˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¢è£½åŒ–ç¨‹åº¦&#34;&gt;å®¢è£½åŒ–ç¨‹åº¦&lt;/h3&gt;
&lt;p&gt;åœ¨å¤§å¤šæ•¸æ™‚å€™ï¼Œæ²’æœ‰éœ€è¦æ›´æ”¹åˆ°æœå‹™çš„æ ¸å¿ƒè¨­å®šï¼Œéƒ½å¯ä»¥ä¸å¯å¾‹å®¢è£½åŒ–ç¨‹åº¦ï¼Œç›´æ¥ä½¿ç”¨ Sass çš„è¨­å®šï¼Œå°±èƒ½æ»¿è¶³å¤§éƒ¨åˆ†éœ€æ±‚ã€‚å¯ä»¥ç­‰æœ‰æœ‰æ˜ç¢ºéœ€æ±‚å¾Œå†è€ƒæ…®é€™ä¸€é»ã€‚çŸ­æœŸå…§æ²’æœ‰ç‰¹æ®Šéœ€æ±‚å°±å¯ä»¥å¾ç°¡ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨GKE åˆ° Stackdriver çš„è©±ï¼Œå°ä¸»æ©Ÿæœ¬èº«çš„æ©Ÿå™¨æ˜¯æ²’æœ‰æ§åˆ¶æ¬Šçš„ï¼ŒåŸ·è¡Œçš„ pipeline ä¹Ÿä¸å¤ªèƒ½æ›´æ”¹
Elastic Cloud æœ‰æä¾›ä¸Šå‚³ elasticsearch config æª”æ¡ˆçš„ä»‹é¢ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ›´æ”¹ server é‹è¡Œçš„åƒæ•¸è¨­å®š
Self-Hosted é™¤äº†ä¸Šè¿°çš„è¨­å®šï¼Œé‚„å¯ä»¥ä¾ç…§éœ€æ±‚æ›´æ”¹ ELK / prometheus æœå‹™ï¼Œåœ¨å¯¦é«”æ©Ÿå™¨ä¸Šçš„ topologyï¼Œcpu è¨˜æ†¶é«”çš„è³‡æºé…ç½®ï¼Œå„²å­˜ç©ºé–“é…ç½®ç­‰ï¼Œå¯ä»¥æœ€å¤§åŒ–æ©Ÿå™¨çš„æ•ˆèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;scalability&#34;&gt;Scalability&lt;/h3&gt;
&lt;p&gt;è³‡æ–™æµé‡å¤§ï¼Œå„²å­˜ç©ºé–“æ¶ˆè€—å¤šï¼Œæœå‹™è² æ“”å¤§ï¼Œå¯èƒ½å°±æœƒéœ€è¦æ“´å±•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å€‹æ˜¯è³‡æ–™é‡çš„æ“´å±•ã€‚ä¸€å€‹æ˜¯ç‚ºäº†æ‡‰ä»˜æœå‹™çš„è² æ“”ï¼Œå° ELK æœå‹™å…ƒä»¶åšæ°´å¹³æ“´å±•ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† elasticsearch ä»¥çˆ²çš„å…ƒä»¶ï¼Œä¾‹å¦‚ kibanaï¼Œapm-server, beats éƒ½å¯ä»¥é€é kubernetes è¼•æ˜“çš„æ“´å±•ï¼Œå”¯æœ‰ elasticsearch ï¼Œç”±æ–¼åˆç‰½æ‰¯ä¸Šè¿°è³‡æ–™é‡çš„æ“´å±•ï¼Œä»¥åŠåˆ†ä½ˆï¼Œé‚„æœ‰å‰¯æœ¬ç®¡ç†ï¼Œindex æœ¬èº«çš„ lifecycle ç®¡ç†ã€‚Elasticsearch çš„ scaling è¨­å®šä¸Šæ˜¯è »è¤‡é›œçš„ï¼Œä¹Ÿæœ‰å¾ˆå¤šå·¥è¦åšã€‚index çš„ shards / replicas è¨­å®šéƒ½è¦æ³¨æ„åˆ°ã€‚å¦å‰‡ä¸€è·¯ scale ä¸Šå»ï¼Œé›†ç¾¤å¤§çš„æ™‚å€™å½¼æ­¤ sharding sync çš„æ•ˆèƒ½æ¶ˆè€—æ˜¯å¦æœƒå¤ªé‡ã€‚&lt;/p&gt;
&lt;p&gt;Stackdriver å¾ä½¿ç”¨è€…çš„è§’åº¦ï¼Œæ˜¯ä¸å­˜åœ¨æœå‹™ç¯€é»çš„æ“´å±•å•é¡Œï¼Œç¯€é»çš„ç¶­è­·å…¨éƒ½çµ¦ Sass ç®¡ç†ã€‚è³‡æ–™é‡çš„æ“´å±•å•é¡Œä¹Ÿä¸å¤§ï¼Œåªè¦æ•´ç†è³‡æ–™ pipelineï¼Œè®“æœ€å¾Œå„²å­˜çš„è³‡æ–™å®¹æ˜“è¢«æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;h1 id=&#34;timeseries-vs-non-timeseriese&#34;&gt;Timeseries vs non-timeseriese&lt;/h1&gt;
&lt;p&gt;Prometheus &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/storage/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ˜¯è‡ªå¸¶ time series database&lt;/a&gt;ï¼Œstackdriver ä¹Ÿæ˜¯ time series çš„å„²å­˜ã€‚ELK çš„ elasticsearch æ˜¯å…¨æ–‡æœç´¢å¼•æ“ï¼Œç”¨äº† timestamp åšåˆ†ææ‰€ä»¥å¯ä»¥åšåˆ° time series çš„è³‡æ–™ç´€éŒ„èˆ‡åˆ†æã€‚é€™é»åœ¨æœ¬è³ªä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…‰åªè™•ç† time series dataï¼ŒPrometheus çš„ query æ•ˆèƒ½æ˜¯æ¯” elasticsearch å¥½å¾ˆå¤š&lt;/li&gt;
&lt;li&gt;Elasticsearch æœ‰å¤§é‡çš„ index ç¶­è­·ï¼Œéœ€è¦è¼ƒå¤šç³»çµ±è³‡æºè™•ç†ï¼Œåœ¨æ²’æœ‰ query å£“åŠ›çš„æƒ…å½¢ä¸‹æœƒæœ‰ç³»çµ±è‡ªå‹•ç¶­è­·çš„æ•ˆèƒ½æ¶ˆè€—&lt;/li&gt;
&lt;li&gt;ELK çš„è³‡æ–™ä¸éœ€è¦é å…ˆå»ºæ¨¡ï¼Œå°±å¯ä»¥åšåˆ°éå¸¸å½ˆæ€§çš„æœå°‹æŸ¥æ‰¾ã€‚Stackdriver çš„è©±ï¼Œç„¡æ³•ç”¨æœªå»ºæ¨¡çš„è³‡æ–™æ¬„ä½äº¤å‰æŸ¥æ‰¾ã€‚
&lt;ul&gt;
&lt;li&gt;Log æ”¶é›†æ–¹é¢
&lt;ul&gt;
&lt;li&gt;Elasticsearch ä¸­çš„è³‡æ–™æ¬„ä½é€é tempalte åŒ¯å…¥å¾Œï¼Œéƒ½æ˜¯æœ‰åš index ï¼Œæ‰€ä»¥äº¤å‰æŸ¥æ‰¾ï¼Œä¾‹å¦‚å¯ä»¥å¾ log text ä¸­åŒ…å«ç‰¹å®šå­—ä¸²çš„ç´€éŒ„ï¼Œåœ¨åš aggregate ç®—å‡ºå…¶ä»–æ¬„ä½çš„è³‡æ–™åˆ†ä½ˆã€‚æœƒæ¯”è¼ƒæ…¢ï¼Œä½†æ˜¯æ˜¯åšå¾—åˆ°çš„å…¨æ–‡æœç´¢&lt;/li&gt;
&lt;li&gt;Stackdriver å¯ä»¥åšåŸºæœ¬çš„ filter ï¼Œä¾‹å¦‚ filter æŸå€‹æ¬„ä½ï¼Œä½†ä¸èƒ½åšå¤ªè¤‡é›œçš„äº¤å‰æ¯”å°ï¼Œä¹Ÿä¸èƒ½é‡å° text å…§å®¹ä½œäº¤äº’æŸ¥æ‰¾ï¼Œéœ€è¦æ›å‡ºä¾†å¦å¤–è™•ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Metrics æ”¶é›†æ–¹é¢
&lt;ul&gt;
&lt;li&gt;(åŒä¸Š) Elasticsearch å¯ä»¥ç”¨å…¨æ–‡æœç´¢ï¼Œåšåˆ°å¾ˆè¤‡é›œçš„äº¤å‰æ¯”å°ï¼Œä¾‹å¦‚ï¼šå¾ metrics æ•¸å€¼ï¼Œè¨ˆç®—åœ¨æ™‚é–“ç¯„åœçš„åˆ†ä½ˆæƒ…å½¢(cpu è¶…é 50% è½åœ¨ä¸€å¤© 24 å°æ™‚ï¼Œå„å€‹å°æ™‚çš„æ¬¡æ•¸)&lt;/li&gt;
&lt;li&gt;Stackdriver åªèƒ½åšåŸºæœ¬çš„ time series æŸ¥æ‰¾ï¼Œç„¶å¾Œé€éé å…ˆå®šç¾©å¥½çš„ field filter è³‡æ–™ï¼Œå†å„è‡ªåœ–åƒåŒ–ã€‚&lt;/li&gt;
&lt;li&gt;Prometheus ä¹Ÿæ˜¯å¿…é ˆä¾ç…§ time series æŸ¥æ‰¾ï¼Œèªæ³•ä¸Šå½ˆæ€§æ¯” stackdriver å¤šå¾ˆå¤šï¼Œä½†ä¾æ¨£ä¸èƒ½æœå°‹æ²’æœ‰ index çš„æ¬„ä½&lt;/li&gt;
&lt;li&gt;é€™é‚Šè¦æ›¿åˆ¥æï¼Œé›–ç„¶ Elasticsearch èƒ½ç”¨å…¨æ–‡æœç´¢è¼•æ˜“åœ°åšåˆ°è¤‡é›œçš„æŸ¥è©¢èªæ³•ï¼Œä½†ä»¥ metrics ä¾†èªªï¼Œå…¶å¯¦æ²’æœ‰å¤ªå¤šè·³è„« time series æŸ¥æ‰¾çš„éœ€æ±‚ã€‚èƒ½åšåˆ°ï¼Œä½†æœ‰æ²’æœ‰å¿…è¦é€™æ¨£åšï¼Œå¯ä»¥æ‰“å€‹å•è™Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å€‹äººå¿ƒå¾—ï¼Œå¦‚æœé©—è­‰å…¨æ–°çš„ business modelï¼Œæˆ–æ˜¯é‚„ä¸ç¢ºå®šçš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ ELK åšå„ç¨®è¤‡é›œçš„æŸ¥è©¢&lt;/p&gt;
&lt;p&gt;å¦‚æœéœ€æ±‚æ˜ç¢ºï¼Œæ”¶é€²ä¾†çš„ log è™•ç†æµç¨‹éƒ½å¾ˆæ˜ç¢ºï¼Œä¹Ÿè¨±ä¸ç”¨ä½¿ç”¨ ELKã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è«–ç³»çµ±è³‡æº CP å€¼ä»¥åŠæ•ˆèƒ½ï¼Œtime series çš„ db éƒ½æœƒæ¯” Elasticsearch å¥½ä¸Šä¸å°‘ã€‚&lt;/li&gt;
&lt;li&gt;Elasticsearch ä¸­ä¹Ÿä¸å¤ªé©åˆä¸€ç›´å­˜æ”¾å¤§é‡çš„è³‡æ–™åœ¨ hot å¯å¯«å¯è®€ç‹€æ…‹ï¼Œç¹ªå¸Œå¥½å¾ˆå¤šç³»çµ±è³‡æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…¶ä»–æœå‹™&#34;&gt;å…¶ä»–æœå‹™&lt;/h1&gt;
&lt;p&gt;Elastic æœ‰å‡ºè¨±å¤šä¸åŒçš„å¢å€¼æœå‹™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Application Performance Monitoring(APM)&lt;/li&gt;
&lt;li&gt;Realtime User Monitoring(RUM)&lt;/li&gt;
&lt;li&gt;Machine Learning(ELK ML)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œ ELK ä»¥å¤–ä¹Ÿéƒ½æœ‰ä¸åŒçš„è§£æ±ºæ–¹æ¡ˆï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCP ä¹Ÿå‡ºäº†è‡ªå·±çš„ APM Sass&lt;/li&gt;
&lt;li&gt;Google Analytics(GA) ä¸åƒ…èƒ½åšå¤šæ¨£çš„å‰ç«¯ä½¿ç”¨è€…è¡Œç‚ºåˆ†æï¼Œé‚„èƒ½æ•´åˆ Google æ”¶é›†åˆ°çš„ä½¿ç”¨è€…è¡Œç‚ºï¼Œåšæ›´å¤šç¶­åº¦çš„åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›¸è¼ƒä¹‹ä¸‹ ELK åœ¨é€™å¡Šå…¶å¯¦æ²’æœ‰ç‰¹åˆ¥å„ªå‹¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;elastic-cloud&#34;&gt;Elastic Cloud&lt;/h1&gt;
&lt;p&gt;æˆ‘é€™é‚Šè¦ç‰¹åˆ¥èªª Elastic Cloud vs ELK&lt;/p&gt;
&lt;p&gt;Elatic Cloud çš„é‹è¡Œæ–¹å¼ï¼Œæ˜¯ä»£ç‚ºå‘å…¬èˆ‡æ©å¹³å°(aaws, gcp,&amp;hellip;)ï¼Œå¸¶å®¢æˆ¶å‘å¹³å°ç§Ÿç”¨æ©Ÿå™¨ï¼Œç„¶å¾ŒæŠŠ ELK æœå‹™éƒ¨ç½²åˆ°ç§Ÿç”¨çš„æ©Ÿå™¨ä¸Šã€‚ç”¨æˆ¶é€™é‚Šç„¡æ³•ç›´æ¥å­˜å–æ©Ÿå™¨ï¼Œåªèƒ½é€é ELK ä»‹é¢æˆ–æ˜¯ Kibana , API é€²å…¥ ELKã€‚Elastic Cloud æœƒç›£æ§ç„¡èª¤ç¯€é»çš„ç‹€æ³ï¼Œä¸¦åšåˆ°ä¸€å®šç¨‹åº¦çš„ä»£ç®¡ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚ŠæŒ‡çš„ä¸€å®šç¨‹åº¦çš„ä»£ç®¡ï¼Œæ˜¯ Elastic Cloud åªæ˜¯ä»£ç‚ºéƒ¨ç½²æœå‹™ï¼Œç›£æ§ã€‚æœ‰æ•…éšœæ™‚ä¸¦ä¸è² è²¬æ’é™¤ï¼Œå¦‚æœ ELK æ•…éšœï¼Œç°¡å–®çš„å•é¡Œï¼ˆex. è¨˜æ†¶é«”è³‡æºä¸è¶³ï¼‰æœƒä»£ç‚ºé‡é–‹æ©Ÿå™¨ï¼Œä½†å¦‚æœæ˜¯è¤‡é›œçš„å•é¡Œï¼Œé‚„æ˜¯è¦ç”¨æˆ¶è‡ªå·±è™•ç†ï¼ä½†æ˜¯ç”¨æˆ¶åˆæ²’æœ‰ä¸»æ©Ÿç¯€é»çš„ç›´æ¥å­˜å–æ¬Šé™ï¼Œæ‰€ä»¥å¯èƒ½æœƒé€ æˆæœå‹™å¡ä½ç„¡æ³•å•Ÿå‹•ï¼Œåªèƒ½é€é Elastic Cloud çš„ç®¡ç†ä»‹é¢å˜—è©¦ä¿®å¾©ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æœå‹™é™¤äº†æŠŠæœå‹™éƒ½æ¶è¨­å®Œä»¥å¤–ï¼Œé‚„æ˜¯éœ€è¦å®šæœŸè¦èŠ±æ™‚é–“è™•ç† performance tuningï¼Œè¨­å®šå®šæœŸæ¸…ç†è·Ÿç¶­è­·ã€‚åŒ…æ‹¬ kafka, redis, mongoDB, cassandra, SQLs&amp;hellip;éƒ½æ˜¯ä¸€æ¨£ï¼Œæ¶æ§‹è¶Šè¤‡é›œï¼Œæ•ˆèƒ½è¦æ±‚è¶Šé«˜ï¼Œé€™éƒ¨åˆ†çš„å·¥éƒ½æœƒæ›´å¤šã€‚å¦‚æœå…¬å¸æœ‰ DBAï¼Œæˆ–æ˜¯å°ˆè·ç¶­è­·å·¥ç¨‹å¸«ï¼Œé‚£æ­å–œå°±ä¸ç”¨ç…©æƒ±ã€‚&lt;/p&gt;
&lt;p&gt;Elasticsearch server ç›®å‰ç”¨èµ·ä¾†ï¼Œç®—æ˜¯æ˜¯æ•¸æœå‹™ä¸­ï¼Œç¶­è­·ä¸ŠæœƒèŠ±æ¯”è¼ƒå¤šæ™‚é–“çš„æœå‹™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºå¼•æ“æœ¬èº«è¨­è¨ˆçš„æ¶æ§‹ï¼Œä¸¦ä¸æ˜¯å¾ˆå¤šäººéƒ½ç†Ÿæ‚‰ã€‚åœ¨ä½¿ç”¨ELKåŒæ™‚ï¼Œå°ELKåº•å±¤å¼•æ“çš„é‹ä½œæµç¨‹æœ‰å¤šç†Ÿæ‚‰ï¼Œæœƒç›´æ¥å½±éŸ¿ç©©å®šæ€§è·Ÿè·‘å‡ºä¾†çš„æ•ˆèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¥½å¥½è™•ç†è¨­è¨ˆè³‡æ–™çš„å„²å­˜ï¼Œå¦‚æœä½¿ç”¨ä¸Šæ²’è™•ç†å¥½ï¼Œæœƒç›´æ¥è®“æ•´å€‹ELK æ›æ‰ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶å¾Œç”¢å“æœ¬èº«çš„ç¶­è­·ä»‹é¢ï¼Œç›®å‰åªæ˜¯åœ¨å ªç”¨ï¼Œè¨±å¤šé‡è¦çš„åŠŸèƒ½ä¹Ÿé‚„åœ¨é–‹ç™¼ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå…¬å¸æœ‰äººæœƒç®¡ ELKï¼Œå€‹äººå»ºè­°æ˜¯å¯ä»¥ self-host&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¼„æ¸…æ¥šéœ€æ±‚ï¼Œå¦‚æœæ²’æœ‰ç‰¹æ®Šéœ€æ±‚å¯ä»¥èµ° general solution&lt;/li&gt;
&lt;li&gt;Sass vs Self-hosted vs On-premised&lt;/li&gt;
&lt;li&gt;Time series vs non time series&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>X.509 certificate</title>
      <link>https://chechia.net/zh-hant/post/2020-09-17-x.509-certificate/</link>
      <pubDate>Tue, 17 Sep 2019 10:15:36 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-17-x.509-certificate/</guid>
      <description>&lt;h1 id=&#34;ç°¡å–®è¬›ä¸€ä¸‹-certificate&#34;&gt;ç°¡å–®è¬›ä¸€ä¸‹ certificate&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;X.509 æ˜¯å…¬é‘°æ†‘è­‰(public key certificate) çš„ä¸€å¥—æ¨™æº–ï¼Œç”¨åœ¨å¾ˆå¤šç¶²è·¯é€šè¨Šå”å®š (åŒ…å« TLS/SSL)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;certificate åŒ…å«å…¬é‘°åŠè­˜åˆ¥è³‡è¨Š(hostname, organization, &amp;hellip;ç­‰è³‡è¨Š)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;certificate æ˜¯ç”± certificate authority(CA) ç°½ç½²ï¼Œæˆ–æ˜¯è‡ªç°½(Self-signed)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ browser é€£å…¥ https serveræ™‚ï¼Œæœƒæª¢æŸ¥ server çš„ certificate æ˜¯å¦æœ‰æ•ˆï¼Œç¢ºå®šé€™å€‹ server çœŸçš„æ˜¯åˆæ³•çš„ site&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ elastic stack ä¸Šï¼Œå¦‚æœæœ‰å¤šå€‹ elasticsearch server node å½¼æ­¤é€£ç·šï¼Œç”±æ–¼ node å½¼æ­¤æ˜¯ client ä¹Ÿæ˜¯ server&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ self-signed CA ç”¢å‡ºä¾†çš„ certificateï¼Œé€£å…¥æ™‚æœƒæª¢æŸ¥ä½¿ç”¨çš„ certificate æ˜¯å¦ç”±åŒä¸€çµ„ CA ç°½ç½²&lt;/li&gt;
&lt;li&gt;server ä½¿ç”¨ certificateï¼Œç¢ºå®šé€£å…¥ server çš„ client éƒ½å¸¶æœ‰æ­£ç¢ºçš„ç§é‘°èˆ‡ public certificateï¼Œæ˜¯ authenticated user&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™„å¸¶èªªæ˜ï¼ŒX.509 æœ‰å¤šç¨®æª”æ¡ˆæ ¼å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.pem&lt;/li&gt;
&lt;li&gt;.cer, .crt, .der&lt;/li&gt;
&lt;li&gt;.p12&lt;/li&gt;
&lt;li&gt;.p7b, .p7c&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–æª”æ¡ˆæ ¼å¼å¯ä»¥æœ‰å…¶ä»–ç”¨é€”ï¼Œä¹Ÿå°±æ˜¯èªªè£¡é¢è£çš„ä¸ä¸€å®šæ˜¯ X.509 æ†‘è­‰&lt;/p&gt;
&lt;h1 id=&#34;ca&#34;&gt;CA&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 -in /etc/elasticsearch/config/elastic-stack-ca.p12 -info -nokeys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MAC: sha1, Iteration 100000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MAC length: 20, salt length: 20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PKCS7 Data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Shrouded Keybag: pbeWithSHA1And3-KeyTripleDES-CBC, Iteration 50000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PKCS7 Encrypted data: pbeWithSHA1And40BitRC2-CBC, Iteration 50000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Certificate bag
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Bag Attributes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    friendlyName: ca
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    localKeyID:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;subject=CN = Elastic Certificate Tool Autogenerated CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;issuer=CN = Elastic Certificate Tool Autogenerated CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----BEGIN CERTIFICATE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----END CERTIFICATE-----
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;issuer command name ç‚º Elastic autogen CA
subject command name ç‚º Elastic autogen CA&lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://shazi.info/openssl-%E6%AA%A2%E6%B8%AC-ssl-%E7%9A%84%E6%86%91%E8%AD%89%E4%B8%B2%E9%8D%8A-certificate-chain/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://shazi.info/openssl-%E6%AA%A2%E6%B8%AC-ssl-%E7%9A%84%E6%86%91%E8%AD%89%E4%B8%B2%E9%8D%8A-certificate-chain/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl s_client -connect google.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://medium.com/@superseb/get-your-certificate-chain-right-4b117a9c0fce&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://medium.com/@superseb/get-your-certificate-chain-right-4b117a9c0fce&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl verify -CAfile client-ca.cer client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl verify -show_chain -CAfile client-ca.cer client.cer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;certificate&#34;&gt;Certificate&lt;/h1&gt;
&lt;p&gt;ç”¨ openssl å·¥å…·çœ‹ä¸€ä¸‹å…§å®¹ï¼Œå¦‚æœæœ‰å¯†ç¢¼é€™é‚Šè¦ç”¨å¯†ç¢¼è§£é–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 -in /etc/elasticsearch/config/elastic-certificates.p12 -info -nokeys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MAC: sha1, Iteration 100000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MAC length: 20, salt length: 20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PKCS7 Data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Shrouded Keybag: pbeWithSHA1And3-KeyTripleDES-CBC, Iteration 50000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PKCS7 Encrypted data: pbeWithSHA1And40BitRC2-CBC, Iteration 50000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Certificate bag
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Bag Attributes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    friendlyName: elk.asia-east1-b.c.machi-x.internal
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    localKeyID:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;subject=CN = elk.asia-east1-b.c.machi-x.internal
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;issuer=CN = Elastic Certificate Tool Autogenerated CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----BEGIN CERTIFICATE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----END CERTIFICATE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Certificate bag
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Bag Attributes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    friendlyName: ca
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    2.16.840.1.113894.746875.1.1: &amp;lt;Unsupported tag 6&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;subject=CN = Elastic Certificate Tool Autogenerated CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;issuer=CN = Elastic Certificate Tool Autogenerated CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----BEGIN CERTIFICATE-----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----END CERTIFICATE-----
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Secure Elk Stack</title>
      <link>https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/</link>
      <pubDate>Sun, 15 Sep 2019 23:00:33 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;p&gt;ä¸Šç¯‡&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt; ä»‹ç´¹äº†ï¼Œelk stack åŸºæœ¬çš„å®‰è£ï¼Œå®‰è£å®Œç²å¾—ä¸€å€‹åªæ”¯æ´ http (è£¸å¥”)çš„ elk stackï¼Œæ²’æœ‰ https åœ¨å…¬é–‹ç¶²è·¯ä¸Šä½¿ç”¨æ˜¯éå¸¸å±éšªçš„ã€‚é€™ç¯‡è¦ä¾†ä»‹ç´¹å¦‚ä½•åšå®‰å…¨æ€§è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹çš„æ–‡ä»¶åœ¨é€™è£¡&lt;/a&gt;ï¼Œç¢å¿µä¸€ä¸‹ï¼Œé™¤éå° ELK çš„åŠŸèƒ½æœ‰ä¸€å®šäº†è§£ï¼Œä¸ç„¶é€™ä»½çœŸçš„ä¸æ˜¯å¾ˆå‹å–„ã€‚å»ºè­°å¾å®˜æ–¹æ–‡ä»¶åº•ä¸‹çš„&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/security-getting-started.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tutorial: Getting started with security&lt;/a&gt; é–‹å§‹ï¼Œéç¨‹æ¯”è¼ƒä¸æœƒé€™éº¼è¡€å°¿ã€‚&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹ç‚ºäº†å•Ÿç”¨ authentication &amp;amp; httpsï¼Œé€™ç¯‡è¦åšçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;enable x-pack &amp;amp; activate basic license&lt;/li&gt;
&lt;li&gt;Generate self-signed ca, server certificate, client certificate&lt;/li&gt;
&lt;li&gt;Configure Elasticsearch, Kibana, &amp;amp; other components to
&lt;ul&gt;
&lt;li&gt;use server certificate when act as server&lt;/li&gt;
&lt;li&gt;use client certificate when connect to an ELK server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;å•Ÿç”¨-x-pack&#34;&gt;å•Ÿç”¨ X-pack&lt;/h1&gt;
&lt;p&gt;Elasticsearch çš„å®‰å…¨æ€§æ¨¡çµ„ç”± x-pack extension æä¾›ï¼Œåœ¨ &lt;a href=&#34;https://www.elastic.co/what-is/open-x-pack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;6.3.0 ä¹‹å¾Œçš„ç‰ˆæœ¬&lt;/a&gt;ï¼Œå®‰è£ elasticsearch çš„éç¨‹ä¸­å°±é è¨­å®‰è£ x-packã€‚&lt;/p&gt;
&lt;p&gt;é™„ä¸Š&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/get-started-enable-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•Ÿç”¨çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œç”±æ–¼èˆŠç‰ˆçš„ x-pack æ˜¯ä»˜è²»å…§å®¹ï¼Œç›®å‰çš„ elasticsearch å®‰è£å®Œå¾Œï¼Œelasticsearch.yml è¨­å®šé è¨­ä¸å•Ÿç”¨ x-packï¼Œä¹Ÿå°±æ˜¯èªªæ²’çœ‹åˆ°é€™ç¯‡å®˜æ–¹æ–‡ä»¶çš„è©±ï¼Œå¾ˆå®¹æ˜“å°±ç²å¾—æ²’æœ‰ä»»ä½• security åŠŸèƒ½çš„ ELKã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶ç›®å‰å·²ç¶“å¯ä»¥ä½¿ç”¨å…è²»çš„ basic license ä½¿ç”¨ security åŠŸèƒ½ï¼Œé‚„æ˜¯å¸Œæœ›å®˜æ–¹å¯ä»¥ default å•Ÿç”¨ securityã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.license.self_generated.type: basic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery.type: single-node
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å€‘é€™é‚Šå•Ÿç”¨ xpack.securityï¼ŒåŒæ™‚å°‡ self-generated license ç”Ÿå‡ºä¾†ï¼Œæˆ‘å€‘é€™é‚Šåªä½¿ç”¨åŸºæœ¬çš„ basic subscriptionã€‚è‹¥å¸Œæœ›å•Ÿç”¨æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥çœ‹&lt;a href=&#34;https://www.elastic.co/cn/subscriptions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹subcription æ–¹æ¡ˆä»‹ç´¹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœä¸åŒæ™‚è¨­å®šç‚º single-node çš„è©±ï¼Œé è¨­æœƒå°‹æ‰¾å…¶ä»–elasticsearch node ä¾†çµ„æˆ clusterï¼Œè€Œæˆ‘å€‘å°±å¿…é ˆè¦åœ¨æ‰€æœ‰ node ä¸Šå•Ÿç”¨ securityï¼Œé€™ç¯‡åªå¸¶å¤§å®¶åšä¸€å€‹ single node clusterï¼Œç°¡åŒ–æ­¥é©Ÿã€‚&lt;/p&gt;
&lt;p&gt;é‡å•Ÿ elasticsearch ï¼Œæª¢æŸ¥ logï¼Œçœ‹å•Ÿå‹•æ™‚æœ‰æ²’æœ‰è¼‰å…¥ x-pack&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tail -f /var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:49,467][INFO ][o.e.e.NodeEnvironment    ] [elk] using [1] data paths, mounts [[/mnt/disks/elk (/dev/sdb)]], net usable_space [423.6gb], net total_space [491.1gb], types [ext4]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:49,474][INFO ][o.e.e.NodeEnvironment    ] [elk] heap size [3.9gb], compressed ordinary object pointers [true]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:50,858][INFO ][o.e.n.Node               ] [elk] node name [elk], node ID [pC22j9D4R6uiCM7oTc1Fiw], cluster name [elasticsearch]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:50,866][INFO ][o.e.n.Node               ] [elk] version[7.3.1], pid[17189], build[default/deb/4749ba6/2019-08-19T20:19:25.651794Z], OS[Linux/4.15.0-1040-gcp/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/12.0.2/12.0.2+10]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:50,878][INFO ][o.e.n.Node               ] [elk] JVM home [/usr/share/elasticsearch/jdk]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,108][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-ccr]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,109][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-core]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,111][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-logstash]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,113][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-voting-only-node]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,114][INFO ][o.e.p.PluginsService     ] [elk] loaded module [x-pack-watcher]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:39:59,115][INFO ][o.e.p.PluginsService     ] [elk] no plugins loaded
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:07,964][INFO ][o.e.x.s.a.s.FileRolesStore] [elk] parsed [0] roles from file [/etc/elasticsearch/roles.yml]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:10,369][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [elk] [controller/17314] [Main.cc@110] controller (64 bit): Version 7.3.1 (Build 1d93901e09ef43) Copyright (c) 2019 Elasticsearch BV
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:11,776][DEBUG][o.e.a.ActionModule       ] [elk] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:14,396][INFO ][o.e.d.DiscoveryModule    ] [elk] using discovery type [single-node] and seed hosts providers [settings]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,222][INFO ][o.e.n.Node               ] [elk] initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,224][INFO ][o.e.n.Node               ] [elk] starting ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,821][INFO ][o.e.t.TransportService   ] [elk] publish_address {10.140.0.10:9300}, bound_addresses {[::]:9300}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:16,872][INFO ][o.e.c.c.Coordinator      ] [elk] cluster UUID [1CB6_Lt-TUWEmRoN9SE49w]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,088][INFO ][o.e.c.s.MasterService    ] [elk] elected-as-master ([1] nodes joined)[{elk}{pC22j9D4R6uiCM7oTc1Fiw}{Os-2FBjgSTOd1G_I3QYwVQ}{10.140.0.10}{10.140.0.10:9300}{dim}{ml.machine_memory=7836028928, xpack.installed=true, ml.max_open_jobs=20} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 9, version: 921, reason: master node changed {previous [], current [{elk}{pC22j9D4R6uiCM7oTc1Fiw}{Os-2FBjgSTOd1G_I3QYwVQ}{10.140.0.10}{10.140.0.10:9300}{dim}{ml.machine_memory=7836028928, xpack.installed=true, ml.max_open_jobs=20}]}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,819][INFO ][o.e.c.s.ClusterApplierService] [elk] master node changed {previous [], current [{elk}{pC22j9D4R6uiCM7oTc1Fiw}{Os-2FBjgSTOd1G_I3QYwVQ}{10.140.0.10}{10.140.0.10:9300}{dim}{ml.machine_memory=7836028928, xpack.installed=true, ml.max_open_jobs=20}]}, term: 9, version: 921, reason: Publication{term=9, version=921}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,974][INFO ][o.e.h.AbstractHttpServerTransport] [elk] publish_address {10.140.0.10:9200}, bound_addresses {[::]:9200}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:17,975][INFO ][o.e.n.Node               ] [elk] started
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:18,455][INFO ][o.e.c.s.ClusterSettings  ] [elk] updating [xpack.monitoring.collection.enabled] from [false] to [true]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:22,555][INFO ][o.e.l.LicenseService     ] [elk] license [************************************] mode [basic] - valid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-09-16T07:40:22,557][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [elk] Active license is now [BASIC]; Security is enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;enable-user-authentication&#34;&gt;Enable user authentication&lt;/h1&gt;
&lt;p&gt;å•Ÿç”¨ security ä¹‹å‰ï¼Œæˆ‘å€‘ç›´æ¥é€£å…¥ Kibana http://10.140.0.10:5601 ï¼Œä¸ç”¨ä»»ä½•ä½¿ç”¨è€…ç™»å…¥ï¼Œä¾¿å¯ä»¥å®Œæ•´ä½¿ç”¨ Kibana åŠŸèƒ½ï¼ˆåŒ…å« admin ç®¡ç†ä»‹é¢ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å•Ÿç”¨ security å¾Œï¼Œä¾¿éœ€è¦ä½¿ç”¨å¸³è™Ÿå¯†ç¢¼ç™»å…¥ã€‚åœ¨é€™é‚Šå…ˆç”¨å·¥å…·æŠŠä½¿ç”¨è€…å¯†ç¢¼ç”¢ç”Ÿå‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# äº’å‹•å¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# è‡ªå‹•ç”¢ç”Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯†ç¢¼ç”Ÿå‡ºä¾†å¾Œï¼Œå°±æŠŠå¸³è™Ÿå¯†ç¢¼æ”¶å¥½ï¼Œç­‰ç­‰æœƒç”¨åˆ°ã€‚ä¹‹å¾Œåˆæ¬¡ç™»å…¥ä¹Ÿæ˜¯ä½¿ç”¨é€™äº›å¯†ç¢¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;configure-passwords-on-client-side&#34;&gt;Configure passwords on client-side&lt;/h1&gt;
&lt;p&gt;ç”±æ–¼å·²ç¶“å•Ÿç”¨ authenticationï¼Œå…¶ä»– ELK å…ƒä»¶ (Kibana, logstash, filebeat, apm-server,&amp;hellip;) é€£å…¥ Elasticsearch ä¹Ÿéƒ½æœƒéœ€è¦å„è‡ªçš„å¸³è™Ÿå¯†ç¢¼é©—è­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ Kibana ç‚ºä¾‹ï¼Œå¯ä»¥ç›´æ¥åœ¨ kibana.yml ä¸­ç›´æ¥è¨­å®šå¸³è™Ÿå¯†ç¢¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/kibana/kibana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.hosts: [&amp;#34;http://localhost:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.username: &amp;#34;kibana&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.password: &amp;#34;***********&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç•¶ç„¶ï¼Œé€™é‚Šå°±æ˜¯æ˜ç¢¼çš„ï¼Œçœ‹äº†ä¸å¤ªå®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–æ˜¯ä½¿ç”¨ keystore æŠŠ built-in user çš„å¯†ç¢¼åŠ å¯†ï¼Œå­˜åœ¨ kibana çš„ keystore è£¡é¢ï¼Œé‡å•Ÿ kibana æ™‚ä¾¿æœƒè¼‰å…¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/kibana/bin/kibana-keystore create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/kibana/bin/kibana-keystore add elasticsearch.username
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/kibana/bin/kibana-keystore add elasticsearch.password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å•Ÿç”¨ Filebeat åŠŸèƒ½ï¼Œbeat å…ƒä»¶é€£å…¥ elasticsearch ä¸€æ¨£éœ€è¦è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/filebeat keystore create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/filebeat add elasticsearch.username
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/filebeat add elasticsearch.password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å•Ÿç”¨ application performance monitoring(APM) åŠŸèƒ½ï¼Œapm-server å…ƒä»¶é€£å…¥ elasticsearch ä¸€æ¨£éœ€è¦è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/apm-server keystore create
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/apm-server add elasticsearch.username
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/apm-server/bin/apm-server add elasticsearch.password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;encrypting-communications&#34;&gt;Encrypting Communications&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢åŠ äº† username/password authenticationï¼Œä½†å¦‚æœæ²’ https/tls åŸºæœ¬ä¸Šé‚„æ˜¯è£¸å¥”ã€‚æ¥ä¸‹ä¾†è¦è™•ç†é€£ç·šåŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/encrypting-internode-communications.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹ tutorial&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å †å®˜æ–¹æ–‡ä»¶ï¼Œæˆ‘å€‘å…ˆè·³éXD&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;elasticsearch security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elastic-stack-overview/7.3/ssl-tls.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;elastic stack ssl tls&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.3/configuring-tls.html#configuring-tls&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;elasticsearch configuring tls&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.3/certutil.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;certutil&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åˆ†æä¸€ä¸‹éœ€æ±‚è·Ÿè¦æ ¼&#34;&gt;åˆ†æä¸€ä¸‹éœ€æ±‚è·Ÿè¦æ ¼&lt;/h1&gt;
&lt;p&gt;æˆ‘å€‘éœ€è¦ç‚ºæ¯ä¸€å€‹ node ç”Ÿä¸€çµ„ node certificateï¼Œä½¿ç”¨ node certificate ç”¢ç”Ÿ client certificates æä¾›çµ¦å…¶ä»– clientï¼Œé€£å…¥æ™‚æœƒé©—è­‰ client æ˜¯å¦ç‚º authenticated userã€‚&lt;/p&gt;
&lt;p&gt;é‡å°ç›®å‰é€™å€‹ single-node ELK stackï¼Œæˆ‘å€‘å¯èƒ½æœ‰å¹¾ç¨®é¸æ“‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°½ç½²ä¸€å€‹ localhostï¼Œç•¶ç„¶é€™å€‹åªèƒ½åœ¨ localhost ä¸Šçš„å®¢æˆ¶ç«¯å…ƒä»¶ä½¿ç”¨ï¼Œåˆ¥çš„ node ç„¡æ³•ç”¨é€™å€‹é€£å…¥&lt;/li&gt;
&lt;li&gt;ç°½ç½²ä¸€å€‹ public DNS elk.chechiachang.comï¼Œå¯ä»¥åœ¨å…¬é–‹ç¶²è·¯ä¸Šä½¿ç”¨ï¼Œåˆ¥äººä¹Ÿå¯ä»¥ä½¿ç”¨é€™å€‹DNSå˜—è©¦é€£å…¥&lt;/li&gt;
&lt;li&gt;ç°½ç½²ä¸€å€‹ç§æœ‰ç¶²åŸŸçš„ DNSï¼Œä¾‹å¦‚åœ¨ GCP ä¸Šå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://cloud.google.com/compute/docs/internal-dns?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…§éƒ¨dnsæœå‹™&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;é•·é€™æ¨£ elk.asia-east1-b.c.chechiachang.internal&lt;/li&gt;
&lt;li&gt;[INSTANCE_NAME].[ZONE].c.[PROJECT_ID].internal&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ‰éœ€è¦ä¹Ÿå¯ä»¥ä¸€ä»½ server certificate ä¸­ç°½ç½²è¤‡æ•¸å€‹ site&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šé¸æ“‡ä½¿ç”¨å…§éƒ¨ dnsï¼Œelk.asia-east1-b-c-chechaichang.internalï¼Œè®“é€™å€‹ single-node elk åªèƒ½é€éå…§éƒ¨ç¶²è·¯å­˜å–ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;elasticsearch: elk.asia-east1-b.c.chechaichang.internal:9200&lt;/li&gt;
&lt;li&gt;kibana: elk.asia-east1-b.c.chechaichang.internal:5601&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨è¦é€£è¿‘ä¾† kibanaï¼Œæˆ‘å€‘ä½¿ç”¨ vpn æœå‹™é€£é€²ç§æœ‰ç¶²è·¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæƒ³ä½¿ç”¨å¤–éƒ¨ dnsï¼Œè®“ elk stack åœ¨å…¬é–‹ç¶²è·¯å¯ä»¥ä½¿ç”¨ï¼Œex. elk.chechiachang.comï¼Œå¯ä»¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCP çš„ load balanceræ›é€²ä¾†ï¼Œç”¨ GCP çš„ certificate manager è‡ªå‹•ç®¡ç† certificate&lt;/li&gt;
&lt;li&gt;æˆ–æ˜¯åœ¨ node ä¸Šé–‹ä¸€å€‹ nginx serverï¼Œå†æŠŠ certificate ç”¨ certbot ç”Ÿå‡ºä¾†&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;generate-certificates&#34;&gt;Generate certificates&lt;/h1&gt;
&lt;p&gt;å…ˆæŠŠ X.509 digital certificate çš„ certificate authority(CA) ç”Ÿå‡ºä¾†ã€‚æˆ‘å€‘å¯ä»¥è¨­å®šå¯†ç¢¼ä¿è­·é€™å€‹æª”æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/elasticsearch/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# CA generated with Elastic tool
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-certutil ca \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -out /etc/elasticsearch/config/elastic-stack-ca.p12
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”Ÿå‡ºä¾†æ˜¯ PKCS#12 æ ¼å¼çš„ keystoreï¼ŒåŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CA çš„ public certificate&lt;/li&gt;
&lt;li&gt;CA çš„åŸºæœ¬è³‡è¨Š&lt;/li&gt;
&lt;li&gt;ç°½ç½²å…¶ä»– node certificates ä½¿ç”¨çš„ç§é‘°(private key)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨ openssl å·¥å…·çœ‹ä¸€ä¸‹å…§å®¹ï¼Œå¦‚æœæœ‰å¯†ç¢¼é€™é‚Šè¦ç”¨å¯†ç¢¼è§£é–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 -in /etc/elasticsearch/config/elastic-stack-ca.p12 -info -nokeys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™„å¸¶èªªæ˜ï¼ŒX.509 æœ‰å¤šç¨®æª”æ¡ˆæ ¼å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.pem&lt;/li&gt;
&lt;li&gt;.cer, .crt, .der&lt;/li&gt;
&lt;li&gt;.p12&lt;/li&gt;
&lt;li&gt;.p7b, .p7c&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–æª”æ¡ˆæ ¼å¼å¯ä»¥æœ‰å…¶ä»–ç”¨é€”ï¼Œä¹Ÿå°±æ˜¯èªªè£¡é¢è£çš„ä¸ä¸€å®šæ˜¯ X.509 æ†‘è­‰ã€‚è£¡é¢çš„å…§å®¹ä¹Ÿä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ELK è¨­å®šçš„éç¨‹ä¸­ï¼Œç”±æ–¼ä¸æ˜¯æ‰€æœ‰çš„ ELK component éƒ½æ”¯æ´ä½¿ç”¨ .p12 æª”æ¡ˆï¼Œæˆ‘å€‘åœ¨è¨­å®šéç¨‹ä¸­æœƒäº’ç›¸å°ˆæ›ï¼Œæˆ–æ˜¯æ··ç”¨å¤šç¨®æª”æ¡ˆæ ¼å¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;generate-certificate&#34;&gt;Generate certificate&lt;/h1&gt;
&lt;p&gt;&amp;laquo;&amp;laquo;&amp;laquo;&amp;lt; HEAD&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ç”¨ elastic-stack-ca.p12 é€™çµ„ keystoreè£¡é¢çš„ CA èˆ‡ private keyï¼Œç‚º elk.asia-east1-b.c.chechiachang.internal ç°½ä¸€å€‹ p12 keystoreï¼Œè£¡é¢æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node certificate&lt;/li&gt;
&lt;li&gt;node key&lt;/li&gt;
&lt;li&gt;CA certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šåªç”¢ç”Ÿä¸€çµ„ server certificate çµ¦ single-node cluster çš„ node-1&lt;/p&gt;
&lt;p&gt;=======&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ç”¨ elastic-stack-ca.p12 é€™çµ„ keystoreè£¡é¢çš„ CA èˆ‡ private keyï¼Œç‚º elk.asia-east1-b.c.chechiachang.internal ç°½ä¸€å€‹ p12 keystoreï¼Œè£¡é¢æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node certificate&lt;/li&gt;
&lt;li&gt;node key&lt;/li&gt;
&lt;li&gt;CA certificate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™é‚Šåªç”¢ç”Ÿä¸€çµ„ server certificate çµ¦ single-node cluster çš„ node-1&lt;/p&gt;
&lt;p&gt;å¦‚æœ cluster ä¸­æœ‰å¤šå€‹ elasticsearchï¼Œç‚ºæ¯å€‹ node ç”¢ç”Ÿ certificate æ™‚éƒ½è¦ä½¿ç”¨åŒæ¨£ CA ä¾†ç°½ç½²ï¼Œè®“ server ä¿¡ä»»é€™çµ„ CAã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ elasticsearch-certutil ç°¡åŒ–ç°½ç½²éç¨‹ï¼Œå¾ç”¢ç”Ÿ CA ï¼Œåˆ°ä½¿ç”¨ CA ç°½ç½² certificateã€‚å¦å¤–ï¼Œå†ç”¢ç”Ÿ certificate ä¸­ä½¿ç”¨ Subject Alternative Name(SAN)ï¼Œä¸¦è¼¸å…¥ ip èˆ‡ dnsã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# certificate for site: private dns with Elastic CA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-certutil cert \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --ca /etc/elasticsearch/config/elastic-stack-ca.p12 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --name elk.asia-east1-b.c.chechaichang.internal \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --dns elk.asia-east1-b.c.chechaichang.internal \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --ip 10.140.0.10 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -out /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”¨ openssl çœ‹ä¸€ä¸‹å…§å®¹ï¼Œå¦‚æœæœ‰å¯†ç¢¼é€™é‚Šè¦ç”¨å¯†ç¢¼è§£é–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -info -nokeys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;server ç”¨é€™å€‹ certificate ï¼Œå•Ÿç”¨ sslã€‚&lt;/p&gt;
&lt;p&gt;client ä½¿ç”¨é€™å€‹ certificate ç”¢ç”Ÿå‡ºä¾†çš„ client.cer èˆ‡ client.key èˆ‡ server é€£ç·šï¼Œserver æ‰æ¥å—å®¢æˆ¶ç«¯æ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;25f5ab795b9e698333a36fde7ecf23a8ba9d4595
è¨˜å¾—æŠŠæ‰€æœ‰æ¬Šé‚„çµ¦ elasticsearch çš„ä½¿ç”¨è€…ï¼Œé¿å… permission denied&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Change owner to fix read permission
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown -R elasticsearch:elasticsearch /etc/elasticsearch/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰å¯†ç¢¼è¨˜å¾—ä¹Ÿè¦ç”¨ keystore æŠŠå¯†ç¢¼åŠ å¯†å¾Œå–‚çµ¦ elasticsearch&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é—œæ–¼ X.509 Certifcate ä¹‹å¾Œæœ‰ç©ºæˆ‘å€‘ä¾†èŠä¸€ä¸‹&lt;/p&gt;
&lt;h1 id=&#34;æ›´æ–°-elasticsearch-è¨­å®š&#34;&gt;æ›´æ–° elasticsearch è¨­å®š&lt;/h1&gt;
&lt;p&gt;Certificates éƒ½ç”Ÿå®Œäº†ï¼Œæ¥ä¸‹ä¾†æ›´æ”¹ elasticsearch çš„åƒæ•¸ï¼Œåœ¨ transport layer å•Ÿç”¨ sslã€‚å•Ÿç”¨ security å¾Œï¼Œåœ¨ transport layer å•Ÿå‹• ssl æ˜¯å¿…é ˆçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# use certificate. full will verify dns and ip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.verification_mode: certificate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.keystore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.truststore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿç”¨ security èˆ‡ transport layer çš„ sslï¼Œç„¶å¾ŒæŒ‡å®š keystoreè·¯å¾‘ï¼Œè®“ server åŸ·è¡Œ client authentication
ç”±æ–¼é€™ç­† p12 å¸¶æœ‰ CA certificate ä½œç‚º trusted certificate entryï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é †ä¾¿ç•¶ä½œ trustoreï¼Œè®“ client ä¿¡ä»»é€™å€‹ CA&lt;/p&gt;
&lt;p&gt;security é€™é‚Šæä¾›äº† server side (elasticsearch) åœ¨æª¢æŸ¥å®¢æˆ¶ç«¯é€£ç·šæ™‚çš„æª¢æŸ¥æ¨¡å¼(vertification mode)ï¼Œ&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#ssl-tls-settings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ä»¶æœ‰èªªæ˜&lt;/a&gt;ï¼Œå¯ä»¥è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;certificate: æª¢æŸ¥ certificate åŠ å¯†æ˜¯å¦æœ‰æ•ˆ&lt;/li&gt;
&lt;li&gt;full: ç°½ node certificate æ™‚å¯ä»¥æŒ‡å®š ip dnsï¼Œå•Ÿç”¨æœƒæª¢æŸ¥ä¾†æº node ip dns æ˜¯å¦ä¹Ÿæ­£ç¢º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(Optional) HTTP layer å•Ÿå‹• ssl&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.http.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.http.ssl.keystore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.http.ssl.truststore.path: /etc/elasticsearch/config/node-1.p12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.truststore.secure_password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å•Ÿ elasticsearchï¼Œçœ‹ä¸€ä¸‹ log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tail -f /var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾Œä½ å°±ç™¼ç¾ï¼ŒåŸä¾† kibana é€£å…¥ çš„ http é€£ç·šï¼Œä¸æ–·è¢« server é€™ç«¯æ‹’çµ•ã€‚æ‰€ä»¥ä»¥ä¸‹è¦ä¾†è¨­å®š kibana&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;kibana&#34;&gt;Kibana&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/kibana/7.3/using-kibana-with-security.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;using kibana with security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/kibana/7.3/configuring-tls.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kibana configuring tls&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨å‰›å‰›ç°½çš„ server certificateï¼Œå¾è£¡é¢ parse å‡º client-ca.cerï¼Œé‚„æœ‰ client.cer èˆ‡ client.key&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/kibana/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl pkcs12 --help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: pkcs12 [options]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Valid options are:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -chain              Add certificate chain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -nokeys             Don&amp;#39;t output private keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -nocerts            Don&amp;#39;t output certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -clcerts            Only output client certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -cacerts            Only output CA certificates
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -info               Print info about PKCS#12 structure
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -nodes              Don&amp;#39;t encrypt private keys
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -in infile          Input filename
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# no certs, no descript
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &amp;gt; /etc/kibana/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &amp;gt; /etc/kibana/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &amp;gt; /etc/kibana/config/client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo chown -R kibana:kibana /etc/kibana/config/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›´æ”¹ kibana é€£å…¥ elasticsearch çš„é€£ç·šè¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/kigana/kibana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.hosts: [&amp;#34;https://elk.asia-east1-b.c.chechaichang.internal:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.certificate: /etc/kibana/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.key: /etc/kibana/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.certificateAuthorities: [ &amp;#34;/etc/kibana/config/client-ca.cer&amp;#34; ]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.ssl.verificationMode: full
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æŒ‡å®š ssl.certificate, ssl.key åšé€£ç·š elasticsearch server æ™‚çš„ user authentication&lt;/li&gt;
&lt;li&gt;ç”±æ–¼æˆ‘å€‘æ˜¯ self-signed CAï¼Œæ‰€ä»¥éœ€è¦è®“å®¢æˆ¶ç«¯ä¿¡ä»»é€™å€‹æˆ‘å€‘è‡ªç°½çš„ CA&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„é€™é‚Š elasticsearch.hosts æˆ‘å€‘å·²ç¶“å¾ http://localhost æ›æˆ https çš„å…§éƒ¨ dnsï¼ŒåŸæœ‰çš„ localhost å·²ç¶“ç„¡æ³•ä½¿ç”¨ï¼ˆå¦‚æœ elasicsearch æœ‰ enforce https çš„è©±ï¼‰&lt;/p&gt;
&lt;p&gt;é‡å•Ÿ Kibanaï¼Œçœ‹ä¸€ä¸‹ log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ²’æœ‰ä¸€ç›´å™´ ssl certificate error çš„è©±ï¼Œæ­å–œä½ æˆåŠŸäº†&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œé™¤äº† kibana ä»¥å¤–ï¼Œæˆ‘å€‘é‚„æœ‰å…¶ä»–çš„ client éœ€è¦é€£å…¥ elasticsearch&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠŠä¸Šè¿°æ­¥é©Ÿåœ¨ apm-server, filebeat, å…¶ä»–çš„ beat ä¸Šä¹Ÿè¨­å®š&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ k8s ä¸Šï¼Œè¦æŠŠ cer, key ç­‰æª”æ¡ˆç”¨ volume æ›é€²å»
&amp;laquo;&amp;laquo;&amp;laquo;&amp;lt; HEAD&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kibana æœ¬èº«ä¹Ÿæœ‰ server çš„åŠŸèƒ½ï¼Œè®“å…¶ä»– client é€£å…¥ã€‚ä¾‹å¦‚è®“ filebeat è‡ªå‹•å°‡ document tempalte åŒ¯å…¥ kibanaï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kibana server certificate&lt;/li&gt;
&lt;li&gt;filebeat client to kibana server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;=======&lt;/p&gt;
&lt;p&gt;Kibana æœ¬èº«ä¹Ÿæœ‰ server çš„åŠŸèƒ½ï¼Œè®“å…¶ä»– client é€£å…¥ã€‚ä¾‹å¦‚è®“ filebeat è‡ªå‹•å°‡ document tempalte åŒ¯å…¥ kibanaï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦è¨­å®š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kibana server certificate&lt;/li&gt;
&lt;li&gt;filebeat client to kibana server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°±æ˜¯ä»–å€‘å½¼æ­¤äº’æ‰“ï¼Œéƒ½è¦æœ‰ ca, key, cert&lt;/p&gt;
&lt;h3 id=&#34;ä½†åŸºæœ¬ä¸Šçš„è¨­å®šéƒ½ä¸€æ¨£ä¸‹é¢å¯ä»¥ä¸ç”¨çœ‹ä¸‹å»äº†xd&#34;&gt;ä½†åŸºæœ¬ä¸Šçš„è¨­å®šéƒ½ä¸€æ¨£ï¼Œä¸‹é¢å¯ä»¥ä¸ç”¨çœ‹ä¸‹å»äº†XD&lt;/h3&gt;
&lt;p&gt;å¦‚æœæœ‰ç”¨åˆ°å†æŸ¥æ–‡ä»¶å°±å¥½ï¼Œé€™é‚Šç›´æ¥å°çµ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®š security å‰è¦å…ˆæƒ³è™Ÿè‡ªå·±çš„éœ€æ±‚ï¼Œå¦‚ä½•é€£å…¥ï¼Œå®‰å…¨æ€§è¨­å®šåˆ°å“ªé‚Š&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ utility è‡ªç°½ CAï¼Œç„¶å¾Œç”¢ç”Ÿ server certificate&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ server certificate å† parse å‡º ca-certificate, client cers, key&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;kibana-ä½œç‚º-server&#34;&gt;kibana ä½œç‚º server&lt;/h1&gt;
&lt;p&gt;å·¥ä½œè·¯å¾‘å¯èƒ½æ˜¯é€™æ¨£ï¼š app(apm-client library) -&amp;gt; apm-server -&amp;gt; kibana -&amp;gt; elasticsearch&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kibana é€£å…¥ elasticsearchæ™‚ï¼Œ kibana æ˜¯ client åƒ elasticsearch çš„æ†‘è­‰&lt;/li&gt;
&lt;li&gt;apm-server é€£å…¥ kibanaæ™‚ï¼Œkibana æ˜¯ serverï¼Œapm-server åƒ kibana çš„æ†‘è­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆæ›´æ”¹ kibana è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/kibana/kibana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.ssl.certificate: /etc/kibana/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.ssl.key: /etc/kibana/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å•Ÿ kibana&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;apm-server&#34;&gt;Apm-server&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/apm/server/7.3/securing-apm-server.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.elastic.co/guide/en/apm/server/7.3/securing-apm-server.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‡‰ç”¨ç«¯çš„ apm-client (ex. apm-python-client)ï¼Œé€£å…¥ apm-server&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ http çš„ç‹€æ³ä¸‹ï¼Œé›–ç„¶æœ‰ä½¿ç”¨ secret-tokenï¼Œä½†é‚„æ˜¯è£¸å¥”&lt;/li&gt;
&lt;li&gt;åœ¨ https çš„ç‹€æ³ä¸‹ï¼Œè¦æŠŠ certificatesï¼Œç„¶å¾Œé¤µçµ¦æ‡‰ç”¨ç«¯çš„client library&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´æ”¹ apm-server çš„è¨­å®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/apm-server/apm-server.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;host: &amp;#34;0.0.0.0:8200&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  secret_token: &amp;lt;è¨­å®šä¸€çµ„å¤ å®‰å…¨çš„ token&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  rum:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kibana:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;https&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.kibana:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enable: false # can only have 1 output
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;monitoring.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;https&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: &amp;#34;*******************&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: [&amp;#34;elk.asia-east1-b.c.checahichang.internal:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.verification_mode: full
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.certificate_authorities: [&amp;#34;/etc/apm-server/config/client-ca.cer&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.certificate: &amp;#34;/etc/apm-server/config/client.cer&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ssl.key: &amp;#34;/etc/apm-server/config/client.key&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å•Ÿ apm-server&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl restart apm-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu apm-server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;apm-library&#34;&gt;APM library&lt;/h1&gt;
&lt;p&gt;æ‡‰ç”¨ç«¯çš„è¨­å®šå°±éœ€è¦ä¾æ“š library çš„å¯¦åšè¨­å®šï¼Œä¾‹å¦‚ flask-apmagent-python&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ELASTIC_APM_SERVER_CERT=/etc/elk/certificates/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/apm/agent/python/current/configuration.html#config-server-cert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;apm agent python config server cert&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;filebeat&#34;&gt;filebeat&lt;/h1&gt;
&lt;p&gt;è¨˜å¾—æˆ‘å€‘åœ¨ node ä¸Šæœ‰å®‰è£ Self-monitoring filebeatï¼Œelasticsearch æ”¹æˆ ssl é€™é‚Šç•¶ç„¶ä¹Ÿé€£ä¸ç›¡å»äº†ï¼Œå†åšåŒæ¨£æ“ä½œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install filebeat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/filebeat/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &amp;gt; /etc/filebeat/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &amp;gt; /etc/filebeat/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &amp;gt; /etc/filebeat/config/client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Restart filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl restart filebeat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;journalctl -fu filebeat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;å¦‚æœä½ çš„æ‡‰ç”¨åœ¨-kubernetes-ä¸Š&#34;&gt;å¦‚æœä½ çš„æ‡‰ç”¨åœ¨ kubernetes ä¸Š&lt;/h1&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•æ‹¿åˆ° client.cer ï¼Œç„¶å¾Œç”¨ secret å¡é€² k8sï¼Œåœ¨ç”¨ volume from secretsï¼Œæ›çµ¦ç›£æ¸¬æ‡‰ç”¨çš„ filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/beats/config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -nocerts -nodes &amp;gt; /etc/beats/config/client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -clcerts -nokeys &amp;gt; /etc/beats/config/client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl pkcs12 -in /etc/elasticsearch/config/node-1.p12 -cacerts -nokeys -chain &amp;gt; /etc/beats/config/client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud compute scp elk:/etc/beats/config/* .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; client-ca.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; client.cer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n elk create secret generic elk-client-certificates \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=client-ca.cer=client-ca.cer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=client.cer=client.cer \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=client.key=client.key
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f elk/gke/filebeat/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Self-host ELK stack - Installation</title>
      <link>https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/</link>
      <pubDate>Sun, 15 Sep 2019 11:43:03 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt; ç³»åˆ—æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç‚ºç¯„ä¾‹çš„ ELK çš„ç‰ˆæœ¬æ˜¯ç•¶å‰çš„ stable release 7.3.1ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ–¼æˆ‘æ¯”è¼ƒç†Ÿæ‚‰ GCP / GKE çš„æœå‹™ï¼Œé€™ç¯‡çš„æ“ä½œéç¨‹éƒ½æœƒä»¥ GCP å¹³å°ä½œç‚ºç¯„ä¾‹ï¼Œä¸éæ“ä½œéç¨‹å¤§é«”ä¸Šæ˜¯è·¨å¹³å°é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘çš„æ–‡ç« æœ‰èˆˆè¶£ï¼Œæ­¡è¿åˆ°æˆ‘çš„ç¶²ç«™ä¸Š &lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://chechia.net&lt;/a&gt; é–±è®€å…¶ä»–æŠ€è¡“æ–‡ç« ï¼Œæœ‰ä»»ä½•è¬¬èª¤ä¹Ÿè«‹å„æ–¹å¤§å¾·ç›´æ¥è¯ç¹«æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ndash;&lt;/p&gt;
&lt;h1 id=&#34;ç°¡ä»‹-elk-stack&#34;&gt;ç°¡ä»‹ ELK stack&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹èªªæ˜æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;elk-çš„å…ƒä»¶&#34;&gt;ELK çš„å…ƒä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Elasticsearch: åŸºæ–¼ Lucene çš„åˆ†æ•£å¼å…¨æ–‡æœç´¢å¼•æ“&lt;/li&gt;
&lt;li&gt;Logstash: æ•¸æ“šè™•ç† pipeline&lt;/li&gt;
&lt;li&gt;Kibana: ELK stack çš„ç®¡ç†å¾Œå°èˆ‡æ•¸æ“šè¦–è¦ºåŒ–å·¥å…·&lt;/li&gt;
&lt;li&gt;Beats: è¼•é‡ç´šçš„æ‡‰ç”¨ç«¯æ•¸æ“šæ”¶é›†å™¨ï¼Œæœƒå¾è¢«ç›£æ§ç«¯æ”¶é›† log èˆ‡ç›£æ§æ•¸æ“š(metrics)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;elk-çš„å·¥ä½œæµç¨‹&#34;&gt;ELK çš„å·¥ä½œæµç¨‹&lt;/h3&gt;
&lt;p&gt;beats -&amp;gt; (logstash) -&amp;gt; elasticsearch -&amp;gt; kibana&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°‡ beats æ”¾åœ¨æ‡‰ç”¨ç«¯çš„ä¸»æ©Ÿä¸Šï¼Œæˆ–æ˜¯åœ¨å®¹å™¨åŒ–ç’°å¢ƒç¨®ä½œç‚º sidecarï¼Œè·Ÿæ‡‰ç”¨æ”¾åœ¨ä¸€èµ·&lt;/li&gt;
&lt;li&gt;è¨­å®š beats å¾æŒ‡å®šçš„è·¯å¾‘æ”¶é›† log èˆ‡ metrics&lt;/li&gt;
&lt;li&gt;è¨­å®š beats å‘å¾Œè¼¸å‡ºçš„é ç«¯ç›®æ¨™&lt;/li&gt;
&lt;li&gt;(Optional) beats è¼¸å‡ºåˆ° logstash ï¼Œå…ˆé€²è¡Œæ•¸æ“šçš„è®Šæ›´ã€æ ¼å¼æ•´ç†ï¼Œåœ¨å¾Œé€åˆ° elasticsearch&lt;/li&gt;
&lt;li&gt;beats å‘å¾Œè¼¸å‡ºåˆ° elasticsearchï¼Œå„²å­˜æ•¸æ“šæ–‡ä»¶(document)ï¼Œä¸¦ä¾ç…§æ¨£å¼(template)èˆ‡ç´¢å¼•(index)å„²å­˜ï¼Œä¾¿å¯åœ¨ elasticsearch ä¸Šå…¨æ–‡æœç´¢æ•¸æ“š&lt;/li&gt;
&lt;li&gt;é€é Kibanaï¼Œå°‡ elasticsearch ä¸Šçš„ log é¡¯ç¤º&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å®˜æ–¹ä¸æ˜¯æœ‰å‡ºæ–‡ä»¶å—&#34;&gt;å®˜æ–¹ä¸æ˜¯æœ‰å‡ºæ–‡ä»¶å—&lt;/h1&gt;
&lt;p&gt;Elastic å®˜æ–¹æº–å‚™äº†å¤§é‡çš„æ–‡ä»¶ï¼Œç†è«–ä¸Šè¦è·Ÿè‘—æ–‡ä»¶ä¸€æ­¥ä¸€æ­¥æ¶è¨­é€™æ•´å¥—å·¥å…·æ‡‰è©²æ˜¯ååˆ†å®¹æ˜“ã€‚ç„¶è€Œå¯¦éš›ç…§è‘—åšå»é‡ä¸Šå¾ˆå¤šå›°é›£ã€‚ç”±æ–¼ç¼ºä¹ get-started çš„ç¯„ä¾‹æ–‡ä»¶ï¼Œä¸ç†Ÿæ‚‰ ELK è¨­å®šçš„ä½¿ç”¨è€…ï¼Œå¸¸å¸¸éœ€è¦åœä¸‹ä¾†é™¤éŒ¯ï¼Œç”šè‡³å› ç‚ºæ¼æ‰æŸå€‹æ­¥é©Ÿï¼Œè€Œéœ€è¦å›é ­é‡åšä¸€éã€‚&lt;/p&gt;
&lt;p&gt;èªªç©¿äº†æœ¬ç¯‡çš„æŠ€è¡“å«é‡ä¸é«˜ï¼Œå°±åªæ˜¯ä¸€å€‹è¸©é›·éç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Lets get our hands dirty.&lt;/p&gt;
&lt;h1 id=&#34;warning&#34;&gt;WARNING&lt;/h1&gt;
&lt;p&gt;é€™ç¯‡å®‰è£éç¨‹æ²’æœ‰åšå®‰å…¨æ€§è¨­å®šï¼Œç”±æ–¼ ELK stack çš„å®‰å…¨æ€§åŠŸèƒ½æ¨¡çµ„ï¼Œåœ¨&lt;a href=&#34;https://www.elastic.co/what-is/open-x-pack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v6.3.0 ä»¥å‰çš„ç‰ˆæœ¬æ˜¯ä¸åŒ…å«å®‰å…¨æ€§æ¨¡çµ„çš„&lt;/a&gt;ï¼Œå®˜æ–¹çš„å®‰è£èªªæ˜æ–‡ä»¶å°‡å®‰å…¨æ€§è¨­å®šå¦æˆä¸€ç¯‡ã€‚æˆ‘ç¬¬ä¸€æ¬¡å®‰è£ï¼Œå…¨éƒ¨å®‰è£å®Œå¾Œï¼Œæ‰ç™¼ç¾è£é ­æ²’æœ‰ä»»ä½•å®‰å…¨æ€§è¨­å®šï¼ŒåŒ…å«å¸³è™Ÿå¯†ç¢¼ç™»å…¥ã€api secret tokenã€https/tls é€šé€šæ²’æœ‰ï¼Œæ•´çµ„ elk è£¸å¥”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘é€™é‚Šåˆ†é–‹çš„ç›®çš„ï¼Œä¸æ˜¯è®“å¤§å®¶éƒ½è·Ÿæˆ‘ä¸€æ¨£è¢«é›·(XD)ï¼Œè€Œæ˜¯å› ç‚º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦èµ·ä¸€ç¯‡å°å®‰å…¨æ€§è¨­å®šå¤šåŠ èªªæ˜&lt;/li&gt;
&lt;li&gt;åœ¨å®‰å…¨çš„å…§ç¶²ä¸­ï¼Œæ²’æœ‰å®‰å…¨æ€§è¨­å®šï¼Œå¯ä»¥å¤§å¹…åŠ é€Ÿé–‹ç™¼èˆ‡é™¤éŒ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é›–ç„¶æ²’æœ‰å®‰å…¨æ€§è¨­å®šï¼Œä½†ä»ç„¶æœ‰å®Œæ•´çš„åŠŸèƒ½ï¼Œå¦‚æœåªæ˜¯åœ¨æ¸¬è©¦ç’°å¢ƒï¼Œæˆ–æ˜¯æƒ³è¦è©•ä¼°è©¦ç”¨ self-hosted ELKï¼Œé€™ç¯‡çš„èªªæ˜å·²è¶³å¤ ã€‚ä½†åƒè¬ä¸è¦ç”¨é€™ç¯‡ä¸Š public network æˆ–æ˜¯ç”¨åœ¨ production ç’°å¢ƒå–”ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå¸Œæœ›ç¬¬ä¸€æ¬¡å®‰è£å°±æœ‰å®Œæ•´çš„ security è¨­å®šï¼Œè«‹ç­‰å¾…ä¸‹ç¯‡ &lt;a href=&#34;#secure-elk-stack&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;è¨è«–éœ€æ±‚èˆ‡è¦æ ¼&#34;&gt;è¨è«–éœ€æ±‚èˆ‡è¦æ ¼&lt;/h1&gt;
&lt;p&gt;é€™é‚Šåªæ˜¯å¸¶å¤§å®¶éä¸€ä¸‹åŸºç¤å®‰è£æµç¨‹ï¼Œæˆ‘å€‘åœ¨ç§æœ‰ç¶²è·¯ä¸­æ­å»ºä¸€å° standalone çš„ ELK stackï¼Œé€šé€šæ”¾åœ¨ä¸€å°ç¯€é»(node)ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elk-node-standalone 10.140.0.10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;app-node-1          10.140.0.11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...                 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ¬æ©Ÿçš„ ELK stack å…ƒä»¶ï¼Œå½¼æ­¤é€é localhost é€£ç·š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Elasticsearch:  localhost:9200&lt;/li&gt;
&lt;li&gt;Kibana:         localhost:5601&lt;/li&gt;
&lt;li&gt;Apm-server:     localhost:8200&lt;/li&gt;
&lt;li&gt;Self Monitoring Services&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç§æœ‰ç¶²è·¯ä¸­çš„å¤–éƒ¨æœå‹™é€é 10.140.0.10&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;beats å¾å…¶ä»– node è¼¸å‡ºåˆ° Elasticsearch: 10.140.0.10:9200&lt;/li&gt;
&lt;li&gt;beats å¾å…¶ä»– node è¼¸å‡ºåˆ° Apm-server:    10.140.0.10:8200&lt;/li&gt;
&lt;li&gt;åœ¨å…§éƒ¨ç¶²è·¯ä¸­ é€é browser å­˜å– Kibana:  10.140.0.10:5601&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;standalone çš„å¥½è™•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–¹ä¾¿ (å†æ¬¡å¼·èª¿é€™ç¯‡åªæ˜¯ç¤ºç¯„ï¼Œå¯¦å‹™ä¸Šä¸è¦è²ªä¸€æ™‚æ–¹ä¾¿ï¼Œç¶­é‹å´©æ½°)&lt;/li&gt;
&lt;li&gt;æœ€ç°¡åŒ–è¨­å®šï¼ŒELK æœ‰éå¸¸å¤§é‡çš„è¨­å®šå¯ä»¥èª¿æ•´ï¼Œé€™ç¯‡ç°¡åŒ–äº†å¤§éƒ¨åˆ†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Standaloneå¯èƒ½é€ æˆçš„å•é¡Œ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;No High Availablity: æ²’æœ‰ä»»ä½•å®¹éŒ¯å‚™æ´å¯ä»¥ failoverï¼Œé€™å°æ›å°±å…¨æ›&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨æœå‹™å¤šçš„è©±ï¼Œå¾ˆå®¹æ˜“å°±è¶…é node ä¸Šå°æ–¼ç¶²è·¯å­˜å–çš„é™åˆ¶ï¼Œé€ æˆ tcp drop æˆ– delayã€‚éœ€è¦èª¿æ•´ ulimit ä¾†å¢åŠ ç¶²è·¯ï¼Œç•¶ç„¶é€™åœ¨é›²ç«¯ä¸Šæœƒçµ¦ç¶­é‹å¸¶ä¾†æ›´å¤šéº»ç…©ï¼Œä¸æ˜¯ä¸€å€‹å¥½è§£æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¦æœ‰ production ready çš„ ELK&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HA é–‹èµ·ä¾†&lt;/li&gt;
&lt;li&gt;æŠŠæœå‹™åˆ†æ•£åˆ°ä¸åŒ node ä¸Š, æ–¹ä¾¿ä¹‹å¾Œ scale out å¤šé–‹å¹¾å°
&lt;ul&gt;
&lt;li&gt;elasticsearch-1, elasticsearch-2, elasticsearch-3&amp;hellip;&lt;/li&gt;
&lt;li&gt;kibana-1&lt;/li&gt;
&lt;li&gt;apm-server-1, apm-server-2, &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‡‰ç”¨åœ¨å·²ç¶“å®¹å™¨åŒ–, é€™äº›æœå‹™å…ƒä»¶ä¹Ÿå¯ä»¥ä¸Š Kubernetes åšå®¹å™¨è‡ªå‹•åŒ–ï¼Œé€™å€‹éƒ¨ä»½è »å¥½ç©ï¼Œå¦‚æœæœ‰æ™‚é–“æˆ‘å€‘ä¾†èŠé€™ç¯‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸»æ©Ÿè¨­å®š&#34;&gt;ä¸»æ©Ÿè¨­å®š&lt;/h1&gt;
&lt;p&gt;Elasticsearch å„²å­˜æ•¸æ“šæœƒä½”ç”¨ä¸å°‘ç¡¬ç¢Ÿç©ºé–“ï¼Œæˆ‘å€‹äººçš„ç¿’æ…£æ˜¯åªè¦æœ‰é¡å¤–å ç”¨å„²å­˜ç©ºé–“ï¼Œéƒ½è¦å¦å¤–æ›è¼‰ç¡¬ç¢Ÿï¼Œä¸è¦å ç”¨ rootï¼Œæ‰€ä»¥é€™é‚Šæœƒéœ€è¦å¦å¤–æ›è¼‰ç¡¬ç¢Ÿã€‚&lt;/p&gt;
&lt;p&gt;GCP ä¸Šä½¿ç”¨ Google Compote Engine çš„æœ‹å‹ï¼Œå¯ä»¥ç…§ &lt;a href=&#34;https://cloud.google.com/compute/docs/disks/add-persistent-disk?hl=zh-tw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google å®˜æ–¹æ“ä½œæ­¥é©Ÿæ“ä½œ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®Œæˆå¾Œæ¥è¿‘é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ df -h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ df --human-readable
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Filesystem      Size  Used Avail Use% Mounted on
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/sda1       9.6G  8.9G  682M  93% /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/sdb        492G   63G  429G  13% /mnt/disks/elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /mnt/disks/elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/mnt/disks/elk/apm-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/mnt/disks/elk/kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡³æ–¼éœ€è¦å¤šå°‘å®¹é‡ï¼Œå–æ±ºæ”¶é›†æ•¸æ“šçš„æ•¸é‡ï¼Œè½å·®éå¸¸å¤§ï¼Œå¯ä»¥å…ˆä¸Šå€‹ 100Gb ï¼Œè©¦è·‘ä¸€æ®µæ™‚é–“ï¼Œå†è¦–æƒ…æ³ scale storage diskã€‚&lt;/p&gt;
&lt;h1 id=&#34;é–‹é˜²ç«ç‰†&#34;&gt;é–‹é˜²ç«ç‰†&lt;/h1&gt;
&lt;p&gt;éœ€è¦é–‹æ”¾ 10.140.0.10 é€™å°æ©Ÿå™¨çš„å¹¾å€‹ port&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;elasticsearch           :9200   ä¾†æºåªé–‹æ”¾ç§æœ‰ç¶²è·¯å…¶ä»– ip 10.140.0.0/9&lt;/li&gt;
&lt;li&gt;apm-server              :8200   (åŒä¸Š)&lt;/li&gt;
&lt;li&gt;kibana                  :5601   (åŒä¸Š)ï¼Œå¦‚æœæƒ³å¾å¤–éƒ¨é€é browseré–‹ï¼Œéœ€è¦ whitelist ip&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GCP ä¸Šæœ‰ default çš„é˜²ç«ç‰†å…è¨±è¦å‰‡ï¼Œç§æœ‰ç¶²è·¯å¯ä»¥å½¼æ­¤é€£ç·š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;default-allow-internal: :all    :10.140.0.0/9   tcp:0-65535&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;install-elasticsearch&#34;&gt;Install Elasticsearch&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.3/install-elasticsearch.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Install Elasticsearch å®˜æ–¹æ–‡ä»¶ 7.3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é€™é‚Šç›´æ¥åœ¨ ubuntu 18.04 ä¸Šä½¿ç”¨ apt ä½œç‚ºå®‰è£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install apt-transport-https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;add-apt-repository &amp;#34;deb https://artifacts.elastic.co/packages/7.x/apt stable main&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£å®Œå¾Œè·¯å¾‘é•·é€™æ¨£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/elasticsearch/jvm.options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Utility
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰éœ€è¦ä¹Ÿå¯ä»¥è¤‡å¯«è¨­å®šæª”ï¼ŒæŠŠ log ä¹Ÿç§»åˆ° /mnt/disks/elk/elasticsearch/logs&lt;/p&gt;
&lt;h3 id=&#34;æœå‹™æ§åˆ¶&#34;&gt;æœå‹™æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;é€é systemd ç®¡ç†ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ systemctl æ§åˆ¶ï¼Œ
ç”¨æˆ¶ elasticsearch:elasticsearchï¼Œæ“ä½œæ™‚æœƒéœ€è¦ sudo æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨å•Ÿå‹•å‰è¦å…ˆèª¿æ•´æ•¸æ“šå„²å­˜è·¯å¾‘ï¼Œä¸¦æŠŠæ¬Šé™ç§»è½‰çµ¦ä½¿ç”¨è€…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown elasticsearch:elasticsearch /mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è¨­å®šæª”æ¡ˆ&#34;&gt;è¨­å®šæª”æ¡ˆ&lt;/h3&gt;
&lt;p&gt;ELK æä¾›äº†è¨±å¤šå¯è¨­å®šèª¿æ•´çš„è¨­å®š,ä½†é¾å¤§çš„è¨­å®šæª”æ¡ˆä¹Ÿååˆ†é›£ä¸Šæ‰‹ã€‚æˆ‘å€‘é€™é‚Šå…ˆç°¡å–®æ›´æ”¹ä»¥ä¸‹è¨­å®šæª”æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/elasticsearch/elasticsearch.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Change Network
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;network.host: 0.0.0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Change data path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;path.data: /mnt/disks/elk/elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim /etc/elasticsearch/jvm-options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Adjust heap to 4G
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xms4g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xmx4g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Enable xpack.security
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery.seed_hosts: [&amp;#34;10.140.0.10&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery.type: &amp;#34;single-node&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.security.transport.ssl.enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xpack.license.self_generated.type: basic
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;6.3.0 å¾Œçš„ç‰ˆæœ¬å·²ç¶“é™„ä¸Šå®‰å…¨æ€§æ¨¡çµ„ xpackï¼Œé€™é‚Šé †ä¾¿é–‹èµ·ä¾†ã€‚é—œæ–¼ xpack çš„å®‰å…¨æ€§è¨­å®šï¼Œé€™é‚Šå…ˆç•¥éä¸æã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å•Ÿç”¨ xpack ï¼Œå¯ä»¥è®“æˆ‘å€‘é€é elasticsearch é™„å¸¶çš„å·¥å…·ï¼Œç”¢ç”Ÿä½¿ç”¨è€…èˆ‡å¸³è™Ÿå¯†ç¢¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Keep your passwords safe
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å¾ŒæŠŠå•Ÿå‹• Elasticsearch&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl enable elasticsearch.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl start elasticsearch.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl status elasticsearch.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹ä¸€ä¸‹ logï¼Œç¢ºå®šæœå‹™æœ‰åœ¨æ­£å¸¸å·¥ä½œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tail -f /var/log/elasticsearch/elasticsearch.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ node ä¸Šè©¦æ‰“ Elasticsearch API&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl localhost:9200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;name&amp;#34; : &amp;#34;elk&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;cluster_name&amp;#34; : &amp;#34;elasticsearch&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;cluster_uuid&amp;#34; : &amp;#34;uiMZe7VETo-H6JLFLF4SZg&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;version&amp;#34; : {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;number&amp;#34; : &amp;#34;7.3.1&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_flavor&amp;#34; : &amp;#34;default&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_type&amp;#34; : &amp;#34;deb&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_hash&amp;#34; : &amp;#34;4749ba6&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_date&amp;#34; : &amp;#34;2019-08-19T20:19:25.651794Z&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;build_snapshot&amp;#34; : false,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;lucene_version&amp;#34; : &amp;#34;8.1.0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;minimum_wire_compatibility_version&amp;#34; : &amp;#34;6.8.0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &amp;#34;minimum_index_compatibility_version&amp;#34; : &amp;#34;6.0.0-beta1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  },
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &amp;#34;tagline&amp;#34; : &amp;#34;You Know, for Search&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;kibana&#34;&gt;Kibana&lt;/h1&gt;
&lt;p&gt;æœ‰äº†æ­£å¸¸å·¥ä½œçš„ Elasticsearchï¼Œæ¥ä¸‹ä¾†è¦å®‰è£ kibanaï¼Œç”±æ–¼ apt repository å·²ç¶“åŒ¯å…¥ï¼Œé€™é‚Šç›´æ¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install kibana
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€æ¨£å¿«é€Ÿè¨­å®šä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ vim /etc/kibana/kinana.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# change server.host from localhost to 0.0.0.0 to allow outside requests
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.host: &amp;#34;0.0.0.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add elasticsearch password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.username: &amp;#34;kibana&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;elasticsearch.password:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl enable kibana.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl start kibana.service
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl status kibana.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æª¢æŸ¥ log ä¸¦è©¦æ‰“ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl status kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl localhost:5601
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€éå…§ç¶² ip ä¹Ÿå¯ä»¥ç”¨ browser å­˜å–
ä½¿ç”¨ elastic é€™çµ„å¸³è™Ÿå¯†ç¢¼ç™»å…¥ï¼Œå¯ä»¥æœ‰ç®¡ç†å“¡æ¬Šé™
å¯ä»¥æª¢è¦–ä¸€ä¸‹ kibana çš„é é¢ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦ç³»çµ±åŠŸèƒ½éƒ½ä¸Šå¸¸ä¸Šç·š
http://10.140.0.10/app/monitoring#&lt;/p&gt;
&lt;h1 id=&#34;filebeat&#34;&gt;Filebeat&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯ ELK æœ€åŸºæœ¬æ¶æ§‹: elasticsearch å¼•æ“èˆ‡å‰ç«¯è¦–è¦ºåŒ–ç®¡ç†å·¥å…· Kibanaã€‚ç•¶ç„¶ç¾åœ¨é€²å» kibana æ˜¯æ²’æœ‰æ•¸æ“šçš„ï¼Œæ‰€ä»¥æˆ‘å€‘ç¾åœ¨ä¾†å®‰è£ç¬¬ä¸€å€‹ beatï¼Œæ”¶é›†ç¬¬ä¸€ç­†æ•¸æ“šã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½æœƒè¦ºå¾—å¥‡æ€ª: æˆ‘ç¾åœ¨æ²’æœ‰ä»»ä½•éœ€è¦ç›£æ§çš„æ‡‰ç”¨ï¼Œå»å“ªæ”¶é›†æ•¸æ“š?&lt;/p&gt;
&lt;p&gt;ELK æä¾›çš„è‡ªæˆ‘ç›£æ¸¬ (self-monitoring) çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åœ¨ node ä¸Šéƒ¨å±¬ filebeat ä¸¦å•Ÿç”¨ modulesï¼Œä¾¿å¯ä»¥æŠŠé€™å° node ä¸Šçš„ elasticsearch é‹è¡Œçš„ç‹€æ³ï¼ŒåŒ…å«cpu ç‹€æ³ã€è¨˜æ†¶é«”ç”¨é‡ã€å„²å­˜ç©ºé–“ç”¨é‡ã€å®‰å…¨æ€§å‘Šè­¦ã€&amp;hellip;éƒ½åšç‚ºæ•¸æ“šï¼Œå‚³åˆ° elasticsearch ä¸­ï¼Œä¸¦åœ¨ Kibana monitoring é é¢è£½åœ–é¡¯ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šä¹Ÿå‰›å¥½åšç‚ºæˆ‘å€‘ ELK stack çš„ç¬¬ä¸€ç­†æ•¸æ“šæ”¶é›†ã€‚&lt;/p&gt;
&lt;p&gt;WARNING: é€™é‚Šä¸€æ¨£è¦æé†’ï¼Œ production ç’°å¢ƒå¤šåŠæœƒä½¿ç”¨å¦å¤–ä¸€çµ„çš„ elasticsearch ä¾†ç›£æ§ä¸»è¦çš„é€™çµ„ elastic stackï¼Œä»¥ç¶­æŒ elk stack çš„ç©©å®šæ€§ï¼Œæ‰ä¸æœƒè‡ªå·± monitoring è‡ªå·±ï¼Œçµæœ elastic æ›äº†ï¼Œmetrics è·ŸéŒ¯èª¤è¨Šæ¯éƒ½çœ‹ä¸åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-installation.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹å®‰è£æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install filebeat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é è¨­çš„ filebeat.yml è¨­å®šæª”æ¡ˆä¸æ˜¯å®Œæ•´çš„ï¼Œè«‹åˆ°å®˜ç¶²ä¸‹è¼‰å®Œæ•´ç‰ˆï¼Œä½†å®˜ç¶²æ²’çµ¦æª”æ¡ˆé€£çµ(æ…˜)ï¼Œåªæœ‰ç¶²é ç‰ˆ &lt;a href=&#34;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.3/filebeat-reference-yml.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä¸Š github æŠŠå¥¹è¼‰ä¸‹ä¾†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ wget https://raw.githubusercontent.com/elastic/beats/v7.3.1/filebeat/filebeat.reference.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo mv filebeat-reference-y
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo vim /etc/filebeat/filebeat.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Enable elasticsearch module and kibana module to process metrics of localhost elasticsearch &amp;amp; kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filebeat.modules:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # Server log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  server:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- module: kibana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  # All logs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  log:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# The name will be added to metadata
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;name: filebeat-elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fields:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  env: elk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Add additional cloud_metadata since we&amp;#39;re on GCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;processors:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- add_cloud_metadata: ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Output to elasticsearch
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;output.elasticsearch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  enabled: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  hosts: [&amp;#34;localhost:9200&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;http&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Configure kibana with filebeat: add template, dashboards, etc...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setup.kibana:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  host: &amp;#34;localhost:5601&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  protocol: &amp;#34;http&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  username: &amp;#34;elastic&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  password: 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å•Ÿå‹• filebeat&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl start filebeat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹ä¸€ä¸‹ logï¼Œfilebeat æœƒé–‹å§‹æ”¶é›† elasticsearch çš„ log èˆ‡ metricsï¼Œå¯ä»¥åœ¨ log ä¸Šçœ‹åˆ°æ”¶é›†çš„ç‹€æ³ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo journalctl -fu filebeat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sep 15 06:28:50 elk filebeat[9143]: 2019-09-15T06:28:50.176Z        INFO        [monitoring]        log/log.go:145        Non-zero metrics in the last 30s        {&amp;#34;monitoring&amp;#34;: {&amp;#34;metrics&amp;#34;: {&amp;#34;beat&amp;#34;:{&amp;#34;cpu&amp;#34;:{&amp;#34;system&amp;#34;:{&amp;#34;ticks&amp;#34;:1670860,&amp;#34;time&amp;#34;:{&amp;#34;ms&amp;#34;:66}},&amp;#34;total&amp;#34;:{&amp;#34;ticks&amp;#34;:6964660,&amp;#34;time&amp;#34;:{&amp;#34;ms&amp;#34;:336},&amp;#34;value&amp;#34;:6964660},&amp;#34;user&amp;#34;:{&amp;#34;ticks&amp;#34;:5293800,&amp;#34;time&amp;#34;:{&amp;#34;ms&amp;#34;:270}}},&amp;#34;handles&amp;#34;:{&amp;#34;limit&amp;#34;:{&amp;#34;hard&amp;#34;:4096,&amp;#34;soft&amp;#34;:1024},&amp;#34;open&amp;#34;:11},&amp;#34;info&amp;#34;:{&amp;#34;ephemeral_id&amp;#34;:&amp;#34;62fd4bfa-1949-4356-9615-338ca6a95075&amp;#34;,&amp;#34;uptime&amp;#34;:{&amp;#34;ms&amp;#34;:786150373}},&amp;#34;memstats&amp;#34;:{&amp;#34;gc_next&amp;#34;:7681520,&amp;#34;memory_alloc&amp;#34;:4672576,&amp;#34;memory_total&amp;#34;:457564560376,&amp;#34;rss&amp;#34;:-32768},&amp;#34;runtime&amp;#34;:{&amp;#34;goroutines&amp;#34;:98}},&amp;#34;filebeat&amp;#34;:{&amp;#34;events&amp;#34;:{&amp;#34;active&amp;#34;:-29,&amp;#34;added&amp;#34;:1026,&amp;#34;done&amp;#34;:1055},&amp;#34;harvester&amp;#34;:{&amp;#34;open_files&amp;#34;:4,&amp;#34;running&amp;#34;:4}},&amp;#34;libbeat&amp;#34;:{&amp;#34;config&amp;#34;:{&amp;#34;module&amp;#34;:{&amp;#34;running&amp;#34;:0}},&amp;#34;output&amp;#34;:{&amp;#34;events&amp;#34;:{&amp;#34;acked&amp;#34;:1055,&amp;#34;active&amp;#34;:-50,&amp;#34;batches&amp;#34;:34,&amp;#34;total&amp;#34;:1005},&amp;#34;read&amp;#34;:{&amp;#34;bytes&amp;#34;:248606},&amp;#34;write&amp;#34;:{&amp;#34;bytes&amp;#34;:945393}},&amp;#34;pipeline&amp;#34;:{&amp;#34;clients&amp;#34;:9,&amp;#34;events&amp;#34;:{&amp;#34;active&amp;#34;:32,&amp;#34;published&amp;#34;:1026,&amp;#34;total&amp;#34;:1026},&amp;#34;queue&amp;#34;:{&amp;#34;acked&amp;#34;:1055}}},&amp;#34;registrar&amp;#34;:{&amp;#34;states&amp;#34;:{&amp;#34;current&amp;#34;:34,&amp;#34;update&amp;#34;:1055},&amp;#34;writes&amp;#34;:{&amp;#34;success&amp;#34;:35,&amp;#34;total&amp;#34;:35}},&amp;#34;system&amp;#34;:{&amp;#34;load&amp;#34;:{&amp;#34;1&amp;#34;:1.49,&amp;#34;15&amp;#34;:0.94,&amp;#34;5&amp;#34;:1.15,&amp;#34;norm&amp;#34;:{&amp;#34;1&amp;#34;:0.745,&amp;#34;15&amp;#34;:0.47,&amp;#34;5&amp;#34;:0.575}}}}}}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ•¸æ“šéƒ½æœ‰é€å‡ºï¼Œå°±å¯ä»¥å›åˆ° kibana çš„é é¢ï¼Œçœ‹ä¸€ä¸‹ç›®å‰é€™å€‹ elasticsearch é›†ç¾¤ï¼Œæœ‰é–‹å•Ÿ monitoring åŠŸèƒ½çš„å…ƒä»¶å€‘ï¼Œæ˜¯å¦éƒ½æœ‰æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;http://10.140.0.10/app/monitoring#&lt;/p&gt;
&lt;p&gt;é é¢é•·å¾—åƒé€™æ¨£&lt;/p&gt;


















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;elk/kibana-monitoring.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable width=&#34;100%&#34; height=&#34;100%&#34; /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

&lt;p&gt;Standalone cluster ä¸­çš„ filebeatï¼Œæ˜¯é‚„æœªè·Ÿ elasticsearch é…å°å®Œæˆçš„æ•¸æ“šï¼Œæœƒé¡¯ç¤ºåœ¨å¦å¤–ä¸€å€‹é›†ç¾¤ä¸­ï¼Œé…å°å®Œå¾Œæœƒæ­¸åˆ° elk cluster ä¸­ï¼Œå°±æ˜¯æˆ‘å€‘çš„ä¸»è¦ clusterã€‚&lt;/p&gt;
&lt;p&gt;é»é€²å»å¯ä»¥çœ‹å„å€‹å…ƒä»¶çš„æœå‹™æƒ…å½¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°çµ&#34;&gt;å°çµ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç°¡å–®æ€è€ƒ self-host ELK stack æ­å»ºçš„æ¶æ§‹&lt;/li&gt;
&lt;li&gt;åœ¨å–®ä¸€ node ä¸Šå®‰è£æœ€ç°¡æ˜“çš„ elastic stack&lt;/li&gt;
&lt;li&gt;è¨­å®šå…ƒä»¶çš„ output ä½ç½®&lt;/li&gt;
&lt;li&gt;è¨­å®š self-monitoring&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­å–œå„ä½ç²å¾—ä¸€å€‹è£¸å¥”ä½†æ˜¯åŠŸèƒ½å®Œæ•´çš„ ELK, æˆ‘å€‘ä¸‹ç¯‡å†å‘å®‰å…¨æ€§é‚é€²ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>2019 ITé‚¦å¹«å¿™éµäººè³½</title>
      <link>https://chechia.net/zh-hant/post/2019-09-09-ithome-ironman-challenge/</link>
      <pubDate>Mon, 09 Sep 2019 16:56:03 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-09-09-ithome-ironman-challenge/</guid>
      <description>&lt;p&gt;å„ä½å¥½ï¼Œæˆ‘æ˜¯Che-Chia Changï¼Œç¤¾ç¾¤ä¸Šå¸¸ç”¨çš„åå­æ˜¯ David Changã€‚æ˜¯å€‹è»Ÿé«”å·¥ç¨‹å¸«ï¼Œå°ˆé•·çš„é ˜åŸŸæ˜¯å¾Œç«¯é–‹ç™¼ï¼Œé–‹ç™¼ç¶­é‹ï¼Œå®¹å™¨åŒ–æ‡‰ç”¨ï¼Œä»¥åŠKubernetesé–‹ç™¼ç®¡ç†ã€‚ç›®å‰ç‚º &lt;a href=&#34;https://www.meetup.com/golang-taipei-meetup/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Golang Taiwan Meetup&lt;/a&gt; çš„ organizerã€‚&lt;/p&gt;
&lt;p&gt;å—åˆ°&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman/signup/team/63&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‹äººå€‘&lt;/a&gt;é‚€è«‹ï¼ˆæ¨å‘ï¼‰åƒåŠ äº†&lt;a href=&#34;https://ithelp.ithome.com.tw/2020ironman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2020 Ité‚¦å¹«å¿™éµäººè³½&lt;/a&gt;ï¼ŒæŒ‘æˆ°åœ¨30å¤©å…§ï¼Œæ¯å¤©ç™¼ä¸€ç¯‡æŠ€è¡“åˆ†äº«æ–‡ç« ã€‚ä¸€æ–¹é¢å°‡å·¥ä½œä¸Šé‡åˆ°çš„å•é¡Œèˆ‡è§£æ³•åˆ†äº«çµ¦ç¤¾ç¾¤ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯çµ¦è‡ªå·±ä¸€é»æˆé•·çš„å£“åŠ›ï¼ŒæŠŠé€™æ®µæ™‚é–“çš„å¿ƒå¾—æ²ˆæ¾±ä¸‹ä¾†ï¼Œå› æ­¤ä¹Ÿäº†é€™ç³»åˆ—æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« é‡é»æœ‰ä¸‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æä¾›çš„è§£æ±ºæ–¹æ¡ˆï¼Œé™„ä¸Šä¸€æ­¥æ­¥çš„æ“ä½œæ­¥é©Ÿã€‚å¸Œæœ›è®“è®€è€…å¯ä»¥é‡ç¾å®Œæ•´æ“ä½œæ­¥é©Ÿï¼Œç›´æ¥ä½¿ç”¨ï¼Œæˆ–æ˜¯åŠ ä»¥ä¿®æ”¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‘—é‡ Google Cloud Platformï¼Œç‰¹åˆ¥æ˜¯Google Compute Engine (GCE) èˆ‡Google Kubernetes Engine (GKE) å…©å¤§æœå‹™ã€‚é€™ä¹Ÿæ˜¯æˆ‘æœ€ç†Ÿæ‚‰çš„å¹³å°ï¼Œé †ä¾¿æ¨å»£ï¼Œä¸¦åˆ†äº«ä¸€äº›é›·é»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¾ç¶­é‹çš„è§’åº¦é™¤éŒ¯ï¼Œåˆ†æå•é¡Œï¼Œæå‡ç©©å®šæ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é å®šçš„ä¸»é¡Œå¦‚ä¸‹ï¼ˆå¯èƒ½æœƒä¾ç…§å¯¦éš›æ’°å¯«ç‹€æ³å¾®èª¿ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK Stask on GCP (8)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-self-host-elk-stack-on-gcp/&#34;&gt;Self-host ELK stack on GCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-15-secure-elk-stack/&#34;&gt;Secure ELK Stask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-monitoring-gce-with-elk/&#34;&gt;ç›£æ¸¬ Google Compute Engine ä¸Šæœå‹™çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-19-monitoring-gke-with-elk/&#34;&gt;ç›£æ¸¬ Google Kubernetes Engine çš„å„é …æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-18-elastic-or-not-elastic/&#34;&gt;æ˜¯å¦é¸æ“‡ ELK ä½œç‚ºè§£æ±ºæ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-21-logstash-on-gke/&#34;&gt;ä½¿ç”¨ logstash pipeline åšæ•¸æ“šå‰è™•ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elasticsearch æ—¥å¸¸ç¶­è­·ï¼šæ•¸æ“šæ¸…ç†ï¼Œæ•ˆèƒ½èª¿æ ¡ï¼Œæ°¸ä¹…å„²å­˜&lt;/li&gt;
&lt;li&gt;Debug ELK stack on GCP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kafka HA on Kubernetes(6)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-22-kafka-deployment-on-kubernetes/&#34;&gt;Deploy kafka-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-23-kafka-introduction/&#34;&gt;Kafka Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-24-kafka-basic-usage/&#34;&gt;kafka åŸºæœ¬ä½¿ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-operation-scripts/&#34;&gt;kafka operation scripts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-25-kafka-ha-topology/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-26-kafka-ha-continued/&#34;&gt;é›†ç¾¤å…§éƒ¨çš„ HA ç´°ç¯€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½èª¿æ ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨ GKE ä¸Šéƒ¨ç½² Redis HA (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-28-redis-ha-deployment/&#34;&gt;ä½¿ç”¨ helm éƒ¨ç½² redis-ha&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-29-redis-ha-sentinel/&#34;&gt;Redis HA with sentinel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-09-30-redis-ha-topology/&#34;&gt;Redis sentinel topology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-02-redis-ha-on-haproxy/&#34;&gt;Redis HA with HAproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-03-redis-ha-failure-recovery/&#34;&gt;Redis HA Failure Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prometheus Metrics Exporter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Prometheus / Grafana (5)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deployment-on-kubernetes/&#34;&gt;GKE ä¸Šè‡ªæ¶ Prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-deploy-grafana/&#34;&gt;GKE ä¸Šè‡ªæ¶ Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-04-prometheus-scrape/&#34;&gt;scrape config &amp;amp; exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-06-prometheus-exporter-library-redis-exporter/&#34;&gt;Dive into Redis Exporter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-07-prometheus-kube-state-metrics-exporter/&#34;&gt;è¼¸å‡º kube-state çš„ç›£æ¸¬æ•¸æ“š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Nginx Ingress (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-controller/&#34;&gt;Deploy Nginx Ingress Controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-08-kubernetes-nginx-ingress-config/&#34;&gt;Configure Nginx Ingress&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cert-manager (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-10-cert-manager-deployment/&#34;&gt;Deploy cert-manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-11-cert-manager-how-it-work/&#34;&gt;How cert-manager work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-12-cert-manager-complete-workflow/&#34;&gt;Cert-manager complete workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Kubernetes CRD &amp;amp; Operator-sdk (3)
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Introduction about custom resource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-13-kubernetes-custom-resources-basic/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net/zh-hant/post/2019-10-15-kubernetes-custom-resource-with-operator-sdk/&#34;&gt;Deployment &amp;amp; Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ–‡ç« ç™¼è¡¨æ–¼&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/2444&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éµäººæŒ‘æˆ°é é¢&lt;/a&gt;ï¼ŒåŒæ™‚ç™¼å¸ƒèˆ‡æœ¬ç«™å‚™ä»½ã€‚æœ‰ä»»ä½•è¬¬èª¤ï¼Œé‚„ç…©è«‹å„æ–¹å¤§å¾·&amp;lt;3é€éåº•ä¸‹çš„è¯çµ¡æ–¹å¼è¯çµ¡æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Features&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;step-by-step guide for deployment: guarentee a running deployment on GCP&lt;/li&gt;
&lt;li&gt;basic configuration, usage, monitoring, networking on GKE&lt;/li&gt;
&lt;li&gt;debugging, stability analysis in an aspect of devop&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Topics&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK stack(8)
&lt;ul&gt;
&lt;li&gt;Deploy self-hosted ELK stack on GCE instance&lt;/li&gt;
&lt;li&gt;Secure ELK stack with SSL and role-based authentication&lt;/li&gt;
&lt;li&gt;Monitoring services on Kubernetes with ELK beats&lt;/li&gt;
&lt;li&gt;Monitoring services on GCE instances&lt;/li&gt;
&lt;li&gt;Logstash pipelines and debugging walk through&lt;/li&gt;
&lt;li&gt;Elasticsearch operations: house-cleaning, tuning, pernament storage&lt;/li&gt;
&lt;li&gt;Elasticsearch maitainence, trouble shooting&lt;/li&gt;
&lt;li&gt;Get-Started with Elastic Cloud SASS&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;General operations on Kubernetes(4)
&lt;ul&gt;
&lt;li&gt;Kubernetes Debug SOP&lt;/li&gt;
&lt;li&gt;Kubectl cheat sheet&lt;/li&gt;
&lt;li&gt;Secure services with SSL by cert-manager&lt;/li&gt;
&lt;li&gt;Speed up container updating with operator
&lt;ul&gt;
&lt;li&gt;My operator example&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Deploy Kafka HA on Kubernetes(4)
&lt;ul&gt;
&lt;li&gt;deploy kafka-ha on Kubernertes with helm&lt;/li&gt;
&lt;li&gt;in-cluster networking configuration for high availability&lt;/li&gt;
&lt;li&gt;basic app-side usage, performance tuning&lt;/li&gt;
&lt;li&gt;Operate Kafka: update config, upgrade version, migrate data&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Promethus / grafana(5)
&lt;ul&gt;
&lt;li&gt;Deploy Prometheus / Grafana stack on GCE instance&lt;/li&gt;
&lt;li&gt;Monitoring services on Kubernetes with exporters&lt;/li&gt;
&lt;li&gt;Export Kubernetes metrics to Prometheus&lt;/li&gt;
&lt;li&gt;Export Redis-ha metrics to Prometheus&lt;/li&gt;
&lt;li&gt;Export Kafka metrics to Prometheus&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GCP networking(4)
&lt;ul&gt;
&lt;li&gt;Firewall basic concept for private network with GCE instances &amp;amp; Kubernetes&lt;/li&gt;
&lt;li&gt;Load balancer for Kubernetes service &amp;amp; ingress&lt;/li&gt;
&lt;li&gt;DNS on GCP from Kube-dns to GCP DNS service&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GCP log management(3)
&lt;ul&gt;
&lt;li&gt;Basic usage about GCP logging &amp;amp; GCP Error Report&lt;/li&gt;
&lt;li&gt;Stackdriver, metrics, alerts&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Logging on GKE from gcp-fluentd to stackdriver&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2020 ITé‚¦å¹«å¿™éµäººè³½</title>
      <link>https://chechia.net/zh-hant/post/2020-09-09-ithome-ironman-challenge/</link>
      <pubDate>Mon, 09 Sep 2019 16:56:03 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2020-09-09-ithome-ironman-challenge/</guid>
      <description>&lt;p&gt;å„ä½å¥½ï¼Œæˆ‘æ˜¯Che-Chia Changï¼Œå°ˆé•· DevOps &amp;amp; Kubernetes&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://chechia.net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šå¹´ä¸ä¿è­‰ä¸çˆ›å°¾çš„ 2021 éµäººæŒ‘æˆ°é é¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€æ‰‹æ¶ˆæ¯ç™¼å¸ƒï¼Œå…è²»ç·šä¸Šè«®è©¢ï¼Œè«‹è¦‹ FB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20120327/ironman/2444&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾€å¹´å›é¡§ 4 è¬é¤˜å­—çš„è¡€æ·š 30 æ—¥ - 2020 éµäººæŒ‘æˆ° å„ªç­‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å›åˆ° 2021 å¹´ï¼Œæœ¬ç³»åˆ—æœƒå¯«å¾—å¾ˆéš¨èˆˆï¼Œè®€è€…æœ‰å¹«åŠ©ç‚ºç›®çš„æ’°å¯«ï¼Œ&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰èˆˆè¶£çš„é¡Œç›®ï¼Œæˆ–æ˜¯å¥½å¥‡æƒ³å•å•é¡Œï¼Œæ­¡è¿åº•ä¸‹ç•™è¨€ï¼Œæˆ–åˆ°&lt;a href=&#34;https://www.facebook.com/engineer.from.scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ FB ç§è¨Š&lt;/a&gt;ï¼Œæˆ‘éƒ½æœƒä¸€å°ä¸€å›å¾©ã€‚åŸºæ–¼ã€Œå–ä¹‹ç¤¾ç¾¤å›é¥‹ç¤¾ç¾¤ã€çš„ç²¾ç¥ï¼Œè«®è©¢èŠå¤©éƒ½æ˜¯æ°¸é å…è²»ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŸºæ–¼æ˜ç¢ºéœ€æ±‚ï¼Œè¨è«–è§£æ±ºæ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;è·Ÿ Kubernetes æœ‰é—œ&lt;/li&gt;
&lt;li&gt;æä¾›æ‰‹æŠŠæ‰‹ SOP&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å–œæ­¡ä¹Ÿè«‹å¹«æˆ‘é»å€‹è®šï¼Œæˆ–æ˜¯ç•™è¨€è®“æˆ‘çŸ¥é“ï¼Œè®“æˆ‘æœ‰é»å‹•åŠ›ç¹¼çºŒå¯«ï¼Œå¤§å¹…é™ä½æˆ‘å·æ‡¶çˆ›å°¾çš„æ©Ÿç‡(XD)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é å®šçš„ä¸»é¡Œï¼ˆå¯èƒ½æœƒå¾®èª¿æˆ–å¤§æ”¹XDï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¥½æ–‡ç¿»è­¯åˆ†äº« Borg, Omega, Kubernetes - Google å®¹å™¨åŒ–é–‹ç™¼åå¹´ç¶“é©—ï¼ŒKubernetes çš„å‰æ—¥ä»Šç”Ÿ&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²çœéŒ¢å¤§ä½œæˆ° - æˆ‘é€™é‚Šæœ‰ä¸€æ‰¹ä¾¿å®œçš„å¥½ VM æ‰“ä¸‰æŠ˜è³£ä½ ï¼ŒPreemptible / Spot Instance å…ˆå ç¯€é»å¯¦æˆ°åˆ†äº«
&lt;ul&gt;
&lt;li&gt;å…¬æœ‰é›²çœéŒ¢å¤§ä½œæˆ° - Preemptible / Spot Instance å…ˆå ç¯€é»ï¼ŒåŸç†ç°¡ä»‹èˆ‡è¦æ ¼&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²çœéŒ¢å¤§ä½œæˆ° - Preemptible / Spot Instance å…ˆå ç¯€é»ï¼Œé©ç”¨æ¡ˆä¾‹å¯¦æˆ°åˆ†æ&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²çœéŒ¢å¤§ä½œæˆ° - Preemptible / Spot Instance å…ˆå ç¯€é»ï¼Œä½¿ç”¨ç¯„ä¾‹&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²çœéŒ¢å¤§ä½œæˆ° - Preemptible / Spot Instance å…ˆå ç¯€é»ï¼Œç¶“é©—åˆ†äº«ï¼Œé›·é»&lt;/li&gt;
&lt;li&gt;å…¬æœ‰é›²çœéŒ¢å¤§ä½œæˆ° - æˆ‘è·‘äº†ä¸€å€‹ botï¼Œ24 å°æ™‚ä¸Šç·šï¼Œ GCP ä¸€å¤©æ”¶ä½  4 å…ƒå°å¹£&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤§å®¶éƒ½ä¾†ç”¨ Terraformï¼ŒInfrastructure as Code æ¼”è¬›å…¨æ–‡åˆ†äº«
&lt;ul&gt;
&lt;li&gt;iThome Cloud Summit è¬›åˆ°æ™‚é–“è¶…éï¼Œä¸€å°æ±è¥¿æ²’è¬›ï¼Œæ‰€ä»¥ä¾†é€™é‚Šç™¼æ–‡&lt;/li&gt;
&lt;li&gt;çœŸçš„å¥½ç”¨ï¼Œå¯¦æˆ°ç¶“é©—åˆ†äº«&lt;/li&gt;
&lt;li&gt;è§£ç­”ç²‰å°ˆç§è¨Šå•é¡Œèˆ‡è§€çœ¾ç™¼å•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ†æ•£å¼å·¥å…·å¯¦é©—å®¤ - Scalable Database on Kubernetes
&lt;ul&gt;
&lt;li&gt;Thanos - Scalable HA Prometheus
&lt;ul&gt;
&lt;li&gt;ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;éœ€æ±‚åˆ†æï¼ŒUnlimited Retention éµä¸€èˆ¬çš„éœ€æ±‚&lt;/li&gt;
&lt;li&gt;ä¸€æ­¥æ­¥å¸¶ä½ æ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Scalable DB å¯¦é©—- Cockroach DB - è€ç”¨æ‰“ä¸æ­»åˆé«˜æ•ˆèƒ½çš„å°å¼·è³‡æ–™åº«
&lt;ul&gt;
&lt;li&gt;å‰è¨€ï¼Œåˆ†æ•£å¼ç³»çµ±ä¸‹çš„å›°å¢ƒï¼Œè³‡æ–™åº«ç“¶é ¸&lt;/li&gt;
&lt;li&gt;Cockroach DB åŸºæœ¬åŸç†ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;Cockroach DB Free Trial ç©èµ·ä¾†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cassandra - æ”¯æ’ç™¾è¬ç´šå¯«å…¥çš„åˆ†æ•£å¼è³‡æ–™åº«
&lt;ul&gt;
&lt;li&gt;Cassandra ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;Cassandra ç´°éƒ¨åŸç†ï¼Œåˆ†æ•£å¼çš„è³‡æ–™åº«è¨­è¨ˆè¶…å¥½ç©&lt;/li&gt;
&lt;li&gt;Cassandra ç´°éƒ¨åŸç†ï¼ŒConsistency Hashing&lt;/li&gt;
&lt;li&gt;Cassandra ç´°éƒ¨åŸç†ï¼ŒData modeling&lt;/li&gt;
&lt;li&gt;Netflix case study - å·å­¸ Netflix èƒ½å­¸åˆ°å¹¾æˆåŠŸåŠ›å‘¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰ä»»ä½•è¬¬èª¤ï¼Œé‚„ç…©è«‹å„æ–¹å¤§å¾·&amp;lt;3è¯çµ¡æˆ‘ï¼Œæ„Ÿæ¿€ä¸ç›¡ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Journey to Quantum Computing</title>
      <link>https://chechia.net/zh-hant/post/2019-06-02-journey-to-quantum-computing/</link>
      <pubDate>Sun, 02 Jun 2019 10:21:37 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-06-02-journey-to-quantum-computing/</guid>
      <description>&lt;p&gt;This post is about my learning steps for quantum-computing.&lt;/p&gt;
&lt;p&gt;For a quick-start tutorial, check my workshop project throught the project link above.&lt;/p&gt;
&lt;h1 id=&#34;resources&#34;&gt;Resources&lt;/h1&gt;
&lt;p&gt;Courses&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.coursera.org/learn/quantum-computing-algorithms&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Coursera&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mitxpro.mit.edu/courses/course-v1:MITxPRO&amp;#43;QCx0&amp;#43;1T2019/about&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;on MIT x pro&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://pages.cs.wisc.edu/~dieter/Courses/2010f-CS880/lectures.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quantum Information Processing from UW Madison&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.theory.caltech.edu/people/preskill/ph229/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quantum Computation by John Preskill&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://quantum-computing.ibm.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IBM Q Experience&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Qiskit/openqasm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/Qiskit/openqasm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Qiskit/qiskit-tutorials&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/Qiskit/qiskit-tutorials&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;ibm-q-experience&#34;&gt;IBM Q Experience&lt;/h1&gt;
&lt;h3 id=&#34;day-1&#34;&gt;Day 1&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://quantum-computing.ibm.com/support/guides/getting-started-with-circuit-composer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Getting Started with Circuit Composer&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hello Quantum World circuit transformed two qubits, from $ \vert0\rangle $ to $ \frac{\vert00\rangle + \vert11\rangle}{\sqrt{2}} $&lt;/p&gt;
&lt;p&gt;Questions&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;[] Hadamard Gate&lt;/li&gt;
&lt;li&gt;[] Bell states
&lt;ul&gt;
&lt;li&gt;[] Annotations&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio ä¸‰åˆ†é˜å°±å…¥å‘ ä½ˆç½²ç¯‡</title>
      <link>https://chechia.net/zh-hant/post/2019-05-06-service-mesh-for-microservice-on-kubernetes/</link>
      <pubDate>Mon, 06 May 2019 18:12:15 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-05-06-service-mesh-for-microservice-on-kubernetes/</guid>
      <description>&lt;h1 id=&#34;create-gke&#34;&gt;Create GKE&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud beta container --project &amp;#34;istio-playground-239810&amp;#34; clusters create &amp;#34;istio-playground&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --zone &amp;#34;asia-east1-b&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --username &amp;#34;admin&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --cluster-version &amp;#34;1.11.8-gke.6&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --machine-type &amp;#34;n1-standard-2&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --image-type &amp;#34;COS&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --disk-type &amp;#34;pd-standard&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --disk-size &amp;#34;100&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --preemptible \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --num-nodes &amp;#34;1&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --enable-cloud-logging \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --enable-cloud-monitoring \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --no-enable-ip-alias \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --addons HorizontalPodAutoscaling,HttpLoadBalancing,KubernetesDashboard,Istio \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --istio-config auth=MTLS_PERMISSIVE \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --no-enable-autoupgrade \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --enable-autorepair
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;take-a-peek&#34;&gt;Take a Peek&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get namespaces
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME           STATUS    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default        Active    2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-system   Active    1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-public    Active    2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-system    Active    2m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                      READY     STATUS      RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-citadel-7f6f77cd7b-nxfbf            1/1       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-cleanup-secrets-h454m               0/1       Completed   0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-egressgateway-7c56db84cc-nlrwq      1/1       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-galley-6c747bdb4f-45jrp             1/1       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway-6ff68cf95d-tlkq4     1/1       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-pilot-8ff66f8c4-q9chz               2/2       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-policy-69b78b7d6-c8pld              2/2       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-sidecar-injector-558996c897-hr6q4   1/1       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-telemetry-f96459fb-5cbpg            2/2       Running     0          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;promsd-ff878d44b-hv8nh                    2/2       Running     1          3m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;deploy-app&#34;&gt;Deploy app&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio-injection=enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Bookinfo Application&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.1/samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get services
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Gateway&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.1/samples/bookinfo/networking/bookinfo-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get gateways
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get svc istio-ingressgateway -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Go to ingress public ip&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INGRESS_HOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubectl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ingressgateway&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INGRESS_PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubectl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ingressgateway&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.spec.ports[?(@.name==&amp;#34;http2&amp;#34;)].port}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SECURE_INGRESS_PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubectl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ingressgateway&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.spec.ports[?(@.name==&amp;#34;https&amp;#34;)].port}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;curl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;INGRESS_HOST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}:{&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;INGRESS_PORT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;productpage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mi&#34;&gt;404&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Not&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Found&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apply destination rules&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.1/samples/bookinfo/networking/destination-rule-all.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -v ${INGRESS_HOST}:{$INGRESS_PORT}/productpage
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;brief-review&#34;&gt;Brief review&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get virtualservices
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get destinationrules
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get gateways
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;istio-tasks&#34;&gt;Istio Tasks&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/tasks/traffic-management/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Jenkins X on Kubernetes</title>
      <link>https://chechia.net/zh-hant/post/2019-04-19-jenkins-x-on-kubernetes/</link>
      <pubDate>Fri, 19 Apr 2019 12:15:41 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2019-04-19-jenkins-x-on-kubernetes/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://jenkins.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jenkins&lt;/a&gt; is one of the earliest open source antomation server and remains the most common option in use today. Over the years, Jenkins has evolved into a powerful and flexible framework with hundreds of plugins to support automation for any project.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://jenkins-x.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jenkins X&lt;/a&gt;, on the other hand, is a CI/CD platform (Jenkins Platform) for modern cloud applications on Kubernetes.&lt;/p&gt;
&lt;p&gt;Here we talk about some basic concepts about Jenkins X and provide a hand-to-hand guide to deploy jenkins-x on Kubernetes.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#architecture&#34;&gt;Architecture of Jenkins X&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#install&#34;&gt;Install Jenkins with jx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#pipeline&#34;&gt;Create a Pipeline with jx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#client&#34;&gt;Develope with jx client&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For more information about jx itself, check &lt;a href=&#34;https://github.com/jenkins-x/jx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jenkins-X Github Repo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;architecture&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;architecture&#34;&gt;Architecture&lt;/h1&gt;
&lt;p&gt;Check this beautiful diagram.&lt;/p&gt;


















&lt;figure  id=&#34;figure-httpsjenkins-xioarchitecturediagram&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;jenkins/architecture-serverless.png&#34; alt=&#34;https://jenkins-x.io/architecture/diagram/&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &lt;a href=&#34;https://jenkins-x.io/architecture/diagram/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://jenkins-x.io/architecture/diagram/&lt;/a&gt;
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;p&gt;&lt;a name=&#34;install&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;install&#34;&gt;Install&lt;/h1&gt;
&lt;h3 id=&#34;create-gke-cluster--get-credentials&#34;&gt;Create GKE cluster &amp;amp; Get Credentials&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud components update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CLUSTER_NAME=jenkins-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#CLUSTER_NAME=jenkins-serverless
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud container clusters create ${CLUSTER_NAME} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --num-nodes 1 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --machine-type n1-standard-4 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --enable-autoscaling \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --min-nodes 1 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --max-nodes 2 \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --zone asia-east1-b \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --preemptible
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# After cluster initialization, get credentials to access cluster with kubectl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud container clusters get-credentials ${CLUSTER_NAME}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Check cluster stats.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get nodes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;install-jx-on-local-machine&#34;&gt;Install jx on Local Machine&lt;/h3&gt;
&lt;p&gt;[Jenkins X Release](&lt;a href=&#34;https://github.com/jenkins-x/jx/releases]%28https://github.com/jenkins-x/jx/releases%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/jenkins-x/jx/releases](https://github.com/jenkins-x/jx/releases)&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;JX_VERSION=v2.0.2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OS_ARCH=darwin-amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#OS_ARCH=linux-amd64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -L https://github.com/jenkins-x/jx/releases/download/&amp;#34;${JX_VERSION}&amp;#34;/jx-&amp;#34;${OS_ARCH}&amp;#34;.tar.gz | tar xzv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mv jx /usr/local/bin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME               VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx                 2.0.2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Kubernetes cluster v1.11.7-gke.12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl            v1.11.9-dispatcher
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm client        v2.11.0+g2e55dbe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm server        v2.11.0+g2e55dbe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git                git version 2.20.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Operating System   Mac OS X 10.14.4 build 18E226
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;option-1-install-serverless-jenkins-pipeline&#34;&gt;(Option 1) Install Serverless Jenkins Pipeline&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DEFAULT_PASSWORD=mySecretPassWord123
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx install \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --default-admin-password=${DEFAULT_PASSWORD} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --provider=&amp;#39;gke&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enter Github user name&lt;/li&gt;
&lt;li&gt;Enter Github personal api token for CI/CD&lt;/li&gt;
&lt;li&gt;Enable Github as Git pipeline server&lt;/li&gt;
&lt;li&gt;Select Jenkins installation type:
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Serverless Jenkins X Pipelines with Tekon&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Static Master Jenkins&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pick default workload build pack
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Kubernetes Workloads: Automated CI+CD with GitOps Promotion&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Library Workloads: CI+Release but no CD&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Select the organization where you want to create the environment repository:
&lt;ul&gt;
&lt;li&gt;chechiachang&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Your Kubernetes context is now set to the namespace: jx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0231] To switch back to your original namespace use: jx namespace jx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0231] Or to use this context/namespace in just one terminal use: jx shell
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0231] For help on switching contexts see: https://jenkins-x.io/developing/kube-context/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0231] To import existing projects into Jenkins:       jx import
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0231] To create a new Spring Boot microservice:       jx create spring -d web -d actuator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0231] To create a new microservice from a quickstart: jx create quickstart
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;option-2-install-static-jenkins-server&#34;&gt;(Option 2) Install Static Jenkins Server&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DEFAULT_PASSWORD=mySecretPassWord123
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx install \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --default-admin-password=${DEFAULT_PASSWORD} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --provider=&amp;#39;gke&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enter Github user name&lt;/li&gt;
&lt;li&gt;Enter Github personal api token for CI/CD&lt;/li&gt;
&lt;li&gt;Enable Github as Git pipeline server&lt;/li&gt;
&lt;li&gt;Select Jenkins installation type:
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Serverless Jenkins X Pipelines with Tekon&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Static Master Jenkins&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pick default workload build pack
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Kubernetes Workloads: Automated CI+CD with GitOps Promotion&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; Library Workloads: CI+Release but no CD&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Select the organization where you want to create the environment repository:
&lt;ul&gt;
&lt;li&gt;chechiachang&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465]Your Kubernetes context is now set to the namespace: jx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465] To switch back to your original namespace use: jx namespace default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465] Or to use this context/namespace in just one terminal use: jx shell
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465] For help on switching contexts see: https://jenkins-x.io/developing/kube-context/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465] To import existing projects into Jenkins:       jx import
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465] To create a new Spring Boot microservice:       jx create spring -d web -d actuator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0465] To create a new microservice from a quickstart: jx create quickstart
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Access Static Jenkins Server through Domain with username and password
Domain &lt;a href=&#34;http://jenkins.jx.11.22.33.44.nip.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://jenkins.jx.11.22.33.44.nip.io/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;uninstall&#34;&gt;Uninstall&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx uninstall
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# rm -rf ~/.jx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;&lt;a name=&#34;pipeline&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;setup-cicd-pipeline&#34;&gt;Setup CI/CD Pipeline&lt;/h1&gt;
&lt;h3 id=&#34;create-quickstart-repository&#34;&gt;Create Quickstart Repository&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --namespace jx --watch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# cd workspace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx create quickstart
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Which organisation do you want to use? chechiachang&lt;/li&gt;
&lt;li&gt;Enter the new repository name:  serverless-jenkins-quickstart&lt;/li&gt;
&lt;li&gt;select the quickstart you wish to create  [Use arrows to move, type to filter]
angular-io-quickstart
aspnet-app
dlang-http&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;golang-http
jenkins-cwp-quickstart
jenkins-quickstart
node-http&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] Watch pipeline activity via:    jx get activity -f serverless-jenkins-quickstart -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] Browse the pipeline log via:    jx get build logs chechiachang/serverless-jenkins-quickstart/master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] Open the Jenkins console via    jx console
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] You can list the pipelines via: jx get pipelines
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] Open the Jenkins console via    jx console
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] You can list the pipelines via: jx get pipelines
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0121] When the pipeline is complete:  jx get applications
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;check-log-of-the-first-run&#34;&gt;Check log of the first run&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx logs pipeline
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;add-step-to-pipeline&#34;&gt;Add Step to Pipeline&lt;/h3&gt;
&lt;p&gt;Add a setup step for pullrequest&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cd serverless-jenkins-quickstart
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx create step --pipeline pullrequest \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --lifecycle setup \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --mode replace \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --sh &amp;#34;echo hello world&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Validate pipeline step for each modification&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx step validate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A build-pack pod started after git push. Watch pod status with kubectl.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --namespace jx --watch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;check-build-status-on-prow-serverless&#34;&gt;Check Build Status on Prow (Serverless)&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;http://deck.jx.130.211.245.13.nip.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://deck.jx.130.211.245.13.nip.io/&lt;/a&gt;
Login with username and password&lt;/p&gt;
&lt;h3 id=&#34;import-existing-repository&#34;&gt;Import Existing Repository&lt;/h3&gt;
&lt;p&gt;In source code repository:&lt;/p&gt;
&lt;p&gt;Import jx to remote jenkins-server. This will apply a Jenkinsfile to repository by default&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx import --url git@github.com:chechiachang/serverless-jenkins-quickstart.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Update jenkins-x.yml&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx create step
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;git commit &amp;amp; push&lt;/p&gt;
&lt;h3 id=&#34;trouble-shooting&#34;&gt;Trouble Shooting&lt;/h3&gt;
&lt;p&gt;Failed to get jx resources&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get pipelines
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Make sure your jx (or kubectl) context is with the correct GKE and namespace&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kc config set-context gke_my-project_asia-east1-b_jenkins \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --namespace=jx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;why-not-use-helm-chart&#34;&gt;Why not use helm chart?&lt;/h3&gt;
&lt;p&gt;It&amp;rsquo;s readlly depend on what we need in CI/CD automation.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/helm/charts/tree/master/stable/jenkins&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jenkins Helm Chart&lt;/a&gt; create Jenkins master and slave cluster on Kubernetes utilizing the Jenkins Kubernetes plugin.
Jenkin Platform with jx is Jenkins Platform native to Kubernetes. It comes with powerful cloud native components like Prow automation, Nexus, Docker Registry, Tekton Pipeline, &amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;check-jenkins-x-examples&#34;&gt;Check jenkins-x examples&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/jenkins-x-buildpacks/jenkins-x-kubernetes/tree/master/packs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/jenkins-x-buildpacks/jenkins-x-kubernetes/tree/master/packs&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a name=&#34;client&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;client&#34;&gt;Client&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get urls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name                      URL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jenkins                   http://jenkins.jx.11.22.33.44.nip.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jenkins-x-chartmuseum     http://chartmuseum.jx.11.22.33.44.nip.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jenkins-x-docker-registry http://docker-registry.jx.11.22.33.44.nip.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jenkins-x-monocular-api   http://monocular.jx.11.22.33.44.nip.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jenkins-x-monocular-ui    http://monocular.jx.11.22.33.44.nip.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nexus                     http://nexus.jx.11.22.33.44.nip.io
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;get-cluster-status&#34;&gt;Get Cluster Status&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx diagnose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;get-applications--pipelines&#34;&gt;Get Applications &amp;amp; Pipelines&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get applications
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get pipelines
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;get-ci-activities--build-log&#34;&gt;Get CI Activities &amp;amp; build log&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get activities
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get activities --filter=&amp;#39;jenkins-x-on-kubernetes&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get build log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0003] view the log at: http://jenkins.jx.11.22.33.44.nip.io/job/chechiachang/job/jenkins-x-on-kubernetes/job/feature-add-test/3/console
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;trigger-build--check-activity&#34;&gt;Trigger Build &amp;amp; Check Activity&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx start pipeline
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx start pipeline --filter=&amp;#39;jenkins-x-on-kubernetes/feature-add-test&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx get activities --filter=&amp;#39;jenkins-x-on-kubernetes&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;create-pull-request&#34;&gt;Create Pull Request&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jx create pullrequest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Kubernetes Container Runtime Interface</title>
      <link>https://chechia.net/zh-hant/post/2018-10-06-kubernetes-container-runtime-interface/</link>
      <pubDate>Sat, 06 Oct 2018 12:07:00 +0800</pubDate>
      <guid>https://chechia.net/zh-hant/post/2018-10-06-kubernetes-container-runtime-interface/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Terraform 30 days Workshop - IaC for Public Cloud ç–«æƒ…è­¦æˆ’é™ªä½ åº¦é 30 å¤©</title>
      <link>https://chechia.net/zh-hant/project/terraform-30-days/</link>
      <pubDate>Wed, 27 Apr 2016 00:00:00 +0000</pubDate>
      <guid>https://chechia.net/zh-hant/project/terraform-30-days/</guid>
      <description></description>
    </item>
    
  </channel>
</rss>
