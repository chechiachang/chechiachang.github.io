<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>從零開始的 Infrastructure as Code: Terraform - 01 | Che-Chia Chang</title><meta name=keywords content="kubernetes,terraform,devops,iac"><meta name=description content="This article is part of 從零開始的 Infrastructu as Code: Terraform

Get-started examples / SOP on Github
Introducation to Terraform Iac: Speaker transcript
Presentation

Check my website chechia.net for other blog. Follow my page to get notification. Like my page if you really like it :)

Outlline

our story: issues, steps, & results
basics IaC, terraform
benefits
risks and 坑
to be or not to be

experience oriented
Our stories

100+ devs, many teams
25+ projects
50+ GKEs
80+ SQLs
IAMs, redis, VPCs, load-balancers, &mldr;

Issues

Ops manually create resources through GUI by SOP.
We have many isolated, separeated resources, VPCs. It&rsquo;s our culture, and we (devops) want to change.
Some projects have short life-cycle. Rapid resources created & destroy.

Our user story
As a devops,
I would like to introduce terraform (IaC)
so that I can"><meta name=author content="chechiachang"><link rel=canonical href=https://chechia.net/posts/2020-06-14-terraform-infrastructure-as-code/><meta name=google-site-verification content="G-QYR8JCDGM9"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://chechia.net/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://chechia.net/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://chechia.net/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://chechia.net/favicon/favicon-32x32.png><link rel=mask-icon href=https://chechia.net/favicon/favicon-32x32.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://chechia.net/posts/2020-06-14-terraform-infrastructure-as-code/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://chechia.net/posts/2020-06-14-terraform-infrastructure-as-code/"><meta property="og:site_name" content="Che-Chia Chang"><meta property="og:title" content="從零開始的 Infrastructure as Code: Terraform - 01"><meta property="og:description" content="This article is part of 從零開始的 Infrastructu as Code: Terraform
Get-started examples / SOP on Github Introducation to Terraform Iac: Speaker transcript Presentation Check my website chechia.net for other blog. Follow my page to get notification. Like my page if you really like it :)
Outlline our story: issues, steps, & results basics IaC, terraform benefits risks and 坑 to be or not to be experience oriented
Our stories 100+ devs, many teams 25+ projects 50+ GKEs 80+ SQLs IAMs, redis, VPCs, load-balancers, … Issues Ops manually create resources through GUI by SOP. We have many isolated, separeated resources, VPCs. It’s our culture, and we (devops) want to change. Some projects have short life-cycle. Rapid resources created & destroy. Our user story As a devops, I would like to introduce terraform (IaC) so that I can"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-14T16:46:09+08:00"><meta property="article:modified_time" content="2020-06-14T16:46:09+08:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="Devops"><meta property="article:tag" content="Iac"><meta property="og:image" content="https://chechia.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://chechia.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="從零開始的 Infrastructure as Code: Terraform - 01"><meta name=twitter:description content="This article is part of 從零開始的 Infrastructu as Code: Terraform

Get-started examples / SOP on Github
Introducation to Terraform Iac: Speaker transcript
Presentation

Check my website chechia.net for other blog. Follow my page to get notification. Like my page if you really like it :)

Outlline

our story: issues, steps, & results
basics IaC, terraform
benefits
risks and 坑
to be or not to be

experience oriented
Our stories

100+ devs, many teams
25+ projects
50+ GKEs
80+ SQLs
IAMs, redis, VPCs, load-balancers, &mldr;

Issues

Ops manually create resources through GUI by SOP.
We have many isolated, separeated resources, VPCs. It&rsquo;s our culture, and we (devops) want to change.
Some projects have short life-cycle. Rapid resources created & destroy.

Our user story
As a devops,
I would like to introduce terraform (IaC)
so that I can"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://chechia.net/posts/"},{"@type":"ListItem","position":2,"name":"從零開始的 Infrastructure as Code: Terraform - 01","item":"https://chechia.net/posts/2020-06-14-terraform-infrastructure-as-code/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"從零開始的 Infrastructure as Code: Terraform - 01","name":"從零開始的 Infrastructure as Code: Terraform - 01","description":"This article is part of 從零開始的 Infrastructu as Code: Terraform\nGet-started examples / SOP on Github Introducation to Terraform Iac: Speaker transcript Presentation Check my website chechia.net for other blog. Follow my page to get notification. Like my page if you really like it :)\nOutlline our story: issues, steps, \u0026amp; results basics IaC, terraform benefits risks and 坑 to be or not to be experience oriented\nOur stories 100+ devs, many teams 25+ projects 50+ GKEs 80+ SQLs IAMs, redis, VPCs, load-balancers, \u0026hellip; Issues Ops manually create resources through GUI by SOP. We have many isolated, separeated resources, VPCs. It\u0026rsquo;s our culture, and we (devops) want to change. Some projects have short life-cycle. Rapid resources created \u0026amp; destroy. Our user story As a devops, I would like to introduce terraform (IaC) so that I can\n","keywords":["kubernetes","terraform","devops","iac"],"articleBody":"This article is part of 從零開始的 Infrastructu as Code: Terraform\nGet-started examples / SOP on Github Introducation to Terraform Iac: Speaker transcript Presentation Check my website chechia.net for other blog. Follow my page to get notification. Like my page if you really like it :)\nOutlline our story: issues, steps, \u0026 results basics IaC, terraform benefits risks and 坑 to be or not to be experience oriented\nOur stories 100+ devs, many teams 25+ projects 50+ GKEs 80+ SQLs IAMs, redis, VPCs, load-balancers, … Issues Ops manually create resources through GUI by SOP. We have many isolated, separeated resources, VPCs. It’s our culture, and we (devops) want to change. Some projects have short life-cycle. Rapid resources created \u0026 destroy. Our user story As a devops, I would like to introduce terraform (IaC) so that I can\nreview all existing resources minimize error from manual operation ASAP!! As a devops, I would like to fully enforce terraform (IaC) so that I can\nminimize efforts to operate infra delegate infra operations to junior team members minimize IAM privilges Introduction import existing resources review existing resources code plan best practice resource templates create new resources with templates introduce git workflow, plan, commit, PR, and review add wrapper handler automation pipeline repeat 2-4 IaC Programatic way to operate infra declarative (functional) vs. imperative (procedural) Perfect for public cloud, cloud native, virtualized resources Benefits: cost (reduction), speed (faster execution) and risk (remove errors and security violations) Terraform Terraform\nDeclarative (functional) IaC Invoke API delegation State management providers: azure / aws / gcp /alicloud / … Demo https://github.com/chechiachang/terraform-playground\nScope Compute Instances\nKubernetes\nDatabases\nIAM\nNetworking\nLoad Balancer\nExpected benefits Minimize manual operation.\nZero manual operation error\nStandarized infra. Infra as a (stable) product. fast, really fast to duplicate envs\nInfra workflow with infra review\nEasy to create identical dev, staging, prod envs Reviewed infra. Better workflow. Code needs reviews, so do infra. Fully automized infra pipeline.\nOther Benefits Don’t afraid to change prod sites anymore We made a massive infra migration in this quater!! Better readability to GUI. Allow comment everywhere. Risks Incorrect usage could cause massive destruction. 如果看見 destroy 的提示，請雙手離開鍵盤。 ~ first line in our SOP If see “destroy”, cancel operation \u0026 call for help. State management A little latency between infra version and terraform provider version Reduce Risks Sufficient understanding to infra \u0026 terraform Sufficient training to juniors Minimize IAM privilege: remove update / delete permissions Git-flow Our SOP\nedit tf push new branch commit PR, review \u0026 discussion merge \u0026 apply revert to previous tag if necessary (Utility) Provide template wrap resources for better accesibility lower operation risks uniform naming convention best practice suggested default value About introducing new tool The hardest part is always people Focus on critical issues (痛點) instead of tool itself. “We introduce tool to solve…” Put result into statistics “The outage due to misconfig is reduced by…” Overall, my IaC experience is GREAT! IaC to automation. Comment (for infra) is important. You have to write doc anyway. Why not put in IaC? Q\u0026A Full transcript Presentation file Source Code on Github chechia.net \u003c- full contents Follow my page to get notification Like it if you really like it :) Appendix.I more about terraform terraform validate terraform import terraform module terraform cloud \u0026 state management\nAppendix.I understand State conflict Shared but synced watch out for state conflicts when colaborating state diff. could cause terraform mis-plan Solution: synced state lock Colatorative edit (git branch \u0026 PR), synchronized terraform plan \u0026 apply or better: automation Appendix.II understand resources from API aspect GCP Load Balancer\nGCP Load Balancing understand resources from API aspect\nhow terraform work with GCP API internal\nregional pass-through: tcp / udp -\u003e internal TCP/UDP proxy: http / https -\u003e internal HTTP(S) external\nregional pass-through: tcp / udp -\u003e tcp/udp network global / effective regional proxy tcp -\u003e TCP Proxy ssl -\u003e SSL Proxy http / https -\u003e External HTTP(S) Terraform Resource forwarding_rule\nforwarding_rule: tcp \u0026 http global_forwarding_rule: only http backend_service\nbackend_service health_check http_health_check https_health_check region_backend_service region_health_check region_http_health_check region_https_health_check Some ways to do IaC Cloud Formation bash script with API / client 引言 Infrastructure as Code 從字面上解釋，IaC 就是用程式碼描述 infrastructure。那為何會出現這個概念？\n如果不 IaC 是什麼狀況？我們還是可以透過 GUI 或是 API 操作。隨叫隨用\n雲端運算風行，工程師可以很在 GUI 介面上，很輕易的部署資料中心的架構。輸入基本資訊，滑鼠點個一兩下，就可以在遠端啟用運算機器，啟用資料庫，設置虛擬網路與路由，幾分鐘就可以完成架設服務的基礎建設(infrastructure)，開始運行服務。\n然而隨著\n雲平台提供更多新的（複雜的）服務 服務彼此可能是有相依性（dependency），服務需要仰賴其他服務 或是動態耦合，更改服務會連動其他服務，一髮動全身 需要縝密的存取控管（access control） 防火牆，路由規則 雲平台上，團隊成員的存取權限 專案的規模與複雜度增加 多環境的部署 多個備援副本設定 大量機器形成的集群 IaC 的實際需求 以下這些對話是不是很耳熟？\nIaC 的實際需求 沒有需求，就不需要找尋新的解決方案。\n有看上面目錄的朋友，應該知道這系列文章的後面，我會實際分享於公司內部導入 Terraform 與 IaC 方法的過程。\n各位讀者會找到這篇文，大概都是因為實際搜尋了 Terraform 或是 IaC 的關鍵字才找到這篇。\n如果沒有需求，自己因為覺得有趣而拉下來研究，\n如果沒有明確需求，就貿然導入 無謂增加亂度\nIaC 的實現工具 為何選擇 Terraform 建議 如果不熟，從 import 現有最好的資源開始。把 70 分保住，再向 80 90 邁進。 善用 module 封裝，只露出會用到的參數。 ","wordCount":"747","inLanguage":"en","image":"https://chechia.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2020-06-14T16:46:09+08:00","dateModified":"2020-06-14T16:46:09+08:00","author":{"@type":"Person","name":"chechiachang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://chechia.net/posts/2020-06-14-terraform-infrastructure-as-code/"},"publisher":{"@type":"Organization","name":"Che-Chia Chang","logo":{"@type":"ImageObject","url":"https://chechia.net/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://chechia.net/ accesskey=h title="Home (Alt + H)"><img src=https://chechia.net/favicon/favicon-32x32.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://chechia.net/#posts title=Posts><span>Posts</span></a></li><li><a href=https://mvp.microsoft.com/zh-TW/mvp/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5 title=MVP><span>MVP</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://chechia.net/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://chechia.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://chechia.net/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://chechia.net/>Home</a>&nbsp;»&nbsp;<a href=https://chechia.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">從零開始的 Infrastructure as Code: Terraform - 01</h1><div class=post-meta><span title='2020-06-14 16:46:09 +0800 CST'>June 14, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;747 words&nbsp;·&nbsp;chechiachang&nbsp;|&nbsp;<a href=https://github.com/chechiachang.github.io-src/content/posts/2020-06-14-terraform-infrastructure-as-code.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#gcp-load-balancing>GCP Load Balancing</a></li><li><a href=#terraform-resource>Terraform Resource</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>This article is part of <a href=https://chechia.net/posts/2020-06-14-terraform-infrastructure-as-code/>從零開始的 Infrastructu as Code: Terraform</a></p><ul><li><a href=https://github.com/chechiachang/terraform-playground>Get-started examples / SOP on Github</a></li><li><a href=https://chechia.net/posts/2020-06-15-terraform-infrastructure-as-code-transcript/>Introducation to Terraform Iac: Speaker transcript</a></li><li><a href=https://slides.com/chechiachang/terraform-introduction/edit>Presentation</a></li></ul><p>Check my website <a href=https://chechia.net>chechia.net</a> for other blog. <a href=https://www.facebook.com/engineer.from.scratch>Follow my page to get notification</a>. Like my page if you really like it :)</p><hr><h1 id=outlline>Outlline<a hidden class=anchor aria-hidden=true href=#outlline>#</a></h1><ul><li>our story: issues, steps, & results</li><li>basics IaC, terraform</li><li>benefits</li><li>risks and 坑</li><li>to be or not to be</li></ul><p>experience oriented</p><h1 id=our-stories>Our stories<a hidden class=anchor aria-hidden=true href=#our-stories>#</a></h1><ul><li>100+ devs, many teams</li><li>25+ projects</li><li>50+ GKEs</li><li>80+ SQLs</li><li>IAMs, redis, VPCs, load-balancers, &mldr;</li></ul><h1 id=issues>Issues<a hidden class=anchor aria-hidden=true href=#issues>#</a></h1><ul><li>Ops manually create resources through GUI by SOP.</li><li>We have many isolated, separeated resources, VPCs. It&rsquo;s our culture, and we (devops) want to change.</li><li>Some projects have short life-cycle. Rapid resources created & destroy.</li></ul><h1 id=our-user-story>Our user story<a hidden class=anchor aria-hidden=true href=#our-user-story>#</a></h1><p>As a devops,
I would like to introduce terraform (IaC)
so that I can</p><ul><li>review all existing resources</li><li>minimize error from manual operation</li><li>ASAP!!</li></ul><p>As a devops,
I would like to fully enforce terraform (IaC)
so that I can</p><ul><li>minimize efforts to operate infra</li><li>delegate infra operations to junior team members</li><li>minimize IAM privilges</li></ul><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><ol><li>import existing resources</li><li>review existing resources code</li><li>plan best practice resource templates</li><li>create new resources with templates</li><li>introduce git workflow, plan, commit, PR, and review</li><li>add wrapper handler</li><li>automation pipeline</li><li>repeat 2-4</li></ol><h1 id=iac>IaC<a hidden class=anchor aria-hidden=true href=#iac>#</a></h1><ul><li>Programatic way to operate infra</li><li>declarative (functional) vs. imperative (procedural)</li><li>Perfect for public cloud, cloud native, virtualized resources</li><li>Benefits: cost (reduction), speed (faster execution) and risk (remove errors and security violations)</li></ul><h1 id=terraform>Terraform<a hidden class=anchor aria-hidden=true href=#terraform>#</a></h1><p><a href=https://www.terraform.io/>Terraform</a></p><ul><li>Declarative (functional) IaC</li><li>Invoke API delegation</li><li>State management</li><li>providers: azure / aws / gcp /alicloud / &mldr;</li></ul><h1 id=demo>Demo<a hidden class=anchor aria-hidden=true href=#demo>#</a></h1><p><a href=https://github.com/chechiachang/terraform-playground>https://github.com/chechiachang/terraform-playground</a></p><h1 id=scope>Scope<a hidden class=anchor aria-hidden=true href=#scope>#</a></h1><ul><li><p>Compute Instances</p></li><li><p>Kubernetes</p></li><li><p>Databases</p></li><li><p>IAM</p></li><li><p>Networking</p></li><li><p>Load Balancer</p></li></ul><h1 id=expected-benefits>Expected benefits<a hidden class=anchor aria-hidden=true href=#expected-benefits>#</a></h1><ul><li><p>Minimize manual operation.</p></li><li><p>Zero manual operation error</p><ul><li>Standarized infra. Infra as a (stable) product.</li></ul></li><li><p>fast, really fast to duplicate envs</p></li><li><p>Infra workflow with infra review</p><ul><li>Easy to create identical dev, staging, prod envs</li><li>Reviewed infra. Better workflow. Code needs reviews, so do infra.</li></ul></li><li><p>Fully automized infra pipeline.</p></li></ul><h1 id=other-benefits>Other Benefits<a hidden class=anchor aria-hidden=true href=#other-benefits>#</a></h1><ul><li>Don&rsquo;t afraid to change prod sites anymore<ul><li>We made a massive infra migration in this quater!!</li></ul></li><li>Better readability to GUI. Allow comment everywhere.</li></ul><h1 id=risks>Risks<a hidden class=anchor aria-hidden=true href=#risks>#</a></h1><ul><li>Incorrect usage could cause massive destruction.<ul><li>如果看見 destroy 的提示，請雙手離開鍵盤。 ~ first line in our SOP</li><li>If see &ldquo;destroy&rdquo;, cancel operation & call for help.</li></ul></li><li>State management</li><li>A little latency between infra version and terraform provider version</li></ul><h1 id=reduce-risks>Reduce Risks<a hidden class=anchor aria-hidden=true href=#reduce-risks>#</a></h1><ul><li>Sufficient understanding to infra & terraform</li><li>Sufficient training to juniors</li><li>Minimize IAM privilege: remove update / delete permissions</li></ul><h1 id=git-flow>Git-flow<a hidden class=anchor aria-hidden=true href=#git-flow>#</a></h1><p><a href=https://github.com/chechiachang/terraform-playground/blob/master/SOP.md>Our SOP</a></p><ul><li>edit tf</li><li>push new branch commit</li><li>PR, review & discussion</li><li>merge & apply</li><li>revert to previous tag if necessary</li></ul><h1 id=utility-provide-template>(Utility) Provide template<a hidden class=anchor aria-hidden=true href=#utility-provide-template>#</a></h1><ul><li>wrap resources for<ul><li>better accesibility</li><li>lower operation risks</li><li>uniform naming convention</li><li>best practice</li><li>suggested default value</li></ul></li></ul><h1 id=about-introducing-new-tool>About introducing new tool<a hidden class=anchor aria-hidden=true href=#about-introducing-new-tool>#</a></h1><ul><li>The hardest part is always people<ul><li>Focus on critical issues (痛點) instead of tool itself. &ldquo;We introduce tool to solve&mldr;&rdquo;</li><li>Put result into statistics &ldquo;The outage due to misconfig is reduced by&mldr;&rdquo;</li></ul></li></ul><h1 id=overall-my-iac-experience-is-great>Overall, my IaC experience is GREAT!<a hidden class=anchor aria-hidden=true href=#overall-my-iac-experience-is-great>#</a></h1><ul><li>IaC to automation.</li><li>Comment (for infra) is important. You have to write doc anyway. Why not put in IaC?</li></ul><h1 id=qa>Q&amp;A<a hidden class=anchor aria-hidden=true href=#qa>#</a></h1><ul><li><a href>Full transcript</a></li><li><a href>Presentation file</a></li><li><a href=https://github.com/chechiachang/chechiachang.github.io-src/blob/master/content/posts/terraform-infrastructure-as-code/index.md>Source Code on Github</a></li><li><a href=https://chechia.net>chechia.net</a> &lt;- full contents</li><li><a href=https://www.facebook.com/engineer.from.scratch>Follow my page to get notification</a><ul><li>Like it if you really like it :)</li></ul></li></ul><h1 id=appendixi-more-about-terraform>Appendix.I more about terraform<a hidden class=anchor aria-hidden=true href=#appendixi-more-about-terraform>#</a></h1><p>terraform validate
terraform import
terraform module
terraform cloud & state management</p><h1 id=appendixi-understand-state-conflict>Appendix.I understand State conflict<a hidden class=anchor aria-hidden=true href=#appendixi-understand-state-conflict>#</a></h1><ul><li>Shared but synced</li><li>watch out for state conflicts when colaborating<ul><li>state diff. could cause terraform mis-plan</li></ul></li><li>Solution: synced state lock<ul><li>Colatorative edit (git branch & PR), synchronized terraform plan & apply</li><li>or better: automation</li></ul></li></ul><h1 id=appendixii-understand-resources-from-api-aspect>Appendix.II understand resources from API aspect<a hidden class=anchor aria-hidden=true href=#appendixii-understand-resources-from-api-aspect>#</a></h1><p>GCP Load Balancer</p><h3 id=gcp-load-balancing>GCP Load Balancing<a hidden class=anchor aria-hidden=true href=#gcp-load-balancing>#</a></h3><ul><li><p>understand resources from API aspect</p><ul><li>how terraform work with GCP API</li></ul></li><li><p>internal</p><ul><li>regional<ul><li>pass-through: tcp / udp -> internal TCP/UDP</li><li>proxy: http / https -> internal HTTP(S)</li></ul></li></ul></li><li><p>external</p><ul><li>regional<ul><li>pass-through: tcp / udp -> tcp/udp network</li></ul></li><li>global / effective regional<ul><li>proxy<ul><li>tcp -> TCP Proxy</li><li>ssl -> SSL Proxy</li><li>http / https -> External HTTP(S)</li></ul></li></ul></li></ul></li></ul><h3 id=terraform-resource>Terraform Resource<a hidden class=anchor aria-hidden=true href=#terraform-resource>#</a></h3><ul><li><p>forwarding_rule</p><ul><li>forwarding_rule: tcp & http</li><li>global_forwarding_rule: only http</li></ul></li><li><p>backend_service</p><ul><li>backend_service<ul><li>health_check</li><li>http_health_check</li><li>https_health_check</li></ul></li><li>region_backend_service<ul><li>region_health_check</li><li>region_http_health_check</li><li>region_https_health_check</li></ul></li></ul></li></ul><h1 id=some-ways-to-do-iac>Some ways to do IaC<a hidden class=anchor aria-hidden=true href=#some-ways-to-do-iac>#</a></h1><ul><li>Cloud Formation</li><li>bash script with API / client</li></ul><h1 id=引言-infrastructure-as-code>引言 Infrastructure as Code<a hidden class=anchor aria-hidden=true href=#引言-infrastructure-as-code>#</a></h1><p>從字面上解釋，IaC 就是用程式碼描述 infrastructure。那為何會出現這個概念？</p><p>如果不 IaC 是什麼狀況？我們還是可以透過 GUI 或是 API 操作。隨叫隨用</p><p>雲端運算風行，工程師可以很在 GUI 介面上，很輕易的部署資料中心的架構。輸入基本資訊，滑鼠點個一兩下，就可以在遠端啟用運算機器，啟用資料庫，設置虛擬網路與路由，幾分鐘就可以完成架設服務的基礎建設(infrastructure)，開始運行服務。</p><p>然而隨著</p><ul><li>雲平台提供更多新的（複雜的）服務<ul><li>服務彼此可能是有相依性（dependency），服務需要仰賴其他服務</li><li>或是動態耦合，更改服務會連動其他服務，一髮動全身</li></ul></li><li>需要縝密的存取控管（access control）<ul><li>防火牆，路由規則</li><li>雲平台上，團隊成員的存取權限</li></ul></li><li>專案的規模與複雜度增加<ul><li>多環境的部署</li><li>多個備援副本設定</li><li>大量機器形成的集群</li></ul></li></ul><h1 id=iac-的實際需求>IaC 的實際需求<a hidden class=anchor aria-hidden=true href=#iac-的實際需求>#</a></h1><p>以下這些對話是不是很耳熟？</p><h1 id=iac-的實際需求-1>IaC 的實際需求<a hidden class=anchor aria-hidden=true href=#iac-的實際需求-1>#</a></h1><p>沒有需求，就不需要找尋新的解決方案。</p><p>有看上面目錄的朋友，應該知道這系列文章的後面，我會實際分享於公司內部導入 Terraform 與 IaC 方法的過程。</p><p>各位讀者會找到這篇文，大概都是因為實際搜尋了 Terraform 或是 IaC 的關鍵字才找到這篇。</p><p>如果沒有需求，自己因為覺得有趣而拉下來研究，</p><p>如果沒有明確需求，就貿然導入
無謂增加亂度</p><h1 id=iac-的實現工具>IaC 的實現工具<a hidden class=anchor aria-hidden=true href=#iac-的實現工具>#</a></h1><h1 id=為何選擇-terraform>為何選擇 Terraform<a hidden class=anchor aria-hidden=true href=#為何選擇-terraform>#</a></h1><h1 id=建議>建議<a hidden class=anchor aria-hidden=true href=#建議>#</a></h1><ol><li>如果不熟，從 import 現有最好的資源開始。把 70 分保住，再向 80 90 邁進。</li><li>善用 module 封裝，只露出會用到的參數。</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://chechia.net/tags/kubernetes/>Kubernetes</a></li><li><a href=https://chechia.net/tags/terraform/>Terraform</a></li><li><a href=https://chechia.net/tags/devops/>Devops</a></li><li><a href=https://chechia.net/tags/iac/>Iac</a></li></ul><nav class=paginav><a class=prev href=https://chechia.net/posts/2020-06-15-terraform-infrastructure-as-code-transcript/><span class=title>« Prev</span><br><span>Terraform Infrastructure as Code Transcript</span>
</a><a class=next href=https://chechia.net/posts/2019-12-31-say-goodbye-2019/><span class=title>Next »</span><br><span>Say Goodbye 2019</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on x" href="https://x.com/intent/tweet/?text=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001&amp;url=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f&amp;hashtags=kubernetes%2cterraform%2cdevops%2ciac"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f&amp;title=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001&amp;summary=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001&amp;source=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f&title=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on whatsapp" href="https://api.whatsapp.com/send?text=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001%20-%20https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on telegram" href="https://telegram.me/share/url?text=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001&amp;url=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 從零開始的 Infrastructure as Code: Terraform - 01 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e5%be%9e%e9%9b%b6%e9%96%8b%e5%a7%8b%e7%9a%84%20Infrastructure%20as%20Code%3a%20Terraform%20-%2001&u=https%3a%2f%2fchechia.net%2fposts%2f2020-06-14-terraform-infrastructure-as-code%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://chechia.net/>Che-Chia Chang</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>