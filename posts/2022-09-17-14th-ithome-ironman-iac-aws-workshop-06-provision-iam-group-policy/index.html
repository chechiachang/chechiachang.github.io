<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Provision Iam Group Policy | Che-Chia Chang</title><meta name=keywords content="terraform,iac,aws,鐵人賽2022"><meta name=description content="Article description."><meta name=author content="chechiachang"><link rel=canonical href=https://chechia.net/posts/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/><meta name=google-site-verification content="G-QYR8JCDGM9"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://chechia.net/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://chechia.net/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://chechia.net/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://chechia.net/favicon/favicon-32x32.png><link rel=mask-icon href=https://chechia.net/favicon/favicon-32x32.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://chechia.net/posts/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://chechia.net/posts/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/"><meta property="og:site_name" content="Che-Chia Chang"><meta property="og:title" content="Provision Iam Group Policy"><meta property="og:description" content="Article description."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-20T10:39:37+08:00"><meta property="article:modified_time" content="2022-09-20T10:39:37+08:00"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="Iac"><meta property="article:tag" content="Aws"><meta property="article:tag" content="鐵人賽2022"><meta property="og:image" content="https://chechia.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://chechia.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Provision Iam Group Policy"><meta name=twitter:description content="Article description."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://chechia.net/posts/"},{"@type":"ListItem","position":2,"name":"Provision Iam Group Policy","item":"https://chechia.net/posts/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Provision Iam Group Policy","name":"Provision Iam Group Policy","description":"Article description.","keywords":["terraform","iac","aws","鐵人賽2022"],"articleBody":"昨天我們將 root account IAM user import 到 terraform 中\n示範 terraform import 增加 iam user 的功能到 module repository 中 今天要完成 root account 中 IAM Group + Policy，順便聊聊 aws IAM policy 管理原則\nroot 中設定 IAM User 將手動產生的 Administrator 的 IAM User import terraform 中 補上 root account IAM Policy 補上 root account IAM Group iThome 鐵人賽好讀版\n賽後文章會整理放到個人的部落格上 http://chechia.net/\n追蹤粉專可以收到文章的主動推播\n承接昨天的 plan 結果，我們今天要把 IAM policy 與 group 開出來\nIam User 首先 review aws_iam_user 的 resource\n# module.iam_user[\"Administrator\"].aws_iam_user.this[0] will be updated in-place ~ resource \"aws_iam_user\" \"this\" { + force_destroy = true id = \"Administrator\" name = \"Administrator\" tags = {} # (4 unchanged attributes hidden) }` force_destroy 這個參數我們需要嗎？可以一找以下的步驟查文件判斷\n直接 google “terraform aws iam user”，找到 Terraform registry 上 AWS iam user 的說明 這裡有說明，刪除 user 時，如果有 non-terraform-managed 的 access key, login profile, MFA devices，是否仍要強制刪除 這裡我們希望如果有 access key 或 MFA device 存在的話，不要直接刪除 User 將 https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-b15a741b1129d8f5451060653922d85c934792a1dd41c7fae1b02f3a6398094aR8 改成 false Iam Group \u0026 Policy 今天要來調整 Iam Group \u0026 Policy\nGruntwork 文件: Root Account 說明，root account 下應該有兩個 policy group group/full-access 給予 root account 超級管理員完整的控制權限 billing 給予 billing 的會計人員進來報帳 首先 full-access 的 iam_group plan 後的結果如下\n由於我們使用的 module 是 terraform-aws-iam 的 group with policies module.iam_group_with_policies_full_access 裡面有 group 也有 policy .aws_iam_group.this[0] 是主要的 group # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created + resource \"aws_iam_group\" \"this\" { + arn = (known after apply) + id = (known after apply) + name = \"full-access\" + path = \"/\" + unique_id = (known after apply) } # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created + resource \"aws_iam_group_membership\" \"this\" { + group = (known after apply) + id = (known after apply) + name = \"full-access\" + users = [ + \"Administrator\", ] } 有了 group，接下來就是要配 policy\n一樣透過 group + policy -\u003e attachment 的 resource，把 group 跟 policy 綁在一起 我們這邊的程式碼 直接使用 aws 預先定義好的 policy arn:aws:iam::aws:policy/AdministratorAccess # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created + resource \"aws_iam_group_policy_attachment\" \"custom_arns\" { + group = (known after apply) + id = (known after apply) + policy_arn = \"arn:aws:iam::aws:policy/AdministratorAccess\" } IAM AWS 預先定義的 policy 有哪些 aws 已經預先定義好的 policy 可以使用？\n可以上 aws web console -\u003e iam -\u003e policies 下查詢 這些預先定義的 policy，是 aws 依照最常出現的使用情境，事先建立的 policy\n使用者不用再建議 ex. AWS 覺得 administrator 大概會需要這些權限，都先開到這個 policy/admin 上 ex. AWS 覺得 billing 大概會需要這些權限，都先開到這個 policy/billing 上 由於是 AWS 依照大部分人的需求開的 policy，所以會多開許多權限 這也是用預先定義 policy 的缺點，就是為了滿足很多人的需求，權限太大 違反最小權限原則，給予權限過多也造成安全性的風險 不使用預先定義的 policy 的話，我們可以自己寫 policy\n一個 policy 開出來 default 沒有任何 permission 依據最小權限原則，一句一句增加 permission 到 policy 上 如此可以確保 policy 上的 permission 都是需要的，而不會有多開但是用不到的權限 權限愈大，安全性風險越高，所以最佳實踐會希望所有 policy 都是配得剛剛好夠用就好\n然而配 policy 很花時間，用 aws 已經寫好的 policy 馬上可以用 實務上可以考量專案時間與整體人力，以及需要的安全等級，來考慮要不要做到這麼細 AWS policy access advisor 通常寫 policy 很難配到非常完美剛剛好，通常都會多開 permission\n權限多開功能不會壞，少開直接 permission denied 那多開的權限沒有用到，之後要如何把沒有用到的權限收回來？ AWS web console 提供根據使用紀錄，提建議修改 policy\nhttps://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor.html\naws 會統計各個 IAM 元件，存取 AWS API 使用/沒使用的權限\n例如這個 User 過去 90 天使用了哪些 permission 去打 API 以及 User 還有哪些 policy permission，是過去 90 天都沒有用到的 這些長時間都沒有用到的 policy，我們就應該定期 review，然後移除這些不必要的權限\nUser / Group / … 等等都需要做一樣的事情 module 作為一個組成元件使用 由於我們在 module input 中開啟了 attach_iam_self_management_policy = true 參數，在 module 中便連帶產生\n.aws_iam_policy.iam_self_management[0]，裡面定義的要做 self management 所需要的 permission 再把 policy 透過 .aws_iam_group_policy_attachment.iam_self_management[0] 綁到 group 上 # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created + resource \"aws_iam_policy\" \"iam_self_management\" { ... } # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created + resource \"aws_iam_group_policy_attachment\" \"iam_self_management\" { + group = (known after apply) + id = (known after apply) + policy_arn = (known after apply) } 上面就是我們的 root account group/full-access 與對應的 policy\nbilling account 接著是 root account group/full-access 與對應的 policy\n我們可以自己手寫 policy，依照最小權限原則，一條一條加入 permission 或是我們可以上 aws web console 找看看有無預先定義好的 policy 我們搜尋 billing 有看到四個 policy，每個 policy 都有附上 description 說明使用的目的\nBilling AWSBillingConductorReadOnlyAccess AWSBillingConductorFullAccess AWSBillingReadOnlyAccess 這裡就要依據使用的需求選擇\n給予 billing 管理員的權限，就會是 ConductorFullAccess 或 ConductorReadOnlyAccess 給予 billing 報帳人員，應該不用更改 aws 的其他設定，只需要讀取跟輸出，就會是 AWSBillingReadOnlyAccess 我們這邊選擇 AWSBillingConductorFullAccess，做個示範\n點擊 AWSBillingConductorFullAccess，跳到 Policies » AWSBillingConductorFullAccess 頁面 可以看到 policy 的完整 arn，Amazon Resource Name (ARN) 唯一識別AWS 資源，類似於 ID 然後把 arn 填入 module.am_group_with_policies_billing plan \u0026 apply 上面的變更我們的 PR 如下\nterragrunt-infrastructure-modules PR terragrunt-infrastructure-live-example PR 由於我們 module 中有新增 module \"iam_group_with_policies_billing\"，記得要先執行 init\naws-vault exec terraform-30day-root-iam-user --no-session -- terragrunt plan ╷ │ Error: Module not installed │ │ on group.tf line 29: │ 29: module \"iam_group_with_policies_billing\" { │ │ This module is not yet installed. Run \"terraform init\" to install all │ modules required by this configuration. ╵ aws-vault exec terraform-30day-root-iam-user --no-session -- terragrunt init aws-vault exec terraform-30day-root-iam-user --no-session -- terragrunt plan Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: # module.iam_group_with_policies_billing.aws_iam_group.this[0] will be created + resource \"aws_iam_group\" \"this\" { + arn = (known after apply) + id = (known after apply) + name = \"billing\" + path = \"/\" + unique_id = (known after apply) } # module.iam_group_with_policies_billing.aws_iam_group_membership.this[0] will be created + resource \"aws_iam_group_membership\" \"this\" { + group = (known after apply) + id = (known after apply) + name = \"billing\" + users = [ + \"Accounting\", ] } # module.iam_group_with_policies_billing.aws_iam_group_policy_attachment.custom_arns[0] will be created + resource \"aws_iam_group_policy_attachment\" \"custom_arns\" { + group = (known after apply) + id = (known after apply) + policy_arn = \"arn:aws:iam::aws:policy/AWSBillingConductorFullAccess\" } # module.iam_group_with_policies_billing.aws_iam_group_policy_attachment.iam_self_management[0] will be created + resource \"aws_iam_group_policy_attachment\" \"iam_self_management\" { + group = (known after apply) + id = (known after apply) + policy_arn = (known after apply) } # module.iam_group_with_policies_billing.aws_iam_policy.iam_self_management[0] will be created + resource \"aws_iam_policy\" \"iam_self_management\" { + arn = (known after apply) + id = (known after apply) + name = (known after apply) + name_prefix = \"IAMSelfManagement-\" + path = \"/\" + policy = jsonencode( { + Statement = [ + { + Action = [ + \"iam:UploadSigningCertificate\", + \"iam:UploadSSHPublicKey\", + \"iam:UpdateUser\", + \"iam:UpdateLoginProfile\", + \"iam:UpdateAccessKey\", + \"iam:ResyncMFADevice\", + \"iam:List*\", + \"iam:Get*\", + \"iam:GenerateServiceLastAccessedDetails\", + \"iam:GenerateCredentialReport\", + \"iam:EnableMFADevice\", + \"iam:DeleteVirtualMFADevice\", + \"iam:DeleteLoginProfile\", + \"iam:DeleteAccessKey\", + \"iam:CreateVirtualMFADevice\", + \"iam:CreateLoginProfile\", + \"iam:CreateAccessKey\", + \"iam:ChangePassword\", ] + Effect = \"Allow\" + Resource = [ + \"arn:aws:iam::706136188012:user/*/${aws:username}\", + \"arn:aws:iam::706136188012:user/${aws:username}\", + \"arn:aws:iam::706136188012:mfa/${aws:username}\", ] + Sid = \"AllowSelfManagement\" }, + { + Action = [ + \"iam:List*\", + \"iam:Get*\", ] + Effect = \"Allow\" + Resource = \"*\" + Sid = \"AllowIAMReadOnly\" }, + { + Action = \"iam:DeactivateMFADevice\" + Condition = { + Bool = { + \"aws:MultiFactorAuthPresent\" = \"true\" } + NumericLessThan = { + \"aws:MultiFactorAuthAge\" = \"3600\" } } + Effect = \"Allow\" + Resource = [ + \"arn:aws:iam::706136188012:user/*/${aws:username}\", + \"arn:aws:iam::706136188012:user/${aws:username}\", + \"arn:aws:iam::706136188012:mfa/${aws:username}\", ] + Sid = \"AllowDeactivateMFADevice\" }, ] + Version = \"2012-10-17\" } ) + policy_id = (known after apply) + tags_all = (known after apply) } # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created + resource \"aws_iam_group\" \"this\" { + arn = (known after apply) + id = (known after apply) + name = \"full-access\" + path = \"/\" + unique_id = (known after apply) } # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created + resource \"aws_iam_group_membership\" \"this\" { + group = (known after apply) + id = (known after apply) + name = \"full-access\" + users = [ + \"Administrator\", ] } # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created + resource \"aws_iam_group_policy_attachment\" \"custom_arns\" { + group = (known after apply) + id = (known after apply) + policy_arn = \"arn:aws:iam::aws:policy/AdministratorAccess\" } # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created + resource \"aws_iam_group_policy_attachment\" \"iam_self_management\" { + group = (known after apply) + id = (known after apply) + policy_arn = (known after apply) } # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created + resource \"aws_iam_policy\" \"iam_self_management\" { + arn = (known after apply) + id = (known after apply) + name = (known after apply) + name_prefix = \"IAMSelfManagement-\" + path = \"/\" + policy = jsonencode( { + Statement = [ + { + Action = [ + \"iam:UploadSigningCertificate\", + \"iam:UploadSSHPublicKey\", + \"iam:UpdateUser\", + \"iam:UpdateLoginProfile\", + \"iam:UpdateAccessKey\", + \"iam:ResyncMFADevice\", + \"iam:List*\", + \"iam:Get*\", + \"iam:GenerateServiceLastAccessedDetails\", + \"iam:GenerateCredentialReport\", + \"iam:EnableMFADevice\", + \"iam:DeleteVirtualMFADevice\", + \"iam:DeleteLoginProfile\", + \"iam:DeleteAccessKey\", + \"iam:CreateVirtualMFADevice\", + \"iam:CreateLoginProfile\", + \"iam:CreateAccessKey\", + \"iam:ChangePassword\", ] + Effect = \"Allow\" + Resource = [ + \"arn:aws:iam::706136188012:user/*/${aws:username}\", + \"arn:aws:iam::706136188012:user/${aws:username}\", + \"arn:aws:iam::706136188012:mfa/${aws:username}\", ] + Sid = \"AllowSelfManagement\" }, + { + Action = [ + \"iam:List*\", + \"iam:Get*\", ] + Effect = \"Allow\" + Resource = \"*\" + Sid = \"AllowIAMReadOnly\" }, + { + Action = \"iam:DeactivateMFADevice\" + Condition = { + Bool = { + \"aws:MultiFactorAuthPresent\" = \"true\" } + NumericLessThan = { + \"aws:MultiFactorAuthAge\" = \"3600\" } } + Effect = \"Allow\" + Resource = [ + \"arn:aws:iam::706136188012:user/*/${aws:username}\", + \"arn:aws:iam::706136188012:user/${aws:username}\", + \"arn:aws:iam::706136188012:mfa/${aws:username}\", ] + Sid = \"AllowDeactivateMFADevice\" }, ] + Version = \"2012-10-17\" } ) + policy_id = (known after apply) + tags_all = (known after apply) } # module.iam_user[\"Accounting\"].aws_iam_user.this[0] will be created + resource \"aws_iam_user\" \"this\" { + arn = (known after apply) + force_destroy = false + id = (known after apply) + name = \"Accounting\" + path = \"/\" + tags_all = (known after apply) + unique_id = (known after apply) } Plan: 11 to add, 0 to change, 0 to destroy. aws-vault exec terraform-30day-root-iam-user --no-session -- terragrunt apply 眼尖的同學應該有注意到我們把 create_login_profile = false 先關掉\n因為我們還沒有準備 pgp key，這個又要明天再來了 TODO 與進度 透過 root account 設定一組 IAM User 透過 root account 設定多個 aws child accounts root 中設定 IAM User 將手動產生的 Administrator 的 IAM User import terraform 中 補上 root account IAM Policy 補上 root account IAM Group security 中設定 IAM User security 設定 password policy security 設定 MFA policy security 中設定 IAM Policy \u0026 Group dev 中設定 IAM role 允許 security assume dev IAM role ","wordCount":"1465","inLanguage":"en","image":"https://chechia.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-09-20T10:39:37+08:00","dateModified":"2022-09-20T10:39:37+08:00","author":{"@type":"Person","name":"chechiachang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://chechia.net/posts/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy/"},"publisher":{"@type":"Organization","name":"Che-Chia Chang","logo":{"@type":"ImageObject","url":"https://chechia.net/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://chechia.net/ accesskey=h title="Home (Alt + H)"><img src=https://chechia.net/favicon/favicon-32x32.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://chechia.net/#posts title=Posts><span>Posts</span></a></li><li><a href=https://mvp.microsoft.com/zh-TW/mvp/profile/e407d0b9-5c01-eb11-a815-000d3a8ccaf5 title=MVP><span>MVP</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://chechia.net/categories/ title=categories><span>categories</span></a></li><li><a href=https://chechia.net/tags/ title=tags><span>tags</span></a></li><li><a href=https://chechia.net/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://chechia.net/>Home</a>&nbsp;»&nbsp;<a href=https://chechia.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Provision Iam Group Policy</h1><div class=post-description>Article description.</div><div class=post-meta><span title='2022-09-20 10:39:37 +0800 CST'>September 20, 2022</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1465 words&nbsp;·&nbsp;chechiachang&nbsp;|&nbsp;<a href=https://github.com/chechiachang.github.io-src/content/posts/2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#iam-user>Iam User</a></li><li><a href=#iam-group--policy>Iam Group & Policy</a></li><li><a href=#iam-aws-預先定義的-policy>IAM AWS 預先定義的 policy</a></li><li><a href=#aws-policy-access-advisor>AWS policy access advisor</a></li><li><a href=#module-作為一個組成元件使用>module 作為一個組成元件使用</a></li><li><a href=#billing-account>billing account</a></li><li><a href=#plan--apply>plan & apply</a></li><li><a href=#todo-與進度>TODO 與進度</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>昨天我們將 root account IAM user import 到 terraform 中</p><ul><li>示範 terraform import</li><li>增加 iam user 的功能到 module repository 中</li></ul><p>今天要完成 root account 中 IAM Group + Policy，順便聊聊 aws IAM policy 管理原則</p><ul><li><input checked disabled type=checkbox> root 中設定 IAM User<ul><li><input checked disabled type=checkbox> 將手動產生的 Administrator 的 IAM User import terraform 中</li><li><input disabled type=checkbox> 補上 root account IAM Policy</li><li><input disabled type=checkbox> 補上 root account IAM Group</li></ul></li></ul><p><a href=https://ithelp.ithome.com.tw/articles/10290931>iThome 鐵人賽好讀版</a></p><p><a href=http://chechia.net/>賽後文章會整理放到個人的部落格上 http://chechia.net/</a></p><p><a href=https://www.facebook.com/engineer.from.scratch>追蹤粉專可以收到文章的主動推播</a></p><p><img alt=https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg loading=lazy src=https://ithelp.ithome.com.tw/upload/images/20210901/20120327NvpHVr2QC0.jpg></p><hr><p>承接昨天的 plan 結果，我們今天要把 IAM policy 與 group 開出來</p><h3 id=iam-user>Iam User<a hidden class=anchor aria-hidden=true href=#iam-user>#</a></h3><p>首先 review <code>aws_iam_user</code> 的 resource</p><pre><code># module.iam_user[&quot;Administrator&quot;].aws_iam_user.this[0] will be updated in-place
  ~ resource &quot;aws_iam_user&quot; &quot;this&quot; {
      + force_destroy = true
        id            = &quot;Administrator&quot;
        name          = &quot;Administrator&quot;
        tags          = {}
        # (4 unchanged attributes hidden)
    }`
</code></pre><p><code>force_destroy</code> 這個參數我們需要嗎？可以一找以下的步驟查文件判斷</p><ul><li>直接 google &ldquo;terraform aws iam user&rdquo;，找到 <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_user#force_destroy>Terraform registry 上 AWS iam user 的說明</a></li><li>這裡有說明，刪除 user 時，如果有 non-terraform-managed 的 access key, login profile, MFA devices，是否仍要強制刪除</li><li>這裡我們希望如果有 access key 或 MFA device 存在的話，不要直接刪除 User
將 <a href=https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-b15a741b1129d8f5451060653922d85c934792a1dd41c7fae1b02f3a6398094aR8>https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-b15a741b1129d8f5451060653922d85c934792a1dd41c7fae1b02f3a6398094aR8</a> 改成 false</li></ul><h3 id=iam-group--policy>Iam Group & Policy<a hidden class=anchor aria-hidden=true href=#iam-group--policy>#</a></h3><p>今天要來調整 Iam Group & Policy</p><ul><li><a href=https://docs.gruntwork.io/guides/build-it-yourself/landing-zone/production-grade-design/the-root-account>Gruntwork 文件: Root Account 說明</a>，root account 下應該有兩個 policy group<ul><li>group/full-access 給予 root account 超級管理員完整的控制權限</li><li>billing 給予 billing 的會計人員進來報帳</li></ul></li></ul><p>首先 full-access 的 <code>iam_group</code> plan 後的結果如下</p><ul><li>由於我們使用的 <a href=https://github.com/terraform-aws-modules/terraform-aws-iam/tree/master/modules/iam-group-with-policies>module 是 terraform-aws-iam 的 group with policies</a> <code>module.iam_group_with_policies_full_access</code> 裡面有 group 也有 policy</li><li><code>.aws_iam_group.this[0]</code> 是主要的 group</li></ul><pre><code>  # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created
  + resource &quot;aws_iam_group&quot; &quot;this&quot; {
      + arn       = (known after apply)
      + id        = (known after apply)
      + name      = &quot;full-access&quot;
      + path      = &quot;/&quot;
      + unique_id = (known after apply)
    }

  # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created
  + resource &quot;aws_iam_group_membership&quot; &quot;this&quot; {
      + group = (known after apply)
      + id    = (known after apply)
      + name  = &quot;full-access&quot;
      + users = [
          + &quot;Administrator&quot;,
        ]
    }
</code></pre><p>有了 group，接下來就是要配 policy</p><ul><li>一樣透過 group + policy -> attachment 的 resource，把 group 跟 policy 綁在一起</li><li><a href=https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-858c29afbd11c170c1b2d1f0368b50368ff0d056682ec1ddc51cd2014b04f275R22>我們這邊的程式碼</a> 直接使用 aws 預先定義好的 policy <code>arn:aws:iam::aws:policy/AdministratorAccess</code></li></ul><pre><code>  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created
  + resource &quot;aws_iam_group_policy_attachment&quot; &quot;custom_arns&quot; {
      + group      = (known after apply)
      + id         = (known after apply)
      + policy_arn = &quot;arn:aws:iam::aws:policy/AdministratorAccess&quot;
    }
</code></pre><h3 id=iam-aws-預先定義的-policy>IAM AWS 預先定義的 policy<a hidden class=anchor aria-hidden=true href=#iam-aws-預先定義的-policy>#</a></h3><p>有哪些 aws 已經預先定義好的 policy 可以使用？</p><ul><li>可以上 aws web console -> iam -> policies 下查詢</li></ul><p><img alt="AWS Web Console IAM Policies" loading=lazy src=https://ithelp.ithome.com.tw/upload/images/20220920/20120327I5BmCCMAky.png></p><p>這些預先定義的 policy，是 aws 依照最常出現的使用情境，事先建立的 policy</p><ul><li>使用者不用再建議</li><li>ex. AWS 覺得 administrator 大概會需要這些權限，都先開到這個 policy/admin 上</li><li>ex. AWS 覺得 billing 大概會需要這些權限，都先開到這個 policy/billing 上</li><li>由於是 AWS 依照大部分人的需求開的 policy，所以會多開許多權限<ul><li>這也是用預先定義 policy 的缺點，就是為了滿足很多人的需求，權限太大</li><li>違反最小權限原則，給予權限過多也造成安全性的風險</li></ul></li></ul><p>不使用預先定義的 policy 的話，我們可以自己寫 policy</p><ul><li>一個 policy 開出來 default 沒有任何 permission</li><li>依據最小權限原則，一句一句增加 permission 到 policy 上</li><li>如此可以確保 policy 上的 permission 都是需要的，而不會有多開但是用不到的權限</li></ul><p>權限愈大，安全性風險越高，所以最佳實踐會希望所有 policy 都是配得剛剛好夠用就好</p><ul><li>然而配 policy 很花時間，用 aws 已經寫好的 policy 馬上可以用</li><li>實務上可以考量專案時間與整體人力，以及需要的安全等級，來考慮要不要做到這麼細</li></ul><h3 id=aws-policy-access-advisor>AWS policy access advisor<a hidden class=anchor aria-hidden=true href=#aws-policy-access-advisor>#</a></h3><p>通常寫 policy 很難配到非常完美剛剛好，通常都會多開 permission</p><ul><li>權限多開功能不會壞，少開直接 permission denied</li><li>那多開的權限沒有用到，之後要如何把沒有用到的權限收回來？</li></ul><p>AWS web console 提供根據使用紀錄，提建議修改 policy</p><p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor.html</a></p><p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor-view-data.html>aws 會統計各個 IAM 元件，存取 AWS API 使用/沒使用的權限</a></p><ul><li>例如這個 User 過去 90 天使用了哪些 permission 去打 API</li><li>以及 User 還有哪些 policy permission，是過去 90 天都沒有用到的</li></ul><p>這些長時間都沒有用到的 policy，我們就應該定期 review，然後移除這些不必要的權限</p><ul><li>User / Group / &mldr; 等等都需要做一樣的事情</li></ul><h3 id=module-作為一個組成元件使用>module 作為一個組成元件使用<a hidden class=anchor aria-hidden=true href=#module-作為一個組成元件使用>#</a></h3><p>由於我們在 module input 中開啟了 <code>attach_iam_self_management_policy = true</code> 參數，在 module 中便連帶產生</p><ul><li><code>.aws_iam_policy.iam_self_management[0]</code>，裡面定義的要做 self management 所需要的 permission</li><li>再把 policy 透過 <code>.aws_iam_group_policy_attachment.iam_self_management[0]</code> 綁到 group 上</li></ul><pre><code>  # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created
  + resource &quot;aws_iam_policy&quot; &quot;iam_self_management&quot; {
    ...
    }

  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created
  + resource &quot;aws_iam_group_policy_attachment&quot; &quot;iam_self_management&quot; {
      + group      = (known after apply)
      + id         = (known after apply)
      + policy_arn = (known after apply)
    }
</code></pre><p>上面就是我們的 root account group/full-access 與對應的 policy</p><h3 id=billing-account>billing account<a hidden class=anchor aria-hidden=true href=#billing-account>#</a></h3><p>接著是 root account group/full-access 與對應的 policy</p><ul><li>我們可以自己手寫 policy，依照最小權限原則，一條一條加入 permission</li><li>或是我們可以上 aws web console 找看看有無預先定義好的 policy</li></ul><p><img alt="AWS Web Console IAM Policies: billing" loading=lazy src=https://ithelp.ithome.com.tw/upload/images/20220920/20120327nNp3eZnW9v.png></p><p><img alt="AWS Web Console IAM Policies: billing difference" loading=lazy src=https://ithelp.ithome.com.tw/upload/images/20220920/20120327nhmspwn04K.png></p><p>我們搜尋 billing 有看到四個 policy，每個 policy 都有附上 description 說明使用的目的</p><ul><li>Billing</li><li>AWSBillingConductorReadOnlyAccess</li><li>AWSBillingConductorFullAccess</li><li>AWSBillingReadOnlyAccess</li></ul><p>這裡就要依據使用的需求選擇</p><ul><li>給予 billing 管理員的權限，就會是 ConductorFullAccess 或 ConductorReadOnlyAccess</li><li>給予 billing 報帳人員，應該不用更改 aws 的其他設定，只需要讀取跟輸出，就會是 AWSBillingReadOnlyAccess</li></ul><p>我們這邊選擇 AWSBillingConductorFullAccess，做個示範</p><ul><li>點擊 AWSBillingConductorFullAccess，跳到 Policies &#187; AWSBillingConductorFullAccess 頁面</li><li>可以看到 policy 的完整 arn，Amazon Resource Name (ARN) 唯一識別AWS 資源，類似於 ID</li><li>然後把 arn 填入 <a href=https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/1/files#diff-858c29afbd11c170c1b2d1f0368b50368ff0d056682ec1ddc51cd2014b04f275R46>module.am_group_with_policies_billing</a></li></ul><p><img alt="AWS Web Console IAM Policies: AWSBillingConductorFullAccess" loading=lazy src=https://ithelp.ithome.com.tw/upload/images/20220920/20120327PmO72VOmMV.png></p><h3 id=plan--apply>plan & apply<a hidden class=anchor aria-hidden=true href=#plan--apply>#</a></h3><p>上面的變更我們的 PR 如下</p><ul><li><a href=https://github.com/chechiachang/terragrunt-infrastructure-modules/pull/2>terragrunt-infrastructure-modules PR</a></li><li><a href=https://github.com/chechiachang/terragrunt-infrastructure-live-example/pull/2>terragrunt-infrastructure-live-example PR</a></li></ul><p>由於我們 module 中有新增 <code>module "iam_group_with_policies_billing"</code>，記得要先執行 init</p><pre><code>aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan

╷
│ Error: Module not installed
│
│   on group.tf line 29:
│   29: module &quot;iam_group_with_policies_billing&quot; {
│
│ This module is not yet installed. Run &quot;terraform init&quot; to install all
│ modules required by this configuration.
╵

aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt init
aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt plan

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # module.iam_group_with_policies_billing.aws_iam_group.this[0] will be created
  + resource &quot;aws_iam_group&quot; &quot;this&quot; {
      + arn       = (known after apply)
      + id        = (known after apply)
      + name      = &quot;billing&quot;
      + path      = &quot;/&quot;
      + unique_id = (known after apply)
    }

  # module.iam_group_with_policies_billing.aws_iam_group_membership.this[0] will be created
  + resource &quot;aws_iam_group_membership&quot; &quot;this&quot; {
      + group = (known after apply)
      + id    = (known after apply)
      + name  = &quot;billing&quot;
      + users = [
          + &quot;Accounting&quot;,
        ]
    }

  # module.iam_group_with_policies_billing.aws_iam_group_policy_attachment.custom_arns[0] will be created
  + resource &quot;aws_iam_group_policy_attachment&quot; &quot;custom_arns&quot; {
      + group      = (known after apply)
      + id         = (known after apply)
      + policy_arn = &quot;arn:aws:iam::aws:policy/AWSBillingConductorFullAccess&quot;
    }

  # module.iam_group_with_policies_billing.aws_iam_group_policy_attachment.iam_self_management[0] will be created
  + resource &quot;aws_iam_group_policy_attachment&quot; &quot;iam_self_management&quot; {
      + group      = (known after apply)
      + id         = (known after apply)
      + policy_arn = (known after apply)
    }

  # module.iam_group_with_policies_billing.aws_iam_policy.iam_self_management[0] will be created
  + resource &quot;aws_iam_policy&quot; &quot;iam_self_management&quot; {
      + arn         = (known after apply)
      + id          = (known after apply)
      + name        = (known after apply)
      + name_prefix = &quot;IAMSelfManagement-&quot;
      + path        = &quot;/&quot;
      + policy      = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + &quot;iam:UploadSigningCertificate&quot;,
                          + &quot;iam:UploadSSHPublicKey&quot;,
                          + &quot;iam:UpdateUser&quot;,
                          + &quot;iam:UpdateLoginProfile&quot;,
                          + &quot;iam:UpdateAccessKey&quot;,
                          + &quot;iam:ResyncMFADevice&quot;,
                          + &quot;iam:List*&quot;,
                          + &quot;iam:Get*&quot;,
                          + &quot;iam:GenerateServiceLastAccessedDetails&quot;,
                          + &quot;iam:GenerateCredentialReport&quot;,
                          + &quot;iam:EnableMFADevice&quot;,
                          + &quot;iam:DeleteVirtualMFADevice&quot;,
                          + &quot;iam:DeleteLoginProfile&quot;,
                          + &quot;iam:DeleteAccessKey&quot;,
                          + &quot;iam:CreateVirtualMFADevice&quot;,
                          + &quot;iam:CreateLoginProfile&quot;,
                          + &quot;iam:CreateAccessKey&quot;,
                          + &quot;iam:ChangePassword&quot;,
                        ]
                      + Effect   = &quot;Allow&quot;
                      + Resource = [
                          + &quot;arn:aws:iam::706136188012:user/*/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:user/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:mfa/${aws:username}&quot;,
                        ]
                      + Sid      = &quot;AllowSelfManagement&quot;
                    },
                  + {
                      + Action   = [
                          + &quot;iam:List*&quot;,
                          + &quot;iam:Get*&quot;,
                        ]
                      + Effect   = &quot;Allow&quot;
                      + Resource = &quot;*&quot;
                      + Sid      = &quot;AllowIAMReadOnly&quot;
                    },
                  + {
                      + Action    = &quot;iam:DeactivateMFADevice&quot;
                      + Condition = {
                          + Bool            = {
                              + &quot;aws:MultiFactorAuthPresent&quot; = &quot;true&quot;
                            }
                          + NumericLessThan = {
                              + &quot;aws:MultiFactorAuthAge&quot; = &quot;3600&quot;
                            }
                        }
                      + Effect    = &quot;Allow&quot;
                      + Resource  = [
                          + &quot;arn:aws:iam::706136188012:user/*/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:user/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:mfa/${aws:username}&quot;,
                        ]
                      + Sid       = &quot;AllowDeactivateMFADevice&quot;
                    },
                ]
              + Version   = &quot;2012-10-17&quot;
            }
        )
      + policy_id   = (known after apply)
      + tags_all    = (known after apply)
    }

  # module.iam_group_with_policies_full_access.aws_iam_group.this[0] will be created
  + resource &quot;aws_iam_group&quot; &quot;this&quot; {
      + arn       = (known after apply)
      + id        = (known after apply)
      + name      = &quot;full-access&quot;
      + path      = &quot;/&quot;
      + unique_id = (known after apply)
    }

  # module.iam_group_with_policies_full_access.aws_iam_group_membership.this[0] will be created
  + resource &quot;aws_iam_group_membership&quot; &quot;this&quot; {
      + group = (known after apply)
      + id    = (known after apply)
      + name  = &quot;full-access&quot;
      + users = [
          + &quot;Administrator&quot;,
        ]
    }

  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.custom_arns[0] will be created
  + resource &quot;aws_iam_group_policy_attachment&quot; &quot;custom_arns&quot; {
      + group      = (known after apply)
      + id         = (known after apply)
      + policy_arn = &quot;arn:aws:iam::aws:policy/AdministratorAccess&quot;
    }

  # module.iam_group_with_policies_full_access.aws_iam_group_policy_attachment.iam_self_management[0] will be created
  + resource &quot;aws_iam_group_policy_attachment&quot; &quot;iam_self_management&quot; {
      + group      = (known after apply)
      + id         = (known after apply)
      + policy_arn = (known after apply)
    }

  # module.iam_group_with_policies_full_access.aws_iam_policy.iam_self_management[0] will be created
  + resource &quot;aws_iam_policy&quot; &quot;iam_self_management&quot; {
      + arn         = (known after apply)
      + id          = (known after apply)
      + name        = (known after apply)
      + name_prefix = &quot;IAMSelfManagement-&quot;
      + path        = &quot;/&quot;
      + policy      = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + &quot;iam:UploadSigningCertificate&quot;,
                          + &quot;iam:UploadSSHPublicKey&quot;,
                          + &quot;iam:UpdateUser&quot;,
                          + &quot;iam:UpdateLoginProfile&quot;,
                          + &quot;iam:UpdateAccessKey&quot;,
                          + &quot;iam:ResyncMFADevice&quot;,
                          + &quot;iam:List*&quot;,
                          + &quot;iam:Get*&quot;,
                          + &quot;iam:GenerateServiceLastAccessedDetails&quot;,
                          + &quot;iam:GenerateCredentialReport&quot;,
                          + &quot;iam:EnableMFADevice&quot;,
                          + &quot;iam:DeleteVirtualMFADevice&quot;,
                          + &quot;iam:DeleteLoginProfile&quot;,
                          + &quot;iam:DeleteAccessKey&quot;,
                          + &quot;iam:CreateVirtualMFADevice&quot;,
                          + &quot;iam:CreateLoginProfile&quot;,
                          + &quot;iam:CreateAccessKey&quot;,
                          + &quot;iam:ChangePassword&quot;,
                        ]
                      + Effect   = &quot;Allow&quot;
                      + Resource = [
                          + &quot;arn:aws:iam::706136188012:user/*/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:user/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:mfa/${aws:username}&quot;,
                        ]
                      + Sid      = &quot;AllowSelfManagement&quot;
                    },
                  + {
                      + Action   = [
                          + &quot;iam:List*&quot;,
                          + &quot;iam:Get*&quot;,
                        ]
                      + Effect   = &quot;Allow&quot;
                      + Resource = &quot;*&quot;
                      + Sid      = &quot;AllowIAMReadOnly&quot;
                    },
                  + {
                      + Action    = &quot;iam:DeactivateMFADevice&quot;
                      + Condition = {
                          + Bool            = {
                              + &quot;aws:MultiFactorAuthPresent&quot; = &quot;true&quot;
                            }
                          + NumericLessThan = {
                              + &quot;aws:MultiFactorAuthAge&quot; = &quot;3600&quot;
                            }
                        }
                      + Effect    = &quot;Allow&quot;
                      + Resource  = [
                          + &quot;arn:aws:iam::706136188012:user/*/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:user/${aws:username}&quot;,
                          + &quot;arn:aws:iam::706136188012:mfa/${aws:username}&quot;,
                        ]
                      + Sid       = &quot;AllowDeactivateMFADevice&quot;
                    },
                ]
              + Version   = &quot;2012-10-17&quot;
            }
        )
      + policy_id   = (known after apply)
      + tags_all    = (known after apply)
    }

  # module.iam_user[&quot;Accounting&quot;].aws_iam_user.this[0] will be created
  + resource &quot;aws_iam_user&quot; &quot;this&quot; {
      + arn           = (known after apply)
      + force_destroy = false
      + id            = (known after apply)
      + name          = &quot;Accounting&quot;
      + path          = &quot;/&quot;
      + tags_all      = (known after apply)
      + unique_id     = (known after apply)
    }

Plan: 11 to add, 0 to change, 0 to destroy.

aws-vault exec terraform-30day-root-iam-user --no-session  --  terragrunt apply
</code></pre><p>眼尖的同學應該有注意到我們把 <code>create_login_profile = false</code> 先關掉</p><ul><li>因為我們還沒有準備 pgp key，這個又要明天再來了</li></ul><h3 id=todo-與進度>TODO 與進度<a hidden class=anchor aria-hidden=true href=#todo-與進度>#</a></h3><ul><li><input checked disabled type=checkbox> 透過 root account 設定一組 IAM User</li><li><input checked disabled type=checkbox> 透過 root account 設定多個 aws child accounts</li><li><input checked disabled type=checkbox> root 中設定 IAM User<ul><li><input checked disabled type=checkbox> 將手動產生的 Administrator 的 IAM User import terraform 中</li><li><input checked disabled type=checkbox> 補上 root account IAM Policy</li><li><input checked disabled type=checkbox> 補上 root account IAM Group</li></ul></li><li><input disabled type=checkbox> security 中設定 IAM User<ul><li><input disabled type=checkbox> security 設定 password policy</li><li><input disabled type=checkbox> security 設定 MFA policy</li></ul></li><li><input disabled type=checkbox> security 中設定 IAM Policy & Group</li><li><input disabled type=checkbox> dev 中設定 IAM role</li><li><input disabled type=checkbox> 允許 security assume dev IAM role</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://chechia.net/tags/terraform/>Terraform</a></li><li><a href=https://chechia.net/tags/iac/>Iac</a></li><li><a href=https://chechia.net/tags/aws/>Aws</a></li><li><a href=https://chechia.net/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD2022/>鐵人賽2022</a></li></ul><nav class=paginav><a class=prev href=https://chechia.net/posts/2022-09-18-14th-ithome-ironman-iac-aws-workshop-07-reset-iam-user/><span class=title>« Prev</span><br><span>Reset Iam User</span>
</a><a class=next href=https://chechia.net/posts/2022-09-16-14th-ithome-ironman-iac-aws-workshop-05-provision-iam-user/><span class=title>Next »</span><br><span>Provision Iam User</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on x" href="https://x.com/intent/tweet/?text=Provision%20Iam%20Group%20Policy&amp;url=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f&amp;hashtags=terraform%2ciac%2caws%2c%e9%90%b5%e4%ba%ba%e8%b3%bd2022"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f&amp;title=Provision%20Iam%20Group%20Policy&amp;summary=Provision%20Iam%20Group%20Policy&amp;source=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f&title=Provision%20Iam%20Group%20Policy"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on whatsapp" href="https://api.whatsapp.com/send?text=Provision%20Iam%20Group%20Policy%20-%20https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on telegram" href="https://telegram.me/share/url?text=Provision%20Iam%20Group%20Policy&amp;url=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Provision Iam Group Policy on ycombinator" href="https://news.ycombinator.com/submitlink?t=Provision%20Iam%20Group%20Policy&u=https%3a%2f%2fchechia.net%2fposts%2f2022-09-17-14th-ithome-ironman-iac-aws-workshop-06-provision-iam-group-policy%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://chechia.net/>Che-Chia Chang</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>