
<!DOCTYPE html>
<html
  lang="en"
  data-figures=""
  
    class="page"
  
  
  >
  <head>
<title>Blockchain Bep3 Atomic Swap | Che-Chia Chang</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169903302-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-169903302-1');
</script>



<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="BEP3 Atomic Swap Binance 在 BEP3: HTLC and Atomic Peg 提到，BEP 即將在 binance chain 上支援原生的 Hash Timer Locked Transfer (HTLT) ，這使跨鏈的原子性交換 (atomic swap) 變得可行，透過 HTLC 在兩 …" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@chechiachang">
<meta name="twitter:title" content="Blockchain Bep3 Atomic Swap" />
<meta name="twitter:image" content="https://chechia.net/images/logos/white_logo_dark_background.jpg"/>
<meta property="og:url" content="https://chechia.net/post/2019-10-22-blockchain-bep3-atomic-swap/" />
<meta property="og:title" content="Blockchain Bep3 Atomic Swap" />
<meta property="og:description" content="BEP3 Atomic Swap Binance 在 BEP3: HTLC and Atomic Peg 提到，BEP 即將在 binance chain 上支援原生的 Hash Timer Locked Transfer (HTLT) ，這使跨鏈的原子性交換 (atomic swap) 變得可行，透過 HTLC 在兩 …" />
<meta property="og:image" content="https://chechia.net/images/logos/white_logo_dark_background.jpg" />

<link rel="apple-touch-icon" sizes="180x180" href="https://chechia.net/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://chechia.net/icons/favicon-32x32.png">
<link rel="manifest" href="https://chechia.net/icons/site.webmanifest">

<link rel="canonical" href="https://chechia.net/post/2019-10-22-blockchain-bep3-atomic-swap/">



<link rel="preload" href="https://chechia.net/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity = "sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" as="style" crossorigin="anonymous">



<link rel="preload" href="https://chechia.net/en/js/bundle.6703cf5a19523ed401d8d9e012876ed46642e5b6019e567fb9fe7ad6f46ba535d6a1293fe06a8dfd091cf068a6f11fc605273b8b06177a6d0c09579ab0400cf5.js" as="script" integrity=
"sha512-ZwPPWhlSPtQB2NngEodu1GZC5bYBnlZ/uf561vRrpTXWoSk/4GqN/Qkc8Gim8R/GBSc7iwYXem0MCVeasEAM9Q==" crossorigin="anonymous">


<link rel="stylesheet" type="text/css" href="https://chechia.net/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity="sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" crossorigin="anonymous">


  </head>
  <body
    data-code="7"
    data-lines="false"
    id="documentTop"
    data-lang="en"
  >

<header class="nav_header" >
  <nav class="nav"><a href='https://chechia.net/' class="nav_brand nav_item" title="Che-Chia Chang">
  <img src="https://chechia.net/images/fav_79x79.jpg" class="logo" alt="Che-Chia Chang">
  <div class="nav_close">
    <div><svg class="icon">
  <title>open-menu</title>
  <use xlink:href="#open-menu"></use>
</svg>
<svg class="icon">
  <title>closeme</title>
  <use xlink:href="#closeme"></use>
</svg>
</div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://chechia.net/" class="nav_item" title="Home">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://chechia.net/" class="nav_item" title="DevOps">DevOps <img src='https://chechia.net/icons/caret-icon.svg' alt="icon" class="nav_icon"></a>
    <div class="nav_sub">
      <span class="nav_child"></span>
        <a href="https://chechia.net/post/2020-06-14-terraform-infrastructure-as-code" class="nav_child nav_item" title="[Terraform] 從零開始學">[Terraform] 從零開始學</a>
        <a href="https://ithelp.ithome.com.tw/articles/10258904" class="nav_child nav_item" title="[Terraform] 30 天公有雲範例">[Terraform] 30 天公有雲範例</a>
        <a href="https://chechia.net/post/2021-09-01-ithome-ironman-go/" class="nav_child nav_item" title="[Terraform] 2021 iThome 鐵人賽佳作文章">[Terraform] 2021 iThome 鐵人賽佳作文章</a>
    </div>
  </div>
  <div class="nav_parent">
    <a href="https://chechia.net/" class="nav_item" title="iThome 系列文">iThome 系列文 <img src='https://chechia.net/icons/caret-icon.svg' alt="icon" class="nav_icon"></a>
    <div class="nav_sub">
      <span class="nav_child"></span>
        <a href="https://chechia.net/post/2022-09-12-14th-ithome-ironman-iac-aws-workshop-01-introduction/" class="nav_child nav_item" title="2022 14th iThome 鐵人賽參賽WIP">2022 14th iThome 鐵人賽參賽WIP</a>
        <a href="https://chechia.net/post/2021-09-01-ithome-ironman-go/" class="nav_child nav_item" title="2021 13th iThome 鐵人賽佳作文章">2021 13th iThome 鐵人賽佳作文章</a>
        <a href="https://chechia.net/post/2020-09-09-ithome-ironman-challenge/" class="nav_child nav_item" title="2020 12th iThome 鐵人賽佳作文章">2020 12th iThome 鐵人賽佳作文章</a>
        <a href="https://chechia.net/post/2019-09-09-ithome-ironman-challenge/" class="nav_child nav_item" title="2019 11th iThome 鐵人賽優勝文章">2019 11th iThome 鐵人賽優勝文章</a>
    </div>
  </div>
  <div class="nav_parent">
    <a href="https://www.instagram.com/c.c.leather/" class="nav_item" title="Leather Craft">Leather Craft </a>
  </div>
  <div class="nav_parent">
    <a href="https://www.instagram.com/dive.with.cat.coach/" class="nav_item" title="Scuba Diving">Scuba Diving </a>
  </div>
  <div class="nav_parent">
    <a href="https://chechia.net/about/" class="nav_item" title="About">About </a>
  </div>
      
<div class='follow'>
    
    
  <a href="https://www.facebook.com/engineer.from.scratch">
    <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

  </a>
    
    
  <a href="https://github.com/chechiachang">
    <svg class="icon">
  <title>github</title>
  <use xlink:href="#github"></use>
</svg>

  </a>
    
    
  <a href="https://twitter.com/chechiachang">
    <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

  </a>
    
    
  <a href="https://www.linkedin.com/in/che-chia-chang-92194a4a/">
    <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Blockchain Bep3 Atomic Swap</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <title>calendar</title>
  <use xlink:href="#calendar"></use>
</svg>
</span>
    <span class="post_date">
      Oct 22, 2019</span>
    <span class="post_time"> · 15 min read</span><span>&nbsp;· <a href='https://chechia.net/tags/blockchain/' title="blockchain" class="post_tag button button_translucent">blockchain
        </a><a href='https://chechia.net/tags/bep3/' title="bep3" class="post_tag button button_translucent">bep3
        </a><a href='https://chechia.net/tags/binance/' title="binance" class="post_tag button button_translucent">binance
        </a><a href='https://chechia.net/tags/ethereum/' title="ethereum" class="post_tag button button_translucent">ethereum
        </a><a href='https://chechia.net/tags/erc-20/' title="erc-20" class="post_tag button button_translucent">erc-20
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Blockchain%20Bep3%20Atomic%20Swap&url=https%3a%2f%2fchechia.net%2fpost%2f2019-10-22-blockchain-bep3-atomic-swap%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fchechia.net%2fpost%2f2019-10-22-blockchain-bep3-atomic-swap%2f&t=Blockchain%20Bep3%20Atomic%20Swap" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

    </a>
    <a href="https://chechia.net/post/2019-10-22-blockchain-bep3-atomic-swap/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <title>copy</title>
  <use xlink:href="#copy"></use>
</svg>

    </a>
  </div>
  </span>
  </div>

    <div class="post_body"><h1 id="bep3-atomic-swap">BEP3 Atomic Swap</h1>
<p>Binance 在 <a href="https://github.com/binance-chain/BEPs/blob/master/BEP3.md">BEP3: HTLC and Atomic Peg</a> 提到，BEP 即將在 binance chain 上支援原生的 Hash Timer Locked Transfer (HTLT) ，這使跨鏈的原子性交換 (atomic swap) 變得可行，透過 HTLC 在兩邊的鏈上鎖住 (peg) tokens，然後只有在執行交換的時候，透過 hash 交換，一次執行雙邊的交易。</p>
<p>關於 Atomic Swap 網路有非常多的訊息，有興趣的話可以看<a href="https://en.bitcoin.it/wiki/Atomic_swap">這篇</a></p>
<ul>
<li>交易只有在雙邊完成後才完成，完成之前不能動用交換的資產</li>
<li>在任何階段失效都可以完全 fallback，並進行 refund</li>
<li>交易的認證是去中心化的
<ul>
<li>這邊有個但書，Ethereum 上是透過 smart contract 實現，但 Binance chain 上還是靠 Binance 認證 XD</li>
</ul>
</li>
</ul>
<p>Binance 在 BEP3 中支援 HTLC，我們這邊主要的資訊來源是 binance.org 的<a href="https://docs.binance.org/atomic-swap.html">官方說明文件</a>，這邊針對文章進行驗證，並且補足文件缺漏的部分，提醒過程中可能會踩到的雷。</p>
<h3 id="跨鍊cross-chain-交易">跨鍊(Cross Chain) 交易</h3>
<p>在部署 asset / token 的時候，我們會選擇合適的鏈作為發布資產並運行 block chain app。常用的應用鏈如 ethereum 與 binance chain 等等。不同的主鏈上有各自的優缺點，例如使用 ethereum ，可以與許多 token 與應用互動，也是最多人使用的應用主鏈。而在 binance 鏈上執行，則能夠快速的發生 transactions，並且可以與 binance 上的資產與交易所互動。</p>
<p>在某些應用場景，我們會希望兩個獨立主鏈上的資產能後互動，例如在 binance chain 上執行快速的 transaction，然而也要使用 etheruem 上既有的 ERC-20 tokens，這時便需要一個溝通兩條鏈的機制。</p>
<h3 id="文章分為三個部分">文章分為三個部分</h3>
<ul>
<li><!-- raw HTML omitted -->在 Binance Chain 上互換兩個 address 的 binance asset<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->從 ethereum token 到 binance<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->從 binance chain 到 ethereum<!-- raw HTML omitted --></li>
</ul>
<hr>
<h3 id="swap-on-binance-chain">Atomic Swap on Binance Chain</h3>
<p>我們今天會實作 Atomic Peg Swap，透過 HTLT 鎖住 Binance Chain 上兩個 address 的資產，並進行原子性的一次交易，來達成鏈上的資產互換。這邊直接使用 binance 提供的 bnbcli 來執行。</p>
<h3 id="使用情境">使用情境</h3>
<p>兩個在 Binance Chain 上的 address 想交換資產</p>
<ul>
<li>Client: HTLT 的發起方，擁有一部分 asset，發起 HTLT 希望執行資產互換</li>
<li>Recipient: HTLT 的收受方，收到 HTLT，需要於時限內 deposit 指定數量的資產到 swap 中</li>
</ul>
<h3 id="服務元件">服務元件</h3>
<ul>
<li>HTLT transactions on binance chain: 來鎖住並 claim assets</li>
<li>Client tooling: tbnbcli 讓客戶可以操作，監測鏈上 swap 的狀況</li>
</ul>
<h3 id="流程">流程</h3>
<ol>
<li>Client 使用 tbnbcli 發起 HTLT</li>
<li>Recipient 收到發起方送來的 swap info 與 asset (frozen)</li>
<li>Recipient Deposit 指定數量的 asset 到 swap 中</li>
<li>Binance Chain 自動完成 swap，完成交換，解鎖兩邊交換的資產</li>
</ol>
<h3 id="取得-tbnbcli">取得 tbnbcli</h3>
<p><a href="https://docs.binance.org/api-reference/cli.html">tbnbcli 的說明文件</a></p>
<p>由於 bnbcli repo 中使用 Git Large File Storage 來存放 binary，這邊要啟用 git-lfs 來下載 binary</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl"># Mac port
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo port install git-lfs
</span></span></code></pre></div><p>Git clone repo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">git clone git@github.com:binance-chain/node-binary.git
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nb">cd</span> node-binary
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl">git chechout v0.6.2
</span></span><span class="line"><span class="ln">5</span><span class="cl">git lfs pull --include cli/testnet/0.6.2/mac/tbnbcli
</span></span><span class="line"><span class="ln">6</span><span class="cl">sudo copy cli/testnet/0.6.2/mac/tbnbcli /usr/local/bin
</span></span></code></pre></div><p>這邊要注意使用 v0.6.2+ 的版本，不然會沒有 HTLT 的 subcommands</p>
<h3 id="測試-tbnbcli">測試 tbnbcli</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">tbnbcli status --node http://data-seed-pre-0-s3.binance.org:80
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	<span class="s2">&#34;node_info&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">		<span class="s2">&#34;protocol_version&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">			<span class="s2">&#34;p2p&#34;</span>: <span class="s2">&#34;7&#34;</span>,
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">			<span class="s2">&#34;block&#34;</span>: <span class="s2">&#34;10&#34;</span>,
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">			<span class="s2">&#34;app&#34;</span>: <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="o">}</span>,
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;34ac6eb6cd914014995b5929be8d7bc9c16f724d&#34;</span>,
</span></span><span class="line"><span class="ln">11</span><span class="cl">		<span class="s2">&#34;listen_addr&#34;</span>: <span class="s2">&#34;aa13359cd244f11e988520ad55ba7f5a-c3963b80c9b991b7.elb.us-east-1.amazonaws.com:27146&#34;</span>,
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="s2">&#34;network&#34;</span>: <span class="s2">&#34;Binance-Chain-Nile&#34;</span>,
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;0.31.5&#34;</span>,
</span></span><span class="line"><span class="ln">14</span><span class="cl">		<span class="s2">&#34;channels&#34;</span>: <span class="s2">&#34;36402021222330380041&#34;</span>,
</span></span><span class="line"><span class="ln">15</span><span class="cl">		<span class="s2">&#34;moniker&#34;</span>: <span class="s2">&#34;data-seed-0&#34;</span>,
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="s2">&#34;other&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="s2">&#34;tx_index&#34;</span>: <span class="s2">&#34;on&#34;</span>,
</span></span><span class="line"><span class="ln">18</span><span class="cl">			<span class="s2">&#34;rpc_address&#34;</span>: <span class="s2">&#34;tcp://0.0.0.0:27147&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">	<span class="o">}</span>,
</span></span><span class="line"><span class="ln">21</span><span class="cl">	<span class="s2">&#34;sync_info&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="s2">&#34;latest_block_hash&#34;</span>: <span class="s2">&#34;359AD9BF36B7DEEB069A86D53D3B65D9F4BB77A1A65E40E1289B5798D4C1094F&#34;</span>,
</span></span><span class="line"><span class="ln">23</span><span class="cl">		<span class="s2">&#34;latest_app_hash&#34;</span>: <span class="s2">&#34;E748CFA5806B587D9678F55DFDDB336E3669CDF421191CDA6D2DF8AA7A3461F3&#34;</span>,
</span></span><span class="line"><span class="ln">24</span><span class="cl">		<span class="s2">&#34;latest_block_height&#34;</span>: <span class="s2">&#34;45868456&#34;</span>,
</span></span><span class="line"><span class="ln">25</span><span class="cl">		<span class="s2">&#34;latest_block_time&#34;</span>: <span class="s2">&#34;2019-10-23T07:36:38.176957281Z&#34;</span>,
</span></span><span class="line"><span class="ln">26</span><span class="cl">		<span class="s2">&#34;catching_up&#34;</span>: <span class="nb">false</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">	<span class="o">}</span>,
</span></span><span class="line"><span class="ln">28</span><span class="cl">	<span class="s2">&#34;validator_info&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">		<span class="s2">&#34;address&#34;</span>: <span class="s2">&#34;1C360E22E04035E22A71A3765E4A8C5A6D586132&#34;</span>,
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="s2">&#34;pub_key&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">			<span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;tendermint/PubKeyEd25519&#34;</span>,
</span></span><span class="line"><span class="ln">32</span><span class="cl">			<span class="s2">&#34;value&#34;</span>: <span class="s2">&#34;T56yDoH+B+OY8PP2tmeFtJtk+9ftnBUVHykKfLS45Es=&#34;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">		<span class="o">}</span>,
</span></span><span class="line"><span class="ln">34</span><span class="cl">		<span class="s2">&#34;voting_power&#34;</span>: <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="acquire-valid-binance-testnet-account">Acquire Valid Binance Testnet Account</h3>
<p>Check <a href="https://www.binance.com/en/support/articles/360023912272">Testnet Doc</a></p>
<ul>
<li>Go to <a href="https://testnet.binance.org/en/">Binance Testnet</a></li>
<li>Create a wallet</li>
<li>Save address, mn, keystore, private key</li>
<li>Use <a href="https://www.binance.vision/tutorials/binance-dex-funding-your-testnet-account">testnet faucet</a> to fund testnet account</li>
<li>Receive 200 BNB on testnet</li>
</ul>
<hr>
<h3 id="client-create-htlt">Client Create HTLT</h3>
<p>這邊使用簡單的範例，鎖住兩個 BEP2 tokens 來進行交換，展示一下 tbnbcli 的 HTLT</p>
<p>準備兩個 address，這邊是我自己的兩個 testnet address</p>
<ul>
<li>tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p (179 BNB) <a href="https://testnet-explorer.binance.org/address/tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p">Explorer 上查看</a></li>
<li>tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce (20 BNB) <a href="https://testnet-explorer.binance.org/address/tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce">Exporler 上查看</a></li>
</ul>
<p>目標：</p>
<ul>
<li>HTLT</li>
<li>tbnb&hellip;j9p -&gt; 0.3 BNB -&gt; tbnb&hellip;7ce</li>
<li>tbnb&hellip;j9p &lt;- 0.1 BNB &lt;- tbnb&hellip;7ce</li>
</ul>
<p>tbnbcli 執行 HTLT，從 from address 執行 HTLT，給 recipient-addr 0.3 BNB，並預期對方回 0.1 BNB，等待 height-span 個 block 時間(360 &gt; 2 minutes)</p>
<h3 id="tbnbcli-key">tbnbcli key</h3>
<p>實際執行前，由於我們需要透過 tbnbcli 操作 from-address，要先<a href="https://docs.binance.org/keys.html">透過 tbnbcli 把 address 的 key 加進到本地</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli keys add tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce --recover
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">tbnbcli keys list
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">NAME:	                                      TYPE:	ADDRESS:						                        PUBKEY:
</span></span><span class="line"><span class="ln">6</span><span class="cl">tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	<span class="nb">local</span>	tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	bnbp1addwnpepq0pw06d3y7ykg2j33pc604j3awgqgl5vhd88wdjhjg5sptnsfpqyx2rmhl4
</span></span></code></pre></div><h3 id="實際執行">實際執行</h3>
<p>參數：</p>
<ul>
<li>
<p>FROM ADDR: tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p</p>
</li>
<li>
<p>RECIPIENT ADDR: tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce</p>
</li>
<li>
<p>hightspan: 3600，height-span 是發起 HTLT，受方 deposit，發起方去 claim 的時限。</p>
</li>
<li>
<p>amount: asset * 10^8</p>
</li>
<li>
<p>tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p 執行 HTLT</p>
</li>
<li>
<p>給 tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce 0.3 BNB</p>
</li>
<li>
<p>預期對方回 0.1 BNB</p>
</li>
<li>
<p>等待 3600 個 block 時間</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nv">FROM_ADDR</span><span class="o">=</span>tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nv">RECIPIENT_ADDR</span><span class="o">=</span>tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nv">HEIGHT_SPAN</span><span class="o">=</span><span class="m">3600</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">tbnbcli token HTLT <span class="se">\
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="se"></span>  --recipient-addr <span class="si">${</span><span class="nv">RECIPIENT_ADDR</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="se"></span>  --amount 30000000:BNB <span class="se">\
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="se"></span>  --expected-income 10000000:BNB <span class="se">\
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="se"></span>  --height-span <span class="si">${</span><span class="nv">HEIGHT_SPAN</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="se"></span>  --from <span class="si">${</span><span class="nv">FROM_ADDR</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>產生 swap 的結果，可以於<a href="https://testnet-explorer.binance.org/tx/8F865C5C9E5CD06239DE99746BCE73AACA2F3AD881C26765FB90C9465EF06EF0">Testnet Explorer 上看到</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">Committed at block <span class="m">47218942</span> <span class="o">(</span>tx hash: 8F865C5C9E5CD06239DE99746BCE73AACA2F3AD881C26765FB90C9465EF06EF0, response: <span class="o">{</span>Code:0 Data:<span class="o">[</span><span class="m">77</span> <span class="m">138</span> <span class="m">29</span> <span class="m">51</span> <span class="m">186</span> <span class="m">65</span> <span class="m">213</span> <span class="m">125</span> <span class="m">105</span> <span class="m">217</span> <span class="m">5</span> <span class="m">102</span> <span class="m">170</span> <span class="m">194</span> <span class="m">248</span> <span class="m">149</span> <span class="m">189</span> <span class="m">188</span> <span class="m">56</span> <span class="m">208</span> <span class="m">166</span> <span class="m">93</span> <span class="m">48</span> <span class="m">159</span> <span class="m">188</span> <span class="m">196</span> <span class="m">143</span> <span class="m">111</span> <span class="m">31</span> <span class="m">66</span> <span class="m">151</span> 249<span class="o">]</span> Log:Msg 0: swapID: 4d8a1d33ba41d57d69d90566aac2f895bdbc38d0a65d309fbcc48f6f1f4297f9 Info: GasWanted:0 GasUsed:0 Tags:<span class="o">[{</span>Key:<span class="o">[</span><span class="m">115</span> <span class="m">101</span> <span class="m">110</span> <span class="m">100</span> <span class="m">101</span> 114<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">104</span> <span class="m">113</span> <span class="m">54</span> <span class="m">118</span> <span class="m">52</span> <span class="m">57</span> <span class="m">97</span> <span class="m">110</span> <span class="m">51</span> <span class="m">119</span> <span class="m">119</span> <span class="m">104</span> <span class="m">114</span> <span class="m">100</span> <span class="m">56</span> <span class="m">110</span> <span class="m">121</span> <span class="m">55</span> <span class="m">113</span> <span class="m">106</span> <span class="m">51</span> <span class="m">101</span> <span class="m">120</span> <span class="m">103</span> <span class="m">102</span> <span class="m">109</span> <span class="m">118</span> <span class="m">112</span> <span class="m">118</span> <span class="m">117</span> <span class="m">101</span> <span class="m">108</span> <span class="m">107</span> <span class="m">99</span> <span class="m">97</span> <span class="m">106</span> <span class="m">57</span> 112<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">114</span> <span class="m">101</span> <span class="m">99</span> <span class="m">105</span> <span class="m">112</span> <span class="m">105</span> <span class="m">101</span> <span class="m">110</span> 116<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">119</span> <span class="m">120</span> <span class="m">101</span> <span class="m">112</span> <span class="m">108</span> <span class="m">121</span> <span class="m">119</span> <span class="m">55</span> <span class="m">120</span> <span class="m">56</span> <span class="m">97</span> <span class="m">97</span> <span class="m">104</span> <span class="m">121</span> <span class="m">57</span> <span class="m">51</span> <span class="m">119</span> <span class="m">57</span> <span class="m">54</span> <span class="m">121</span> <span class="m">104</span> <span class="m">119</span> <span class="m">109</span> <span class="m">55</span> <span class="m">120</span> <span class="m">99</span> <span class="m">113</span> <span class="m">51</span> <span class="m">107</span> <span class="m">101</span> <span class="m">52</span> <span class="m">102</span> <span class="m">102</span> <span class="m">97</span> <span class="m">115</span> <span class="m">112</span> <span class="m">51</span> 100<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">97</span> <span class="m">99</span> <span class="m">116</span> <span class="m">105</span> <span class="m">111</span> 110<span class="o">]</span> Value:<span class="o">[</span><span class="m">72</span> <span class="m">84</span> <span class="m">76</span> 84<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}]</span> Codespace: XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">})</span>
</span></span></code></pre></div><h3 id="query-atomic-swap">Query Atomic Swap</h3>
<p>產生了 atomic swap，這邊可以使用 tbnbcli 查詢 swap 的狀態</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="nv">SWAP_ID</span><span class="o">=</span>4d8a1d33ba41d57d69d90566aac2f895bdbc38d0a65d309fbcc48f6f1f4297f9
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">tbnbcli token query-swap <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --swap-id <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>回傳 swap 的狀態</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">{</span><span class="nt">&#34;from&#34;</span><span class="p">:</span><span class="s2">&#34;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&#34;</span><span class="p">,</span><span class="nt">&#34;to&#34;</span><span class="p">:</span><span class="s2">&#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34;</span><span class="p">,</span><span class="nt">&#34;out_amount&#34;</span><span class="p">:[{</span><span class="nt">&#34;denom&#34;</span><span class="p">:</span><span class="s2">&#34;BNB&#34;</span><span class="p">,</span><span class="nt">&#34;amount&#34;</span><span class="p">:</span><span class="s2">&#34;30000000&#34;</span><span class="p">}],</span><span class="nt">&#34;in_amount&#34;</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="nt">&#34;expected_income&#34;</span><span class="p">:</span><span class="s2">&#34;10000000:BNB&#34;</span><span class="p">,</span><span class="nt">&#34;recipient_other_chain&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nt">&#34;random_number_hash&#34;</span><span class="p">:</span><span class="s2">&#34;4cf88f1acf8bcbc628609f3257406913f67e009e5c61f2671b601e40f4e5cc6a&#34;</span><span class="p">,</span><span class="nt">&#34;random_number&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nt">&#34;timestamp&#34;</span><span class="p">:</span><span class="s2">&#34;1572506189&#34;</span><span class="p">,</span><span class="nt">&#34;cross_chain&#34;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">&#34;expire_height&#34;</span><span class="p">:</span><span class="s2">&#34;47222542&#34;</span><span class="p">,</span><span class="nt">&#34;index&#34;</span><span class="p">:</span><span class="s2">&#34;2254&#34;</span><span class="p">,</span><span class="nt">&#34;closed_time&#34;</span><span class="p">:</span><span class="s2">&#34;0&#34;</span><span class="p">,</span><span class="nt">&#34;status&#34;</span><span class="p">:</span><span class="s2">&#34;Open&#34;</span><span class="p">}</span>
</span></span></code></pre></div><h3 id="deposit-htlt">Deposit HTLT</h3>
<p>受方 reciept-address 這邊要把 1 BNB 打進去 swap 中</p>
<p>注意這邊的 from-address 已經變成當初的 recipient-addr tbnb&hellip;j9p</p>
<p>當然這邊要存取，也要有 tbnb&hellip;j9p 的 key，這樣我們本地就會有發受兩方的 key，但一般來說應該是兩個不同的人</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli keys add tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p--recover
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">tbnbcli keys list
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">NAME:	                                      TYPE:	ADDRESS:						                        PUBKEY:
</span></span><span class="line"><span class="ln">6</span><span class="cl">tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	<span class="nb">local</span>	tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce	bnbp1addwnpepq0pw06d3y7ykg2j33pc604j3awgqgl5vhd88wdjhjg5sptnsfpqyx2rmhl4
</span></span><span class="line"><span class="ln">7</span><span class="cl">tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p	<span class="nb">local</span>	tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p	bnbp1addwnpepqwk5zx3jnrq5guxc9tsgrte9aw9knla0ahunwynypkm0jvst6y7l2q83ueq
</span></span></code></pre></div><p>受方把約好的錢存進去</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token deposit <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --swap-id <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span>  <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --amount 10000000:BNB <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --from <span class="si">${</span><span class="nv">RECIPIENT_ADDR</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>可以成功 deposit，<a href="https://testnet-explorer.binance.org/tx/FDCC528B9F98E9CEEDCB113A398A747F440666061340535D44C526D79F9CD667">檢查這次 tx Deposit swap 的內容</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">Password to sign with <span class="s1">&#39;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#39;</span>:
</span></span><span class="line"><span class="ln">2</span><span class="cl">Committed at block <span class="m">47219070</span> <span class="o">(</span>tx hash: FDCC528B9F98E9CEEDCB113A398A747F440666061340535D44C526D79F9CD667, response: <span class="o">{</span>Code:0 Data:<span class="o">[]</span> Log:Msg 0:  Info: GasWanted:0 GasUsed:0 Tags:<span class="o">[{</span>Key:<span class="o">[</span><span class="m">115</span> <span class="m">101</span> <span class="m">110</span> <span class="m">100</span> <span class="m">101</span> 114<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">97</span> <span class="m">54</span> <span class="m">112</span> <span class="m">118</span> <span class="m">53</span> <span class="m">103</span> <span class="m">109</span> <span class="m">110</span> <span class="m">115</span> <span class="m">97</span> <span class="m">121</span> <span class="m">52</span> <span class="m">97</span> <span class="m">57</span> <span class="m">115</span> <span class="m">114</span> <span class="m">55</span> <span class="m">110</span> <span class="m">118</span> <span class="m">100</span> <span class="m">48</span> <span class="m">109</span> <span class="m">108</span> <span class="m">100</span> <span class="m">122</span> <span class="m">50</span> <span class="m">57</span> <span class="m">97</span> <span class="m">54</span> <span class="m">107</span> <span class="m">100</span> <span class="m">120</span> <span class="m">121</span> <span class="m">101</span> <span class="m">51</span> <span class="m">55</span> <span class="m">99</span> 101<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">114</span> <span class="m">101</span> <span class="m">99</span> <span class="m">105</span> <span class="m">112</span> <span class="m">105</span> <span class="m">101</span> <span class="m">110</span> 116<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">119</span> <span class="m">120</span> <span class="m">101</span> <span class="m">112</span> <span class="m">108</span> <span class="m">121</span> <span class="m">119</span> <span class="m">55</span> <span class="m">120</span> <span class="m">56</span> <span class="m">97</span> <span class="m">97</span> <span class="m">104</span> <span class="m">121</span> <span class="m">57</span> <span class="m">51</span> <span class="m">119</span> <span class="m">57</span> <span class="m">54</span> <span class="m">121</span> <span class="m">104</span> <span class="m">119</span> <span class="m">109</span> <span class="m">55</span> <span class="m">120</span> <span class="m">99</span> <span class="m">113</span> <span class="m">51</span> <span class="m">107</span> <span class="m">101</span> <span class="m">52</span> <span class="m">102</span> <span class="m">102</span> <span class="m">97</span> <span class="m">115</span> <span class="m">112</span> <span class="m">51</span> 100<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">97</span> <span class="m">99</span> <span class="m">116</span> <span class="m">105</span> <span class="m">111</span> 110<span class="o">]</span> Value:<span class="o">[</span><span class="m">100</span> <span class="m">101</span> <span class="m">112</span> <span class="m">111</span> <span class="m">115</span> <span class="m">105</span> <span class="m">116</span> <span class="m">72</span> <span class="m">84</span> <span class="m">76</span> 84<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}]</span> Codespace: XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">})</span>
</span></span></code></pre></div><h3 id="發起方-claim-htlt">發起方 Claim HTLT</h3>
<p>針對每筆 HTLT ，解鎖鎖住的 assets。每個 HTLT 只能被解鎖一次。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token claim <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --swap-id  <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --random-number <span class="si">${</span><span class="nv">RANDOM_NUMBER</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --from <span class="si">${</span><span class="nv">FROM_ADDR</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>可以成功 claim，<a href="https://testnet-explorer.binance.org/tx/D08F81D0315F0A7B13E510782F6E56804803B5198F4914C8EB10E3A5084F2BAA">檢查這次 tx Deposit swap 的內容</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">Password to sign with <span class="s1">&#39;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&#39;</span>:
</span></span><span class="line"><span class="ln">2</span><span class="cl">Committed at block <span class="m">47219128</span> <span class="o">(</span>tx hash: D08F81D0315F0A7B13E510782F6E56804803B5198F4914C8EB10E3A5084F2BAA, response: <span class="o">{</span>Code:0 Data:<span class="o">[]</span> Log:Msg 0:  Info: GasWanted:0 GasUsed:0 Tags:<span class="o">[{</span>Key:<span class="o">[</span><span class="m">115</span> <span class="m">101</span> <span class="m">110</span> <span class="m">100</span> <span class="m">101</span> 114<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">119</span> <span class="m">120</span> <span class="m">101</span> <span class="m">112</span> <span class="m">108</span> <span class="m">121</span> <span class="m">119</span> <span class="m">55</span> <span class="m">120</span> <span class="m">56</span> <span class="m">97</span> <span class="m">97</span> <span class="m">104</span> <span class="m">121</span> <span class="m">57</span> <span class="m">51</span> <span class="m">119</span> <span class="m">57</span> <span class="m">54</span> <span class="m">121</span> <span class="m">104</span> <span class="m">119</span> <span class="m">109</span> <span class="m">55</span> <span class="m">120</span> <span class="m">99</span> <span class="m">113</span> <span class="m">51</span> <span class="m">107</span> <span class="m">101</span> <span class="m">52</span> <span class="m">102</span> <span class="m">102</span> <span class="m">97</span> <span class="m">115</span> <span class="m">112</span> <span class="m">51</span> 100<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">114</span> <span class="m">101</span> <span class="m">99</span> <span class="m">105</span> <span class="m">112</span> <span class="m">105</span> <span class="m">101</span> <span class="m">110</span> 116<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">97</span> <span class="m">54</span> <span class="m">112</span> <span class="m">118</span> <span class="m">53</span> <span class="m">103</span> <span class="m">109</span> <span class="m">110</span> <span class="m">115</span> <span class="m">97</span> <span class="m">121</span> <span class="m">52</span> <span class="m">97</span> <span class="m">57</span> <span class="m">115</span> <span class="m">114</span> <span class="m">55</span> <span class="m">110</span> <span class="m">118</span> <span class="m">100</span> <span class="m">48</span> <span class="m">109</span> <span class="m">108</span> <span class="m">100</span> <span class="m">122</span> <span class="m">50</span> <span class="m">57</span> <span class="m">97</span> <span class="m">54</span> <span class="m">107</span> <span class="m">100</span> <span class="m">120</span> <span class="m">121</span> <span class="m">101</span> <span class="m">51</span> <span class="m">55</span> <span class="m">99</span> 101<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">115</span> <span class="m">101</span> <span class="m">110</span> <span class="m">100</span> <span class="m">101</span> 114<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">119</span> <span class="m">120</span> <span class="m">101</span> <span class="m">112</span> <span class="m">108</span> <span class="m">121</span> <span class="m">119</span> <span class="m">55</span> <span class="m">120</span> <span class="m">56</span> <span class="m">97</span> <span class="m">97</span> <span class="m">104</span> <span class="m">121</span> <span class="m">57</span> <span class="m">51</span> <span class="m">119</span> <span class="m">57</span> <span class="m">54</span> <span class="m">121</span> <span class="m">104</span> <span class="m">119</span> <span class="m">109</span> <span class="m">55</span> <span class="m">120</span> <span class="m">99</span> <span class="m">113</span> <span class="m">51</span> <span class="m">107</span> <span class="m">101</span> <span class="m">52</span> <span class="m">102</span> <span class="m">102</span> <span class="m">97</span> <span class="m">115</span> <span class="m">112</span> <span class="m">51</span> 100<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">114</span> <span class="m">101</span> <span class="m">99</span> <span class="m">105</span> <span class="m">112</span> <span class="m">105</span> <span class="m">101</span> <span class="m">110</span> 116<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">104</span> <span class="m">113</span> <span class="m">54</span> <span class="m">118</span> <span class="m">52</span> <span class="m">57</span> <span class="m">97</span> <span class="m">110</span> <span class="m">51</span> <span class="m">119</span> <span class="m">119</span> <span class="m">104</span> <span class="m">114</span> <span class="m">100</span> <span class="m">56</span> <span class="m">110</span> <span class="m">121</span> <span class="m">55</span> <span class="m">113</span> <span class="m">106</span> <span class="m">51</span> <span class="m">101</span> <span class="m">120</span> <span class="m">103</span> <span class="m">102</span> <span class="m">109</span> <span class="m">118</span> <span class="m">112</span> <span class="m">118</span> <span class="m">117</span> <span class="m">101</span> <span class="m">108</span> <span class="m">107</span> <span class="m">99</span> <span class="m">97</span> <span class="m">106</span> <span class="m">57</span> 112<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">97</span> <span class="m">99</span> <span class="m">116</span> <span class="m">105</span> <span class="m">111</span> 110<span class="o">]</span> Value:<span class="o">[</span><span class="m">99</span> <span class="m">108</span> <span class="m">97</span> <span class="m">105</span> <span class="m">109</span> <span class="m">72</span> <span class="m">84</span> <span class="m">76</span> 84<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}]</span> Codespace: XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">})</span>
</span></span></code></pre></div><h3 id="查詢-swap-狀態">查詢 swap 狀態</h3>
<p>從 open 變成 completed</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token query-swap <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --swap-id <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">{</span><span class="nt">&#34;from&#34;</span><span class="p">:</span><span class="s2">&#34;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&#34;</span><span class="p">,</span><span class="nt">&#34;to&#34;</span><span class="p">:</span><span class="s2">&#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34;</span><span class="p">,</span><span class="nt">&#34;out_amount&#34;</span><span class="p">:[{</span><span class="nt">&#34;denom&#34;</span><span class="p">:</span><span class="s2">&#34;BNB&#34;</span><span class="p">,</span><span class="nt">&#34;amount&#34;</span><span class="p">:</span><span class="s2">&#34;30000000&#34;</span><span class="p">}],</span><span class="nt">&#34;in_amount&#34;</span><span class="p">:[{</span><span class="nt">&#34;denom&#34;</span><span class="p">:</span><span class="s2">&#34;BNB&#34;</span><span class="p">,</span><span class="nt">&#34;amount&#34;</span><span class="p">:</span><span class="s2">&#34;10000000&#34;</span><span class="p">}],</span><span class="nt">&#34;expected_income&#34;</span><span class="p">:</span><span class="s2">&#34;10000000:BNB&#34;</span><span class="p">,</span><span class="nt">&#34;recipient_other_chain&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nt">&#34;random_number_hash&#34;</span><span class="p">:</span><span class="s2">&#34;4cf88f1acf8bcbc628609f3257406913f67e009e5c61f2671b601e40f4e5cc6a&#34;</span><span class="p">,</span><span class="nt">&#34;random_number&#34;</span><span class="p">:</span><span class="s2">&#34;cb5f6296078fd73b86d03eb58bc8a6e0af8d4b60c1cd678b71f8c185e206db53&#34;</span><span class="p">,</span><span class="nt">&#34;timestamp&#34;</span><span class="p">:</span><span class="s2">&#34;1572506189&#34;</span><span class="p">,</span><span class="nt">&#34;cross_chain&#34;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">&#34;expire_height&#34;</span><span class="p">:</span><span class="s2">&#34;47222542&#34;</span><span class="p">,</span><span class="nt">&#34;index&#34;</span><span class="p">:</span><span class="s2">&#34;2254&#34;</span><span class="p">,</span><span class="nt">&#34;closed_time&#34;</span><span class="p">:</span><span class="s2">&#34;1572506323&#34;</span><span class="p">,</span><span class="nt">&#34;status&#34;</span><span class="p">:</span><span class="s2">&#34;Completed&#34;</span><span class="p">}</span>
</span></span></code></pre></div><p>這樣 swap 就完成了</p>
<h3 id="超時-expired-處理">超時 (Expired) 處理</h3>
<p>由於 HTLT 是有時間限制，有可能會超時，會無法繼續操作，例如另外一筆 HTLT 在受方 deposit 時無法 deposit</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token deposit <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --swap-id <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span>  <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --amount 1:BNB <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --from <span class="si">${</span><span class="nv">RECIPIENT_ADDR</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln">1</span><span class="cl"><span class="err">ERROR:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="nt">&#34;codespace&#34;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="nt">&#34;code&#34;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nt">&#34;abci_code&#34;</span><span class="p">:</span><span class="mi">524302</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span><span class="s2">&#34;Current block height is 46046996, the swap expire height(46043293) is passed&#34;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>超過 swap block height 了，受方這邊逾時去存錢，導致整個 swap expired，不能在做什麼事</p>
<p>發起方去透過 refund 解鎖</p>
<h3 id="refund-htlt">Refund HTLT</h3>
<p>若是已經 complete 或是 timeout expired，發起 HTLT 的 address 可以透過 refund 來取回資產</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token refund <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --swap-id <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --from <span class="si">${</span><span class="nv">FROM_ADDR</span><span class="si">}</span>  <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>回覆 tx 的狀態，<a href="https://testnet-explorer.binance.org/tx/F0F5AB40EF7B1CCFE54EBAE0B8022E9B3C381D0029C55A8FE7C3C87E8ACF800D">可以在explorer 上看到</a>，transaction type 為 refund swap</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">Committed at block <span class="m">46047771</span> <span class="o">(</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  tx hash: F0F5AB40EF7B1CCFE54EBAE0B8022E9B3C381D0029C55A8FE7C3C87E8ACF800D, 
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  response: <span class="o">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    Code:0 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    Data:<span class="o">[]</span> 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    Log:Msg 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    0:  
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      Info: 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        GasWanted:0 
</span></span><span class="line"><span class="ln">10</span><span class="cl">        GasUsed:0 
</span></span><span class="line"><span class="ln">11</span><span class="cl">        Tags:<span class="o">[{</span>Key:<span class="o">[</span><span class="m">115</span> <span class="m">101</span> <span class="m">110</span> <span class="m">100</span> <span class="m">101</span> 114<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">119</span> <span class="m">120</span> <span class="m">101</span> <span class="m">112</span> <span class="m">108</span> <span class="m">121</span> <span class="m">119</span> <span class="m">55</span> <span class="m">120</span> <span class="m">56</span> <span class="m">97</span> <span class="m">97</span> <span class="m">104</span> <span class="m">121</span> <span class="m">57</span> <span class="m">51</span> <span class="m">119</span> <span class="m">57</span> <span class="m">54</span> <span class="m">121</span> <span class="m">104</span> <span class="m">119</span> <span class="m">109</span> <span class="m">55</span> <span class="m">120</span> <span class="m">99</span> <span class="m">113</span> <span class="m">51</span> <span class="m">107</span> <span class="m">101</span> <span class="m">52</span> <span class="m">102</span> <span class="m">102</span> <span class="m">97</span> <span class="m">115</span> <span class="m">112</span> <span class="m">51</span> 100<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">114</span> <span class="m">101</span> <span class="m">99</span> <span class="m">105</span> <span class="m">112</span> <span class="m">105</span> <span class="m">101</span> <span class="m">110</span> 116<span class="o">]</span> Value:<span class="o">[</span><span class="m">116</span> <span class="m">98</span> <span class="m">110</span> <span class="m">98</span> <span class="m">49</span> <span class="m">97</span> <span class="m">54</span> <span class="m">112</span> <span class="m">118</span> <span class="m">53</span> <span class="m">103</span> <span class="m">109</span> <span class="m">110</span> <span class="m">115</span> <span class="m">97</span> <span class="m">121</span> <span class="m">52</span> <span class="m">97</span> <span class="m">57</span> <span class="m">115</span> <span class="m">114</span> <span class="m">55</span> <span class="m">110</span> <span class="m">118</span> <span class="m">100</span> <span class="m">48</span> <span class="m">109</span> <span class="m">108</span> <span class="m">100</span> <span class="m">122</span> <span class="m">50</span> <span class="m">57</span> <span class="m">97</span> <span class="m">54</span> <span class="m">107</span> <span class="m">100</span> <span class="m">120</span> <span class="m">121</span> <span class="m">101</span> <span class="m">51</span> <span class="m">55</span> <span class="m">99</span> 101<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}</span> <span class="o">{</span>Key:<span class="o">[</span><span class="m">97</span> <span class="m">99</span> <span class="m">116</span> <span class="m">105</span> <span class="m">111</span> 110<span class="o">]</span> Value:<span class="o">[</span><span class="m">114</span> <span class="m">101</span> <span class="m">102</span> <span class="m">117</span> <span class="m">110</span> <span class="m">100</span> <span class="m">72</span> <span class="m">84</span> <span class="m">76</span> 84<span class="o">]</span> XXX_NoUnkeyedLiteral:<span class="o">{}</span> XXX_unrecognized:<span class="o">[]</span> XXX_sizecache:0<span class="o">}]</span> 
</span></span><span class="line"><span class="ln">12</span><span class="cl">        Codespace: 
</span></span><span class="line"><span class="ln">13</span><span class="cl">          XXX_NoUnkeyedLiteral:<span class="o">{}</span> 
</span></span><span class="line"><span class="ln">14</span><span class="cl">          XXX_unrecognized:<span class="o">[]</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl">          XXX_sizecache:0
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="o">)</span>
</span></span></code></pre></div><p>重新查詢 swap 狀態，已經變成 expired</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token query-swap <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --swap-id <span class="si">${</span><span class="nv">SWAP_ID</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">	<span class="nt">&#34;from&#34;</span><span class="p">:</span> <span class="s2">&#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">	<span class="nt">&#34;to&#34;</span><span class="p">:</span> <span class="s2">&#34;tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	<span class="nt">&#34;out_amount&#34;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">		<span class="nt">&#34;denom&#34;</span><span class="p">:</span> <span class="s2">&#34;BNB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">		<span class="nt">&#34;amount&#34;</span><span class="p">:</span> <span class="s2">&#34;3&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	<span class="p">}],</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="nt">&#34;in_amount&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	<span class="nt">&#34;expected_income&#34;</span><span class="p">:</span> <span class="s2">&#34;1:BNB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	<span class="nt">&#34;recipient_other_chain&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">	<span class="nt">&#34;random_number_hash&#34;</span><span class="p">:</span> <span class="s2">&#34;2c2588c81a5f08bf55a183cc2d61a123368405638741169933e200c90f4532e5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">	<span class="nt">&#34;random_number&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;1571905650&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">	<span class="nt">&#34;cross_chain&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">	<span class="nt">&#34;expire_height&#34;</span><span class="p">:</span> <span class="s2">&#34;46043293&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">	<span class="nt">&#34;index&#34;</span><span class="p">:</span> <span class="s2">&#34;2239&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">	<span class="nt">&#34;closed_time&#34;</span><span class="p">:</span> <span class="s2">&#34;1571908256&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">	<span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;Expired&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>
<h1 id="from-ethereum-to-binance-chain">從 Ethereum swap 到 Binance Chain</h1>
<p>這邊我們要從 ethereum 上，將 ERC-20 token 與 binance chain 上的 BNB 做交換，先準備需要用到的東西</p>
<h3 id="binance-testnet">binance testnet</h3>
<ul>
<li>準備好 address 與 BNB，這邊沿用我們上篇使用的 address <a href="https://testnet-explorer.binance.org/address/tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p">tbnb1hq6v49an3wwhrd8ny7qj3exgfmvpvuelkcaj9p</a></li>
</ul>
<h3 id="ethereum-testnet-ropsten">ethereum testnet (ropsten)</h3>
<ul>
<li>Admin Address <a href="https://ropsten.etherscan.io/address/0x938a452d293c23c2cdeae0bf01760d8ecc4f826b">[ropsten etherscan]</a></li>
<li>部署 ERC20 token <a href="https://ropsten.etherscan.io/address/0xDec348688B060fB44144971461b3BAaC8BD1e571">[ropsten etherscan]</a>，我自己發行的 <a href="https://ropsten.etherscan.io/token/0xDec348688B060fB44144971461b3BAaC8BD1e571">Party Parrot Token (PPT)</a> <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt=""
      
        class="image_figure image_external image_processed"
        width="128"
        height="128"
        src="/parrot_9680404649818050274.gif"
      
      
    />

    </picture>
</figure>
</li>
<li>部署 ERC20 Atomic Swapper 智能合約
<ul>
<li><a href="https://github.com/chechiachang/bep3-smartcontracts">binance-chain/bep3-smartcontract</a> 提供</li>
</ul>
</li>
</ul>
<h3 id="nodevm">Node/VM</h3>
<ul>
<li>用來執行 bep3 deputy process
<ul>
<li><a href="https://github.com/binance-chain/bep3-deputy">https://github.com/binance-chain/bep3-deputy</a> 提供</li>
</ul>
</li>
</ul>
<h3 id="workflow">workflow</h3>
<p>我們看一下官方提供的這張圖</p>
<p><figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt=""
      
        class="image_figure image_external image_unprocessed"
        src="https://docs.binance.org/assets/eth2bnc.png"
      
      
    />

    </picture>
</figure>
</p>
<ol>
<li>Wallet Address 在 ERC20 Token (PPToken) approve() Swap Contract 一部分 Token</li>
<li>初始化 Swap Transaction(tx)</li>
<li>Deputy 監測到 Ethereum 鏈上的 swap tx，向 Binance Chain 發起一個對應的 HTLT tx，等待 Binance 上的 claim tx</li>
<li>Wallet Address 向 Binance Chain 執行 HTLT claim()</li>
<li>Deputy 監測到 Binance Chain 上的 claim tx 與 swap complete，代為向 Ethereum claim ERC-20</li>
</ol>
<h3 id="執行-deputy">執行 deputy</h3>
<p>我們可以先將 deputy 程序跑起來，這邊使用的是 <a href="https://github.com/binance-chain/bep3-deputy">Binance Chaing/bep3-deputy</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">go get github.com/binance-chain/bep3-deputy
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nb">cd</span> <span class="si">${</span><span class="nv">GOPATH</span><span class="si">}</span>/src/github.com/binance-chain/bep3-deputy
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl">$ go mod download
</span></span><span class="line"><span class="ln">5</span><span class="cl">$ make build
</span></span><span class="line"><span class="ln">6</span><span class="cl">go build  -o build/deputy main.go
</span></span></code></pre></div><p>啟動本地 MySQL，這邊直接用 docker 起一個無密碼的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">$ docker run \
</span></span><span class="line"><span class="ln">2</span><span class="cl">  --name some-mysql \
</span></span><span class="line"><span class="ln">3</span><span class="cl">  -e MYSQL_ALLOW_EMPTY_PASSWORD=yes \
</span></span><span class="line"><span class="ln">4</span><span class="cl">  -e MYSQL_DATABASE=deputy \
</span></span><span class="line"><span class="ln">5</span><span class="cl">  -d \
</span></span><span class="line"><span class="ln">6</span><span class="cl">  mysql:5.7.27
</span></span></code></pre></div><p>設定 config/confg.json</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="nt">&#34;db_config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="nt">&#34;dialect&#34;</span><span class="p">:</span> <span class="s2">&#34;mysql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="nt">&#34;db_path&#34;</span><span class="p">:</span> <span class="s2">&#34;root:@(localhost:3306)/deputy?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="nt">&#34;chain_config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="nt">&#34;bnb_start_height&#34;</span><span class="p">:</span> <span class="mi">42516056</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="nt">&#34;other_chain&#34;</span><span class="p">:</span> <span class="s2">&#34;ETH&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nt">&#34;other_chain_start_height&#34;</span><span class="p">:</span> <span class="mi">6495598</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="nt">&#34;admin_config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="nt">&#34;listen_addr&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1:8080&#34;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="nt">&#34;bnb_config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nt">&#34;key_type&#34;</span><span class="p">:</span> <span class="s2">&#34;mnemonic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nt">&#34;mnemonic&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;my-mnemonic&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nt">&#34;rpc_addr&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp://data-seed-pre-0-s1.binance.org:80&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nt">&#34;symbol&#34;</span><span class="p">:</span> <span class="s2">&#34;BNB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nt">&#34;deputy_addr&#34;</span><span class="p">:</span> <span class="s2">&#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nt">&#34;fetch_interval&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="nt">&#34;eth_config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nt">&#34;swap_type&#34;</span><span class="p">:</span> <span class="s2">&#34;erc20_swap&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="nt">&#34;key_type&#34;</span><span class="p">:</span> <span class="s2">&#34;private_key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="nt">&#34;private_key&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;my-private-key&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nt">&#34;provider&#34;</span><span class="p">:</span> <span class="s2">&#34;https://ropsten.infura.io/v3/cd9643b1870b489b93477921cb767882&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="nt">&#34;swap_contract_addr&#34;</span><span class="p">:</span> <span class="s2">&#34;0xA08E0F38462eCd107adE62Ee3004850f2448f3d6&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="nt">&#34;token_contract_addr&#34;</span><span class="p">:</span> <span class="s2">&#34;0xDec348688B060fB44144971461b3BAaC8BD1e571&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="nt">&#34;deputy_addr&#34;</span><span class="p">:</span> <span class="s2">&#34;0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="nt">&#34;gas_limit&#34;</span><span class="p">:</span> <span class="mi">300000</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="nt">&#34;gas_price&#34;</span><span class="p">:</span> <span class="mi">20000000000</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>這樣注意幾個地方</p>
<ul>
<li>db_config 填上 mysql url，有設密碼的話一併帶入</li>
<li>chain_config.bnb_start_height 可以先追到目前的 block height，畢竟我們的 swap tx 都在 deputy 起來之後才會產生，可以跳過啟動時 sync block 的時間。如果是要追過去的 tx，就要調整 block 的高度，並且給予足夠的時間上 deputy 去 sync block。可以到 <a href="https://testnet-explorer.binance.org/">testnet-explorer</a> 查目前的 block height。</li>
<li>chain_config.other_chain_start_height 也追到最新的 eth block height，可以到 <a href="https://ropsten.etherscan.io/">Etherscan</a> 查目前的 block height</li>
<li>bnb_config 填上 bnb addr 與助記祠</li>
<li>eth_config 填上 eth addr 與 private key</li>
<li>eth_config.deupty_addr 使用 Admin addr，並填上 private key</li>
</ul>
<p>把 deputy 以 testnet 為目標執行起來</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">./build/deputy --help
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">./build/deputy <span class="se">\
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="se"></span>  --bnb-network <span class="m">0</span> <span class="se">\
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="se"></span>  --config-type <span class="nb">local</span> <span class="se">\
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="se"></span>  --config-path config/config.json
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">2019-10-25 17:16:48 DEBUG Debug sent a request
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">2019-10-25 17:16:48 INFO fetch ETH cur height: <span class="m">6641795</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">2019-10-25 17:16:48 DEBUG Debug sent a request
</span></span><span class="line"><span class="ln">11</span><span class="cl">2019-10-25 17:16:48 DEBUG Debug sent a request
</span></span><span class="line"><span class="ln">12</span><span class="cl">2019-10-25 17:16:48 INFO fetch BNB cur height: <span class="m">46215517</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">2019-10-25 17:16:48 DEBUG Debug sent a request
</span></span><span class="line"><span class="ln">14</span><span class="cl">2019-10-25 17:16:48 INFO fetch try to get ahead block, <span class="nv">chain</span><span class="o">=</span>BNB, <span class="nv">height</span><span class="o">=</span><span class="m">46215518</span>
</span></span></code></pre></div><p>deputy 啟動後，就會依據 db 中的 block 資料，開始一路追 block，發現是相關的 addr 就把 tx 拉下來處理。</p>
<p>由於我們這邊是新 db，我們又直接跳到最新的 block，應該不會需要太多時間就能追上。</p>
<p>deputy 有 admin api 可以使用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">curl http://localhost:8080
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">curl http://localhost:8080/failed_swaps/1
</span></span><span class="line"><span class="ln">4</span><span class="cl">the number of total failed swaps is 0, the offset of query is <span class="m">0</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">curl http://localhost:8080/status
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;NormalMode&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="nt">&#34;bnb_chain_height&#34;</span><span class="p">:</span> <span class="mi">46215719</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="nt">&#34;bnb_sync_height&#34;</span><span class="p">:</span> <span class="mi">46215718</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="nt">&#34;other_chain_height&#34;</span><span class="p">:</span> <span class="mi">6641804</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nt">&#34;other_chain_sync_height&#34;</span><span class="p">:</span> <span class="mi">6641804</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="nt">&#34;bnb_chain_last_block_fetched_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-10-25T17:18:52+08:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="nt">&#34;other_chain_last_block_fetched_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-10-25T17:18:40+08:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="nt">&#34;bnb_status&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="nt">&#34;balance&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                <span class="nt">&#34;symbol&#34;</span><span class="p">:</span> <span class="s2">&#34;BNB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                <span class="nt">&#34;free&#34;</span><span class="p">:</span> <span class="s2">&#34;18.99812504&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">                <span class="nt">&#34;locked&#34;</span><span class="p">:</span> <span class="s2">&#34;0.00000000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="nt">&#34;frozen&#34;</span><span class="p">:</span> <span class="s2">&#34;0.00000000&#34;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nt">&#34;other_chain_status&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nt">&#34;allowance&#34;</span><span class="p">:</span> <span class="s2">&#34;9.8e+13&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nt">&#34;erc20_balance&#34;</span><span class="p">:</span> <span class="s2">&#34;9.999999969e+20&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="nt">&#34;eth_balance&#34;</span><span class="p">:</span> <span class="s2">&#34;6.982922764&#34;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>可以看到 deputy 上設定的 bnb_addr, eth_addr 的狀態</p>
<ul>
<li>other_chain_status.allowance: 9.8e+13</li>
</ul>
<hr>
<h1 id="開始-swap">開始 Swap</h1>
<p>複習一下流程</p>
<p><figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt=""
      
        class="image_figure image_external image_unprocessed"
        src="https://docs.binance.org/assets/eth2bnc.png"
      
      
    />

    </picture>
</figure>
</p>
<ol start="0">
<li>部署好 swap contract &amp; deputy，啟動 deputy process</li>
<li>Wallet Address 在 ERC20 Token (PPToken) approve()，給 Swap Contract 一部分 Token</li>
<li>初始化 Swap Transaction(tx)</li>
<li>Deputy 監測到 Ethereum 鏈上的 swap tx，向 Binance Chain 發起一個對應的 HTLT tx，等待 Binance 上的 claim tx</li>
<li>Wallet Address 向 Binance Chain 執行 HTLT claim()</li>
<li>Deputy 監測到 Binance Chain 上的 claim tx 與 swap complete，代為向 Ethereum claim ERC-20</li>
</ol>
<h3 id="erc20-contract-approve">ERC20 contract Approve()</h3>
<p>到 ERC20 contract 的頁面，選擇 approve</p>
<p>spender: swap contract address
value: 10000 PPToken (乘上 10^18)</p>
<p><a href="https://ropsten.etherscan.io/address/0xdec348688b060fb44144971461b3baac8bd1e571#events">到 etherscan 上查看</a></p>
<h3 id="call-htlt-function">Call HTLT function</h3>
<p>Go to swap contract，call  htlt()</p>
<p>用 etherscan 送上去，然後就壞掉了，<a href="https://ropsten.etherscan.io/tx/0xbd0c829ad2466fcd6e49a12bbac1849827fb9e7a251271816401ed4c9bfe2fa8">Etherscan 上壞掉的 tx</a> 不知為什麼 QAQ</p>
<p><figure><img src="bep3-atomic-swap-failure-01.jpg" width="70%" height="70%"/>
</figure>

<figure><img src="bep3-atomic-swap-failure-02.jpg" width="70%" height="70%"/>
</figure>
</p>
<p>開 remix IDE，重新嘗試參數</p>
<ul>
<li>randomNumberHash:
<ul>
<li>SHA256(randomNumber||timestamp), randomNumber is 32-length random byte array.</li>
<li>0x0000000000000000000000000000000000000000000000000000000000000000</li>
</ul>
</li>
<li>timestamp:
<ul>
<li>it should be about 10 mins span around current timestamp. <a href="https://www.unixtimestamp.com/">unix timestamp</a></li>
<li>1572250902 (now + 60 sec * 10 min)</li>
</ul>
</li>
<li>heightSpan:
<ul>
<li>it&rsquo;s a customized filed for deputy operator. it should be more than 200 for this deputy.</li>
<li>10000</li>
</ul>
</li>
<li>recipientAddr:
<ul>
<li>deputy address on Ethereum.</li>
<li>0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b</li>
</ul>
</li>
<li>bep2SenderAddr:
<ul>
<li>omit this field with 0x0</li>
<li>0x0000000000000000000000000000000000000000</li>
</ul>
</li>
<li>bep2RecipientAddr:
<ul>
<li>Decode your testnet address from bech32 encoded to hex</li>
<li>0xee82ca237387495e9603f4d8d7efed128bdd59a6</li>
</ul>
</li>
<li>outAmount:
<ul>
<li>approved amount, should be bumped by e^10.</li>
<li>10 0000000000</li>
</ul>
</li>
<li>bep2Amount:
<ul>
<li>outAmount * exchange rate, the default rate is 1.</li>
<li>10 0000000000</li>
</ul>
</li>
</ul>
<h3 id="deputy-call-htlt-on-binance-chain">Deputy Call HTLT on Binance Chain</h3>
<p>Deputy 監測 Ethereum 上的 block 狀態，特別是會取得 Swap contract address 的 swap tx，並在 Binance Chain 上產生對應的 HTLT。</p>
<h3 id="claim-htlt-on-binance-chain">Claim HTLT on Binance Chain</h3>
<p>Binance Chain 上產生 HTLT 後，客戶端這邊可以使用 tbnb 以 recipient addr 查詢 Binance Chain 上的 Swap ID</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token query-swapIDs-by-recipient  <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --recipient-addr tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  --chain-id Binance-Chain-Nile <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  --trust-node <span class="se">\
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="se"></span>  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>獲得過去產生的 swap list</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="s2">&#34;c2be98ac3b9ee7153e5ba84edfefca1917b6e2ec72d2576bf6cce584cbd6095e&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="s2">&#34;18c938b994c62bcce9e8cedcb426a603863d95565a246c323a1df89d5c4226c1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="s2">&#34;5c4fdd60ce44fa4be6de70e65df3f8295df88178fd381b4242a8c2d047663a1b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="s2">&#34;a47c89dfca910cbb34dec92acebebb59d2c62e7f90bf216a87c2c23c84e48d4f&#34;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>都是過去使用的 swap id，如果都沒有新的 swap 出來，可能是 height span 太高，導致一直都爬不到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">SWAP_ID=c2be98ac3b9ee7153e5ba84edfefca1917b6e2ec72d2576bf6cce584cbd6095e
</span></span><span class="line"><span class="ln">2</span><span class="cl">tbnbcli token query-swap \
</span></span><span class="line"><span class="ln">3</span><span class="cl">  --swap-id ${SWAP_ID} \
</span></span><span class="line"><span class="ln">4</span><span class="cl">  --chain-id Binance-Chain-Nile \
</span></span><span class="line"><span class="ln">5</span><span class="cl">  --trust-node \
</span></span><span class="line"><span class="ln">6</span><span class="cl">  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>這邊要對一下 random number, to wallet addr, out amount 等參數，如果 HTLT 符合，客戶就可以執行 Claim HTLT</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">tbnbcli token claim \
</span></span><span class="line"><span class="ln">2</span><span class="cl">  --swap-id ${SWAP_ID} \
</span></span><span class="line"><span class="ln">3</span><span class="cl">  --random-number ${RANDOM_NUMBER} \
</span></span><span class="line"><span class="ln">4</span><span class="cl">  --from ${FROM_KEY} \
</span></span><span class="line"><span class="ln">5</span><span class="cl">  --chain-id Binance-Chain-Nile \
</span></span><span class="line"><span class="ln">6</span><span class="cl">  --trust-node \
</span></span><span class="line"><span class="ln">7</span><span class="cl">  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><h3 id="deputy-claim-erc20-token">Deputy Claim ERC20 Token</h3>
<p>客戶端在 Binance Chain 上 Claim HTLT，Deputy 在 Ethereuem 上 Claim HTLT，至此完成 Atomic Swap 兩邊的流程。客戶端從 Binance Chain Claim，Deputy 從 Ethereuem 上 Claim。完整流程
如下：</p>
<ul>
<li>Client Call HTLT on Ethereum -&gt; Deputy Call HTLT on Binance Chain</li>
<li>Client Check HTLT Status on Binance Chain</li>
<li>Client Call Claim HTLT on Binance Chain -&gt; Deputy Call Claim HTLT on Ethereum</li>
</ul>
<h3 id="client-app-javascript-demo">Client APP javascript Demo</h3>
<p><a href="https://docs.binance.org/atomic-swap.html#6-demo-for-client-app-swap-erc20-to-bep2">希望直接寫成 javascript app 可以參考這篇</a></p>
<hr>
<h1 id="from-binance-chaing-to-ethereum">Swap Tokens from Binance Chain to Ethereum</h1>
<p>這邊進行反向操作，客戶發起從 Binance Chain 換到 Ethereum 上的請求，Deputy 做對應的處理，把 Token Swap 到 Ethereum。我們依樣依照<a href="https://docs.binance.org/atomic-swap.html#swap-tokens-from-binance-chain-to-ethereum">這份文件</a>操作。</p>
<ol>
<li>客戶端在 Binance Chain 上 Call HTLT()</li>
<li>Deputy 在 Ethereum 上 Init Swap tx</li>
<li>Deputy Call Approve() 到 ethereum swap contract</li>
<li>客戶端取得 swap 資訊</li>
<li>客戶端在 Ethereum 上 Call Claim()，取得 ERC-20 Token</li>
<li>Deputy 在 Binance 上 Call Claim()，取得 Binance Chain Token</li>
</ol>
<h3 id="在-binance-chain-上-htlt">在 Binance Chain 上 HTLT</h3>
<p>客戶端發起 HTLT 請求，需要從客戶端 Wallet 送出（但因為我們這邊只使用一個 Binance Address，所以發起的 Addr 跟 Deputy Binance addr 是一樣的。</p>
<p>這邊鎖進 10:BNB，等待 100:PPT 從 ethereum 近來</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">DEPUTY_BNB_WALLET_ADDR=tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">CLIENT_BNB_WALLET_ADDR=${DEPUTY_BNB_WALLET_ADDR}
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">CLIENT_ETHEREUM_ADDR=0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">tbnbcli token HTLT \
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  --from ${CLIENT_BNB_WALLET_ADDR} \
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  --recipient-addr ${DEPUTY_BNB_WALLET_ADDR}  \
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  --chain-id Binance-Chain-Nile  \
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  --height-span 500 \
</span></span><span class="line"><span class="ln">10</span><span class="cl">  --amount  10:BNB  \
</span></span><span class="line"><span class="ln">11</span><span class="cl">  --expected-income 100:PPT  \
</span></span><span class="line"><span class="ln">12</span><span class="cl">  --recipient-other-chain ${CLIENT_ETHEREUM_ADDR}  \
</span></span><span class="line"><span class="ln">13</span><span class="cl">  --cross-chain \
</span></span><span class="line"><span class="ln">14</span><span class="cl">  --trust-node \
</span></span><span class="line"><span class="ln">15</span><span class="cl">  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>HTLT 回復的結果如下，可以在<a href="https://testnet-explorer.binance.org/tx/D653FC7B5D2048A2A165F49426CDCAD733703CF534367133819091892E3A1F14">Binance Testnet Explorer</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">Random number: 75267ba4cc4f2d9ddbf9f90dc1ea813ae2a4d2114eb2ef2cb7ff0a5d285c7396
</span></span><span class="line"><span class="ln">2</span><span class="cl">Timestamp: 1572337686
</span></span><span class="line"><span class="ln">3</span><span class="cl">Random number hash: dabd990af86582969d47218012ecdb09899b9ad2b069c05be94ef82bea889a1b
</span></span><span class="line"><span class="ln">4</span><span class="cl">Password to sign with &#39;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#39;:
</span></span><span class="line"><span class="ln">5</span><span class="cl">Committed at block 46889130 (tx hash: D653FC7B5D2048A2A165F49426CDCAD733703CF534367133819091892E3A1F14, response: {Code:0 Data:[119 24 196 176 181 1 29 177 60 107 100 166 55 16 253 136 159 3 204 56 109 46 63 87 93 9 239 158 138 172 21 129] Log:Msg 0: swapID: 7718c4b0b5011db13c6b64a63710fd889f03cc386d2e3f575d09ef9e8aac1581 Info: GasWanted:0 GasUsed:0 Tags:[{Key:[115 101 110 100 101 114] Value:[116 98 110 98 49 97 54 112 118 53 103 109 110 115 97 121 52 97 57 115 114 55 110 118 100 48 109 108 100 122 50 57 97 54 107 100 120 121 101 51 55 99 101] XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {Key:[114 101 99 105 112 105 101 110 116] Value:[116 98 110 98 49 119 120 101 112 108 121 119 55 120 56 97 97 104 121 57 51 119 57 54 121 104 119 109 55 120 99 113 51 107 101 52 102 102 97 115 112 51 100] XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {Key:[97 99 116 105 111 110] Value:[72 84 76 84] XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0}] Codespace: XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0})
</span></span></code></pre></div><p>取得 swap id 與 random number，使用 swap ip 查詢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">SWAP_ID=7718c4b0b5011db13c6b64a63710fd889f03cc386d2e3f575d09ef9e8aac1581
</span></span><span class="line"><span class="ln">2</span><span class="cl">tbnbcli token query-swap \
</span></span><span class="line"><span class="ln">3</span><span class="cl">  --swap-id ${SWAP_ID} \
</span></span><span class="line"><span class="ln">4</span><span class="cl">  --chain-id Binance-Chain-Nile \
</span></span><span class="line"><span class="ln">5</span><span class="cl">  --trust-node \
</span></span><span class="line"><span class="ln">6</span><span class="cl">  --node http://data-seed-pre-0-s3.binance.org:80
</span></span></code></pre></div><p>回復當前的狀態</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">   <span class="nt">&#34;from&#34;</span><span class="p">:</span><span class="s2">&#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">   <span class="nt">&#34;to&#34;</span><span class="p">:</span><span class="s2">&#34;tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">   <span class="nt">&#34;out_amount&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">         <span class="nt">&#34;denom&#34;</span><span class="p">:</span><span class="s2">&#34;BNB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">         <span class="nt">&#34;amount&#34;</span><span class="p">:</span><span class="s2">&#34;10&#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">   <span class="p">],</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="nt">&#34;in_amount&#34;</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">   <span class="nt">&#34;expected_income&#34;</span><span class="p">:</span><span class="s2">&#34;100:PPT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="nt">&#34;recipient_other_chain&#34;</span><span class="p">:</span><span class="s2">&#34;0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">   <span class="nt">&#34;random_number_hash&#34;</span><span class="p">:</span><span class="s2">&#34;dabd990af86582969d47218012ecdb09899b9ad2b069c05be94ef82bea889a1b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">   <span class="nt">&#34;random_number&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">   <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span><span class="s2">&#34;1572337686&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">   <span class="nt">&#34;cross_chain&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">   <span class="nt">&#34;expire_height&#34;</span><span class="p">:</span><span class="s2">&#34;46889630&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">   <span class="nt">&#34;index&#34;</span><span class="p">:</span><span class="s2">&#34;2245&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">   <span class="nt">&#34;closed_time&#34;</span><span class="p">:</span><span class="s2">&#34;0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">   <span class="nt">&#34;status&#34;</span><span class="p">:</span><span class="s2">&#34;Open&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="deputy-appove-token">Deputy Appove Token</h3>
<p>Deputy 已經抓到 Binance Chain 上的 tx，會記錄在 Mysql 內</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">use deputy;
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">select * from tx_log limit 10;
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">| id | chain | swap_id                                                          | tx_type   | tx_hash                                                          | contract_addr | sender_addr                                 | receiver_addr                               | sender_other_chain                         | other_chain_addr                           | in_amount | out_amount | out_coin | random_number_hash                                               | expire_height | timestamp  | random_number | block_hash                                                       | height   | status    | confirmed_num | create_time | update_time |
</span></span><span class="line"><span class="ln">6</span><span class="cl">|  2 | BNB   | 7718c4b0b5011db13c6b64a63710fd889f03cc386d2e3f575d09ef9e8aac1581 | BEP2_HTLT | d653fc7b5d2048a2a165f49426cdcad733703cf534367133819091892e3a1f14 |               | tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce | tbnb1a6pv5gmnsay4a9sr7nvd0mldz29a6kdxye37ce |                                            | 0x938a452d293c23C2CDEae0Bf01760D8ECC4F826b | 100:PPT   | 10         | BNB      | dabd990af86582969d47218012ecdb09899b9ad2b069c05be94ef82bea889a1b |      46889630 | 1572337686 |               | 6948f34e4013da29c9922306b60b2c12f174925c63ff2a46d6b2fc3acd7a3774 | 46889130 | CONFIRMED |             6 |  1572337694 |  1572337695 |
</span></span></code></pre></div><h3 id="deputy-send-htlt-on-ethereum">Deputy Send HTLT on Ethereum</h3>
<p>查詢 Ethereum 上的 HTLT</p>
<h3 id="客戶端-call-claim-取得-erc-20-token">客戶端 Call Claim 取得 ERC-20 Token</h3>
<p>客戶端取得 100:PPT</p>
<h3 id="deputy-call-htlt-claim-取得-binance-token">Deputy Call HTLT Claim 取得 Binance Token</h3>
<p>Deputy 取得 10:BNB</p>
<hr>
<h3 id="gce">GCE</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">gcloud compute ssh dep3-deputy
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">sudo apt-get install mysql-server
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">sudo cat /etc/mysql/debian.cnf
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">wget https://dl.google.com/go/go1.13.3.linux-amd64.tar.gz
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">tar -C /usr/local -xzf go1.13.3.linux-amd64.tar.gz
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">export PATH=$PATH:/usr/local/go/bin
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">go get github.com/binance-chain/bep3-deputy
</span></span><span class="line"><span class="ln">12</span><span class="cl">go mod tidy
</span></span><span class="line"><span class="ln">13</span><span class="cl">go build  -o build/deputy main.go
</span></span></code></pre></div><h3 id="references">References</h3>
<ul>
<li><a href="https://docs.binance.org/atomic-swap.html">Binace Chain Doc</a></li>
<li><a href="https://github.com/binance-chain/BEPs/blob/master/BEP3.md">Binance BEP3 spec</a></li>
</ul>

    </div>
<div class="post_comments">
  
  
  
</div>




  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <br>
    

        <h2>Che-Chia Chang</h2>
      <div class="author_bio">
        DevOps, SRE, Kubernetes admin.
      </div>
      <a href='https://chechia.net/about/' class="button mt-1" role="button" title='Read More'>Read More</a>

    
    
    <h2 class="mt-4">Featured Posts</h2>
    <ul>
      <li>
        <a href="https://chechia.net/post/2022-09-18-14th-ithome-ironman-iac-aws-workshop-04-aws-multi-account-structure/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop 04 AWS Multi-Accounts Structure">14th Ithome Ironman Iac Aws Workshop 04 AWS Multi-Accounts Structure</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-16-14th-ithome-ironman-iac-aws-workshop-03-provision-aws-account/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop-03 Provision Child AWS Accounts">14th Ithome Ironman Iac Aws Workshop-03 Provision Child AWS Accounts</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-15-14th-ithome-ironman-iac-aws-workshop-02-aws-account-structure/" class="nav-link" title="14th Ithome Ironman Iac Aws Workshop-02 AWS Account Struture">14th Ithome Ironman Iac Aws Workshop-02 AWS Account Struture</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-09-12-14th-ithome-ironman-iac-aws-workshop-01-introduction/" class="nav-link" title="14th iThome ironman-01 IaC best practice workshop on aws">14th iThome ironman-01 IaC best practice workshop on aws</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-06-09-ithome-devopsday-2022-proposal-introduce-policy-as-code-for-terraform-/" class="nav-link" title="IThome 2022 DevOpsDay Introducing policy as code for terraform">IThome 2022 DevOpsDay Introducing policy as code for terraform</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2022-05-21-coscup-proposal-operating-time-series-database-in-k8s/" class="nav-link" title="2022 05 21 COSCUP Operating Time Series Database in K8s">2022 05 21 COSCUP Operating Time Series Database in K8s</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2021-11-16-ithome-cloud-summit-vault/" class="nav-link" title="2021 11 16 Ithome Cloud Summit Vault">2021 11 16 Ithome Cloud Summit Vault</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2020-09-26-gcp-preemptible-instance-kubernetes/" class="nav-link" title="Gcp Preemptible Instance Kubernetes">Gcp Preemptible Instance Kubernetes</a>
      </li>
    </ul>
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://chechia.net/post/2021-09-01-ithome-ironman-go/" class="nav-link" title="2021 09 01 Ithome Ironman Go">2021 09 01 Ithome Ironman Go</a>
      </li>
      <li>
        <a href="https://chechia.net/post/2020-09-26-gcp-preemptible-instance-kubernetes/" class="nav-link" title="Gcp Preemptible Instance Kubernetes">Gcp Preemptible Instance Kubernetes</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://chechia.net/categories/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">44</span>
        </a>
        
        <a href='https://chechia.net/categories/terraform/' class="post_tag button button_translucent" title="terraform">
          TERRAFORM
          <span class="button_tally">12</span>
        </a>
        
        <a href='https://chechia.net/categories/kafka/' class="post_tag button button_translucent" title="kafka">
          KAFKA
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/categories/prometheus/' class="post_tag button button_translucent" title="prometheus">
          PROMETHEUS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/categories/redis/' class="post_tag button button_translucent" title="redis">
          REDIS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/categories/elasticsearch/' class="post_tag button button_translucent" title="elasticsearch">
          ELASTICSEARCH
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://chechia.net/categories/cert-manager/' class="post_tag button button_translucent" title="cert-manager">
          CERT-MANAGER
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://chechia.net/categories/technology/' class="post_tag button button_translucent" title="technology">
          TECHNOLOGY
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://chechia.net/categories/blockchain/' class="post_tag button button_translucent" title="blockchain">
          BLOCKCHAIN
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/crd/' class="post_tag button button_translucent" title="crd">
          CRD
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/logstash/' class="post_tag button button_translucent" title="logstash">
          LOGSTASH
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/murmur/' class="post_tag button button_translucent" title="murmur">
          MURMUR
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/nginx/' class="post_tag button button_translucent" title="nginx">
          NGINX
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://chechia.net/categories/certificate/' class="post_tag button button_translucent" title="certificate">
          CERTIFICATE
          <span class="button_tally">1</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Categories</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://chechia.net/categories/blockchain/' class=" post_tag button button_translucent" data-position=2 title="blockchain">BLOCKCHAIN<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/cert-manager/' class=" post_tag button button_translucent" data-position=3 title="cert-manager">CERT-MANAGER<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/categories/certificate/' class=" post_tag button button_translucent" data-position=1 title="certificate">CERTIFICATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/crd/' class=" post_tag button button_translucent" data-position=2 title="crd">CRD<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/devops/' class=" post_tag button button_translucent" data-position=1 title="devops">DEVOPS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/distributed-system/' class=" post_tag button button_translucent" data-position=1 title="distributed-system">DISTRIBUTED-SYSTEM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/elasticsearch/' class=" post_tag button button_translucent" data-position=4 title="elasticsearch">ELASTICSEARCH<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://chechia.net/categories/golang/' class=" post_tag button button_translucent" data-position=1 title="golang">GOLANG<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/istio/' class=" post_tag button button_translucent" data-position=1 title="istio">ISTIO<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/jenkins/' class=" post_tag button button_translucent" data-position=1 title="jenkins">JENKINS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/categories/kafka/' class=" post_tag button button_translucent" data-position=7 title="kafka">KAFKA<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/categories/kubernetes/' class=" post_tag button button_translucent" data-position=44 title="kubernetes">KUBERNETES<span class="button_tally">44</span>
            </a>
            
            
            <a href='https://chechia.net/categories/logstash/' class=" post_tag button button_translucent" data-position=2 title="logstash">LOGSTASH<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/murmur/' class=" post_tag button button_translucent" data-position=2 title="murmur">MURMUR<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/nginx/' class=" post_tag button button_translucent" data-position=2 title="nginx">NGINX<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/categories/prometheus/' class=" post_tag button button_translucent" data-position=5 title="prometheus">PROMETHEUS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/categories/redis/' class=" post_tag button button_translucent" data-position=5 title="redis">REDIS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/categories/technology/' class=" post_tag button button_translucent" data-position=3 title="technology">TECHNOLOGY<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/categories/terraform/' class=" post_tag button button_translucent" data-position=12 title="terraform">TERRAFORM<span class="button_tally">12</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://chechia.net/tags/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">50</span>
        </a>
        
        <a href='https://chechia.net/tags/ithome/' class="post_tag button button_translucent" title="ithome">
          ITHOME
          <span class="button_tally">20</span>
        </a>
        
        <a href='https://chechia.net/tags/terraform/' class="post_tag button button_translucent" title="terraform">
          TERRAFORM
          <span class="button_tally">15</span>
        </a>
        
        <a href='https://chechia.net/tags/devops/' class="post_tag button button_translucent" title="devops">
          DEVOPS
          <span class="button_tally">11</span>
        </a>
        
        <a href='https://chechia.net/tags/gcp/' class="post_tag button button_translucent" title="gcp">
          GCP
          <span class="button_tally">10</span>
        </a>
        
        <a href='https://chechia.net/tags/kafka/' class="post_tag button button_translucent" title="kafka">
          KAFKA
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://chechia.net/tags/preemptible/' class="post_tag button button_translucent" title="preemptible">
          PREEMPTIBLE
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/tags/spot-instance/' class="post_tag button button_translucent" title="spot-instance">
          SPOT-INSTANCE
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://chechia.net/tags/redis/' class="post_tag button button_translucent" title="redis">
          REDIS
          <span class="button_tally">6</span>
        </a>
        
        <a href='https://chechia.net/tags/elasticsearch/' class="post_tag button button_translucent" title="elasticsearch">
          ELASTICSEARCH
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/tags/logstash/' class="post_tag button button_translucent" title="logstash">
          LOGSTASH
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/tags/prometheus/' class="post_tag button button_translucent" title="prometheus">
          PROMETHEUS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://chechia.net/tags/aws/' class="post_tag button button_translucent" title="aws">
          AWS
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://chechia.net/tags/cert-manager/' class="post_tag button button_translucent" title="cert-manager">
          CERT-MANAGER
          <span class="button_tally">4</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Tags</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://chechia.net/tags/atomic-swap/' class=" post_tag button button_translucent" data-position=1 title="atomic-swap">ATOMIC-SWAP<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/aws/' class=" post_tag button button_translucent" data-position=4 title="aws">AWS<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://chechia.net/tags/bep3/' class=" post_tag button button_translucent" data-position=1 title="bep3">BEP3<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/binance/' class=" post_tag button button_translucent" data-position=1 title="binance">BINANCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/blockchain/' class=" post_tag button button_translucent" data-position=2 title="blockchain">BLOCKCHAIN<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/borg/' class=" post_tag button button_translucent" data-position=2 title="borg">BORG<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/cd/' class=" post_tag button button_translucent" data-position=1 title="cd">CD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/cert-manager/' class=" post_tag button button_translucent" data-position=4 title="cert-manager">CERT-MANAGER<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://chechia.net/tags/certificate/' class=" post_tag button button_translucent" data-position=1 title="certificate">CERTIFICATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ci/' class=" post_tag button button_translucent" data-position=1 title="ci">CI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/container/' class=" post_tag button button_translucent" data-position=1 title="container">CONTAINER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/crd/' class=" post_tag button button_translucent" data-position=3 title="crd">CRD<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/cri/' class=" post_tag button button_translucent" data-position=1 title="cri">CRI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/devops/' class=" post_tag button button_translucent" data-position=11 title="devops">DEVOPS<span class="button_tally">11</span>
            </a>
            
            
            <a href='https://chechia.net/tags/distributed-system/' class=" post_tag button button_translucent" data-position=1 title="distributed-system">DISTRIBUTED-SYSTEM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/docker/' class=" post_tag button button_translucent" data-position=1 title="docker">DOCKER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/elasticsearch/' class=" post_tag button button_translucent" data-position=5 title="elasticsearch">ELASTICSEARCH<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/tags/elk/' class=" post_tag button button_translucent" data-position=1 title="elk">ELK<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/erc-20/' class=" post_tag button button_translucent" data-position=1 title="erc-20">ERC-20<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ethereum/' class=" post_tag button button_translucent" data-position=1 title="ethereum">ETHEREUM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/filebeat/' class=" post_tag button button_translucent" data-position=1 title="filebeat">FILEBEAT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/fluentd/' class=" post_tag button button_translucent" data-position=1 title="fluentd">FLUENTD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/gcp/' class=" post_tag button button_translucent" data-position=10 title="gcp">GCP<span class="button_tally">10</span>
            </a>
            
            
            <a href='https://chechia.net/tags/golang/' class=" post_tag button button_translucent" data-position=1 title="golang">GOLANG<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/google/' class=" post_tag button button_translucent" data-position=2 title="google">GOOGLE<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/haproxy/' class=" post_tag button button_translucent" data-position=3 title="haproxy">HAPROXY<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/iac/' class=" post_tag button button_translucent" data-position=4 title="iac">IAC<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ibm-q-experience/' class=" post_tag button button_translucent" data-position=1 title="ibm-q-experience">IBM-Q-EXPERIENCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/index/' class=" post_tag button button_translucent" data-position=1 title="index">INDEX<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ingress/' class=" post_tag button button_translucent" data-position=2 title="ingress">INGRESS<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://chechia.net/tags/istio/' class=" post_tag button button_translucent" data-position=1 title="istio">ISTIO<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/ithome/' class=" post_tag button button_translucent" data-position=20 title="ithome">ITHOME<span class="button_tally">20</span>
            </a>
            
            
            <a href='https://chechia.net/tags/jenkins/' class=" post_tag button button_translucent" data-position=1 title="jenkins">JENKINS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/kafka/' class=" post_tag button button_translucent" data-position=9 title="kafka">KAFKA<span class="button_tally">9</span>
            </a>
            
            
            <a href='https://chechia.net/tags/kubernetes/' class=" post_tag button button_translucent" data-position=50 title="kubernetes">KUBERNETES<span class="button_tally">50</span>
            </a>
            
            
            <a href='https://chechia.net/tags/lecture/' class=" post_tag button button_translucent" data-position=1 title="lecture">LECTURE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/logstash/' class=" post_tag button button_translucent" data-position=5 title="logstash">LOGSTASH<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/tags/mit/' class=" post_tag button button_translucent" data-position=1 title="mit">MIT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/nginx/' class=" post_tag button button_translucent" data-position=3 title="nginx">NGINX<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/pac/' class=" post_tag button button_translucent" data-position=1 title="pac">PAC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/preemptible/' class=" post_tag button button_translucent" data-position=7 title="preemptible">PREEMPTIBLE<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/tags/prometheus/' class=" post_tag button button_translucent" data-position=5 title="prometheus">PROMETHEUS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://chechia.net/tags/quantum-computing/' class=" post_tag button button_translucent" data-position=1 title="quantum-computing">QUANTUM-COMPUTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/redis/' class=" post_tag button button_translucent" data-position=6 title="redis">REDIS<span class="button_tally">6</span>
            </a>
            
            
            <a href='https://chechia.net/tags/spot-instance/' class=" post_tag button button_translucent" data-position=7 title="spot-instance">SPOT-INSTANCE<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://chechia.net/tags/terraform/' class=" post_tag button button_translucent" data-position=15 title="terraform">TERRAFORM<span class="button_tally">15</span>
            </a>
            
            
            <a href='https://chechia.net/tags/tls/' class=" post_tag button button_translucent" data-position=3 title="tls">TLS<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://chechia.net/tags/tutorial/' class=" post_tag button button_translucent" data-position=1 title="tutorial">TUTORIAL<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://chechia.net/tags/vault/' class=" post_tag button button_translucent" data-position=1 title="vault">VAULT<span class="button_tally">1</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord">
    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
  </symbol>
</svg>


<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://chechia.net/icons/apple-touch-icon.png' class="icon icon_2 transparent" alt="Che-Chia Chang">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;CHE-CHIA CHANG. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <title>to-top</title>
  <use xlink:href="#to-top"></use>
</svg>

</a>

  </div>
</footer>

<script type="text/javascript" src="https://chechia.net/en/js/bundle.6703cf5a19523ed401d8d9e012876ed46642e5b6019e567fb9fe7ad6f46ba535d6a1293fe06a8dfd091cf068a6f11fc605273b8b06177a6d0c09579ab0400cf5.js" integrity="sha512-ZwPPWhlSPtQB2NngEodu1GZC5bYBnlZ/uf561vRrpTXWoSk/4GqN/Qkc8Gim8R/GBSc7iwYXem0MCVeasEAM9Q==" crossorigin="anonymous"></script>
  </body>
</html>
